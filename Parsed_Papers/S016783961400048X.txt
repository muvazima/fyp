@&#MAIN-TITLE@&#Adaptively refined multilevel spline spaces from generating systems

@&#HIGHLIGHTS@&#


               
               
                  
                     
                        
                           
                           The construction of (T)HB-splines is extended to generating systems.


                        
                        
                           
                           Among other potential applications, this supports local refinement in the presence of features.


                        
                        
                           
                           The generalization does not require linear independence of the underlying generating systems.


                        
                        
                           
                           Many results on (T)HB-splines can be extended to the more general setting.


                        
                        
                           
                           We identify the linear dependencies that are present in multilevel Zwart–Powell elements.


                        
                     
                  
               
            

@&#KEYPHRASES@&#

Multilevel spline space

Generating system

Preservation of coefficients

Zwart–Powell element

@&#ABSTRACT@&#


               
               
                  The truncated basis of adaptively refined multilevel spline spaces was introduced by Giannelli et al. (2012, 2014). It possesses a number of advantages, including the partition of unity property, decreased support of the basis functions, preservation of coefficients and strong stability, that may make it highly useful for geometric modeling and numerical simulation. We generalize this construction to hierarchies of spaces that are spanned by generating systems that potentially possess linear dependencies. This generalization requires a modified framework, since the existing approach relied on the linear independence of the functions generating the spaces in the hierarchy. Many results, such as the preservation of coefficients, can be extended to the more general setting. As applications of the modified framework, we introduce a hierarchy of hierarchical B-splines, which enables us to perform local refinement in the presence of features, and we also extend the adaptive multilevel framework to spaces spanned by Zwart–Powell (ZP) elements, which are special box splines defined on the criss-cross grid. In the latter case we show how to identify the linear dependencies that are present in the truncated hierarchical generating system and use this result to perform adaptive surface fitting with multilevel ZP elements.
               
            

@&#INTRODUCTION@&#

The study of adaptively refined multilevel spline spaces, such as hierarchical B-splines, has a long history in Computer Aided Geometric Design (Forsey and Bartels, 1988; Greiner and Hormann, 1997; Kraft, 1997; Pulli and Lounsbery, 1997). Recently, the investigation of such spaces has gained significant momentum, partially due to their importance for isogeometric analysis (IgA) (see Hughes et al., 2005; Cottrell et al., 2009), where generalizations of tensor-product splines are needed in order to enable localized mesh refinement. Besides the use of T-splines (Dörfel et al., 2010; Li et al., 2012) and of the recently introduced Locally Refined (LR) splines of Dokken et al. (2013), approaches that rely on hierarchical techniques have been employed successfully to address the issue of local refinement in IgA (e.g. Vuong et al., 2011; Kuru et al., 2014; Bornemann and Cirak, 2013; Schillinger et al., 2012).

So far, the construction and analysis of adaptively refined multilevel spline spaces have been restricted almost entirely to spaces spanned by basis functions, which – by the very definition of this notion – possess the property of linear independence. The aim of the present paper is to provide the generalization to spaces obtained as the span of certain generating systems that are potentially linearly dependent.

More precisely, we extend the framework of truncated hierarchical bases (Giannelli et al., 2012, 2014; Speleers et al., 2009) to the case of generating systems. Since the existing approach relies heavily on the property of linear independence, we need to formulate a modified framework (including a different notation) for this generalization. We show that many of the advantageous properties of truncated hierarchical bases can be extended to the new setting. These include the preservation of coefficients, the nested nature of refinement via domain enlargement, and the partition of unity property.

We also consider two applications of the generalized setting. First, we introduce a hierarchy of hierarchical B-splines that enables us to perform local refinement in the presence of features (local modifications). Second, we consider the adaptive multilevel framework to spaces spanned by Zwart–Powell (ZP) elements, which are special box splines defined on the criss-cross grid (see de Boor et al., 1993; Wang, 2001).

This highly interesting class of functions was studied extensively in approximation theory (Lyche et al., 2008; Foucher and Sablonnière, 2008; see also Prautzsch and Boehm, 2002 for additional information on box splines). ZP elements achieve 
                        
                           
                              C
                           
                           
                              1
                           
                        
                      smoothness with piecewise quadratic functions and possess a single non-trivial linear dependency relation. We show how to analyze the linear dependencies that are inherited by the generating system that spans the adaptively refined multilevel space. The capabilities of the new construction for adaptively refined multilevel ZP elements are demonstrated by using them for surface fitting, where elimination of these linear dependencies is essential.

The remainder of the paper consists of six parts. First we present the generalized hierarchical construction in Section 2. The third section discusses the property of preservation of coefficients and its consequences. Section 4 derives our results concerning refinement via space and/or domain enlargement. It also presents the first application of the generalized setting to define hierarchies of hierarchical B-splines, which allow to perform adaptive refinement in the presence of features. After briefly discussing the case of generating systems with the property of local linear independence in Section 5, we show how to identify and eliminate the linear dependencies that are inherited by a truncated hierarchical generating system for a certain class of generating systems (which includes hierarchical ZP elements). Based on these results, we present an application to surface fitting using adaptively refined hierarchical ZP elements. Finally, we conclude the paper and identify topics for future research.

This section shows how to generalize the construction of truncated hierarchical splines to the case of generating systems, where linear dependencies may or may not be present. We start with some preliminary remarks concerning the notation and establish the selection procedure that leads to the hierarchical construction. Further, we explain the truncation mechanism and introduce the notation of the truncated hierarchical generating system.

Throughout this paper we consider spaces V of functions defined on an open set 
                           Ω
                           ⊂
                           
                              
                                 R
                              
                              
                                 D
                              
                           
                         that are spanned by finite
                           1
                        
                        
                           1
                           Even though we consider finite generating systems, the following theory can also be applied to locally finite systems (see Davydov et al., 1997, for the definition of this notion).
                         
                        generating systems G. The generating systems are represented by column vectors
                           
                              (1)
                              
                                 G
                                 =
                                 
                                    
                                       (
                                       
                                          
                                             γ
                                          
                                          
                                             1
                                          
                                       
                                       ,
                                       …
                                       ,
                                       
                                          
                                             γ
                                          
                                          
                                             n
                                          
                                       
                                       )
                                    
                                    
                                       T
                                    
                                 
                                 ,
                              
                           
                         where the positive integer n denotes the number of functions in G. We will use row vectors c to collect the coefficients of functions in
                           
                              
                                 V
                                 =
                                 span
                                 
                                 G
                                 =
                                 
                                    {
                                    c
                                    G
                                    :
                                    c
                                    ∈
                                    
                                       
                                          R
                                       
                                       
                                          D
                                       
                                    
                                    }
                                 
                                 .
                              
                           
                         We assume that all functions 
                           
                              
                                 γ
                              
                              
                                 i
                              
                           
                         are non-negative and different from the null function. Generating systems that form a partition of unity,
                           
                              
                                 1
                                 G
                                 =
                                 1
                                 ,
                              
                           
                         with 
                           1
                           =
                           (
                           1
                           ,
                           …
                           ,
                           1
                           )
                        , will be said to be normalized.


                        
                           Example 1
                           As an example of a generating system with a linear dependency relation we consider translates of Zwart–Powell (ZP) element, a 
                                 
                                    
                                       C
                                    
                                    
                                       1
                                    
                                 
                               piecewise quadratic box spline. It is defined over a four directional criss-cross grid and it is obtained by applying convolutions to the characteristic function of the unit square in four directions in 
                                 
                                    
                                       R
                                    
                                    
                                       2
                                    
                                 
                              : 
                                 (
                                 1
                                 ,
                                 0
                                 )
                              , 
                                 (
                                 0
                                 ,
                                 1
                                 )
                              , 
                                 (
                                 1
                                 ,
                                 1
                                 )
                               and 
                                 (
                                 −
                                 1
                                 ,
                                 1
                                 )
                              . Its support has the shape of an octagon as shown in Fig. 1
                              . Hence, the function can be associated with the central point of its support. The translates with respect to the integer grid 
                                 
                                    
                                       Z
                                    
                                    
                                       2
                                    
                                 
                               form a generating system with one linear dependency relation. It is known that removing one function restores linear independence. For further information we refer to the monographs of de Boor et al. (1993) and Wang (2001).

We will denote the ZP element in the original position by 
                                 φ
                                 (
                                 x
                                 )
                              . The associated point is 
                                 (
                                 1
                                 /
                                 2
                                 ,
                                 1
                                 /
                                 2
                                 )
                              , i.e. the center of its support. The support and the associated point are depicted in Fig. 1(a). The function itself is shown in Fig. 1(b).

The translates of φ are
                                 
                                    
                                       
                                          
                                             φ
                                          
                                          
                                             i
                                          
                                       
                                       (
                                       ⋅
                                       )
                                       :
                                       =
                                       φ
                                       (
                                       ⋅
                                       −
                                       i
                                       )
                                       ,
                                       
                                       i
                                       ∈
                                       
                                          
                                             Z
                                          
                                          
                                             2
                                          
                                       
                                       .
                                    
                                 
                               Given an open set Ω, we consider only those translates that do not vanish on Ω and collect their indices in a set 
                                 I
                              . These translates then form a finite generating system
                                 
                                    (2)
                                    
                                       G
                                       =
                                       
                                          
                                             (
                                             
                                                
                                                   φ
                                                
                                                
                                                   i
                                                
                                             
                                             )
                                          
                                          
                                             i
                                             ∈
                                             I
                                          
                                       
                                       .
                                    
                                 
                               Obviously, we can introduce a suitable numbering and obtain a column vector of the form (1). The linear dependency relation of ZP elements will be discussed later in Example 22.


                              Note that the support of each element of the generating system G is always a subset of Ω, since Ω is the domain of all functions that we consider. Those parts of the octagonal (untrimmed, i.e. not restricted to Ω) supports of the translates that are not contained in Ω will simply be ignored.  ⋄

We define a relation between generating systems. 
                           Definition 2
                           Considering two different generating systems G and 
                                 
                                    
                                       G
                                    
                                    
                                       ˆ
                                    
                                 
                              , the generating system G is said to be coarser than the generating system 
                                 
                                    
                                       G
                                    
                                    
                                       ˆ
                                    
                                 
                               (and, conversely, 
                                 
                                    
                                       G
                                    
                                    
                                       ˆ
                                    
                                 
                               is finer than G),
                                 
                                    
                                       G
                                       ≺
                                       
                                          
                                             G
                                          
                                          
                                             ˆ
                                          
                                       
                                       ,
                                    
                                 
                               if there exists a non-negative matrix S (i.e. a matrix with non-negative entries) such that
                                 
                                    (3)
                                    
                                       G
                                       =
                                       S
                                       
                                       
                                          
                                             G
                                          
                                          
                                             ˆ
                                          
                                       
                                       .
                                    
                                 
                              
                           

Since the generating systems 
                           G
                           ,
                           
                              
                                 G
                              
                              
                                 ˆ
                              
                           
                         and the matrix S are non-negative, the relation implies the following simple observation: Consider the row 
                           
                              
                                 (
                                 
                                    
                                       s
                                    
                                    
                                       i
                                       j
                                    
                                 
                                 )
                              
                              
                                 j
                              
                           
                         in the matrix S that contains the coefficients of 
                           
                              
                                 γ
                              
                              
                                 i
                              
                           
                         with respect to 
                           
                              
                                 G
                              
                              
                                 ˆ
                              
                           
                        ,
                           
                              (4)
                              
                                 
                                    
                                       γ
                                    
                                    
                                       i
                                    
                                 
                                 =
                                 
                                    
                                       (
                                       
                                          
                                             c
                                          
                                          
                                             i
                                             j
                                          
                                       
                                       )
                                    
                                    
                                       j
                                       =
                                       1
                                       ,
                                       …
                                       ,
                                       
                                          
                                             n
                                          
                                          
                                             ˆ
                                          
                                       
                                    
                                 
                                 
                                    
                                       G
                                    
                                    
                                       ˆ
                                    
                                 
                                 ,
                              
                           
                         where 
                           
                              
                                 n
                              
                              
                                 ˆ
                              
                           
                         is the dimension of 
                           
                              
                                 G
                              
                              
                                 ˆ
                              
                           
                        . Then 
                           
                              
                                 c
                              
                              
                                 i
                                 j
                              
                           
                           ≠
                           0
                         implies 
                           supp
                           
                           
                              
                                 
                                    
                                       γ
                                    
                                    
                                       ˆ
                                    
                                 
                              
                              
                                 j
                              
                           
                           ⊆
                           supp
                           
                           
                              
                                 γ
                              
                              
                                 i
                              
                           
                        , where 
                           
                              
                                 G
                              
                              
                                 ˆ
                              
                           
                           =
                           
                              
                                 (
                                 
                                    
                                       
                                          
                                             γ
                                          
                                          
                                             ˆ
                                          
                                       
                                    
                                    
                                       1
                                    
                                 
                                 ,
                                 …
                                 ,
                                 
                                    
                                       
                                          
                                             γ
                                          
                                          
                                             ˆ
                                          
                                       
                                    
                                    
                                       
                                          
                                             n
                                          
                                          
                                             ˆ
                                          
                                       
                                    
                                 
                                 )
                              
                              
                                 T
                              
                           
                        . Thus, each function 
                           
                              
                                 γ
                              
                              
                                 i
                              
                           
                         of G has a representation with respect to 
                           
                              
                                 G
                              
                              
                                 ˆ
                              
                           
                         that involves only functions with support contained in 
                           supp
                           
                           
                              
                                 γ
                              
                              
                                 i
                              
                           
                        . Since the systems are not assumed to be linearly independent, several representations with this property may exist.

We summarize several simple properties of the relation ≺.


                        
                           Lemma 3
                           
                              
                                 
                                    1.
                                    
                                       If 
                                       
                                          G
                                          ≺
                                          
                                             
                                                G
                                             
                                             
                                                ˆ
                                             
                                          
                                        
                                       then 
                                       
                                          span
                                          
                                          G
                                          ⊆
                                          span
                                          
                                          
                                             
                                                G
                                             
                                             
                                                ˆ
                                             
                                          
                                       
                                       .
                                    


                                       The relation ≺ is reflexive, transitive and weakly antisymmetric in the sense that 
                                       
                                          G
                                          ≺
                                          
                                             
                                                G
                                             
                                             
                                                ˆ
                                             
                                          
                                        
                                       and 
                                       
                                          
                                             
                                                G
                                             
                                             
                                                ˆ
                                             
                                          
                                          ≺
                                          G
                                        
                                       imply that 
                                       
                                          span
                                          
                                          G
                                          =
                                          span
                                          
                                          
                                             
                                                G
                                             
                                             
                                                ˆ
                                             
                                          
                                       
                                       .
                                    


                                       If the elements of G form a subset of the elements of 
                                       
                                          
                                             
                                                G
                                             
                                             
                                                ˆ
                                             
                                          
                                       
                                       , then 
                                       
                                          G
                                          ≺
                                          
                                             
                                                G
                                             
                                             
                                                ˆ
                                             
                                          
                                       
                                       .
                                    

To show that ≺ is not antisymmetric consider two generating systems 
                           G
                           =
                           (
                           f
                           )
                         and 
                           
                              
                                 G
                              
                              
                                 ˆ
                              
                           
                           =
                           (
                           λ
                           f
                           )
                        , where 
                           λ
                           >
                           1
                         and f is an arbitrary function; these two systems are different but related in both directions, i.e. 
                           G
                           ≺
                           
                              
                                 G
                              
                              
                                 ˆ
                              
                           
                         and 
                           
                              
                                 G
                              
                              
                                 ˆ
                              
                           
                           ≺
                           G
                        .

Hierarchical generating systems are defined with the help of a domain hierarchy and a hierarchy of generating systems. The domain hierarchy is simply a decreasing sequence of 
                           N
                           +
                           1
                         subsets 
                           
                              
                                 Ω
                              
                              
                                 ℓ
                              
                           
                           ⊂
                           
                              
                                 R
                              
                              
                                 D
                              
                           
                        ,
                           
                              (5)
                              
                                 Ω
                                 =
                                 
                                    
                                       Ω
                                    
                                    
                                       0
                                    
                                 
                                 ⊇
                                 
                                    
                                       Ω
                                    
                                    
                                       1
                                    
                                 
                                 ⊇
                                 …
                                 ⊇
                                 
                                    
                                       Ω
                                    
                                    
                                       N
                                       +
                                       1
                                    
                                 
                                 =
                                 ∅
                                 ,
                              
                           
                         where we added the final domain 
                           
                              
                                 Ω
                              
                              
                                 N
                                 +
                                 1
                              
                           
                           =
                           ∅
                         in order to simplify the notation later on.

The domains define the complementary hierarchy
                           
                              (6)
                              
                                 
                                    
                                       Δ
                                    
                                    
                                       ℓ
                                    
                                 
                                 =
                                 Ω
                                 ∖
                                 
                                    
                                       Ω
                                    
                                    
                                       ℓ
                                       +
                                       1
                                    
                                 
                              
                           
                         satisfying
                           
                              
                                 
                                    
                                       Δ
                                    
                                    
                                       0
                                    
                                 
                                 ⊆
                                 
                                    
                                       Δ
                                    
                                    
                                       1
                                    
                                 
                                 ⊆
                                 …
                                 ⊆
                                 
                                    
                                       Δ
                                    
                                    
                                       N
                                    
                                 
                                 =
                                 Ω
                                 .
                              
                           
                         The elements of this hierarchy will be denoted as rings, because, conceptually, 
                           
                              
                                 Δ
                              
                              
                                 ℓ
                              
                           
                         consist of Ω with the ‘hole’ defined by 
                           
                              
                                 Ω
                              
                              
                                 ℓ
                                 +
                                 1
                              
                           
                         (even though it need not be ring-shaped).

The hierarchy of generating systems is a sequence of 
                           N
                           +
                           1
                         generating systems 
                           
                              
                                 G
                              
                              
                                 ℓ
                              
                           
                           =
                           
                              
                                 (
                                 
                                    
                                       γ
                                    
                                    
                                       i
                                    
                                    
                                       ℓ
                                    
                                 
                                 )
                              
                              
                                 i
                                 =
                                 1
                                 .
                                 …
                                 ,
                                 
                                    
                                       n
                                    
                                    
                                       ℓ
                                    
                                 
                              
                           
                         that is monotonically increasing with respect to relation ≺,
                           
                              (7)
                              
                                 
                                    
                                       G
                                    
                                    
                                       0
                                    
                                 
                                 ≺
                                 
                                    
                                       G
                                    
                                    
                                       1
                                    
                                 
                                 ≺
                                 …
                                 ≺
                                 
                                    
                                       G
                                    
                                    
                                       N
                                    
                                 
                                 .
                              
                           
                         Denoting their spans with 
                           
                              
                                 V
                              
                              
                                 ℓ
                              
                           
                           =
                           span
                           
                           
                              
                                 G
                              
                              
                                 ℓ
                              
                           
                        , we obtain a nested sequence of spaces,
                           
                              
                                 
                                    
                                       V
                                    
                                    
                                       0
                                    
                                 
                                 ⊆
                                 
                                    
                                       V
                                    
                                    
                                       1
                                    
                                 
                                 ⊆
                                 …
                                 ⊆
                                 
                                    
                                       V
                                    
                                    
                                       N
                                    
                                 
                                 .
                              
                           
                         Without loss of generality we will assume that each domain 
                           
                              
                                 Ω
                              
                              
                                 ℓ
                              
                           
                         is the union of supports of a certain subset of the functions in 
                           
                              
                                 G
                              
                              
                                 ℓ
                                 +
                                 1
                              
                           
                        . Considering domain hierarchies without this property does not lead to additional hierarchical generating systems.

In order to prepare the construction of the hierarchical generating systems, we first assume their ordering according to the chosen domain hierarchy. More precisely, such ordering allows for splitting the vectors 
                           
                              
                                 G
                              
                              
                                 ℓ
                              
                           
                         into three sub-vectors 
                           
                              
                                 G
                              
                              
                                 A
                              
                              
                                 ℓ
                              
                           
                        , 
                           
                              
                                 G
                              
                              
                                 B
                              
                              
                                 ℓ
                              
                           
                        , 
                           
                              
                                 G
                              
                              
                                 C
                              
                              
                                 ℓ
                              
                           
                         with dimensions 
                           
                              
                                 n
                              
                              
                                 A
                              
                              
                                 ℓ
                              
                           
                        , 
                           
                              
                                 n
                              
                              
                                 B
                              
                              
                                 ℓ
                              
                           
                        , 
                           
                              
                                 n
                              
                              
                                 C
                              
                              
                                 ℓ
                              
                           
                        , respectively. The sub-vectors are defined as follows:
                           
                              (8)
                              
                                 
                                    
                                       G
                                    
                                    
                                       ℓ
                                    
                                 
                                 =
                                 
                                    
                                       (
                                       
                                          
                                             γ
                                          
                                          
                                             i
                                          
                                          
                                             ℓ
                                          
                                       
                                       )
                                    
                                    
                                       i
                                       =
                                       1
                                       ,
                                       …
                                       ,
                                       
                                          
                                             n
                                          
                                          
                                             ℓ
                                          
                                       
                                    
                                 
                                 =
                                 
                                    (
                                    
                                       
                                          
                                             
                                                
                                                   G
                                                
                                                
                                                   A
                                                
                                                
                                                   ℓ
                                                
                                             
                                          
                                       
                                       
                                          
                                             
                                                
                                                   G
                                                
                                                
                                                   B
                                                
                                                
                                                   ℓ
                                                
                                             
                                          
                                       
                                       
                                          
                                             
                                                
                                                   G
                                                
                                                
                                                   C
                                                
                                                
                                                   ℓ
                                                
                                             
                                          
                                       
                                    
                                    )
                                 
                                 =
                                 
                                    (
                                    
                                       
                                          
                                             
                                                
                                                   (
                                                   
                                                      
                                                         γ
                                                      
                                                      
                                                         i
                                                      
                                                      
                                                         ℓ
                                                      
                                                   
                                                   )
                                                
                                                
                                                   i
                                                   =
                                                   1
                                                   ,
                                                   …
                                                   ,
                                                   
                                                      
                                                         n
                                                      
                                                      
                                                         A
                                                      
                                                      
                                                         ℓ
                                                      
                                                   
                                                
                                             
                                          
                                       
                                       
                                          
                                             
                                                
                                                   (
                                                   
                                                      
                                                         γ
                                                      
                                                      
                                                         i
                                                      
                                                      
                                                         ℓ
                                                      
                                                   
                                                   )
                                                
                                                
                                                   i
                                                   =
                                                   
                                                      
                                                         n
                                                      
                                                      
                                                         A
                                                      
                                                      
                                                         ℓ
                                                      
                                                   
                                                   +
                                                   1
                                                   ,
                                                   …
                                                   ,
                                                   
                                                      
                                                         n
                                                      
                                                      
                                                         A
                                                      
                                                      
                                                         ℓ
                                                      
                                                   
                                                   +
                                                   
                                                      
                                                         n
                                                      
                                                      
                                                         B
                                                      
                                                      
                                                         ℓ
                                                      
                                                   
                                                
                                             
                                          
                                       
                                       
                                          
                                             
                                                
                                                   (
                                                   
                                                      
                                                         γ
                                                      
                                                      
                                                         i
                                                      
                                                      
                                                         ℓ
                                                      
                                                   
                                                   )
                                                
                                                
                                                   i
                                                   =
                                                   
                                                      
                                                         n
                                                      
                                                      
                                                         A
                                                      
                                                      
                                                         ℓ
                                                      
                                                   
                                                   +
                                                   
                                                      
                                                         n
                                                      
                                                      
                                                         B
                                                      
                                                      
                                                         ℓ
                                                      
                                                   
                                                   +
                                                   1
                                                   ,
                                                   …
                                                   ,
                                                   
                                                      
                                                         n
                                                      
                                                      
                                                         A
                                                      
                                                      
                                                         ℓ
                                                      
                                                   
                                                   +
                                                   
                                                      
                                                         n
                                                      
                                                      
                                                         B
                                                      
                                                      
                                                         ℓ
                                                      
                                                   
                                                   +
                                                   
                                                      
                                                         n
                                                      
                                                      
                                                         C
                                                      
                                                      
                                                         ℓ
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                    )
                                 
                              
                           
                         such that
                           
                              (9)
                              
                                 
                                    
                                       
                                          i
                                          ≤
                                          
                                             
                                                n
                                             
                                             
                                                A
                                             
                                             
                                                ℓ
                                             
                                          
                                       
                                       
                                          ⇔
                                       
                                       
                                          supp
                                          
                                          
                                             
                                                γ
                                             
                                             
                                                i
                                             
                                             
                                                ℓ
                                             
                                          
                                          ⊈
                                          
                                             
                                                Ω
                                             
                                             
                                                ℓ
                                             
                                          
                                          ,
                                       
                                    
                                    
                                       
                                          i
                                          >
                                          
                                             
                                                n
                                             
                                             
                                                A
                                             
                                             
                                                ℓ
                                             
                                          
                                          +
                                          
                                             
                                                n
                                             
                                             
                                                B
                                             
                                             
                                                ℓ
                                             
                                          
                                       
                                       
                                          ⇔
                                       
                                       
                                          supp
                                          
                                          
                                             
                                                γ
                                             
                                             
                                                i
                                             
                                             
                                                ℓ
                                             
                                          
                                          ⊆
                                          
                                             
                                                Ω
                                             
                                             
                                                ℓ
                                                +
                                                1
                                             
                                          
                                          ,
                                           and 
                                       
                                    
                                    
                                       
                                          
                                             
                                                n
                                             
                                             
                                                ℓ
                                             
                                          
                                       
                                       
                                          =
                                       
                                       
                                          
                                             
                                                n
                                             
                                             
                                                A
                                             
                                             
                                                ℓ
                                             
                                          
                                          +
                                          
                                             
                                                n
                                             
                                             
                                                B
                                             
                                             
                                                ℓ
                                             
                                          
                                          +
                                          
                                             
                                                n
                                             
                                             
                                                C
                                             
                                             
                                                ℓ
                                             
                                          
                                          .
                                       
                                    
                                 
                              
                           
                        If the support of a function 
                           
                              
                                 γ
                              
                              
                                 i
                              
                              
                                 ℓ
                              
                           
                         possesses a non-empty intersection with the ring 
                           
                              
                                 Δ
                              
                              
                                 ℓ
                                 −
                                 1
                              
                           
                        , then it belongs to 
                           
                              
                                 G
                              
                              
                                 A
                              
                              
                                 ℓ
                              
                           
                        . If it possesses a non-empty intersection with 
                           
                              
                                 Δ
                              
                              
                                 ℓ
                              
                           
                        , but not with 
                           
                              
                                 Δ
                              
                              
                                 ℓ
                                 −
                                 1
                              
                           
                        , then it belongs to 
                           
                              
                                 G
                              
                              
                                 B
                              
                              
                                 ℓ
                              
                           
                        . All other functions are elements of 
                           
                              
                                 G
                              
                              
                                 C
                              
                              
                                 ℓ
                              
                           
                        . The partition of 
                           
                              
                                 G
                              
                              
                                 ℓ
                              
                           
                         is shown in Fig. 2
                        . Note that some of these sub-vectors may not be present (void) at certain levels. In particular, 
                           
                              
                                 G
                              
                              
                                 A
                              
                              
                                 0
                              
                           
                         is void, since the supports of all functions are contained in 
                           Ω
                           =
                           
                              
                                 Ω
                              
                              
                                 0
                              
                           
                        , and 
                           
                              
                                 G
                              
                              
                                 C
                              
                              
                                 N
                              
                           
                         are void since 
                           
                              
                                 Ω
                              
                              
                                 N
                                 +
                                 1
                              
                           
                           =
                           ∅
                        .

Since the generating systems form an increasing sequence (7), there exist matrices 
                           
                              
                                 S
                              
                              
                                 ℓ
                                 +
                                 1
                              
                           
                         with non-negative entries, which relate them in terms of Definition 2,
                           
                              (10)
                              
                                 
                                    
                                       G
                                    
                                    
                                       ℓ
                                    
                                 
                                 =
                                 
                                    
                                       S
                                    
                                    
                                       ℓ
                                       +
                                       1
                                    
                                 
                                 
                                 
                                    
                                       G
                                    
                                    
                                       ℓ
                                       +
                                       1
                                    
                                 
                                 ,
                                 
                                 ℓ
                                 =
                                 0
                                 ,
                                 …
                                 ,
                                 N
                                 −
                                 1
                                 .
                              
                           
                         These equations will be called the refinement relations. The matrices are denoted by S because of their relation to subdivision methods (e.g. for box splines).


                        
                           Example 4
                           Subdivision for box splines is already known and has been well studied (de Boor et al., 1993; Prautzsch and Boehm, 2002). We will consider the refinement relation for ZP elements, where a coarse function is a linear combination of twelve functions defined on a finer grid (the supports of some of these finer functions are depicted in Fig. 3
                              ).

We will consider a nested sequence of domains in 
                                 
                                    
                                       R
                                    
                                    
                                       2
                                    
                                 
                               and a nested sequence of generating systems of ZP elements on the grids obtained by refinement steps that split each elementary square into four smaller ones (note that there are two systems of elementary squares on the criss-cross grid). The ZP elements on a grid after ℓ refinement steps are
                                 
                                    
                                       
                                          
                                             φ
                                          
                                          
                                             i
                                          
                                          
                                             ℓ
                                          
                                       
                                       (
                                       x
                                       )
                                       =
                                       φ
                                       
                                          (
                                          
                                             
                                                2
                                             
                                             
                                                ℓ
                                             
                                          
                                          x
                                          −
                                          i
                                          )
                                       
                                       .
                                    
                                 
                               According to the choice of the domain hierarchy we obtain finite index sets 
                                 
                                    
                                       I
                                    
                                    
                                       ℓ
                                    
                                 
                              , such that the functions 
                                 
                                    
                                       φ
                                    
                                    
                                       i
                                    
                                    
                                       ℓ
                                    
                                 
                               do not vanish on Ω for 
                                 i
                                 ∈
                                 
                                    
                                       I
                                    
                                    
                                       ℓ
                                    
                                 
                              . We then define the generating systems
                                 
                                    (11)
                                    
                                       
                                          
                                             G
                                          
                                          
                                             ℓ
                                          
                                       
                                       =
                                       
                                          
                                             (
                                             
                                                
                                                   φ
                                                
                                                
                                                   i
                                                
                                                
                                                   ℓ
                                                
                                             
                                             )
                                          
                                          
                                             i
                                             ∈
                                             
                                                
                                                   I
                                                
                                                
                                                   ℓ
                                                
                                             
                                          
                                       
                                       .
                                    
                                 
                               The coefficients in the refinement relation between a coarse and twelve finer functions are shown in Fig. 4
                              . Note that not all finer functions need to be present at the next level, since some of them might vanish on the domain Ω.  ⋄

Taking (8) into account, we obtain 9 sub-matrices,
                           
                              (12)
                              
                                 
                                    
                                       G
                                    
                                    
                                       ℓ
                                    
                                 
                                 =
                                 
                                    (
                                    
                                       
                                          
                                             
                                                
                                                   G
                                                
                                                
                                                   A
                                                
                                                
                                                   ℓ
                                                
                                             
                                          
                                       
                                       
                                          
                                             
                                                
                                                   G
                                                
                                                
                                                   B
                                                
                                                
                                                   ℓ
                                                
                                             
                                          
                                       
                                       
                                          
                                             
                                                
                                                   G
                                                
                                                
                                                   C
                                                
                                                
                                                   ℓ
                                                
                                             
                                          
                                       
                                    
                                    )
                                 
                                 =
                                 
                                    [
                                    
                                       
                                          
                                             
                                                
                                                   S
                                                
                                                
                                                   A
                                                   A
                                                
                                                
                                                   ℓ
                                                   +
                                                   1
                                                
                                             
                                          
                                          
                                             
                                                
                                                   S
                                                
                                                
                                                   A
                                                   B
                                                
                                                
                                                   ℓ
                                                   +
                                                   1
                                                
                                             
                                          
                                          
                                             
                                                
                                                   S
                                                
                                                
                                                   A
                                                   C
                                                
                                                
                                                   ℓ
                                                   +
                                                   1
                                                
                                             
                                          
                                       
                                       
                                          
                                             
                                                
                                                   S
                                                
                                                
                                                   B
                                                   A
                                                
                                                
                                                   ℓ
                                                   +
                                                   1
                                                
                                             
                                          
                                          
                                             
                                                
                                                   S
                                                
                                                
                                                   B
                                                   B
                                                
                                                
                                                   ℓ
                                                   +
                                                   1
                                                
                                             
                                          
                                          
                                             
                                                
                                                   S
                                                
                                                
                                                   B
                                                   C
                                                
                                                
                                                   ℓ
                                                   +
                                                   1
                                                
                                             
                                          
                                       
                                       
                                          
                                             0
                                          
                                          
                                             
                                                
                                                   S
                                                
                                                
                                                   C
                                                   B
                                                
                                                
                                                   ℓ
                                                   +
                                                   1
                                                
                                             
                                          
                                          
                                             
                                                
                                                   S
                                                
                                                
                                                   C
                                                   C
                                                
                                                
                                                   ℓ
                                                   +
                                                   1
                                                
                                             
                                          
                                       
                                    
                                    ]
                                 
                                 
                                    (
                                    
                                       
                                          
                                             
                                                
                                                   G
                                                
                                                
                                                   A
                                                
                                                
                                                   ℓ
                                                   +
                                                   1
                                                
                                             
                                          
                                       
                                       
                                          
                                             
                                                
                                                   G
                                                
                                                
                                                   B
                                                
                                                
                                                   ℓ
                                                   +
                                                   1
                                                
                                             
                                          
                                       
                                       
                                          
                                             
                                                
                                                   G
                                                
                                                
                                                   C
                                                
                                                
                                                   ℓ
                                                   +
                                                   1
                                                
                                             
                                          
                                       
                                    
                                    )
                                 
                                 =
                                 
                                    
                                       S
                                    
                                    
                                       ℓ
                                       +
                                       1
                                    
                                 
                                 
                                    
                                       G
                                    
                                    
                                       ℓ
                                       +
                                       1
                                    
                                 
                                 .
                              
                           
                         Note that 
                           
                              
                                 S
                              
                              
                                 C
                                 A
                              
                              
                                 ℓ
                                 +
                                 1
                              
                           
                           =
                           0
                         (the null matrix), since the functions in 
                           
                              
                                 G
                              
                              
                                 A
                              
                              
                                 ℓ
                                 +
                                 1
                              
                           
                         cannot contribute to the values of functions in 
                           
                              
                                 G
                              
                              
                                 C
                              
                              
                                 ℓ
                              
                           
                        , cf. Eq. (4).

The following result follows directly from the last row in (12):


                        
                           Lemma 5
                           
                              We may express 
                              
                                 
                                    
                                       G
                                    
                                    
                                       C
                                    
                                    
                                       ℓ
                                    
                                 
                               
                              with respect to all 
                              
                                 
                                    
                                       G
                                    
                                    
                                       B
                                    
                                    
                                       k
                                    
                                 
                              
                              , 
                              
                                 k
                                 ≥
                                 ℓ
                                 +
                                 1
                              
                              ,
                              
                                 
                                    
                                       
                                          
                                             G
                                          
                                          
                                             C
                                          
                                          
                                             ℓ
                                          
                                       
                                       =
                                       
                                          ∑
                                          
                                             k
                                             =
                                             ℓ
                                             +
                                             1
                                          
                                          
                                             N
                                             −
                                             1
                                          
                                       
                                       
                                          (
                                          
                                             ∏
                                             
                                                p
                                                =
                                                ℓ
                                                +
                                                1
                                             
                                             
                                                k
                                                −
                                                1
                                             
                                          
                                          
                                             
                                                S
                                             
                                             
                                                C
                                                C
                                             
                                             
                                                p
                                             
                                          
                                          )
                                       
                                       
                                          
                                             S
                                          
                                          
                                             C
                                             B
                                          
                                          
                                             k
                                          
                                       
                                       
                                          
                                             G
                                          
                                          
                                             B
                                          
                                          
                                             k
                                          
                                       
                                       .
                                    
                                 
                              
                           

We are now ready to describe the selection mechanism of the hierarchy, which generalizes the definition in Vuong et al. (2011) to generating systems.


                        
                           Definition 6
                           The vector of functions
                                 
                                    
                                       K
                                       =
                                       
                                          
                                             (
                                             
                                                
                                                   G
                                                
                                                
                                                   B
                                                
                                                
                                                   ℓ
                                                
                                             
                                             )
                                          
                                          
                                             ℓ
                                             =
                                             0
                                             ,
                                             …
                                             ,
                                             N
                                          
                                       
                                    
                                 
                               is called the hierarchical generating system. Its span is called the hierarchical space.


                        
                           Example 7
                           We consider the hierarchical generating system with respect to generating systems (11) for 
                                 ℓ
                                 =
                                 0
                                 ,
                                 1
                              . The domain hierarchy is depicted in Fig. 5
                              . The selected functions from level 0 and level 1 are denoted by circles that are placed at the associated points. Note that some of these points are not contained in Ω, since we use the center point of the untrimmed supports (not restricted to Ω).  ⋄

In this section we generalize the construction of truncated hierarchical B-splines of Giannelli et al. (2012, 2014) to the case of generating systems. We consider the same setting as in the previous section.

The truncation of a function 
                           f
                           ∈
                           
                              
                                 V
                              
                              
                                 ℓ
                              
                           
                         with respect to the next generating system 
                           
                              
                                 G
                              
                              
                                 ℓ
                                 +
                                 1
                              
                           
                         is based on the following simple observation: The values of f on the ring 
                           
                              
                                 Δ
                              
                              
                                 ℓ
                              
                           
                         are fully determined by its coefficients with respect to 
                           
                              
                                 G
                              
                              
                                 A
                              
                              
                                 ℓ
                                 +
                                 1
                              
                           
                        ,
                           
                              
                                 f
                                 =
                                 
                                    
                                       c
                                    
                                    
                                       A
                                    
                                    
                                       ℓ
                                       +
                                       1
                                    
                                 
                                 
                                    
                                       G
                                    
                                    
                                       A
                                    
                                    
                                       ℓ
                                       +
                                       1
                                    
                                 
                                 +
                                 
                                    
                                       c
                                    
                                    
                                       B
                                    
                                    
                                       ℓ
                                       +
                                       1
                                    
                                 
                                 
                                    
                                       G
                                    
                                    
                                       B
                                    
                                    
                                       ℓ
                                       +
                                       1
                                    
                                 
                                 +
                                 
                                    
                                       c
                                    
                                    
                                       C
                                    
                                    
                                       ℓ
                                       +
                                       1
                                    
                                 
                                 
                                    
                                       G
                                    
                                    
                                       C
                                    
                                    
                                       ℓ
                                       +
                                       1
                                    
                                 
                                 
                                    =
                                    
                                       [
                                       on
                                       
                                       
                                          
                                             Δ
                                          
                                          
                                             ℓ
                                          
                                       
                                       ]
                                    
                                 
                                 
                                    
                                       c
                                    
                                    
                                       A
                                    
                                    
                                       ℓ
                                       +
                                       1
                                    
                                 
                                 
                                    
                                       G
                                    
                                    
                                       A
                                    
                                    
                                       ℓ
                                       +
                                       1
                                    
                                 
                                 .
                              
                           
                         The right-hand side of this equation represents the truncation with respect to generating system 
                           
                              
                                 G
                              
                              
                                 ℓ
                                 +
                                 1
                              
                           
                         and domain 
                           
                              
                                 Ω
                              
                              
                                 ℓ
                                 +
                                 1
                              
                           
                        . It is obtained by removing the contributions of all functions 
                           
                              
                                 γ
                              
                              
                                 i
                              
                              
                                 ℓ
                                 +
                                 1
                              
                           
                         that are selected (i.e. included into the hierarchical generating system 
                           K
                        ), while leaving the values of f on 
                           
                              
                                 Δ
                              
                              
                                 ℓ
                              
                           
                         unchanged. More precisely, we omit the contributions of functions from 
                           
                              
                                 G
                              
                              
                                 B
                              
                              
                                 ℓ
                                 +
                                 1
                              
                           
                         that have been selected directly. Moreover, we also omit the contributions of the functions from 
                           
                              
                                 G
                              
                              
                                 C
                              
                              
                                 ℓ
                                 +
                                 1
                              
                           
                         that have been selected indirectly, as they can be represented by functions that are selected at higher levels, see Lemma 5.

Repeatedly applying truncation to the functions 
                           
                              
                                 G
                              
                              
                                 B
                              
                              
                                 ℓ
                              
                           
                         that were selected for the hierarchical generating system 
                           K
                         gives
                           
                              (13)
                              
                                 
                                    
                                       G
                                    
                                    
                                       B
                                    
                                    
                                       ℓ
                                    
                                 
                                 
                                    =
                                    
                                       [
                                       on
                                       
                                       
                                          
                                             Δ
                                          
                                          
                                             ℓ
                                          
                                       
                                       ]
                                    
                                 
                                 
                                    
                                       S
                                    
                                    
                                       B
                                       A
                                    
                                    
                                       ℓ
                                       +
                                       1
                                    
                                 
                                 
                                    
                                       G
                                    
                                    
                                       A
                                    
                                    
                                       ℓ
                                       +
                                       1
                                    
                                 
                                 
                                    =
                                    
                                       [
                                       on
                                       
                                       
                                          
                                             Δ
                                          
                                          
                                             ℓ
                                             +
                                             1
                                          
                                       
                                       ]
                                    
                                 
                                 
                                    
                                       S
                                    
                                    
                                       B
                                       A
                                    
                                    
                                       ℓ
                                       +
                                       1
                                    
                                 
                                 
                                    
                                       S
                                    
                                    
                                       A
                                       A
                                    
                                    
                                       ℓ
                                       +
                                       2
                                    
                                 
                                 
                                    
                                       G
                                    
                                    
                                       A
                                    
                                    
                                       ℓ
                                       +
                                       2
                                    
                                 
                                 
                                    =
                                    
                                       [
                                       on
                                       
                                       
                                          
                                             Δ
                                          
                                          
                                             ℓ
                                             +
                                             2
                                          
                                       
                                       ]
                                    
                                 
                                 …
                                 
                                    =
                                    
                                       [
                                       on
                                       
                                       
                                          
                                             Δ
                                          
                                          
                                             N
                                          
                                       
                                       ]
                                    
                                 
                                 
                                    
                                       S
                                    
                                    
                                       B
                                       A
                                    
                                    
                                       ℓ
                                       +
                                       1
                                    
                                 
                                 
                                    (
                                    
                                       ∏
                                       
                                          k
                                          =
                                          ℓ
                                          +
                                          2
                                       
                                       N
                                    
                                    
                                       
                                          S
                                       
                                       
                                          A
                                          A
                                       
                                       
                                          k
                                       
                                    
                                    )
                                 
                                 
                                    
                                       G
                                    
                                    
                                       A
                                    
                                    
                                       N
                                    
                                 
                                 ,
                              
                           
                         where we used the refinement equations (12). Finally we obtain the functions
                           
                              (14)
                              
                                 
                                    
                                       T
                                    
                                    
                                       ℓ
                                    
                                 
                                 =
                                 
                                    
                                       S
                                    
                                    
                                       B
                                       A
                                    
                                    
                                       ℓ
                                       +
                                       1
                                    
                                 
                                 
                                    (
                                    
                                       ∏
                                       
                                          k
                                          =
                                          ℓ
                                          +
                                          2
                                       
                                       N
                                    
                                    
                                       
                                          S
                                       
                                       
                                          A
                                          A
                                       
                                       
                                          k
                                       
                                    
                                    )
                                 
                                 
                                    
                                       G
                                    
                                    
                                       A
                                    
                                    
                                       N
                                    
                                 
                                 ,
                                 
                                 ℓ
                                 =
                                 0
                                 ,
                                 …
                                 ,
                                 N
                                 −
                                 1
                                 .
                              
                           
                         Additionally, we define
                           
                              
                                 
                                    
                                       T
                                    
                                    
                                       N
                                    
                                 
                                 =
                                 
                                    
                                       G
                                    
                                    
                                       B
                                    
                                    
                                       N
                                    
                                 
                                 .
                              
                           
                        
                     


                        
                           Definition 8
                           The vector
                                 
                                    
                                       T
                                       =
                                       
                                          
                                             (
                                             
                                                
                                                   T
                                                
                                                
                                                   ℓ
                                                
                                             
                                             )
                                          
                                          
                                             ℓ
                                             =
                                             0
                                             ,
                                             …
                                             ,
                                             N
                                          
                                       
                                    
                                 
                               is called the truncated hierarchical generating system.

Any function 
                           τ
                           ∈
                           
                              
                                 T
                              
                              
                                 ℓ
                              
                           
                         is obtained by repeatedly truncating a function 
                           β
                           ∈
                           
                              
                                 G
                              
                              
                                 B
                              
                              
                                 ℓ
                              
                           
                        . We say that β is the mother of τ and τ is the child of β. Any function 
                           τ
                           ∈
                           
                              
                                 T
                              
                              
                                 ℓ
                              
                           
                         is derived from its corresponding mother 
                           β
                           ∈
                           
                              
                                 G
                              
                              
                                 B
                              
                              
                                 ℓ
                              
                           
                         by subtracting the contributions of functions in finer generating systems whose children are included in the truncated hierarchical generating system. Consequently, the support of 
                           β
                           −
                           τ
                         is contained in 
                           
                              
                                 Ω
                              
                              
                                 ℓ
                                 +
                                 1
                              
                           
                         and
                           
                              
                                 β
                                 
                                    =
                                    
                                       [
                                       on
                                       
                                       
                                          
                                             Δ
                                          
                                          
                                             ℓ
                                          
                                       
                                       ]
                                    
                                 
                                 τ
                                 .
                              
                           
                         Written in vector notation,
                           
                              (15)
                              
                                 
                                    
                                       G
                                    
                                    
                                       B
                                    
                                    
                                       ℓ
                                    
                                 
                                 
                                    =
                                    
                                       [
                                       on
                                       
                                       
                                          
                                             Δ
                                          
                                          
                                             ℓ
                                          
                                       
                                       ]
                                    
                                 
                                 
                                    
                                       T
                                    
                                    
                                       ℓ
                                    
                                 
                                 .
                              
                           
                         Also note that according to (13), the restriction of 
                           
                              
                                 T
                              
                              
                                 ℓ
                              
                           
                         to 
                           
                              
                                 Δ
                              
                              
                                 p
                              
                           
                         for 
                           p
                           >
                           ℓ
                         can be expressed as
                           
                              (16)
                              
                                 
                                    
                                       T
                                    
                                    
                                       ℓ
                                    
                                 
                                 
                                    =
                                    
                                       [
                                       on
                                       
                                       
                                          
                                             Δ
                                          
                                          
                                             p
                                          
                                       
                                       ]
                                    
                                 
                                 
                                    
                                       S
                                    
                                    
                                       B
                                       A
                                    
                                    
                                       ℓ
                                       +
                                       1
                                    
                                 
                                 
                                    (
                                    
                                       ∏
                                       
                                          r
                                          =
                                          ℓ
                                          +
                                          2
                                       
                                       p
                                    
                                    
                                       
                                          S
                                       
                                       
                                          A
                                          A
                                       
                                       
                                          r
                                       
                                    
                                    )
                                 
                                 
                                    
                                       G
                                    
                                    
                                       A
                                    
                                    
                                       p
                                    
                                 
                                 .
                              
                           
                        
                     


                        
                           Example 9
                           According to the refinement relation described in Example 4 we can truncate the ZP element with respect to higher levels. Fig. 6
                               shows truncation of a function in 
                                 
                                    
                                       G
                                    
                                    
                                       ℓ
                                    
                                 
                               with respect to level 
                                 ℓ
                                 +
                                 1
                              . The boundary of 
                                 
                                    
                                       Ω
                                    
                                    
                                       ℓ
                                       +
                                       1
                                    
                                 
                               is depicted by the dashed line. Fig. 6(b) shows how the support of a function after truncation becomes smaller. A similar observation was made by Giannelli et al. (2012) for the case of truncated hierarchical B-splines.  ⋄

The preservation of coefficients is a useful property of truncated hierarchical generating systems. It has already been described by Giannelli et al. (2014) for the case of bases 
                        
                           
                              G
                           
                           
                              ℓ
                           
                        
                     , but its proof relied heavily on their linear independence. Here we generalize it to the case of generating systems. We observe that it requires an additional compatibility condition (18) between the representations of a function at different levels.


                     
                        Theorem 10
                        Preservation of coefficients


                        
                           Consider a function f that possesses representations of the form
                           
                              
                                 (17)
                                 
                                    f
                                    
                                       =
                                       
                                          [
                                          on
                                          
                                          
                                             
                                                Δ
                                             
                                             
                                                ℓ
                                             
                                          
                                          ]
                                       
                                    
                                    
                                       
                                          c
                                       
                                       
                                          A
                                       
                                       
                                          ℓ
                                       
                                    
                                    
                                       
                                          G
                                       
                                       
                                          A
                                       
                                       
                                          ℓ
                                       
                                    
                                    +
                                    
                                       
                                          c
                                       
                                       
                                          B
                                       
                                       
                                          ℓ
                                       
                                    
                                    
                                       
                                          G
                                       
                                       
                                          B
                                       
                                       
                                          ℓ
                                       
                                    
                                    ,
                                    
                                    ℓ
                                    =
                                    0
                                    ,
                                    …
                                    ,
                                    N
                                    ,
                                 
                              
                            
                           where the coefficients of the different levels satisfy the compatibility conditions
                           
                              
                                 (18)
                                 
                                    
                                       
                                          c
                                       
                                       
                                          A
                                       
                                       
                                          ℓ
                                          +
                                          1
                                       
                                    
                                    =
                                    
                                       
                                          c
                                       
                                       
                                          A
                                       
                                       
                                          ℓ
                                       
                                    
                                    
                                       
                                          S
                                       
                                       
                                          A
                                          A
                                       
                                       
                                          ℓ
                                          +
                                          1
                                       
                                    
                                    +
                                    
                                       
                                          c
                                       
                                       
                                          B
                                       
                                       
                                          ℓ
                                       
                                    
                                    
                                       
                                          S
                                       
                                       
                                          B
                                          A
                                       
                                       
                                          ℓ
                                          +
                                          1
                                       
                                    
                                    ,
                                    
                                    ℓ
                                    =
                                    0
                                    ,
                                    …
                                    ,
                                    N
                                    −
                                    1
                                    .
                                 
                              
                            
                           Then 
                           
                              f
                              ∈
                              span
                              
                              T
                            
                           and
                           
                              
                                 (19)
                                 
                                    f
                                    =
                                    
                                       ∑
                                       
                                          ℓ
                                          =
                                          0
                                       
                                       N
                                    
                                    
                                       
                                          c
                                       
                                       
                                          B
                                       
                                       
                                          ℓ
                                       
                                    
                                    
                                       
                                          T
                                       
                                       
                                          ℓ
                                       
                                    
                                    =
                                    
                                       (
                                       
                                          
                                             c
                                          
                                          
                                             B
                                          
                                          
                                             0
                                          
                                       
                                       ,
                                       
                                          
                                             c
                                          
                                          
                                             B
                                          
                                          
                                             1
                                          
                                       
                                       ,
                                       …
                                       ,
                                       
                                          
                                             c
                                          
                                          
                                             B
                                          
                                          
                                             N
                                          
                                       
                                       )
                                    
                                    T
                                 
                              
                            
                           on the entire domain Ω.
                        

The coefficient corresponding to 
                        τ
                        ∈
                        T
                      is the same as the coefficient associated with its mother 
                        β
                        ∈
                        
                           
                              G
                           
                           
                              B
                           
                           
                              ℓ
                           
                        
                      in the representation (17) of f on 
                        
                           
                              Δ
                           
                           
                              ℓ
                           
                        
                      with respect to 
                        
                           
                              G
                           
                           
                              ℓ
                           
                        
                     . Thus, the truncated hierarchical generating system preserves the coefficients of mother functions.
                  


                     
                        Proof
                        We start with the representation of f at the finest level,
                              
                                 
                                    f
                                    =
                                    
                                       
                                          c
                                       
                                       
                                          A
                                       
                                       
                                          N
                                       
                                    
                                    
                                       
                                          G
                                       
                                       
                                          A
                                       
                                       
                                          N
                                       
                                    
                                    +
                                    
                                       
                                          c
                                       
                                       
                                          B
                                       
                                       
                                          N
                                       
                                    
                                    
                                       
                                          G
                                       
                                       
                                          B
                                       
                                       
                                          N
                                       
                                    
                                    ,
                                 
                              
                            on 
                              
                                 
                                    Δ
                                 
                                 
                                    N
                                 
                              
                              =
                              Ω
                           , where 
                              
                                 
                                    G
                                 
                                 
                                    C
                                 
                                 
                                    N
                                 
                              
                            is not present. Repeatedly using (18) we replace the coefficients 
                              
                                 
                                    c
                                 
                                 
                                    A
                                 
                                 
                                    ℓ
                                 
                              
                            until we arrive at level 
                              ℓ
                              =
                              0
                           ,
                              
                                 
                                    f
                                    =
                                    
                                       
                                          c
                                       
                                       
                                          A
                                       
                                       
                                          N
                                          −
                                          1
                                       
                                    
                                    
                                       
                                          S
                                       
                                       
                                          A
                                          A
                                       
                                       
                                          N
                                       
                                    
                                    
                                       
                                          G
                                       
                                       
                                          A
                                       
                                       
                                          N
                                       
                                    
                                    +
                                    
                                       
                                          c
                                       
                                       
                                          B
                                       
                                       
                                          N
                                          −
                                          1
                                       
                                    
                                    
                                       
                                          S
                                       
                                       
                                          B
                                          A
                                       
                                       
                                          N
                                       
                                    
                                    
                                       
                                          G
                                       
                                       
                                          A
                                       
                                       
                                          N
                                       
                                    
                                    +
                                    
                                       
                                          c
                                       
                                       
                                          B
                                       
                                       
                                          N
                                       
                                    
                                    
                                       
                                          G
                                       
                                       
                                          B
                                       
                                       
                                          N
                                       
                                    
                                    =
                                    
                                       
                                          c
                                       
                                       
                                          A
                                       
                                       
                                          N
                                          −
                                          2
                                       
                                    
                                    
                                       
                                          S
                                       
                                       
                                          A
                                          A
                                       
                                       
                                          N
                                          −
                                          1
                                       
                                    
                                    
                                       
                                          S
                                       
                                       
                                          A
                                          A
                                       
                                       
                                          N
                                       
                                    
                                    
                                       
                                          G
                                       
                                       
                                          A
                                       
                                       
                                          N
                                       
                                    
                                    +
                                    
                                       
                                          c
                                       
                                       
                                          B
                                       
                                       
                                          N
                                          −
                                          2
                                       
                                    
                                    
                                       
                                          S
                                       
                                       
                                          B
                                          A
                                       
                                       
                                          N
                                          −
                                          1
                                       
                                    
                                    
                                       
                                          S
                                       
                                       
                                          A
                                          A
                                       
                                       
                                          N
                                       
                                    
                                    
                                       
                                          G
                                       
                                       
                                          A
                                       
                                       
                                          N
                                       
                                    
                                    +
                                    
                                       
                                          c
                                       
                                       
                                          B
                                       
                                       
                                          N
                                          −
                                          1
                                       
                                    
                                    
                                       
                                          S
                                       
                                       
                                          B
                                          A
                                       
                                       
                                          N
                                       
                                    
                                    
                                       
                                          G
                                       
                                       
                                          A
                                       
                                       
                                          N
                                       
                                    
                                    +
                                    
                                       
                                          c
                                       
                                       
                                          B
                                       
                                       
                                          N
                                       
                                    
                                    
                                       
                                          G
                                       
                                       
                                          B
                                       
                                       
                                          N
                                       
                                    
                                    =
                                    …
                                    =
                                    
                                       ∑
                                       
                                          ℓ
                                          =
                                          0
                                       
                                       
                                          N
                                          −
                                          1
                                       
                                    
                                    
                                       
                                          c
                                       
                                       
                                          B
                                       
                                       
                                          ℓ
                                       
                                    
                                    
                                       (
                                       
                                          
                                             S
                                          
                                          
                                             B
                                             A
                                          
                                          
                                             ℓ
                                             +
                                             1
                                          
                                       
                                       
                                          (
                                          
                                             ∏
                                             
                                                k
                                                =
                                                ℓ
                                                +
                                                2
                                             
                                             N
                                          
                                          
                                             
                                                S
                                             
                                             
                                                A
                                                A
                                             
                                             
                                                k
                                             
                                          
                                          )
                                       
                                       
                                          
                                             G
                                          
                                          
                                             A
                                          
                                          
                                             N
                                          
                                       
                                       )
                                    
                                    +
                                    
                                       
                                          c
                                       
                                       
                                          B
                                       
                                       
                                          N
                                       
                                    
                                    
                                       
                                          G
                                       
                                       
                                          B
                                       
                                       
                                          N
                                       
                                    
                                    .
                                 
                              
                            Note that the last step does not produce a term involving 
                              
                                 
                                    c
                                 
                                 
                                    A
                                 
                                 
                                    0
                                 
                              
                           , since 
                              
                                 
                                    G
                                 
                                 
                                    A
                                 
                                 
                                    0
                                 
                              
                            is not present. The theorem then follows directly from the definition of truncated hierarchical generating system.  □


                     
                        Example 11
                        Due to Theorem 10, the functions in the truncated hierarchical generating system from Example 7 (ZP elements) can be associated with the same (Greville-type) points in the domain. Indeed, we can represent the two coordinate functions, x and y, in all levels by simply choosing the coefficient of each function equal to the coordinates of the associated center point of its support. These coefficients satisfy the compatibility conditions and they are therefore inherited by the truncated hierarchical generating system for any choice of the domain hierarchy. It should be noted that the representations of the coordinate functions are not unique, as ZP elements are not linearly independent. However these Greville-type points are the only ones that give linear precision.  ⋄

The following result describes the relation between the hierarchical generating system 
                        K
                      and the truncated hierarchical generating system 
                        T
                     .


                     
                        Corollary 12
                        
                           The hierarchical generating system 
                           
                              K
                            
                           is coarser than the truncated hierarchical generating system 
                           
                              T
                           
                           , i.e. 
                           
                              K
                              ≺
                              T
                           
                           . Both generating systems span the same space, 
                           
                              span
                              
                              K
                              =
                              span
                              
                              T
                           
                           . The matrix relating them is upper triangular and its diagonal elements are all equal to 1.
                        

Note that 
                        T
                      does not actually span a finer space than 
                        K
                     . Still, 
                        T
                      is “finer” than 
                        K
                      in the sense of relation ≺.


                     
                        Proof
                        Repeatedly using refinement relations (10) allows to derive a similar relation between any two hierarchical generating systems,
                              
                                 
                                    
                                       
                                          G
                                       
                                       
                                          ℓ
                                       
                                    
                                    =
                                    
                                       
                                          P
                                       
                                       
                                          ℓ
                                          ,
                                          k
                                       
                                    
                                    
                                    
                                       
                                          G
                                       
                                       
                                          k
                                       
                                    
                                    ,
                                    
                                    ℓ
                                    =
                                    0
                                    ,
                                    …
                                    ,
                                    N
                                    ;
                                    
                                    k
                                    =
                                    ℓ
                                    ,
                                    …
                                    ,
                                    N
                                    ,
                                 
                              
                            where
                              
                                 
                                    
                                       
                                          P
                                       
                                       
                                          ℓ
                                          ,
                                          k
                                       
                                    
                                    =
                                    
                                       ∏
                                       
                                          i
                                          =
                                          ℓ
                                          +
                                          1
                                       
                                       k
                                    
                                    
                                       
                                          S
                                       
                                       
                                          i
                                       
                                    
                                    
                                    and in particular
                                    
                                    
                                       
                                          P
                                       
                                       
                                          ℓ
                                          ,
                                          ℓ
                                       
                                    
                                    =
                                    I
                                    .
                                 
                              
                            The matrices 
                              
                                 
                                    P
                                 
                                 
                                    ℓ
                                    ,
                                    k
                                 
                              
                            have all non-negative entries. They also possess a block structure of 
                              3
                              ×
                              3
                            matrices analogous to (12), and the blocks will be denoted in a similar way. (However, no blocks vanish in general.) These equations imply
                              
                                 
                                    
                                       
                                          G
                                       
                                       
                                          B
                                       
                                       
                                          ℓ
                                       
                                    
                                    
                                       =
                                       
                                          [
                                          on
                                          
                                          
                                             
                                                Δ
                                             
                                             
                                                k
                                             
                                          
                                          ]
                                       
                                    
                                    
                                       
                                          P
                                       
                                       
                                          B
                                          A
                                       
                                       
                                          ℓ
                                          ,
                                          k
                                       
                                    
                                    
                                    
                                       
                                          G
                                       
                                       
                                          A
                                       
                                       
                                          k
                                       
                                    
                                    +
                                    
                                       
                                          P
                                       
                                       
                                          B
                                          B
                                       
                                       
                                          ℓ
                                          ,
                                          k
                                       
                                    
                                    
                                    
                                       
                                          G
                                       
                                       
                                          B
                                       
                                       
                                          k
                                       
                                    
                                    ,
                                    
                                    k
                                    =
                                    ℓ
                                    ,
                                    …
                                    ,
                                    N
                                    .
                                 
                              
                            In addition, relation (9) gives
                              
                                 
                                    
                                       
                                          G
                                       
                                       
                                          B
                                       
                                       
                                          ℓ
                                       
                                    
                                    
                                       =
                                       
                                          [
                                          on
                                          
                                          
                                             
                                                Δ
                                             
                                             
                                                k
                                             
                                          
                                          ]
                                       
                                    
                                    0
                                    ,
                                    
                                    k
                                    =
                                    0
                                    ,
                                    …
                                    ,
                                    ℓ
                                    −
                                    1
                                    .
                                 
                              
                            The coefficients of 
                              
                                 
                                    G
                                 
                                 
                                    B
                                 
                                 
                                    ℓ
                                 
                              
                            at different levels also satisfy the compatibility condition (18). Consequently, we can use Theorem 10 to derive the relation
                              
                                 
                                    
                                       (
                                       
                                          
                                             
                                                
                                                   
                                                      G
                                                   
                                                   
                                                      B
                                                   
                                                   
                                                      0
                                                   
                                                
                                             
                                          
                                          
                                             
                                                
                                                   
                                                      G
                                                   
                                                   
                                                      B
                                                   
                                                   
                                                      1
                                                   
                                                
                                             
                                          
                                          
                                             
                                                ⋮
                                             
                                          
                                          
                                             
                                                
                                                   
                                                      G
                                                   
                                                   
                                                      B
                                                   
                                                   
                                                      N
                                                      −
                                                      2
                                                   
                                                
                                             
                                          
                                          
                                             
                                                
                                                   
                                                      G
                                                   
                                                   
                                                      B
                                                   
                                                   
                                                      N
                                                      −
                                                      1
                                                   
                                                
                                             
                                          
                                          
                                             
                                                
                                                   
                                                      G
                                                   
                                                   
                                                      B
                                                   
                                                   
                                                      N
                                                   
                                                
                                             
                                          
                                       
                                       )
                                    
                                    =
                                    
                                       [
                                       
                                          
                                             
                                                I
                                             
                                             
                                                
                                                   
                                                      P
                                                   
                                                   
                                                      B
                                                      B
                                                   
                                                   
                                                      0
                                                      ,
                                                      1
                                                   
                                                
                                             
                                             
                                                
                                                   
                                                      P
                                                   
                                                   
                                                      B
                                                      B
                                                   
                                                   
                                                      0
                                                      ,
                                                      2
                                                   
                                                
                                             
                                             
                                                ⋯
                                             
                                             
                                                
                                                   
                                                      P
                                                   
                                                   
                                                      B
                                                      B
                                                   
                                                   
                                                      0
                                                      ,
                                                      N
                                                      −
                                                      1
                                                   
                                                
                                             
                                             
                                                
                                                   
                                                      P
                                                   
                                                   
                                                      B
                                                      B
                                                   
                                                   
                                                      0
                                                      ,
                                                      N
                                                   
                                                
                                             
                                          
                                          
                                             
                                                0
                                             
                                             
                                                I
                                             
                                             
                                                
                                                   
                                                      P
                                                   
                                                   
                                                      B
                                                      B
                                                   
                                                   
                                                      1
                                                      ,
                                                      2
                                                   
                                                
                                             
                                             
                                                ⋯
                                             
                                             
                                                
                                                   
                                                      P
                                                   
                                                   
                                                      B
                                                      B
                                                   
                                                   
                                                      1
                                                      ,
                                                      N
                                                      −
                                                      1
                                                   
                                                
                                             
                                             
                                                
                                                   
                                                      P
                                                   
                                                   
                                                      B
                                                      B
                                                   
                                                   
                                                      1
                                                      ,
                                                      N
                                                   
                                                
                                             
                                          
                                          
                                             
                                                ⋮
                                             
                                             
                                                ⋮
                                             
                                             
                                                ⋱
                                             
                                             
                                             
                                                ⋮
                                             
                                             
                                                ⋮
                                             
                                          
                                          
                                             
                                                0
                                             
                                             
                                                0
                                             
                                             
                                                ⋯
                                             
                                             
                                                I
                                             
                                             
                                                
                                                   
                                                      P
                                                   
                                                   
                                                      B
                                                      B
                                                   
                                                   
                                                      N
                                                      −
                                                      2
                                                      ,
                                                      N
                                                      −
                                                      1
                                                   
                                                
                                             
                                             
                                                
                                                   
                                                      P
                                                   
                                                   
                                                      B
                                                      B
                                                   
                                                   
                                                      N
                                                      −
                                                      2
                                                      ,
                                                      N
                                                   
                                                
                                             
                                          
                                          
                                             
                                                0
                                             
                                             
                                                0
                                             
                                             
                                                ⋯
                                             
                                             
                                                0
                                             
                                             
                                                I
                                             
                                             
                                                
                                                   
                                                      P
                                                   
                                                   
                                                      B
                                                      B
                                                   
                                                   
                                                      N
                                                      −
                                                      1
                                                      ,
                                                      N
                                                   
                                                
                                             
                                          
                                          
                                             
                                                0
                                             
                                             
                                                0
                                             
                                             
                                                ⋯
                                             
                                             
                                                0
                                             
                                             
                                                0
                                             
                                             
                                                I
                                             
                                          
                                       
                                       ]
                                    
                                    
                                       (
                                       
                                          
                                             
                                                
                                                   
                                                      T
                                                   
                                                   
                                                      0
                                                   
                                                
                                             
                                          
                                          
                                             
                                                
                                                   
                                                      T
                                                   
                                                   
                                                      1
                                                   
                                                
                                             
                                          
                                          
                                             
                                                ⋮
                                             
                                          
                                          
                                             
                                                
                                                   
                                                      T
                                                   
                                                   
                                                      N
                                                      −
                                                      2
                                                   
                                                
                                             
                                          
                                          
                                             
                                                
                                                   
                                                      T
                                                   
                                                   
                                                      N
                                                      −
                                                      1
                                                   
                                                
                                             
                                          
                                          
                                             
                                                
                                                   
                                                      T
                                                   
                                                   
                                                      N
                                                   
                                                
                                             
                                          
                                       
                                       )
                                    
                                 
                              
                            between 
                              K
                            and 
                              T
                           , where 0 and I represent null-matrices and identity matrices of the appropriate dimensions. The matrix appearing in this relation is non-negative, thus 
                              K
                              ≺
                              T
                           . Moreover, the matrix is invertible, as it is upper triangular and the diagonal entries are all 1, therefore 
                              span
                              
                              K
                              =
                              span
                              
                              T
                           .  □

As another consequence of the preservation of coefficients, we are able to show that the functions in 
                        T
                      sum up to one:


                     
                        Corollary 13
                        
                           For normalized generating systems 
                           
                              
                                 
                                    G
                                 
                                 
                                    ℓ
                                 
                              
                            
                           the truncated hierarchical generating system 
                           
                              T
                            
                           forms a convex partition of unity, provided that the refinement matrices satisfy the compatibility conditions
                           
                              
                                 
                                    
                                       
                                          1
                                       
                                       
                                          ℓ
                                          +
                                          1
                                       
                                    
                                    =
                                    
                                       
                                          1
                                       
                                       
                                          ℓ
                                       
                                    
                                    
                                    
                                       
                                          S
                                       
                                       
                                          ℓ
                                          +
                                          1
                                       
                                    
                                    ,
                                    
                                    ℓ
                                    =
                                    0
                                    ,
                                    …
                                    ,
                                    N
                                    −
                                    1
                                    .
                                 
                              
                            
                           
                              
                                 
                                    1
                                 
                                 
                                    k
                                 
                              
                            
                           denotes the row vector of dimension 
                           
                              
                                 
                                    n
                                 
                                 
                                    k
                                 
                              
                            
                           with all elements equal to 1.
                        


                     
                        Proof
                        This can be derived using Theorem 10 and considering the representation of the function
                              
                                 
                                    1
                                    =
                                    
                                       
                                          1
                                       
                                       
                                          ℓ
                                       
                                    
                                    
                                       
                                          G
                                       
                                       
                                          ℓ
                                       
                                    
                                    
                                       =
                                       
                                          [
                                          on
                                          
                                          
                                             
                                                Δ
                                             
                                             
                                                ℓ
                                             
                                          
                                          ]
                                       
                                    
                                    
                                       
                                          1
                                       
                                       
                                          A
                                       
                                       
                                          ℓ
                                       
                                    
                                    
                                       
                                          G
                                       
                                       
                                          A
                                       
                                       
                                          ℓ
                                       
                                    
                                    +
                                    
                                       
                                          1
                                       
                                       
                                          B
                                       
                                       
                                          ℓ
                                       
                                    
                                    
                                       
                                          G
                                       
                                       
                                          B
                                       
                                       
                                          ℓ
                                       
                                    
                                 
                              
                            at different levels, where 
                              
                                 
                                    1
                                 
                                 
                                    A
                                 
                                 
                                    ℓ
                                 
                              
                            and 
                              
                                 
                                    1
                                 
                                 
                                    B
                                 
                                 
                                    ℓ
                                 
                              
                            are row vectors consisting entirely of ones and of dimensions 
                              
                                 
                                    n
                                 
                                 
                                    A
                                 
                                 
                                    ℓ
                                 
                              
                            and 
                              
                                 
                                    n
                                 
                                 
                                    B
                                 
                                 
                                    ℓ
                                 
                              
                           , respectively. Moreover, the functions in 
                              T
                            are non-negative, since they are linear combinations of non-negative functions with non-negative coefficients, cf. (14).  □


                     
                        Example 14
                        
                           Fig. 7
                            shows the sum of functions in the hierarchical generating system and the truncated hierarchical generating system constructed with respect to the domain hierarchy in Example 7. Observe that the sum for the hierarchical generating system is not equal to 1, since the functions do not form a partition of unity.  ⋄

We consider two strategies for refining the hierarchical space.
                        
                           •
                           The first approach consists of enlarging each domain 
                                 
                                    
                                       Ω
                                    
                                    
                                       ℓ
                                    
                                 
                               in the domain hierarchy to 
                                 
                                    
                                       
                                          
                                             Ω
                                          
                                          
                                             ˆ
                                          
                                       
                                    
                                    
                                       ℓ
                                    
                                 
                                 ⊇
                                 
                                    
                                       Ω
                                    
                                    
                                       ℓ
                                    
                                 
                               (except for 
                                 
                                    
                                       
                                          
                                             Ω
                                          
                                          
                                             ˆ
                                          
                                       
                                    
                                    
                                       0
                                    
                                 
                                 =
                                 
                                    
                                       Ω
                                    
                                    
                                       0
                                    
                                 
                                 =
                                 Ω
                               that remains unchanged).

The second possibility is to replace each generating system 
                                 
                                    
                                       G
                                    
                                    
                                       ℓ
                                    
                                 
                               by a new system 
                                 
                                    
                                       
                                          
                                             G
                                          
                                          
                                             ˆ
                                          
                                       
                                    
                                    
                                       ℓ
                                    
                                 
                               which is finer with respect to the relation ≺. E.g., in the case of tensor-product B-splines, this can be achieved by knot insertion or degree elevation.


                     
                        Proposition 15
                        
                           Consider two nested domain hierarchies
                           
                              
                                 (20)
                                 
                                    
                                       
                                          
                                             
                                                Ω
                                                =
                                                
                                                   
                                                      Ω
                                                   
                                                   
                                                      0
                                                   
                                                
                                                ⊇
                                                
                                                   
                                                      Ω
                                                   
                                                   
                                                      1
                                                   
                                                
                                                ⊇
                                                ⋯
                                                ⊇
                                                
                                                   
                                                      Ω
                                                   
                                                   
                                                      N
                                                      +
                                                      1
                                                   
                                                
                                                =
                                                ∅
                                             
                                          
                                          
                                             
                                                Ω
                                                =
                                                
                                                   
                                                      
                                                         
                                                            Ω
                                                         
                                                         
                                                            ˆ
                                                         
                                                      
                                                   
                                                   
                                                      0
                                                   
                                                
                                                ⊇
                                                
                                                   
                                                      
                                                         
                                                            Ω
                                                         
                                                         
                                                            ˆ
                                                         
                                                      
                                                   
                                                   
                                                      1
                                                   
                                                
                                                ⊇
                                                ⋯
                                                ⊇
                                                
                                                   
                                                      
                                                         
                                                            Ω
                                                         
                                                         
                                                            ˆ
                                                         
                                                      
                                                   
                                                   
                                                      N
                                                      +
                                                      1
                                                   
                                                
                                                =
                                                ∅
                                             
                                          
                                       
                                       }
                                    
                                    
                                    
                                       with 
                                    
                                    
                                       
                                          Ω
                                       
                                       
                                          ℓ
                                       
                                    
                                    ⊆
                                    
                                       
                                          
                                             
                                                Ω
                                             
                                             
                                                ˆ
                                             
                                          
                                       
                                       
                                          ℓ
                                       
                                    
                                    ,
                                    
                                    ℓ
                                    =
                                    1
                                    ,
                                    …
                                    ,
                                    N
                                 
                              
                            
                           and the hierarchical generating systems defined on them. The second hierarchical generating system is finer than the first one, 
                           
                              K
                              ≺
                              
                                 
                                    K
                                 
                                 
                                    ˆ
                                 
                              
                           
                           .
                        


                     
                        Proof
                        Enlarging the domain hierarchy changes the definitions of sub-vectors 
                              
                                 
                                    G
                                 
                                 
                                    A
                                 
                                 
                                    ℓ
                                 
                              
                           , 
                              
                                 
                                    G
                                 
                                 
                                    B
                                 
                                 
                                    ℓ
                                 
                              
                            and 
                              
                                 
                                    G
                                 
                                 
                                    C
                                 
                                 
                                    ℓ
                                 
                              
                            of 
                              
                                 
                                    G
                                 
                                 
                                    ℓ
                                 
                              
                           . We denote the sub-vectors with respect to the enlarged domain hierarchy by 
                              
                                 
                                    
                                       
                                          G
                                       
                                       
                                          ˆ
                                       
                                    
                                 
                                 
                                    A
                                 
                                 
                                    ℓ
                                 
                              
                           , 
                              
                                 
                                    
                                       
                                          G
                                       
                                       
                                          ˆ
                                       
                                    
                                 
                                 
                                    B
                                 
                                 
                                    ℓ
                                 
                              
                            and 
                              
                                 
                                    
                                       
                                          G
                                       
                                       
                                          ˆ
                                       
                                    
                                 
                                 
                                    C
                                 
                                 
                                    ℓ
                                 
                              
                           . Some of the functions from 
                              
                                 
                                    G
                                 
                                 
                                    A
                                 
                                 
                                    ℓ
                                 
                              
                            may belong to 
                              
                                 
                                    
                                       
                                          G
                                       
                                       
                                          ˆ
                                       
                                    
                                 
                                 
                                    B
                                 
                                 
                                    ℓ
                                 
                              
                            or even to 
                              
                                 
                                    
                                       
                                          G
                                       
                                       
                                          ˆ
                                       
                                    
                                 
                                 
                                    C
                                 
                                 
                                    ℓ
                                 
                              
                           , and some of the functions in 
                              
                                 
                                    G
                                 
                                 
                                    B
                                 
                                 
                                    ℓ
                                 
                              
                            may belong to 
                              
                                 
                                    
                                       
                                          G
                                       
                                       
                                          ˆ
                                       
                                    
                                 
                                 
                                    C
                                 
                                 
                                    ℓ
                                 
                              
                           . The relation between the two sets of sub-vectors can be expressed by a permutation matrix 
                              
                                 
                                    Q
                                 
                                 
                                    ℓ
                                 
                              
                            with 9 sub-matrices 
                              
                                 
                                    Q
                                 
                                 
                                    A
                                    A
                                 
                                 
                                    ℓ
                                 
                              
                              ,
                              
                                 
                                    Q
                                 
                                 
                                    A
                                    B
                                 
                                 
                                    ℓ
                                 
                              
                           , etc.,
                              
                                 (21)
                                 
                                    
                                       
                                          G
                                       
                                       
                                          ℓ
                                       
                                    
                                    =
                                    
                                       (
                                       
                                          
                                             
                                                
                                                   
                                                      G
                                                   
                                                   
                                                      A
                                                   
                                                   
                                                      ℓ
                                                   
                                                
                                             
                                          
                                          
                                             
                                                
                                                   
                                                      G
                                                   
                                                   
                                                      B
                                                   
                                                   
                                                      ℓ
                                                   
                                                
                                             
                                          
                                          
                                             
                                                
                                                   
                                                      G
                                                   
                                                   
                                                      C
                                                   
                                                   
                                                      ℓ
                                                   
                                                
                                             
                                          
                                       
                                       )
                                    
                                    =
                                    
                                       
                                          Q
                                       
                                       
                                          ℓ
                                       
                                    
                                    
                                       
                                          
                                             
                                                G
                                             
                                             
                                                ˆ
                                             
                                          
                                       
                                       
                                          ℓ
                                       
                                    
                                    =
                                    
                                       [
                                       
                                          
                                             
                                                
                                                   
                                                      Q
                                                   
                                                   
                                                      A
                                                      A
                                                   
                                                   
                                                      ℓ
                                                   
                                                
                                             
                                             
                                                
                                                   
                                                      Q
                                                   
                                                   
                                                      A
                                                      B
                                                   
                                                   
                                                      ℓ
                                                   
                                                
                                             
                                             
                                                
                                                   
                                                      Q
                                                   
                                                   
                                                      A
                                                      C
                                                   
                                                   
                                                      ℓ
                                                   
                                                
                                             
                                          
                                          
                                             
                                                0
                                             
                                             
                                                
                                                   
                                                      Q
                                                   
                                                   
                                                      B
                                                      B
                                                   
                                                   
                                                      ℓ
                                                   
                                                
                                             
                                             
                                                
                                                   
                                                      Q
                                                   
                                                   
                                                      B
                                                      C
                                                   
                                                   
                                                      ℓ
                                                   
                                                
                                             
                                          
                                          
                                             
                                                0
                                             
                                             
                                                0
                                             
                                             
                                                
                                                   
                                                      Q
                                                   
                                                   
                                                      C
                                                      C
                                                   
                                                   
                                                      ℓ
                                                   
                                                
                                             
                                          
                                       
                                       ]
                                    
                                    
                                       (
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         
                                                            G
                                                         
                                                         
                                                            ˆ
                                                         
                                                      
                                                   
                                                   
                                                      A
                                                   
                                                   
                                                      ℓ
                                                   
                                                
                                             
                                          
                                          
                                             
                                                
                                                   
                                                      
                                                         
                                                            G
                                                         
                                                         
                                                            ˆ
                                                         
                                                      
                                                   
                                                   
                                                      B
                                                   
                                                   
                                                      ℓ
                                                   
                                                
                                             
                                          
                                          
                                             
                                                
                                                   
                                                      
                                                         
                                                            G
                                                         
                                                         
                                                            ˆ
                                                         
                                                      
                                                   
                                                   
                                                      C
                                                   
                                                   
                                                      ℓ
                                                   
                                                
                                             
                                          
                                       
                                       )
                                    
                                    .
                                 
                              
                            Note that 
                              
                                 
                                    Q
                                 
                                 
                                    B
                                    A
                                 
                                 
                                    ℓ
                                 
                              
                           , 
                              
                                 
                                    Q
                                 
                                 
                                    C
                                    A
                                 
                                 
                                    ℓ
                                 
                              
                            and 
                              
                                 
                                    Q
                                 
                                 
                                    C
                                    B
                                 
                                 
                                    ℓ
                                 
                              
                            are zero matrices, since functions in 
                              
                                 
                                    G
                                 
                                 
                                    B
                                 
                                 
                                    ℓ
                                 
                              
                            cannot be expressed with respect to 
                              
                                 
                                    
                                       
                                          G
                                       
                                       
                                          ˆ
                                       
                                    
                                 
                                 
                                    A
                                 
                                 
                                    ℓ
                                 
                              
                            and functions in 
                              
                                 
                                    G
                                 
                                 
                                    C
                                 
                                 
                                    ℓ
                                 
                              
                            cannot be expressed with respect to 
                              
                                 
                                    
                                       
                                          G
                                       
                                       
                                          ˆ
                                       
                                    
                                 
                                 
                                    B
                                 
                                 
                                    ℓ
                                 
                              
                            and 
                              
                                 
                                    
                                       
                                          G
                                       
                                       
                                          ˆ
                                       
                                    
                                 
                                 
                                    C
                                 
                                 
                                    ℓ
                                 
                              
                           .

We now express each sub-vector 
                              
                                 
                                    G
                                 
                                 
                                    B
                                 
                                 
                                    ℓ
                                 
                              
                            as a non-negative linear combination of the sub-vectors 
                              
                                 
                                    
                                       
                                          G
                                       
                                       
                                          ˆ
                                       
                                    
                                 
                                 
                                    B
                                 
                                 
                                    k
                                 
                              
                           , 
                              k
                              =
                              0
                              ,
                              …
                              ,
                              N
                           . By (21) 
                           
                              
                                 
                                    G
                                 
                                 
                                    B
                                 
                                 
                                    ℓ
                                 
                              
                            can be written as
                              
                                 (22)
                                 
                                    
                                       
                                          G
                                       
                                       
                                          B
                                       
                                       
                                          ℓ
                                       
                                    
                                    =
                                    
                                       
                                          Q
                                       
                                       
                                          B
                                          B
                                       
                                       
                                          ℓ
                                       
                                    
                                    
                                       
                                          
                                             
                                                G
                                             
                                             
                                                ˆ
                                             
                                          
                                       
                                       
                                          B
                                       
                                       
                                          ℓ
                                       
                                    
                                    +
                                    
                                       
                                          Q
                                       
                                       
                                          B
                                          C
                                       
                                       
                                          ℓ
                                       
                                    
                                    
                                       
                                          
                                             
                                                G
                                             
                                             
                                                ˆ
                                             
                                          
                                       
                                       
                                          C
                                       
                                       
                                          ℓ
                                       
                                    
                                    .
                                 
                              
                            Using Lemma 5 we replace 
                              
                                 
                                    
                                       
                                          G
                                       
                                       
                                          ˆ
                                       
                                    
                                 
                                 
                                    C
                                 
                                 
                                    ℓ
                                 
                              
                            in the above equation by
                              
                                 
                                    
                                       
                                          
                                             
                                                G
                                             
                                             
                                                ˆ
                                             
                                          
                                       
                                       
                                          C
                                       
                                       
                                          ℓ
                                       
                                    
                                    =
                                    
                                       ∑
                                       
                                          k
                                          =
                                          ℓ
                                          +
                                          1
                                       
                                       N
                                    
                                    
                                       (
                                       
                                          ∏
                                          
                                             p
                                             =
                                             ℓ
                                             +
                                             1
                                          
                                          
                                             k
                                             −
                                             1
                                          
                                       
                                       
                                          
                                             
                                                
                                                   S
                                                
                                                
                                                   ˆ
                                                
                                             
                                          
                                          
                                             C
                                             C
                                          
                                          
                                             p
                                          
                                       
                                       )
                                    
                                    
                                       
                                          
                                             
                                                S
                                             
                                             
                                                ˆ
                                             
                                          
                                       
                                       
                                          C
                                          B
                                       
                                       
                                          k
                                       
                                    
                                    
                                       
                                          
                                             
                                                G
                                             
                                             
                                                ˆ
                                             
                                          
                                       
                                       
                                          B
                                       
                                       
                                          k
                                       
                                    
                                    ,
                                 
                              
                            where 
                              
                                 
                                    
                                       
                                          S
                                       
                                       
                                          ˆ
                                       
                                    
                                 
                                 
                                    k
                                 
                              
                            denotes the matrix relating the enlarged generating systems 
                              
                                 
                                    
                                       
                                          G
                                       
                                       
                                          ˆ
                                       
                                    
                                 
                                 
                                    k
                                 
                              
                            and 
                              
                                 
                                    
                                       
                                          G
                                       
                                       
                                          ˆ
                                       
                                    
                                 
                                 
                                    k
                                    +
                                    1
                                 
                              
                           . Thus we can write 
                              
                                 
                                    G
                                 
                                 
                                    B
                                 
                                 
                                    ℓ
                                 
                              
                            as a linear combination of 
                              
                                 
                                    
                                       
                                          G
                                       
                                       
                                          ˆ
                                       
                                    
                                 
                                 
                                    B
                                 
                                 
                                    k
                                 
                              
                            with non-negative coefficients for 
                              k
                              =
                              ℓ
                              ,
                              …
                              ,
                              N
                              −
                              1
                           . The matrix connecting 
                              K
                            and 
                              
                                 
                                    K
                                 
                                 
                                    ˆ
                                 
                              
                            has therefore non-negative entries.  □


                     
                        Example 16
                        Consider the domain hierarchy in Example 7, 
                              Ω
                              ⊇
                              
                                 
                                    Ω
                                 
                                 
                                    1
                                 
                              
                              ⊇
                              
                                 
                                    Ω
                                 
                                 
                                    2
                                 
                              
                              =
                              ∅
                           . By enlarging the domains 
                              
                                 
                                    Ω
                                 
                                 
                                    1
                                 
                              
                              ⊂
                              
                                 
                                    
                                       
                                          Ω
                                       
                                       
                                          ˆ
                                       
                                    
                                 
                                 
                                    1
                                 
                              
                            and 
                              
                                 
                                    Ω
                                 
                                 
                                    2
                                 
                              
                              ⊂
                              
                                 
                                    
                                       
                                          Ω
                                       
                                       
                                          ˆ
                                       
                                    
                                 
                                 
                                    2
                                 
                              
                            we obtain a finer hierarchical generating system. Fig. 8
                            shows the new domain hierarchy and the selected functions from level 0, 1 and 2. They are represented by circles. Notice that adding a domain is just a special case of domain enlargement.  ⋄

Second, we consider the possibility of enlarging the generating systems in terms of Definition 2. The proof of Proposition 15 can be extended to cover this situation as well. Indeed, the refinement relations between 
                        
                           
                              G
                           
                           
                              ℓ
                           
                        
                      and 
                        
                           
                              
                                 
                                    G
                                 
                                 
                                    ˆ
                                 
                              
                           
                           
                              ℓ
                           
                        
                      can be written in the same form as in (21). The matrices 
                        
                           
                              Q
                           
                           
                              ℓ
                           
                        
                      in this case, however, are no longer just permutation matrices.


                     
                        Proposition 17
                        
                           Consider two sequences of generating systems
                           
                              
                                 (23)
                                 
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      G
                                                   
                                                   
                                                      0
                                                   
                                                
                                                ≺
                                                
                                                   
                                                      G
                                                   
                                                   
                                                      1
                                                   
                                                
                                                ≺
                                                …
                                                ≺
                                                
                                                   
                                                      G
                                                   
                                                   
                                                      N
                                                   
                                                
                                             
                                          
                                          
                                             
                                                
                                                   
                                                      
                                                         
                                                            G
                                                         
                                                         
                                                            ˆ
                                                         
                                                      
                                                   
                                                   
                                                      0
                                                   
                                                
                                                ≺
                                                
                                                   
                                                      
                                                         
                                                            G
                                                         
                                                         
                                                            ˆ
                                                         
                                                      
                                                   
                                                   
                                                      1
                                                   
                                                
                                                ≺
                                                …
                                                ≺
                                                
                                                   
                                                      
                                                         
                                                            G
                                                         
                                                         
                                                            ˆ
                                                         
                                                      
                                                   
                                                   
                                                      N
                                                   
                                                
                                             
                                          
                                       
                                       }
                                    
                                    
                                    
                                       with 
                                    
                                    
                                       
                                          G
                                       
                                       
                                          ℓ
                                       
                                    
                                    ≺
                                    
                                       
                                          
                                             
                                                G
                                             
                                             
                                                ˆ
                                             
                                          
                                       
                                       
                                          ℓ
                                       
                                    
                                    ,
                                    
                                    ℓ
                                    =
                                    0
                                    ,
                                    …
                                    ,
                                    N
                                    ,
                                 
                              
                            
                           and the hierarchical generating systems defined by them. The second hierarchical generating system is finer than the first one, 
                           
                              K
                              ≺
                              
                                 
                                    K
                                 
                                 
                                    ˆ
                                 
                              
                           
                           .
                        

Note that both propositions also imply that
                        
                           (24)
                           
                              span
                              
                              T
                              =
                              span
                              
                              K
                              ⊆
                              span
                              
                              
                                 
                                    K
                                 
                                 
                                    ˆ
                                 
                              
                              =
                              span
                              
                              
                                 
                                    T
                                 
                                 
                                    ˆ
                                 
                              
                              .
                           
                        
                     
                  


                     
                        Example 18
                        We consider the nested spaces spanned by the generating systems 
                              
                                 
                                    G
                                 
                                 
                                    ℓ
                                 
                              
                            that consist of ZP elements from Example 4. In addition, for each generating system 
                              
                                 
                                    G
                                 
                                 
                                    ℓ
                                 
                              
                           , we consider the Bernstein-Bézier basis 
                              
                                 
                                    
                                       
                                          G
                                       
                                       
                                          ˆ
                                       
                                    
                                 
                                 
                                    ℓ
                                 
                              
                            of 
                              
                                 
                                    C
                                 
                                 
                                    0
                                 
                              
                            quadratic splines on the triangulation defined by the ZP elements of that level. It consists of one function for each vertex and one (additional) function for each edge of the triangulation (this corresponds to the six quadratic Bernstein polynomials for each triangle). When replacing 
                              
                                 
                                    G
                                 
                                 
                                    ℓ
                                 
                              
                            with 
                              
                                 
                                    
                                       
                                          G
                                       
                                       
                                          ˆ
                                       
                                    
                                 
                                 
                                    ℓ
                                 
                              
                            we enlarge the hierarchical space defined by the (truncated) hierarchical generating system 
                              K
                            and 
                              T
                           .  ⋄

The combination of both refinement strategies leads to the following General Enlargement Theorem (GET):


                     
                        Theorem 19
                        General Enlargement Theorem – GET


                        
                           Consider two sequences of hierarchical domains 
                           (20)
                           , two sequences of generating systems 
                           (23) 
                           and the hierarchical generating systems defined by them. Then the second hierarchical generating system is finer than the first one.
                        

The proof follows directly from the previous two propositions. Several remarks on this result are in order.
                        
                           •
                           As a special case, GET covers the case of adding another level to the hierarchy. In particular, one may consider two hierarchies with
                                 
                                    
                                       ∅
                                       =
                                       
                                          
                                             Ω
                                          
                                          
                                             N
                                          
                                       
                                       ⊆
                                       
                                          
                                             
                                                
                                                   Ω
                                                
                                                
                                                   ˆ
                                                
                                             
                                          
                                          
                                             N
                                          
                                       
                                       ≠
                                       ∅
                                       .
                                    
                                 
                               This also proves that the generating systems which are generated by an inductive definition (as used, e.g. in Giannelli et al., 2012) form an increasingly finer sequence.

GET makes it possible to define a hierarchy of hierarchies as follows. Consider a sequence of (truncated) hierarchical generating systems 
                                 
                                    
                                       G
                                    
                                    
                                       k
                                    
                                 
                                 =
                                 
                                    
                                       K
                                    
                                    
                                       k
                                    
                                 
                               (or 
                                 
                                    
                                       G
                                    
                                    
                                       k
                                    
                                 
                                 =
                                 
                                    
                                       T
                                    
                                    
                                       k
                                    
                                 
                              ), 
                                 k
                                 =
                                 0
                                 ,
                                 …
                                 ,
                                 M
                              , such that each of them is generated by a hierarchy of domains 
                                 
                                    
                                       ω
                                    
                                    
                                       k
                                       ,
                                       ℓ
                                    
                                 
                               and a hierarchy of generating systems 
                                 
                                    
                                       g
                                    
                                    
                                       k
                                       ,
                                       ℓ
                                    
                                 
                              , 
                                 ℓ
                                 =
                                 0
                                 ,
                                 …
                                 ,
                                 N
                              . We assume that these hierarchies are all nested,
                                 
                                    (25)
                                    
                                       
                                          
                                             ω
                                          
                                          
                                             k
                                             ,
                                             ℓ
                                          
                                       
                                       ⊆
                                       
                                          
                                             ω
                                          
                                          
                                             k
                                             ,
                                             ℓ
                                             +
                                             1
                                          
                                       
                                       ,
                                       
                                       
                                          
                                             g
                                          
                                          
                                             k
                                             ,
                                             ℓ
                                          
                                       
                                       ≺
                                       
                                          
                                             g
                                          
                                          
                                             k
                                             ,
                                             ℓ
                                             +
                                             1
                                          
                                       
                                       ,
                                       
                                       ℓ
                                       =
                                       0
                                       ,
                                       …
                                       ,
                                       N
                                       −
                                       1
                                       .
                                    
                                 
                               Now, if we consider another global domain hierarchy (5), then we can define a hierarchy of hierarchical spaces. This allows for adaptive refinement in the presence of local features, e.g. surfaces with sharp edges and local 
                                 
                                    
                                       C
                                    
                                    
                                       0
                                    
                                 
                               continuity
                                 2
                              
                              
                                 2
                                 Other techniques for modeling surfaces with sharp features include using T-splines or special subdivision surfaces (Sederberg et al., 2003; Kosinka et al., 2014).
                               (see Example 20), but also for local degree elevation (combinations of adaptive p- and h-refinement).

GET can be extended to truncated hierarchical generating systems, but this requires an additional condition concerning the compatibility of the refinement relations,
                                 
                                    (26)
                                    
                                       
                                          
                                             S
                                          
                                          
                                             ℓ
                                             +
                                             1
                                          
                                       
                                       
                                          
                                             Q
                                          
                                          
                                             ℓ
                                             +
                                             1
                                          
                                       
                                       =
                                       
                                          
                                             Q
                                          
                                          
                                             ℓ
                                          
                                       
                                       
                                          
                                             
                                                
                                                   S
                                                
                                                
                                                   ˆ
                                                
                                             
                                          
                                          
                                             ℓ
                                             +
                                             1
                                          
                                       
                                       
                                       for 
                                       ℓ
                                       =
                                       0
                                       ,
                                       …
                                       ,
                                       N
                                       −
                                       1
                                       .
                                    
                                 
                               Due to space limitations we do not discuss further details. Note that the spaces are nested even without this assumption.


                     
                        Example 20
                        We consider a hierarchical generating system, constructed with respect to nested sequence of two hierarchical B-spline bases 
                              
                                 
                                    K
                                 
                                 
                                    0
                                 
                              
                              ≺
                              
                                 
                                    K
                                 
                                 
                                    1
                                 
                              
                           . Their hierarchical meshes and selected functions are depicted in Fig. 9
                           (a) for 
                              
                                 
                                    K
                                 
                                 
                                    0
                                 
                              
                            and in Fig. 9(b) for 
                              
                                 
                                    K
                                 
                                 
                                    1
                                 
                              
                           . We define a surface as a linear combination of basis functions in 
                              
                                 
                                    K
                                 
                                 
                                    0
                                 
                              
                            with coefficients in 
                              
                                 
                                    R
                                 
                                 
                                    3
                                 
                              
                           . We build a hierarchy of hierarchical spaces to allow for adaptive refinement in a selected region, see Fig. 9.

The hierarchical B-spline basis 
                              
                                 
                                    K
                                 
                                 
                                    0
                                 
                              
                            is obtained from quadratic B-spline bases 
                              
                                 
                                    g
                                 
                                 
                                    0
                                    ,
                                    0
                                 
                              
                              ≺
                              
                                 
                                    g
                                 
                                 
                                    0
                                    ,
                                    1
                                 
                              
                            and domains 
                              
                                 
                                    ω
                                 
                                 
                                    0
                                    ,
                                    0
                                 
                              
                              ⊇
                              
                                 
                                    ω
                                 
                                 
                                    0
                                    ,
                                    1
                                 
                              
                           . Note that 
                              
                                 
                                    g
                                 
                                 
                                    0
                                    ,
                                    1
                                 
                              
                            has a double knot in the middle, which results in a surface with a local sharp feature. More precisely, the smoothness of the surface in this region decreases to 
                              
                                 
                                    C
                                 
                                 
                                    0
                                 
                              
                           .

In order to perform adaptive refinement of this particular surface, we find a finer hierarchical generating system by performing space enlargement while leaving the domains unchanged. In particular, we obtain 
                              
                                 
                                    g
                                 
                                 
                                    0
                                    ,
                                    0
                                 
                              
                              ≺
                              
                                 
                                    g
                                 
                                 
                                    1
                                    ,
                                    0
                                 
                              
                            and 
                              
                                 
                                    g
                                 
                                 
                                    0
                                    ,
                                    1
                                 
                              
                              ≺
                              
                                 
                                    g
                                 
                                 
                                    1
                                    ,
                                    1
                                 
                              
                            by knot insertion. By Theorem 19 we get a nested sequence of hierarchical generating systems 
                              
                                 
                                    K
                                 
                                 
                                    0
                                 
                              
                              ≺
                              
                                 
                                    K
                                 
                                 
                                    1
                                 
                              
                           .

Moreover, we choose a domain hierarchy 
                              Ω
                              ⊇
                              
                                 
                                    Ω
                                 
                                 
                                    1
                                 
                              
                           , where 
                              Ω
                              =
                              
                                 
                                    ω
                                 
                                 
                                    0
                                    ,
                                    0
                                 
                              
                              =
                              
                                 
                                    ω
                                 
                                 
                                    1
                                    ,
                                    0
                                 
                              
                           . The domain 
                              
                                 
                                    Ω
                                 
                                 
                                    1
                                 
                              
                            is shown in Fig. 9 in blue. We construct a hierarchical generating system 
                              K
                            with respect to the domain hierarchy 
                              Ω
                              ⊇
                              
                                 
                                    Ω
                                 
                                 
                                    1
                                 
                              
                            and nested sequence 
                              
                                 
                                    K
                                 
                                 
                                    0
                                 
                              
                              ≺
                              
                                 
                                    K
                                 
                                 
                                    1
                                 
                              
                           . In this special configuration 
                              
                                 
                                    K
                                 
                                 
                                    0
                                 
                              
                            and 
                              
                                 
                                    K
                                 
                                 
                                    1
                                 
                              
                            are even locally linearly independent. Thus, 
                              K
                            is linearly independent.


                           Figs. 9(c) and 9(d) show the selected functions from 
                              
                                 
                                    K
                                 
                                 
                                    0
                                 
                              
                            and 
                              
                                 
                                    K
                                 
                                 
                                    1
                                 
                              
                            with respect to the domains Ω and 
                              
                                 
                                    Ω
                                 
                                 
                                    1
                                 
                              
                           . Figs. 9(e) and 9(f) show the surface before and after local modification. Note that the smoothness of the surface stays the same after modification and the local feature does not extend globally.  ⋄

Clearly, linear independence is a highly desirable property of a generating system, since it is essential for various applications. This section describes how to guarantee it with the help of local linear independence. This approach goes back to the work of Kraft (1997).

Recall that a generating system G is said to be locally linearly independent, if for any open subset 
                        U
                        ⊆
                        Ω
                      all the functions 
                        
                           
                              γ
                           
                           
                              i
                           
                        
                      from G that do not vanish on U are linearly independent on U,
                        
                           (27)
                           
                              ∀
                              j
                              =
                              0
                              ,
                              …
                              ,
                              n
                              :
                              
                              
                                 (
                                 0
                                 
                                    
                                       |
                                    
                                    
                                       U
                                    
                                 
                                 =
                                 
                                    ∑
                                    
                                       i
                                       =
                                       0
                                    
                                    n
                                 
                                 
                                    
                                       c
                                    
                                    
                                       i
                                    
                                 
                                 
                                    
                                       γ
                                    
                                    
                                       i
                                    
                                 
                                 
                                    
                                       |
                                    
                                    
                                       U
                                    
                                 
                                 ∧
                                 
                                    
                                       γ
                                    
                                    
                                       j
                                    
                                 
                                 
                                    
                                       |
                                    
                                    
                                       U
                                    
                                 
                                 ≢
                                 0
                                 
                                    
                                       |
                                    
                                    
                                       U
                                    
                                 
                                 ⇒
                                 
                                    
                                       c
                                    
                                    
                                       j
                                    
                                 
                                 =
                                 0
                                 )
                              
                              .
                           
                        
                      This property allows to conclude linear independence of the hierarchical generating systems and truncated hierarchical generating systems that are derived from domain hierarchies and hierarchies of generating systems.


                     
                        Proposition 21
                        
                           If the generating systems 
                           
                              
                                 
                                    G
                                 
                                 
                                    ℓ
                                 
                              
                            
                           are locally linearly independent, then both the hierarchical generating system 
                           
                              K
                            
                           and the truncated hierarchical generating system 
                           
                              T
                            
                           are linearly independent.
                        

The first proof of this result for hierarchical generating systems is due to Kraft (1997). For the proof in the case for truncated hierarchical generating systems see Giannelli et al. (2012).

Local linear independence is a stronger requirement than linear independence. For instance, while it is known that B-splines are locally linearly independent, the general construction of the hierarchical B-spline basis introduces local dependencies. Even the truncation does not guarantee the absence of local linear dependencies. However, we can maintain the local linear independence of hierarchical B-splines, provided that the underlying spaces and hierarchical domains satisfy further assumptions. For instance, the hierarchical B-splines in Example 20 are locally linearly independent. We plan to perform a more detailed investigation of this issue in the future.

The results of the previous section do not apply to generating systems with linear dependencies. For ZP elements it is known that omitting one function from the generating system restores linear independence. In this section we will show how to extend this observation to the hierarchical setting. More precisely, we formulate assumptions that will allow us to characterize the linear dependencies that are present in the truncated hierarchical generating system. These assumptions are satisfied by ZP elements.

Each generating system G defines a linear mapping from 
                        
                           
                              R
                           
                           
                              n
                           
                        
                      to span
                     G,
                        
                           
                              c
                              ↦
                              c
                              G
                              ,
                              
                              c
                              ∈
                              
                                 
                                    R
                                 
                                 
                                    n
                                 
                              
                              .
                           
                        
                      The kernel of this mapping is the space of all linear dependency relations in G. We denote this space by 
                        L
                        (
                        G
                        )
                     . We show how to find a basis for 
                        L
                        (
                        T
                        )
                     .

We consider a hierarchy of generating systems that possess exactly one linear dependency relation each, i.e. 
                        dim
                        ⁡
                        L
                        (
                        
                           
                              G
                           
                           
                              ℓ
                           
                        
                        )
                        =
                        1
                     . For each generating system 
                        
                           
                              G
                           
                           
                              ℓ
                           
                        
                      there exists a non-trivial row vector 
                        
                           
                              z
                           
                           
                              ℓ
                           
                        
                        =
                        (
                        
                           
                              z
                           
                           
                              1
                           
                           
                              ℓ
                           
                        
                        ,
                        …
                        ,
                        
                           
                              z
                           
                           
                              
                                 
                                    n
                                 
                                 
                                    ℓ
                                 
                              
                           
                           
                              ℓ
                           
                        
                        )
                     , such that 
                        
                           
                              z
                           
                           
                              ℓ
                           
                        
                        
                           
                              G
                           
                           
                              ℓ
                           
                        
                        =
                        0
                     . Moreover, we assume that the linear dependency relation involves all functions, i.e. that all elements of this vector are non-zero.
                  

Applying the refinement relation (10) to the linear dependency relation of 
                        
                           
                              G
                           
                           
                              ℓ
                           
                        
                      produces a representation of the function 
                        f
                        =
                        0
                      with respect to 
                        
                           
                              G
                           
                           
                              ℓ
                              +
                              1
                           
                        
                     . We make the following simplifying assumption:
                        
                           (A1)
                           Applying the refinement relation (10) to the linear dependency relation of 
                                 
                                    
                                       G
                                    
                                    
                                       ℓ
                                    
                                 
                               gives the trivial representation of 
                                 f
                                 =
                                 0
                              , i.e.
                                 
                                    
                                       
                                          
                                             z
                                          
                                          
                                             ℓ
                                          
                                       
                                       
                                          
                                             S
                                          
                                          
                                             ℓ
                                             +
                                             1
                                          
                                       
                                       =
                                       
                                          
                                             O
                                          
                                          
                                             ℓ
                                             +
                                             1
                                          
                                       
                                       ,
                                    
                                 
                               where 
                                 
                                    
                                       S
                                    
                                    
                                       ℓ
                                       +
                                       1
                                    
                                 
                               is the matrix relating 
                                 
                                    
                                       G
                                    
                                    
                                       ℓ
                                    
                                 
                               and 
                                 
                                    
                                       G
                                    
                                    
                                       ℓ
                                       +
                                       1
                                    
                                 
                               in terms of relation ≺ and 
                                 
                                    
                                       O
                                    
                                    
                                       ℓ
                                       +
                                       1
                                    
                                 
                               is a row null vector of dimension 
                                 
                                    
                                       n
                                    
                                    
                                       ℓ
                                       +
                                       1
                                    
                                 
                              .


                     
                        Example 22
                        The generating system of ZP elements possesses one linear dependency relation. The null function can be represented as a linear combination with coefficients in a “chessboard pattern” of alternating coefficients +1 and −1 as shown in Fig. 10
                           . Note that this linear dependency relation involves all functions in the generating system. Moreover, this relation satisfies assumption (A1).  ⋄

Recall that the definition of the truncated hierarchical generating system is based on the hierarchy of domains (5). These define the rings (6). For each generating system 
                        
                           
                              G
                           
                           
                              ℓ
                           
                        
                      we define a connectivity graph 
                        
                           
                              C
                           
                           
                              ℓ
                           
                        
                      as follows:
                        
                           •
                           All elements of 
                                 
                                    
                                       G
                                    
                                    
                                       A
                                    
                                    
                                       ℓ
                                    
                                 
                               and 
                                 
                                    
                                       G
                                    
                                    
                                       B
                                    
                                    
                                       ℓ
                                    
                                 
                               are vertices of 
                                 
                                    
                                       C
                                    
                                    
                                       ℓ
                                    
                                 
                              .

Two different vertices 
                                 
                                    
                                       γ
                                    
                                    
                                       i
                                    
                                    
                                       ℓ
                                    
                                 
                               and 
                                 
                                    
                                       γ
                                    
                                    
                                       j
                                    
                                    
                                       ℓ
                                    
                                 
                               are connected by an edge whenever
                                 
                                    
                                       supp
                                       
                                       
                                          
                                             γ
                                          
                                          
                                             i
                                          
                                          
                                             ℓ
                                          
                                       
                                       ∩
                                       supp
                                       
                                       
                                          
                                             γ
                                          
                                          
                                             j
                                          
                                          
                                             ℓ
                                          
                                       
                                       ∩
                                       
                                          
                                             Δ
                                          
                                          
                                             ℓ
                                          
                                       
                                       ≠
                                       ∅
                                       .
                                    
                                 
                              
                           

We define 
                        
                           
                              G
                           
                           
                              ℓ
                           
                        
                     
                     -connected components of the ring 
                        
                           
                              Δ
                           
                           
                              ℓ
                           
                        
                     ,
                        
                           (28)
                           
                              
                                 
                                    Δ
                                 
                                 
                                    k
                                 
                                 
                                    ℓ
                                 
                              
                              =
                              
                                 ⋃
                                 
                                    
                                       j
                                       =
                                       0
                                       ,
                                       …
                                       ,
                                       
                                          
                                             n
                                          
                                          
                                             ℓ
                                          
                                       
                                    
                                    
                                       
                                          
                                             γ
                                          
                                          
                                             j
                                          
                                          
                                             ℓ
                                          
                                       
                                       ∈
                                       
                                          
                                             C
                                          
                                          
                                             k
                                          
                                          
                                             ℓ
                                          
                                       
                                    
                                 
                              
                              supp
                              
                              
                                 
                                    γ
                                 
                                 
                                    j
                                 
                                 
                                    ℓ
                                 
                              
                              ∩
                              
                                 
                                    Δ
                                 
                                 
                                    ℓ
                                 
                              
                              .
                           
                        
                      Note that each 
                        
                           
                              Δ
                           
                           
                              k
                           
                           
                              ℓ
                           
                        
                      is not necessarily a connected set in 
                        
                           
                              R
                           
                           
                              D
                           
                        
                     . If 
                        j
                        >
                        
                           
                              n
                           
                           
                              A
                           
                           
                              ℓ
                           
                        
                      for all j such that 
                        
                           
                              γ
                           
                           
                              j
                           
                           
                              ℓ
                           
                        
                        ∈
                        
                           
                              C
                           
                           
                              k
                           
                           
                              ℓ
                           
                        
                     , then both 
                        
                           
                              Δ
                           
                           
                              k
                           
                           
                              ℓ
                           
                        
                      and 
                        
                           
                              C
                           
                           
                              k
                           
                           
                              ℓ
                           
                        
                      will be called orphans of level ℓ. Thus, all functions from 
                     
                        
                           
                              G
                           
                           
                              A
                           
                           
                              ℓ
                           
                        
                      
                     vanish (are equal to 0) on an orphan 
                     
                        
                           
                              Δ
                           
                           
                              k
                           
                           
                              ℓ
                           
                        
                     .

We assume a special ordering of the vectors 
                        
                           
                              G
                           
                           
                              ℓ
                           
                        
                      as follows: We order the functions in the sub-vector 
                        
                           
                              G
                           
                           
                              A
                           
                           
                              ℓ
                           
                        
                      with respect to connected components 
                        
                           
                              C
                           
                           
                              k
                           
                           
                              ℓ
                           
                        
                      for 
                        k
                        =
                        1
                        ,
                        …
                        ,
                        
                           
                              M
                           
                           
                              ℓ
                           
                        
                     . Similarly we order the sub-vector 
                        
                           
                              G
                           
                           
                              B
                           
                           
                              ℓ
                           
                        
                     . More precisely, after the ordering we can write 
                        
                           
                              G
                           
                           
                              A
                           
                           
                              ℓ
                           
                        
                      and 
                        
                           
                              G
                           
                           
                              B
                           
                           
                              ℓ
                           
                        
                      as
                        
                           
                              
                                 
                                    G
                                 
                                 
                                    A
                                 
                                 
                                    ℓ
                                 
                              
                              =
                              
                                 
                                    (
                                    
                                       
                                          G
                                       
                                       
                                          A
                                          ,
                                          k
                                       
                                       
                                          ℓ
                                       
                                    
                                    )
                                 
                                 
                                    k
                                    =
                                    1
                                    ,
                                    …
                                    ,
                                    
                                       
                                          M
                                       
                                       
                                          ℓ
                                       
                                    
                                 
                              
                              ,
                              
                              
                                 
                                    G
                                 
                                 
                                    B
                                 
                                 
                                    ℓ
                                 
                              
                              =
                              
                                 
                                    (
                                    
                                       
                                          G
                                       
                                       
                                          B
                                          ,
                                          k
                                       
                                       
                                          ℓ
                                       
                                    
                                    )
                                 
                                 
                                    k
                                    =
                                    1
                                    ,
                                    …
                                    ,
                                    
                                       
                                          M
                                       
                                       
                                          ℓ
                                       
                                    
                                 
                              
                              .
                           
                        
                      Note that some sub-vectors may be void (not present). For instance, 
                        
                           
                              G
                           
                           
                              A
                              ,
                              k
                           
                           
                              ℓ
                           
                        
                      is not present whenever 
                        
                           
                              C
                           
                           
                              k
                           
                           
                              ℓ
                           
                        
                      is an orphan. When considering a linear combination 
                        
                           
                              c
                           
                           
                              ℓ
                           
                        
                        
                        
                           
                              G
                           
                           
                              ℓ
                           
                        
                     , where 
                        
                           
                              c
                           
                           
                              ℓ
                           
                        
                      is the row vector of coefficients, the sub-vectors of coefficients corresponding to 
                        
                           
                              G
                           
                           
                              A
                              ,
                              k
                           
                           
                              ℓ
                           
                        
                      and 
                        
                           
                              G
                           
                           
                              B
                              ,
                              k
                           
                           
                              ℓ
                           
                        
                      will be denoted by 
                        
                           
                              c
                           
                           
                              A
                              ,
                              k
                           
                           
                              ℓ
                           
                        
                      and 
                        
                           
                              c
                           
                           
                              B
                              ,
                              k
                           
                           
                              ℓ
                           
                        
                     , respectively. In particular, this also applies to the coefficients of the global linear dependency relations with coefficients 
                        
                           
                              z
                           
                           
                              ℓ
                           
                        
                     .


                     
                        Example 23
                        We consider the hierarchical B-spline basis, defined with respect to the univariate cubic B-splines over uniform knot vectors. The hierarchy of bases is obtained by dyadic knot insertion and the domain hierarchy is shown in Fig. 11
                           (a). Although connectivity graphs in case of B-splines are irrelevant, since the hierarchical generating system is linearly independent, the example gives the idea how the connectivity graphs are generated.


                           Fig. 11(d) shows the connected components of the connectivity graphs. The functions in 
                              
                                 
                                    G
                                 
                                 
                                    B
                                 
                                 
                                    ℓ
                                 
                              
                            are represented by shaded circles.

First, we consider the level 0. Since 
                              
                                 
                                    G
                                 
                                 
                                    A
                                 
                                 
                                    0
                                 
                              
                            is empty, the connectivity graph at level 0 contains only functions from 
                              
                                 
                                    G
                                 
                                 
                                    B
                                 
                                 
                                    0
                                 
                              
                           . Therefore, every connected component is an orphan. In this particular example, the connectivity graph consists of two components 
                              
                                 
                                    C
                                 
                                 
                                    1
                                 
                                 
                                    0
                                 
                              
                            and 
                              
                                 
                                    C
                                 
                                 
                                    2
                                 
                                 
                                    0
                                 
                              
                           . We obtain two 
                              
                                 
                                    G
                                 
                                 
                                    0
                                 
                              
                           -connected components 
                              
                                 
                                    Δ
                                 
                                 
                                    1
                                 
                                 
                                    0
                                 
                              
                            and 
                              
                                 
                                    Δ
                                 
                                 
                                    2
                                 
                                 
                                    0
                                 
                              
                           , see Fig. 11(b).

Second, we consider level 1. The connectivity graph consists of three connected components. Note that 
                              
                                 
                                    C
                                 
                                 
                                    2
                                 
                                 
                                    1
                                 
                              
                            contains only functions from 
                              
                                 
                                    G
                                 
                                 
                                    B
                                 
                                 
                                    1
                                 
                              
                            and is therefore an orphan. We obtain three 
                              
                                 
                                    G
                                 
                                 
                                    1
                                 
                              
                           -connected components of 
                              
                                 
                                    Δ
                                 
                                 
                                    1
                                 
                              
                            and one of them is an orphan. Note that 
                              
                                 
                                    Δ
                                 
                                 
                                    1
                                 
                                 
                                    1
                                 
                              
                            is not a connected set in 
                              R
                           .

The connectivity graph at level 2 (not shown) has only one connected component, since 
                              
                                 
                                    Δ
                                 
                                 
                                    2
                                 
                              
                              =
                              Ω
                           . It is not an orphan since all functions in 
                              
                                 
                                    G
                                 
                                 
                                    A
                                 
                                 
                                    2
                                 
                              
                            are present.  ⋄

In addition to the assumption (A1) about the linear dependency relations, we will also need an assumption concerning the rings 
                        
                           
                              Δ
                           
                           
                              ℓ
                           
                        
                     .
                        
                           (A2)
                           Each connected component 
                                 
                                    
                                       Δ
                                    
                                    
                                       k
                                    
                                    
                                       ℓ
                                    
                                 
                               of the ring 
                                 
                                    
                                       Δ
                                    
                                    
                                       ℓ
                                    
                                 
                               admits only linear dependency relations that are instances of the global linear dependency relation in 
                                 
                                    
                                       G
                                    
                                    
                                       ℓ
                                    
                                 
                              . More precisely, if
                                 
                                    (29)
                                    
                                       
                                          
                                             c
                                          
                                          
                                             A
                                             ,
                                             k
                                          
                                          
                                             ℓ
                                          
                                       
                                       
                                          
                                             G
                                          
                                          
                                             A
                                             ,
                                             k
                                          
                                          
                                             ℓ
                                          
                                       
                                       +
                                       
                                          
                                             c
                                          
                                          
                                             B
                                             ,
                                             k
                                          
                                          
                                             ℓ
                                          
                                       
                                       
                                          
                                             G
                                          
                                          
                                             B
                                             ,
                                             k
                                          
                                          
                                             ℓ
                                          
                                       
                                       
                                          =
                                          
                                             [
                                             on
                                             
                                             
                                                
                                                   Δ
                                                
                                                
                                                   k
                                                
                                                
                                                   ℓ
                                                
                                             
                                             ]
                                          
                                       
                                       0
                                    
                                 
                               then there exists a scalar ϱ, such that
                                 
                                    
                                       
                                          
                                             c
                                          
                                          
                                             A
                                             ,
                                             k
                                          
                                          
                                             ℓ
                                          
                                       
                                       =
                                       ϱ
                                       
                                          
                                             z
                                          
                                          
                                             A
                                             ,
                                             k
                                          
                                          
                                             ℓ
                                          
                                       
                                       ,
                                       
                                       
                                          
                                             c
                                          
                                          
                                             B
                                             ,
                                             k
                                          
                                          
                                             ℓ
                                          
                                       
                                       =
                                       ϱ
                                       
                                          
                                             z
                                          
                                          
                                             B
                                             ,
                                             k
                                          
                                          
                                             ℓ
                                          
                                       
                                       ,
                                    
                                 
                               where 
                                 
                                    
                                       z
                                    
                                    
                                       A
                                       ,
                                       k
                                    
                                    
                                       ℓ
                                    
                                 
                               and 
                                 
                                    
                                       z
                                    
                                    
                                       B
                                       ,
                                       k
                                    
                                    
                                       ℓ
                                    
                                 
                               are sub-vectors of the vector 
                                 
                                    
                                       z
                                    
                                    
                                       ℓ
                                    
                                 
                              , corresponding to 
                                 
                                    
                                       G
                                    
                                    
                                       A
                                       ,
                                       k
                                    
                                    
                                       ℓ
                                    
                                 
                               and 
                                 
                                    
                                       G
                                    
                                    
                                       B
                                       ,
                                       k
                                    
                                    
                                       ℓ
                                    
                                 
                              .

A linear dependency relation in 
                        T
                      will be represented by a row vector w. Its sub-vector with respect to 
                        
                           
                              T
                           
                           
                              ℓ
                           
                        
                      will be denoted by 
                        
                           
                              u
                           
                           
                              ℓ
                           
                        
                     ,
                        
                           
                              0
                              =
                              w
                              T
                              =
                              
                                 (
                                 
                                    
                                       u
                                    
                                    
                                       0
                                    
                                 
                                 ,
                                 …
                                 ,
                                 
                                    
                                       u
                                    
                                    
                                       N
                                    
                                 
                                 )
                              
                              T
                              =
                              
                                 ∑
                                 
                                    ℓ
                                    =
                                    0
                                 
                                 N
                              
                              
                                 
                                    u
                                 
                                 
                                    ℓ
                                 
                              
                              
                                 
                                    T
                                 
                                 
                                    ℓ
                                 
                              
                              .
                           
                        
                      Moreover, each 
                        
                           
                              u
                           
                           
                              ℓ
                           
                        
                      consists of sub-vectors 
                        
                           
                              u
                           
                           
                              k
                           
                           
                              ℓ
                           
                        
                     , one for each 
                        
                           
                              G
                           
                           
                              ℓ
                           
                        
                     -connected component of the ring 
                        
                           
                              Δ
                           
                           
                              ℓ
                           
                        
                     .

Due to the ordering of 
                        
                           
                              G
                           
                           
                              B
                           
                           
                              ℓ
                           
                        
                      and truncation process (13), 
                        
                           
                              T
                           
                           
                              ℓ
                           
                        
                      consists of 
                        
                           
                              M
                           
                           
                              ℓ
                           
                        
                      sub-vectors 
                        
                           
                              T
                           
                           
                              k
                           
                           
                              ℓ
                           
                        
                      such that
                        
                           
                              
                                 
                                    T
                                 
                                 
                                    ℓ
                                 
                              
                              
                                 =
                                 
                                    [
                                    on
                                    
                                    
                                       
                                          Δ
                                       
                                       
                                          k
                                       
                                       
                                          ℓ
                                       
                                    
                                    ]
                                 
                              
                              
                                 
                                    T
                                 
                                 
                                    k
                                 
                                 
                                    ℓ
                                 
                              
                              .
                           
                        
                      Note that some of the vectors 
                        
                           
                              T
                           
                           
                              k
                           
                           
                              ℓ
                           
                        
                      may be void.

Let K and L be indices, such that 
                        
                           
                              C
                           
                           
                              K
                           
                           
                              L
                           
                        
                      is an orphan. We define a linear dependency relation associated with it,
                        
                           
                              
                                 
                                    w
                                 
                                 
                                    K
                                 
                                 
                                    L
                                 
                              
                              =
                              
                                 (
                                 
                                    
                                       u
                                    
                                    
                                       1
                                    
                                    
                                       0
                                    
                                 
                                 ,
                                 …
                                 ,
                                 
                                    
                                       u
                                    
                                    
                                       
                                          
                                             M
                                          
                                          
                                             0
                                          
                                       
                                    
                                    
                                       0
                                    
                                 
                                 ,
                                 …
                                 ,
                                 
                                    
                                       u
                                    
                                    
                                       1
                                    
                                    
                                       N
                                    
                                 
                                 ,
                                 …
                                 ,
                                 
                                    
                                       u
                                    
                                    
                                       
                                          
                                             M
                                          
                                          
                                             N
                                          
                                       
                                    
                                    
                                       N
                                    
                                 
                                 )
                              
                              ,
                           
                        
                      where
                        
                           (30)
                           
                              
                                 
                                    u
                                 
                                 
                                    k
                                 
                                 
                                    ℓ
                                 
                              
                              =
                              
                                 {
                                 
                                    
                                       
                                          
                                             
                                                z
                                             
                                             
                                                B
                                                ,
                                                k
                                             
                                             
                                                ℓ
                                             
                                          
                                       
                                       
                                          if 
                                          ℓ
                                          =
                                          L
                                           and 
                                          k
                                          =
                                          K
                                          ,
                                       
                                    
                                    
                                       
                                          0
                                       
                                       
                                          otherwise,
                                       
                                    
                                 
                              
                           
                        
                      for 
                        ℓ
                        =
                        0
                        ,
                        …
                        ,
                        N
                      and 
                        k
                        =
                        1
                        ,
                        …
                        ,
                        
                           
                              M
                           
                           
                              ℓ
                           
                        
                     .


                     
                        Lemma 24
                        
                           The vector 
                           
                              
                                 
                                    w
                                 
                                 
                                    K
                                 
                                 
                                    L
                                 
                              
                            
                           represents a linear dependency relation of 
                           
                              T
                           
                           .
                        


                     
                        Proof
                        We consider the representation of 
                              f
                              =
                              0
                            on the ring 
                              
                                 
                                    Δ
                                 
                                 
                                    ℓ
                                 
                              
                            with respect to 
                              
                                 
                                    G
                                 
                                 
                                    ℓ
                                 
                              
                            defined by
                              
                                 (31)
                                 
                                    0
                                    
                                       =
                                       
                                          [
                                          on
                                          
                                          
                                             
                                                Δ
                                             
                                             
                                                k
                                             
                                             
                                                ℓ
                                             
                                          
                                          ]
                                       
                                    
                                    
                                       
                                          O
                                       
                                       
                                          A
                                          ,
                                          k
                                       
                                       
                                          ℓ
                                       
                                    
                                    
                                       
                                          G
                                       
                                       
                                          A
                                          ,
                                          k
                                       
                                       
                                          ℓ
                                       
                                    
                                    +
                                    
                                       
                                          O
                                       
                                       
                                          B
                                          ,
                                          k
                                       
                                       
                                          ℓ
                                       
                                    
                                    
                                       
                                          G
                                       
                                       
                                          B
                                          ,
                                          k
                                       
                                       
                                          ℓ
                                       
                                    
                                 
                              
                            for each connected component 
                              
                                 
                                    C
                                 
                                 
                                    k
                                 
                                 
                                    ℓ
                                 
                              
                           , 
                              k
                              =
                              1
                              ,
                              …
                              ,
                              
                                 
                                    M
                                 
                                 
                                    ℓ
                                 
                              
                           , 
                              k
                              ≠
                              K
                           , 
                              ℓ
                              =
                              0
                              ,
                              …
                              ,
                              N
                           , 
                              ℓ
                              ≠
                              L
                           , and
                              
                                 
                                    0
                                    
                                       =
                                       
                                          [
                                          on
                                          
                                          
                                             
                                                Δ
                                             
                                             
                                                K
                                             
                                             
                                                L
                                             
                                          
                                          ]
                                       
                                    
                                    
                                       
                                          z
                                       
                                       
                                          B
                                          ,
                                          K
                                       
                                       
                                          L
                                       
                                    
                                    
                                    
                                       
                                          G
                                       
                                       
                                          B
                                          ,
                                          K
                                       
                                       
                                          L
                                       
                                    
                                 
                              
                            for the orphan 
                              
                                 
                                    C
                                 
                                 
                                    K
                                 
                                 
                                    L
                                 
                              
                           . Note that representing 0 on the orphan 
                              
                                 
                                    Δ
                                 
                                 
                                    K
                                 
                                 
                                    L
                                 
                              
                            involves only functions from 
                              
                                 
                                    G
                                 
                                 
                                    B
                                 
                                 
                                    L
                                 
                              
                           . Using assumption (A1) we can verify that the compatibility condition (18) is satisfied. The lemma now follows from Theorem 10.  □


                     
                        Theorem 25
                        
                           The set of linear dependencies
                           
                              
                                 (32)
                                 
                                    
                                       {
                                       
                                          
                                             w
                                          
                                          
                                             K
                                          
                                          
                                             L
                                          
                                       
                                       :
                                       L
                                       =
                                       0
                                       ,
                                       …
                                       ,
                                       N
                                       ,
                                       
                                       K
                                       =
                                       0
                                       ,
                                       …
                                       ,
                                       
                                          
                                             M
                                          
                                          
                                             ℓ
                                          
                                       
                                       ,
                                       
                                          
                                             C
                                          
                                          
                                             K
                                          
                                          
                                             L
                                          
                                       
                                        
                                          is an orphan
                                       
                                       }
                                    
                                 
                              
                            
                           is a basis for the space 
                           
                              L
                              (
                              T
                              )
                            
                           of linear dependency relations in 
                           
                              T
                           
                           .
                        


                     
                        Proof
                        According to the previous lemma, each 
                              
                                 
                                    w
                                 
                                 
                                    K
                                 
                                 
                                    L
                                 
                              
                            is a linear dependency relation in 
                              T
                           . Due to 
                              
                                 
                                    G
                                 
                                 
                                    L
                                 
                              
                           -connectivity, the non-zero entries of 
                              
                                 
                                    w
                                 
                                 
                                    K
                                 
                                 
                                    L
                                 
                              
                            have mutually different indices. Therefore, the vectors 
                              
                                 
                                    w
                                 
                                 
                                    K
                                 
                                 
                                    L
                                 
                              
                            are linearly independent.

We show that these linear dependencies span the entire linear space 
                              L
                              (
                              T
                              )
                           . Suppose 
                              w
                              =
                              (
                              
                                 
                                    v
                                 
                                 
                                    0
                                 
                              
                              ,
                              …
                              ,
                              
                                 
                                    v
                                 
                                 
                                    N
                                 
                              
                              )
                            is a linear dependency relation in 
                              T
                           ,
                              
                                 (33)
                                 
                                    0
                                    =
                                    w
                                    T
                                    =
                                    
                                       (
                                       
                                          
                                             v
                                          
                                          
                                             0
                                          
                                       
                                       ,
                                       …
                                       ,
                                       
                                          
                                             v
                                          
                                          
                                             N
                                          
                                       
                                       )
                                    
                                    T
                                    =
                                    
                                       ∑
                                       
                                          ℓ
                                          =
                                          0
                                       
                                       N
                                    
                                    
                                       
                                          v
                                       
                                       
                                          ℓ
                                       
                                    
                                    
                                    
                                       
                                          T
                                       
                                       
                                          ℓ
                                       
                                    
                                    .
                                 
                              
                            We show that w can be expressed as a linear combination of 
                              
                                 
                                    w
                                 
                                 
                                    K
                                 
                                 
                                    L
                                 
                              
                           . We use induction with respect to level ℓ to express w on each ring 
                              
                                 
                                    Δ
                                 
                                 
                                    ℓ
                                 
                              
                           . Starting with the lowest level 
                              ℓ
                              =
                              0
                            we restrict Eq. (33) to each connected component 
                              
                                 
                                    Δ
                                 
                                 
                                    k
                                 
                                 
                                    0
                                 
                              
                           . Using Eq. (15) we obtain
                              
                                 
                                    0
                                    
                                       =
                                       
                                          [
                                          on
                                          
                                          
                                             
                                                Δ
                                             
                                             
                                                k
                                             
                                             
                                                0
                                             
                                          
                                          ]
                                       
                                    
                                    w
                                    T
                                    
                                       =
                                       
                                          [
                                          on
                                          
                                          
                                             
                                                Δ
                                             
                                             
                                                k
                                             
                                             
                                                0
                                             
                                          
                                          ]
                                       
                                    
                                    
                                       
                                          v
                                       
                                       
                                          k
                                       
                                       
                                          0
                                       
                                    
                                    
                                    
                                       
                                          T
                                       
                                       
                                          k
                                       
                                       
                                          0
                                       
                                    
                                    
                                       =
                                       
                                          [
                                          on
                                          
                                          
                                             
                                                Δ
                                             
                                             
                                                k
                                             
                                             
                                                0
                                             
                                          
                                          ]
                                       
                                    
                                    
                                       
                                          v
                                       
                                       
                                          k
                                       
                                       
                                          0
                                       
                                    
                                    
                                       
                                          G
                                       
                                       
                                          B
                                          ,
                                          k
                                       
                                       
                                          0
                                       
                                    
                                    .
                                 
                              
                            Since 
                              
                                 
                                    G
                                 
                                 
                                    0
                                 
                              
                            satisfies assumption (A2), there exists 
                              
                                 
                                    ϱ
                                 
                                 
                                    k
                                 
                                 
                                    0
                                 
                              
                           , such that
                              
                                 (34)
                                 
                                    
                                       
                                          v
                                       
                                       
                                          k
                                       
                                       
                                          0
                                       
                                    
                                    =
                                    
                                       
                                          ϱ
                                       
                                       
                                          k
                                       
                                       
                                          0
                                       
                                    
                                    
                                       
                                          z
                                       
                                       
                                          B
                                          ,
                                          k
                                       
                                       
                                          0
                                       
                                    
                                    =
                                    
                                       
                                          ϱ
                                       
                                       
                                          k
                                       
                                       
                                          0
                                       
                                    
                                    
                                       
                                          u
                                       
                                       
                                          k
                                       
                                       
                                          0
                                       
                                    
                                    .
                                 
                              
                            We now consider 
                              ℓ
                              ≥
                              1
                           . Using Eq. (14) we obtain
                              
                                 
                                    0
                                    =
                                    w
                                    T
                                    
                                       =
                                       
                                          [
                                          on
                                          
                                          
                                             
                                                Δ
                                             
                                             
                                                ℓ
                                             
                                          
                                          ]
                                       
                                    
                                    
                                       
                                          v
                                       
                                       
                                          0
                                       
                                    
                                    
                                       
                                          T
                                       
                                       
                                          0
                                       
                                    
                                    +
                                    …
                                    +
                                    
                                       
                                          v
                                       
                                       
                                          ℓ
                                       
                                    
                                    
                                       
                                          T
                                       
                                       
                                          ℓ
                                       
                                    
                                    
                                       =
                                       
                                          [
                                          on
                                          
                                          
                                             
                                                Δ
                                             
                                             
                                                ℓ
                                             
                                          
                                          ]
                                       
                                    
                                    
                                       ∑
                                       
                                          p
                                          =
                                          0
                                       
                                       
                                          ℓ
                                          −
                                          1
                                       
                                    
                                    
                                       
                                          v
                                       
                                       
                                          p
                                       
                                    
                                    
                                       
                                          S
                                       
                                       
                                          B
                                          A
                                       
                                       
                                          p
                                          +
                                          1
                                       
                                    
                                    
                                       (
                                       
                                          ∏
                                          
                                             r
                                             =
                                             p
                                             +
                                             2
                                          
                                          ℓ
                                       
                                       
                                          
                                             S
                                          
                                          
                                             A
                                             A
                                          
                                          
                                             r
                                          
                                       
                                       )
                                    
                                    
                                       
                                          G
                                       
                                       
                                          A
                                       
                                       
                                          ℓ
                                       
                                    
                                    +
                                    
                                       
                                          v
                                       
                                       
                                          ℓ
                                       
                                    
                                    
                                       
                                          G
                                       
                                       
                                          B
                                       
                                       
                                          ℓ
                                       
                                    
                                    .
                                 
                              
                            By induction, all sub-vectors 
                              
                                 
                                    v
                                 
                                 
                                    k
                                 
                                 
                                    p
                                 
                              
                           , 
                              p
                              <
                              ℓ
                           , can be written as 
                              
                                 
                                    v
                                 
                                 
                                    k
                                 
                                 
                                    p
                                 
                              
                              =
                              
                                 
                                    ϱ
                                 
                                 
                                    k
                                 
                                 
                                    p
                                 
                              
                              
                              
                                 
                                    z
                                 
                                 
                                    B
                                    ,
                                    k
                                 
                                 
                                    p
                                 
                              
                              =
                              
                                 
                                    ϱ
                                 
                                 
                                    k
                                 
                                 
                                    p
                                 
                              
                              
                              
                                 
                                    u
                                 
                                 
                                    k
                                 
                                 
                                    p
                                 
                              
                            whenever 
                              
                                 
                                    Δ
                                 
                                 
                                    k
                                 
                                 
                                    p
                                 
                              
                            is an orphan, and 
                              
                                 
                                    v
                                 
                                 
                                    k
                                 
                                 
                                    p
                                 
                              
                              =
                              
                                 
                                    O
                                 
                                 
                                    T
                                 
                              
                            otherwise. Using assumption (A1) we obtain
                              
                                 
                                    
                                       
                                          v
                                       
                                       
                                          p
                                       
                                    
                                    
                                       
                                          S
                                       
                                       
                                          B
                                          A
                                       
                                       
                                          p
                                          +
                                          1
                                       
                                    
                                    
                                       (
                                       
                                          ∏
                                          
                                             r
                                             =
                                             p
                                             +
                                             2
                                          
                                          ℓ
                                       
                                       
                                          
                                             S
                                          
                                          
                                             A
                                             A
                                          
                                          
                                             r
                                          
                                       
                                       )
                                    
                                    =
                                    
                                       
                                          O
                                       
                                       
                                          A
                                       
                                       
                                          ℓ
                                       
                                    
                                    
                                    for 
                                    p
                                    =
                                    1
                                    ,
                                    …
                                    ,
                                    ℓ
                                    −
                                    1
                                    .
                                 
                              
                            For each 
                              
                                 
                                    G
                                 
                                 
                                    ℓ
                                 
                              
                           -connected component 
                              
                                 
                                    Δ
                                 
                                 
                                    k
                                 
                                 
                                    ℓ
                                 
                              
                            we get
                              
                                 
                                    0
                                    
                                       =
                                       
                                          [
                                          on
                                          
                                          
                                             
                                                Δ
                                             
                                             
                                                k
                                             
                                             
                                                ℓ
                                             
                                          
                                          ]
                                       
                                    
                                    
                                       
                                          O
                                       
                                       
                                          A
                                          ,
                                          k
                                       
                                       
                                          ℓ
                                       
                                    
                                    
                                       
                                          G
                                       
                                       
                                          A
                                          ,
                                          k
                                       
                                       
                                          ℓ
                                       
                                    
                                    +
                                    
                                       
                                          v
                                       
                                       
                                          k
                                       
                                       
                                          ℓ
                                       
                                    
                                    
                                       
                                          G
                                       
                                       
                                          B
                                          ,
                                          k
                                       
                                       
                                          ℓ
                                       
                                    
                                    .
                                 
                              
                            If 
                              
                                 
                                    Δ
                                 
                                 
                                    k
                                 
                                 
                                    ℓ
                                 
                              
                            is not an orphan, then we conclude 
                              
                                 
                                    v
                                 
                                 
                                    k
                                 
                                 
                                    ℓ
                                 
                              
                              =
                              0
                           , since the only non-trivial representation of a null function with respect to 
                              
                                 
                                    G
                                 
                                 
                                    ℓ
                                 
                              
                            involves all functions (we assumed all elements of 
                              
                                 
                                    z
                                 
                                 
                                    ℓ
                                 
                              
                            to be non-zero).

Otherwise, if 
                              
                                 
                                    Δ
                                 
                                 
                                    k
                                 
                                 
                                    ℓ
                                 
                              
                            is an orphan, then 
                              
                                 
                                    G
                                 
                                 
                                    A
                                    ,
                                    k
                                 
                                 
                                    ℓ
                                 
                              
                            is void. According to assumption (A2) there exists a scalar 
                              
                                 
                                    ϱ
                                 
                                 
                                    k
                                 
                                 
                                    ℓ
                                 
                              
                           , such that
                              
                                 
                                    
                                       
                                          v
                                       
                                       
                                          k
                                       
                                       
                                          ℓ
                                       
                                    
                                    =
                                    
                                       
                                          ϱ
                                       
                                       
                                          k
                                       
                                       
                                          ℓ
                                       
                                    
                                    
                                       
                                          z
                                       
                                       
                                          B
                                          ,
                                          k
                                       
                                       
                                          ℓ
                                       
                                    
                                    =
                                    
                                       
                                          ϱ
                                       
                                       
                                          k
                                       
                                       
                                          ℓ
                                       
                                    
                                    
                                       
                                          u
                                       
                                       
                                          k
                                       
                                       
                                          ℓ
                                       
                                    
                                    .
                                 
                              
                            We conclude that any linear dependency relation can be obtained as a linear combination of vectors 
                              
                                 
                                    w
                                 
                                 
                                    K
                                 
                                 
                                    L
                                 
                              
                           , where 
                              
                                 
                                    C
                                 
                                 
                                    K
                                 
                                 
                                    L
                                 
                              
                            is an orphan,
                              
                                 
                                    w
                                    =
                                    
                                       ∑
                                       
                                          
                                             K
                                             ,
                                             L
                                             :
                                             
                                                
                                                   C
                                                
                                                
                                                   K
                                                
                                                
                                                   L
                                                
                                             
                                             
                                             is
                                          
                                          an orphan
                                       
                                    
                                    
                                       
                                          ϱ
                                       
                                       
                                          K
                                       
                                       
                                          L
                                       
                                    
                                    
                                    
                                       
                                          w
                                       
                                       
                                          K
                                       
                                       
                                          L
                                       
                                    
                                    .
                                 
                              
                             □


                     Theorem 25 gives us all linear dependency relations in the truncated hierarchical generating system for certain classes of hierarchies of generating systems, including ZP elements. Consequently, one can restore linear independence by omitting a suitable subset of 
                        T
                     . This observation will be used in the next section.

The authors believe that the approach to restore linear independence can be extended to generating systems that possess linear dependency relations with similar properties, such as other box splines on the criss-cross grid. It would be also of interest to analyze the general case of generating systems with possibly unstructured linear dependencies. A more detailed discussion is beyond the scope of the present paper.

Zwart–Powell elements are a particularly interesting class of box splines on the criss-cross grid, since they combine low degree with 
                        
                           
                              C
                           
                           
                              1
                           
                        
                      smoothness. Based on the theoretical results presented so far we use their truncated hierarchical version to perform surface fitting with adaptive refinement.

Given a set of data (points 
                           (
                           
                              
                                 x
                              
                              
                                 i
                              
                           
                           ,
                           
                              
                                 y
                              
                              
                                 i
                              
                           
                           )
                         with associated values 
                           
                              
                                 f
                              
                              
                                 i
                              
                           
                        , 
                           i
                           =
                           1
                           ,
                           …
                           ,
                           m
                        , for a large number of points m), we iteratively compute a least-squares approximation and perform a refinement procedure until the approximation error becomes smaller than a given tolerance.

In our examples, the points are distributed uniformly in the domain Ω (which is an axis-aligned box) and their number is much larger than the dimension of 
                           span
                           
                           T
                        . In order to simplify the presentation we do not consider any regularization strategy here, which might be needed in order to avoid problems with singular linear systems.
                           3
                        
                        
                           3
                           For instance, such problems would be present if the number of degrees of freedom in certain subset of Ω exceeds the number of data points in that subset.
                         The discussion of such a strategy is beyond the scope of the present paper. Instead, we focus on the issue of adaptive refinement and the elimination of the linear dependencies in the truncated hierarchical generating system.

We consider two different refinement strategies; they will be referred to as relative and full refinement. Moreover, since the computation of the least-squares approximation needs a generating system that is a basis, we have to find linear dependencies in 
                           T
                         and eliminate suitable functions to restore linear independence. Except for this part (step (b) below), our algorithm is similar to the one used by Giannelli et al. (2012):


                        Hierarchical approximation
                        
                           
                              •
                              
                                 Input: an initial domain 
                                    Ω
                                    ⊂
                                    
                                       
                                          R
                                       
                                       
                                          2
                                       
                                    
                                  together with the data set 
                                    (
                                    
                                       
                                          x
                                       
                                       
                                          i
                                       
                                    
                                    ,
                                    
                                       
                                          y
                                       
                                       
                                          i
                                       
                                    
                                    ,
                                    
                                       
                                          f
                                       
                                       
                                          i
                                       
                                    
                                    )
                                 , 
                                    i
                                    =
                                    1
                                    ,
                                    …
                                    ,
                                    m
                                 , which associates real values 
                                    
                                       
                                          f
                                       
                                       
                                          i
                                       
                                    
                                  to a set of points 
                                    (
                                    
                                       
                                          x
                                       
                                       
                                          i
                                       
                                    
                                    ,
                                    
                                       
                                          y
                                       
                                       
                                          i
                                       
                                    
                                    )
                                    ∈
                                    Ω
                                 , a certain tolerance ε, and a maximum value for the number of iteration steps 
                                    
                                       
                                          s
                                       
                                       
                                          max
                                       
                                    
                                 .


                                 Algorithm:
                                 
                                    
                                       (a)
                                       define an initial generating system 
                                             
                                                
                                                   G
                                                
                                                
                                                   0
                                                
                                             
                                           of ZP elements on Ω and initialize 
                                             s
                                             =
                                             0
                                          ;

determine the linear dependency relations in the current truncated hierarchical generating system and restore linear independence by omitting suitably chosen functions from 
                                             T
                                          ; this creates a modified generating system 
                                             
                                                
                                                   T
                                                
                                                
                                                   ⋆
                                                
                                             
                                          .

compute the least squares approximation 
                                             f
                                             =
                                             
                                                
                                                   ∑
                                                
                                                
                                                   φ
                                                   ∈
                                                   
                                                      
                                                         T
                                                      
                                                      
                                                         ⋆
                                                      
                                                   
                                                
                                             
                                             
                                                
                                                   c
                                                
                                                
                                                   φ
                                                
                                             
                                             φ
                                           that minimizes
                                             
                                                (35)
                                                
                                                   
                                                      ∑
                                                      
                                                         i
                                                         =
                                                         0
                                                      
                                                      m
                                                   
                                                   
                                                      
                                                         (
                                                         
                                                            
                                                               f
                                                            
                                                            
                                                               i
                                                            
                                                         
                                                         −
                                                         f
                                                         (
                                                         
                                                            
                                                               x
                                                            
                                                            
                                                               i
                                                            
                                                         
                                                         ,
                                                         
                                                            
                                                               y
                                                            
                                                            
                                                               i
                                                            
                                                         
                                                         )
                                                         )
                                                      
                                                      
                                                         2
                                                      
                                                   
                                                
                                             
                                           with respect to the coefficients of 
                                             
                                                
                                                   T
                                                
                                                
                                                   ⋆
                                                
                                             
                                          ;

if 
                                             max
                                             ⁡
                                             |
                                             
                                                
                                                   f
                                                
                                                
                                                   i
                                                
                                             
                                             −
                                             f
                                             (
                                             
                                                
                                                   x
                                                
                                                
                                                   i
                                                
                                             
                                             ,
                                             
                                                
                                                   y
                                                
                                                
                                                   i
                                                
                                             
                                             )
                                             |
                                             >
                                             ε
                                           and 
                                             s
                                             <
                                             
                                                
                                                   s
                                                
                                                
                                                   max
                                                
                                             
                                          , then set 
                                             s
                                             =
                                             s
                                             +
                                             1
                                           and apply the hierarchical refinement according to the considered refinement strategy; repeat steps (b) and (c); otherwise the algorithm terminates.


                                 Output: The least-squares approximation f expressed in terms of truncated hierarchical generating system of ZP elements so that 
                                    max
                                    ⁡
                                    |
                                    
                                       
                                          f
                                       
                                       
                                          i
                                       
                                    
                                    −
                                    f
                                    (
                                    
                                       
                                          x
                                       
                                       
                                          i
                                       
                                    
                                    ,
                                    
                                       
                                          y
                                       
                                       
                                          i
                                       
                                    
                                    )
                                    |
                                    ≤
                                    ε
                                  or 
                                    s
                                    =
                                    
                                       
                                          s
                                       
                                       
                                          max
                                       
                                    
                                 .

In step (d) we use two different refinement strategies. Both fit into the same black-box procedure.


                        Hierarchical refinement
                        
                           
                              •
                              
                                 Input: the current hierarchical sequence of nested hierarchical domains together with points 
                                    (
                                    
                                       
                                          x
                                       
                                       
                                          i
                                       
                                    
                                    ,
                                    
                                       
                                          y
                                       
                                       
                                          i
                                       
                                    
                                    )
                                  marked for refinement;


                                 Output: a nested sequence of domains 
                                    
                                       
                                          Ω
                                       
                                       
                                          ˆ
                                       
                                    
                                    ⊇
                                    …
                                    ⊇
                                    
                                       
                                          
                                             
                                                Ω
                                             
                                             
                                                ˆ
                                             
                                          
                                       
                                       
                                          N
                                       
                                    
                                 , so that
                                    
                                       (36)
                                       
                                          
                                             
                                                Ω
                                             
                                             
                                                ˆ
                                             
                                          
                                          =
                                          Ω
                                          ,
                                          
                                          
                                             
                                                
                                                   
                                                      Ω
                                                   
                                                   
                                                      ˆ
                                                   
                                                
                                             
                                             
                                                ℓ
                                             
                                          
                                          ⊇
                                          
                                             
                                                Ω
                                             
                                             
                                                ℓ
                                             
                                          
                                          ,
                                          
                                          ℓ
                                          =
                                          1
                                          ,
                                          …
                                          ,
                                          N
                                          ,
                                       
                                    
                                  and the corresponding truncated hierarchical generating system. For each point that is marked for refinement, the level of the domain containing it
                                    
                                       
                                          
                                             max
                                             ℓ
                                          
                                          ⁡
                                          
                                             {
                                             ℓ
                                             |
                                             (
                                             
                                                
                                                   x
                                                
                                                
                                                   i
                                                
                                             
                                             ,
                                             
                                                
                                                   y
                                                
                                                
                                                   i
                                                
                                             
                                             )
                                             ∈
                                             
                                                
                                                   Ω
                                                
                                                
                                                   ℓ
                                                
                                             
                                             }
                                          
                                       
                                    
                                  increases.

The enlargement of the domains in (36) is obtained by adding a suitable number of cells from the neighborhood of each point that is marked for refinement to the corresponding domain. This neighborhood is chosen such that at least one ZP element is added to the corresponding generating system. The domain enlargement is followed by a cleaning step in order to restore the property that the domains are nested in the hierarchy.

We compute the least-squares approximations of the function
                           
                              
                                 f
                                 (
                                 x
                                 ,
                                 y
                                 )
                                 =
                                 
                                    2
                                    
                                       3
                                       exp
                                       ⁡
                                       (
                                       
                                          
                                             
                                                
                                                   (
                                                   3
                                                   x
                                                   −
                                                   5
                                                   )
                                                
                                                
                                                   2
                                                
                                             
                                             +
                                             
                                                
                                                   (
                                                   3
                                                   y
                                                   −
                                                   5
                                                   )
                                                
                                                
                                                   2
                                                
                                             
                                          
                                       
                                       )
                                    
                                 
                                 +
                                 
                                    2
                                    
                                       3
                                       exp
                                       ⁡
                                       (
                                       
                                          
                                             
                                                
                                                   (
                                                   3
                                                   x
                                                   +
                                                   5
                                                   )
                                                
                                                
                                                   2
                                                
                                             
                                             +
                                             
                                                
                                                   (
                                                   3
                                                   y
                                                   +
                                                   5
                                                   )
                                                
                                                
                                                   2
                                                
                                             
                                          
                                       
                                       )
                                    
                                 
                                 +
                                 
                                    2
                                    
                                       3
                                       exp
                                       ⁡
                                       (
                                       
                                          
                                             
                                                
                                                   (
                                                   2
                                                   x
                                                   )
                                                
                                                
                                                   2
                                                
                                             
                                             +
                                             
                                                
                                                   (
                                                   2
                                                   y
                                                   )
                                                
                                                
                                                   2
                                                
                                             
                                          
                                       
                                       )
                                    
                                 
                                 ,
                                 
                                 (
                                 x
                                 ,
                                 y
                                 )
                                 ∈
                                 
                                    
                                       [
                                       −
                                       3
                                       ,
                                       3
                                       ]
                                    
                                    
                                       2
                                    
                                 
                                 ,
                              
                           
                         shown in Fig. 12
                        (a). A similar function was used by Giannelli et al. (2012). We obtained the data by sampling on a uniform grid of size 
                           100
                           ×
                           100
                        . In step (d) we performed hierarchical refinement by considering 
                           5
                           %
                         of the points. The tolerance was chosen as 
                           ε
                           =
                           
                              
                                 10
                              
                              
                                 −
                                 5
                              
                           
                         and we considered 5 steps of refinement. The relative refinement strategy results in the loss of symmetry as it is evident from Fig. 12(f). Due to the loss of 
                           
                              
                                 C
                              
                              
                                 1
                              
                           
                         smoothness around the 3 “peaks”, the refinement is concentrated around them. Table 1
                         provides information concerning the number of degrees of freedom and the resulting error in the five steps of refinement. The error is measured between the fitted surface and the sampled data, that is, on the 
                           100
                           ×
                           100
                         grid.

In the initial configuration (
                           s
                           =
                           0
                        ), the ZP elements possess one linear dependency relation. We recover the linear independence by eliminating the function represented by a circle in the upper left corner in Fig. 12(b). After the first refinement, the domain 
                           
                              
                                 Ω
                              
                              
                                 1
                              
                           
                         splits Ω into two orphans. Thus, we eliminate two functions from level 0, see Fig. 12(c).

Note that we always eliminated functions that are located close to the boundary of the domain Ω. Consequently, the circles representing them are placed outside of Ω, since they are located at the center of the full support (not trimmed by Ω).

Similarly we proceed with the refinement and eliminate four functions after each of the three following refinement steps. In the last step one should note that the connected component of 
                           
                              
                                 Δ
                              
                              
                                 2
                              
                           
                         (red), which is surrounded by 
                           
                              
                                 Δ
                              
                              
                                 3
                              
                           
                         (yellow), is not an orphan, since it is 
                           
                              
                                 G
                              
                              
                                 2
                              
                           
                        -connected to the other parts of 
                           
                              
                                 Δ
                              
                              
                                 2
                              
                           
                        . Similarly, the small yellow spots in the mesh obtained in the last step do not represent additional orphans.

In the second example we considered the function (also used by Giannelli et al., 2012),
                           
                              
                                 f
                                 (
                                 x
                                 ,
                                 y
                                 )
                                 =
                                 
                                    {
                                    
                                       
                                          
                                             1
                                             ,
                                          
                                          
                                             y
                                             −
                                             x
                                             ≥
                                             1
                                             /
                                             2
                                             ,
                                          
                                       
                                       
                                          
                                             2
                                             (
                                             y
                                             −
                                             x
                                             )
                                             ,
                                          
                                          
                                             0
                                             ≤
                                             y
                                             −
                                             x
                                             ≤
                                             1
                                             /
                                             2
                                             ,
                                          
                                       
                                       
                                          
                                             1
                                             /
                                             2
                                             cos
                                             ⁡
                                             (
                                             4
                                             π
                                             
                                                
                                                   q
                                                   (
                                                   x
                                                   ,
                                                   y
                                                   )
                                                
                                             
                                             )
                                             +
                                             1
                                             /
                                             2
                                             ,
                                          
                                          
                                             q
                                             (
                                             x
                                             ,
                                             y
                                             )
                                             ≤
                                             1
                                             /
                                             16
                                             ,
                                          
                                       
                                       
                                          
                                             0
                                             ,
                                          
                                          
                                             otherwise
                                             ,
                                          
                                       
                                    
                                 
                                 
                                 
                                    (
                                    for 
                                    (
                                    x
                                    ,
                                    y
                                    )
                                    ∈
                                    [
                                    0
                                    ,
                                    2
                                    ]
                                    ×
                                    [
                                    0
                                    ,
                                    1
                                    ]
                                    )
                                 
                              
                           
                         where 
                           q
                           (
                           x
                           ,
                           y
                           )
                           =
                           
                              
                                 (
                                 x
                                 −
                                 3
                                 /
                                 2
                                 )
                              
                              
                                 2
                              
                           
                           +
                           
                              
                                 (
                                 y
                                 −
                                 1
                                 /
                                 2
                                 )
                              
                              
                                 2
                              
                           
                        . Again we sampled 
                           100
                           ×
                           100
                         points on a uniform grid. The threshold is now 
                           ε
                           =
                           
                              
                                 10
                              
                              
                                 −
                                 2
                              
                           
                        . The results of the surface approximation are summarized in Table 2
                        . After four steps, the error satisfied the given tolerance and no further refinement was necessary.

Once more, the ZP elements of the initial configuration possess one linear dependency relation. It is eliminated by omitting function in the upper left corner, see Fig. 13
                        (b). In this particular example, the dimension of 
                           L
                           (
                           T
                           )
                         increases by one in each step of refinement, and thus, we omit more and more (suitably chosen) functions.

According to our experience, the second refinement strategy performs better, since it better preserves the symmetry that may be present in the data and it also reduces the error faster than the first one. However, if the error threshold is chosen too small (such that it cannot be reached by using only the maximum number of levels that is specified), then the second strategy may lead to an almost global refinement, and the relative refinement strategy would give better results.

@&#SUMMARY@&#

We extend the framework of truncated hierarchical bases (Giannelli et al., 2012, 2014) to the case of generating systems, where linear dependencies are possible. We formulated a new framework in order to generalize the existing approach to the new setting. It was shown that many of the advantageous properties of truncated hierarchical basis are also present in the new setting. These include the preservation of coefficients, the nested nature of refinement via domain enlargement, and the partition of unity property.

As specific applications we considered hierarchies of hierarchical B-splines and hierarchical Zwart–Powell (ZP) elements, where we performed adaptive surface fitting. This naturally led us to the question how to eliminate the linear dependencies that are inherited by the hierarchical generating system. For ZP elements, and for the class of hierarchical generating systems with similar properties, we obtained a satisfactory answer.

Our future work will be devoted to further applications of the presented theoretical framework. These may include spline surfaces of general topology, general subdivision surfaces, and more general classes of functions with more complicated linear dependency relations.

@&#ACKNOWLEDGEMENTS@&#

The authors have been supported by the European Union through the FP7-grant ITN (Marie Curie Initial Training Networks) INSIST (Integrating Numerical Simulation and Geometric Design Technology), GA no. 289361.

@&#REFERENCES@&#

