@&#MAIN-TITLE@&#A framework for crude oil scheduling in an integrated terminal-refinery system under supply uncertainty

@&#HIGHLIGHTS@&#


               
               
                  
                     
                        
                           
                           We optimize the scheduling of terminal-refinery systems, considering vessel arrivals, available tankage and pipeline pumping.


                        
                        
                           
                           We propose a novel integrated model, considering unloading activities at the terminal and pipeline pumping scheduling.


                        
                        
                           
                           We extend the model to consider the uncertainty in the oil supply availability using two-stage stochastic optimization.


                        
                        
                           
                           We propose a methodology based on historical data, statistical analysis and a method to obtain optimal scenario trees.


                        
                        
                           
                           We validated the proposed methodology considering a real-world case study based on a Brazilian terminal refinery system.


                        
                     
                  
               
            

@&#KEYPHRASES@&#

Stochastic programming

Terminal-refinery system

Crude oil scheduling

Uncertain oil supply

@&#ABSTRACT@&#


               
               
                  Operational decisions for crude oil scheduling activities are determined on a daily basis and have a strong impact on the overall supply chain cost. The challenge is to develop a feasible schedule at a low cost that has a high level of confidence. This paper presents a framework to support decision making in terminal-refinery systems under supply uncertainty. The proposed framework comprises a stochastic optimization model based on mixed-integer linear programming for scheduling a crude oil pipeline connecting a marine terminal to an oil refinery and a method for representing oil supply uncertainty. The scenario generation method aims at generating a minimal number of scenarios while preserving as much as possible of the uncertainty characteristics. The proposed framework was evaluated considering real-world data. The numerical results suggest the efficiency of the framework in providing resilient solutions in terms of feasibility in the face of the inherent uncertainty.
               
            

@&#INTRODUCTION@&#

The world oil industry increasingly faces new challenges with the trend of globalization. Sudden fluctuations in the prices of oil and its products, new limits for exploration and exploitation of oil reserves, a new global awareness regarding environmental conservation, and partnerships between major players in the market are some of the factors that contribute to an increasingly dynamic and competitive environment in the global oil industry. To cope with this new paradigm, companies are compelled to improve their performance throughout the supply chain from the exploration and production of oil to the order placement and delivery of the final products (Yung-Yu, Wen Long, & Taylor, 2005).

For more than fifty years, the oil industry has made intensive use of mathematical programming to support scheduling decisions in refineries, pipelines, and terminals (Ulstein, Nygreen, & Sagli, 2007). The operational decisions made in the day-to-day scheduling of petroleum handling activities have a strong impact on the total cost of the whole supply chain and must therefore be carefully managed. The challenge is to develop a schedule with low costs and a high level of confidence that is feasible for a given time period.

Classically, petroleum scheduling problems involve the selection of crude flows, the allocation of vessels to tanks, the allocation of tanks to crude distillation units (CDU), and the calculation of crude compositions. In most contexts, they can be closely related to batch process scheduling problems. In fact, many researchers have developed models and solution techniques for the petroleum scheduling problem and most of them are based on mixed-integer linear programming (MILP) and mixed-integer nonlinear programming (MINLP). A general classification of the optimization models for batch processes based on the time representation, mass balances, event representation, and objective functions is presented in the works of Méndez, Cerdá, Grossmann, Harjunkoski, and Fahl (2006) and Floudas and Lin (2004).

In the context of managing wider systems comprising, for example, marine terminals and feeding pipelines, the perspectives have to be extended so that these other elements can be included in the planning process. The pioneering work of Lee, Pinto, Grossmann, and Park (1996) approached the problem of inventory management for a refinery that receives its crude oil supply from vessels by means of a MILP optimization model. Thus, it is crucial that the vessel unloading activities are somehow synchronized with the refinery operations, which is not a simple task given the irregular nature of how these two portions of the system operate. However, the best way to guarantee that the complete system operates in sync is to optimize it as a whole, leading to difficult mathematical formulations. This is the main reason that has led several researchers to address this problem. Depending on the characteristics of the system under consideration, it might be necessary to consider aspects such as product quality and time representation that will increase the complexity of the model and thereby jeopardize their applicability to real systems.


                     Wenkai, Hui, Hua, and Tong (2002) presented an MINLP model for the short-term scheduling of oil unloading, storage, and processing. The authors propose successive reformulations to convert the initial model into an MILP model, which could be solved more efficiently. Más and Pinto (2003) proposed an MILP model to address the problem in a distribution complex containing ports, refineries, and a pipeline infrastructure capable of transferring crude oil between them. Reddy, Karimi, and Srinivasan (2004) proposed an MINLP model considering a multi-CDU refinery and multiple oil suppliers. The authors propose a strategy based on the solution of MILP models considering shorter time periods to avoid nonlinearities. Jia and Ierapetritou (2004) proposed a spatially decomposed approach to the overall problem that considers three portions: the crude oil unloading and blending, production unit operations, and product blending and delivery. Saharidis, Minoux, and Dallery (2009) proposed an MILP model based on a novel event-based time representation for the crude oil unloading and distillation unit charge scheduling in which fewer variables are necessary, thereby enabling the computational performance to be improved. More recently, Chen, Grossmann, and Zheng (2012) presented a wide comparison between alternative formulations for the same problem and proposed improvements for the best-known formulations.

One major difficulty associated with operational planning activities is related to uncertainties inherent in the process, which often compromises the efficiency of the decision support tools that are not able to take uncertainties into consideration. However, despite the potential benefits of considering uncertainty into the scheduling problem, very few works explicitly address this matter. The reason behind this fact is associated with the challenging scale and the computational complexity associated with these models (Escudero, Quintana, & Salmerón, 1999).


                     Li and Ierapetritou (2008) presented a literature review of different approaches for dealing with uncertainty in process scheduling problems and highlighted that there are still a small number of papers that incorporate uncertainties in their studies. Gupta and Zhang (2009) proposed a model that incorporates the uncertainty issue in the availability of crude oil and provides a solution space instead of a single point solution that may help to minimize the loss due to the late or early arrival of vessels. In Wang and Rong (2009), a two-stage robust model was proposed to solve the crude oil scheduling problem under uncertain conditions, such as ship arrival times and fluctuating product demand. Cao, Gu, and Xin (2010) proposed a stochastic chance constrained MINLP model to solve the refinery short-term crude oil scheduling problem under CDU demand uncertainty.

The objective of this study is to propose a framework for solving the problem of oil supply operational planning in petroleum refineries supplied through marine terminals. This problem covers the scheduling of the berthing and unloading activities in the marine terminal, defining the stock levels of the terminal and refinery tanks, and determining the pumping schedule for the pipeline connecting the terminal to the refinery. In addition, the proposed framework must be able to allow for the consideration of the uncertainty in order to provide robustness to the decision process, in particular regarding the variability related to the arrival of the oil supply.

To solve this problem, we propose a two-stage stochastic MILP model that simultaneously defines the scheduling of oil pumping through a pipeline and the sequencing of ships berthing at a terminal at the lowest possible cost. The model also needs to ensure compliance with the refinery demand while assuming that the arrival of the vessels at the terminal is subject to uncertainty. To adherently represent this uncertainty, we propose a framework for generating scenarios for the stochastic model that is based on statistical analysis of historical data, scenario sampling, and a scenario-tree reduction technique originally proposed Heitsch and Römisch, (2003, 2007). Last, we present numerical results derived from the application of this framework into a real-world case study based on a terminal-refinery system located in southern Brazil. These results indicate the adequacy of the proposed approach for the operational planning of the terminal-refinery system, especially concerning the robustness of the proposed schedule.

This paper provides several contributions to the current literature. First, we propose a novel integrated model that considers both the scheduling of berthing and unloading activities at the terminal and the scheduling of pumping activities through a pipeline. To the best of our knowledge, no other model considers this sort of system taking into consideration both problems at once. Second, we extend the model so that the uncertainty in the oil supply availability is taken into account. The consideration of this uncertainty within the proposed model using stochastic optimization is also a novel feature.

This paper is structured as follows. Section 2 gives a detailed description of the main characteristics of the problem that will be considered in the mathematical model, which is given in Section 3. In Section 4, we provide details on the process to represent the uncertainty regarding the arrival of vessels. Section 5 provides numerical experiments showing the benefits of adopting the proposed approach and in Section 6 we present our conclusions.

Oil is often supplied through marine terminals that are connected to petroleum refineries. These terminal-refinery systems are typically connected by pipelines that are used to transfer the oil that is received in the terminal. This integration implies a highly complex operation because of the necessity to coordinate the decisions made at the terminal, the refinery, and the pipeline.

Most of the transformation processes along the petroleum supply chain have a continuous nature. These particular characteristics impose an additional difficulty on managing the oil flow, especially in geographically wide locations. Transportation is usually performed using vessels for long distance travel or dedicated pipelines, which are more cost effective than any other means of transportation for inland oil transportation. However, these pipelines consist of high energy-demanding hardware so their use must be carefully managed.

The key challenge in this type of supply system is guaranteeing synchronization for efficient operations. Synchronizing these decisions is a difficult task because of the conflicting nature of the objectives of the terminal and the refinery. Although it is crucial for the refinery to receive exactly what it needs for the planned production, the terminal operators seek to unload the vessels as soon as possible to avoid demurrage costs.

The flexibility to control the oil flow between the marine terminal and the refinery is provided by the tanks available at each of these locations. These tanks have a limited storage capacity and are responsible for guaranteeing a continuous flow in the refinery and storing the oil supply arriving in the marine terminal.

Uncertainties are inherent in the process because of the dependence between the oil supply and maritime conditions. Maritime transportation and docking activities are subject to weather and ocean stream conditions, which directly impact the arrival time of the vessels and/or the start of unloading activities. This uncertainty concerning when the oil supply will be available in the terminal jeopardizes the possibility of anticipating decisions concerning pumping activities from the terminal to the refinery, which is crucial to achieve efficiency in this context. Other uncertainty sources, such as refinery demand or product prices, are relatively stable in the short-time planning and thus can be considered deterministic in the scheduling of pipeline pumping and vessel berthing activities.

In this paper, we consider a system composed of a refinery, a marine terminal, and a single pipeline connecting both. On the one hand, the refinery acts as a demand point for multiple types of petroleum for which the amounts demanded for each type of oil for a given time period is known. On the other hand, the marine terminal acts as a supplier from which the oil must be sent to the refinery.

The supply is available at the terminal because of the arrival of vessels that transport known amounts of different types of oil. The amounts and types of oil that must be supplied to the refinery are determined at a superior planning level and must be strictly followed. To guarantee tractability of the model, crude quality specifications are not taken into consideration. In this particular problem, this assumption is reasonable because tankage both at the terminal and refinery sites work in a dedicated fashion (i.e., no oil mixture is performed as each tank is dedicated to a specific class of oil). Therefore, we assume that the refinery demand, which is given as an input data, takes into account all quality considerations that must be made according to the demand for petroleum products that the refinery must fulfill. To connect these two elements there is a pipeline that must have its pumping scheduled defined so that the refinery operation is guaranteed. Fig. 1 schematically represents the terminal-refinery system.

The operation of the terminal-refinery system must be planned for a certain period of time. Accordingly, this multi-period problem is considered over a finite time period of size |T|, where T represents the set of discrete time periods of uniform length. The lengths of these time periods must be such that they allow an adherent description of the problem.

To be able to schedule the oil pumping through the pipeline along the planning horizon we divided the pipeline into |L| sections (batches), where L is the set of these uniform-sized batches. A pumping schedule is composed of the definition of what product (in the present context, the terms “product” and “oil” are used inter-changeably throughout the paper and refer to the same entity) will be in what batch at each time period. Due to the similarities between the oils that are pumped through the pipeline and the possibility of performing eventual quality adjustments in the oil at the refinery site if necessary, batch mixing is not relevant in this case and thus neglected in the modeling process. Moreover, operational constraints define the single flow direction and that it is possible to stop the flow at a given time period if desired.

The operation of the pipeline is a high energy-demanding activity. In particular, the operation of the pipeline is such that product movement must be avoided during certain time periods due to the high energy cost. These periods, from 6 p.m.to 10 p.m. on weekdays, are subject to higher rates because of the criticality of the energy supply during this period. A specific contract must be set in advance with the energy provider if the planner would like to operate the pipeline during these critical times; otherwise, the company operating the pipeline is subject to heavy fines. This implies the necessity of having to define in advance the pipeline pumping schedule based on estimated times of arrival (ETA) for the supply vessels. However, due to the uncertainty in the arrival of the vessels, very often the predefined schedule is rendered infeasible, which exposes the whole system to risks concerning the energy supply contracts and the refinery supply. The necessity of emergency basis rescheduling frequently implies using the pipeline during critical times and relying on costly supply alternatives (e.g. spot market acquisitions or transference from other terminal-refinery systems).

In some cases, it might not be possible to completely fulfill the refinery demand at a given time period, which would create severe problems due to the operational characteristics of crude oil refineries. If this is the case, then it will be necessary to obtain additional amounts of oil elsewhere to fully supply the refinery. However, obtaining this additional oil is subject to long lead times that forces these decisions to be taken before the beginning of the planning horizon. In this sense, it is important to know in advance how much additional oil and which type of oil must be made available to the refinery at such a time period so that the planner can take the necessary measures.

The availability of the oil supply at the terminal is uncertain because of deviations in the programmed arrival time of the vessels. This uncertainty is represented by the consideration of |S| discrete scenarios s ∈ S that represent possible deviations in the ETA of each vessel that will arrive at some of the time periods in T. These scenarios will be generated based on historical data and specific statistical methods, which are presented in more detail in Section 4.

To address this problem, we propose a mathematical model for optimizing the integrated planning of the terminal-refinery system, taking into account the operational constraints and the uncertainty concerning the arrival of the vessels. The proposed model is based on two-stage stochastic programming with recourse (Birge & Louveaux, 2011). Typically, two-stage stochastic programming models comprise two types of decisions: the first-stage decision that must be determined prior to the realization of the uncertainty, and the second-stage decisions that represent recourse measures that can be taken after the uncertainty unfolds. The objective is then to minimize both the first-stage and expected recourse costs.

In this case, the first-stage decisions are the pumping schedule along the time period comprised in T, which must be planned prior to knowing the exact ETA of the vessels. Indirectly, the refinery inventory levels at each time period t and the necessity of operating the pipeline during critical time periods are also first-stage decisions because they are both implications of the decided pipeline pumping schedule. The second-stage decisions, which represent those decisions taken after the uncertainty unfolds (i.e., the arrival time of each vessel becomes known), are represented by the maritime terminal activities, such as the scheduling of berthing and unloading activities, transference amounts, and inventory levels at this location.

The model’s objective is to minimize operational costs, taking into account the refinery demand fulfillment, capacity constraints, oil availability, and the operational characteristics of the pipeline, while guaranteeing operational feasibility (i.e., schedule robustness) for all scenarios taken into consideration. We consider three main cost sources that must be minimized: the costs due to vessel demurrage, the costs of product transference at the terminal, and the penalty cost when the pipeline has to be operated during the critical time period.

In this section, we describe the two-stage stochastic model proposed to represent the problem at hand.


                           
                              
                                 l
                                 =
                                 1
                                 ,
                                 …
                                 ,
                                 L
                              
                            - Batches


                           
                              
                                 n
                                 =
                                 1
                                 ,
                                 …
                                 ,
                                 N
                              
                            - Ships


                           
                              
                                 p
                                 =
                                 1
                                 ,
                                 …
                                 ,
                                 P
                              
                            - Products


                           
                              
                                 s
                                 =
                                 1
                                 ,
                                 …
                                 ,
                                 S
                              
                            - Scenarios


                           
                              
                                 t
                                 =
                                 1
                                 ,
                                 …
                                 ,
                                 T
                              
                            - Time periods


                           
                              
                                 T
                                 C
                                 ⊆
                                 {
                                 1
                                 ,
                                 …
                                 ,
                                 T
                                 }
                              
                            - Critical time period


                           Ap
                            - Additional product p penalty cost


                           Bl
                            - Batch size


                           
                              
                                 B
                                 
                                    l
                                    ,
                                    p
                                 
                                 0
                              
                            - Is equal to 1 if batch l is composed of product p at 
                              
                                 t
                                 =
                                 0
                              
                           ;    0 otherwise


                           D
                           
                              p, t
                            - Demand of product p at period t
                        


                           E - Contractual cost for using the pipeline during the critical    time


                           
                              
                                 
                                    F
                                    ¯
                                 
                                 n
                              
                            - Ship n maximum unloading flow rate


                           
                              F
                            
                           
                              n
                            - Ship n minimum unloading flow rate


                           Gn
                            - Ship n estimated arrival period


                           
                              
                                 H
                                 n
                                 s
                              
                            - Estimated disturbance on ship n arrival period in scenario     s
                        


                           
                              
                                 
                                    
                                       I
                                       R
                                    
                                    ¯
                                 
                                 p
                              
                            - Storage capacity of product p at the refinery


                           
                              IR
                            
                           
                              p
                            - Security storage limit of product p at the refinery


                           
                              
                                 I
                                 
                                    R
                                    p
                                    0
                                 
                              
                            - Initial storage level of product p at the refinery


                           
                              
                                 
                                    
                                       I
                                       T
                                    
                                    ¯
                                 
                                 p
                              
                            - Storage capacity of product p at the terminal


                           
                              IT
                            
                           
                              p
                            - Security storage limit of product p at the terminal


                           
                              
                                 I
                                 
                                    T
                                    p
                                    0
                                 
                              
                            - Initial storage level of product p at the terminal


                           Ps
                            - Scenario s probability


                           R - Terminal transference cost


                           V
                           
                              n, p
                            - Amount of product p transported in ship n
                        


                           Wn
                            - Ship n demurrage cost


                           a
                           
                              p, t
                            - Additional amount of product p necessary in period t
                        


                           b
                           
                              l, p, t
                            - Is equal to 1 if batch l is composed of product p in     period t; 0 otherwise


                           bi
                           
                              p, t
                            - Is equal to 1 if product p is entering the pipeline in     period t; 0 otherwise


                           bo
                           
                              p, t
                            - Is equal to 1 if product p is leaving the pipeline in period     t; 0 otherwise


                           
                              
                                 d
                                 
                                    n
                                    ,
                                    t
                                 
                                 s
                              
                            - Is equal to 1 if ship n docks in period t under scenario s;     0 otherwise


                           
                              
                                 d
                                 
                                    d
                                    
                                       n
                                       ,
                                       t
                                    
                                    s
                                 
                              
                            - Is equal 1 if ship n remains docked in period t under     scenario s; 0 otherwise


                           e - Is equal 1 if the pipeline is used during at least one critical    time period; 0 otherwise


                           
                              
                                 i
                                 
                                    r
                                    
                                       p
                                       ,
                                       t
                                    
                                    s
                                 
                              
                            - Inventory level of product p at the refinery in period t     under scenario s
                        


                           
                              
                                 i
                                 
                                    t
                                    
                                       p
                                       ,
                                       t
                                    
                                    s
                                 
                              
                            - Inventory level of product p at the terminal in period t     under scenario s
                        


                           
                              
                                 s
                                 
                                    n
                                    ,
                                    p
                                    ,
                                    t
                                 
                                 s
                              
                            - Unloading flow of product p in period t from ship n      under scenario s
                        


                           
                              
                                 u
                                 
                                    n
                                    ,
                                    t
                                 
                                 s
                              
                            - Is equal 1 if ship n is undocked in period t under scenario     s; 0 otherwise

In this subsection, we present the mathematical model formulated to represent the aforementioned problem.

                           
                              (3.1)
                              
                                 
                                    
                                       
                                       
                                       
                                          
                                             min
                                             E
                                             e
                                             +
                                             
                                                ∑
                                                
                                                   p
                                                   ,
                                                   t
                                                
                                             
                                             
                                                A
                                                p
                                             
                                             
                                                a
                                                
                                                   p
                                                   ,
                                                   t
                                                
                                             
                                             +
                                             
                                                ∑
                                                s
                                             
                                             
                                                P
                                                s
                                             
                                             
                                                [
                                                
                                                   ∑
                                                   n
                                                
                                                
                                                   W
                                                   n
                                                
                                                
                                                   (
                                                   
                                                      ∑
                                                      t
                                                   
                                                   t
                                                   
                                                      (
                                                      
                                                         u
                                                         
                                                            n
                                                            ,
                                                            t
                                                         
                                                         s
                                                      
                                                      )
                                                   
                                                
                                             
                                          
                                       
                                    
                                    
                                       
                                       
                                       
                                          
                                             
                                                
                                                +
                                                T
                                                
                                                   (
                                                   1
                                                   −
                                                   
                                                      ∑
                                                      t
                                                   
                                                   
                                                      u
                                                      
                                                         n
                                                         ,
                                                         t
                                                      
                                                      s
                                                   
                                                   )
                                                
                                                −
                                                
                                                   (
                                                   
                                                      G
                                                      n
                                                   
                                                   +
                                                   
                                                      H
                                                      n
                                                      s
                                                   
                                                   )
                                                
                                                )
                                             
                                             ]
                                          
                                       
                                    
                                 
                              
                           
                        
                        Eq. (3.1) represents the objective function, which comprises the first-stage cost and the expected value of the second-stage cost, considering all scenarios s. The first-stage cost is composed of the contractual cost incurred if the pipeline is used during the critical time periods and the penalty costs caused by additional supply requirements. The second-stage cost consists of the expected demurrage costs. The demurrage cost is calculated by the number of time periods between the moment that the ship arrives (given by 
                           
                              
                                 G
                                 n
                              
                              +
                              
                                 H
                                 n
                                 s
                              
                           
                        ) and the moment that the ship undocks (given by 
                           
                              t
                              (
                              
                                 u
                                 
                                    n
                                    ,
                                    t
                                 
                                 s
                              
                              )
                           
                         or 
                           
                              T
                              (
                              1
                              −
                              
                                 ∑
                                 t
                              
                              
                                 u
                                 
                                    n
                                    ,
                                    t
                                 
                                 s
                              
                              )
                           
                         if the vessel remains docked at the end of the planning horizon).

The following set of constraints (3.2–3.11) model the product flow in the oil pipeline that connects the terminal to the refinery during the planning horizon. Fig. 2
                         exemplifies the process of oil pumping through the pipeline modeled by these constraints. In this figure, the different colored squares between the straight lines represent batches of products inside the pipeline. For 
                           
                              t
                              =
                              1
                              ,
                           
                         it presents a possible distribution of batches at the beginning of the planning period. In periods 
                           
                              t
                              =
                              2
                           
                         and 
                           
                              t
                              =
                              3
                           
                         a new batch is inputted in each period at the terminal (as indicated by the arrows on the left), which causes a delivery of the furthest batch in the pipeline towards the refinery (indicated by arrows on the right). In 
                           
                              t
                              =
                              4
                              ,
                           
                         it illustrates a situation in which no pumping is performed.

Constraints (3.2)–(3.10) model the product movement inside the pipeline. Whenever there is an input of some product p, the product assignment must be dislocated by one position batch-wise. However, if no input is received from the terminal then the product assignment for all batches inside the pipeline must remain the same.

Constraint (3.2) states whenever there is some product input of some product p leaving the terminal, then the first batch of the pipeline must be composed this same product p.

                           
                              (3.2)
                              
                                 
                                    
                                       
                                       
                                          
                                             
                                                b
                                                
                                                   l
                                                   ,
                                                   p
                                                   ,
                                                   t
                                                
                                             
                                             ≥
                                             b
                                             
                                                i
                                                
                                                   p
                                                   ,
                                                   t
                                                
                                             
                                             ,
                                             
                                             l
                                             =
                                             1
                                             ,
                                             ∀
                                             p
                                             ,
                                             ∀
                                             t
                                          
                                       
                                    
                                 
                              
                           
                        Constraints (3.3) and (3.4) model this behavior in the first time period 
                           
                              (
                              t
                              =
                              1
                              )
                           
                         while constraints (3.5) and (3.6) consider the remaining time periods. Notice that parameter 
                           
                              B
                              
                                 l
                                 ,
                                 p
                              
                              0
                           
                         indicates whether each section of the pipeline is empty or filled with some product p in the beginning of the planning horizon 
                           
                              (
                              t
                              =
                              0
                              )
                           
                        .

                           
                              (3.3)
                              
                                 
                                    
                                       
                                       
                                          
                                             
                                                b
                                                
                                                   l
                                                   p
                                                   t
                                                
                                             
                                             −
                                             
                                                ∑
                                                
                                                   p
                                                   ′
                                                
                                             
                                             b
                                             
                                                i
                                                
                                                   
                                                      p
                                                      ′
                                                   
                                                   ,
                                                   t
                                                
                                             
                                             ≥
                                             
                                                B
                                                
                                                   l
                                                   −
                                                   1
                                                   ,
                                                   p
                                                
                                                0
                                             
                                             −
                                             1
                                             ,
                                             
                                             ∀
                                             l
                                             >
                                             1
                                             ,
                                             ∀
                                             p
                                             ,
                                             t
                                             =
                                             1
                                          
                                       
                                    
                                 
                              
                           
                        
                        
                           
                              (3.4)
                              
                                 
                                    
                                       
                                       
                                          
                                             
                                                b
                                                
                                                   l
                                                   p
                                                   t
                                                
                                             
                                             +
                                             
                                                ∑
                                                
                                                   p
                                                   ′
                                                
                                             
                                             b
                                             
                                                i
                                                
                                                   
                                                      p
                                                      ′
                                                   
                                                   ,
                                                   t
                                                
                                             
                                             ≥
                                             
                                                B
                                                
                                                   l
                                                   ,
                                                   p
                                                
                                                0
                                             
                                             ,
                                             
                                             ∀
                                             l
                                             ,
                                             ∀
                                             p
                                             ,
                                             t
                                             =
                                             1
                                          
                                       
                                    
                                 
                              
                           
                        
                        
                           
                              (3.5)
                              
                                 
                                    
                                       
                                       
                                          
                                             
                                                b
                                                
                                                   l
                                                   p
                                                   t
                                                
                                             
                                             −
                                             
                                                ∑
                                                
                                                   p
                                                   ′
                                                
                                             
                                             b
                                             
                                                i
                                                
                                                   
                                                      p
                                                      ′
                                                   
                                                   ,
                                                   t
                                                
                                             
                                             ≥
                                             
                                                b
                                                
                                                   l
                                                   −
                                                   1
                                                   ,
                                                   p
                                                   ,
                                                   t
                                                   −
                                                   1
                                                
                                             
                                             −
                                             1
                                             ,
                                             
                                             ∀
                                             l
                                             >
                                             1
                                             ,
                                             ∀
                                             p
                                             ,
                                             ∀
                                             t
                                             >
                                             1
                                          
                                       
                                    
                                 
                              
                           
                        
                        
                           
                              (3.6)
                              
                                 
                                    
                                       
                                       
                                          
                                             
                                                b
                                                
                                                   l
                                                   p
                                                   t
                                                
                                             
                                             +
                                             
                                                ∑
                                                
                                                   p
                                                   ′
                                                
                                             
                                             b
                                             
                                                i
                                                
                                                   
                                                      p
                                                      ′
                                                   
                                                   ,
                                                   t
                                                
                                             
                                             ≥
                                             
                                                b
                                                
                                                   l
                                                   ,
                                                   p
                                                   ,
                                                   t
                                                   −
                                                   1
                                                
                                             
                                             ,
                                             
                                             ∀
                                             l
                                             ,
                                             ∀
                                             p
                                             ,
                                             ∀
                                             t
                                             >
                                             1
                                          
                                       
                                    
                                 
                              
                           
                        Constraints (3.7) and (3.8) state that the product that reaches the refinery whenever there is a product input in the terminal side is precisely the product assigned to the last batch. In a similar way to what has been performed before, constraint (3.7) models this behavior for 
                           
                              t
                              =
                              1
                           
                         while constraint (3.8) models it for the remaining time periods.

                           
                              (3.7)
                              
                                 
                                    
                                       
                                       
                                          
                                             b
                                             
                                                o
                                                
                                                   p
                                                   t
                                                
                                             
                                             −
                                             
                                                ∑
                                                
                                                   p
                                                   ′
                                                
                                             
                                             b
                                             
                                                i
                                                
                                                   
                                                      p
                                                      ′
                                                   
                                                   ,
                                                   t
                                                
                                             
                                             ≥
                                             
                                                B
                                                
                                                   l
                                                   ,
                                                   p
                                                
                                                0
                                             
                                             −
                                             1
                                             ,
                                             
                                             l
                                             =
                                             L
                                             ,
                                             ∀
                                             p
                                             ,
                                             t
                                             =
                                             1
                                          
                                       
                                    
                                 
                              
                           
                        
                        
                           
                              (3.8)
                              
                                 
                                    
                                       
                                       
                                          
                                             b
                                             
                                                o
                                                
                                                   p
                                                   t
                                                
                                             
                                             −
                                             
                                                ∑
                                                
                                                   p
                                                   ′
                                                
                                             
                                             b
                                             
                                                i
                                                
                                                   
                                                      p
                                                      ′
                                                   
                                                   ,
                                                   t
                                                
                                             
                                             ≥
                                             
                                                b
                                                
                                                   l
                                                   ,
                                                   p
                                                   ,
                                                   t
                                                   −
                                                   1
                                                
                                             
                                             −
                                             1
                                             ,
                                             
                                             l
                                             =
                                             L
                                             ,
                                             ∀
                                             p
                                             ,
                                             ∀
                                             t
                                             >
                                             1
                                          
                                       
                                    
                                 
                              
                           
                        Constraint (3.9) states that whenever there is an input of some product p there must be an output of some product p. Note that it may not necessarily be the same product p.

                           
                              (3.9)
                              
                                 
                                    
                                       
                                       
                                          
                                             
                                                ∑
                                                p
                                             
                                             b
                                             
                                                o
                                                
                                                   p
                                                   ,
                                                   t
                                                
                                             
                                             =
                                             
                                                ∑
                                                p
                                             
                                             b
                                             
                                                i
                                                
                                                   p
                                                   ,
                                                   t
                                                
                                             
                                             ,
                                             
                                             ∀
                                             t
                                          
                                       
                                    
                                 
                              
                           
                        Constraint (3.10) limits to one the number of products assigned to each batch at each time period.

                           
                              (3.10)
                              
                                 
                                    
                                       
                                       
                                          
                                             
                                                ∑
                                                p
                                             
                                             
                                                b
                                                
                                                   l
                                                   ,
                                                   p
                                                   ,
                                                   t
                                                
                                             
                                             =
                                             1
                                             ,
                                             
                                             ∀
                                             l
                                             ,
                                             ∀
                                             t
                                          
                                       
                                    
                                 
                              
                           
                        Constraint (3.11) guarantees that if there is some product input in any of the critical periods then the energy contract cost must be paid. Notice that this cost is not proportional to the number of critical periods in which there was some product input in the pipeline but to a cost that must be paid even if a single critical period is used for pumping the pipeline.

                           
                              (3.11)
                              
                                 
                                    
                                       
                                       
                                          
                                             b
                                             
                                                i
                                                
                                                   p
                                                   ,
                                                   t
                                                
                                             
                                             ≤
                                             e
                                             ,
                                             
                                             ∀
                                             p
                                             ,
                                             
                                             ∀
                                             t
                                             ∈
                                             T
                                             C
                                          
                                       
                                    
                                 
                              
                           
                        Constraints (3.12)–(3.19) model the arrival of the vessels, their berthing, and their product unloading activities. Constraints (3.12) and (3.13) state that only one vessel can be docked at each time period and that each vessel can be docked only once during the planning horizon, respectively.

                           
                              (3.12)
                              
                                 
                                    
                                       
                                       
                                          
                                             
                                                ∑
                                                t
                                             
                                             
                                                d
                                                
                                                   n
                                                   ,
                                                   t
                                                
                                                s
                                             
                                             ≤
                                             1
                                             
                                             ∀
                                             n
                                             ,
                                             ∀
                                             s
                                          
                                       
                                    
                                 
                              
                           
                        
                        
                           
                              (3.13)
                              
                                 
                                    
                                       
                                       
                                          
                                             
                                                ∑
                                                n
                                             
                                             d
                                             
                                                d
                                                
                                                   n
                                                   ,
                                                   t
                                                
                                                s
                                             
                                             ≤
                                             1
                                             
                                             ∀
                                             t
                                             ,
                                             ∀
                                             s
                                          
                                       
                                    
                                 
                              
                           
                        Constraint (3.14) states that the vessel remains docked (which is indicated by variable 
                           
                              d
                              
                                 d
                                 
                                    n
                                    ,
                                    t
                                 
                                 s
                              
                           
                        ) during the period between the moment when it is docked and the moment when it is undocked.

                           
                              (3.14)
                              
                                 
                                    
                                       
                                       
                                          
                                             d
                                             
                                                d
                                                
                                                   n
                                                   ,
                                                   t
                                                
                                                s
                                             
                                             =
                                             
                                                ∑
                                                
                                                   
                                                      t
                                                      ′
                                                   
                                                   ≤
                                                   t
                                                
                                             
                                             
                                                d
                                                
                                                   n
                                                   ,
                                                   
                                                      t
                                                      ′
                                                   
                                                
                                                s
                                             
                                             −
                                             
                                                ∑
                                                
                                                   
                                                      t
                                                      ′
                                                   
                                                   ≤
                                                   t
                                                   −
                                                   1
                                                
                                             
                                             
                                                u
                                                
                                                   n
                                                   ,
                                                   
                                                      t
                                                      ′
                                                   
                                                
                                                s
                                             
                                             
                                             ∀
                                             n
                                             ,
                                             ∀
                                             t
                                             ,
                                             ∀
                                             s
                                          
                                       
                                    
                                 
                              
                           
                        Constraint (3.15) states that all vessels must be completely unloaded during the planning horizon.

                           
                              (3.15)
                              
                                 
                                    
                                       
                                       
                                          
                                             
                                                ∑
                                                t
                                             
                                             
                                                s
                                                
                                                   n
                                                   ,
                                                   p
                                                   ,
                                                   t
                                                
                                                s
                                             
                                             =
                                             
                                                V
                                                
                                                   n
                                                   ,
                                                   p
                                                
                                             
                                             
                                             ∀
                                             n
                                             ,
                                             ∀
                                             p
                                             ,
                                             ∀
                                             s
                                          
                                       
                                    
                                 
                              
                           
                        Constraints (3.16) state that the amount unloaded in each period by the vessel currently docked must be between the bounds defined by a minimum flow rate 
                           F
                         
                        
                           n
                         and a maximum flow rate 
                           
                              
                                 F
                                 ¯
                              
                              n
                           
                        . These constraints represent the possibility of adjusting the flow rate by controlling the discharge pressure.

                           
                              (3.16)
                              
                                 
                                    
                                       
                                       
                                          
                                             
                                                
                                                   F
                                                   ̲
                                                
                                                n
                                             
                                             d
                                             
                                                d
                                                
                                                   n
                                                   ,
                                                   t
                                                
                                                s
                                             
                                             ≤
                                             
                                                s
                                                
                                                   n
                                                   ,
                                                   p
                                                   ,
                                                   t
                                                
                                                s
                                             
                                             ≤
                                             
                                                
                                                   F
                                                   ¯
                                                
                                                n
                                             
                                             d
                                             
                                                d
                                                
                                                   n
                                                   ,
                                                   t
                                                
                                                s
                                             
                                             
                                             ∀
                                             n
                                             ,
                                             ∀
                                             p
                                             ,
                                             ∀
                                             t
                                             ,
                                             ∀
                                             s
                                          
                                       
                                    
                                 
                              
                           
                        Constraints (3.17)–(3.19) are logical statements. Constraint (3.17) states that a ship can only undock if it has docked at some point before the current period. Constraints (3.18) states that a ship can only undock if it currently docked, and constraint (3.19) states the logical relationship that a ship can only be in the berth if it has docked.

                           
                              (3.17)
                              
                                 
                                    
                                       
                                       
                                          
                                             
                                                ∑
                                                
                                                   
                                                      t
                                                      ′
                                                   
                                                   ≤
                                                   t
                                                
                                             
                                             
                                                d
                                                
                                                   n
                                                   ,
                                                   
                                                      t
                                                      ′
                                                   
                                                
                                                s
                                             
                                             ≥
                                             
                                                ∑
                                                
                                                   
                                                      t
                                                      ′
                                                   
                                                   ≤
                                                   t
                                                
                                             
                                             
                                                u
                                                
                                                   n
                                                   ,
                                                   
                                                      t
                                                      ′
                                                   
                                                
                                                s
                                             
                                             
                                             ∀
                                             n
                                             ,
                                             ∀
                                             t
                                             ,
                                             ∀
                                             s
                                          
                                       
                                    
                                 
                              
                           
                        
                        
                           
                              (3.18)
                              
                                 
                                    
                                       
                                       
                                          
                                             
                                                u
                                                
                                                   n
                                                   ,
                                                   t
                                                
                                                s
                                             
                                             ≤
                                             d
                                             
                                                d
                                                
                                                   n
                                                   ,
                                                   t
                                                
                                                s
                                             
                                             
                                             ∀
                                             n
                                             ,
                                             ∀
                                             t
                                             ,
                                             ∀
                                             s
                                          
                                       
                                    
                                 
                              
                           
                        
                        
                           
                              (3.19)
                              
                                 
                                    
                                       
                                       
                                          
                                             
                                                d
                                                
                                                   n
                                                   ,
                                                   t
                                                
                                                s
                                             
                                             ≤
                                             d
                                             
                                                d
                                                
                                                   n
                                                   ,
                                                   t
                                                
                                                s
                                             
                                             
                                             ∀
                                             n
                                             ,
                                             ∀
                                             t
                                             ,
                                             ∀
                                             s
                                          
                                       
                                    
                                 
                              
                           
                        Constraints (3.20) and (3.21) enforce the material balances of both the terminal and the refinery. The inventory level at the terminal in a given period t is defined by its inventory level in the previous period minus the batch leaving the terminal towards the refinery plus the amount that is discharged from the vessel that is docked. In a similar way, constraint (3.21) enforces the material balance of the refinery. In this case, the inventory level at the refinery in a given period t must be equal to its previous inventory level plus the batch arriving at the refinery and the additional amount of oil purchased minus the demand. Moreover, for 
                           
                              t
                              =
                              1
                              ,
                           
                         we have that 
                           
                              i
                              
                                 t
                                 
                                    p
                                    ,
                                    t
                                    −
                                    1
                                 
                                 s
                              
                              =
                              I
                              
                                 T
                                 p
                                 0
                              
                           
                         and 
                           
                              i
                              
                                 r
                                 
                                    p
                                    ,
                                    t
                                    −
                                    1
                                 
                                 s
                              
                              =
                              I
                              
                                 R
                                 p
                                 0
                              
                           
                        . Constraints (3.22) and (3.23) establish the physical limits for the inventory levels at the terminal and refinery, respectively.

                           
                              (3.20)
                              
                                 
                                    
                                       
                                       
                                          
                                             i
                                             
                                                t
                                                
                                                   p
                                                   ,
                                                   t
                                                
                                                s
                                             
                                             =
                                             i
                                             
                                                t
                                                
                                                   p
                                                   ,
                                                   t
                                                   −
                                                   1
                                                
                                                s
                                             
                                             −
                                             
                                                B
                                                l
                                             
                                             b
                                             
                                                i
                                                
                                                   p
                                                   ,
                                                   t
                                                
                                             
                                             +
                                             
                                                ∑
                                                n
                                             
                                             
                                                s
                                                
                                                   n
                                                   ,
                                                   p
                                                   ,
                                                   t
                                                
                                                s
                                             
                                             
                                             ∀
                                             p
                                             ,
                                             ∀
                                             t
                                             ,
                                             ∀
                                             s
                                          
                                       
                                    
                                 
                              
                           
                        
                        
                           
                              (3.21)
                              
                                 
                                    
                                       
                                       
                                          
                                             i
                                             
                                                r
                                                
                                                   p
                                                   t
                                                
                                                s
                                             
                                             =
                                             i
                                             
                                                r
                                                
                                                   p
                                                   ,
                                                   t
                                                   −
                                                   1
                                                
                                                s
                                             
                                             +
                                             
                                                B
                                                l
                                             
                                             b
                                             
                                                o
                                                
                                                   p
                                                   ,
                                                   t
                                                
                                             
                                             −
                                             
                                                D
                                                
                                                   p
                                                   ,
                                                   t
                                                
                                             
                                             +
                                             
                                                a
                                                
                                                   p
                                                   ,
                                                   t
                                                
                                             
                                             
                                             ∀
                                             p
                                             ,
                                             ∀
                                             t
                                             ,
                                             ∀
                                             s
                                          
                                       
                                    
                                 
                              
                           
                        
                        
                           
                              (3.22)
                              
                                 
                                    
                                       
                                       
                                          
                                             
                                                
                                                   
                                                      I
                                                      T
                                                   
                                                   ̲
                                                
                                                p
                                             
                                             ≤
                                             i
                                             
                                                t
                                                
                                                   p
                                                   ,
                                                   t
                                                
                                                s
                                             
                                             ≤
                                             
                                                
                                                   
                                                      I
                                                      T
                                                   
                                                   ¯
                                                
                                                p
                                             
                                             
                                             ∀
                                             p
                                             ,
                                             ∀
                                             t
                                             ,
                                             ∀
                                             s
                                          
                                       
                                    
                                 
                              
                           
                        
                        
                           
                              (3.23)
                              
                                 
                                    
                                       
                                       
                                          
                                             
                                                
                                                   
                                                      I
                                                      R
                                                   
                                                   ̲
                                                
                                                p
                                             
                                             ≤
                                             i
                                             
                                                r
                                                
                                                   p
                                                   ,
                                                   t
                                                
                                                s
                                             
                                             ≤
                                             
                                                
                                                   
                                                      I
                                                      R
                                                   
                                                   ¯
                                                
                                                p
                                             
                                             
                                             ∀
                                             p
                                             ,
                                             ∀
                                             t
                                             ,
                                             ∀
                                             s
                                          
                                       
                                    
                                 
                              
                           
                        
                     

In this section, we describe the methodology used to represent the uncertainty regarding the arrival of vessels by means of discrete scenarios. Although there is an ETA that is known for each vessel arriving at the terminal, very often they arrive either earlier or later than the ETA. Fig. 3
                     
                      presents a histogram for the deviations around the ETA for 100 sequential arrivals.

To model the randomness of the ETA deviation, we have performed a distribution fitting process using @Risk. We used the Pearson’s Chi-squared test to check the hypothesis that the deviations followed a Gaussian distribution. There was no evidence for rejecting this hypothesis even with a confidence level of 99.9 percent. Table 1
                      presents a comparison of the statistics from both the original data set and the fitted Gaussian distribution.

Once we had defined the probability distribution that we would use, we proceeded to the phase of generating scenarios using a Monte Carlo-based approach. However, this procedure might require a large number of samples to capture the wide range of outcomes in a practically useful manner, which in turn would render a computationally intractable problem (Li & Floudas, 2014).

To circumvent this drawback, we relied on a scenario reduction technique (Heitsch & Römisch, 2003, 2007) that is tailored to obtain smaller subset of representative scenarios in an optimal fashion, given a set of scenarios to be reduced, a desired size for the resulting scenario tree, and an adequate probabilistic distance metric. This approach has been successfully applied in practical problems from other areas, such as energy market modeling (Gabriel, Zhuang, & Egging, 2009), power generation planning (de Oliveira, Sagastizábal, Penna, Maceira, & Damázio, 2010), and portfolio management (Geyer, Hanke, & Weissensteiner, 2010), to mention a few.

In our approach, we used the scenario samples as an input for the scenario reduction technique to generate the reduced scenario tree that would be used in the stochastic optimization model. At this point, two important parameters that must be defined a priori. First, we need to establish the number of samples that are necessary to obtain a good representation of the uncertainty. Second, we must determine the number of scenarios we will consider in the reduced tree. As is the case in many of these trade-offs, we must balance the computational feasibility and quality of the representation.

To access the impact of the sample size definition, we performed a sequence of experiments in which we gradually increased the sample size and then measured the impact on the scenario reduction algorithm. In these experiments, we used the forward selection algorithm, considering the Fortet–Mourier metric and norm 1 for the probabilistic distance (for more information on the parameters of the reduction algorithm, please refer to Heitsch and Römisch (2007)). These parameters were defined based on preliminary experimentation, taking into consideration both the reduction efficiency and computational speed.


                     Fig. 4 shows a comparison of 1000
                      different experiments created by iteratively increasing the original sample size obtained from the simulation process before applying the scenario reduction. We started with a sample size of 100 scenarios and iteratively added 100 scenarios until reaching 10,000 sampled scenarios. For each sample size, we applied the scenario reduction algorithm, to obtain scenario trees having from 10 to 100 scenarios in increments of 10. The y-axis scale measures the relative proximity between the original sample set and the scenario tree obtained through the reduction process. It can be observed in Fig. 4 that as the number of scenarios in the original sample increases, larger scenario trees are required to be reached in order to obtain higher relative proximities. Moreover, after a certain sample size is reached, the maximum relative proximity stabilizes. The same conclusions can be drawn concerning the number of scenarios to be obtained from the reduction process. Although there is a clear improvement direction towards larger scenario trees, the benefits of having more scenarios in the scenario tree tend to become marginally smaller as the scenario tree grows. These results allow us to have more precise information concerning the uncertainty representation framework we adopted while supporting the definition of relevant aspects, such as sample and scenario tree sizes.

To evaluate the effects of the proposed approach, we considered two different examples based on real-world data from a Brazilian terminal-refinery system. In this section, we discuss the results obtained using the proposed framework within these two examples. All experiments were performed using an Intel i7 CPU with a 2.7 Gigahertz processor and 16 Gigabytes RAM. The scenario generation procedure was implemented using GAMS 23.7 and the mathematical model and other subroutines were implemented using AIMMS 3.13[A2]. The resulting stochastic programming models were all solved considering their deterministic equivalent formulation and using CPLEX 12. All statistical analyses were performed using @Risk 6.

The first case consists of a planning horizon of seven days in which operations are scheduled one week in advance. In this case, we consider a total of 84 discrete time periods of 2 hours. The terminal is responsible for the supply of a refinery that, due to its hardware’s technical characteristics, is capable of processing two different classes of oil. The oils differ mainly in their sulphur content and are identified hereinafter as light (low sulphur concentration) and heavy (high sulphur concentration). These oils are expected to be supplied within this time frame by three vessels, each with a different ETA.

The refinery demands 750 cubic meters of heavy oil and 1750 cubic meters of light oil per hour. The pipeline connecting the terminal to the refinery was divided into 10 batches of 5 000 cubic meters, initially filled with three batches of light oil followed by seven batches of heavy oil (starting at the terminal towards the refinery). The penalty incurred if the pipeline is used during critical times is 150,000 dollars. The cost of delivering oil directly to the refinery is 1000 dollars per cubic meter for both types of oil. Ship demurrage cost is 3000 dollars per hour. Tables 2 and 3 summarize part of the relevant data used in this example.

The proposed model is a two-stage stochastic programming model that has integer variables in the second stage. The main impact of this particular feature is not only the number of constraints and continuous variables that grow with the number of scenarios used, but also the number of integer variables. To evaluate the proposed framework, we generated several scenario trees, ranging from 10 to 100 scenarios. Table 4
                         shows the deterministic equivalent size of the problem considered for instances of different sample sizes.

The scenario trees were generated as presented in Section 4. Each scenario tree was generated from independent random samples of 10,000 scenarios. For each tree size, we generated 50 distinct trees (from 50 distinct scenario samples). This experimental framework was assembled to test the stability of the proposed methodology with regard to the scenario sample that was used to create the scenario trees.


                        Fig. 5
                        
                         presents the average computational times for each scenario tree size. The main drawback of increasing the scenario tree size is the inevitable increase in the computational burden to solve the problem. Note that the time required to reach the optimal solution presents an exponentially increasing behavior, which is a consequence of the increasing number of integer variables in the deterministic equivalents.

The two-stage stochastic model proposed aims to provide a pumping schedule for the pipeline that should be followed despite the disturbances from the arrival of the vessels. One of the main reasons behind this assumption is related to the energy demand associated with the pipeline operation. As mentioned above, the energy cost during peak times can be substantially higher than during regular hours, or even worse, the company might be subject to contractual restrictions and once these are violated they might provoke severe financial penalties.

Considering the scenario tree of 100 scenarios, the total cost (comprising the first-stage costs and the expected second-stage costs) is dollar 61,931. In this case, the model was able to obtain a pumping schedule that avoided incurring higher costs because of the use of the pipeline during critical time periods. Fig. 6 presents the average objective function value, and its maximum and minimum values observed for all scenario tree sizes. As can be seen in this figure, the effects of having larger scenario trees are not directly related to the average solution value but rather to its variability, which is an indication of the stability of the scenario generation approach. This type of stability is referred in literature as in-sample stability and can be considered as a way of examining how many scenarios are needed to stabilize the optimal solution value (Kaut & Wallace, 2007). As the scenario tree size increases, we observe that the deviation around the average value gradually decreases (in-sample stability increases), which is a desirable effect in the present context. Bearing in mind that we are making decisions concerning the short-term scheduling of the terminal-refinery system, all measures that could guarantee a smooth operation, and thus, low levels of variability, are highly appreciated.


                        Figs. 7
                         and 8
                         illustrate the type of information the proposed model provides to assist with the definition of pipeline scheduling. In Fig. 7, the inventory profile for the planning horizon is presented for the two oil types considered. Fig. 8 schematically represents the pumping schedule for the pipeline. Each line represents a snapshot of the pipeline contents at the time period indicated in that line and the color represents the products filling each batch (blue is light oil and green is heavy oil).

The pumping sequence provided by the model is valid (i.e., feasible) for all scenarios considered and is the one that reaches the minimum average cost. In addition, the model provides an inventory profile for the following time periods since the refinery inventory level for each product and in each time period is also a first-stage decision in the proposed model; that is, it must be valid no matter which scenario unfolds. The time periods highlighted in Fig. 8 (e.g., 9, 10, 21, 22, and so forth) represent the peak times (from 6 p.m. to 10 p.m. each day) when pipeline operations should be avoided. It can be seen that the model succeeds in finding an optimal solution in which no pumping is performed during these peak time periods. This is one major benefit of the proposed decision-making process because often the uncertainty regarding the arrival of the vessels implies having to reschedule the pipeline, which implies that the pipeline must be operated during peak times.

The definition of the vessel berthing strategy is conditioned with each of the possible realizations of the scenarios considered. Both the timing of the berthing activities and the terminal inventory levels are considered second-stage decisions in the proposed framework. The main role of the variables that represent these decisions is to model the behavior of the system under each possible realization of the uncertainty, allowing the model to make optimal first-stage decisions. Nevertheless, the inspection of the second-stage solution might provide the decision maker with additional information regarding the impact of the uncertainties on system operation. Figs. 9
                        
                        –11
                         show the vessel berthing scheduling for the first 20 scenarios out of 100 and the corresponding product inventory levels at the terminals.

As previously stated, one of the main issues concerning the uncertainty in the time of arrival of the vessels is that any planned decisions very often become infeasible when implemented in practice. This is in fact the main reason behind the constant re-planning that is usually observed in these systems. However, this instability during the operation of the pipeline in the future might expose the whole system to risks concerning the energy supply contracts and the refinery supply.

The proposed approach seeks to overcome this issue by including in the decision process the consideration of the uncertainty. By doing so, the proposed solution is defined that also takes into account that it must be feasible for all scenarios considered. Provided that the scenarios are selected based on a probabilistic distance minimization strategy, it is natural to think that the solutions obtained through this framework would be more robust to eventual variations in the time of arrival of the vessels.

There are available in literature classic measures such as the Value of Stochastic Solution (VSS) and Expected Value of Perfect Information (EVPI) (Birge & Louveaux, 2011) that seeks to assess the benefits of incorporating uncertainty considerations into the modeling approach in terms of costs. However, these measures only take into account the value of the objective function and thus, are not suitable to assess feasibility-related benefits of the proposed modeling approach.

The greater benefits of the proposed approach become clearer when we compare the chances of a given schedule being actually feasible. To obtain this statistic, we have performed a Monte Carlo simulation by sampling possible times of arrival for the vessels from the probability distribution obtained from the goodness-of-fit test. By combining the sampled arrival times and a predefined schedule we can check whether some of the constraints of the model were violated, in an out-of-sample test fashion (Kaut & Wallace, 2007). If it is the case, then it means that the current plan is not feasible for that particular sample, which, in this case, is an equivalent scenario. We have repeated this experiment 10,000 times using the first-stage solution obtained from the scenario tree composed of 10 to 100 scenarios and used the proportion between the number of infeasible scenarios observed and the total of the samples considered as an approximation for the infeasibility probability of a given schedule. Fig. 12
                         presents the results obtained for each scenario tree size.

In the case where the ETA was used to define the first-stage decisions we observed that 90.79 percent of the samples turned out to be infeasible for the first-stage decisions obtained from the deterministic model. However, when we consider the solution obtained from the stochastic model, the total of infeasible solutions is reduced to 1.36 percent of the samples, considering 100 scenarios. These results show how the adoption of the stochastic model is capable of providing a solution that is more efficient in coping with the uncertainty of the ETA when scheduling the refinery supply.

In this case, the same problem is considered; however, we now consider a longer planning horizon comprising 14 days that are divided into a total of 168 discrete time periods of 2 hours length. In this extended planning horizon, the arrival of 10 ships is expected. All of the operational data referring to the operational characteristics are the same as those considered in Section 5.1. Table 5 summarizes the size of the deterministic equivalent problems in this case.


                        Fig. 13
                         presents the computational time scales for this case. Because of the increased complexity, the required time to reach an optimal solution is significantly increased, a fact that led us to reduce the size of our experimental setting to a maximum of 50 scenarios instead of 100.

In this second example, the total cost for the model considering the scenario tree of 50 scenarios is dollars 329,499. In this case, the model was also capable of obtaining a pumping schedule that avoided the imposition of the penalty caused by the use of the pipeline during critical time periods. Fig. 14
                        
                         presents the solution values for different scenario sizes and shows that the solution value presents a similar behavior, having a small variability in terms of the average values and a decreasing variability as the number of scenarios increases.

We also performed a simulation run, comprised of 10,000 independent samples for the possible ETAs of each vessel, to assess the solution robustness in this case. Once again, we compared the solution obtained using the ETAs (deterministic solution) with the solution obtained from the stochastic model considering 50 scenarios (stochastic solution).

The results exhibited a similar behavior regarding the optimal value, variability, and proportion of feasible scenarios. In this case, the deterministic solution was infeasible in 84.14 percent of the experiments while the stochastic solution reduces infeasibility probability to 5.04 percent for the case considering 50 scenarios, as seen in Fig. 15
                        . Despite the increased size of the problem, the stochastic solution seems to be capable of handling the variability of the ETAs more efficiently, even for a reduced number of scenarios.

@&#CONCLUSIONS@&#

In this study, we addressed the crude oil scheduling problem with petroleum supply uncertainty in a terminal-refinery system. The methodology combined a two-stage stochastic MILP model with a problem-driven scenario generation methodology. The objective was to obtain an adherent representation of the uncertainty regarding vessel arrival so that the scheduled activities can be implemented in practice.

The computational results showed the importance of considering uncertainty within decision support tool systems. Feasibility becomes the main issue when we focus on short-term planning such as scheduling so it is imperative to be able to represent this uncertainty within the optimization model. It gives a wider reach to the decision-making process in terms of foreseeing possible outcomes and making resilient decisions. It is important to note that the proposed approach could be easily extended to consider the particular aspects of other systems of the same nature and that it is independent of the statistical distribution that more adherently models the stochasticity.

For future research, some aspects are of interest in this investigation. First, a major issue related to our approach is the size of the models, which quickly become intractable as the number of scenarios grows. However, as indicated by computational experiments, increasing the number of scenarios can improve the quality of uncertainty representation. In this sense, it would be important to investigate efficient methods that could address these large-scale problems, such as decomposition strategies and parallelization. Other additional developments might include investigating different strategies to generate scenarios to improve stochastic adherence while maintaining the number of scenarios at a minimum level and apply the proposed approach to other terminal-refinery systems to verify its validity into different contexts.

@&#ACKNOWLEDGMENTS@&#

We gratefully acknowledge the financial support of the Brazilian National Council of Research - CNPq (grants number 455013/2014-4, 480469/2013-0, and 312046/2012-0). We are also thankful for the insightful suggestions made by the anonymous reviewers during the reviewing process, which have helped us improving the quality of this paper.

Supplementary material associated with this article can be found, in the online version, at 10.1016/j.ejor.2016.01.034 .


                     
                        
                           Supplementary Data S1
                           
                              Supplementary Raw Research Data. This is open data under the CC BY license http://creativecommons.org/licenses/by/4.0/
                              
                           
                           
                        
                     
                  

@&#REFERENCES@&#

