@&#MAIN-TITLE@&#Persistent tracking of static scene features using geometry

@&#HIGHLIGHTS@&#


               
               
                  
                     
                        
                           
                           We introduce a view geometric constraint to the tracking problem.


                        
                        
                           
                           We provide a closed form solution from appearance and geometry.


                        
                        
                           
                           This paper provides persistent tracking of features even when they are occluded.


                        
                        
                           
                           Bayesian-based selection of the best features.


                        
                        
                           
                           Our experiments demonstrate robust tracking performance.


                        
                     
                  
               
            

@&#KEYPHRASES@&#

Feature tracking

Tracking

Projective geometry

Projective invariants

Occlusion

Persistent tracking

@&#ABSTRACT@&#


               
               
                  Despite many alternatives to feature tracking problem, iterative least squares solution solving the optical flow constraint has been the most popular approach used by many in the field. This paper attempts to leverage the former efforts to enhance feature tracking methods by introducing a view geometric constraint to the tracking problem. In contrast to alternative geometry based methods, the proposed approach provides a closed form solution to optical flow estimation from image appearance and view geometry constraints. We particularly use invariants in the projective coordinates generated from tracked features that results in a new optical flow equation. This treatment provides persistent tracking of features even when they are occluded. At the end of each tracking loop the quality of the tracked features is judged using both appearance similarity and geometric consistency. Our experiments demonstrate robust tracking performance even when the features are occluded or they undergo appearance changes due to projective deformation of the template.
               
            

@&#INTRODUCTION@&#

Tracking a set of features in video finds application in many low and high level computer vision tasks including but not limited to structure from motion [1], action recognition [2], object recognition [3], video segmentation [4] and mobile vision [5]. This wide applicability makes the problem attractive to many researchers in the field which attempt to solve the hard problem of generating feature trajectories that are least affected by the changes in the feature’s appearance as the camera moves. The camera motion usually manifests itself in the appearances of tracked features as projective changes in the features vicinity.

The most intuitive and a commonly applied approach is to detect features at every frame and establish correspondences across frames by template matching [6]. Alternatively, correspondences can also be established by modeling the motion either deterministically [7,8] or stochastically [9] both of which may enforce one or more “qualitative motion heuristics” [7]. These heuristics include proximity, maximum velocity, small velocity change, rigidity and common motion. The deterministic methods attempt to solve feature tracking as a combinatorial optimization problem, which is expected to provide one to one correspondences. The solution is commonly obtained using greedy [10] or optimal assignment methods [11] which do not handle uncertainty and noise in observations. In contrast, probabilistic methods solve the correspondence problem by recursive Bayesian filtering which predicts possible correspondences and corrects internal models using the new observations [12]. These methods suffer from occlusions which results in loss of tracked features.

Another line of feature tracking approach, which relates more to our approach, is to iteratively estimate the motion of a feature. Motion estimation exploits the optical flow equation derived from the brightness constancy constraint and assume the feature and its neighboring pixels move with the same speed, e.g. common motion heuristic. This assumption can be exercised to introduce multiple instances of optical flow equations with the same unknown flow vector and can be solved using the least squares adjustment [13]. In fact, this treatment is the most commonly applied motion estimation approach referred to as Lucas Kanade optical flow method. Later, Lucas Kanade approach is extended to feature tracking by Tomasi and Kanade [14] and is referred to the KLT tracker. This extension included an additional step to check the quality of tracked appearance by means of computing the sum of square differences for affine compensated templates. In the later years, KLT has become and arguably still is the most commonly applied feature tracking method due to its ease of implementation, and low computational complexity. In the case the feature is occluded, these tracking algorithms estimate incorrect trajectories.

Despite its wide use, methods that track each feature independently from the others are susceptible to fall into local solutions due to background clutter, cross-cutting trajectories and scene parallax. These shortcomings have been addressed in stochastic correspondence based methods by employing joint probability data association filtering [15], particle filtering [9] and multiple hypothesis tracking [16]. These stochastic methods use a set of possible tracks for each feature, which compete against each other to solve the coalescence problem. The dimensionality of the possible solutions, however, become intractable and heuristic constraints for pruning excess tracks are required. The stochastic models which include motion models can handle short occlusions under constant velocity or acceleration models. These methods, however, will not recover object trajectories in case the occlusion is long or the motion model does not confirm the feature motion.

Another direct approach has also been studied which includes local geometric heuristics to estimate the motion of a feature with respect to the other features. In fact, the common motion heuristic used in the KLT tracker is an instance of local geometric constraint, where the neighboring pixels are assumed to lie on a plane perpendicular to the projection ray. An extended application of the motion heuristic is introduced in [17] where the authors assume features in a small neighborhood follow the same affine motion. This approach works well when proximal features are coplanar in 3D. Non-coplanar features lying across multiple planes due to depth discontinuity introduce an incorrect bias to motion estimation. Alternatively, Brox et al. [18] proposed a continuous, rotationally invariant energy function for estimating optical flow based on both the brightness constancy and the gradient constancy. These assumptions were combined with a 2D discontinuity-preserving spatio-temporal regularizer. This method, however, does not use a 3D geometric constraint either. A more restrictive geometry is exploited in [19] using cross-ratio invariance, where a set of features are assumed to be collinear in 3D.

Instead of the local geometry used by the aforementioned methods, global scene geometry provides a stronger constraint on the types of motions the features can undergo. A complicated solution to tracking based on the global scene geometry is to estimate both the 3D scene and the camera matrices. In [20], Torresani and Bregler used the non-rigid structure from motion to track features. Their approach assumed all the tracked features lie on a single articulated object. The tracking is then achieved by first tracking a set of appearance-wise reliable features until the end of the sequence to learn the 3D shape basis, which is later imposed as a constraint on the trajectories of the “unreliable” features to estimate correct trajectories. The approach, however, requires processing of the video offline first, which is then used to constrain the second pass to find remaining trajectories. Alternatively, Irani [21] incorporated geometric constraints in the optical flow equation assuming rigid body and orthographic cameras. Its performance, however, degrades rapidly for non-planar scenes when the camera rotates. Ji and Fermuller [22] improved [21] by enforcing constancy of 3D surface normals computed by estimating structure of the scene. While this additional constraint made the approach computationally feasible for longer sequences, it required offline processing of the video. Moreover, the plane segmentation required at the beginning of the algorithm limits its application to scenes which is composed of a set of planes. In [23], Zhang et al. proposed a non-consecutive feature tracking approach based on shape from motion constraints. Their approach consisted of a consecutive point tracking step followed by a non-consecutive track matching step. While provided decent results, their approach required offline processing. A more explicit geometric constraint using the 3D scene is considered by Wang et al. [24]. Their approach used images from a stereo camera-rig to simultaneously recover 3D and track features using a 3D elastic motion model. Stereo camera-rig, however, may not always be available in a generic feature tracking framework.

This paper exploits the global scene geometry and defines a quality measure that ties well to the appearance based quality measure used in KLT. We particularly try to address the tracking problem illustrated in Fig. 1
                      and introduce a method that tracks a feature by maximizing both the appearance and geometric quality. In this regard, the proposed approach leverages the motion estimation based tracking approaches by introducing a view geometry constraint to the optical flow equation. The proposed geometric constraint uses a set of samples from the posterior distribution of invariant projective coordinates. These samples are used to formulate the geometric optical flow equation which accompanies the brightness based optical flow equation. This new treatment improves our earlier approach [25], which estimates optical flow vectors in a regularization based solution similar to that of the Horn and Schunck approach [26]. The tracking is achieved by solving the new tracking function with shared geometry constraint using the least squares adjustment. In addition, we provide a detailed discussion on how the geometric invariant which exploits the cyclopean constraint is satisfied in a tracking framework. The proposed tracking approach is capable of estimating feature trajectories during occlusions. This is primarily due to using a collection of features from around the scene in estimating the optical flow vectors. In our experiments, despite the appearance variations due to projectivity or short duration occlusions, the tracked features quantitatively provide better accuracy compared to alternative methods.

The remainder of the paper is organized as follows. In Section 2, the tracking model is discussed. We will give details of the geometry shared across consecutive frames in Section 3. The integration of appearance and geometry in the proposed tracking model is introduced in Section 4. In Section 5, the selection of salient features is given. Experimental evaluation of the proposed approach is given in Section 6. This section is organized into two subsections: one on general sequences and the other one on the application of the system to the NASA astronaut navigation system. Section 7 concludes the paper.

The tracking problem is typically formulated by exploiting the brightness constancy: 
                        
                           I
                           (
                           x
                           ,
                           y
                           ,
                           t
                           )
                           =
                           I
                           (
                           x
                           +
                           dx
                           ,
                           y
                           +
                           dy
                           ,
                           t
                           +
                           dt
                           )
                        
                     . The Taylor series expansion of this equation results in the optical flow constraint equation:
                        
                           (1)
                           
                              
                                 
                                    uI
                                 
                                 
                                    x
                                 
                              
                              +
                              
                                 
                                    vI
                                 
                                 
                                    y
                                 
                              
                              +
                              
                                 
                                    I
                                 
                                 
                                    t
                                 
                              
                              =
                              0
                              ,
                           
                        
                     where the subscripts denote spatial and temporal image derivatives and 
                        
                           u
                           =
                           (
                           u
                           ,
                           v
                           )
                           =
                           (
                           dx
                           /
                           dt
                           ,
                           dy
                           /
                           dt
                           )
                        
                      is the optical flow vector. Optical flow constraint defines a line in the 
                        
                           (
                           u
                           ,
                           v
                           )
                        
                      coordinates as shown in Fig. 2
                     (a). Assuming the derivatives are accurate, the unknown flow u lies on this line and is decomposed into parallel flow and normal flow components as depicted in the same figure. The normal flow, which defines the motion in the edge normal direction, is computable and lies at the intersection of the line with a perpendicular line passing through the origin. The parallel flow, on the other hand, cannot be computed due to the aperture problem.

In order to overcome the aperture problem, a common strategy is to assume that the motion of a pixel 
                        
                           x
                        
                      is equivalent to the motion of the neighboring pixels 
                        
                           
                              
                                 x
                              
                              
                                 i
                              
                           
                        
                     . This assumption geometrically relates to coplanarity of 
                        
                           
                              
                                 x
                              
                              
                                 i
                              
                           
                        
                     , such that the appearance at 
                        
                           
                              
                                 x
                              
                              
                                 i
                              
                           
                        
                      provides an ortho-texture. In this setting, for each pixel, the optical flow constraint provides an equation which can be considered as a line 
                        
                           l
                           (
                           
                              
                                 x
                              
                              
                                 i
                              
                           
                           )
                        
                      (see Fig. 2(b) for illustration). The optical flow, hence the true flow, estimated by line fitting using least squares estimation. This treatment, however, is known to have problems in case of depth discontinuities, where the coplanarity and ortho-texture assumptions are violated. Alternative to the coplanarity assumption, we introduce a general geometric constraint which introduces another line in the 
                        
                           (
                           u
                           ,
                           v
                           )
                        
                      space:
                        
                           (2)
                           
                              ua
                              +
                              vb
                              +
                              c
                              =
                              0
                              ,
                           
                        
                     which is based on the invariant projective coordinates and is shown in Fig. 2(c). The optical flow is determined as the intersection of two lines that are computed from the appearance constraint and the geometry constraint.

Observed motion of a feature depends on the camera motion and the scene geometry. Under the assumption that the scene geometry is constant, it is possible to derive measures that are geometrically invariant under different viewpoints. We exploit these geometric invariants to derive the parameters of the geometric optical flow given in (2). From among various projective invariants discussed in [27], we adopt the cross-ratios of planes due to its less restrictive geometric construction and adoptability for the general feature tracking problem. This projective invariant can provide point to point correspondences compared to epipolar geometry which only provides point to epipolar line correspondences.

For the sake of completeness, we start our discussion by reiterating some of the important results from [27, pp. 47–63] while modifying them as necessary for feature tracking. For a general 3D feature 
                        
                           X
                        
                     , assume that there exists five salient 3D features, 
                        
                           {
                           
                              
                                 X
                              
                              
                                 1
                              
                           
                           ,
                           
                              
                                 X
                              
                              
                                 2
                              
                           
                           ,
                           
                              
                                 X
                              
                              
                                 3
                              
                           
                           ,
                           
                              
                                 X
                              
                              
                                 4
                              
                           
                           ,
                           
                              
                                 X
                              
                              
                                 5
                              
                           
                           }
                        
                      with the condition that no four are coplanar. Let any two features, 
                        
                           
                              
                                 X
                              
                              
                                 i
                              
                           
                        
                      and 
                        
                           
                              
                                 X
                              
                              
                                 j
                              
                           
                        
                     , from among the salient features define a pencil of planes generated by using feature triplets 
                        
                           {
                           
                              
                                 X
                              
                              
                                 i
                              
                           
                           ,
                           
                              
                                 X
                              
                              
                                 j
                              
                           
                           ,
                           
                              
                                 X
                              
                              
                                 k
                              
                           
                           }
                        
                      or 
                        
                           {
                           
                              
                                 X
                              
                              
                                 i
                              
                           
                           ,
                           
                              
                                 X
                              
                              
                                 j
                              
                           
                           ,
                           X
                           }
                        
                      as shown in Fig. 3
                     . We should note that the planes assumed in the invariant coordinates are virtual planes and they do not need to exist in the 3D scene.

The 3D features project to pixels in two images at different viewpoints:
                        
                           
                              x
                              
                              ↦
                              
                              
                                 
                                    x
                                 
                                 
                                    ′
                                 
                              
                              
                              and
                              
                              {
                              
                                 
                                    x
                                 
                                 
                                    1
                                 
                              
                              ,
                              
                                 
                                    x
                                 
                                 
                                    2
                                 
                              
                              ,
                              
                                 
                                    x
                                 
                                 
                                    3
                                 
                              
                              ,
                              
                                 
                                    x
                                 
                                 
                                    4
                                 
                              
                              ,
                              
                                 
                                    x
                                 
                                 
                                    5
                                 
                              
                              }
                              
                              ↦
                              
                              {
                              
                                 
                                    x
                                 
                                 
                                    1
                                 
                                 
                                    ′
                                 
                              
                              ,
                              
                                 
                                    x
                                 
                                 
                                    2
                                 
                                 
                                    ′
                                 
                              
                              ,
                              
                                 
                                    x
                                 
                                 
                                    3
                                 
                                 
                                    ′
                                 
                              
                              ,
                              
                                 
                                    x
                                 
                                 
                                    4
                                 
                                 
                                    ′
                                 
                              
                              ,
                              
                                 
                                    x
                                 
                                 
                                    5
                                 
                                 
                                    ′
                                 
                              
                              }
                              .
                           
                        
                     
                  

Under the assumption that two images generate a cyclopean stimuli, it can be shown that a projective invariant for a general feature 
                        
                           x
                        
                      can be computed as:
                        
                           (3)
                           
                              
                                 
                                    C
                                 
                                 
                                    i
                                    ,
                                    j
                                 
                              
                              (
                              x
                              ,
                              
                                 
                                    x
                                 
                                 
                                    ′
                                 
                              
                              )
                              =
                              
                                 
                                    
                                       
                                          V
                                       
                                       
                                          ijkl
                                       
                                       
                                          ′
                                       
                                    
                                    
                                       
                                          V
                                       
                                       
                                          ijm
                                          x
                                       
                                       
                                          ′
                                       
                                    
                                 
                                 
                                    
                                       
                                          V
                                       
                                       
                                          ijkm
                                       
                                       
                                          ′
                                       
                                    
                                    
                                       
                                          V
                                       
                                       
                                          ijl
                                          x
                                       
                                       
                                          ′
                                       
                                    
                                 
                              
                              ,
                           
                        
                     from the cross-ratios of determinants 
                        
                           
                              
                                 V
                              
                              
                                 ijkl
                              
                              
                                 ′
                              
                           
                        
                      = 
                        
                           |
                           
                              
                                 R
                              
                              
                                 i
                              
                              
                                 ′
                              
                           
                        
                      
                     
                        
                           
                              
                                 R
                              
                              
                                 j
                              
                              
                                 ′
                              
                           
                        
                      
                     
                        
                           
                              
                                 R
                              
                              
                                 k
                              
                              
                                 ′
                              
                           
                        
                      
                     
                        
                           
                              
                                 R
                              
                              
                                 l
                              
                              
                                 ′
                              
                           
                           |
                        
                     , where 
                        
                           i
                           <
                           j
                        
                      refers to indices of the salient features generating the pencil, 
                        
                           k
                           <
                           l
                           <
                           m
                        
                      are the indices of the remaining salient features and 
                        
                           
                              
                                 R
                              
                              
                                 i
                              
                              
                                 ′
                              
                           
                           =
                           
                              
                                 (
                                 
                                    
                                       x
                                    
                                    
                                       i
                                    
                                 
                                 ,
                                 
                                    
                                       y
                                    
                                    
                                       i
                                    
                                 
                                 ,
                                 
                                    
                                       x
                                    
                                    
                                       i
                                    
                                    
                                       ′
                                    
                                 
                                 ,
                                 
                                    
                                       y
                                    
                                    
                                       i
                                    
                                    
                                       ′
                                    
                                 
                                 )
                              
                              
                                 ⊤
                              
                           
                        
                      
                     [28]. The projective invariant, 
                        
                           
                              
                                 C
                              
                              
                                 i
                                 ,
                                 j
                              
                           
                           (
                           x
                           ,
                           
                              
                                 x
                              
                              
                                 ′
                              
                           
                           )
                        
                     , for this setup is known as the invariant projective coordinate of 
                        
                           x
                        
                     . The cyclopean stimuli is related to generating a synthetic image from a virtual viewpoint residing between the two stereo views (see Fig. 4
                      for illustration) [29]. In context of tracking, we consider that the frame at time t is the left image and the frame at time 
                        
                           t
                           +
                           1
                        
                      is the right image. Under the condition that the camera motion is small, the consecutive images satisfy the cyclopean stimuli as will be discussed in the following.

In [28], Barrett et al. suggests that the image formation is restricted to “cyclopean imaging” under the condition that 
                        
                           D
                           =
                           
                              
                                 D
                              
                              
                                 ′
                              
                           
                        
                     , where 
                        
                           D
                        
                      and 
                        
                           
                              
                                 D
                              
                              
                                 ′
                              
                           
                        
                      represent four-vectors comprised of the imaging system parameters (camera position and orientation). Based on this observation, the collinearity equation can be algebraically modified to contain
                        
                           
                              D
                              =
                              
                                 
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      D
                                                   
                                                   
                                                      1
                                                   
                                                
                                             
                                          
                                          
                                             
                                                
                                                   
                                                      D
                                                   
                                                   
                                                      2
                                                   
                                                
                                             
                                          
                                          
                                             
                                                
                                                   
                                                      D
                                                   
                                                   
                                                      3
                                                   
                                                
                                             
                                          
                                          
                                             
                                                
                                                   
                                                      D
                                                   
                                                   
                                                      4
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                              
                              =
                              
                                 
                                    
                                       
                                          
                                             
                                                sin
                                                ϕ
                                             
                                          
                                          
                                             
                                                -
                                                sin
                                                ω
                                                cos
                                                ϕ
                                             
                                          
                                          
                                             
                                                cos
                                                ω
                                                cos
                                                ϕ
                                             
                                          
                                          
                                             
                                                -
                                                (
                                                
                                                   
                                                      D
                                                   
                                                   
                                                      1
                                                   
                                                
                                                
                                                   
                                                      X
                                                   
                                                   
                                                      c
                                                   
                                                
                                                +
                                                
                                                   
                                                      D
                                                   
                                                   
                                                      2
                                                   
                                                
                                                
                                                   
                                                      Y
                                                   
                                                   
                                                      c
                                                   
                                                
                                                +
                                                
                                                   
                                                      D
                                                   
                                                   
                                                      3
                                                   
                                                
                                                
                                                   
                                                      Z
                                                   
                                                   
                                                      c
                                                   
                                                
                                                )
                                             
                                          
                                       
                                    
                                 
                              
                              .
                           
                        
                     
                  

In these equations 
                        
                           ω
                        
                      and 
                        
                           ϕ
                        
                      denote the camera rotation angles around x and y axis, and 
                        
                           (
                           
                              
                                 X
                              
                              
                                 c
                              
                           
                           ,
                           
                              
                                 Y
                              
                              
                                 c
                              
                           
                           ,
                           
                              
                                 Z
                              
                              
                                 c
                              
                           
                           )
                        
                      represents the camera perspective center. Without the loss of generality, we assume the camera external parameters at frame 1 define the object coordinate system. In this case, 
                        
                           ω
                           ,
                           
                           ϕ
                           ,
                           
                           
                              
                                 X
                              
                              
                                 c
                              
                           
                           ,
                           
                           
                              
                                 Y
                              
                              
                                 c
                              
                           
                        
                      and 
                        
                           
                              
                                 Z
                              
                              
                                 c
                              
                           
                        
                      become zeros, such that 
                        
                           
                              
                                 D
                              
                              
                                 1
                              
                           
                           =
                           0
                           ,
                           
                           
                              
                                 D
                              
                              
                                 2
                              
                           
                           =
                           0
                           ,
                           
                           
                              
                                 D
                              
                              
                                 3
                              
                           
                           =
                           1
                           ,
                           
                           
                              
                                 D
                              
                              
                                 4
                              
                           
                           =
                           0
                        
                     . Considering that the camera motion between two consecutive frames is small, we can use small angle approximations: 
                        
                           sin
                           
                              
                                 ω
                              
                              
                                 ′
                              
                           
                           ≈
                           
                              
                                 ω
                              
                              
                                 ′
                              
                           
                           ≈
                           0
                           ,
                           
                           cos
                           
                              
                                 ω
                              
                              
                                 ′
                              
                           
                           ≈
                           1
                           ,
                           
                           sin
                           
                              
                                 ϕ
                              
                              
                                 ′
                              
                           
                           ≈
                           
                              
                                 ϕ
                              
                              
                                 ′
                              
                           
                           ≈
                           0
                        
                      and 
                        
                           cos
                           
                              
                                 ϕ
                              
                              
                                 ′
                              
                           
                           ≈
                           1
                        
                     . Under these conditions, the cyclopean condition can be shown satisfied:
                        
                           (4)
                           
                              
                                 
                                    D
                                 
                                 
                                    1
                                 
                                 
                                    ′
                                 
                              
                              -
                              
                                 
                                    D
                                 
                                 
                                    1
                                 
                              
                              =
                              sin
                              
                                 
                                    ϕ
                                 
                                 
                                    ′
                                 
                              
                              ≈
                              0
                              ,
                           
                        
                     
                     
                        
                           (5)
                           
                              
                                 
                                    D
                                 
                                 
                                    2
                                 
                                 
                                    ′
                                 
                              
                              -
                              
                                 
                                    D
                                 
                                 
                                    2
                                 
                              
                              =
                              -
                              sin
                              
                                 
                                    ω
                                 
                                 
                                    ′
                                 
                              
                              cos
                              
                                 
                                    ϕ
                                 
                                 
                                    ′
                                 
                              
                              ≈
                              0
                              ,
                           
                        
                     
                     
                        
                           (6)
                           
                              
                                 
                                    D
                                 
                                 
                                    3
                                 
                                 
                                    ′
                                 
                              
                              -
                              
                                 
                                    D
                                 
                                 
                                    3
                                 
                              
                              =
                              cos
                              
                                 
                                    ω
                                 
                                 
                                    ′
                                 
                              
                              cos
                              
                                 
                                    ϕ
                                 
                                 
                                    ′
                                 
                              
                              -
                              1
                              ≈
                              0
                              ,
                           
                        
                     
                     
                        
                           (7)
                           
                              
                                 
                                    D
                                 
                                 
                                    4
                                 
                                 
                                    ′
                                 
                              
                              -
                              
                                 
                                    D
                                 
                                 
                                    4
                                 
                              
                              =
                              -
                              (
                              
                                 
                                    D
                                 
                                 
                                    1
                                 
                                 
                                    ′
                                 
                              
                              
                                 
                                    X
                                 
                                 
                                    c
                                 
                                 
                                    ′
                                 
                              
                              +
                              
                                 
                                    D
                                 
                                 
                                    2
                                 
                                 
                                    ′
                                 
                              
                              
                                 
                                    Y
                                 
                                 
                                    c
                                 
                                 
                                    ′
                                 
                              
                              +
                              
                                 
                                    D
                                 
                                 
                                    3
                                 
                                 
                                    ′
                                 
                              
                              
                                 
                                    Z
                                 
                                 
                                    c
                                 
                                 
                                    ′
                                 
                              
                              )
                              ≈
                              0
                              .
                           
                        
                     
                  

Let there be three consecutive frames satisfying the cyclopean condition in which the positions of salient features in all three frames are known and the position of the general feature is only known in the first two frames:
                        
                           
                              
                                 
                                    
                                    
                                       
                                          x
                                          
                                          ↦
                                          
                                          
                                             
                                                x
                                             
                                             
                                                ′
                                             
                                          
                                          
                                          ↦
                                          
                                          <
                                          unknown
                                          
                                          
                                             
                                                x
                                             
                                             
                                                ″
                                             
                                          
                                          
                                          at frame
                                          
                                          t
                                          +
                                          2
                                          >
                                          ,
                                       
                                    
                                 
                                 
                                    
                                    
                                       
                                          {
                                          
                                             
                                                x
                                             
                                             
                                                1
                                             
                                          
                                          ,
                                          
                                             
                                                x
                                             
                                             
                                                2
                                             
                                          
                                          ,
                                          
                                             
                                                x
                                             
                                             
                                                3
                                             
                                          
                                          ,
                                          
                                             
                                                x
                                             
                                             
                                                4
                                             
                                          
                                          ,
                                          
                                             
                                                x
                                             
                                             
                                                5
                                             
                                          
                                          }
                                          
                                          ↦
                                          
                                          {
                                          
                                             
                                                x
                                             
                                             
                                                1
                                             
                                             
                                                ′
                                             
                                          
                                          ,
                                          
                                             
                                                x
                                             
                                             
                                                2
                                             
                                             
                                                ′
                                             
                                          
                                          ,
                                          
                                             
                                                x
                                             
                                             
                                                3
                                             
                                             
                                                ′
                                             
                                          
                                          ,
                                          
                                             
                                                x
                                             
                                             
                                                4
                                             
                                             
                                                ′
                                             
                                          
                                          ,
                                          
                                             
                                                x
                                             
                                             
                                                5
                                             
                                             
                                                ′
                                             
                                          
                                          }
                                          
                                          ↦
                                          
                                          {
                                          
                                             
                                                x
                                             
                                             
                                                1
                                             
                                             
                                                ″
                                             
                                          
                                          ,
                                          
                                             
                                                x
                                             
                                             
                                                2
                                             
                                             
                                                ″
                                             
                                          
                                          ,
                                          
                                             
                                                x
                                             
                                             
                                                3
                                             
                                             
                                                ″
                                             
                                          
                                          ,
                                          
                                             
                                                x
                                             
                                             
                                                4
                                             
                                             
                                                ″
                                             
                                          
                                          ,
                                          
                                             
                                                x
                                             
                                             
                                                5
                                             
                                             
                                                ″
                                             
                                          
                                          }
                                          .
                                       
                                    
                                 
                              
                           
                        
                     
                  

An illustration of this setup is demonstrated in Fig. 5
                      where the position of 
                        
                           
                              
                                 x
                              
                              
                                 ″
                              
                           
                        
                      denoted by 
                        
                           □
                        
                      is unknown at 
                        
                           t
                           +
                           2
                        
                     . We conjecture that the constancy of the projective invariant coordinate for the general feature 
                        
                           x
                        
                      at consecutive time instants, 
                        
                           
                              
                                 C
                              
                              
                                 i
                                 ,
                                 j
                              
                           
                           (
                           x
                           ,
                           
                              
                                 x
                              
                              
                                 ′
                              
                           
                           )
                           =
                           
                              
                                 C
                              
                              
                                 i
                                 ,
                                 j
                              
                           
                           (
                           x
                           ,
                           
                              
                                 x
                              
                              
                                 ″
                              
                           
                           )
                        
                     , provides necessary conditions to estimate the position of 
                        
                           
                              
                                 x
                              
                              
                                 ″
                              
                           
                           =
                           (
                           
                              
                                 x
                              
                              
                                 ″
                              
                           
                           ,
                           
                              
                                 y
                              
                              
                                 ″
                              
                           
                           )
                        
                     , hence the optical flow, from frame 
                        
                           t
                           +
                           1
                        
                      to 
                        
                           t
                           +
                           2
                        
                     .

Given the computed 
                        
                           
                              
                                 C
                              
                              
                                 i
                                 ,
                                 j
                              
                           
                           (
                           x
                           ,
                           
                              
                                 x
                              
                              
                                 ′
                              
                           
                           )
                        
                      and rearranging (3), we have:
                        
                           (8)
                           
                              
                                 
                                    C
                                 
                                 
                                    i
                                    ,
                                    j
                                 
                              
                              (
                              x
                              ,
                              
                                 
                                    x
                                 
                                 
                                    ′
                                 
                              
                              )
                              =
                              
                                 
                                    
                                       
                                          V
                                       
                                       
                                          ijkl
                                       
                                       
                                          ″
                                       
                                    
                                    (
                                    
                                       
                                          S
                                       
                                       
                                          ijm
                                       
                                    
                                    +
                                    
                                       
                                          P
                                       
                                       
                                          ijm
                                       
                                    
                                    
                                       
                                          x
                                       
                                       
                                          ″
                                       
                                    
                                    +
                                    
                                       
                                          Q
                                       
                                       
                                          ijm
                                       
                                    
                                    
                                       
                                          y
                                       
                                       
                                          ″
                                       
                                    
                                    )
                                 
                                 
                                    
                                       
                                          V
                                       
                                       
                                          ijkm
                                       
                                       
                                          ″
                                       
                                    
                                    (
                                    
                                       
                                          S
                                       
                                       
                                          ijl
                                       
                                    
                                    +
                                    
                                       
                                          P
                                       
                                       
                                          ijl
                                       
                                    
                                    
                                       
                                          x
                                       
                                       
                                          ″
                                       
                                    
                                    +
                                    
                                       
                                          Q
                                       
                                       
                                          ijl
                                       
                                    
                                    
                                       
                                          y
                                       
                                       
                                          ″
                                       
                                    
                                    )
                                 
                              
                              ,
                           
                        
                     where
                        
                           
                              
                                 
                                    
                                    
                                       
                                          
                                             
                                                V
                                             
                                             
                                                ijkl
                                             
                                             
                                                ″
                                             
                                          
                                          =
                                          |
                                          
                                             
                                                R
                                             
                                             
                                                i
                                             
                                             
                                                ″
                                             
                                          
                                          
                                             
                                                R
                                             
                                             
                                                j
                                             
                                             
                                                ″
                                             
                                          
                                          
                                             
                                                R
                                             
                                             
                                                k
                                             
                                             
                                                ″
                                             
                                          
                                          
                                             
                                                R
                                             
                                             
                                                l
                                             
                                             
                                                ″
                                             
                                          
                                          |
                                          ,
                                       
                                    
                                 
                                 
                                    
                                    
                                       
                                          
                                             
                                                S
                                             
                                             
                                                ijl
                                             
                                          
                                          =
                                          -
                                          x
                                          |
                                          
                                             
                                                E
                                             
                                             
                                                i
                                             
                                          
                                          
                                             
                                                E
                                             
                                             
                                                j
                                             
                                          
                                          
                                             
                                                E
                                             
                                             
                                                l
                                             
                                          
                                          |
                                          +
                                          y
                                          |
                                          
                                             
                                                F
                                             
                                             
                                                i
                                             
                                          
                                          
                                             
                                                F
                                             
                                             
                                                j
                                             
                                          
                                          
                                             
                                                F
                                             
                                             
                                                l
                                             
                                          
                                          |
                                          ,
                                       
                                    
                                 
                                 
                                    
                                    
                                       
                                          
                                             
                                                P
                                             
                                             
                                                ijl
                                             
                                          
                                          =
                                          -
                                          |
                                          
                                             
                                                G
                                             
                                             
                                                i
                                             
                                          
                                          
                                             
                                                G
                                             
                                             
                                                j
                                             
                                          
                                          
                                             
                                                G
                                             
                                             
                                                l
                                             
                                          
                                          |
                                          ,
                                       
                                    
                                 
                                 
                                    
                                    
                                       
                                          
                                             
                                                Q
                                             
                                             
                                                ijl
                                             
                                          
                                          =
                                          |
                                          
                                             
                                                H
                                             
                                             
                                                i
                                             
                                          
                                          
                                             
                                                H
                                             
                                             
                                                j
                                             
                                          
                                          
                                             
                                                H
                                             
                                             
                                                l
                                             
                                          
                                          |
                                          ,
                                       
                                    
                                 
                              
                           
                        
                     with 
                        
                           
                              
                                 R
                              
                              
                                 i
                              
                              
                                 ″
                              
                           
                           =
                           
                              
                                 (
                                 
                                    
                                       x
                                    
                                    
                                       i
                                    
                                 
                                 ,
                                 
                                    
                                       y
                                    
                                    
                                       i
                                    
                                 
                                 ,
                                 
                                    
                                       x
                                    
                                    
                                       i
                                    
                                    
                                       ″
                                    
                                 
                                 ,
                                 
                                    
                                       y
                                    
                                    
                                       i
                                    
                                    
                                       ″
                                    
                                 
                                 )
                              
                              
                                 ⊤
                              
                           
                           ,
                           
                           
                              
                                 E
                              
                              
                                 i
                              
                           
                           =
                           
                              
                                 [
                                 
                                    
                                       y
                                    
                                    
                                       i
                                    
                                 
                                 ,
                                 
                                    
                                       x
                                    
                                    
                                       i
                                    
                                    
                                       ″
                                    
                                 
                                 ,
                                 
                                    
                                       y
                                    
                                    
                                       i
                                    
                                    
                                       ″
                                    
                                 
                                 ]
                              
                              
                                 ⊤
                              
                           
                           ,
                           
                           
                              
                                 F
                              
                              
                                 i
                              
                           
                           =
                           
                              
                                 [
                                 
                                    
                                       x
                                    
                                    
                                       i
                                    
                                 
                                 ,
                                 
                                    
                                       x
                                    
                                    
                                       i
                                    
                                    
                                       ″
                                    
                                 
                                 ,
                                 
                                    
                                       y
                                    
                                    
                                       i
                                    
                                    
                                       ″
                                    
                                 
                                 ]
                              
                              
                                 ⊤
                              
                           
                           ,
                           
                           
                              
                                 G
                              
                              
                                 i
                              
                           
                           =
                           
                              
                                 [
                                 
                                    
                                       x
                                    
                                    
                                       i
                                    
                                 
                                 ,
                                 
                                    
                                       y
                                    
                                    
                                       i
                                    
                                 
                                 ,
                                 
                                    
                                       y
                                    
                                    
                                       i
                                    
                                    
                                       ″
                                    
                                 
                                 ]
                              
                              
                                 ⊤
                              
                           
                           ,
                           
                           
                              
                                 H
                              
                              
                                 i
                              
                           
                           =
                           
                              
                                 [
                                 
                                    
                                       x
                                    
                                    
                                       i
                                    
                                 
                                 ,
                                 
                                    
                                       y
                                    
                                    
                                       i
                                    
                                 
                                 ,
                                 
                                    
                                       x
                                    
                                    
                                       i
                                    
                                    
                                       ″
                                    
                                 
                                 ]
                              
                              
                                 ⊤
                              
                           
                        
                      and 
                        
                           |
                           .
                           |
                        
                      denotes determinant.

Once the invariant projective coordinates from cross-ratio of planes is computed we can define the geometric constraint in (2) by rearranging (8):
                        
                           (9)
                           
                              
                                 
                                    C
                                 
                                 
                                    i
                                    ,
                                    j
                                 
                              
                              (
                              x
                              ,
                              
                                 
                                    x
                                 
                                 
                                    ′
                                 
                              
                              )
                              
                                 
                                    V
                                 
                                 
                                    ijkm
                                 
                                 
                                    ″
                                 
                              
                              (
                              
                                 
                                    S
                                 
                                 
                                    ijl
                                 
                              
                              +
                              
                                 
                                    P
                                 
                                 
                                    ijl
                                 
                              
                              
                                 
                                    x
                                 
                                 
                                    ″
                                 
                              
                              +
                              
                                 
                                    Q
                                 
                                 
                                    ijl
                                 
                              
                              
                                 
                                    y
                                 
                                 
                                    ″
                                 
                              
                              )
                              -
                              
                                 
                                    V
                                 
                                 
                                    ijkl
                                 
                                 
                                    ″
                                 
                              
                              (
                              
                                 
                                    S
                                 
                                 
                                    ijm
                                 
                              
                              +
                              
                                 
                                    P
                                 
                                 
                                    ijm
                                 
                              
                              
                                 
                                    x
                                 
                                 
                                    ″
                                 
                              
                              +
                              
                                 
                                    Q
                                 
                                 
                                    ijm
                                 
                              
                              
                                 
                                    y
                                 
                                 
                                    ″
                                 
                              
                              )
                              =
                              0
                              .
                           
                        
                     
                  

Substituting 
                        
                           
                              
                                 x
                              
                              
                                 ″
                              
                           
                           =
                           (
                           
                              
                                 x
                              
                              
                                 ″
                              
                           
                           ,
                           
                           
                              
                                 y
                              
                              
                                 ″
                              
                           
                           )
                        
                      into 
                        
                           
                              
                                 x
                              
                              
                                 ′
                              
                           
                           +
                           u
                           =
                           (
                           
                              
                                 x
                              
                              
                                 ′
                              
                           
                           +
                           u
                           ,
                           
                           
                              
                                 y
                              
                              
                                 ′
                              
                           
                           +
                           v
                           )
                        
                     , (9) can be written as:
                        
                           (10)
                           
                              
                                 
                                    C
                                 
                                 
                                    i
                                    ,
                                    j
                                 
                              
                              (
                              x
                              ,
                              
                                 
                                    x
                                 
                                 
                                    ′
                                 
                              
                              )
                              
                                 
                                    V
                                 
                                 
                                    ijkm
                                 
                                 
                                    ″
                                 
                              
                              (
                              
                                 
                                    S
                                 
                                 
                                    ijl
                                 
                              
                              +
                              
                                 
                                    P
                                 
                                 
                                    ijl
                                 
                              
                              (
                              
                                 
                                    x
                                 
                                 
                                    ′
                                 
                              
                              +
                              u
                              )
                              +
                              
                                 
                                    Q
                                 
                                 
                                    ijl
                                 
                              
                              (
                              
                                 
                                    y
                                 
                                 
                                    ′
                                 
                              
                              +
                              v
                              )
                              )
                              -
                              
                                 
                                    V
                                 
                                 
                                    ijkl
                                 
                                 
                                    ″
                                 
                              
                              (
                              
                                 
                                    S
                                 
                                 
                                    ijm
                                 
                              
                              +
                              
                                 
                                    P
                                 
                                 
                                    ijm
                                 
                              
                              (
                              
                                 
                                    x
                                 
                                 
                                    ′
                                 
                              
                              +
                              u
                              )
                              +
                              
                                 
                                    Q
                                 
                                 
                                    ijm
                                 
                              
                              (
                              
                                 
                                    y
                                 
                                 
                                    ′
                                 
                              
                              +
                              v
                              )
                              )
                              =
                              0
                              .
                           
                        
                     
                  

This equation can be rearranged to form the geometry based optical flow equations introduced in (2), 
                        
                           au
                           +
                           bv
                           +
                           c
                           =
                           0
                        
                     , where:
                        
                           (11)
                           
                              a
                              
                              =
                              
                                 
                                    C
                                 
                                 
                                    i
                                    ,
                                    j
                                 
                              
                              (
                              x
                              ,
                              
                                 
                                    x
                                 
                                 
                                    ′
                                 
                              
                              )
                              
                                 
                                    V
                                 
                                 
                                    ijkm
                                 
                                 
                                    ″
                                 
                              
                              
                                 
                                    P
                                 
                                 
                                    ijl
                                 
                              
                              -
                              
                                 
                                    V
                                 
                                 
                                    ijkl
                                 
                                 
                                    ″
                                 
                              
                              
                                 
                                    P
                                 
                                 
                                    ijm
                                 
                              
                              ,
                           
                        
                     
                     
                        
                           (12)
                           
                              b
                              
                              =
                              
                                 
                                    C
                                 
                                 
                                    i
                                    ,
                                    j
                                 
                              
                              (
                              x
                              ,
                              
                                 
                                    x
                                 
                                 
                                    ′
                                 
                              
                              )
                              
                                 
                                    V
                                 
                                 
                                    ijkm
                                 
                                 
                                    ″
                                 
                              
                              
                                 
                                    Q
                                 
                                 
                                    ijl
                                 
                              
                              -
                              
                                 
                                    V
                                 
                                 
                                    ijkl
                                 
                                 
                                    ″
                                 
                              
                              
                                 
                                    Q
                                 
                                 
                                    ijm
                                 
                              
                              ,
                           
                        
                     
                     
                        
                           (13)
                           
                              c
                              
                              =
                              
                                 
                                    C
                                 
                                 
                                    i
                                    ,
                                    j
                                 
                              
                              (
                              x
                              ,
                              
                                 
                                    x
                                 
                                 
                                    ′
                                 
                              
                              )
                              
                                 
                                    V
                                 
                                 
                                    ijkm
                                 
                                 
                                    ″
                                 
                              
                              (
                              
                                 
                                    S
                                 
                                 
                                    ijl
                                 
                              
                              +
                              
                                 
                                    P
                                 
                                 
                                    ijl
                                 
                              
                              
                                 
                                    x
                                 
                                 
                                    ′
                                 
                              
                              +
                              
                                 
                                    Q
                                 
                                 
                                    ijl
                                 
                              
                              
                                 
                                    y
                                 
                                 
                                    ′
                                 
                              
                              )
                           
                        
                     
                     
                        
                           
                              
                              -
                              
                                 
                                    V
                                 
                                 
                                    ijkl
                                 
                                 
                                    ″
                                 
                              
                              (
                              
                                 
                                    S
                                 
                                 
                                    ijm
                                 
                              
                              +
                              
                                 
                                    P
                                 
                                 
                                    ijm
                                 
                              
                              
                                 
                                    x
                                 
                                 
                                    ′
                                 
                              
                              +
                              
                                 
                                    Q
                                 
                                 
                                    ijm
                                 
                              
                              
                                 
                                    y
                                 
                                 
                                    ′
                                 
                              
                              )
                              .
                           
                        
                     
                  

Here, 
                        
                           a
                           ,
                           b
                        
                      and c are functions of the pencils denoted in Fig. 3, and they are calculated from the image coordinates of a general 3D feature 
                        
                           X
                        
                      and five other salient 3D features 
                        
                           {
                           
                              
                                 X
                              
                              
                                 1
                              
                           
                           ,
                           
                              
                                 X
                              
                              
                                 2
                              
                           
                           ,
                           
                              
                                 X
                              
                              
                                 3
                              
                           
                           ,
                           
                              
                                 X
                              
                              
                                 4
                              
                           
                           ,
                           
                              
                                 X
                              
                              
                                 5
                              
                           
                           }
                        
                      projected at three different viewpoints. We have observed that instead of using consecutive three frames, selecting every fifth frame for 15fps video results in a better geometry due to the increase in camera baseline while satisfying the cyclopean geometry. A possible drawback to extend selection beyond the fifth frame, however, may invalidate the cyclopean constraint, 
                        
                           
                              
                                 C
                              
                              
                                 i
                                 ,
                                 j
                              
                           
                           (
                           x
                           ,
                           
                              
                                 x
                              
                              
                                 ′
                              
                           
                           )
                           =
                           
                              
                                 C
                              
                              
                                 i
                                 ,
                                 j
                              
                           
                           (
                           x
                           ,
                           
                              
                                 x
                              
                              
                                 ″
                              
                           
                           )
                        
                     .

Given the two optical flow equations in (1) and (2), the optical flow vector with two unknowns can be estimated by substitution, which will result in a closed form solution given by:
                        
                           (14)
                           
                              u
                              =
                              
                                 
                                    
                                       
                                          cI
                                       
                                       
                                          y
                                       
                                    
                                    -
                                    
                                       
                                          bI
                                       
                                       
                                          t
                                       
                                    
                                 
                                 
                                    
                                       
                                          bI
                                       
                                       
                                          x
                                       
                                    
                                    -
                                    
                                       
                                          aI
                                       
                                       
                                          y
                                       
                                    
                                 
                              
                              ,
                              
                              v
                              =
                              
                                 
                                    
                                       
                                          aI
                                       
                                       
                                          t
                                       
                                    
                                    -
                                    
                                       
                                          cI
                                       
                                       
                                          x
                                       
                                    
                                 
                                 
                                    
                                       
                                          bI
                                       
                                       
                                          x
                                       
                                    
                                    -
                                    
                                       
                                          aI
                                       
                                       
                                          y
                                       
                                    
                                 
                              
                              ,
                           
                        
                     where 
                        
                           a
                           ,
                           b
                        
                      and c parameters are given in (11)–(13).

An important observation regarding the closed form solutions in (14) is their dependency on the image gradients which are usually noisy. Following the common treatment, we conjecture this undesired effect can be reduced by taking the average of the spatiotemporal gradient in the neighborhood of the tracked feature. Considering that we can use multiple salient feature configurations the averaging of the spatiotemporal gradients results in the following cost function:
                        
                           (15)
                           
                              E
                              (
                              
                                 
                                    x
                                 
                                 
                                    i
                                 
                              
                              )
                              =
                              (
                              1
                              -
                              λ
                              )
                              
                                 
                                    E
                                 
                                 
                                    appearance
                                 
                              
                              (
                              
                                 
                                    x
                                 
                                 
                                    i
                                 
                              
                              )
                              +
                              λ
                              
                                 
                                    E
                                 
                                 
                                    geometry
                                 
                              
                              (
                              
                                 
                                    x
                                 
                                 
                                    i
                                 
                              
                              )
                              ,
                           
                        
                     where 
                        
                           λ
                        
                      is weighting parameter between the two terms, and:
                        
                           (16)
                           
                              
                                 
                                    E
                                 
                                 
                                    appearance
                                 
                              
                              (
                              
                                 
                                    x
                                 
                                 
                                    i
                                 
                              
                              )
                              =
                              
                                 
                                    1
                                 
                                 
                                    
                                       
                                          N
                                       
                                       
                                          w
                                       
                                    
                                 
                              
                              
                                 
                                    
                                       ∑
                                    
                                    
                                       
                                          
                                             x
                                          
                                          
                                             j
                                          
                                       
                                       ∈
                                       
                                          
                                             W
                                          
                                          
                                             i
                                          
                                       
                                    
                                 
                              
                              
                                 
                                    (
                                    
                                       
                                          u
                                       
                                       
                                          i
                                       
                                    
                                    
                                       
                                          I
                                       
                                       
                                          
                                             
                                                x
                                             
                                             
                                                j
                                             
                                          
                                       
                                    
                                    +
                                    
                                       
                                          v
                                       
                                       
                                          i
                                       
                                    
                                    
                                       
                                          I
                                       
                                       
                                          
                                             
                                                y
                                             
                                             
                                                j
                                             
                                          
                                       
                                    
                                    +
                                    
                                       
                                          I
                                       
                                       
                                          
                                             
                                                t
                                             
                                             
                                                j
                                             
                                          
                                       
                                    
                                    )
                                 
                                 
                                    2
                                 
                              
                              ,
                           
                        
                     
                     
                        
                           (17)
                           
                              
                                 
                                    E
                                 
                                 
                                    geometry
                                 
                              
                              (
                              
                                 
                                    x
                                 
                                 
                                    i
                                 
                              
                              )
                              =
                              
                                 
                                    (
                                    
                                       
                                          u
                                       
                                       
                                          i
                                       
                                    
                                    a
                                    +
                                    
                                       
                                          v
                                       
                                       
                                          i
                                       
                                    
                                    b
                                    +
                                    c
                                    )
                                 
                                 
                                    2
                                 
                              
                              ,
                           
                        
                     where 
                        
                           
                              
                                 W
                              
                              
                                 i
                              
                           
                        
                      denotes the neighborhood of 
                        
                           
                              
                                 x
                              
                              
                                 i
                              
                           
                        
                     . The window defines the number of pixels, 
                        
                           
                              
                                 N
                              
                              
                                 w
                              
                           
                        
                     , used to estimate the smoothed spatiotemporal gradient. Minimizing the cost function in (15) by taking its derivative and rearranging the terms result in the new closed form optical flow solution given by:
                        
                           (18)
                           
                              
                                 
                                    u
                                 
                                 
                                    i
                                 
                              
                              =
                              
                                 
                                    
                                       
                                          e
                                       
                                       
                                          1
                                       
                                    
                                    
                                       
                                          f
                                       
                                       
                                          2
                                       
                                    
                                    -
                                    
                                       
                                          f
                                       
                                       
                                          1
                                       
                                    
                                    
                                       
                                          e
                                       
                                       
                                          2
                                       
                                    
                                 
                                 
                                    
                                       
                                          d
                                       
                                       
                                          1
                                       
                                    
                                    
                                       
                                          e
                                       
                                       
                                          2
                                       
                                    
                                    -
                                    
                                       
                                          e
                                       
                                       
                                          1
                                       
                                    
                                    
                                       
                                          d
                                       
                                       
                                          2
                                       
                                    
                                 
                              
                              ,
                              
                              
                                 
                                    v
                                 
                                 
                                    i
                                 
                              
                              =
                              
                                 
                                    
                                       
                                          f
                                       
                                       
                                          1
                                       
                                    
                                    
                                       
                                          d
                                       
                                       
                                          2
                                       
                                    
                                    -
                                    
                                       
                                          d
                                       
                                       
                                          1
                                       
                                    
                                    
                                       
                                          f
                                       
                                       
                                          2
                                       
                                    
                                 
                                 
                                    
                                       
                                          d
                                       
                                       
                                          1
                                       
                                    
                                    
                                       
                                          e
                                       
                                       
                                          2
                                       
                                    
                                    -
                                    
                                       
                                          e
                                       
                                       
                                          1
                                       
                                    
                                    
                                       
                                          d
                                       
                                       
                                          2
                                       
                                    
                                 
                              
                           
                        
                     where
                        
                           
                              
                                 
                                    
                                    
                                       
                                          
                                             
                                                d
                                             
                                             
                                                1
                                             
                                          
                                          =
                                          
                                             
                                                1
                                                -
                                                λ
                                             
                                             
                                                
                                                   
                                                      N
                                                   
                                                   
                                                      w
                                                   
                                                
                                             
                                          
                                          
                                             
                                                
                                                   ∑
                                                
                                                
                                                   
                                                      
                                                         x
                                                      
                                                      
                                                         j
                                                      
                                                   
                                                   ∈
                                                   
                                                      
                                                         W
                                                      
                                                      
                                                         i
                                                      
                                                   
                                                
                                             
                                          
                                          (
                                          
                                             
                                                I
                                             
                                             
                                                
                                                   
                                                      x
                                                   
                                                   
                                                      j
                                                   
                                                
                                             
                                          
                                          
                                             
                                                I
                                             
                                             
                                                
                                                   
                                                      x
                                                   
                                                   
                                                      j
                                                   
                                                
                                             
                                          
                                          )
                                          +
                                          λ
                                          (
                                          
                                             
                                                a
                                             
                                             
                                                2
                                             
                                          
                                          )
                                          ,
                                       
                                    
                                 
                                 
                                    
                                    
                                       
                                          
                                             
                                                e
                                             
                                             
                                                1
                                             
                                          
                                          =
                                          
                                             
                                                1
                                                -
                                                λ
                                             
                                             
                                                
                                                   
                                                      N
                                                   
                                                   
                                                      w
                                                   
                                                
                                             
                                          
                                          
                                             
                                                
                                                   ∑
                                                
                                                
                                                   
                                                      
                                                         x
                                                      
                                                      
                                                         j
                                                      
                                                   
                                                   ∈
                                                   
                                                      
                                                         W
                                                      
                                                      
                                                         i
                                                      
                                                   
                                                
                                             
                                          
                                          (
                                          
                                             
                                                I
                                             
                                             
                                                
                                                   
                                                      x
                                                   
                                                   
                                                      j
                                                   
                                                
                                             
                                          
                                          
                                             
                                                I
                                             
                                             
                                                
                                                   
                                                      y
                                                   
                                                   
                                                      j
                                                   
                                                
                                             
                                          
                                          )
                                          +
                                          λ
                                          (
                                          ab
                                          )
                                          ,
                                       
                                    
                                 
                                 
                                    
                                    
                                       
                                          
                                             
                                                f
                                             
                                             
                                                1
                                             
                                          
                                          =
                                          
                                             
                                                1
                                                -
                                                λ
                                             
                                             
                                                
                                                   
                                                      N
                                                   
                                                   
                                                      w
                                                   
                                                
                                             
                                          
                                          
                                             
                                                
                                                   ∑
                                                
                                                
                                                   
                                                      
                                                         x
                                                      
                                                      
                                                         j
                                                      
                                                   
                                                   ∈
                                                   
                                                      
                                                         W
                                                      
                                                      
                                                         i
                                                      
                                                   
                                                
                                             
                                          
                                          (
                                          
                                             
                                                I
                                             
                                             
                                                
                                                   
                                                      x
                                                   
                                                   
                                                      j
                                                   
                                                
                                             
                                          
                                          
                                             
                                                I
                                             
                                             
                                                
                                                   
                                                      t
                                                   
                                                   
                                                      j
                                                   
                                                
                                             
                                          
                                          )
                                          +
                                          λ
                                          (
                                          ac
                                          )
                                          ,
                                       
                                    
                                 
                                 
                                    
                                    
                                       
                                          
                                             
                                                d
                                             
                                             
                                                2
                                             
                                          
                                          =
                                          
                                             
                                                1
                                                -
                                                λ
                                             
                                             
                                                
                                                   
                                                      N
                                                   
                                                   
                                                      w
                                                   
                                                
                                             
                                          
                                          
                                             
                                                
                                                   ∑
                                                
                                                
                                                   
                                                      
                                                         x
                                                      
                                                      
                                                         j
                                                      
                                                   
                                                   ∈
                                                   
                                                      
                                                         W
                                                      
                                                      
                                                         i
                                                      
                                                   
                                                
                                             
                                          
                                          (
                                          
                                             
                                                I
                                             
                                             
                                                
                                                   
                                                      y
                                                   
                                                   
                                                      j
                                                   
                                                
                                             
                                          
                                          
                                             
                                                I
                                             
                                             
                                                
                                                   
                                                      x
                                                   
                                                   
                                                      j
                                                   
                                                
                                             
                                          
                                          )
                                          +
                                          λ
                                          (
                                          ab
                                          )
                                          ,
                                       
                                    
                                 
                                 
                                    
                                    
                                       
                                          
                                             
                                                e
                                             
                                             
                                                2
                                             
                                          
                                          =
                                          
                                             
                                                1
                                                -
                                                λ
                                             
                                             
                                                
                                                   
                                                      N
                                                   
                                                   
                                                      w
                                                   
                                                
                                             
                                          
                                          
                                             
                                                
                                                   ∑
                                                
                                                
                                                   
                                                      
                                                         x
                                                      
                                                      
                                                         j
                                                      
                                                   
                                                   ∈
                                                   
                                                      
                                                         W
                                                      
                                                      
                                                         i
                                                      
                                                   
                                                
                                             
                                          
                                          (
                                          
                                             
                                                I
                                             
                                             
                                                
                                                   
                                                      y
                                                   
                                                   
                                                      j
                                                   
                                                
                                             
                                          
                                          
                                             
                                                I
                                             
                                             
                                                
                                                   
                                                      y
                                                   
                                                   
                                                      j
                                                   
                                                
                                             
                                          
                                          )
                                          +
                                          λ
                                          (
                                          
                                             
                                                b
                                             
                                             
                                                2
                                             
                                          
                                          )
                                          ,
                                       
                                    
                                 
                                 
                                    
                                    
                                       
                                          
                                             
                                                f
                                             
                                             
                                                2
                                             
                                          
                                          =
                                          
                                             
                                                1
                                                -
                                                λ
                                             
                                             
                                                
                                                   
                                                      N
                                                   
                                                   
                                                      w
                                                   
                                                
                                             
                                          
                                          
                                             
                                                
                                                   ∑
                                                
                                                
                                                   
                                                      
                                                         x
                                                      
                                                      
                                                         j
                                                      
                                                   
                                                   ∈
                                                   
                                                      
                                                         W
                                                      
                                                      
                                                         i
                                                      
                                                   
                                                
                                             
                                          
                                          (
                                          
                                             
                                                I
                                             
                                             
                                                
                                                   
                                                      y
                                                   
                                                   
                                                      j
                                                   
                                                
                                             
                                          
                                          
                                             
                                                I
                                             
                                             
                                                
                                                   
                                                      t
                                                   
                                                   
                                                      j
                                                   
                                                
                                             
                                          
                                          )
                                          +
                                          λ
                                          (
                                          bc
                                          )
                                          .
                                       
                                    
                                 
                              
                           
                        
                     
                  

The details of the proposed tracking algorithm is given in Algorithm 1. We should note that since the proposed approach requires three frames, the geometry term in (15) is initially ignored by setting 
                        
                           λ
                           =
                           0
                        
                      for the first two frames in an image stream. In this case, the optical flow estimation reduces to appearance only solution discussed in [14].
                        Algorithm 1
                        Proposed feature tracking algorithm. 
                              
                                 
                              
                           
                        


                     Discussion on occlusions: Tracking features during occlusions or recovering from occlusions are two important problems that are still unresolved in the field. In the following discussion, we assume that about half of the tracked features are not occluded and can serve as salient features during sampling to track the occluded features. Considering that the tracked template changes dramatically during an occlusion, the feature can be labeled as lost or occluded by computing the similarity between the tracked template and the model template using sum of square differences. In the case when the template similarity dramatically reduces, the 
                        
                           λ
                        
                      parameter in (15), which is typically set to 0.5 for normal tracking, is changed to 1, such that the tracking is performed purely based on geometry until the feature is visible again. At the time the occlusion is detected, a model template is also recorded to test if occlusion is resolved in future frames. This test is realized by comparing the current template similarity score with the similarity score recorded right before the occlusion has occurred. Similar to the case before the occlusion happens, the selected set of five salient features for a tracked point is different at each frame to guarantee the best geometry configuration for the feature.

In Section 3, we introduced five “salient” features to estimate the optical flow for a general feature. The salient features, however, are not known a priori, and due to their geometric configuration they may be different for each tracked feature. Let there be N features at frame t, such that there are 
                        
                           M
                           =
                           C
                           (
                           N
                           ,
                           5
                           )
                        
                      combinations of subsets in 
                        
                           S
                           =
                           {
                           
                              
                                 S
                              
                              
                                 i
                              
                              
                                 (
                                 5
                                 )
                              
                           
                           :
                           i
                           ∈
                           N
                           ;
                           1
                           ⩽
                           i
                           ⩽
                           M
                           }
                        
                     . For a general feature, we conjecture that there exists a number of subsets 
                        
                           
                              
                                 S
                              
                              
                                 i
                              
                              
                                 (
                                 5
                                 )
                              
                           
                        
                      that provides the necessary geometry shown in Fig. 3 to estimate its position at frame t. The selection of the subset from an unknown distribution and its geometric saliency suggests us to define a measure to judge the quality of the position estimate for the general feature. We define this measure as the probability of the selected 
                        
                           
                              
                                 S
                              
                              
                                 i
                              
                              
                                 (
                                 5
                                 )
                              
                           
                        
                      being a salient set given the appearance of the general feature, 
                        
                           
                              
                                 W
                              
                              
                                 i
                              
                           
                        
                     , and the historical trajectories 
                        
                           
                              
                                 T
                              
                              
                                 i
                              
                           
                        
                      of salient feature candidates: 
                        
                           P
                           
                              
                                 
                                    
                                       
                                          S
                                       
                                       
                                          i
                                       
                                       
                                          (
                                          5
                                          )
                                       
                                    
                                    |
                                    
                                       
                                          T
                                       
                                       
                                          i
                                       
                                    
                                    ,
                                    
                                       
                                          W
                                       
                                       
                                          i
                                       
                                    
                                 
                              
                           
                        
                     . Considering that the trajectories of salient features and the appearance of the general feature are independent, applying the Bayes’ rule results in:
                        
                           (19)
                           
                              P
                              
                                 
                                    
                                       
                                          
                                             S
                                          
                                          
                                             i
                                          
                                          
                                             (
                                             5
                                             )
                                          
                                       
                                       |
                                       
                                          
                                             T
                                          
                                          
                                             i
                                          
                                       
                                       ,
                                       
                                          
                                             W
                                          
                                          
                                             i
                                          
                                       
                                    
                                 
                              
                              =
                              
                                 
                                    P
                                    (
                                    
                                       
                                          S
                                       
                                       
                                          i
                                       
                                       
                                          (
                                          5
                                          )
                                       
                                    
                                    )
                                    P
                                    
                                       
                                          
                                             
                                                
                                                   T
                                                
                                                
                                                   i
                                                
                                             
                                             |
                                             
                                                
                                                   S
                                                
                                                
                                                   i
                                                
                                                
                                                   (
                                                   5
                                                   )
                                                
                                             
                                          
                                       
                                    
                                    P
                                    
                                       
                                          
                                             
                                                
                                                   W
                                                
                                                
                                                   i
                                                
                                             
                                             |
                                             
                                                
                                                   S
                                                
                                                
                                                   i
                                                
                                                
                                                   (
                                                   5
                                                   )
                                                
                                             
                                          
                                       
                                    
                                 
                                 
                                    P
                                    (
                                    
                                       
                                          T
                                       
                                       
                                          i
                                       
                                    
                                    )
                                    P
                                    (
                                    
                                       
                                          W
                                       
                                       
                                          i
                                       
                                    
                                    )
                                 
                              
                              ,
                           
                        
                     where 
                        
                           P
                           (
                           
                              
                                 S
                              
                              
                                 i
                              
                              
                                 (
                                 5
                                 )
                              
                           
                           )
                           ,
                           P
                           (
                           
                              
                                 T
                              
                              
                                 i
                              
                           
                           )
                        
                      and 
                        
                           P
                           (
                           
                              
                                 W
                              
                              
                                 i
                              
                           
                           )
                        
                      are uniformly distributed, hence have no effect in the maximum a posteriori (MAP) estimate. The second term, 
                        
                           P
                           
                              
                                 
                                    
                                       
                                          T
                                       
                                       
                                          i
                                       
                                    
                                    |
                                    
                                       
                                          S
                                       
                                       
                                          i
                                       
                                       
                                          (
                                          5
                                          )
                                       
                                    
                                 
                              
                           
                        
                     , in (19) enforces geometric saliency of the estimated position. This term can be computed from the equivalency of the projective invariant coordinates, 
                        
                           
                              
                                 C
                              
                              
                                 i
                                 ,
                                 j
                              
                           
                           (
                           x
                           ,
                           
                              
                                 x
                              
                              
                                 ′
                              
                           
                           )
                           =
                           
                              
                                 C
                              
                              
                                 i
                                 ,
                                 j
                              
                           
                           (
                           x
                           ,
                           
                              
                                 x
                              
                              
                                 ″
                              
                           
                           )
                        
                     , across frames 1, 2 and 3. We conjecture that the difference between the projective invariants are distributed with zero mean Gaussian distribution:
                        
                           (20)
                           
                              P
                              
                                 
                                    
                                       
                                          
                                             T
                                          
                                          
                                             i
                                          
                                       
                                       |
                                       
                                          
                                             S
                                          
                                          
                                             i
                                          
                                          
                                             (
                                             5
                                             )
                                          
                                       
                                    
                                 
                              
                              =
                              
                                 
                                    1
                                 
                                 
                                    
                                       
                                          2
                                          π
                                          
                                             
                                                σ
                                             
                                             
                                                c
                                             
                                             
                                                2
                                             
                                          
                                       
                                    
                                 
                              
                              exp
                              
                                 
                                    
                                       -
                                       
                                          
                                             d
                                             
                                                
                                                   
                                                      
                                                         
                                                            
                                                               C
                                                            
                                                            
                                                               i
                                                               ,
                                                               j
                                                            
                                                         
                                                         (
                                                         x
                                                         ,
                                                         
                                                            
                                                               x
                                                            
                                                            
                                                               ′
                                                            
                                                         
                                                         )
                                                         ,
                                                         
                                                            
                                                               C
                                                            
                                                            
                                                               i
                                                               ,
                                                               j
                                                            
                                                         
                                                         (
                                                         x
                                                         ,
                                                         
                                                            
                                                               x
                                                            
                                                            
                                                               ″
                                                            
                                                         
                                                         )
                                                      
                                                   
                                                
                                                
                                                   2
                                                
                                             
                                          
                                          
                                             2
                                             
                                                
                                                   σ
                                                
                                                
                                                   c
                                                
                                                
                                                   2
                                                
                                             
                                          
                                       
                                    
                                 
                              
                              ,
                           
                        
                     where 
                        
                           
                              
                                 σ
                              
                              
                                 c
                              
                           
                        
                      controls disagreement between the two projective invariant coordinates. Considering that the invariants may not be exactly the same between the consecutive frames, for instance due to the tracking bias introduced by the appearance term, a small 
                        
                           
                              
                                 σ
                              
                              
                                 c
                              
                           
                        
                     , such as 
                        
                           
                              
                                 σ
                              
                              
                                 c
                              
                           
                           =
                           1
                        
                     , offsets small variations.

The third term in (19), 
                        
                           P
                           
                              
                                 
                                    
                                       
                                          W
                                       
                                       
                                          i
                                       
                                    
                                    |
                                    
                                       
                                          S
                                       
                                       
                                          i
                                       
                                       
                                          (
                                          5
                                          )
                                       
                                    
                                 
                              
                           
                        
                     , enforces similarity of the appearance of the tracked feature computed using geometric constraints. We compute this term by measuring the similarity of the model template to the tracked template 
                        
                           
                              
                                 W
                              
                              
                                 ″
                              
                           
                        
                      at 
                        
                           
                              
                                 x
                              
                              
                                 ″
                              
                           
                        
                     :
                        
                           (21)
                           
                              P
                              
                                 
                                    
                                       
                                          
                                             W
                                          
                                          
                                             i
                                          
                                       
                                       |
                                       
                                          
                                             S
                                          
                                          
                                             i
                                          
                                          
                                             (
                                             5
                                             )
                                          
                                       
                                    
                                 
                              
                              =
                              
                                 
                                    1
                                 
                                 
                                    
                                       
                                          2
                                          π
                                          
                                             
                                                σ
                                             
                                             
                                                a
                                             
                                             
                                                2
                                             
                                          
                                       
                                    
                                 
                              
                              exp
                              
                                 
                                    
                                       -
                                       
                                          
                                             d
                                             
                                                
                                                   
                                                      
                                                         
                                                            
                                                               W
                                                            
                                                            
                                                               i
                                                            
                                                         
                                                         ,
                                                         
                                                            
                                                               W
                                                            
                                                            
                                                               ″
                                                            
                                                         
                                                      
                                                   
                                                
                                                
                                                   2
                                                
                                             
                                          
                                          
                                             2
                                             
                                                
                                                   σ
                                                
                                                
                                                   a
                                                
                                                
                                                   2
                                                
                                             
                                          
                                       
                                    
                                 
                              
                              ,
                           
                        
                     where 
                        
                           
                              
                                 σ
                              
                              
                                 a
                              
                           
                        
                      controls appearance similarity to allow slight appearance changes in time. We used 
                        
                           
                              
                                 σ
                              
                              
                                 a
                              
                           
                           =
                           10
                        
                      for all our experiments. Introducing (20) and (21) into (19), we reformulate the estimation problem for the Gaussian kernel in (19):
                        
                           (22)
                           
                              P
                              
                                 
                                    
                                       
                                          
                                             S
                                          
                                          
                                             i
                                          
                                          
                                             (
                                             5
                                             )
                                          
                                       
                                       |
                                       
                                          
                                             T
                                          
                                          
                                             i
                                          
                                       
                                       ,
                                       
                                          
                                             W
                                          
                                          
                                             i
                                          
                                       
                                    
                                 
                              
                              =
                              C
                              exp
                              
                                 
                                    
                                       -
                                       
                                          
                                             1
                                          
                                          
                                             2
                                          
                                       
                                       
                                          
                                             d
                                          
                                          
                                             i
                                          
                                          
                                             ⊤
                                          
                                       
                                       
                                          
                                             Σ
                                          
                                          
                                             -
                                             1
                                          
                                       
                                       
                                          
                                             d
                                          
                                          
                                             i
                                          
                                       
                                    
                                 
                              
                              ,
                           
                        
                     where C is constant and:
                        
                           
                              
                                 
                                    d
                                 
                                 
                                    i
                                 
                              
                              =
                              
                                 
                                    
                                       
                                          
                                             
                                                d
                                                
                                                   
                                                      
                                                         
                                                            
                                                               
                                                                  C
                                                               
                                                               
                                                                  i
                                                                  ,
                                                                  j
                                                               
                                                            
                                                            (
                                                            x
                                                            ,
                                                            
                                                               
                                                                  x
                                                               
                                                               
                                                                  ′
                                                               
                                                            
                                                            )
                                                            ,
                                                            
                                                               
                                                                  C
                                                               
                                                               
                                                                  i
                                                                  ,
                                                                  j
                                                               
                                                            
                                                            (
                                                            x
                                                            ,
                                                            
                                                               
                                                                  x
                                                               
                                                               
                                                                  ″
                                                               
                                                            
                                                            )
                                                         
                                                      
                                                   
                                                   
                                                      2
                                                   
                                                
                                             
                                          
                                          
                                             
                                                d
                                                
                                                   
                                                      
                                                         
                                                            
                                                               
                                                                  W
                                                               
                                                               
                                                                  i
                                                               
                                                            
                                                            ,
                                                            
                                                               
                                                                  W
                                                               
                                                               
                                                                  ″
                                                               
                                                            
                                                         
                                                      
                                                   
                                                   
                                                      2
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                              
                              
                              and
                              
                              Σ
                              =
                              
                                 
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      σ
                                                   
                                                   
                                                      c
                                                   
                                                   
                                                      2
                                                   
                                                
                                             
                                             
                                                0
                                             
                                          
                                          
                                             
                                                0
                                             
                                             
                                                
                                                   
                                                      σ
                                                   
                                                   
                                                      a
                                                   
                                                   
                                                      2
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                              
                              .
                           
                        
                     
                  

This equation quantifies the shared geometry and appearance similarity between the tracked and estimated position of the feature; hence, it provides us with the ability to judge its quality better than appearance-only based measures. In order to reduce the computational complexity of the selection process in (22), we use importance sampling to model the underlying distribution. In particular, for all the experiments, we chose 50 samples from S to represent underlying distribution. This distribution can be visualized in 2D in terms of 
                        
                           
                              
                                 x
                              
                              
                                 ″
                              
                           
                        
                      from the selected 
                        
                           
                              
                                 S
                              
                              
                                 i
                              
                              
                                 (
                                 5
                                 )
                              
                           
                        
                      and is shown in Fig. 6
                     , where 
                        
                           
                              
                                 x
                              
                              
                                 ″
                              
                           
                           =
                           
                              
                                 x
                              
                              
                                 ′
                              
                           
                           +
                           u
                        
                     , and 
                        
                           u
                        
                      refers to Eq. (18) by setting 
                        
                           λ
                           =
                           1
                        
                     .

@&#EXPERIMENTS@&#

In order to analyze the performance of the proposed approach, we conducted two sets of experiments with different error measures. For both experiments, we compared the performance of our approach against KLT tracking [14], the joint feature tracking (JFT) [17] and robust feature matching using epipolar geometry and RANSAC [30]. All four methods share the same code basis and parameters to remove any implementation bias. In our comparisons, for KLT and JFT, we detect a set of features for the first frame using the Harris corner detector and track them without adding additional features for lost features. For robust feature matching, we detect feature points for two consecutive frames and perform template matching. In order to enforce Epipolar geometry we select the inlier set of the RANSAC iterations as the final matching feature set. Aside from different the error measures, other differences between the two experiments are the types of image sequences and the treatment of the interest points being tracked.

For this experiment, we use a set of standard and home generated sequences. For all approaches we initially detect a set of interest points for the first frame and do not introduce any features when the points are lost during tracking. This setup lets us quantitatively compare the quality and number of tracked features until the last frame. For all test sequences, the template is defined as a 
                           
                              7
                              ×
                              7
                           
                         window and we set the maximum number of iterations to ten in case the stopping criterion is not met. During tracking, we select a generous appearance similarity threshold to retain as many features as possible for all four methods. Especially, in RANSAC for the robust matching, the desired confidence for the estimated fundamental matrix and the maximum distance from a point to corresponding epipolar line are respectively set to 0.89 and 5 (in pixels). These choices are made to keep a comparable number of features at the end of the sequence. For lower threshold values, we observed that there were many outliers in various frames for each sequence.

In our first experiment, we use the standard hotel sequence which has typically been used for testing factorization based 3D recovery methods. The sequence is composed of images captured by a camera moving around a toy house generating significant variation in appearance. The appearance variation results in poor tracking performance for the appearance only based methods. The tracking for the proposed approach is observed to be better than the alternative methods. Fig. 7
                         shows tracked features for all four methods. We observe that the noise similar to that shown in second column of Fig. 7 resulted in significant tracking error for the KLT and JFT methods. The robust feature matching and the proposed methods successfully continue to track features well due to the geometry constraint. A significant difference between the two is the amount of features tracked. Compared to robust matching approach, the proposed method has significantly more features because of the application of the geometry constraint during the tracking iterations.

In order to evaluate the accuracy of the proposed tracking method compared with the KLT, JFT and robust matching, we compute the reprojection error by exploiting structure from motion. In particular, we first reconstruct the 3D feature points locations and the camera matrices by factorizing the trajectory matrix [31] which results in recovered 3D feature points shown in Fig. 8
                        . We conjecture that if the tracking is accurate then the reprojected 3D feature points and the tracked features should coincide in each frame and the Euclidean distances between them should be small. In Fig. 9
                        , we report the performance of each method in terms of the mean and variance of reprojection error as a function of the frame number. As shown in the figure the proposed approach performs the best both in terms of mean error and its standard deviation. In particular the standard deviation is significantly low due to the global scene geometry constraint included in the cost function. Compared to the JFT and KLT methods, the robust matching approach has better reprojection error performance due to the 3D geometry constraint introduced via Epipolar geometry. As expected the JFT tracking method which enforces local affine constraints has lower mean error than the KLT method; however, both JFT and KLT standard deviations are almost identical and are considerably higher than our approach. An interesting observation is the performance of the robust matching versus the proposed approach at the very beginning of the sequence for about 3 frames. Considering that our approach requires at least 3 frames to establish the geometry, we see robust matching has slightly better performance. The rest of the sequence, however, the geometric constraints make the proposed approach perform better.

In order to evaluate the performance of the methods in the case when features get occluded for a certain amount of time, we have tested our approach with two other sequences. In particular, one of the sequences is the home-generated “meeting room sequence”, and the other one is the standard “flower garden sequence”. The meeting room sequence consists of 207 frames in which a person creates significant occlusions for many tracked features as he walks in the scene. We set the number of initial features to 150 and no additional features are introduced during tracking. As shown in Fig. 10
                        , both the KLT and JFT methods have significant tracking errors compared to the proposed method and the robust matching approach. During the occlusion of scene features, significant appearance changes result in lost features for KLT, JFT and robust matching methods. For all four methods, in order to retain as many features as possible during tracking we choose a very loose threshold for the appearance similarity term. We should note that in the case the appearance threshold is very conservative, then the number of features dramatically drops to zero features at the end of the sequence for all KLT, JFT and robust matching methods while our approach retains them. For both the KLT and JFT methods as the features get occluded by the human subject, it is observed that the trajectories are significantly distorted. This observation is expected for the KLT method which is purely based on appearance features. As for JFT, although the method enforces the local affine constraint, the support region for affine cannot handle the occlusion, especially when the nearby features are also occluded. We should note that increasing the support region for the local affine constraint introduces other problems due to regions with the depth discontinuities in the scene. The results robust matching approach is capable of geometrically eliminating incorrect feature trajectories as outliers. This elimination process, however, looses many features due to Epipolar inconsistencies. The proposed method, on the other hand, is able to estimate the trajectories of features under occlusion. This is achieved primarily due to the geometric updates in motion estimation process. In our approach, features that are tracked during they are occluded are labeled by yellow color in Fig. 10.

The flower garden sequence (Fig. 11
                        ) contains more parallax compared to the other sequences. In this sequence, similar to the meeting room sequence, we intentionally selected a generous appearance similarity threshold to retain as many features as possible for all four methods. For low threshold values, we observed that the JFT, KLT and robust matching methods lose almost all the features during the occlusions. The large variation in the viewpoint causes significant appearance changes for features closer to the camera. Temporary feature occlusions due to the tree motion add a significant challenge for the feature tracking problem. Despite the low appearance threshold, we observe that some of the features which are occluded by the tree trunk were not tracked due to the aforementioned problems. Moreover, there are some tracking errors along the tree trunk due to the depth discontinuity at edge of the trunk. For this sequence JFT tracked more features than KLT. However, the trajectories of the occluded features were incorrect. The robust matching approach was able to successfully remove the outlier trajectories, but it lost significant number of features. In contrast, the proposed tracking algorithm tracked most of features even during the occlusions.

We also evaluated our approach with three outdoor sequences. Specially, the first sequence is called “campus sequence” representing a regular campus scene containing trees, grass, buildings and people as shown in Fig. 12
                        . The campus sequence is acquired as the camera moves parallel to the scene. In this sequence, we observed that the proposed approach performs better than the JFT and KLT methods, especially when the frames are blurred due to fast camera motion as shown in the second column in Fig. 12. The image appearance changes due to the image blurring, which results in the failure of KLT. Without any geometry constraint, the features tracked by KLT move in incorrect directions. Compared with KLT, JFT tracks features more consistently because it enforces the affine motion constraint (see the third column in Fig. 12); it still, however, cannot perform well due to considering only the neighboring features. Compared to KLT and JFT, robust matching approach tracked features more consistently. For this sequence our proposed method correctly tracked more features specially on the building and the tree compared to KLT, JFT and robust matching, because of the global scene geometry constraint.

Another outdoor sequence is “building sequence”, which consists of 275 frames, as shown in Fig. 13
                        . The building sequence is used to test all four methods when the camera moves toward the scene. In this sequence, similar to the previous sequences, a generous appearance similarity threshold is selected to retain as many features as possible for all four methods. For low threshold values we observed that the JFT, KLT and robust matching methods lose most of the features as the camera gets closer to the scene. The large variation in the viewpoint causes significant appearance changes for features closer to the camera. Despite the low appearance threshold, we observe that the proposed tracking algorithm accurately tracked more features than KLT, JFT and robust matching. We should, however, note that some features tracked by the proposed algorithm are observed to vibrate around their true positions. The main reason for this observations stems from the fact that the 3D geometric constraints is not fully satisfied in the case when the camera moves toward the scene.

The last sequence is captured in a sand dune area in Moses Lake, WA during our experiments for a NASA project on astronaut navigation on lunar surface. While not a typical sequence, the “sand dune sequence” poses extreme challenges for an outdoor environment due to faded and repeated features. In this sequence, features are not distinct and very similar to each other, as shown in Fig. 14
                        . There are no man made objects or trees in the scene except for rocks and sand. The camera is aimed at the ground in the subject’s walking direction. During the experiment, the subject walked over a 111m traverse that formed a rectangular loop. Since the frame rate of the camera is low and the subject is walking fast, there is a lot of motion blurring and small overlap between two consecutive frames. In this experiment, JFT and KLT methods both performed very poor, especially when the camera moves fast-forward (see the second and third columns of Fig. 14). The robust matching method (fourth row in Fig. 14) provides relatively consistent results when compared to KLT and JFT, due to the Epipolar geometry constraint. The number of successfully tracked features, however, drops significantly with time. One possible reason that the RANSAC iterations cannot overcome this problem is the short and forward baseline between consecutive frames. The proposed approach, on the other hand, tracked and retained correct features due to the geometry constraint applied globally.

In order to show the improvements of this new formulation with a closed form solution over our previous regularization based solution in [25], we performed additional experiments using the standard hotel sequence and the sand dune sequence. For the hotel sequence, the proposed regularization based method successfully tracked most of features until the 14th frame of the sequence as shown in second column of Fig. 15
                        . In the remained of the sequence, however, significant change in the feature appearance resulted in losing them. On the other hand, the proposed formulation provided better results, especially in the latter half of the sequence. We attribute this difference in result to the fact that the new closed form solution combines the appearance and geometry terms more naturally.

For quantitative analysis, we compared the new closed form solution with our previous regularization based solution. In Fig. 16
                        , we report the performance of each method in terms of the mean and standard deviation of the reprojection error as a function of the frame number. As shown in the figure, the proposed closed form approach performs generally similar to the regularization based approach. The mean of reprojection errors for both methods are around 0.5. However, for number of noisy frames in the middle of the sequence, the standard deviation of the closed form solution is considerably lower due to the natural combination of the appearance and geometry terms in the tracking cost function.

The sand dune sequence, both our earlier and new approach performed well, especially for fast camera motion as shown in the second column of Fig. 17
                        . In constant to our earlier approach, however, the proposed closed form method consistently tracked more features correctly especially in cases of motion blurring as shown in third and fourth columns of Fig. 17.

The second set of experiments are conducted by replacing the tracking module of the Astronaut navigation system developed for NASA [32,33] with the proposed geometric tracking approach. Using the tracked features, we estimate the astronaut geolocation by photogrammetric resection. We have quantitatively tested the performance of the approach using the sand dunes sequence based on NASA success criteria. In particular, given the ground truth positions from a differential GPS, 
                           
                              
                                 
                                    X
                                 
                                 
                                    i
                                 
                                 
                                    grnd
                                 
                              
                           
                        , we compute four error measures from the recovered trajectories, 
                           
                              
                                 
                                    X
                                 
                                 
                                    i
                                 
                                 
                                    rec
                                 
                              
                           
                        : average distance, 
                           
                              
                                 
                                    d
                                 
                                 
                                    avg
                                 
                              
                           
                        , disclosure, 
                           
                              
                                 
                                    d
                                 
                                 
                                    dsc
                                 
                              
                           
                        , relative disclosure, 
                           
                              
                                 
                                    d
                                 
                                 
                                    rdsc
                                 
                              
                           
                        , and speed of error, 
                           
                              
                                 
                                    v
                                 
                                 
                                    error
                                 
                              
                           
                        :
                           
                              (23)
                              
                                 
                                    
                                       d
                                    
                                    
                                       avg
                                    
                                 
                                 =
                                 
                                    
                                       1
                                    
                                    
                                       N
                                    
                                 
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          i
                                          =
                                          1
                                       
                                       
                                          N
                                       
                                    
                                 
                                 |
                                 
                                    
                                       X
                                    
                                    
                                       i
                                    
                                    
                                       rec
                                    
                                 
                                 -
                                 
                                    
                                       X
                                    
                                    
                                       i
                                    
                                    
                                       grnd
                                    
                                 
                                 |
                                 ,
                              
                           
                        
                        
                           
                              (24)
                              
                                 
                                    
                                       d
                                    
                                    
                                       dsc
                                    
                                 
                                 =
                                 |
                                 
                                    
                                       X
                                    
                                    
                                       N
                                    
                                    
                                       rec
                                    
                                 
                                 -
                                 
                                    
                                       X
                                    
                                    
                                       N
                                    
                                    
                                       grnd
                                    
                                 
                                 |
                                 ,
                              
                           
                        
                        
                           
                              (25)
                              
                                 
                                    
                                       d
                                    
                                    
                                       rdsc
                                    
                                 
                                 =
                                 
                                    
                                       d
                                    
                                    
                                       dsc
                                    
                                 
                                 /
                                 
                                    
                                       l
                                    
                                    
                                       grnd
                                    
                                 
                                 ,
                              
                           
                        
                        
                           
                              (26)
                              
                                 
                                    
                                       v
                                    
                                    
                                       error
                                    
                                 
                                 =
                                 
                                    
                                       1
                                    
                                    
                                       N
                                    
                                 
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          i
                                          =
                                          1
                                       
                                       
                                          N
                                       
                                    
                                 
                                 |
                                 (
                                 
                                    
                                       X
                                    
                                    
                                       i
                                    
                                    
                                       rec
                                    
                                 
                                 -
                                 
                                    
                                       X
                                    
                                    
                                       i
                                    
                                    
                                       grnd
                                    
                                 
                                 )
                                 /
                                 
                                    
                                       t
                                    
                                    
                                       i
                                    
                                 
                                 |
                                 ,
                              
                           
                        where N stands for the number of samples in ground truth, 
                           
                              
                                 
                                    t
                                 
                                 
                                    i
                                 
                              
                           
                         is the time interval of the ith trajectory segment, and 
                           
                              
                                 
                                    l
                                 
                                 
                                    grnd
                                 
                              
                           
                         is the length of the ground truth trajectory. Since the GPS antenna is working at 1Hz, N is smaller than the samples in recovered trajectory. The difference in sampling rates is removed by downsampling and interpolating the recovered trajectory to N samples. The first of these error measures, 
                           
                              
                                 
                                    d
                                 
                                 
                                    avg
                                 
                              
                           
                        , represents the average distance between the recovered and ground truth trajectory samples. The disclosure error, 
                           
                              
                                 
                                    d
                                 
                                 
                                    dsc
                                 
                              
                           
                        , represents the distance between the endpoints of recovered and ground truth trajectories. The relative disclosure, 
                           
                              
                                 
                                    d
                                 
                                 
                                    rdsc
                                 
                              
                           
                         measures the ratio of the disclosure error over the trajectory length. Finally, the error speed, 
                           
                              
                                 
                                    v
                                 
                                 
                                    error
                                 
                              
                           
                        , provides the rate of error accumulation.

As illustrated in Table 1
                        , the reconstructed trajectory from KLT tracking method (blue dots in Fig. 18
                        ) has a disclosure error of 9m for a total traverse of 111m. For these results, we enforced existence of the epipolar geometry between the stereo image pairs on the tracked features to improve the quality; otherwise, the tracking resulted in significantly high errors. We note some drifting in the second and the third turning angles. Compared to KLT, the trajectory reconstructed by robust matching (magenta dots) has better performance. The robust matching based approach also exploits the epipolar geometry constraint to enforce a global geometry to tracked features. The disclosure is reduced to 
                           
                              4
                              m
                           
                         due to RANSAC iterations applied not only to the stereo image pair but also to the consecutive images. The black trajectory in the plot shows the trajectory reconstructed by the proposed approach. Qualitatively and quantitatively, the proposed approach shows better performance in heading and straight line segments. The disclosure the proposed approach is 2m for 111m traverse. Specifically, the turning angles are significantly improved, and the relative disclosure error is reduced to 1.8%.

@&#CONCLUSIONS@&#

We introduce a new formulation to estimate the true optical flow vector for features using a geometric constraint. The geometric constraint exploits the shared scene geometry based on the projective invariant coordinates and provides a new geometric optical flow equation. Together with the appearance constancy based optical flow constraint, the geometric optical flow equation provides a closed form solution to the feature tracking problem. In addition, we introduce a Bayesian approach for assessing the quality of the tracked features based on both the appearance and shared scene geometry. Our experiments have shown that the introduced quality measure and the geometry based constraint provides persisted feature tracking and is resilient to occlusions and projective changes in the features appearance caused by camera motion. Experimental evaluations against commonly used KLT, JFT and robust matching methods show superior performance which is required for higher level computer vision tasks such as 3D scene recovery. We note that the proposed tracking approach is for tracking static components of the scene. In the future, we will study extending the proposed approach to tracking dynamic objects.

Supplementary data associated with this article can be found, in the online version, at http://dx.doi.org/10.1016/j.cviu.2013.10.009.


                     
                        
                           Supplementary Video 1
                           
                        
                     
                  


                     
                        
                           Supplementary Video 2
                           
                        
                     
                  


                     
                        
                           Supplementary Video 3
                           
                        
                     
                  


                     
                        
                           Supplementary Video 4
                           
                        
                     
                  


                     
                        
                           Supplementary Video 5
                           
                        
                     
                  


                     
                        
                           Supplementary Video 6
                           
                        
                     
                  


                     
                        
                           Supplementary Video 7
                           
                        
                     
                  


                     
                        
                           Supplementary Video 8
                           
                        
                     
                  


                     
                        
                           Supplementary Video 9
                           
                        
                     
                  


                     
                        
                           Supplementary Video 10
                           
                        
                     
                  


                     
                        
                           Supplementary Video 11
                           
                        
                     
                  


                     
                        
                           Supplementary Video 12
                           
                        
                     
                  


                     
                        
                           Supplementary Video 13
                           
                        
                     
                  


                     
                        
                           Supplementary Video 14
                           
                        
                     
                  


                     
                        
                           Supplementary Video 15
                           
                        
                     
                  


                     
                        
                           Supplementary Video 16
                           
                        
                     
                  


                     
                        
                           Supplementary Video 17
                           
                        
                     
                  


                     
                        
                           Supplementary Video 18
                           
                        
                     
                  


                     
                        
                           Supplementary Video 19
                           
                        
                     
                  


                     
                        
                           Supplementary Video 20
                           
                        
                     
                  


                     
                        
                           Supplementary Video 21
                           
                        
                     
                  


                     
                        
                           Supplementary Video 22
                           
                        
                     
                  


                     
                        
                           Supplementary Video 23
                           
                        
                     
                  


                     
                        
                           Supplementary Video 24
                           
                        
                     
                  


                     
                        
                           Supplementary Video 25
                           
                        
                     
                  


                     
                        
                           Supplementary Video 26
                           
                        
                     
                  


                     
                        
                           Supplementary Video 27
                           
                        
                     
                  


                     
                        
                           Supplementary Data 1
                           
                        
                     
                  

@&#REFERENCES@&#

