@&#MAIN-TITLE@&#An optimisation approach to the recovery of reflection parameters from a single hyperspectral image

@&#HIGHLIGHTS@&#


               
               
                  
                     
                        
                           
                           We recover photometric parameters and shape from a single hyperspectral image.


                        
                        
                           
                           We view image radiance as a combination of specular and diffuse reflection component.


                        
                        
                           
                           We cast the recovery of the reflection parameters in an optimisation setting.


                        
                        
                           
                           The approach is quite general and can be applied to a number of reflectance models.


                        
                     
                  
               
            

@&#KEYPHRASES@&#

Hyperspectral imaging

Reflectance modelling

Reflection parameter recovery

@&#ABSTRACT@&#


               
               
                  In this paper, we present a method to recover the parameters governing the reflection of light from a surface making use of a single hyperspectral image. To do this, we view the image radiance as a combination of specular and diffuse reflection components and present a cost functional which can be used for purposes of iterative least squares optimisation. This optimisation process is quite general in nature and can be applied to a number of reflectance models widely used in the computer vision and graphics communities. We elaborate on the use of these models in our optimisation process and provide a variant of the Beckmann–Kirchhoff model which incorporates the Fresnel reflection term. We show results on synthetic images and illustrate how the recovered photometric parameters can be employed for skin recognition in real world imagery, where our estimated albedo yields a classification rate of 95.09±4.26% as compared to an alternative, whose classification rate is of 90.94±6.12%. We also show quantitative results on the estimation of the index of refraction, where our method delivers an average per-pixel angular error of 0.15°. This is a considerable improvement with respect to an alternative, which yields an error of 9.9°.
               
            

@&#INTRODUCTION@&#

In this paper, we focus on the recovery of the parameters governing the reflection of light from objects in the scene as captured by imaging spectroscopy sensors. The modelling of surface reflectance is a topic that is of pivotal importance, and has hence attracted considerable effort in both computer vision and computer graphics.

In graphics, the problem is of interest since it allows physically realistic images of synthetic surfaces to be generated. In computer vision, the modelling of surface reflectance has attracted considerable attention due to its relevance to scene analysis and image understanding. For instance, Nayar and Bolle [35] have used photometric invariants derived from the BRDF to recognise objects with different reflectance properties. This work builds on that reported in [34], where a background to foreground reflectance ratio is introduced. In a related development, Dror et al. [11] have shown how surfaces may be classified from single images through the use of reflectance properties.

Estimation of reflectance parameters is also closely related to the problem of recovering the shape of an object from its shading information. The classic approaches to shape from shading developed by Ikeuchi and Horn [23], and by Horn and Brooks [17], hinge on the compliance with the image irradiance equation and local surface smoothness. Zheng and Chellappa [58] proposed a gradient consistency constraint that penalises differences between the image intensity gradient and the surface gradient for the recovered surface. Moreover, although shape-from-shading [17] usually relies on the assumption of Lambertian reflectance [27], photometric correction or specularity subtraction may be applied as a preprocessing step to improve the results obtained. For instance Brelstaff and Blake [6] used a simple thresholding strategy to identify specularities on moving curved objects. Other lines of research remove specularities by either using additional hardware [35], imposing constrains on the input images [30], requiring colour segmentation [26] as postprocessing steps, or using reflectance models to account for the distribution of image brightness [41].

Alternatively, the BRDF can be used to compute a reflectance map, to which a number of shape-from-shading methods may be applied [18,16]. The methods used to model or approximate the BRDF can be divided into those that are physics-based, semi-empirical [39,56] or empirical [27,40,48] in nature. Although the literature from physics is vast, it is perhaps the work of Beckmann on smooth and rough surface reflectance that is better known in the vision and graphics communities [2]. While it is based on physically meaningful surface parameters, the Beckmann theory relies on the evaluation of the Kirchoff wave scattering integral and breaks down when the surface roughness or the scattering angle are large. To overcome this problem, Vernold and Harvey [54] have developed a model which accounts for self shadowing on rough surfaces. Ragheb and Hancock [43] have exploited this modification of the Beckman–Kirchoff theory to develop a means of measuring surface roughness parameters using reflectance. Another widely used physics-based model that accounts for specular reflectance by modelling the angular distribution of surface microfacets is that in [52]. A survey of reflectance and shading models can be found in [46].

For purposes of estimating the reflectance properties and light source direction of a scene, Ikeuchi et al. [24] have proposed an iterative least square optimisation based on a simplified Torrance–Sparrow reflectance model. The algorithm in [24] recovers the surface reflectance properties and light source direction from a range and a brightness image. With known geometry of the scene, Sato et al. [44] have utilised brightness values within shadows to solve a system of equations to simultaneously recover reflectance parameters and illumination distribution. Tominaga et al. [51] have proposed a method for estimating various reflection parameters of the Phong reflectance model [40] along with shape, illumination direction and colour from a single image. However, all of these methods assume that the light source and viewing positions are located at infinity. Therefore these methods do not offer a solution for real scenes under light and viewing positions at finite distances which do not follow parallel illumination and orthogonal projection. Later, based on the simplified Torrance–Sparrow reflectance model, Hara et al. [15] have developed a method without the distant illumination and orthogonal projection assumption that estimates reflectance property and light source position from a single image. However, their method still requires prior knowledge of the 3D shape of the scene that narrows down the applicability of this approach. Following a similar approach, the method by Boivin et al. [4] recovers reflectance properties of different surfaces from a single image. With known illumination, camera properties, and 3D geometric model, this method iteratively fits multiple reflection models from the simplest to the most complex one until the error between original and estimated image becomes less than a predefined threshold.

We note that a number of models in the literature employ object shape, index of refraction, reflectance, and a measure of surface roughness to embody the surface reflectance. These models [2,52,8,56] also incorporate a Fresnel term [5]. Moreover, the reflectance and index of refraction are, in general, wavelength dependant. This leads to the natural extension of these techniques to multispectral and hyperspectral image understanding. However, the recovery of reflection parameters from a single hyperspectral image is relatively under researched. The method in [21], based on Dichromatic reflectance model, recovers the illuminant power spectrum and Dichromatic parameters in a structural optimisation setting. However, this method does not consider the wave-length dependency of the specular reflection. In [20], an iterative optimisation approach is presented. The method is applicable to a number of reflectance models [2,52,56] and able to recover shape and reflectance parameters from a single image with known illumination direction. Both of these approaches are based on a distant light source assumption and, hence, can break down when applied to real scenes under light and viewing positions at finite distances. Furthermore, in [20], the wave-length dependency of diffuse albedo is ignored and the surface reflectance is not modelled as a composition of both specular and diffuse components but rather the focus is on the optimisation of the model under consideration using Euler–Lagrange equations.

Here, we present a method to recover the reflectance model parameters as a function of wavelength. We do not require prior knowledge on the geometry of the scene nor assume a point light source at infinity. Given a known illumination direction and a single image at input, we depart from a general formulation that hinges in the notion that the light reflected from an object can be deemed to be either specular or diffuse. This permits the recovery of the reflection parameters through an optimisation approach, whose target function is a linear combination of both, the specular and the diffuse reflection components. This, together with the use of Cauchy’s and Sellmeier’s expansions [5] permits the recovery of the index of refraction governing the Fresnel term of models such as Cook and Torrance’s [8], Torrance and Sparrow’s [52], Beckmann–Kirchoff’s [2] and Wolff et al.’s [56].

The paper is organised as follows. We commence by expressing the object reflection as a linear combination of a diffuse and a specular component. With this linear combination at hand, we proceed to formulate the problem in an optimisation setting in Section 3. Further discussion is provided in Section 4, where we show how the general formulation presented in Section 2 can be expressed in terms of specific reflection models elsewhere in the literature. Here, we focus on the use of those models in [8,52,2] and [56]. We describe implementation issues in Section 5 and present results for our method on synthetic data and real-world imagery in Section 6, where we also compare against a number of alternatives. Finally, in Section 7, we conclude on the developments presented here.

As mentioned earlier, our aim is to recover the reflectance model parameters. Nonetheless, there are a wide variety of reflectance models, we can depart from a generalist view of the reflection process based upon a physical interpretation, where the geometry of the scene, photogrammetric variables and wavelength dependent Fresnel term are used to describe the image formation process. From this general viewpoint, we can then cast the recovery of the reflection parameters in an optimisation setting.

Here, we adopt a quite general approach applicable to a number of reflectance models in the existing literature [56,52,2,8]. We formulate the general reflectance model as a linear combination of two reflection components, namely diffuse and specular. This concept of modelling the scene radiance as a linear combination of two components was formally proposed by Shafer through the Dichromatic reflectance model [48]. Furthermore, this is consistent with a number of references elsewhere in the literature [56,20,8].

It is worth noting in passing that optimisation approaches have been used in computer vision to recover the illuminant [12] and the surface normals [17]. As per the recovery of the reflectance, Fresnel reflection and other parameters, Weyrich et al. [55] have fit a BRDF model to the acquired data. In [20], the authors use Euler–Lagrange equations to recover the reflectance parameters corresponding to a number of reflectance models. These approaches follow the assumption that, given enough data, the reflectance parameters may be recovered accordingly. Note that, in our case, hyperspectral imaging does provide an information-rich representation of the scene which delivers a large amount of data and allows the wavelength dependence to be introduced into the optimisation process. This is similar rationale to that used in Weyrich et al.’s [55] work, where large amounts of trichromatic data is acquired using parallel hardware for purposes of fitting.

Here, we further express the diffuse term and specular term as a function of reflection angle variables, photogrammetric variables and wavelength dependent index of refraction. Note that, a number of reflectance models follow a local coordinate system which corresponds to the reflection geometry given in the left-hand panel of Fig. 1
                        . This geometry is defined with respect to a local coordinate system whose origin is the surface location and where the z′-axis is aligned to the normalised local surface normal 
                           
                              
                                 
                                    N
                                 
                                 
                                    →
                                 
                              
                           
                        . In the figure, we have denoted the unit incident light direction vector 
                           
                              
                                 
                                    L
                                 
                                 
                                    →
                                 
                              
                           
                        , with slant θ
                        
                           i
                         and tilt ϕ
                        
                           i
                        . Also, following the costume in the literature, we denote the unit view vector as 
                           
                              
                                 
                                    V
                                 
                                 
                                    →
                                 
                              
                           
                        , whose slant is θ
                        
                           s
                         and tilt is ϕ
                        
                           s
                        . The unit half-way vector is denoted by 
                           
                              
                                 
                                    H
                                 
                                 
                                    →
                                 
                              
                           
                         and is given by the angular bisector of 
                           
                              
                                 
                                    L
                                 
                                 
                                    →
                                 
                              
                           
                         and 
                           
                              
                                 
                                    V
                                 
                                 
                                    →
                                 
                              
                           
                        , i.e. 
                           
                              
                                 
                                    H
                                 
                                 
                                    →
                                 
                              
                              =
                              
                                 
                                    
                                       
                                          L
                                       
                                       
                                          →
                                       
                                    
                                    +
                                    
                                       
                                          V
                                       
                                       
                                          →
                                       
                                    
                                 
                                 
                                    |
                                    
                                       
                                          L
                                       
                                       
                                          →
                                       
                                    
                                    +
                                    
                                       
                                          V
                                          |
                                       
                                       
                                          →
                                       
                                    
                                 
                              
                           
                        . We denote the angle between 
                           
                              
                                 
                                    N
                                 
                                 
                                    →
                                 
                              
                           
                         and 
                           
                              
                                 
                                    H
                                 
                                 
                                    →
                                 
                              
                           
                         as θ
                        
                           h
                        .

Making use of the reflection geometry in Fig. 1, the illuminant power spectrum L(λ
                        
                           l
                        ), the image radiance at pixel u and wavelength λ
                        
                           l
                         is given by
                           
                              (1)
                              
                                 f
                                 (
                                 u
                                 ,
                                 
                                    
                                       λ
                                    
                                    
                                       l
                                    
                                 
                                 )
                                 =
                                 
                                    
                                       W
                                    
                                    
                                       diff
                                    
                                 
                                 (
                                 u
                                 )
                                 
                                    
                                       f
                                    
                                    
                                       diff
                                    
                                 
                                 (
                                 L
                                 (
                                 
                                    
                                       λ
                                    
                                    
                                       l
                                    
                                 
                                 )
                                 ,
                                 Θ
                                 (
                                 u
                                 )
                                 ,
                                 ρ
                                 (
                                 u
                                 ,
                                 
                                    
                                       λ
                                    
                                    
                                       l
                                    
                                 
                                 )
                                 ,
                                 η
                                 (
                                 u
                                 ,
                                 
                                    
                                       λ
                                    
                                    
                                       l
                                    
                                 
                                 )
                                 )
                                 +
                                 
                                    
                                       W
                                    
                                    
                                       spec
                                    
                                 
                                 (
                                 u
                                 )
                                 
                                    
                                       f
                                    
                                    
                                       spec
                                    
                                 
                                 (
                                 L
                                 (
                                 
                                    
                                       λ
                                    
                                    
                                       l
                                    
                                 
                                 )
                                 ,
                                 Θ
                                 (
                                 u
                                 )
                                 ,
                                 
                                    
                                       σ
                                    
                                    
                                       m
                                    
                                 
                                 (
                                 u
                                 )
                                 ,
                                 η
                                 (
                                 u
                                 ,
                                 
                                    
                                       λ
                                    
                                    
                                       l
                                    
                                 
                                 )
                                 )
                              
                           
                        
                     

In the equation above, the first term on the right-hand-side corresponds to the diffuse reflection component, where f
                        
                           diff
                        (·) stands for the diffuse image radiance and W
                        
                           diff
                         denotes the weight of the diffuse term. The second term on the right-hand-side describes the specular component, where f
                        
                           spec
                        (·) denotes specular image radiance and W
                        
                           spec
                         denotes the weight of the specular term. In Eq. (1), f
                        
                           diff
                        (·) is expressed as a function of the reflection angular variable-set Θ(u)={θ
                        
                           i
                        ,
                        ϕ
                        
                           i
                        ,
                        θ
                        
                           s
                        ,
                        ϕ
                        
                           s
                        ,
                        θ
                        
                           h
                        }, wavelength dependent diffuse albedo ρ(u,
                        λ
                        
                           l
                        ), and index of refraction η(u,
                        λ
                        
                           l
                        ). On the other hand, f
                        
                           spec
                        (·) is expressed as a function of the reflection angular variable-set Θ(u), microfacet slope σ
                        
                           m
                        (u), and wavelength-dependent refracted index η(u,
                        λ
                        
                           l
                        ).

Further, if the illumination direction is known, we can replace the reflection angle variables by surface gradients and reparameterise the general reflectance model with respect to surface gradients. The benefit of doing this is that such a reparameterisation implies that the number of geometric variables is two per pixel, i.e. p(u) and q(u). This reduces the number of reflectance equations needed to estimate the surface normal 
                           
                              
                                 
                                    N
                                 
                                 
                                    →
                                 
                              
                           
                         at pixel u. This reparameterisation is effected by making use of the viewer-centered coordinate system shown in the right-hand panel of Fig. 1. As a result, the (x,
                        y)-axes correspond to the image row and column directions. This implies that, by definition, the surface normal 
                           
                              
                                 
                                    N
                                 
                                 
                                    →
                                 
                              
                           
                         at u is [−p(u),−q(u),1]
                           T
                        . This yields the reparameterised image radiance given by
                           
                              (2)
                              
                                 f
                                 (
                                 u
                                 ,
                                 
                                    
                                       λ
                                    
                                    
                                       l
                                    
                                 
                                 )
                                 =
                                 
                                    
                                       W
                                    
                                    
                                       diff
                                    
                                 
                                 (
                                 u
                                 )
                                 
                                    
                                       f
                                    
                                    
                                       diff
                                    
                                 
                                 (
                                 L
                                 (
                                 
                                    
                                       λ
                                    
                                    
                                       l
                                    
                                 
                                 )
                                 ,
                                 p
                                 (
                                 u
                                 )
                                 ,
                                 q
                                 (
                                 u
                                 )
                                 ,
                                 ρ
                                 (
                                 u
                                 ,
                                 
                                    
                                       λ
                                    
                                    
                                       l
                                    
                                 
                                 )
                                 ,
                                 η
                                 (
                                 u
                                 ,
                                 
                                    
                                       λ
                                    
                                    
                                       l
                                    
                                 
                                 )
                                 )
                                 +
                                 
                                    
                                       W
                                    
                                    
                                       spec
                                    
                                 
                                 (
                                 u
                                 )
                                 
                                    
                                       f
                                    
                                    
                                       spec
                                    
                                 
                                 (
                                 L
                                 (
                                 
                                    
                                       λ
                                    
                                    
                                       l
                                    
                                 
                                 )
                                 ,
                                 p
                                 (
                                 u
                                 )
                                 ,
                                 q
                                 (
                                 u
                                 )
                                 ,
                                 
                                    
                                       σ
                                    
                                    
                                       m
                                    
                                 
                                 (
                                 u
                                 )
                                 ,
                                 η
                                 (
                                 u
                                 ,
                                 
                                    
                                       λ
                                    
                                    
                                       l
                                    
                                 
                                 )
                                 )
                              
                           
                        
                     

In such a coordinate system, the z-axis is lined-up with the optical axis and the positive x-axis points toward the right-hand side of the field of view. It is worth noting that this reparameterisation can be viewed as a rotation of the local coordinate system which aligns the viewer direction with the z-axis making use of the rotation matrix R as follows
                           
                              (3)
                              
                                 z
                                 =
                                 R
                                 
                                    
                                       z
                                    
                                    
                                       ′
                                    
                                 
                              
                           
                        
                     

Reflecting the notion that, in the local coordinate system, the surface normal is lined up with the z′-axis, whereas in the global coordinate system, the viewer is aligned with the z-axis we can rewrite Eq. (3) as follows
                           
                              (4)
                              
                                 
                                    
                                       [
                                       0
                                       ,
                                       0
                                       ,
                                       1
                                       ]
                                    
                                    
                                       T
                                    
                                 
                                 =
                                 
                                    
                                       1
                                    
                                    
                                       
                                          
                                             
                                                
                                                   p
                                                
                                                
                                                   2
                                                
                                             
                                             +
                                             
                                                
                                                   q
                                                
                                                
                                                   2
                                                
                                             
                                             +
                                             1
                                          
                                       
                                    
                                 
                                 R
                                 
                                    
                                       [
                                       -
                                       p
                                       (
                                       u
                                       )
                                       ,
                                       -
                                       q
                                       (
                                       u
                                       )
                                       ,
                                       1
                                       ]
                                    
                                    
                                       T
                                    
                                 
                              
                           
                        where we have assumed a normalised surface normal and used the fact that, in our global coordinate system, the viewer direction becomes [0,0,1]
                           T
                        .

Given the illumination direction and a single hyperspectral image at input, we aim at recovering the reflectance parameters, i.e. index of refraction, albedo, microfacet slope, and surface normals. In our formulation, we depart from Eq. (2) in order to express the diffuse and specular term of the image radiance as a function of the surface gradients, photogrammetric variables (microfacet slope and wavelength dependent diffuse albedo) and wavelength dependent index of refraction. We also recover the weights W
                        
                           diff
                        (u) and W
                        
                           spec
                        (u).

Our method is an iterative one which employs a cost function 
                           
                              C
                              (
                              I
                              )
                           
                         defined over the hyperspectral image 
                           
                              I
                           
                        . Here, we have expressed our cost function as the summation of two other cost functionals 
                           
                              
                                 
                                    C
                                 
                                 
                                    diff
                                 
                              
                              (
                              I
                              )
                           
                         and 
                           
                              
                                 
                                    C
                                 
                                 
                                    spec
                                 
                              
                              (
                              I
                              )
                           
                        , where C
                        
                           diff
                         is couched as the squared difference between the image diffuse spectral radiance 
                           
                              
                                 
                                    I
                                 
                                 
                                    diff
                                 
                              
                           
                         and the first term on the right-hand-side of Eq. (2). The other cost functional, denoted by C
                        
                           spec
                        , corresponds to the squared difference between the image specular radiance 
                           
                              
                                 
                                    I
                                 
                                 
                                    spec
                                 
                              
                           
                         and the last term on the right-hand-side of Eq. (2).

Thus, our cost function is given by
                           
                              (5)
                              
                                 C
                                 (
                                 I
                                 )
                                 
                                 ≜
                                 
                                 
                                    
                                       C
                                    
                                    
                                       diff
                                    
                                 
                                 (
                                 I
                                 )
                                 +
                                 
                                    
                                       C
                                    
                                    
                                       spec
                                    
                                 
                                 (
                                 I
                                 )
                              
                           
                        where
                           
                              (6)
                              
                                 
                                    
                                       C
                                    
                                    
                                       diff
                                    
                                 
                                 (
                                 I
                                 )
                                 
                                 ≜
                                 
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          u
                                          ∈
                                          I
                                       
                                    
                                 
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          
                                             
                                                λ
                                             
                                             
                                                l
                                             
                                          
                                          ∈
                                          W
                                       
                                    
                                 
                                 
                                    
                                       [
                                       
                                          
                                             I
                                          
                                          
                                             diff
                                          
                                       
                                       (
                                       u
                                       ,
                                       
                                          
                                             λ
                                          
                                          
                                             l
                                          
                                       
                                       )
                                       -
                                       
                                          
                                             W
                                          
                                          
                                             diff
                                          
                                       
                                       (
                                       u
                                       )
                                       
                                          
                                             f
                                          
                                          
                                             diff
                                          
                                       
                                       (
                                       L
                                       (
                                       
                                          
                                             λ
                                          
                                          
                                             l
                                          
                                       
                                       )
                                       ,
                                       p
                                       (
                                       u
                                       )
                                       ,
                                       q
                                       (
                                       u
                                       )
                                       ,
                                       ρ
                                       (
                                       u
                                       ,
                                       
                                          
                                             λ
                                          
                                          
                                             l
                                          
                                       
                                       )
                                       ,
                                       η
                                       (
                                       u
                                       ,
                                       
                                          
                                             λ
                                          
                                          
                                             l
                                          
                                       
                                       )
                                       )
                                       ]
                                    
                                    
                                       2
                                    
                                 
                              
                           
                        can be viewed as a data term corresponding to the diffuse image radiance and
                           
                              (7)
                              
                                 
                                    
                                       C
                                    
                                    
                                       spec
                                    
                                 
                                 (
                                 I
                                 )
                                 
                                 ≜
                                 
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          u
                                          ∈
                                          I
                                       
                                    
                                 
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          
                                             
                                                λ
                                             
                                             
                                                l
                                             
                                          
                                          ∈
                                          W
                                       
                                    
                                 
                                 
                                    
                                       [
                                       
                                          
                                             I
                                          
                                          
                                             spec
                                          
                                       
                                       (
                                       u
                                       ,
                                       
                                          
                                             λ
                                          
                                          
                                             l
                                          
                                       
                                       )
                                       -
                                       
                                          
                                             W
                                          
                                          
                                             spec
                                          
                                       
                                       (
                                       u
                                       )
                                       
                                          
                                             f
                                          
                                          
                                             spec
                                          
                                       
                                       (
                                       L
                                       (
                                       
                                          
                                             λ
                                          
                                          
                                             l
                                          
                                       
                                       )
                                       ,
                                       p
                                       (
                                       u
                                       )
                                       ,
                                       q
                                       (
                                       u
                                       )
                                       ,
                                       
                                          
                                             σ
                                          
                                          
                                             m
                                          
                                       
                                       (
                                       u
                                       )
                                       ,
                                       η
                                       (
                                       u
                                       ,
                                       
                                          
                                             λ
                                          
                                          
                                             l
                                          
                                       
                                       )
                                       )
                                       ]
                                    
                                    
                                       2
                                    
                                 
                              
                           
                        is the converse for the specular component of 
                           
                              I
                           
                        . In the equations above, 
                           
                              W
                           
                         is the wavelength range for the imagery under consideration.

Note that, by making use of the linear combination in Eq. (5), we can separate the image radiance into its diffuse and specular components using a specularity removal method such as those in [50] or [30]. This separation responds to the observation that, in Eq. (2), the albedo ρ(·) and W
                        
                           diff
                         contribute only to the diffuse component, whereas σ
                        
                           m
                         and W
                        
                           spec
                         contribute only to the specular component. Moreover, the index of refraction η(·) and surface gradients p(u), q(u) influence both the specular and diffuse terms.

Therefore, we can adopt an optimisation approach where our aim of computation is the recovery of ρ(·) and W
                        
                           diff
                         by maximising C
                        
                           diff
                         such that
                           
                              (8)
                              
                                 
                                    
                                       
                                          
                                             
                                                ρ
                                             
                                             
                                                ∗
                                             
                                          
                                          (
                                          u
                                          ,
                                          
                                             
                                                λ
                                             
                                             
                                                l
                                             
                                          
                                          )
                                          ,
                                          
                                             
                                                W
                                             
                                             
                                                diff
                                             
                                             
                                                ∗
                                             
                                          
                                          (
                                          u
                                          )
                                       
                                    
                                 
                                 ←
                                 
                                    
                                       argmin
                                    
                                    
                                       ρ
                                       (
                                       u
                                       ,
                                       
                                          
                                             λ
                                          
                                          
                                             l
                                          
                                       
                                       )
                                       ,
                                       
                                          
                                             W
                                          
                                          
                                             diff
                                          
                                       
                                       (
                                       u
                                       )
                                    
                                 
                                 
                                    
                                       C
                                    
                                    
                                       diff
                                    
                                 
                                 (
                                 I
                                 )
                              
                           
                        
                     

In a similar manner, we note that the microfacet slope σ
                        
                           m
                        (u) and weight W
                        
                           spec
                        (u) can be recovered by optimising 
                           
                              
                                 
                                    C
                                 
                                 
                                    spec
                                 
                              
                              (
                              I
                              )
                           
                         as follows
                           
                              (9)
                              
                                 
                                    
                                       
                                          
                                             
                                                σ
                                             
                                             
                                                m
                                             
                                             
                                                ∗
                                             
                                          
                                          (
                                          u
                                          )
                                          ,
                                          
                                             
                                                W
                                             
                                             
                                                spec
                                             
                                             
                                                ∗
                                             
                                          
                                          (
                                          u
                                          )
                                       
                                    
                                 
                                 ←
                                 
                                    
                                       argmin
                                    
                                    
                                       
                                          
                                             σ
                                          
                                          
                                             m
                                          
                                       
                                       (
                                       u
                                       )
                                       ,
                                       
                                          
                                             W
                                          
                                          
                                             spec
                                          
                                       
                                       (
                                       u
                                       )
                                    
                                 
                                 
                                    
                                       C
                                    
                                    
                                       spec
                                    
                                 
                                 (
                                 I
                                 )
                              
                           
                        
                     

Finally, if the weights 
                           
                              
                                 
                                    W
                                 
                                 
                                    spec
                                 
                                 
                                    ∗
                                 
                              
                              (
                              u
                              )
                           
                         and 
                           
                              
                                 
                                    W
                                 
                                 
                                    diff
                                 
                                 
                                    ∗
                                 
                              
                              (
                              u
                              )
                           
                        , albedo and microfacet slope are available, the index of refraction η(·) and surface gradients p(u), q(u) can be computed by optimising the combined cost function C. This can be expressed as
                           
                              (10)
                              
                                 (
                                 
                                    
                                       η
                                    
                                    
                                       ∗
                                    
                                 
                                 (
                                 u
                                 ,
                                 
                                    
                                       λ
                                    
                                    
                                       l
                                    
                                 
                                 )
                                 ,
                                 
                                    
                                       p
                                    
                                    
                                       ∗
                                    
                                 
                                 (
                                 u
                                 )
                                 ,
                                 
                                    
                                       q
                                    
                                    
                                       ∗
                                    
                                 
                                 (
                                 u
                                 )
                                 )
                                 ←
                                 
                                    
                                       argmin
                                    
                                    
                                       η
                                       (
                                       u
                                       ,
                                       
                                          
                                             λ
                                          
                                          
                                             l
                                          
                                       
                                       )
                                       ,
                                       p
                                       (
                                       u
                                       )
                                       ,
                                       q
                                       (
                                       u
                                       )
                                    
                                 
                                 C
                                 (
                                 I
                                 )
                              
                           
                        
                     

Thus, by expressing Eq. (5) in terms of C
                        
                           spec
                        (·) and C
                        
                           diff
                        (·), we obtain twice as many data terms for the estimation of the index of refraction and the surface shape. Furthermore, we can estimate the albedo ρ(·) and the weight W
                        
                           diff
                         by extremising the cost function in Eq. (6) alone. Analogously, the microfacet slope σ
                        
                           m
                         and the weight W
                        
                           spec
                         can be estimated making use of Eq. (7). Since these two sets of parameters can be estimated independently, this treatment also opens-up the possibility of effecting these two optimisation steps in parallel and, once the optimal values of σ
                        
                           m
                        , W
                        
                           spec
                        , ρ(·), and W
                        
                           diff
                         are in hand, the index of refraction η(·) and the surface normal 
                           
                              
                                 
                                    N
                                 
                                 
                                    →
                                 
                              
                              =
                              
                                 
                                    [
                                    -
                                    p
                                    (
                                    u
                                    )
                                    ,
                                    -
                                    q
                                    (
                                    u
                                    )
                                    ,
                                    1
                                    ]
                                 
                                 
                                    T
                                 
                              
                           
                         at pixel u can be estimated.

Here, we opt for a coordinate descent [14] optimisation scheme. This approach is shared with other methods elsewhere in the literature [21,15,44], where the complexity of the multivariable optimisation problem is tackled by optimising comparatively simple scalar subproblems.

The idea is to minimise the multivariable cost function 
                        
                           C
                           (
                           I
                           )
                        
                      in Eq. (5) by minimising it along one coordinate direction at a time while keeping all other coordinates fixed. Thus, the multivariable problem is actually solved by computing a sequence of scalar minimisation subproblems, where each of these is either a linear or a non-linear least square optimisation depending on whether or not the cost function is linear in the coordinate space, i.e. the variable under consideration. This provides the additional advantage that, for the linear least square subproblems, the cost function is variable-wise convex and, thus, a globally optimal solution is guaranteed. For the non-linear least squares, the measure of non-linearity and the ability to chose an initial estimate close to the optimal value effectively determines whether the method will converge to a global minimum.

The algorithm thus proceeds as follows. At each iteration it recovers ρ(u, λ
                     
                        l
                     ), W
                     
                        diff
                     (u), σ
                     
                        m
                     (u), W
                     
                        spec
                     (u), η(u, λ
                     
                        l
                     ) and {p(u),
                     q(u)} in interleaved separate minimisation steps. Once it estimates one parameter, the current estimate is used to obtain the remaining parameters. This is, in effect, an update process where the iterations proceed until convergence is reached. The algorithm terminates when none of the parameters change between two successive iterations by an amount greater or equal to a predefined threshold and/or when maximum number of iteration is completed.

For the least square optimisation involved we have selected the Levenberg–Marquardt method [29,31]. This method is actually a combination of the gradient descent and the Gauss–Newton method and efficiently utilises the complimentary advantages of these two methods. Being controlled by the value of a damping parameter, the method acts more like a gradient descent method when the parameters are far from their optimal value, whereas, it acts more like the Gauss–Newton method when the parameters are close to their optimal values. The method adaptively controls its own damping and this feature makes it applicable to a wide variety of problems. It increases the damping if a step fails to reduce the error; otherwise it decreases the damping. Thus it defensively navigates a region of parameter space in which the model is highly non-linear [28]. For updating the damping parameter, we adopt the strategy proposed in [38]. This is as it assures faster convergence than that originally proposed by Marquardt [31]. More importantly, it offers protection against a rank-deficient Jacobian and, therefore, it prevents the errors caused by singular Hessian matrices often found when the parameter space is highly non-linear.

In the following subsections, we elaborate further on the step sequence of our algorithm, which, for the reader’s reference, we have summarised in the pseudo code shown in Algorithm 1. At input, our algorithm takes a hyperspectral image 
                        
                           I
                        
                      whose pixel values correspond to the spectral radiance I(u,
                     λ
                     
                        l
                     ) for each of the wavelength-indexed bands 
                        
                           {
                           
                              
                                 λ
                              
                              
                                 1
                              
                           
                           ,
                           …
                           ,
                           
                              
                                 λ
                              
                              
                                 |
                                 W
                                 |
                              
                           
                           }
                        
                     .

At this point, it is worth noting in passing that, following [17], we can write the image radiance as the product of the light power spectrum and the reflectance R(u,
                     λ
                     
                        l
                     ), i.e.
                        
                           (11)
                           
                              I
                              (
                              u
                              ,
                              
                                 
                                    λ
                                 
                                 
                                    l
                                 
                              
                              )
                              =
                              L
                              (
                              
                                 
                                    λ
                                 
                                 
                                    l
                                 
                              
                              )
                              R
                              (
                              u
                              ,
                              
                                 
                                    λ
                                 
                                 
                                    l
                                 
                              
                              )
                           
                        
                     
                  

The expression above has been used widely in the literature [25] and is consistent with reflectance models elsewhere, such as that in [12]. Indeed, this treatment allows for the estimation of the illuminant power spectrum L(λ
                     
                        l
                     ) a priori, which we estimated using the method in [21], so as to recover the image reflectance R(u,
                     λ
                     
                        l
                     ). With the image reflectance in hand, we separate R(u,
                     λ
                     
                        l
                     ) into the diffuse and specular reflectance R
                     
                        diff
                     (u,
                     λ
                     
                        l
                     ) and R
                     
                        spec
                     (u,
                     λ
                     
                        l
                     ) using the method presented in [50]. This can be done without any loss of generality due to the manner in which we have expressed the image radiance in Eq. (2), which is consistent with the relation R(u,
                     λ
                     
                        l
                     )=
                     R
                     
                        diff
                     (u,
                     λ
                     
                        l
                     )+
                     R
                     
                        spec
                     (u,
                     λ
                     
                        l
                     ). These two steps are listed under the preprocessing tag in Algorithm 1.

Here, we would like to stress that we use one of existing specularity removal methods as a preprocessing tool. This is not exclusive to our method but rather common across other reflectance parameter estimation approaches [15,33]. Specularity removal is often used to decompose the image radiance into specular and diffuse reflection. Thus, there has been a considerable amount of research on separating reflectance components. This literature is not the focus of the work presented here and, therefore, we refer the interested reader to the survey in [1].

Note that, here, we employ different reflectance models in order to recover the relevant parameters. These are summarised in Table 1
                     . The accuracy of these is expected to dependent on the diffuse-specular separation. Nonetheless, our method is not overly affected by errors on the specularity removal. This is as the only parameter which is exclusive to the specular pixels is the microfacet slope σ
                     
                        m
                     (u), which is shared by both, the Torrance–Sparrow [52] and Beckmann–Kirchhoff [2] models. This, de facto, constrains the estimation further. This is an important observation since diffuse pixels tend to be more abundant in images as compared to specular ones. Furthermore, in our experience, the errors in the specularity removal tend to be more evident at grazing angles, which does not overly affect the estimation of the albedo and index or refraction.

Broadly speaking, the reflectance component separation methods can be categorised into two classes, i.e. colour-based and polarisation-based methods. Colour-based methods cannot estimate the diffuse component when the object is white whereas polarisation-based methods are only applicable to materials whose molecules are isotropically arranged, e.g. plastics, paints, papers, metals, woods, clothes, glasses, or liquids. Moreover, in practice, polarizers often fail to remove strong specularities in objects made of materials such as metals, glasses, or liquids [32]. As a result, here we adopt the colour-based component separation technique in [50]. Although this method is based on trichromatic image, it is quite straightforward to apply this to a hyperspectral image. This method requires illumination spectrum normalisation, so the spectra of illumination, L(λ
                     
                        l
                     ) need to be known beforehand. For us, it is not a problem as we are estimating L(λ
                     
                        l
                     ) at the preprocessing step of our algorithm. We then normalise image radiance by dividing it by illuminant spectrum for all 
                        
                           
                              
                                 λ
                              
                              
                                 l
                              
                           
                           ∈
                           W
                        
                      and provide the method the normalised image intensity value as input. Note that other specularity removal methods elsewhere in the literature may also be used.

To initialise the surface normal parameters p(u) and q(u), we follow Worthington and Hancock [57] and make use of the image gradients. Recall that, in [57], the parameters p(u) and q(u) are initialised making use of a grey-scale image. This is in contrast with our imagery, which is wavelength indexed. To tackle this problem, we note that, from robust statistics [19], it can be shown that, if the estimation errors are normally distributed with zero-mean, the expected value can be used as an unbiased estimator. Thus, we have
                        
                           (12)
                           
                              p
                              (
                              u
                              )
                              =
                              
                                 
                                    1
                                 
                                 
                                    |
                                    W
                                    |
                                 
                              
                              
                                 
                                    
                                       ∑
                                    
                                    
                                       l
                                       =
                                       1
                                    
                                    
                                       |
                                       W
                                       |
                                    
                                 
                              
                              
                                 
                                    ∂
                                    
                                       
                                          R
                                       
                                       
                                          diff
                                       
                                    
                                    (
                                    u
                                    ,
                                    
                                       
                                          λ
                                       
                                       
                                          l
                                       
                                    
                                    )
                                 
                                 
                                    ∂
                                    x
                                 
                              
                              
                              and
                              
                              q
                              (
                              u
                              )
                              =
                              
                                 
                                    1
                                 
                                 
                                    |
                                    W
                                    |
                                 
                              
                              
                                 
                                    
                                       ∑
                                    
                                    
                                       l
                                       =
                                       1
                                    
                                    
                                       |
                                       W
                                       |
                                    
                                 
                              
                              
                                 
                                    ∂
                                    
                                       
                                          R
                                       
                                       
                                          diff
                                       
                                    
                                    (
                                    u
                                    ,
                                    
                                       
                                          λ
                                       
                                       
                                          l
                                       
                                    
                                    )
                                 
                                 
                                    ∂
                                    y
                                 
                              
                           
                        
                     
                  

The rest of the variables are initialised with random values in the interval [0,1].
                        Algorithm 1
                        Estimating reflectance model parameters 
                              
                                 
                                    
                                    
                                       
                                          
                                             Input:
                                             
                                                
                                                   The hyperspectral input image 
                                                         
                                                            I
                                                         
                                                       whose pixel values correspond to the measured spectral radiance I(u,
                                                      λ
                                                      
                                                         l
                                                      ) indexed to wavelength 
                                                         
                                                            
                                                               
                                                                  λ
                                                               
                                                               
                                                                  l
                                                               
                                                            
                                                            ∈
                                                            W
                                                         
                                                      .
                                                
                                             
                                          
                                       
                                       
                                          
                                             Output: 
                                             
                                             
                                                
                                                   {
                                                   ρ
                                                   (
                                                   u
                                                   ,
                                                   
                                                      
                                                         λ
                                                      
                                                      
                                                         l
                                                      
                                                   
                                                   )
                                                   ,
                                                   η
                                                   (
                                                   u
                                                   ,
                                                   
                                                      
                                                         λ
                                                      
                                                      
                                                         l
                                                      
                                                   
                                                   )
                                                   ,
                                                   
                                                      
                                                         σ
                                                      
                                                      
                                                         m
                                                      
                                                   
                                                   (
                                                   u
                                                   )
                                                   ,
                                                   
                                                      
                                                         W
                                                      
                                                      
                                                         spec
                                                      
                                                   
                                                   (
                                                   u
                                                   )
                                                   ,
                                                   
                                                      
                                                         W
                                                      
                                                      
                                                         diff
                                                      
                                                   
                                                   (
                                                   u
                                                   )
                                                   ,
                                                   p
                                                   (
                                                   u
                                                   )
                                                   ,
                                                   q
                                                   (
                                                   u
                                                   )
                                                   }
                                                   |
                                                   ∀
                                                   u
                                                   ∈
                                                   I
                                                   ,
                                                   
                                                   
                                                      
                                                         λ
                                                      
                                                      
                                                         l
                                                      
                                                   
                                                   ∈
                                                   W
                                                
                                             
                                          
                                       
                                       
                                          
                                             Preprocessing:
                                             
                                                
                                                   (i)
                                                   Estimate the illuminant power spectrum L(λ
                                                      
                                                         l
                                                      ) using the method in [21] so as to compute R(u,
                                                      λ
                                                      
                                                         l
                                                      ) from I(u,
                                                      λ
                                                      
                                                         l
                                                      ) using Eq. (11).
                                                
                                                
                                                   (ii)
                                                   Separate R(u,
                                                      λ
                                                      
                                                         l
                                                      ) into R
                                                      
                                                         diff
                                                      (u,
                                                      λ
                                                      
                                                         l
                                                      ) and R
                                                      
                                                         spec
                                                      (u,
                                                      λ
                                                      
                                                         l
                                                      ) using the method in [50].
                                                
                                             
                                          
                                       
                                       
                                          1: t
                                             ←1
                                       
                                       
                                          2: while true do
                                          
                                       
                                       
                                          3: 
                                             for all 
                                             
                                                
                                                   u
                                                   ∈
                                                   I
                                                
                                              
                                             do
                                          
                                       
                                       
                                          4: 
                                             for all 
                                             
                                                
                                                   
                                                      
                                                         λ
                                                      
                                                      
                                                         l
                                                      
                                                   
                                                   ∈
                                                   W
                                                
                                              
                                             do
                                          
                                       
                                       
                                          5: 
                                             
                                             
                                                
                                                   
                                                      
                                                         ρ
                                                      
                                                      
                                                         ∗
                                                      
                                                   
                                                   (
                                                   u
                                                   ,
                                                   
                                                      
                                                         λ
                                                      
                                                      
                                                         l
                                                      
                                                   
                                                   )
                                                   ←
                                                   
                                                      
                                                         argmin
                                                      
                                                      
                                                         ρ
                                                         (
                                                         u
                                                         ,
                                                         
                                                            
                                                               λ
                                                            
                                                            
                                                               l
                                                            
                                                         
                                                         )
                                                      
                                                   
                                                   
                                                      
                                                         C
                                                      
                                                      
                                                         diff
                                                      
                                                   
                                                   (
                                                   I
                                                   )
                                                   
                                                   given
                                                   
                                                   
                                                      
                                                         W
                                                      
                                                      
                                                         diff
                                                      
                                                   
                                                   
                                                      
                                                         (
                                                         u
                                                         )
                                                      
                                                      
                                                         t
                                                         -
                                                         1
                                                      
                                                   
                                                   ,
                                                   η
                                                   
                                                      
                                                         (
                                                         u
                                                         ,
                                                         
                                                            
                                                               λ
                                                            
                                                            
                                                               l
                                                            
                                                         
                                                         )
                                                      
                                                      
                                                         t
                                                         -
                                                         1
                                                      
                                                   
                                                   ,
                                                   p
                                                   
                                                      
                                                         (
                                                         u
                                                         )
                                                      
                                                      
                                                         t
                                                         -
                                                         1
                                                      
                                                   
                                                   ,
                                                   q
                                                   
                                                      
                                                         (
                                                         u
                                                         )
                                                      
                                                      
                                                         t
                                                         -
                                                         1
                                                      
                                                   
                                                
                                             
                                          
                                       
                                       
                                          6: 
                                             end for
                                          
                                       
                                       
                                          7: 
                                             end for
                                          
                                       
                                       
                                          8: 
                                             for all 
                                             
                                                
                                                   r
                                                   ∈
                                                   I
                                                
                                              
                                             do
                                          
                                       
                                       
                                          9: 
                                             
                                                
                                                   ρ
                                                   
                                                      
                                                         (
                                                         u
                                                         ,
                                                         
                                                            
                                                               λ
                                                            
                                                            
                                                               l
                                                            
                                                         
                                                         )
                                                      
                                                      
                                                         t
                                                      
                                                   
                                                   ←
                                                   
                                                      
                                                         1
                                                      
                                                      
                                                         |
                                                         r
                                                         |
                                                      
                                                   
                                                   
                                                      
                                                         ∑
                                                      
                                                      
                                                         u
                                                         ∈
                                                         r
                                                      
                                                   
                                                   
                                                      
                                                         ρ
                                                      
                                                      
                                                         ∗
                                                      
                                                   
                                                   (
                                                   u
                                                   ,
                                                   
                                                      
                                                         λ
                                                      
                                                      
                                                         l
                                                      
                                                   
                                                   )
                                                   ,
                                                   
                                                   ∀
                                                   u
                                                   ∈
                                                   r
                                                   ,
                                                   
                                                      
                                                         λ
                                                      
                                                      
                                                         l
                                                      
                                                   
                                                   ∈
                                                   W
                                                
                                             
                                          
                                       
                                       
                                          10: 
                                             end for
                                          
                                       
                                       
                                          11: 
                                             for all 
                                             
                                                
                                                   u
                                                   ∈
                                                   I
                                                
                                              
                                             do
                                          
                                       
                                       
                                          12: 
                                             
                                                
                                                   
                                                      
                                                         W
                                                      
                                                      
                                                         diff
                                                      
                                                   
                                                   
                                                      
                                                         (
                                                         u
                                                         )
                                                      
                                                      
                                                         t
                                                      
                                                   
                                                   ←
                                                   
                                                      
                                                         argmin
                                                      
                                                      
                                                         
                                                            
                                                               W
                                                            
                                                            
                                                               diff
                                                            
                                                         
                                                         (
                                                         u
                                                         )
                                                      
                                                   
                                                   
                                                      
                                                         C
                                                      
                                                      
                                                         diff
                                                      
                                                   
                                                   (
                                                   I
                                                   )
                                                   
                                                      
                                                         |
                                                      
                                                      
                                                         ρ
                                                         
                                                            
                                                               (
                                                               u
                                                               ,
                                                               
                                                                  
                                                                     λ
                                                                  
                                                                  
                                                                     l
                                                                  
                                                               
                                                               )
                                                            
                                                            
                                                               t
                                                            
                                                         
                                                         ,
                                                         η
                                                         
                                                            
                                                               (
                                                               u
                                                               ,
                                                               
                                                                  
                                                                     λ
                                                                  
                                                                  
                                                                     l
                                                                  
                                                               
                                                               )
                                                            
                                                            
                                                               t
                                                               -
                                                               1
                                                            
                                                         
                                                         ,
                                                         p
                                                         
                                                            
                                                               (
                                                               u
                                                               )
                                                            
                                                            
                                                               t
                                                               -
                                                               1
                                                            
                                                         
                                                         ,
                                                         q
                                                         
                                                            
                                                               (
                                                               u
                                                               )
                                                            
                                                            
                                                               t
                                                               -
                                                               1
                                                            
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                       
                                       
                                          13: 
                                             end for
                                          
                                       
                                       
                                          14: 
                                             for all 
                                             
                                                
                                                   u
                                                   ∈
                                                   S
                                                
                                              
                                             do
                                          
                                       
                                       
                                          15: 
                                             
                                                
                                                   
                                                      
                                                         σ
                                                      
                                                      
                                                         m
                                                      
                                                   
                                                   
                                                      
                                                         (
                                                         u
                                                         )
                                                      
                                                      
                                                         t
                                                      
                                                   
                                                   ←
                                                   
                                                      
                                                         argmin
                                                      
                                                      
                                                         
                                                            
                                                               σ
                                                            
                                                            
                                                               m
                                                            
                                                         
                                                         (
                                                         u
                                                         )
                                                      
                                                   
                                                   
                                                      
                                                         C
                                                      
                                                      
                                                         spec
                                                      
                                                   
                                                   (
                                                   I
                                                   )
                                                   
                                                      
                                                         |
                                                      
                                                      
                                                         
                                                            
                                                               W
                                                            
                                                            
                                                               spec
                                                            
                                                         
                                                         
                                                            
                                                               (
                                                               u
                                                               )
                                                            
                                                            
                                                               t
                                                               -
                                                               1
                                                            
                                                         
                                                         ,
                                                         η
                                                         
                                                            
                                                               (
                                                               u
                                                               ,
                                                               
                                                                  
                                                                     λ
                                                                  
                                                                  
                                                                     l
                                                                  
                                                               
                                                               )
                                                            
                                                            
                                                               t
                                                               -
                                                               1
                                                            
                                                         
                                                         ,
                                                         p
                                                         
                                                            
                                                               (
                                                               u
                                                               )
                                                            
                                                            
                                                               t
                                                               -
                                                               1
                                                            
                                                         
                                                         ,
                                                         q
                                                         
                                                            
                                                               (
                                                               u
                                                               )
                                                            
                                                            
                                                               t
                                                               -
                                                               1
                                                            
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                       
                                       
                                          16: 
                                             end for
                                          
                                       
                                       
                                          17: 
                                             for all 
                                             
                                                
                                                   u
                                                   ∈
                                                   S
                                                
                                              
                                             do
                                          
                                       
                                       
                                          18: 
                                             
                                                
                                                   
                                                      
                                                         W
                                                      
                                                      
                                                         spec
                                                      
                                                   
                                                   
                                                      
                                                         (
                                                         u
                                                         )
                                                      
                                                      
                                                         t
                                                      
                                                   
                                                   ←
                                                   
                                                      
                                                         argmin
                                                      
                                                      
                                                         
                                                            
                                                               W
                                                            
                                                            
                                                               spec
                                                            
                                                         
                                                         (
                                                         u
                                                         )
                                                      
                                                   
                                                   
                                                      
                                                         C
                                                      
                                                      
                                                         spec
                                                      
                                                   
                                                   (
                                                   I
                                                   )
                                                   
                                                      
                                                         |
                                                      
                                                      
                                                         
                                                            
                                                               σ
                                                            
                                                            
                                                               m
                                                            
                                                         
                                                         
                                                            
                                                               (
                                                               u
                                                               )
                                                            
                                                            
                                                               t
                                                            
                                                         
                                                         ,
                                                         η
                                                         
                                                            
                                                               (
                                                               u
                                                               ,
                                                               
                                                                  
                                                                     λ
                                                                  
                                                                  
                                                                     l
                                                                  
                                                               
                                                               )
                                                            
                                                            
                                                               t
                                                               -
                                                               1
                                                            
                                                         
                                                         ,
                                                         p
                                                         
                                                            
                                                               (
                                                               u
                                                               )
                                                            
                                                            
                                                               t
                                                               -
                                                               1
                                                            
                                                         
                                                         ,
                                                         q
                                                         
                                                            
                                                               (
                                                               u
                                                               )
                                                            
                                                            
                                                               t
                                                               -
                                                               1
                                                            
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                       
                                       
                                          19: 
                                             end for
                                          
                                       
                                       
                                          20: 
                                             for all 
                                             
                                                
                                                   u
                                                   ∈
                                                   I
                                                
                                              
                                             do
                                          
                                       
                                       
                                          21: 
                                             for all 
                                             
                                                
                                                   
                                                      
                                                         λ
                                                      
                                                      
                                                         l
                                                      
                                                   
                                                   ∈
                                                   W
                                                
                                              
                                             do
                                          
                                       
                                       
                                          22: 
                                             
                                             
                                                
                                                   
                                                      
                                                         η
                                                      
                                                      
                                                         ∗
                                                      
                                                   
                                                   (
                                                   u
                                                   ,
                                                   
                                                      
                                                         λ
                                                      
                                                      
                                                         l
                                                      
                                                   
                                                   )
                                                   ←
                                                   
                                                      
                                                         argmin
                                                      
                                                      
                                                         η
                                                         (
                                                         u
                                                         ,
                                                         
                                                            
                                                               λ
                                                            
                                                            
                                                               l
                                                            
                                                         
                                                         )
                                                      
                                                   
                                                   C
                                                   (
                                                   I
                                                   )
                                                   
                                                   given
                                                   
                                                   ρ
                                                   
                                                      
                                                         (
                                                         u
                                                         ,
                                                         
                                                            
                                                               λ
                                                            
                                                            
                                                               l
                                                            
                                                         
                                                         )
                                                      
                                                      
                                                         t
                                                      
                                                   
                                                   ,
                                                   
                                                      
                                                         W
                                                      
                                                      
                                                         diff
                                                      
                                                   
                                                   
                                                      
                                                         (
                                                         u
                                                         )
                                                      
                                                      
                                                         t
                                                      
                                                   
                                                   ,
                                                   
                                                      
                                                         σ
                                                      
                                                      
                                                         m
                                                      
                                                   
                                                   
                                                      
                                                         (
                                                         u
                                                         )
                                                      
                                                      
                                                         t
                                                      
                                                   
                                                   ,
                                                   
                                                      
                                                         W
                                                      
                                                      
                                                         spec
                                                      
                                                   
                                                   
                                                      
                                                         (
                                                         u
                                                         )
                                                      
                                                      
                                                         t
                                                      
                                                   
                                                   ,
                                                   p
                                                   
                                                      
                                                         (
                                                         u
                                                         )
                                                      
                                                      
                                                         t
                                                         -
                                                         1
                                                      
                                                   
                                                   ,
                                                   q
                                                   
                                                      
                                                         (
                                                         u
                                                         )
                                                      
                                                      
                                                         t
                                                         -
                                                         1
                                                      
                                                   
                                                
                                             
                                          
                                       
                                       
                                          23: 
                                             end for
                                          
                                       
                                       
                                          24: 
                                             end for
                                          
                                       
                                       
                                          25: 
                                             for all 
                                             
                                                
                                                   u
                                                   ∈
                                                   I
                                                
                                              
                                             do
                                          
                                       
                                       
                                          26: 
                                             
                                                
                                                   
                                                      
                                                         C
                                                      
                                                      
                                                         k
                                                      
                                                   
                                                   
                                                      
                                                         (
                                                         u
                                                         )
                                                      
                                                      
                                                         t
                                                      
                                                   
                                                   =
                                                   
                                                      
                                                         argmin
                                                      
                                                      
                                                         
                                                            
                                                               C
                                                            
                                                            
                                                               k
                                                            
                                                         
                                                         (
                                                         u
                                                         )
                                                      
                                                   
                                                   
                                                      
                                                         ∑
                                                      
                                                      
                                                         
                                                            
                                                               λ
                                                            
                                                            
                                                               l
                                                            
                                                         
                                                         ∈
                                                         W
                                                      
                                                   
                                                   
                                                      
                                                         
                                                            
                                                               
                                                                  
                                                                     η
                                                                  
                                                                  
                                                                     ∗
                                                                  
                                                               
                                                               (
                                                               u
                                                               ,
                                                               
                                                                  
                                                                     λ
                                                                  
                                                                  
                                                                     l
                                                                  
                                                               
                                                               )
                                                               -
                                                               
                                                                  
                                                                     ∑
                                                                  
                                                                  
                                                                     k
                                                                     =
                                                                     1
                                                                  
                                                                  
                                                                     M
                                                                  
                                                               
                                                               
                                                                  
                                                                     C
                                                                  
                                                                  
                                                                     k
                                                                  
                                                               
                                                               
                                                                  
                                                                     (
                                                                     u
                                                                     )
                                                                  
                                                                  
                                                                     t
                                                                     -
                                                                     1
                                                                  
                                                               
                                                               
                                                                  
                                                                     λ
                                                                  
                                                                  
                                                                     l
                                                                  
                                                                  
                                                                     -
                                                                     2
                                                                     (
                                                                     k
                                                                     -
                                                                     1
                                                                     )
                                                                  
                                                               
                                                            
                                                         
                                                      
                                                      
                                                         2
                                                      
                                                   
                                                
                                             
                                          
                                       
                                       
                                          27: 
                                             for all 
                                             
                                                
                                                   
                                                      
                                                         λ
                                                      
                                                      
                                                         l
                                                      
                                                   
                                                   ∈
                                                   W
                                                
                                              
                                             do
                                          
                                       
                                       
                                          28: 
                                             
                                             
                                                
                                                   
                                                      
                                                         η
                                                      
                                                      
                                                         ˆ
                                                      
                                                   
                                                   
                                                      
                                                         (
                                                         u
                                                         ,
                                                         
                                                            
                                                               λ
                                                            
                                                            
                                                               l
                                                            
                                                         
                                                         )
                                                      
                                                      
                                                         t
                                                      
                                                   
                                                   =
                                                   
                                                      
                                                         ∑
                                                      
                                                      
                                                         k
                                                         =
                                                         1
                                                      
                                                      
                                                         M
                                                      
                                                   
                                                   
                                                      
                                                         C
                                                      
                                                      
                                                         k
                                                      
                                                   
                                                   
                                                      
                                                         (
                                                         u
                                                         )
                                                      
                                                      
                                                         t
                                                      
                                                   
                                                   
                                                      
                                                         λ
                                                      
                                                      
                                                         l
                                                      
                                                      
                                                         -
                                                         2
                                                         (
                                                         k
                                                         -
                                                         1
                                                         )
                                                      
                                                   
                                                
                                             
                                          
                                       
                                       
                                          29: 
                                             end for
                                          
                                       
                                       
                                          30: 
                                             end for
                                          
                                       
                                       
                                          31: 
                                             for all 
                                             
                                                
                                                   r
                                                   ∈
                                                   I
                                                
                                              
                                             do
                                          
                                       
                                       
                                          32: 
                                             
                                                
                                                   η
                                                   
                                                      
                                                         (
                                                         u
                                                         ,
                                                         
                                                            
                                                               λ
                                                            
                                                            
                                                               l
                                                            
                                                         
                                                         )
                                                      
                                                      
                                                         t
                                                      
                                                   
                                                   ←
                                                   
                                                      
                                                         1
                                                      
                                                      
                                                         |
                                                         r
                                                         |
                                                      
                                                   
                                                   
                                                      
                                                         ∑
                                                      
                                                      
                                                         u
                                                         ∈
                                                         r
                                                      
                                                   
                                                   
                                                      
                                                         η
                                                      
                                                      
                                                         ˆ
                                                      
                                                   
                                                   (
                                                   u
                                                   ,
                                                   
                                                      
                                                         λ
                                                      
                                                      
                                                         l
                                                      
                                                   
                                                   )
                                                   ,
                                                   
                                                   ∀
                                                   u
                                                   ∈
                                                   r
                                                   ,
                                                   
                                                      
                                                         λ
                                                      
                                                      
                                                         l
                                                      
                                                   
                                                   ∈
                                                   W
                                                
                                             
                                          
                                       
                                       
                                          33: 
                                             end for
                                          
                                       
                                       
                                          34: 
                                             for all 
                                             
                                                
                                                   u
                                                   ∈
                                                   I
                                                
                                              
                                             do
                                          
                                       
                                       
                                          35: 
                                             
                                                
                                                   
                                                      
                                                         
                                                            p
                                                            
                                                               
                                                                  (
                                                                  u
                                                                  )
                                                               
                                                               
                                                                  t
                                                               
                                                            
                                                            ,
                                                            q
                                                            
                                                               
                                                                  (
                                                                  u
                                                                  )
                                                               
                                                               
                                                                  t
                                                               
                                                            
                                                         
                                                      
                                                   
                                                   ←
                                                   
                                                      
                                                         argmin
                                                      
                                                      
                                                         p
                                                         (
                                                         u
                                                         )
                                                         ,
                                                         q
                                                         (
                                                         u
                                                         )
                                                      
                                                   
                                                   C
                                                   (
                                                   I
                                                   )
                                                   
                                                   given
                                                   
                                                   ρ
                                                   
                                                      
                                                         (
                                                         u
                                                         ,
                                                         
                                                            
                                                               λ
                                                            
                                                            
                                                               l
                                                            
                                                         
                                                         )
                                                      
                                                      
                                                         t
                                                      
                                                   
                                                   ,
                                                   
                                                      
                                                         W
                                                      
                                                      
                                                         diff
                                                      
                                                   
                                                   
                                                      
                                                         (
                                                         u
                                                         )
                                                      
                                                      
                                                         t
                                                      
                                                   
                                                   ,
                                                   
                                                      
                                                         σ
                                                      
                                                      
                                                         m
                                                      
                                                   
                                                   
                                                      
                                                         (
                                                         u
                                                         )
                                                      
                                                      
                                                         t
                                                      
                                                   
                                                   ,
                                                   
                                                      
                                                         W
                                                      
                                                      
                                                         spec
                                                      
                                                   
                                                   
                                                      
                                                         (
                                                         u
                                                         )
                                                      
                                                      
                                                         t
                                                      
                                                   
                                                   ,
                                                   η
                                                   
                                                      
                                                         (
                                                         u
                                                         ,
                                                         
                                                            
                                                               λ
                                                            
                                                            
                                                               l
                                                            
                                                         
                                                         )
                                                      
                                                      
                                                         t
                                                      
                                                   
                                                
                                             
                                          
                                       
                                       
                                          36: 
                                             end for
                                          
                                       
                                       
                                          37: 
                                             
                                                
                                                   converge
                                                   ←
                                                   
                                                      
                                                         ∑
                                                      
                                                      
                                                         u
                                                         ∈
                                                         I
                                                      
                                                   
                                                   
                                                      
                                                         ∑
                                                      
                                                      
                                                         
                                                            
                                                               λ
                                                            
                                                            
                                                               l
                                                            
                                                         
                                                         ∈
                                                         W
                                                      
                                                   
                                                   δ
                                                   (
                                                   ρ
                                                   (
                                                   u
                                                   ,
                                                   
                                                      
                                                         λ
                                                      
                                                      
                                                         l
                                                      
                                                   
                                                   )
                                                   )
                                                   ⩽
                                                   ε
                                                   
                                                   and
                                                   
                                                   
                                                      
                                                         ∑
                                                      
                                                      
                                                         u
                                                         ∈
                                                         I
                                                      
                                                   
                                                   
                                                      
                                                         ∑
                                                      
                                                      
                                                         
                                                            
                                                               λ
                                                            
                                                            
                                                               l
                                                            
                                                         
                                                         ∈
                                                         W
                                                      
                                                   
                                                   δ
                                                   (
                                                   η
                                                   (
                                                   u
                                                   ,
                                                   
                                                      
                                                         λ
                                                      
                                                      
                                                         l
                                                      
                                                   
                                                   )
                                                   )
                                                   ⩽
                                                   ε
                                                   
                                                   and
                                                   
                                                   
                                                      
                                                         ∑
                                                      
                                                      
                                                         u
                                                         ∈
                                                         I
                                                      
                                                   
                                                   δ
                                                   (
                                                   
                                                      
                                                         σ
                                                      
                                                      
                                                         m
                                                      
                                                   
                                                   (
                                                   u
                                                   )
                                                   )
                                                   ⩽
                                                   ε
                                                
                                              
                                             and 
                                                
                                                   
                                                      
                                                         ∑
                                                      
                                                      
                                                         u
                                                         ∈
                                                         I
                                                      
                                                   
                                                   δ
                                                   (
                                                   
                                                      
                                                         W
                                                      
                                                      
                                                         diff
                                                      
                                                   
                                                   (
                                                   u
                                                   )
                                                   )
                                                   ⩽
                                                   ε
                                                   
                                                   and
                                                   
                                                   
                                                      
                                                         ∑
                                                      
                                                      
                                                         u
                                                         ∈
                                                         I
                                                      
                                                   
                                                   δ
                                                   (
                                                   
                                                      
                                                         W
                                                      
                                                      
                                                         spec
                                                      
                                                   
                                                   (
                                                   u
                                                   )
                                                   )
                                                   ⩽
                                                   ε
                                                   
                                                   and
                                                   
                                                   
                                                      
                                                         ∑
                                                      
                                                      
                                                         u
                                                         ∈
                                                         I
                                                      
                                                   
                                                   δ
                                                   (
                                                   {
                                                   p
                                                   (
                                                   u
                                                   )
                                                   ,
                                                   q
                                                   (
                                                   u
                                                   )
                                                   }
                                                   )
                                                   ⩽
                                                   ε
                                                
                                             
                                          
                                       
                                       
                                          38: 
                                             if 
                                             converge or t
                                             >
                                             t
                                             
                                                max
                                              
                                             then
                                          
                                       
                                       
                                          39: break
                                       
                                       
                                          40: 
                                             else
                                          
                                       
                                       
                                          41: 
                                             t
                                             ←
                                             t
                                             +1
                                       
                                       
                                          42: 
                                             end if
                                          
                                       
                                       
                                          43: end while
                                          
                                       
                                       
                                          44: return 
                                             ρ(u,
                                             λ
                                             
                                                l
                                             ), η(u,
                                             λ
                                             
                                                l
                                             ), σ
                                             
                                                m
                                             (u), W
                                             
                                                spec
                                             (u), W
                                             
                                                diff
                                             (u), p(u), q(u)
                                       
                                    
                                 
                              
                           
                        

As mentioned earlier, the structure of the cost function in Eq. (5), permits the recovery of albedo ρ(u,
                        λ
                        
                           l
                        ) and diffuse weight W
                        
                           diff
                        , making use of the diffuse radiance devoid of the specular reflection. As a result, in this subsection, we focus on these two parameters, whereas in SubSections 3.2 and 3.3, we turn our attention to other photometric variables and object’s shape.

To commence, we recover ρ(u, λ
                           
                              l
                           ) at each pixel 
                              
                                 u
                                 ∈
                                 I
                              
                            and wavelength 
                              
                                 
                                    
                                       λ
                                    
                                    
                                       l
                                    
                                 
                                 ∈
                                 W
                              
                            given the current estimate of index of refraction η(u,
                           λ
                           
                              l
                           ), diffuse weight W
                           
                              diff
                           (u), and surface gradients p(u), q(u) as recovered at the previous iteration. This corresponds to Lines 3–7 of Algorithm 1. As the albedo only contributes to the diffuse component of reflectance, we estimate it making use of the diffuse term in cost function in Eq. (6). Moreover, to recover ρ(u,
                           λ
                           
                              l
                           ) at each pixel u and wavelength λ
                           
                              l
                           , we optimise over the neighbourhood Ω
                           
                              u
                            of u, this yields
                              
                                 (13)
                                 
                                    
                                       
                                          ρ
                                       
                                       
                                          ∗
                                       
                                    
                                    (
                                    u
                                    ,
                                    
                                       
                                          λ
                                       
                                       
                                          l
                                       
                                    
                                    )
                                    =
                                    
                                       
                                          argmin
                                       
                                       
                                          ρ
                                          (
                                          u
                                          ,
                                          
                                             
                                                λ
                                             
                                             
                                                l
                                             
                                          
                                          )
                                       
                                    
                                    
                                       
                                          
                                             ∑
                                          
                                          
                                             v
                                             ∊
                                             
                                                
                                                   Ω
                                                
                                                
                                                   u
                                                
                                             
                                          
                                       
                                    
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      R
                                                   
                                                   
                                                      diff
                                                   
                                                
                                                (
                                                v
                                                ,
                                                
                                                   
                                                      λ
                                                   
                                                   
                                                      l
                                                   
                                                
                                                )
                                                -
                                                
                                                   
                                                      
                                                         
                                                            W
                                                         
                                                         
                                                            diff
                                                         
                                                      
                                                      (
                                                      v
                                                      )
                                                   
                                                   
                                                      L
                                                      (
                                                      
                                                         
                                                            λ
                                                         
                                                         
                                                            l
                                                         
                                                      
                                                      )
                                                   
                                                
                                                
                                                   
                                                      f
                                                   
                                                   
                                                      diff
                                                   
                                                
                                                (
                                                L
                                                (
                                                
                                                   
                                                      λ
                                                   
                                                   
                                                      l
                                                   
                                                
                                                )
                                                ,
                                                p
                                                (
                                                v
                                                )
                                                ,
                                                q
                                                (
                                                v
                                                )
                                                ,
                                                ρ
                                                (
                                                v
                                                ,
                                                
                                                   
                                                      λ
                                                   
                                                   
                                                      l
                                                   
                                                
                                                )
                                                ,
                                                η
                                                (
                                                v
                                                ,
                                                
                                                   
                                                      λ
                                                   
                                                   
                                                      l
                                                   
                                                
                                                )
                                                )
                                             
                                          
                                       
                                       
                                          2
                                       
                                    
                                 
                              
                           where we have introduced the illuminant power spectrum L(λ
                           
                              l
                           ) so as to express the squared difference above in terms of diffuse reflectance as an alternative to the diffuse image radiance. Hereafter, we will employ this formalism for the sake of consistency.

Furthermore, note that, for each material in the image under consideration, the diffuse albedo is uniform across the scene. Thus, after recovering ρ
                           ∗(u,
                           λ
                           
                              l
                           ) for all the pixels in the image, we cluster the corresponding diffuse albedo into {r
                           1,…,
                           r
                           
                              c
                           } regions. This implies that each region r represents a unique material with unique diffuse albedo. By assuming normally distributed estimation errors with zero-mean, we can further improve our estimate of ρ(u,
                           λ
                           
                              l
                           ) in Lines 8–10 of Algorithm 1 by taking the expected value over all pixel u
                           ∈
                           r as given by
                              
                                 (14)
                                 
                                    ρ
                                    (
                                    u
                                    ,
                                    
                                       
                                          λ
                                       
                                       
                                          l
                                       
                                    
                                    )
                                    =
                                    
                                       
                                          1
                                       
                                       
                                          |
                                          r
                                          |
                                       
                                    
                                    
                                       
                                          
                                             ∑
                                          
                                          
                                             u
                                             ∊
                                             r
                                          
                                       
                                    
                                    
                                       
                                          ρ
                                       
                                       
                                          ∗
                                       
                                    
                                    (
                                    u
                                    ,
                                    
                                       
                                          λ
                                       
                                       
                                          l
                                       
                                    
                                    )
                                 
                              
                           over all the material regions in the scene.

As mentioned earlier, we also recover the diffuse weight W
                           
                              diff
                            at each pixel 
                              
                                 u
                                 ∈
                                 I
                              
                           . This is done making use of the optimal value of diffuse albedo ρ(u,
                           λ
                           
                              l
                           ) yielded by the optimisation in Eqs. 13 and 14 and the other parameters, i.e. the index of refraction η(u,
                           λ
                           
                              l
                           ) and surface gradients p(u) and q(u) recovered at the previous iteration. This process is outlined in Lines 11–13 of Algorithm 1.

The diffuse weight determines the contribution of the diffuse reflectance in the linear combination in Eq. (2). We, therefore, estimate this parameter by optimising the cost function in Eq. (6) making use of the fact that the diffuse weight should be fixed over the wavelength domain. Thus, our optimisation is effected per-pixel such that
                              
                                 (15)
                                 
                                    
                                       
                                          W
                                       
                                       
                                          diff
                                       
                                       
                                          ∗
                                       
                                    
                                    (
                                    u
                                    )
                                    =
                                    
                                       
                                          argmin
                                       
                                       
                                          
                                             
                                                W
                                             
                                             
                                                diff
                                             
                                          
                                          (
                                          u
                                          )
                                       
                                    
                                    
                                       
                                          
                                             ∑
                                          
                                          
                                             l
                                             =
                                             1
                                          
                                          
                                             |
                                             W
                                             |
                                          
                                       
                                    
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      R
                                                   
                                                   
                                                      diff
                                                   
                                                
                                                (
                                                u
                                                ,
                                                
                                                   
                                                      λ
                                                   
                                                   
                                                      l
                                                   
                                                
                                                )
                                                -
                                                
                                                   
                                                      
                                                         
                                                            W
                                                         
                                                         
                                                            diff
                                                         
                                                      
                                                      (
                                                      u
                                                      )
                                                   
                                                   
                                                      L
                                                      (
                                                      
                                                         
                                                            λ
                                                         
                                                         
                                                            l
                                                         
                                                      
                                                      )
                                                   
                                                
                                                
                                                   
                                                      f
                                                   
                                                   
                                                      diff
                                                   
                                                
                                                (
                                                L
                                                (
                                                
                                                   
                                                      λ
                                                   
                                                   
                                                      l
                                                   
                                                
                                                )
                                                ,
                                                p
                                                (
                                                u
                                                )
                                                ,
                                                q
                                                (
                                                u
                                                )
                                                ,
                                                ρ
                                                (
                                                u
                                                ,
                                                
                                                   
                                                      λ
                                                   
                                                   
                                                      l
                                                   
                                                
                                                )
                                                ,
                                                η
                                                (
                                                u
                                                ,
                                                
                                                   
                                                      λ
                                                   
                                                   
                                                      l
                                                   
                                                
                                                )
                                                )
                                             
                                          
                                       
                                       
                                          2
                                       
                                    
                                 
                              
                           
                        

With the diffuse albedo and weight, we now focus in the recovery of the microfacet slope and the specular weight. As the microfacet slope only influences the specular reflection, it cannot be estimated for matte pixels, which do not convey any information on the specular reflection parameters. As a result, we only estimate σ
                           
                              m
                            for those pixels 
                              
                                 u
                                 ∈
                                 S
                              
                           , where 
                              
                                 S
                              
                            is the set of specular pixels in 
                              
                                 I
                              
                           .

With the optimal values of specular weight W
                           
                              spec
                           (u) and the index of refraction η(u,λ
                           
                              l
                           ) computed at the previous iteration, we recover the microfacet slope making use of the optimisation corresponding to
                              
                                 (16)
                                 
                                    
                                       
                                          σ
                                       
                                       
                                          m
                                       
                                       
                                          ∗
                                       
                                    
                                    (
                                    u
                                    )
                                    =
                                    
                                       
                                          argmin
                                       
                                       
                                          
                                             
                                                σ
                                             
                                             
                                                m
                                             
                                          
                                       
                                    
                                    
                                       
                                          
                                             ∑
                                          
                                          
                                             l
                                             =
                                             1
                                          
                                          
                                             |
                                             W
                                             |
                                          
                                       
                                    
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         
                                                            
                                                               R
                                                            
                                                            
                                                               spec
                                                            
                                                         
                                                         (
                                                         u
                                                         ,
                                                         
                                                            
                                                               λ
                                                            
                                                            
                                                               l
                                                            
                                                         
                                                         )
                                                         -
                                                         
                                                            
                                                               
                                                                  
                                                                     W
                                                                  
                                                                  
                                                                     spec
                                                                  
                                                               
                                                               (
                                                               u
                                                               )
                                                            
                                                            
                                                               L
                                                               (
                                                               
                                                                  
                                                                     λ
                                                                  
                                                                  
                                                                     l
                                                                  
                                                               
                                                               )
                                                            
                                                         
                                                         
                                                            
                                                               f
                                                            
                                                            
                                                               spec
                                                            
                                                         
                                                         (
                                                         L
                                                         (
                                                         
                                                            
                                                               λ
                                                            
                                                            
                                                               l
                                                            
                                                         
                                                         )
                                                         ,
                                                         p
                                                         (
                                                         u
                                                         )
                                                         ,
                                                         q
                                                         (
                                                         u
                                                         )
                                                         ,
                                                         
                                                            
                                                               σ
                                                            
                                                            
                                                               m
                                                            
                                                         
                                                         (
                                                         u
                                                         )
                                                         ,
                                                         η
                                                         (
                                                         u
                                                         ,
                                                         
                                                            
                                                               λ
                                                            
                                                            
                                                               l
                                                            
                                                         
                                                         )
                                                         )
                                                      
                                                   
                                                
                                                
                                                   2
                                                
                                             
                                             +
                                             α
                                             R
                                          
                                       
                                    
                                 
                              
                           this accounts for Lines 14–16 of Algorithm 1 and is consistent with the fact that every wavelength-indexed band for the pixel u share the same σ
                           
                              m
                           .

Here, we have also introduced a regularisation term 
                              
                                 R
                              
                            where α is a constant that determines the contribution of the regulariser to the optimisation process. A number of regularisation schemes can be used, these span from curvature constraints as applied in shape-from-shading [57] to surface integrability [13]. Since, in practice, σ
                           
                              m
                            should not overly vary over the neighbourhood of the pixel u, here we employ a regularisation term which enforces a smoothly varying microfacet slope given by
                              
                                 (17)
                                 
                                    R
                                    =
                                    
                                       
                                          ∑
                                       
                                       
                                          v
                                          ∊
                                          
                                             
                                                Ω
                                             
                                             
                                                u
                                             
                                          
                                       
                                    
                                    
                                       
                                          (
                                          
                                             
                                                σ
                                             
                                             
                                                m
                                             
                                          
                                          (
                                          u
                                          )
                                          -
                                          
                                             
                                                σ
                                             
                                             
                                                m
                                             
                                          
                                          (
                                          v
                                          )
                                          )
                                       
                                       
                                          2
                                       
                                    
                                 
                              
                           
                        

This parameter determines the contribution of specular component of reflectance in the linear combination in Eq. (2). We, therefore, estimate this parameter by optimising cost function in Eq. (7) so as to encourage data closeness between the measured specular reflectance R
                           
                              spec
                            and the specular term in Eq. (2). For totally diffuse pixels, the specular weight should be zero. Our method therefore estimates W
                           
                              spec
                            for each pixel 
                              
                                 u
                                 ∈
                                 S
                              
                            given the optimal value of microfacet slope σ
                           
                              m
                           (u) estimated using Eq. (16) and the current estimates of the refractive index η(u,
                           λ
                           
                              l
                           ) and surface gradients p(u), q(u). This corresponds to Lines 17–19 in Algorithm 1.

In a manner analogous to the diffuse weight recovered in Subsection 3.1.2, W
                           
                              spec
                            varies per pixel, remaining fixed over the wavelength domain. Thus, we optimise over the wavelength-indexed bands as follows
                              
                                 (18)
                                 
                                    
                                       
                                          W
                                       
                                       
                                          spec
                                       
                                       
                                          ∗
                                       
                                    
                                    (
                                    u
                                    )
                                    =
                                    
                                       
                                          argmin
                                       
                                       
                                          
                                             
                                                W
                                             
                                             
                                                spec
                                             
                                          
                                          (
                                          u
                                          )
                                       
                                    
                                    
                                       
                                          
                                             ∑
                                          
                                          
                                             l
                                             =
                                             1
                                          
                                          
                                             |
                                             W
                                             |
                                          
                                       
                                    
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      R
                                                   
                                                   
                                                      spec
                                                   
                                                
                                                (
                                                u
                                                ,
                                                
                                                   
                                                      λ
                                                   
                                                   
                                                      l
                                                   
                                                
                                                )
                                                -
                                                
                                                   
                                                      
                                                         
                                                            W
                                                         
                                                         
                                                            spec
                                                         
                                                      
                                                      (
                                                      u
                                                      )
                                                   
                                                   
                                                      L
                                                      (
                                                      
                                                         
                                                            λ
                                                         
                                                         
                                                            l
                                                         
                                                      
                                                      )
                                                   
                                                
                                                
                                                   
                                                      f
                                                   
                                                   
                                                      spec
                                                   
                                                
                                                (
                                                L
                                                (
                                                
                                                   
                                                      λ
                                                   
                                                   
                                                      l
                                                   
                                                
                                                )
                                                ,
                                                p
                                                (
                                                u
                                                )
                                                ,
                                                q
                                                (
                                                u
                                                )
                                                ,
                                                
                                                   
                                                      σ
                                                   
                                                   
                                                      m
                                                   
                                                
                                                (
                                                u
                                                )
                                                ,
                                                η
                                                (
                                                u
                                                ,
                                                
                                                   
                                                      λ
                                                   
                                                   
                                                      l
                                                   
                                                
                                                )
                                                )
                                             
                                          
                                       
                                       
                                          2
                                       
                                    
                                 
                              
                           
                        

Finally, we turn our attention to the two parameters that apply to both, specular and diffuse reflection. Here, we estimate the index of refraction by noting that each material has its own unique refracted index defined over the spectral domain. Thus, our algorithm recovers the index of refraction per material. Further, following [22], we have constrained the index of refraction to follow Cauchy’s dispersion equation [5].

Analogous to our approach to recover the diffuse albedo, we first estimate the index of refraction per pixel. Then, we refine our estimated value by updating η(·) per material making use of the expected value over all pixels belonging to each material in the scene. Since η(·) contributes to both, the specular and diffuse component of reflection, we optimise using the cost function in Eq. (5), which comprises the data closeness terms for both, the specular and diffuse reflectance. This is depicted in Lines 20–24 of Algorithm 1. Here, in a manner akin to Section 3.2.1, we assume that, at each wavelength λ
                           
                              l
                           , η(·) varies slowly about the neighbourhood of pixel u. Therefore, we optimise over Ω
                           
                              u
                           , i.e. the neighbourhood of pixel u, so as to recover η(·) at pixel u and wavelength λ
                           
                              l
                            as follows
                              
                                 (19)
                                 
                                    
                                       
                                          η
                                       
                                       
                                          ∗
                                       
                                    
                                    (
                                    u
                                    ,
                                    
                                       
                                          λ
                                       
                                       
                                          l
                                       
                                    
                                    )
                                    =
                                    
                                       
                                          argmin
                                       
                                       
                                          η
                                          (
                                          u
                                          ,
                                          
                                             
                                                λ
                                             
                                             
                                                l
                                             
                                          
                                          )
                                       
                                    
                                    
                                       
                                          
                                             ∑
                                          
                                          
                                             v
                                             ∈
                                             
                                                
                                                   Ω
                                                
                                                
                                                   u
                                                
                                             
                                          
                                       
                                    
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         
                                                            
                                                               R
                                                            
                                                            
                                                               diff
                                                            
                                                         
                                                         (
                                                         v
                                                         ,
                                                         
                                                            
                                                               λ
                                                            
                                                            
                                                               l
                                                            
                                                         
                                                         )
                                                         -
                                                         
                                                            
                                                               
                                                                  
                                                                     W
                                                                  
                                                                  
                                                                     diff
                                                                  
                                                               
                                                               (
                                                               v
                                                               )
                                                            
                                                            
                                                               L
                                                               (
                                                               
                                                                  
                                                                     λ
                                                                  
                                                                  
                                                                     l
                                                                  
                                                               
                                                               )
                                                            
                                                         
                                                         
                                                            
                                                               f
                                                            
                                                            
                                                               diff
                                                            
                                                         
                                                         
                                                            
                                                               
                                                                  L
                                                                  (
                                                                  
                                                                     
                                                                        λ
                                                                     
                                                                     
                                                                        l
                                                                     
                                                                  
                                                                  )
                                                                  ,
                                                                  p
                                                                  (
                                                                  v
                                                                  )
                                                                  ,
                                                                  q
                                                                  (
                                                                  v
                                                                  )
                                                                  ,
                                                                  ρ
                                                                  (
                                                                  v
                                                                  ,
                                                                  
                                                                     
                                                                        λ
                                                                     
                                                                     
                                                                        l
                                                                     
                                                                  
                                                                  )
                                                                  ,
                                                                  η
                                                                  (
                                                                  v
                                                                  ,
                                                                  
                                                                     
                                                                        λ
                                                                     
                                                                     
                                                                        l
                                                                     
                                                                  
                                                                  )
                                                               
                                                            
                                                         
                                                      
                                                   
                                                
                                                
                                                   2
                                                
                                             
                                             +
                                             
                                                
                                                   
                                                      
                                                         
                                                            
                                                               R
                                                            
                                                            
                                                               spec
                                                            
                                                         
                                                         (
                                                         v
                                                         ,
                                                         
                                                            
                                                               λ
                                                            
                                                            
                                                               l
                                                            
                                                         
                                                         )
                                                         -
                                                         
                                                            
                                                               
                                                                  
                                                                     W
                                                                  
                                                                  
                                                                     spec
                                                                  
                                                               
                                                               (
                                                               v
                                                               )
                                                            
                                                            
                                                               L
                                                               (
                                                               
                                                                  
                                                                     λ
                                                                  
                                                                  
                                                                     l
                                                                  
                                                               
                                                               )
                                                            
                                                         
                                                         
                                                            
                                                               f
                                                            
                                                            
                                                               spec
                                                            
                                                         
                                                         (
                                                         L
                                                         (
                                                         
                                                            
                                                               λ
                                                            
                                                            
                                                               l
                                                            
                                                         
                                                         )
                                                         ,
                                                         p
                                                         (
                                                         v
                                                         )
                                                         ,
                                                         q
                                                         (
                                                         v
                                                         )
                                                         ,
                                                         
                                                            
                                                               σ
                                                            
                                                            
                                                               m
                                                            
                                                         
                                                         (
                                                         v
                                                         )
                                                         ,
                                                         η
                                                         (
                                                         v
                                                         ,
                                                         
                                                            
                                                               λ
                                                            
                                                            
                                                               l
                                                            
                                                         
                                                         )
                                                         )
                                                      
                                                   
                                                
                                                
                                                   2
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           and, with the per-pixel estimates at hand, We constrain the refractive indexes to follow Cauchy’s dispersion equation.

Recall that Cauchy’s equation is an empirical expression relating the refractive index to the wavelength through material specific dispersion coefficients. To enforce Cauchy’s dispersion, we first estimate dispersion coefficients by fitting Cauchy’s equation to the estimated index of refraction as follows
                              
                                 (20)
                                 
                                    
                                       
                                          C
                                       
                                       
                                          k
                                       
                                       
                                          ∗
                                       
                                    
                                    (
                                    u
                                    )
                                    =
                                    
                                       
                                          argmin
                                       
                                       
                                          
                                             
                                                C
                                             
                                             
                                                k
                                             
                                          
                                       
                                    
                                    
                                       
                                          
                                             ∑
                                          
                                          
                                             l
                                             =
                                             1
                                          
                                          
                                             |
                                             W
                                             |
                                          
                                       
                                    
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      η
                                                   
                                                   
                                                      ∗
                                                   
                                                
                                                (
                                                u
                                                ,
                                                
                                                   
                                                      λ
                                                   
                                                   
                                                      l
                                                   
                                                
                                                )
                                                -
                                                
                                                   
                                                   
                                                      M
                                                   
                                                
                                                
                                                   
                                                      
                                                         ∑
                                                      
                                                      
                                                         k
                                                         =
                                                         1
                                                      
                                                   
                                                
                                                
                                                   
                                                      C
                                                   
                                                   
                                                      k
                                                   
                                                
                                                (
                                                u
                                                )
                                                
                                                   
                                                      λ
                                                   
                                                   
                                                      l
                                                   
                                                   
                                                      -
                                                      2
                                                      (
                                                      k
                                                      -
                                                      1
                                                      )
                                                   
                                                
                                             
                                          
                                       
                                       
                                          2
                                       
                                    
                                 
                              
                           
                        

Here, the coefficients C
                           
                              k
                           (u), k∊{1,…,
                           M} can be viewed as a characteristic of the material. In Algorithm 1, Lines 25–30 we recover the M dispersion coefficients at each pixel u by optimising over the corresponding wavelength-indexed bands. With the estimated dispersion coefficients, the index of refraction can be updated, as shown in Line 28 of Algorithm 1, using the expected value for Cauchy’s equation given by
                              
                                 (21)
                                 
                                    η
                                    (
                                    u
                                    ,
                                    
                                       
                                          λ
                                       
                                       
                                          l
                                       
                                    
                                    )
                                    =
                                    
                                       
                                          1
                                       
                                       
                                          |
                                          r
                                          |
                                       
                                    
                                    
                                       
                                          
                                             ∑
                                          
                                          
                                             u
                                             ∊
                                             r
                                          
                                       
                                    
                                    
                                       
                                          
                                             ∑
                                          
                                          
                                             k
                                             =
                                             1
                                          
                                          
                                             M
                                          
                                       
                                    
                                    
                                       
                                          C
                                       
                                       
                                          k
                                       
                                       
                                          ∗
                                       
                                    
                                    (
                                    u
                                    )
                                    
                                       
                                          λ
                                       
                                       
                                          l
                                       
                                       
                                          -
                                          2
                                          (
                                          k
                                          -
                                          1
                                          )
                                       
                                    
                                 
                              
                           where we have used the regions recovered while updating the diffuse albedo.

We now proceed to recover the object surface gradients making use of the viewer-centered global coordinate system presented in Section 2.1. Recall that, on our viewer-centered coordinate system, the surface normal 
                              
                                 
                                    
                                       N
                                    
                                    
                                       →
                                    
                                 
                              
                            can be expressed in terms of surface gradients. As a result, the vectors [1,0,
                           p]
                              T
                            and [0,1,
                           q]
                              T
                            are, hence, tangent to the surface. By definition, the surface normal is perpendicular to all vectors in the tangent plane and parallel to the cross-product of these two, that is
                              
                                 (22)
                                 
                                    
                                       
                                          [
                                          1
                                          ,
                                          0
                                          ,
                                          p
                                          (
                                          u
                                          )
                                          ]
                                       
                                       
                                          T
                                       
                                    
                                    ×
                                    
                                       
                                          [
                                          0
                                          ,
                                          1
                                          ,
                                          q
                                          (
                                          u
                                          )
                                          ]
                                       
                                       
                                          T
                                       
                                    
                                    =
                                    
                                       
                                          [
                                          -
                                          p
                                          (
                                          u
                                          )
                                          ,
                                          -
                                          q
                                          (
                                          u
                                          )
                                          ,
                                          1
                                          ]
                                       
                                       
                                          T
                                       
                                    
                                 
                              
                           and, as mentioned earlier, the normalised surface normal is given by
                              
                                 (23)
                                 
                                    
                                       
                                          N
                                       
                                       
                                          →
                                       
                                    
                                    (
                                    u
                                    )
                                    =
                                    
                                       
                                          1
                                       
                                       
                                          
                                             
                                                [
                                                p
                                                
                                                   
                                                      (
                                                      u
                                                      )
                                                   
                                                   
                                                      2
                                                   
                                                
                                                +
                                                q
                                                
                                                   
                                                      (
                                                      u
                                                      )
                                                   
                                                   
                                                      2
                                                   
                                                
                                                +
                                                1
                                                ]
                                             
                                             
                                                
                                                   
                                                      1
                                                   
                                                   
                                                      2
                                                   
                                                
                                             
                                          
                                       
                                    
                                    
                                       
                                          [
                                          -
                                          p
                                          (
                                          u
                                          )
                                          ,
                                          -
                                          q
                                          (
                                          u
                                          )
                                          ,
                                          1
                                          ]
                                       
                                       
                                          T
                                       
                                    
                                 
                              
                           
                        

The expression above is important since it permits the recovery of the object’s shape at each pixel by estimating only two variables, i.e. p(u) and q(u), per pixel u. As per the reparameterisation in Eq. (2), we perform the optimisation procedure making use of both, the diffuse and specular components. This is reflected in Lines 34–36 of Algorithm 1. This is a straightforward task since the other reflection parameters are in hand. Moreover, we introduce a regularisation term corresponding to the integrability constraint widely used in shape-from-shading [13,57]. Thus, the optimisation becomes
                              
                                 (24)
                                 
                                    [
                                    
                                       
                                          p
                                       
                                       
                                          ∗
                                       
                                    
                                    (
                                    u
                                    )
                                    ,
                                    
                                       
                                          q
                                       
                                       
                                          ∗
                                       
                                    
                                    (
                                    u
                                    )
                                    ]
                                    =
                                    
                                       
                                          argmin
                                       
                                       
                                          p
                                          (
                                          u
                                          )
                                          ,
                                          q
                                          (
                                          u
                                          )
                                       
                                    
                                    
                                       
                                          
                                             ∑
                                          
                                          
                                             v
                                             ∊
                                             
                                                
                                                   Ω
                                                
                                                
                                                   u
                                                
                                             
                                          
                                       
                                    
                                    
                                       
                                          
                                             ∑
                                          
                                          
                                             l
                                             =
                                             1
                                          
                                          
                                             |
                                             W
                                             |
                                          
                                       
                                    
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         
                                                            
                                                               R
                                                            
                                                            
                                                               diff
                                                            
                                                         
                                                         (
                                                         v
                                                         ,
                                                         
                                                            
                                                               λ
                                                            
                                                            
                                                               l
                                                            
                                                         
                                                         )
                                                         -
                                                         
                                                            
                                                               
                                                                  
                                                                     W
                                                                  
                                                                  
                                                                     diff
                                                                  
                                                               
                                                               (
                                                               v
                                                               )
                                                            
                                                            
                                                               L
                                                               (
                                                               
                                                                  
                                                                     λ
                                                                  
                                                                  
                                                                     l
                                                                  
                                                               
                                                               )
                                                            
                                                         
                                                         
                                                            
                                                               f
                                                            
                                                            
                                                               diff
                                                            
                                                         
                                                         
                                                            
                                                               
                                                                  L
                                                                  (
                                                                  
                                                                     
                                                                        λ
                                                                     
                                                                     
                                                                        l
                                                                     
                                                                  
                                                                  )
                                                                  ,
                                                                  p
                                                                  (
                                                                  v
                                                                  )
                                                                  ,
                                                                  q
                                                                  (
                                                                  v
                                                                  )
                                                                  ,
                                                                  ρ
                                                                  (
                                                                  v
                                                                  ,
                                                                  
                                                                     
                                                                        λ
                                                                     
                                                                     
                                                                        l
                                                                     
                                                                  
                                                                  )
                                                                  ,
                                                                  η
                                                                  (
                                                                  v
                                                                  ,
                                                                  
                                                                     
                                                                        λ
                                                                     
                                                                     
                                                                        l
                                                                     
                                                                  
                                                                  )
                                                               
                                                            
                                                         
                                                      
                                                   
                                                
                                                
                                                   2
                                                
                                             
                                          
                                       
                                    
                                    +
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      R
                                                   
                                                   
                                                      spec
                                                   
                                                
                                                (
                                                v
                                                ,
                                                
                                                   
                                                      λ
                                                   
                                                   
                                                      l
                                                   
                                                
                                                )
                                                -
                                                
                                                   
                                                      
                                                         
                                                            W
                                                         
                                                         
                                                            spec
                                                         
                                                      
                                                      (
                                                      v
                                                      )
                                                   
                                                   
                                                      L
                                                      (
                                                      
                                                         
                                                            λ
                                                         
                                                         
                                                            l
                                                         
                                                      
                                                      )
                                                   
                                                
                                                
                                                   
                                                      f
                                                   
                                                   
                                                      spec
                                                   
                                                
                                                
                                                   
                                                      
                                                         L
                                                         (
                                                         
                                                            
                                                               λ
                                                            
                                                            
                                                               l
                                                            
                                                         
                                                         )
                                                         ,
                                                         p
                                                         (
                                                         v
                                                         )
                                                         ,
                                                         q
                                                         (
                                                         v
                                                         )
                                                         ,
                                                         
                                                            
                                                               σ
                                                            
                                                            
                                                               m
                                                            
                                                         
                                                         (
                                                         v
                                                         )
                                                         ,
                                                         η
                                                         (
                                                         v
                                                         ,
                                                         
                                                            
                                                               λ
                                                            
                                                            
                                                               l
                                                            
                                                         
                                                         )
                                                      
                                                   
                                                
                                             
                                          
                                       
                                       
                                          2
                                       
                                    
                                    
                                       
                                          
                                             +
                                             
                                                
                                                   
                                                      
                                                         
                                                            
                                                               ∂
                                                               p
                                                               (
                                                               v
                                                               )
                                                            
                                                            
                                                               ∂
                                                               y
                                                            
                                                         
                                                         -
                                                         
                                                            
                                                               ∂
                                                               q
                                                               (
                                                               v
                                                               )
                                                            
                                                            
                                                               ∂
                                                               x
                                                            
                                                         
                                                      
                                                   
                                                
                                                
                                                   2
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           
                        

In the optimisation above, the last term on the right-hand-side corresponds to the regularisation term. Also, note that we optimise the cost functional over the neighbourhood Ω
                           
                              u
                            of pixel u. This implies that the surface normal 
                              
                                 
                                    
                                       N
                                    
                                    
                                       →
                                    
                                 
                              
                            varies slowly about the pixel under consideration. This assumption does not imply any strong constraint on the surface shape rather reflects that, over small neighbourhoods of u, the surface can be considered to be locally smooth.

Finally, we discuss two criteria of the algorithm to stop searching for optimal values of the parameters: (i) when the algorithm is already converged; no improvement is seen at the current cycle of optimisation along different coordinate directions, (ii) when the algorithm already completed maximum number of iterations t
                        
                           max
                         and therefore giving up. Line 37 of Algorithm 1 describe the convergence criteria, where the function δ(·) is used to denote the absolute difference between the estimates at iterations t and t
                        −1 for any of the reflectance parameters. Therefore, as long as there is a significant change in the current estimate for at least one of the parameters and t
                        <
                        t
                        
                           max
                        , the algorithm continues, otherwise, it stops and returns the parameter values estimated so far.

So far, we have made no assumptions regarding the specific reflectance model to be used for purposes of optimisation. In this section, we examine a number of reflectance models elsewhere in the literature which conform to the general formulation and optimisation approach described in Sections 2 and 3. It is worth noting in passing that, in previous sections, we have used the diffuse and specular image radiance, which can be related to the reflectance in the models hereafter making use of the relations
                        
                           (25)
                           
                              
                                 
                                    
                                    
                                       
                                          
                                             
                                                R
                                             
                                             
                                                diff
                                             
                                          
                                          (
                                          u
                                          ,
                                          
                                             
                                                λ
                                             
                                             
                                                l
                                             
                                          
                                          )
                                          =
                                          
                                             
                                                1
                                             
                                             
                                                L
                                                (
                                                
                                                   
                                                      λ
                                                   
                                                   
                                                      l
                                                   
                                                
                                                )
                                             
                                          
                                          
                                             
                                                f
                                             
                                             
                                                diff
                                             
                                          
                                          (
                                          L
                                          (
                                          
                                             
                                                λ
                                             
                                             
                                                l
                                             
                                          
                                          )
                                          ,
                                          p
                                          (
                                          u
                                          )
                                          ,
                                          q
                                          (
                                          u
                                          )
                                          ,
                                          ρ
                                          (
                                          u
                                          ,
                                          
                                             
                                                λ
                                             
                                             
                                                l
                                             
                                          
                                          )
                                          ,
                                          η
                                          (
                                          u
                                          ,
                                          
                                             
                                                λ
                                             
                                             
                                                l
                                             
                                          
                                          )
                                          )
                                       
                                    
                                 
                                 
                                    
                                    
                                       
                                          
                                             
                                                R
                                             
                                             
                                                spec
                                             
                                          
                                          (
                                          u
                                          ,
                                          
                                             
                                                λ
                                             
                                             
                                                l
                                             
                                          
                                          )
                                          =
                                          
                                             
                                                1
                                             
                                             
                                                L
                                                (
                                                
                                                   
                                                      λ
                                                   
                                                   
                                                      l
                                                   
                                                
                                                )
                                             
                                          
                                          
                                             
                                                f
                                             
                                             
                                                spec
                                             
                                          
                                          (
                                          L
                                          (
                                          
                                             
                                                λ
                                             
                                             
                                                l
                                             
                                          
                                          )
                                          ,
                                          p
                                          (
                                          u
                                          )
                                          ,
                                          q
                                          (
                                          u
                                          )
                                          ,
                                          
                                             
                                                σ
                                             
                                             
                                                m
                                             
                                          
                                          (
                                          u
                                          )
                                          ,
                                          η
                                          (
                                          u
                                          ,
                                          
                                             
                                                λ
                                             
                                             
                                                l
                                             
                                          
                                          )
                                          )
                                       
                                    
                                 
                              
                           
                        
                     
                  

In practice, we can use the relations above so as to substitute the reflectance corresponding to one or more of the models elsewhere in the literature into the cost function in Eq. (5). Thus, we elaborate upon four reflectance models elsewhere in the literature and their specific parameters.

We commence by exploring the use of the Torrance–Sparrow model [52], which describes the reflectance from rough surfaces as comprised by two components. These are Lambertian diffuse reflection and the specular lobe. Here, we will focus on the component describing the specular lobe exhibited by smooth and rough surfaces. The main idea in [52] is to model a surface as a collection of perfectly smooth mirror like microfacets. In the model, these microfacets are perfect mirrors.

For a given light source and viewer directions 
                           
                              
                                 
                                    L
                                 
                                 
                                    →
                                 
                              
                           
                         and 
                           
                              
                                 
                                    V
                                 
                                 
                                    →
                                 
                              
                           
                        , the specular reflection is solely dependent on those microfacets with a normal 
                           
                              
                                 
                                    N
                                 
                                 
                                    →
                                 
                              
                           
                         aligned with the halfway vector 
                           
                              
                                 
                                    H
                                 
                                 
                                    →
                                 
                              
                           
                        . The corresponding equation for the specular reflectance is therefore given by:
                           
                              (26)
                              
                                 
                                    
                                       R
                                    
                                    
                                       TS
                                    
                                 
                                 (
                                 u
                                 ,
                                 
                                    
                                       λ
                                    
                                    
                                       l
                                    
                                 
                                 )
                                 =
                                 
                                    
                                       
                                          
                                             A
                                          
                                          
                                             f
                                          
                                       
                                    
                                    
                                       4
                                    
                                 
                                 F
                                 (
                                 
                                    
                                       θ
                                    
                                    
                                       i
                                    
                                 
                                 ,
                                 η
                                 (
                                 u
                                 ,
                                 
                                    
                                       λ
                                    
                                    
                                       l
                                    
                                 
                                 )
                                 )
                                 
                                    
                                       G
                                       (
                                       
                                          
                                             θ
                                          
                                          
                                             i
                                          
                                       
                                       ,
                                       
                                          
                                             θ
                                          
                                          
                                             s
                                          
                                       
                                       ,
                                       
                                          
                                             ϕ
                                          
                                          
                                             i
                                          
                                       
                                       ,
                                       
                                          
                                             ϕ
                                          
                                          
                                             s
                                          
                                       
                                       )
                                    
                                    
                                       cos
                                       
                                          
                                             θ
                                          
                                          
                                             s
                                          
                                       
                                    
                                 
                                 D
                                 (
                                 
                                    
                                       θ
                                    
                                    
                                       h
                                    
                                 
                                 ,
                                 
                                    
                                       σ
                                    
                                    
                                       m
                                    
                                 
                                 )
                              
                           
                        where
                           
                              (27)
                              
                                 G
                                 (
                                 
                                    
                                       θ
                                    
                                    
                                       i
                                    
                                 
                                 ,
                                 
                                    
                                       θ
                                    
                                    
                                       s
                                    
                                 
                                 ,
                                 
                                    
                                       ϕ
                                    
                                    
                                       i
                                    
                                 
                                 ,
                                 
                                    
                                       ϕ
                                    
                                    
                                       s
                                    
                                 
                                 )
                                 =
                                 min
                                 
                                    
                                       
                                          1
                                          ,
                                          
                                             
                                                2
                                                (
                                                
                                                   
                                                      N
                                                   
                                                   
                                                      →
                                                   
                                                
                                                ·
                                                
                                                   
                                                      H
                                                   
                                                   
                                                      →
                                                   
                                                
                                                )
                                                (
                                                
                                                   
                                                      N
                                                   
                                                   
                                                      →
                                                   
                                                
                                                ·
                                                
                                                   
                                                      V
                                                   
                                                   
                                                      →
                                                   
                                                
                                                )
                                             
                                             
                                                
                                                   
                                                      (
                                                      V
                                                   
                                                   
                                                      →
                                                   
                                                
                                                ·
                                                
                                                   
                                                      H
                                                   
                                                   
                                                      →
                                                   
                                                
                                                )
                                             
                                          
                                          ,
                                          
                                             
                                                2
                                                (
                                                
                                                   
                                                      N
                                                   
                                                   
                                                      →
                                                   
                                                
                                                ·
                                                
                                                   
                                                      H
                                                   
                                                   
                                                      →
                                                   
                                                
                                                )
                                                (
                                                
                                                   
                                                      N
                                                   
                                                   
                                                      →
                                                   
                                                
                                                ·
                                                
                                                   
                                                      L
                                                   
                                                   
                                                      →
                                                   
                                                
                                                )
                                             
                                             
                                                
                                                   
                                                      (
                                                      V
                                                   
                                                   
                                                      →
                                                   
                                                
                                                ·
                                                
                                                   
                                                      H
                                                   
                                                   
                                                      →
                                                   
                                                
                                                )
                                             
                                          
                                       
                                    
                                 
                              
                           
                        
                        
                           
                              (28)
                              
                                 D
                                 (
                                 
                                    
                                       θ
                                    
                                    
                                       h
                                    
                                 
                                 ,
                                 
                                    
                                       σ
                                    
                                    
                                       m
                                    
                                 
                                 )
                                 =
                                 c
                                 exp
                                 
                                    
                                       
                                          -
                                          
                                             
                                                
                                                   
                                                      θ
                                                   
                                                   
                                                      h
                                                   
                                                   
                                                      2
                                                   
                                                
                                             
                                             
                                                2
                                                
                                                   
                                                      σ
                                                   
                                                   
                                                      m
                                                   
                                                   
                                                      2
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           
                        the notation · denotes the dot product between vectors, c is a constant and σ
                        
                           m
                         is the roughness parameter.

Note that, according to Eq. (26), the specular reflectance R
                        
                           TS
                        (·) at pixel u and wavelength λ
                        
                           l
                         is governed by the microfacet area A
                        
                           f
                        , the wavelength dependent Fresnel term F(·), geometric attenuation factor G(·) and the microfacet slope distribution function D(·). In the model, the geometric attenuation factor G(·), as given in Eq. (27), accounts for the microfacet-to-microfacet masking and shadowing. The microfacet distribution function D(·) used here is a rotationally symmetric normal distribution with zero mean, i.e. 
                           
                              
                                 
                                    
                                       
                                          θ
                                       
                                       
                                          ¯
                                       
                                    
                                 
                                 
                                    h
                                 
                              
                              =
                              0
                           
                        , and standard deviation σ
                        
                           m
                        , which captures the probability density of the microfacets pointing in the direction of the halfway vector 
                           
                              
                                 
                                    H
                                 
                                 
                                    →
                                 
                              
                           
                        .

As the surface is not a perfect reflector, only a fraction of the incident light reaching the facets will be reflected. The Fresnel term F(·) determines the fraction of incident light which is reflected by each facet. The computation of the Fresnel term is quite expensive computationally and, therefore, here we apply the Schlick approximation [45] given by
                           
                              (29)
                              
                                 F
                                 (
                                 
                                    
                                       θ
                                    
                                    
                                       i
                                    
                                 
                                 ,
                                 η
                                 (
                                 u
                                 ,
                                 
                                    
                                       λ
                                    
                                    
                                       l
                                    
                                 
                                 )
                                 )
                                 =
                                 
                                    
                                       R
                                    
                                    
                                       o
                                    
                                 
                                 +
                                 (
                                 1
                                 -
                                 
                                    
                                       R
                                    
                                    
                                       o
                                    
                                 
                                 )
                                 
                                    
                                       (
                                       1
                                       -
                                       cos
                                       
                                          
                                             θ
                                          
                                          
                                             i
                                          
                                       
                                       )
                                    
                                    
                                       5
                                    
                                 
                              
                           
                        where, as before, θ
                        
                           i
                         is the angle of incidence and η(u, λ
                        
                           l
                        ) is the refractive index at pixel u and wavelength λ
                        
                           l
                        . In Schlick’s approximation, R
                        
                           o
                         is the reflectance at normal incidence, defined as 
                           
                              
                                 
                                    R
                                 
                                 
                                    0
                                 
                              
                              =
                              
                                 
                                    
                                       
                                          
                                             
                                                1
                                                -
                                                η
                                                (
                                                u
                                                ,
                                                
                                                   
                                                      λ
                                                   
                                                   
                                                      l
                                                   
                                                
                                                )
                                             
                                             
                                                1
                                                +
                                                η
                                                (
                                                u
                                                ,
                                                
                                                   
                                                      λ
                                                   
                                                   
                                                      l
                                                   
                                                
                                                )
                                             
                                          
                                       
                                    
                                 
                                 
                                    2
                                 
                              
                           
                        .

A model akin to that of Torrance and Sparrow is that developed by Cook and Torrance [8]. This is actually a combination of the Torrance–Sparrow model [52] and the Blinn model [3]. Just like the Torrance–Sparrow model, it considers the Fresnel term, surface self-shadowing and microfacets for reflectance modelling. However, it provides microfacet distribution functions for the Phong model [40], the Trowbridge-Reitz [53] and the Beckmann [2] distributions. Here we describe the reflectance equation of this model using the Beckmann distribution. Therefore, the reflectance equation, as described by this model, is given as
                           
                              (30)
                              
                                 
                                    
                                       R
                                    
                                    
                                       CT
                                    
                                 
                                 (
                                 u
                                 ,
                                 
                                    
                                       λ
                                    
                                    
                                       l
                                    
                                 
                                 )
                                 =
                                 F
                                 (
                                 
                                    
                                       θ
                                    
                                    
                                       i
                                    
                                 
                                 ,
                                 η
                                 (
                                 u
                                 ,
                                 
                                    
                                       λ
                                    
                                    
                                       l
                                    
                                 
                                 )
                                 )
                                 
                                    
                                       G
                                       (
                                       
                                          
                                             θ
                                          
                                          
                                             i
                                          
                                       
                                       ,
                                       
                                          
                                             θ
                                          
                                          
                                             s
                                          
                                       
                                       ,
                                       
                                          
                                             ϕ
                                          
                                          
                                             i
                                          
                                       
                                       ,
                                       
                                          
                                             ϕ
                                          
                                          
                                             s
                                          
                                       
                                       )
                                    
                                    
                                       cos
                                       
                                          
                                             θ
                                          
                                          
                                             s
                                          
                                       
                                       cos
                                       
                                          
                                             θ
                                          
                                          
                                             i
                                          
                                       
                                    
                                 
                                 
                                    
                                       D
                                    
                                    
                                       BK
                                    
                                 
                                 (
                                 
                                    
                                       θ
                                    
                                    
                                       h
                                    
                                 
                                 ,
                                 
                                    
                                       σ
                                    
                                    
                                       m
                                    
                                 
                                 )
                              
                           
                        where D
                        
                           BK
                        (·) stands for the Beckmann distribution function given by
                           
                              (31)
                              
                                 
                                    
                                       D
                                    
                                    
                                       BK
                                    
                                 
                                 (
                                 
                                    
                                       θ
                                    
                                    
                                       h
                                    
                                 
                                 ,
                                 
                                    
                                       σ
                                    
                                    
                                       m
                                    
                                 
                                 )
                                 =
                                 
                                    
                                       1
                                    
                                    
                                       
                                          
                                             σ
                                          
                                          
                                             m
                                          
                                          
                                             2
                                          
                                       
                                       
                                          
                                             cos
                                          
                                          
                                             4
                                          
                                       
                                       
                                          
                                             θ
                                          
                                          
                                             h
                                          
                                       
                                    
                                 
                                 exp
                                 
                                    
                                       
                                          
                                             -
                                             
                                                
                                                   tan
                                                   
                                                      
                                                         θ
                                                      
                                                      
                                                         h
                                                      
                                                   
                                                
                                                
                                                   
                                                      
                                                         σ
                                                      
                                                      
                                                         m
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                    
                                       2
                                    
                                 
                              
                           
                        
                     

We now turn our attention to another model widely cited in the computer vision and graphics literature. The Beckmann–Kirchhoff model [2] describes the reflection from a surface as a sum of two terms. The first of these corresponds to the scattering component in the specular direction and the latter represents the diffuse scattering. The term describing the specular spike given by
                           
                              (32)
                              
                                 
                                    
                                       R
                                    
                                    
                                       BK
                                    
                                 
                                 (
                                 u
                                 ,
                                 
                                    
                                       λ
                                    
                                    
                                       l
                                    
                                 
                                 )
                                 =
                                 
                                    
                                       P
                                    
                                    
                                       0
                                    
                                    
                                       2
                                    
                                 
                                 (
                                 
                                    
                                       θ
                                    
                                    
                                       h
                                    
                                 
                                 ,
                                 σ
                                 )
                                 exp
                                 (
                                 -
                                 g
                                 (
                                 
                                    
                                       θ
                                    
                                    
                                       i
                                    
                                 
                                 ,
                                 
                                    
                                       θ
                                    
                                    
                                       s
                                    
                                 
                                 ,
                                 
                                    
                                       λ
                                    
                                    
                                       l
                                    
                                 
                                 ,
                                 
                                    
                                       σ
                                    
                                    
                                       h
                                    
                                 
                                 )
                                 )
                                 F
                                 (
                                 
                                    
                                       θ
                                    
                                    
                                       i
                                    
                                 
                                 ,
                                 η
                                 (
                                 u
                                 ,
                                 
                                    
                                       λ
                                    
                                    
                                       l
                                    
                                 
                                 )
                                 )
                              
                           
                        where
                           
                              (33)
                              
                                 
                                    
                                       P
                                    
                                    
                                       0
                                    
                                 
                                 (
                                 
                                    
                                       θ
                                    
                                    
                                       h
                                    
                                 
                                 ,
                                 σ
                                 )
                                 =
                                 
                                    
                                       1
                                    
                                    
                                       
                                          
                                             2
                                             π
                                          
                                       
                                       σ
                                    
                                 
                                 exp
                                 
                                    
                                       
                                          -
                                          
                                             
                                                
                                                   
                                                      θ
                                                   
                                                   
                                                      h
                                                   
                                                   
                                                      2
                                                   
                                                
                                             
                                             
                                                2
                                                
                                                   
                                                      σ
                                                   
                                                   
                                                      2
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           
                        and
                           
                              (34)
                              
                                 g
                                 (
                                 
                                    
                                       θ
                                    
                                    
                                       i
                                    
                                 
                                 ,
                                 
                                    
                                       θ
                                    
                                    
                                       s
                                    
                                 
                                 ,
                                 
                                    
                                       λ
                                    
                                    
                                       l
                                    
                                 
                                 ,
                                 
                                    
                                       σ
                                    
                                    
                                       h
                                    
                                 
                                 )
                                 =
                                 
                                    
                                       
                                          
                                             2
                                             π
                                             
                                                
                                                   
                                                      
                                                         σ
                                                      
                                                      
                                                         h
                                                      
                                                   
                                                
                                                
                                                   
                                                      
                                                         λ
                                                      
                                                      
                                                         l
                                                      
                                                   
                                                
                                             
                                             (
                                             cos
                                             
                                                
                                                   θ
                                                
                                                
                                                   i
                                                
                                             
                                             +
                                             cos
                                             
                                                
                                                   θ
                                                
                                                
                                                   s
                                                
                                             
                                             )
                                          
                                       
                                    
                                    
                                       2
                                    
                                 
                              
                           
                        
                     

The third term in Eq. (32) corresponds to the wavelength dependent Fresnel term F(·) as described in Eq. (29). Note that, even though there is no Fresnel term in the model as proposed in [2], we have included it without any loss of generality so as to make the specular reflectance component consistent across the models presented in this section. This also reflects the notion that no surface is a perfect reflector and, therefore, the Fresnel term is used to determine the fraction of the incident light reflected from the surface as a function of incident angle and index of refraction.

According to Eq. (32), the specular reflectance R
                        
                           BK
                        (·) at pixel u and wavelength λ
                        
                           l
                         is a product of three terms. The first of these is the magnitude of the specular reflectance P
                        0 which is a function of θ
                        
                           h
                        . This function is nearly zero for all scattering directions except a very narrow range around the halfway vector 
                           
                              
                                 
                                    H
                                 
                                 
                                    →
                                 
                              
                           
                        . In the Beckmann–Kirchhoff model, P
                        0 is expressed as a sinc function. Nonetheless, here, for the sake of computational efficiency, we have followed Nayar et al. [36] and employed a Gaussian function with a very small standard deviation σ. The second term is comprised by the function g(·), which is related to the surface roughness through 
                           
                              
                                 
                                    
                                       
                                          σ
                                       
                                       
                                          h
                                       
                                    
                                 
                                 
                                    
                                       
                                          λ
                                       
                                       
                                          l
                                       
                                    
                                 
                              
                           
                        , the incidence angle θ
                        
                           i
                         and reflected light angle θ
                        
                           s
                        . The three cases g
                        ≪1, g≈1, and g
                        ≫1 correspond to smooth surface, moderately rough and rough surface, respectively.

Note that both, the Torrance–Sparrow and Beckmann–Kirchhoff models incorporate the surface roughness parameter, i.e. σ
                        
                           m
                         in Eq. (26) and σ
                        
                           h
                         in Eq. (32), as a pertinent parameter to influence the reflectance characteristic of the surface. However, these two reflectance models are based on two different surface models. Whereas the Beckmann–Kirchhoff model uses the microfacet height distribution, the Torrance–Sparrow model is based on slope distribution model. Hence, the roughness parameters of these two models are not equivalent. This is important, since our work defines the surface based on slope distribution model and uses a roughness parameter akin to that in the Torrance–Sparrow model. This is not overly restrictive since the surface roughness parameter in the Beckmann–Kirchhoff model can be transformed into that used in our derivation following the approach presented in [36]. We do this making use of the correlation distance T for the height distribution model. We get
                           
                              (35)
                              
                                 
                                    
                                       σ
                                    
                                    
                                       h
                                    
                                 
                                 =
                                 
                                    
                                       T
                                    
                                    
                                       2
                                    
                                 
                                 tan
                                 
                                    
                                       
                                          
                                             
                                                2
                                             
                                          
                                          
                                             
                                                σ
                                             
                                             
                                                m
                                             
                                          
                                       
                                    
                                 
                              
                           
                        where
                           
                              (36)
                              
                                 g
                                 (
                                 
                                    
                                       θ
                                    
                                    
                                       i
                                    
                                 
                                 ,
                                 
                                    
                                       θ
                                    
                                    
                                       s
                                    
                                 
                                 ,
                                 
                                    
                                       λ
                                    
                                    
                                       l
                                    
                                 
                                 ,
                                 
                                    
                                       σ
                                    
                                    
                                       m
                                    
                                 
                                 )
                                 =
                                 
                                    
                                       
                                          
                                             
                                                
                                                   π
                                                   T
                                                
                                                
                                                   
                                                      
                                                         λ
                                                      
                                                      
                                                         l
                                                      
                                                   
                                                
                                             
                                             tan
                                             
                                                
                                                   
                                                      
                                                         
                                                            2
                                                         
                                                      
                                                      
                                                         
                                                            σ
                                                         
                                                         
                                                            m
                                                         
                                                      
                                                   
                                                
                                             
                                             (
                                             cos
                                             
                                                
                                                   θ
                                                
                                                
                                                   i
                                                
                                             
                                             +
                                             cos
                                             
                                                
                                                   θ
                                                
                                                
                                                   s
                                                
                                             
                                             )
                                          
                                       
                                    
                                    
                                       2
                                    
                                 
                              
                           
                        
                     

Finally, we elaborate upon the model proposed by Wolff [56]. This is a diffuse reflection model for smooth dielectric surfaces. When the angle between the illuminant and the viewing direction is large, a significant deviation from Lambert’s law [27] is prevalent for many dielectric objects. The Wolff model explains this deviation from Lambert’s law by considering the refractive attenuation at the surface-air layer. It multiplies Lambert’s cosine law with two Fresnel terms: one for incident light and the other for reflected light. The diffuse reflectance, as defined by the Wolff model is given by:
                           
                              (37)
                              
                                 
                                    
                                       R
                                    
                                    
                                       WF
                                    
                                 
                                 (
                                 u
                                 ,
                                 
                                    
                                       λ
                                    
                                    
                                       l
                                    
                                 
                                 )
                                 =
                                 ρ
                                 (
                                 u
                                 ,
                                 
                                    
                                       λ
                                    
                                    
                                       l
                                    
                                 
                                 )
                                 cos
                                 
                                    
                                       θ
                                    
                                    
                                       i
                                    
                                 
                                 [
                                 1
                                 -
                                 F
                                 (
                                 
                                    
                                       θ
                                    
                                    
                                       i
                                    
                                 
                                 ,
                                 η
                                 (
                                 u
                                 ,
                                 
                                    
                                       λ
                                    
                                    
                                       l
                                    
                                 
                                 )
                                 )
                                 ]
                                 
                                    
                                       
                                          1
                                          -
                                          F
                                          
                                             
                                                
                                                   
                                                      
                                                         θ
                                                      
                                                      
                                                         s
                                                      
                                                      
                                                         ′
                                                      
                                                   
                                                   ,
                                                   
                                                      
                                                         1
                                                      
                                                      
                                                         η
                                                         (
                                                         u
                                                         ,
                                                         
                                                            
                                                               λ
                                                            
                                                            
                                                               l
                                                            
                                                         
                                                         )
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           
                        where, as in previous sections, ρ(u,
                        λ
                        
                           l
                        ) is the diffuse albedo, η(u,
                        λ
                        
                           l
                        ) is the index of refraction of the dielectric medium, θ
                        
                           i
                         is the angle of incidence for the light ray and 
                           
                              
                                 
                                    θ
                                 
                                 
                                    s
                                 
                                 
                                    ′
                                 
                              
                           
                         is the internal angel of incidence that relates the reflected angle θ
                        
                           s
                         with Snell’s law, i.e. 
                           
                              
                                 
                                    θ
                                 
                                 
                                    s
                                 
                                 
                                    ′
                                 
                              
                              =
                              arcsin
                              
                                 
                                    
                                       
                                          
                                             sin
                                             (
                                             
                                                
                                                   θ
                                                
                                                
                                                   s
                                                
                                             
                                             )
                                          
                                          
                                             η
                                             (
                                             u
                                             ,
                                             
                                                
                                                   λ
                                                
                                                
                                                   l
                                                
                                             
                                             )
                                          
                                       
                                    
                                 
                              
                           
                        .

Recall that we have expressed the image reflectance as a linear combination of the specular and diffuse reflection. In our experiments, we use a linear combination of three reflectance models described in the previous section. This is given by
                        
                           (38)
                           
                              R
                              (
                              u
                              ,
                              
                                 
                                    λ
                                 
                                 
                                    l
                                 
                              
                              )
                              =
                              
                                 
                                    W
                                 
                                 
                                    diff
                                 
                              
                              (
                              u
                              )
                              
                                 
                                    R
                                 
                                 
                                    WF
                                 
                              
                              (
                              u
                              ,
                              
                                 
                                    λ
                                 
                                 
                                    l
                                 
                              
                              )
                              +
                              
                                 
                                    W
                                 
                                 
                                    lobe
                                 
                              
                              (
                              u
                              )
                              
                                 
                                    R
                                 
                                 
                                    TS
                                 
                              
                              (
                              u
                              ,
                              
                                 
                                    λ
                                 
                                 
                                    l
                                 
                              
                              )
                              +
                              
                                 
                                    W
                                 
                                 
                                    spike
                                 
                              
                              (
                              u
                              )
                              
                                 
                                    R
                                 
                                 
                                    BK
                                 
                              
                              (
                              u
                              ,
                              
                                 
                                    λ
                                 
                                 
                                    l
                                 
                              
                              )
                           
                        
                     In Eq. (38), each term represents a different reflection component. We have selected the Wolff model [56] to describe the diffuse reflectance. We have further divided the specular term into the spike and lobe, where we use the Torrance–Sparrow model [52] for the specular lobe and the Beckmann–Kirchhoff model [2] to describe the specular spike. These two terms are governed by the weights W
                     
                        lobe
                      and W
                     
                        spike
                     , which control the contribution of the specular lobe and spike to the image radiance.

The parameters for each of these models are summarised in Table 1. The optimisation procedure described in Section 3 can be readily applied to recover all the parameters except the contributions of the lobe and spike as captured by W
                     
                        lobe
                      and W
                     
                        spike
                     . These can be estimated making use of the optimisation given by
                        
                           (39)
                           
                              
                                 
                                    
                                       
                                          
                                             W
                                          
                                          
                                             lobe
                                          
                                          
                                             ∗
                                          
                                       
                                       (
                                       u
                                       )
                                       ,
                                       
                                          
                                             W
                                          
                                          
                                             spike
                                          
                                          
                                             ∗
                                          
                                       
                                       (
                                       u
                                       )
                                    
                                 
                              
                              =
                              
                                 
                                    argmin
                                 
                                 
                                    [
                                    
                                       
                                          W
                                       
                                       
                                          lobe
                                       
                                    
                                    (
                                    u
                                    )
                                    ,
                                    
                                       
                                          W
                                       
                                       
                                          spike
                                       
                                    
                                    (
                                    u
                                    )
                                    ]
                                 
                              
                              
                                 
                                    
                                       ∑
                                    
                                    
                                       l
                                       =
                                       1
                                    
                                    
                                       |
                                       W
                                       |
                                    
                                 
                              
                              
                                 
                                    (
                                    
                                       
                                          R
                                       
                                       
                                          spec
                                       
                                    
                                    (
                                    u
                                    ,
                                    
                                       
                                          λ
                                       
                                       
                                          l
                                       
                                    
                                    )
                                    -
                                    
                                       
                                          W
                                       
                                       
                                          lobe
                                       
                                    
                                    (
                                    u
                                    )
                                    
                                       
                                          R
                                       
                                       
                                          TS
                                       
                                    
                                    (
                                    u
                                    ,
                                    
                                       
                                          λ
                                       
                                       
                                          l
                                       
                                    
                                    )
                                    -
                                    
                                       
                                          W
                                       
                                       
                                          spike
                                       
                                    
                                    (
                                    u
                                    )
                                    
                                       
                                          R
                                       
                                       
                                          BK
                                       
                                    
                                    (
                                    u
                                    ,
                                    
                                       
                                          λ
                                       
                                       
                                          l
                                       
                                    
                                    )
                                    )
                                 
                                 
                                    2
                                 
                              
                           
                        
                     as an alternative to Eq. (18). In the equation above, we have accounted for the relationship between the specular image radiance and reflectance and opted for a notation consistent with Eq. (26) and (32).

As shown in Algorithm 1, our coordinate descent algorithm operates on each coordinate in a cyclic order until convergence. At each cycle, it recovers ρ(u,
                     λ
                     
                        l
                     ), W
                     
                        diff
                     (u), σ
                     
                        m
                     (u), {W
                     
                        lobe
                     (u), W
                     
                        spike
                     (u)}, η(u,
                     λ
                     
                        l
                     ) and {p(u), q(u)} in interleaved separate minimisation steps. Note that the recovery of ρ(u,
                     λ
                     
                        l
                     ), W
                     
                        diff
                     (u) and {W
                     
                        lobe
                     (u), W
                     
                        spike
                     (u)} can be formulated as linear least squares minimisation problems. These are therefore variable-wise convex and have a globally optimal unique solution.

First, we turn our attention to the recovery of diffuse albedo using the following equation, which is in fact, a model specific form of Eq. (13), where we place the Wolff reflectance model to account for the diffuse reflectance.
                        
                           (40)
                           
                              
                                 
                                    ρ
                                 
                                 
                                    ∗
                                 
                              
                              (
                              u
                              ,
                              
                                 
                                    λ
                                 
                                 
                                    l
                                 
                              
                              )
                              =
                              
                                 
                                    argmin
                                 
                                 
                                    ρ
                                    (
                                    u
                                    ,
                                    
                                       
                                          λ
                                       
                                       
                                          l
                                       
                                    
                                    )
                                 
                              
                              
                                 
                                    
                                       ∑
                                    
                                    
                                       v
                                       ∊
                                       
                                          
                                             Ω
                                          
                                          
                                             u
                                          
                                       
                                    
                                 
                              
                              
                                 
                                    [
                                    
                                       
                                          R
                                       
                                       
                                          diff
                                       
                                    
                                    (
                                    v
                                    ,
                                    
                                       
                                          λ
                                       
                                       
                                          l
                                       
                                    
                                    )
                                    -
                                    
                                       
                                          W
                                       
                                       
                                          diff
                                       
                                    
                                    (
                                    v
                                    )
                                    
                                       
                                          R
                                       
                                       
                                          WF
                                       
                                    
                                    (
                                    v
                                    ,
                                    
                                       
                                          λ
                                       
                                       
                                          l
                                       
                                    
                                    )
                                    ]
                                 
                                 
                                    2
                                 
                              
                              .
                           
                        
                     
                  

The second order derivative of Eq. (40) with respect to albedo is 
                        
                           2
                           
                              
                                 ∑
                              
                              
                                 v
                                 ∊
                                 
                                    
                                       Ω
                                    
                                    
                                       u
                                    
                                 
                              
                           
                           C
                           
                              
                                 (
                                 v
                                 ,
                                 
                                    
                                       λ
                                    
                                    
                                       l
                                    
                                 
                                 )
                              
                              
                                 2
                              
                           
                        
                      where, 
                        
                           C
                           (
                           v
                           ,
                           
                              
                                 λ
                              
                              
                                 l
                              
                           
                           )
                           =
                           
                              
                                 W
                              
                              
                                 diff
                              
                           
                           (
                           v
                           )
                           cos
                           
                              
                                 θ
                              
                              
                                 i
                              
                           
                           [
                           1
                           -
                           F
                           (
                           
                              
                                 θ
                              
                              
                                 i
                              
                           
                           ,
                           η
                           (
                           v
                           ,
                           
                              
                                 λ
                              
                              
                                 l
                              
                           
                           )
                           )
                           ]
                           
                              
                                 
                                    1
                                    -
                                    F
                                    
                                       
                                          
                                             
                                                
                                                   θ
                                                
                                                
                                                   s
                                                
                                                
                                                   ′
                                                
                                             
                                             ,
                                             
                                                
                                                   1
                                                
                                                
                                                   η
                                                   (
                                                   v
                                                   ,
                                                   
                                                      
                                                         λ
                                                      
                                                      
                                                         l
                                                      
                                                   
                                                   )
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           
                        
                     . Note that the second order derivative is always positive and, thus, Eq. (40) is convex with respect to the diffuse albedo. Analogously, we can derive the second order derivative of model specific form of Eq. (15) with respect to diffuse weight, which is also always positive, 
                        
                           2
                           
                              
                                 ∑
                              
                              
                                 l
                                 =
                                 1
                              
                              
                                 |
                                 W
                                 |
                              
                           
                           
                              
                                 R
                              
                              
                                 WF
                              
                           
                           
                              
                                 (
                                 u
                                 ,
                                 
                                    
                                       λ
                                    
                                    
                                       l
                                    
                                 
                                 )
                              
                              
                                 2
                              
                           
                        
                      and hence guarantees global minima.

For the two specular weights, W
                     
                        lobe
                     (u) and W
                     
                        spike
                     (u), we use Eq. (39). The determinant of corresponding Hessian matrix is:
                        
                           (41)
                           
                              det
                              (
                              H
                              )
                              =
                              4
                              
                                 
                                    
                                       ∑
                                    
                                    
                                       l
                                       =
                                       1
                                    
                                    
                                       |
                                       W
                                       |
                                    
                                 
                              
                              
                                 
                                    R
                                 
                                 
                                    TS
                                 
                              
                              
                                 
                                    (
                                    u
                                    ,
                                    
                                       
                                          λ
                                       
                                       
                                          l
                                       
                                    
                                    )
                                 
                                 
                                    2
                                 
                              
                              
                                 
                                    
                                       ∑
                                    
                                    
                                       l
                                       =
                                       1
                                    
                                    
                                       |
                                       W
                                       |
                                    
                                 
                              
                              
                                 
                                    R
                                 
                                 
                                    BK
                                 
                              
                              
                                 
                                    (
                                    u
                                    ,
                                    
                                       
                                          λ
                                       
                                       
                                          l
                                       
                                    
                                    )
                                 
                                 
                                    2
                                 
                              
                              -
                              4
                              
                                 
                                    
                                       
                                          
                                             
                                                
                                                   ∑
                                                
                                                
                                                   l
                                                   =
                                                   1
                                                
                                                
                                                   |
                                                   W
                                                   |
                                                
                                             
                                          
                                          
                                             
                                                R
                                             
                                             
                                                TS
                                             
                                          
                                          (
                                          u
                                          ,
                                          
                                             
                                                λ
                                             
                                             
                                                l
                                             
                                          
                                          )
                                          
                                             
                                                R
                                             
                                             
                                                BK
                                             
                                          
                                          (
                                          u
                                          ,
                                          
                                             
                                                λ
                                             
                                             
                                                l
                                             
                                          
                                          )
                                       
                                    
                                 
                                 
                                    2
                                 
                              
                           
                        
                     which is also positive and therefore confirms the unique minima for this function.

The recovery of σ
                     
                        m
                     (u), η(u,
                     λ
                     
                        l
                     ), and {p(u),
                     q(u)} are non-linear least squares problems. Note that, as mentioned earlier, the measure of non-linearity and the ability to chose initial estimates close to the real parameter determines whether our method will converge to a minimum. In all our experiments, the algorithm converges with our provided initial values, as described in Section 3.

By calculating the remaining second order derivatives for the corresponding cost functions, we can further comment on the non-linearity of the estimation task in hand. For example, for the microfacet slope σ
                     
                        m
                     (u), the cost function is “flat” when the angle θ
                     
                        h
                     (u) has large values; i.e. when the halfway vector significantly deviates from the surface normal. According to specular reflectance models [2,52,8], in this case, u is not a specular pixel and therefore the algorithm cannot estimate σ
                     
                        m
                     (u) at pixel u that does not contribute to the specular reflectance. That is why we estimate microfacet slope only at specular pixels.

We have already seen that the cost function for index of refraction has contribution from both specular and diffuse component. If we are to estimate η(u,
                     λ
                     
                        l
                     ), where local neighbourhood of u is a purely diffuse region, just like σ
                     
                        m
                     (u), the specular part of the cost function becomes flat for larger value of θ
                     
                        h
                     . In this case, η(u,
                     λ
                     
                        l
                     ) can still be recovered from the diffuse part. On the other hand, the diffuse part becomes flat for pixels with poor illumination and low image reflectance.

For all our least square optimisation, we have used the Levmar C++ library available for download from FORTH-ICS.
                        2
                        
                           http://www.ics.forth.gr/∼lourakis/levmar.
                     
                     
                        2
                      This library provides a Levenburg-Marquardt method which can employ both, an analytic Jacobian or finite difference approximated Jacobians. For computing the gradients {p(u),
                     q(u)}, we avoid the possibly complex analytical derivation of the Jacobian and use finite difference approximated Jacobians. For all the other parameters, we provide the solver with analytic Jacobians. This has the effect of a reduced computational complexity.

In our experiments, the Levmar solver has been set to terminate when at least one of the following conditions is met: when the gradient of the cost drops bellow a threshold ∊
                     1, when the change in parameter values has fallen to some threshold ∊
                     2, when cost itself has reached some acceptable value ∊
                     3, and when specified number of iterations it
                     
                        max
                      is completed. Therefore, the library requires four user defined threshold values; We provide 10−15 for ∊
                     1 and ∊
                     2, 10−20 for ∊
                     3, and 100 for it
                     
                        max
                     . The library also requires a user input τ to set the initial value for the damping term. According to the damping strategy of the algorithm, τ should be smaller only if we believe that our provided initial value of the unknown parameters are close to optimal value. Therefore, we set τ to 10−6 for {p(u),
                     q(u)} as we get the initial value from image gradients, whereas, we set 10−1 for the rest.

@&#EXPERIMENTS@&#

In this section, we provide example results for our method and compare with alternatives. In all our experiments, we have used the method in [21] to recover the power spectrum of the illuminant and expressed the image reflectance as a linear combination as given in Eq. (38).

In this section, we perform experiments on a number of synthetic imagery so as to verify the accuracy of the recovered photometric parameters and object shape. Our synthetic data comprises of the Stanford Bunny and the Happy Buddha whose mesh files can be downloaded from the Stanford University Computer Graphics Laboratory.
                           3
                           
                              http://graphics.stanford.edu/data/3Dscanrep/.
                        
                        
                           3
                         Making use of these meshes, we have rendered the images using the reflectance model given in Eq. (38), making use of two indexes of refraction, microfacet slope values and diffuse albedos. Note that this results in two images per mesh, which we name Stanford Bunny A, Stanford Bunny B, Happy Buddha A and Happy Buddha B. The parameter values for each of these images is summarised in Table 2
                        .

It is worth noting in passing that, for the two microfacet slope values, we have used a normal distribution, whereas for the ground truth value of albedo, we have used spectra acquired in-house making use of a StellarNet spectrometer for both, a yellow paper and an orange gel box. For the indexes of refraction, we use those corresponding to BK7, i.e. a high quality optical glass, and Silicon (Si). The ground truth value for the indexes of refraction are available at Filmetrics.
                           4
                           
                              http://www.filmetrics.com/refractive-index-database.
                        
                        
                           4
                         All our imagery is comprised of 30 bands in the range of [430–720nm], in 10nm steps.

With these images in hand, we first turn our attention to the capacity of our method to recover the diffuse albedo. To this end, we show, in Fig. 2
                         the diffuse albedo plots for both, the ground truth and that recovered by our method. In the bottom row of the figure we show the plot for the average estimated normalised albedo. In the figures, the error bars denote the standard deviation across the estimates for all pixels. Note that for both, the Stanford Bunny and the Happy Buddha the mean albedos recovered by our method are in close accordance with the ground truth. Moreover, the standard deviation is quite small.

We now provide a qualitative illustration of the capacity of our method to recover the reflection parameters which correspond to the specular and diffuse reflection components in the imagery. To this end, we show, in Figs. 3 and 4
                        
                        , the specular, diffuse and composite reflection for the Happy Buddha A and Happy Buddha B. In the figures, from left-to-right, we show the composite, the specular lobe, the specular spike and the diffuse reflectance for both, the ground truth value and our estimated value. The top row shows images rendered with all ground truth values whereas the bottom row shows images rendered with our estimated parameters. It is worth noting that, in the figures, we show pseudocolour imagery obtained making use of the CIE Colour Matching functions as proposed by Stiles and Burch [49].

Similarly, in Figs. 5 and 6
                        
                        , we show the field of surface normals, i.e. needlemaps, for the Happy Buddha A and the Stanford Bunny A images recovered by our method and two alternatives. These are the method in [57] and that presented in [20]. The first of these is a shape-from-shading one which imposes a hard constraint on the surface normals. Since this method assumes Lambertian reflectance, we have used, as input, the diffuse component delivered by the method in [50]. The method in [20] is an optimisation one which employs Euler–Lagrange equations to recover the shape and index of refraction.

In the figures, our method delivers the surface normal field which better reflects the shape of the object. Indeed, for both images, the needlemap yielded by our method is the one which better captures the details of the object, with less over smoothing and abrupt bogus changes on the direction of the surface normals. This is despite the challenging nature of both object’s shape.

We provide a quantitative analysis on the index of refraction recovered by our method as compared to that delivered by the alternative in [20]. In Table 3
                        , we show the average per-pixel angular error, in degrees, for the index of refraction yielded by our method and the alternative. Note that our method delivers a considerable improvement over the method in [20]. As mentioned earlier, we impose the index of refraction to follow Cauchy’s dispersion equation. This constraint significantly improves our results as it provides a further constraint on the optimisation process. This can be appreciated in the four images, where the index of refraction is quite robust to the shape variations between the two meshes and the combinations of microfacet slope values and diffuse albedos.

Finally, we present the computation time for our algorithm in Table 4
                        . Note that, the computational cost of our method depends on the image size, number of wavelength-indexed bands in the image, neighbourhood size for each pixel and the reflectance models involved. Therefore, as a reference, we provide the per pixel, per band time for the Happy Buddha A image in Fig. 3 for each of the reflectance parameters under consideration. Note that, in our implementation, we discard dark and achromatic pixels as these convey no information about reflectance. We do this based on a threshold value on the image intensity. This yields 72,326 valid pixels for the Happy Buddha A image. Moreover, the specularity removal method in [50] yields 5381 specular pixels. In our experiments, we consider a 3×3 neighbourhood size for each pixel while estimating ρ, η, and p, q. This altogether gives us the total computation time of 19.78min on a workstation with a 2.0GHz Intel Xeon 7500 series processor and 32GB of RAM.

Note that, in our method, the estimation of the index of refraction requires the longest time as compared to other parameters. The reasons for this are twofold. Firstly, the refractive index is estimated per pixel and per band. Secondly, its computation involves both, the diffuse and the specular terms of our cost function.

To reduce the computational complexity, recall that, in Section 3.1.1, we segment the image into {r
                        1,…,
                        r
                        
                           c
                        } regions, where each region r corresponds to a specific material. We can take advantage of this segmentation so as to reduce the computation time for the refractive index. This is as each material has its own unique refractive index defined over the spectral domain. Thus, we can replace the pixel-based computation in Eq. (19) with the following region-based estimation.
                           
                              (42)
                              
                                 
                                    
                                       η
                                    
                                    
                                       ∗
                                    
                                 
                                 (
                                 r
                                 ,
                                 
                                    
                                       λ
                                    
                                    
                                       l
                                    
                                 
                                 )
                                 =
                                 
                                    
                                       argmin
                                    
                                    
                                       η
                                       (
                                       r
                                       ,
                                       
                                          
                                             λ
                                          
                                          
                                             l
                                          
                                       
                                       )
                                    
                                 
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          v
                                          ∈
                                          r
                                       
                                    
                                 
                                 
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         
                                                            R
                                                         
                                                         
                                                            diff
                                                         
                                                      
                                                      (
                                                      v
                                                      ,
                                                      
                                                         
                                                            λ
                                                         
                                                         
                                                            l
                                                         
                                                      
                                                      )
                                                      -
                                                      
                                                         
                                                            
                                                               
                                                                  W
                                                               
                                                               
                                                                  diff
                                                               
                                                            
                                                            (
                                                            v
                                                            )
                                                         
                                                         
                                                            L
                                                            (
                                                            
                                                               
                                                                  λ
                                                               
                                                               
                                                                  l
                                                               
                                                            
                                                            )
                                                         
                                                      
                                                      
                                                         
                                                            f
                                                         
                                                         
                                                            diff
                                                         
                                                      
                                                      (
                                                      L
                                                      (
                                                      
                                                         
                                                            λ
                                                         
                                                         
                                                            l
                                                         
                                                      
                                                      )
                                                      ,
                                                      p
                                                      (
                                                      v
                                                      )
                                                      ,
                                                      q
                                                      (
                                                      v
                                                      )
                                                      ,
                                                      ρ
                                                      (
                                                      v
                                                      ,
                                                      
                                                         
                                                            λ
                                                         
                                                         
                                                            l
                                                         
                                                      
                                                      )
                                                      ,
                                                      η
                                                      (
                                                      v
                                                      ,
                                                      
                                                         
                                                            λ
                                                         
                                                         
                                                            l
                                                         
                                                      
                                                      )
                                                      )
                                                   
                                                
                                             
                                             
                                                2
                                             
                                          
                                          +
                                          
                                             
                                                
                                                   
                                                      
                                                         
                                                            R
                                                         
                                                         
                                                            spec
                                                         
                                                      
                                                      (
                                                      v
                                                      ,
                                                      
                                                         
                                                            λ
                                                         
                                                         
                                                            l
                                                         
                                                      
                                                      )
                                                      -
                                                      
                                                         
                                                            
                                                               
                                                                  W
                                                               
                                                               
                                                                  spec
                                                               
                                                            
                                                            (
                                                            v
                                                            )
                                                         
                                                         
                                                            L
                                                            (
                                                            
                                                               
                                                                  λ
                                                               
                                                               
                                                                  l
                                                               
                                                            
                                                            )
                                                         
                                                      
                                                      
                                                         
                                                            f
                                                         
                                                         
                                                            spec
                                                         
                                                      
                                                      (
                                                      L
                                                      (
                                                      
                                                         
                                                            λ
                                                         
                                                         
                                                            l
                                                         
                                                      
                                                      )
                                                      ,
                                                      p
                                                      (
                                                      v
                                                      )
                                                      ,
                                                      q
                                                      (
                                                      v
                                                      )
                                                      ,
                                                      
                                                         
                                                            σ
                                                         
                                                         
                                                            m
                                                         
                                                      
                                                      (
                                                      v
                                                      )
                                                      ,
                                                      η
                                                      (
                                                      v
                                                      ,
                                                      
                                                         
                                                            λ
                                                         
                                                         
                                                            l
                                                         
                                                      
                                                      )
                                                      )
                                                   
                                                
                                             
                                             
                                                2
                                             
                                          
                                       
                                    
                                 
                              
                           
                        
                     

It is also worth noting that, as explained in Section 2.2, our formulation of the problem allows for the optimisation on the diffuse and specular reflection components to be effected in parallel. Parallel execution of our method can significantly speed up the process.

In this section, we provide results on real world data. Our real world hyperspectral imagery comprises of the database reported in [21], which was acquired using an OKSI Turnkey Hyperspectral Camera System. The images correspond to 51 human subjects, each captured under one of 10 directional light sources with varying directions and spectral power. The light sources are divided into two rows. The first of these is placed above the camera system and the second one at the same height as the camera. The main directions of the lights are adjusted so as to point towards the centre of the scene.

Here, our aim is to employ the reflectance equation in Eq. (38) to model the light reflection from human skin so as to estimate the corresponding reflection parameters, i.e. skin spectral reflectance, index of refraction, skin roughness, and shape, by using our optimisation method. Therefore, we commence with describing our skin model and the efficacy of the dichromatic reflectance model in explaining light reflection from human skin. Later in this section, we present our results for estimated skin parameters and employ our estimated skin reflectance for the purpose of skin recognition.

On the suitability of our approach for purposes of human skin recognition, we would like to note that there is evidence that the Torrance–Sparrow model and the Beckmann micro-facet distribution [2] can be used to model the skin reflectance [55]. The Torrance–Sparrow model [52] has also been used for purposes of rendering human skin [10], whereas the Schlick approximation for the Fresnel term has been employed to model skin reflection [37].

Though our optimisation method employs a more general reflectance model to cover a wide variety of materials rather than opted for human skin, we notice that the reflectance model in Eq. (38) is capable of explaining the different physical phenomena that contribute to light interaction with human skin.

We model human skin as an inhomogeneous dielectric material that comprises of a collection of scatterers contained in a uniform dielectric medium with an index of refraction different from that of air. Fig. 7
                         shows our modelling where light interaction with human skin is approximated as a combination of four phenomena: specular reflection, refractive attenuation at the air-skin interface, subsurface scattering, and refractive attenuation at the skin-air interface. When incident light falls on the air-skin interface, a portion of light reflects as a specular reflection, where the rest penetrates into the skin surface, scatters among subsurface particle inhomogeneities, and is then refracted back out into air. In our model, the specular reflection at the air-skin interface is expressed with a linear combination of Torrance–Sparrow and Beckmann–Kirchhoff model, where specular lobe dominates over specular spike as skin is a rough surface. On the other hand, the Wolff model accounts for the diffusion reflection caused by refraction from air into skin, subsurface scattering, and refraction back from skin to air. The subsurface scattering follows Chandrasekhar’s theory [7], and as already explained in Section 4, the two refractive attenuations are represented by two Fresnel terms. We would like to mention here that, we only consider single scattering from surface and subsurface of skin to avoid additional complexity induced by multiple scattering to our optimisation method. This is also adopted by other existing methods on modelling skin reflectance [9,42].

Next we show our results on the recovered fields of surface normals. In Fig. 8
                        , we show needlemap plots for two sample images in the database. In the figure, we show the fields of surface normals delivered by our method and two other alternatives. These are the method in [57] and that presented in [20]. The first of these is a shape-from-shading one which is based on Lambertian reflectance. Therefore, we provide, as input to this method, the diffuse component delivered by the method in [50]. The method in [20] is an optimisation one which takes a hyperspectral image at input and employs Euler–Lagrange equations to recover the shape. Note that, in the figure, our method delivers the surface normals that better capture the details of the face, with less over smoothing and abrupt bogus changes at specular regions.

Next, we present results on skin recognition. We do this following the notion that an accurate recovery of the reflectance, i.e. diffuse albedo, should yield a high recognition rate. Notice that our diffuse albedo is expected to be invariant to changes in illumination direction and surface geometry. Here, we pose this recognition task as a classification problem where the skin and non-skin reflectance spectra comprise of positive and negative classes, respectively. To obtain a training data set, we select skin and non-skin regions from a single image captured under a light source placed in a high oblique position in front of the subject. On an average, there are 856 skin pixels and 7796 non-skin pixels selected from several regions in each image as training data. Subsequently, the albedo is used as input to a Support Vector Machine (SVM) classifier [47] with a Radial Basis Function (RBF) kernel. We have effected ten trials, where the parameters of the classifier are selected using 5-fold cross validation at training time. For testing, the resulting SVM classifier is then applied to the testing images. Note that the test images are acquired under different illuminant conditions than those corresponding to the training imagery, which further complicates the recognition task.

In Fig. 9
                        , we present sample skin probability maps obtained using different features as input to the classifier. In the figure, the first row shows sample training image. The second row shows the sample testing images. Note that the illuminant directions and power spectra differ between the training and testing imagery. This is evident by the difference in shading and shadows. The four remaining rows show the skin probability maps generated by the SVM classifier trained using different reflectance-based features. The third row shows skin probability maps obtained using the spectral diffuse reflectance recovered by our method whereas the fourth row shows that yielded by the diffuse reflectance estimated by the alternative in [21]. The fifth row shows the maps obtained by using the reflectance computed via the normalisation of the image radiance by the illuminant. The bottom row shows the probability maps for the raw radiance.

From Fig. 9, we note that the skin probability maps in the third and fourth rows depict more visually accurate results. This is due to our method and the alternative in [21] being less prone to error due to changes in illumination direction and power spectra between the training and testing images. Further, nonetheless the probability maps in the third and fourth rows are comparable, our method still provides a margin of improvement over the alternative. This is particularly noticeable on the subjects in the middle columns, where the eyebrows, lips and beard have been better outlined by our method.

As mentioned earlier, for the probability maps on the fifth row, we have use the reflectance computed by normalising the image radiance with respect to the illuminant spectrum. Although being illuminant invariant, this classification feature gives poor results at pixels near the face boundary and the specular regions. This is due to the fact that, normalising the image radiance by the illuminant power spectrum does not achieve surface shading independence. Moreover, it disregards the specular component inherent in the dichromatic reflection model. In contrast, our method estimates the reflectance taking into account the shading and specularities. Therefore, still our method delivers a reflectance feature that allows for classification even at grazing angles and specular spikes and lobes. In the other hand, the raw radiance spectra is not illuminant invariant. Therefore, as expected, this feature generates poor results when the illumination direction and power spectra change between the training and testing images. As a result, the false negative rate is high in skin areas and false positives are high in non-skin regions.

Finally, we provide a quantitative analysis in Table 5
                        . In the table, we compare the performance achieved using the reflectance yielded by our method with that yielded by the alternatives. The table shows the classification rate (CR), correct detection rate (CDR), and false detection rate (FDR). Here, CDR stands for the percentage of skin pixels correctly classified, whereas FDR corresponds to the percentage of non-skin pixels falsely classified as skin. The CR is the total percentage of skin and non-skin pixels classified accurately. For our experiments, we have used the ground truth skin data provided with the dataset. As reported in [21], this has been obtained by manually labelling skin and non-skin pixels for all subjects in the dataset. From the table, we conclude that the reflectance delivered by our method outperforms the alternatives in all the three measures used for analysis, with a better average performance and a lower variance. This is consistent with the qualitative result shown in Fig. 9.

@&#CONCLUSIONS@&#

In this paper, we have presented a method to recover reflection model parameters and object’s shape from a single hyperspectral image. The method is quite general in nature, stemming from the use of a general formulation for the image radiance based upon a linear combination of the diffuse and specular reflection components. This treatment permits, in turn, the use of a coordinate descent least-square optimisation approach to recover the parameters governing the reflection process. Moreover, the formulation provided here allows for the optimisation on the diffuse and specular reflection to be effected in parallel. Unlike other methods, we do not require prior knowledge of the geometry of the scene nor assume a point light source at infinity. Given the illumination direction, this method utilises the information-rich representation of hyperspectral imagery to recover parameters that can be applied for scene analysis, image understanding, and object recognition purposes. We have illustrated how this optimisation process can be used in combination with the Beckmann–Kirchhoff, the Torrance–Sparrow, and the Wolff reflectance model to recover the index of refraction, microfacet slope, diffuse albedo, and surface normal from a single image. We have also shown results on skin recognition and compared with an alternative elsewhere in the literature.

@&#ACKNOWLEDGMENTS@&#

The authors thank Dr. Cong Phuoc Huynh for providing the reflectance computed via illuminant normalisation and the raw radiance used as classification features for the skin recognition results shown in Section 6.2.

@&#REFERENCES@&#

