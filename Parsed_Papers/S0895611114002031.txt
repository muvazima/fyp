@&#MAIN-TITLE@&#Memory based active contour algorithm using pixel-level classified images for colon crypt segmentation

@&#HIGHLIGHTS@&#


               
                  
                  
                     
                        
                           
                           Improve classification accuracy using two-step pixel-level classification.


                        
                        
                           
                           Memory based active contour that is robust to pixel-level classification errors.


                        
                        
                           
                           Test 7180 crypts: 87% and 9% true and false positives, 96% segmentation accuracy.


                        
                        
                           
                           We believe this method is general and can be applied on glandular biopsies.


                        
                     
                  
               
            

@&#KEYPHRASES@&#

Microscopy

Histology

Colon crypts

Segmentation

Active contour

@&#ABSTRACT@&#


               
               
                  In this paper, we introduce a novel method for detection and segmentation of crypts in colon biopsies. Most of the approaches proposed in the literature try to segment the crypts using only the biopsy image without understanding the meaning of each pixel. The proposed method differs in that we segment the crypts using an automatically generated pixel-level classification image of the original biopsy image and handle the artifacts due to the sectioning process and variance in color, shape and size of the crypts. The biopsy image pixels are classified to nuclei, immune system, lumen, cytoplasm, stroma and goblet cells. The crypts are then segmented using a novel active contour approach, where the external force is determined by the semantics of each pixel and the model of the crypt. The active contour is applied for every lumen candidate detected using the pixel-level classification. Finally, a false positive crypt elimination process is performed to remove segmentation errors. This is done by measuring their adherence to the crypt model using the pixel level classification results. The method was tested on 54 biopsy images containing 4944 healthy and 2236 cancerous crypts, resulting in 87% detection of the crypts with 9% of false positive segments (segments that do not represent a crypt). The segmentation accuracy of the true positive segments is 96%.
               
            

@&#INTRODUCTION@&#

Cancer is a leading cause of death worldwide, accounting for 7.6 million deaths (around 13% of all deaths) in 2008. Lung, stomach, liver, colon and breast cancer cause the most cancer deaths each year. Deaths from cancer worldwide are projected to continue rising, with an estimated 13.1 million deaths in 2030 [1].

Early detection of cancer development can lead to a full recovery. Cancer can be detected in a number of ways, including the presence of certain signs and symptoms, screening tests, or medical imaging. Once a possible cancer is detected, it is diagnosed by a biopsy – a tissue that is being removed in a minimal invasive way from the suspected organ. The biopsy is examined by a pathologist via a microscope. Due to the implications that the diagnosis has for the patient, this process is central.

The pathologist needs to be precise and have the ability sift through huge amounts of data to detect small anomalies in the biopsy. The same precision is required under the added pressure of a very heavy caseload. Moreover, it turns out, for example, that approximately 80% of the 1 million prostate biopsies performed in the U.S. every year are benign. This suggests that prostate pathologists and, quite possibly, pathologists in other fields as well, are spending much of their time sieving through benign tissue. There is thus a clear need for an automatic tool to draw the pathologist's attention to biopsies with a suspicious region.

A prerequisite for the diagnosis of disease in biopsy images is often the identification of certain histological structures. The presence, extent, size, shape, and other morphological characteristics of these structures are important indicators for the presence or severity of the disease. Tissue types such as prostate, colon, breast, and thyroid include glandular structures. The first step in quantifying such tissues, and hence in identifying the related diseases, is to segment the glandular structures.

In this study, we work with colon tissue images. The colonic biopsy image is composed of a stromal intermedium containing glands (called crypts) and immune system cells that surround the crypts (see Fig. 1
                     ). The crypts are composed of an inner area (lumen, goblet cells, and cytoplasm) and an outer layer of epithelial cell nuclei (denoted as nuclei). This composition of the crypt is denoted, the crypt model. This model is valid for both healthy and cancerous crypts.

In cancerous colon tissue, the size of the crypts changes, as does the thickness of the nuclei layer, along with other structural and visual properties [2–10]. Examples of cancerous biopsies of colon tissue are shown in Fig. 2
                     .

Considerable progress has been made in the field of histology image analysis and many surveys on gland segmentation have been conducted [11–15]. There are several approaches to this problem. Thresholding based methods [16–20] rely on the assumption that an intensity threshold determines whether a pixel belongs to a nuclear region. These methods are generally easy to implement, but they are quite sensitive to color variations due to staining, fixation, sectioning procedures, or the fading of the dye.

Other studies segment the glands under the assumption of a shape using image filters and morphological operations. In Wu and Gil [21], an image gland segmentation algorithm using biased median filtering was introduced. The algorithm was based on the orientation and location of goblet cells. The algorithm is limited to healthy glands, in which the goblet cells lie side by side and their shape can be approximated by long ellipses, but these properties do not hold in cancerous tissue, in which the crypts might not contain goblet cells. In Smochina et al. [22], a technique based on a closing morphological hierarchy was presented. This closing operator fills gaps in the crypt contour but sometimes eliminates crypt lumina completely.

Several studies focus on the problem of gland segmentation using the fact that glands are characterized by their luminal areas surrounded by epithelial cells. In Gunduz-Demir et al. [23], the tissue was decomposed into a set of primitive objects (nuclei and lumen) and the glands were segmented using the organizational properties of these objects. This approach extracts objects (nucleus cells and lumina) using a circle-fitting algorithm. It is limited because in cancerous cells, the nuclei cells and lumina are not always circular. This is overcome by Rathore et al. [24], which models epithelial cells as ellipses.

A more advanced approach to crypt segmentation is the usage of pixel-level classification (which we will denote PLC). In Nguyen et al. [25,26], each pixel is classified to one of the classes described in Fig. 1. After that, gland boundary extraction is performed by unifying the nuclei pixels with the cytoplasm pixels. Finally, the gland is constructed by expansion of the lumen pixels until reaching the boundary from the previous step. This method is sensitive to PLC errors, and pixel unification will result in inaccurate gland segmentation. Finally, this method cannot segment high-grade carcinoma glands, in which the nuclei layer is broken and the crypt shape is not circular.

In Naik et al. [27,28], a level-set method to segment glands in prostate biopsies is presented. First, a pixel-level classifier is applied to extract the lumina, nuclei, and cytoplasm. Second, the level-set method is applied with an initial contour as the lumen edge, and the attraction force is the nuclei pixels. The intensities of the nuclei likelihood image form the stopping gradient of the level set. Consequently, the gland segments obtained in this approach only include lumen and cytoplasm regions, while we want to capture the entire gland area, which also includes nuclei on the gland boundary. Since there are usually multiple layers of nuclei on the gland boundary and gaps between these layers, it is difficult to force the level-set curve to capture all the nuclei on the gland boundary. Moreover, although relying on PLC in the segmentation process is a good approach, this method is very sensitive to low-level classification errors. In the case of pixel misclassification, the contour might evolve incorrectly. This method also does not have a postprocessing step that eliminates false positive crypts.

The accuracy of segmentation methods that rely on PLC significantly drops when the PLC is not accurate due to classification errors, or when the biopsy contains artifacts that violate the crypt model. In Naik et al. [27,28], the segmentation relies on the PLC accuracy and there is no logic incorporated in to the algorithm to enable accurate segmentation even if the PLC is not perfect. Dealing with such problems is one of the main contributions of this paper. Here, we present a PLC based segmentation similar in spirit to Naik et al. [27,28], show its weaknesses and develop a more robust segmentation algorithm that handles PLC errors.

The PLC information also gives more accurate features in the process of eliminating false-positive segments. In Chomphuwiset et al. [29], bile ducts are segmented and each segment is classified as a bile duct or as a false positive segment using distance histogram of each PLC class.

In this paper, a novel segmentation method is presented. The complex problem of segmenting crypts is broken into three steps. Each step relies on the results of the previous steps but uses a higher level of knowledge to overcome any errors that may have occurred. In the first step, the pixels are classified in a novel two-step method that first classifies the nuclei and immune system cells and after that the lumen, cytoplasm, goblet cells, and stroma. In the second step lumen candidates are selected on the basis of the PLC. For every lumen candidate, an active contour [30] is initialized with its edge. The active contour maintains a variable for each of its contour points, indicating its state with respect to the crypt model. The calculation of the external forces is based on these variables and the PLC image. This new, memory-based active contour method helps overcome misclassifications in the PLC. The final step is verification. Invalid crypts that do not comply with the model are eliminated using the following feature types extracted from the crypt candidates: the shape of the segmented crypt and the distribution of the pixel classes.

The paper is organized as follows. Section 2 presents an overview of our method. In Section 3 we explain the choice of using the Random Forest classifier. Section 4 presents the first step of this method, the PLC of the biopsy image. Section 5 explains how crypts are segmented using an active contour method that relies on the PLC image. Section 6 presents the final step, the elimination of false positive segmented crypts. Section 7 presents the evaluation method and results of each step of the proposed segmentation method on thousands of healthy and cancerous crypts. Finally, Section 8 discusses the limitations of this method and future research directions.

The proposed active contour segmentation approach relies on the characteristics of the crypt structure: a lumen with a layer of nuclei, surrounded by the stroma. The design of this segmentation method is based on two layers of information, where the computation in each layer relies on the layers beneath it, while exploiting higher levels of knowledge. The third step automatically analyzes the results. The segmentation architecture is shown in Fig. 3
                      and consists of the following steps:
                        
                           1.
                           
                              PLC. To find the characteristics of the crypts in the biopsy image, the image pixels need to be classified into the following types: lumen, cytoplasm, goblet cells, nucleus layer, stroma and immune system cells (see Fig. 1). According to the colon biopsy structure, the crypts are surrounded by a layer of nuclei and located in a stromal intermedium with immune system cells. Therefore, the nuclei and immune system cells give a very good indication whether their surrounding tissue is stromal or belongs to the inner layers of the crypt. To use this heuristic, a two step-pixel classification process using a RandomForest [31] is performed to establish the entire PLC image. First, nuclei and immune system cell classification is performed. Then the results are used to classify the lumen, stroma, cytoplasm, and goblet cells. Finally, the results of the two classifiers are merged.


                              Crypt segmentation. Although PLC gives impressive results, two types of classification errors might occur: nuclei might be confused with immune system cells and the stroma might be confused with the inner area of the crypt.

Errors in the PLC can occur for several reasons. First, the stain fades over time: the thickness of a tissue section and the fading of the dye cause variations in the intensity distribution of a tissue image (see the different colors in Fig. 1 and 2). Second, sectioning artifacts are similar in color to the crypt lumina (see Fig. 4a). Third, the color of healthy crypt nuclei differs from that of cancerous crypt nuclei (Fig. 4b). Fourth, the crypt model is not always satisfied; the layer of nuclei can be broken. See for example Fig. 4c.

The crypts are therefore segmented using an active contour that is initialized to the edge of the lumen candidates from the previous step, and the external force on the evolving contour is determined according to the classified pixels from the first step. To overcome the two major classification error types, the segmentation step uses a higher level of information – the crypt model (inner crypt area with nuclei layer surrounding it). The external forces are calculated at each iteration using the state of the contour with respect to this model.


                              False positive crypt elimination. Due to incorrect selection of lumen candidates or incorrect segmentation, false positive crypts are returned by the previous step. Features describing the shape of the crypt and the distribution of the pixel classes within the crypt are extracted from each candidate crypt. A RandomForest classifier trained on these features eliminates the segments that do not satisfy the crypt model (as shown in Fig. 1).

The proposed method uses a very large dataset with multiple classes and numerous features in the classification steps. Thus, the requirements for the classifier are: multi-class classifier, the training step of the classifier should be fast even with a large training-set, and because we want to define as many features as we can without the need to perform feature selection, the classifier should use only the “strongest” features in the training phase and its accuracy should not degrade in the presence of “weak” features.

In Breiman [31] random forests were proposed, which adds an additional layer of randomness to bagging (Bootstrap aggregating [32]) using a decision tree classifier. Decision tree learning is a method commonly used in data mining. The goal is to create a model that predicts the value of a target variable based on several input variables (features). Each interior node corresponds to one of the input variables; there are edges to children for each of the possible values of that input variable. Each leaf represents a value of the target variable (the class) given the values of the input variables represented by the path from the root to the leaf.

In addition to constructing each tree using a different bootstrap sample of the data, random forests change how the classification trees are constructed. In standard trees, each node is split using the best split (condition on one of the features) among all variables. In a random forest, each node is split using the best among a subset of predictors randomly chosen at that node. This somewhat counterintuitive strategy turns out to perform very well compared to many other classifiers.

Unlike single decision trees which are likely to suffer from high variance or high bias, Random Forests use averaging to find a natural balance between the two extremes. Random Forest has many additional advantages that meet our requirements:
                        
                           •
                           Multi-class classifier – The Random Forest classifier uses a decision tree classifier as its main component, which is a multi-class classifier.

Insensitive to “weak features” – Contrary to other classifier models, the Random Forest gives very high accuracy rates even if the training set contains many “weak features”. Hence, Random Forest classifier does not need a preprocessing step of feature selection.

Fast training and classification – As described above, the Random Forest is trained by building many inner decision tree classifiers whose training is linear and fast. The classification of a test sample is to run all the decision trees and the class is according to the majority. This process can be done in parallel, which makes the classification process even faster.

In conclusion, Random Forest classifier is the classifier that has the characteristics that can handle this challenging dataset while giving high classification accuracy.

The pixels are classified in two steps (as described in Fig. 5
                     ). First, a dedicated classifier is created for immune system cells and nuclei, with another class representing the other types. This classifier is based on the image features. Then, another dedicated classifier is created for lumen, stroma, goblet cells and cytoplasm for the pixels from the third class. The classifier uses features from the image to classify and features based on the classified nuclei-immune system cells pixels from the first step. The final PLC image is created by setting these pixels with their classes from the second classifier.

The classifier is trained on 39,000 nucleus samples and 38,000 immune system cell samples, along with 49,000 samples from the third class, which represents the remaining classes that the second classifier will handle. All these samples are taken from 11 different tissue examples. The classifier uses more than 180 features:
                           
                              •
                              The pixel values from the RGB, YcBcr, HSL, Lab and YIQ channels.

On each channel of the RGB, YcBcr, HSL, Lab and YIQ color spaces, the median and the standard deviation are computed on windows of width 3, 5 and 9.

On the normalized RGB, YcBcr, HSL, Lab and YIQ color spaces, the median and the standard deviation are computed on windows of width 3, 5 and 9. (The normalization method is described below.)

To overcome the variations in colors of nucleus and immune system cell pixels, in the same tissue (Fig. 4b) and between different tissues (Figs. 1 and 2), the image is divided into tiles and each tile is normalized according to the minimal and maximal values in the tile. By normalizing in a small region and not over the entire image, artifacts or variations in color are contained within the tile (Fig. 6
                        ).

The features are calculated on small windows (3×3 up to 9×9) because the nuclei and immune system cells are small relative to the size of a crypt (which is about 100×100 pixels), and we do not want to compute the feature on a window that contains structures other than those the pixel belongs to.

The classifier was tested using 5-fold cross-validation and gave 87.62% accuracy. Table 1
                         displays the confusion matrix of the classifier. As demonstrated in Fig. 4, the major classification errors are between the nucleus and the immune system cell pixels. Although the classifier gives quite accurate results, these errors will have to be taken into account in the segmentation stage.

The classifier is trained on 23,500 stroma samples, 31,000 lumen samples, 26,000 cytoplasm samples, 25,000 goblet cells and 22,000 samples of immune system cells and nuclei represented as another class. All these samples are taken from 11 different tissue examples.

The classifier uses more than 70 features:
                           
                              •
                              On the RGB, YcBcr, HSL, Lab and YIQ color spaces, the average, median and smoothing filters are computed on windows of width 3, 5, 7 and 31.

On the normalized RGB, YcBcr, HSL, Lab and YIQ color spaces, the average, median and smoothing filters are computed on windows of width 3, 5, 7 and 31.

The percentage of nucleus pixels and the percentage of immune system cell pixels are computed in windows of width 3, 5 and 15. The presence of immune system cells indicates that the surrounding area is the stroma and the presence of nuclei indicates that the surrounding tissue belongs to the inner layers of the crypt.

Because these tissue components are larger than the nuclei and the immune system cells, we use larger windows for these features. The filter window sizes were selected from a range of window sizes, where a classifier using features from the maximal window size yields better accuracy than a classifier trained using only features of the pixel.

The classifier was tested using 5-fold cross-validation and gave 91.3% accuracy. Table 2
                         displays the confusion matrix of the classifier.

The confusion between lumen, cytoplasm and goblet cells is not problematic because all these classes compose the inner area of the crypt; in the segmentation stage, only this is relevant and not its content. The only problem is the possible confusion between these inner area classes and the stroma, where any misclassification can cause incorrect segmentations or false positive crypts. The classification accuracy is lower when classifying a biopsy image that the classifier was not trained on some of its pixels. We describe an experiment demonstrating this in Section 7.2. Overcoming classification errors of this sort is described in the segmentation step.

Segmentation using active contours has to be initialized with a contour. In our case, the crypt lumen serves this purpose. For each lumen candidate, our memory-based active contour algorithm is run.

At this stage, there is a PLC image in which crypt lumina are found. The active contour will start from the inside of the crypt and evolve towards the nuclei layer. Since not every crypt has a lumen or goblet cells or cytoplasm, the inside of the crypt is represented by connected components built from the union of the lumen, goblet cells, and cytoplasm pixels.

Misclassifying cytoplasm as the stroma creates holes in the connected component (see Fig. 7
                        a), while misclassifying the stroma as cytoplasm can create small, false-positive candidates (see Fig. 7b). To handle the holes in the connected component of the lumen, a morphologic hole-filling operation is performed. In addition, all connected components whose number of pixels is under an empirical threshold (selected to be 50 pixels) are discarded.

In the original active contour segmentation method introduced in Kass et al. [30], the contour deforms to minimize the contour energy, which includes the internal energy from the contour, denoted by E
                        
                           int
                        , and the external energy from the image, denoted by E
                        
                           ext
                        
                        
                           
                              (1)
                              
                                 
                                    E
                                    snake
                                 
                                 =
                                 
                                    ∫
                                    0
                                    1
                                 
                                 
                                    E
                                    int
                                 
                                 (
                                 v
                                 (
                                 s
                                 )
                                 )
                                 +
                                 
                                    E
                                    ext
                                 
                                 (
                                 v
                                 (
                                 s
                                 )
                                 )
                                 
                                 d
                                 s
                                 ,
                              
                           
                        where 
                           v
                           (
                           s
                           )
                         is the parametric representation of the contour:
                           
                              (2)
                              
                                 v
                                 (
                                 s
                                 )
                                 =
                                 (
                                 x
                                 (
                                 s
                                 )
                                 ,
                                 y
                                 (
                                 s
                                 )
                                 )
                                 .
                              
                           
                        
                     

Using a variational method, the internal and external energy are converted to internal and external forces to deform the contour. During the contour deformation process, the curvature-based internal force maintains contour smoothness, while the gradient-based external force attracts the contour to the desired boundaries in the image. The deformation finally stops when the contour reaches an energy minimum (force balance). In every iteration of the active contour, the contour is evolved according to the external forces at the position of each contour point.

Unlike other, low-level segmentation techniques such as thresholding, k-means, or edge detection based, active contour models can achieve subpixel accuracy and always provide closed and smooth contours, thus avoiding postprocessing after edge detection.

In this paper, we suggest a new active contour method. Instead of using a variation of image gradients as the external force, which is not suitable for the complex structure of crypts, we suggest using an external force that is based on the semantics of each pixel and the model of the segmented object. The crypt's inner area is modeled as being composed of goblet cells, a lumen, and cytoplasm, surrounded by a nuclei layer. The crypts lie within a stromal intermedium containing immune system cells.

The external force of a pixel, P, attracts or repels according to the pixel class, P
                        
                           C
                        :
                           
                              (3)
                              
                                 ForceDir
                                 
                                    (
                                    
                                       P
                                       C
                                    
                                    )
                                 
                                 =
                                 
                                    
                                       
                                          
                                             
                                                
                                                   1
                                                
                                                
                                                   
                                                      C
                                                         
                                                      is
                                                         
                                                      nuclei
                                                   
                                                
                                             
                                             
                                                
                                                   −
                                                   1
                                                
                                                
                                                   else
                                                
                                             
                                          
                                       
                                    
                                 
                                 .
                              
                           
                        
                     

Nucleus pixels are assigned an attraction force so the active contour will be attracted to them while the stroma and immune system cells pixels are assigned with repulsion forces so the active contour will stop at the edge of the nucleus layer.

The active contour is initialized at the edge of the crypt's inner area, located in the previous step (see Fig. 8
                        a). To calculate the direction of the external forces, each pixel, P corresponds to the closest active contour point, S(P) which is assigned using distance transformation (see Fig. 8b). These pixels apply forces on their corresponding active contour points. Let
                           
                              (4)
                              
                                 
                                    
                                       V
                                       (
                                       P
                                       )
                                    
                                    →
                                 
                                 =
                                 
                                    
                                       (
                                       
                                          P
                                          →
                                       
                                       −
                                       
                                          
                                             S
                                             (
                                             P
                                             )
                                          
                                          →
                                       
                                       )
                                    
                                    
                                       |
                                       |
                                       (
                                       
                                          P
                                          →
                                       
                                       −
                                       
                                          
                                             S
                                             (
                                             P
                                             )
                                          
                                          →
                                       
                                       )
                                       |
                                       |
                                    
                                 
                                 ,
                              
                           
                        where V(P) is the unit vector in the direction from S(P) to P. When P is the active contour point then V(P) is the normal to the active contour at that point. The external force of a pixel P is:
                           
                              (5)
                              
                                 
                                    
                                       
                                          P
                                          F
                                       
                                    
                                    →
                                 
                                 =
                                 
                                    
                                       V
                                       (
                                       P
                                       )
                                    
                                    →
                                 
                                 ForceDir
                                 
                                    (
                                    
                                       P
                                       C
                                    
                                    )
                                 
                                 .
                              
                           
                        
                     

In active contour segmentation the contour is influenced only by the forces of the pixels that it is on. Therefore the relevant external forces are on the active contour. Due to the definition of 
                           
                              
                                 
                                    P
                                    F
                                 
                              
                              →
                           
                         the external forces are computed before every active contour iteration.


                        Fig. 8c displays the external forces for each pixel according to Eq. (5).

Given a perfect PLC image, assigning force to each pixel as described above will suffice and result in excellent segmentation of the crypts. But as can be seen in Table 2, when pixels representing the inner areas of the crypts (cytoplasm, lumen and goblet cells) are misclassified as stroma pixels (see Fig. 9
                        a), repulsion forces will be applied before the nuclei layer has been reached, thus preventing the active contour from reaching it (see Fig. 9b). This will result in inaccurate segmentation.

In addition, when the nucleus layer is broken (see Fig. 4c) and when nuclei are misclassified as immune system cell pixels (see Table 1), a broken nucleus layer will be seen in the PLC image (see Fig. 10
                        a).

To overcome these misclassifications, a higher level of knowledge is used: the crypt model. Unless the crypt has a broken nucleus layer, the active contour should reach it. But if the nucleus layer is broken, we want to avoid overgrowing the active contour during its search for the crypt's nuclei (see Fig. 10b).

To enable the active contour to reach the nuclei layer, no repulsion forces should exist on an active contour point before it reaches a nucleus. Only then are the repulsion forces enabled. But to prevent associating nuclei pixels of other crypts with the active contour and to prevent overgrowing, the repulsion forces are discarded only if the active contour point has a corresponding nucleus at a distance under an empirically selected threshold MIN
                        _
                        DIST (see Fig. 11
                        ). The value of this threshold is 10 pixels, it was chosen such that it would be large enough so that the nuclei of the segmented crypt would not be discarded, but small enough so that the nuclei of neighboring crypts will not affect the algorithm.

In order to implement this logic, the naï ve active contour is modified to a memory based active contour (as described in Algorithm 1). Each active contour point, S, is assigned a Boolean variable, S
                        
                           m
                        . This memory variable indicates whether S has already reached a nucleus. The S
                        
                           m
                         variables are initialized to false. In each iteration of the active contour algorithm, for each active contour point S for which S
                        
                           m
                         is false and has a corresponding nucleus in close range, all the stroma pixels that belong to it (as described in Fig. 8b) are converted to attraction forces (see Fig. 12
                        a). When the active contour point reaches a nucleus, S
                        
                           m
                         is assigned to true so that in the following iterations the stroma will apply repulsion forces (see Fig. 12b).

Confusing stroma pixels with crypt inner area pixels can cause incorrect active contour initialization. In this case, the active contour might be located outside the nucleus layer, and the assumption that the active contour starts before it will fail. This will result incorrect segmentation (see Fig. 13
                        a). To ensure that the active contour is initialized inside the crypt, erosion operations are performed on the connected component of the crypt's inner area (see Fig. 13b).


                        
                           Algorithm 1
                           Memory based active contour segmentation. 
                                 
                                    
                                       
                                       
                                          
                                             
                                                
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           

The result of the previous step is the crypt segmentation map. Incorrect selection of lumen candidates (see Fig. 14
                     a) and incorrect segmentations (see Fig. 14b) result in false-positive crypt segments that need to be eliminated.

To classify the segmented crypts as false-positive and true-positive crypts, a RandomForest classier was trained. The features of the classifier were defined according to the histological characteristics of the crypts. Two feature types were used in the classification process:
                        
                           •
                           Appearance – Features based on the distribution of the classified pixels of the segmented crypt and the location of each type of pixel.

Shape – Features of the shape of the segmented crypt.

The appearance-based characteristics of a crypt (normal or cancerous) are a nucleus layer, cytoplasm, a lumen and goblet cells. To measure the compliance of the segmented crypt to these characteristics, the following features are calculated:
                        
                           •
                           The percentage of each type of pixel out of the total number of pixels that define the crypt: nuclei, cytoplasm, lumen, goblet cells.

Thickness of the nucleus layer.

The distribution of distances of the nuclei from the edge of the crypt and the distribution of distances of the inside of the crypt (cytoplasm, lumen, goblet cells). A valid crypt is composed of an even nucleus layer. There are more nucleus pixels near the edge of the crypt than at a distance from it (see Fig. 15
                              ).

The shape-based characteristics of a crypt (normal or cancerous) are an edge that changes smoothly and the resemblance to an ellipse (or a circle). To measure the compliance of the segmented crypt to these characteristics, the radius at an edge point is defined as the shortest distance from it to the skeleton of the segment (see Fig. 16
                     ). The following features are calculated based on the radii when they are normalized according to the minimal and maximal radius (denoted as normalized radius):
                        
                           •
                           average radius

median radius

average normalized radius

median normalized radius

std normalized radius

variance normalized radius

The classifier was trained on 6530 false-positive crypts and 5487 true-positive crypts, of which 3980 were healthy crypts and 1507 were cancerous.


                     Fig. 17
                      gives examples of the final result of the entire process on healthy and cancerous sub-images. In the healthy biopsy Fig. 17a all of the crypts were segmented but two of them were incorrectly eliminated during the false-positive elimination process. In the cancerous biopsy Fig. 17b two crypts were segmented correctly but falsely eliminated. In the healthy biopsy Fig. 17c five crypts are not segmented, and five crypts were correctly segmented but eliminated during the false-positive elimination process. Therefore, ten crypts are false-negative. In the cancerous biopsy Fig. 17d about six crypts in the sub-image are false-negative, while only one of them was not segmented.

@&#RESULTS AND DISCUSSION@&#

The proposed method is built from three phases (PLC, crypt segmentation, and elimination of false positive crypts), where each phase relies on the previous phases and the quality of the results of the entire process depends on the quality of the results of each phase.

Since a database with ground truth segmentation of crypts does not yet exist, a database of healthy and cancerous colon biopsies was built. The biopsies for the database were randomly chosen by E. Sabo MD, a pathologist from the Gyneco-oncology Unit at Rambam Hospital. The database was created by scanning the biopsies under a microscope at ×200 magnification. From each scanned biopsy image, sub-images were taken at a ×5 zoom out from the original scanned image (i.e. ×40 zoom). By that we achieve a balance between the need for a good resolution and the computation time. The average size of a sub-image is 800×500 pixels. There were 109 sub-images of healthy colons taken from 33 biopsies and 91 sub-images of cancerous colons taken from 21 biopsies. The segmentation and classification of these sub-images was confirmed by him. From these sub-images, a ground truth database of segmented crypts was created. This database contains 4944 healthy crypts and 2236 cancerous crypts. The dataset, the ground truth, and the results of the algorithm are available in http://mis.haifa.ac.il/˜ishimshoni/SegmentCrypt/.

To build a training set for the pixel level classifier, 11 sub-images were selected and their pixels were classified manually. Two types of tests were performed. First, the classifiers were evaluated using 5-fold cross-validation on the pixels training data. Taking in each fold 80% of the data as the training set and the rest of the data as the test set. The nuclei-immune system cells classifier gave 87.62% accuracy and the lumen, stroma, goblet cells and cytoplasm classifier gave 91.3% accuracy.

In order to show that the two step PLC is better than only one classifier for all the type of classes, a classifier trained with the same features as the Lumen–stroma–goblet-cell–cytoplasm classifier was trained but without the features that use the nuclei–immune system cells classifier result. The classifier was evaluated using 5-fold cross-validation, and gave only 87% accuracy.

To test the classification of pixels of an image without training on any pixels of it, a 11-fold cross-validation was performed, where in each fold the pixels of one of the sub-images were used as the test set and pixels of the other 10 sub-images were used as the training set. The classification accuracy of the PLC image was 80%. This is the classification performance expected in real testing.

The purpose of this phase is to find the candidates for crypts. The method succeeds when it finds a compatible candidate for a crypt.

The evaluation method is as follows: Given an image, we run the segmentation process without false positive crypt elimination (PLC, lumen candidate retrieval, modified active contour). At the end of this process a list of connected components is available. For each crypt in the ground truth image, we find its compatible segmented crypt by finding the segmented crypt that gives the highest F-measure for the ground truth crypt.

The F-measure is the harmonic mean of recall and precision measures:
                              
                                 (6)
                                 
                                    F
                                    -
                                    measure
                                    =
                                    2
                                    ×
                                    
                                       
                                          Recall
                                          ×
                                          Precision
                                       
                                       
                                          Recall
                                          +
                                          Precision
                                       
                                    
                                    ,
                                 
                              
                           where
                              
                                 (7)
                                 
                                    Precision
                                    =
                                    
                                       tp
                                       
                                          tp
                                          +
                                          fp
                                       
                                    
                                    ,
                                 
                              
                           
                           
                              
                                 (8)
                                 
                                    Recall
                                    =
                                    
                                       tp
                                       
                                          tp
                                          +
                                          fn
                                       
                                    
                                    .
                                 
                              
                           
                        

Ground truth crypts that do not have compatible segmented crypts are considered false negatives. This means that the crypt in the image has not been retrieved. Ground truth crypts that have a compatible segmented crypt are considered as true positives. This means that a crypt in the image has been segmented (but the quality of the segmentation and whether it will be eliminated depends on the next phases). Table 3
                            presents the results of lumen candidate retrieval.


                           Table 3 shows that the lumen candidate phase gives high recall (low false negative percentage) but low precision (high false positive percentage). This is preferred because in this case we will segment nearly all the crypts and eliminate the false positives in the FP elimination phase, rather than not retrieving all the crypts.

We evaluate crypt segmentation quality by running the entire process (as described in Section 5) and take statistics on the ground truth crypts that have a compatible segmented crypt. Table 4
                            present the results of segmentation of healthy and cancerous crypts.

To demonstrate that the proposed memory-based active contour method gives more accurate results than the naïve active contour algorithm that relies only on the PLC, the naïve active contour was ran on the same dataset and gave lower segmentation accuracy (see Table 5
                           ). For example, the total F-measure deteriorated from 94.3% to 85.3%. In addition, the naïve active contour is based on a very similar approach as [27,28] – that evolves the contour according to external forces calculated from the PLC. This test shows that an approach that relies on the PLC to be accurate is not enough and using the logic based on the crypt model improves the results in cases of imperfect PLC.

To reduce the percentage of false positive crypts (as described in Table 3), the segmented crypts are classified as valid or invalid. The crypt classification was evaluated using 5-fold cross-validation. Table 6
                         presents the results of segmentation of healthy and cancerous crypts after the removal of the false positives. It can be seen that the segmentation accuracy of the cancerous crypts is high. This is in contrast to other segmentation techniques that are not general enough to segment cancerous crypts.

The segmentation quality (F-measure) of the crypts improved after the removal of false positives. This is because a poorly segmented crypt will not comply with the characteristics of the model and will be eliminated. Although the rate of false negatives (crypts that were segmented but eliminated in the false-positive crypt elimination process) increased for the same reason, the false negative rate is very low and almost 90% of the crypts were retrieved from the biopsy image. This is enough to enable classification of the biopsy. In addition, the false positive crypt rate dropped from more than 60% to 9%. This means that the vast majority of the retrieved crypts are valid.

@&#CONCLUSIONS AND FUTURE WORK@&#

Biopsy segmentation is a fundamental step in cancer diagnosis. In this paper a novel colon crypt segmentation method was introduced. This method segments the crypts in the biopsy image after classifying each pixel. The PLC enables a more robust and accurate segmentation and elimination of false positive segmented crypts.

The main contribution of this work are:
                        
                           •
                           Novel two step pixel-level classification that improves the accuracy of the one classifier approach.

Memory based active contour algorithm that is more robust to PLC errors as opposed to naïve active contour that relies on perfect PLC (such as in Naik et al. [27,28]).

The introduced segmentation method detects 87% of the crypts with 9% of false positive segments (segments that do not represent a crypt). The segmentation accuracy of the true positive segments is 96%. These results are based on 7180 crypts from 54 biopsies. This segmentation method can accurately segment cancerous crypts, whose shape is characteristically more complex than that of healthy crypts. As far as we know, this is the first paper that tests a crypt segmentation method on a very large data set.

The method has two limitations:
                        
                           •
                           The quality of the segmentation relies on the quality of the PLC; thus, when the PLC fails, the segmentation accuracy will deteriorate (see Fig. 18
                              a).

During segmentation the active contour is attracted to nucleus pixels. This logic results in inaccurate segmentation when the segmented crypt is attached to another crypt (see Fig. 18b).

This method is general and can be applied to other types of biopsies with glandular objects. Moreover, this method can be used in any context where each pixel has a meaning. For each such case, the rules that guide the active contour can be modified to fit the characteristics of the segmented object. There are many future directions and applications for this work:
                        
                           •
                           As mentioned above, this segmentation method is based on a general infrastructure of PLC, lumen candidate identification, segmentation, and false positive segment removal. Each step in this method can be improved or modified.

To evaluate this segmentation method, a very large data set was built. It can be used as a benchmark for testing crypt segmentation techniques.

The segmentation of crypts in a biopsy is the first step in the classification of the biopsy as normal or cancerous. The presented method can be used to retrieve the crypts in the biopsy to be classified to normal and cancerous and thus to segment the biopsy to cancerous and healthy regions.

Several types of tissue such as prostate, breast, and thyroid also include glandular structures (see Fig. 19
                              ). We believe this method is general and therefore can be applied on these biopsies.

@&#ACKNOWLEDGMENT@&#

The authors would like to thank Geula Klorin DSc (PhD) for scanning the biopsies.

@&#REFERENCES@&#

