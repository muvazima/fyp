@&#MAIN-TITLE@&#A pre-operative CT and non-contrast-enhanced C-arm CT registration framework for trans-catheter aortic valve implantation

@&#HIGHLIGHTS@&#


               
                  
                  
                     
                        
                           
                           A fully automatic image registration framework for pre-operative CT and non-contrast-enhanced C-arm CT.


                        
                        
                           
                           Increasing the rigid-body registration success rate by introducing a more robust initial point.


                        
                        
                           
                           Increasing the deformable registration accuracy by incorporating anatomical and structural information.


                        
                        
                           
                           Efficient implementation that significantly reduces the processing time.


                        
                        
                           
                           Tested on more than 20 data sets, both simulated and real data, the proposed method is statistically significantly better than the state-of-the-art methods.


                        
                     
                  
               
            

@&#KEYPHRASES@&#

Image registration

Non-contrast-enhanced C-arm CT

Pre-operative CT

TAVI

@&#ABSTRACT@&#


               
               
                  Contrast-enhanced C-arm CT is routinely used for intra-operative guidance during the trans-catheter aortic valve implantation (TAVI); however, the requirement for contrast agent injection is not preferable, especially for patients with renal insufficiencies. To address this problem, we present a novel framework for fully automatic registration of pre-operative CT and non-contrast-enhanced C-arm CT. The proposed framework provides an improved workflow and minimizes the usage of contrast agent in the TAVI procedure. Our framework consists of three steps: coarse rigid-body alignment, anatomical knowledge-based prior deformation field generation, and fine deformable registration. We validated the proposed framework on 20 real patient data sets. Based on the 20 data sets, the mesh-to-mesh errors at the aortic root from different methods are measured. Our proposed method significantly outperforms the other state-of-the-art methods. Specifically, we achieve the registration accuracy at 1.76±0.43mm which is clinically plausible. Quantitative evaluation on real non-contrast enhanced C-arm CT data sets confirms the applicability in the clinical usage. The proposed heart registration method is generic and hence can be easily applied to other cardiac applications.
               
            

@&#INTRODUCTION@&#

Aortic valve disease is the most frequent valvular disease in western countries. According to a population-based study [1], 1.8% of the global population is affected by the disease. Compared to the well established open-chest valve surgery, minimal invasive trans-catheter aortic valve implantation (TAVI) is an emerging technique that is especially suitable for non-operable and high-risk surgical candidates with a severe aortic stenosis. Furthermore, it has the potential to replace the open heart surgery for regular risk patients. To support TAVI procedures, a 3D aortic model can be overlaid onto 2D fluoroscopy to provide anatomical details leading to more optimal valve deployment. Since both C-arm CT volume and fluoroscopy images are captured from the same device, the 3D aortic model obtained from the C-arm CT volume can be straightforwardly overlaid to the 2D fluoroscopy images with high accuracy [2]. Despite the reported success of the current workflow, major limitations still exist. To utilize the intra-operative C-arm CT image, a contrast agent must be used to obtain the 3D aortic model. However, contrast agent injection should be minimized as it is potentially harmful, especially to patients with kidney impairments [3]. Moreover, rapid-pacing is often required for an improved image quality of the aorta and there is concern that this may peel off some cardiac calcification into the blood circulation, therefore increasing the risk of strokes for patients. In addition, there is currently no standard protocol for cardiac C-arm CT acquisition. Highly trained physicians hence are necessary, making the workflow less straightforward.

Pre-operative CT provides detailed anatomical assessment of the aortic root structures, the course of the descending aorta and the iliofemoral access, complementing the information obtained with echocardiography and angiography. Therefore, screening with multi-detector CT becomes an necessity and it is routinely performed in most large-volume centers for TAVI. Furthermore, recent study shows that high-pitch spiral dual source multi-detector CT can be used to assess the entire aorta and iliac arteries in TAVI candidates with a low volume of contrast agent while preserving the diagnostic image quality [4], however, such study has not carried out for C-arm CT images. Compared to using contrast-enhanced C-arm CT, pre-operative CT provides more accurate definition of cardiovascular anatomy, and the risk associated with the additional contrast agent and requirement for highly trained physicians are avoided. However, pre-operative CT is rarely used during the TAVI procedure. This is mainly because multi-detector CT scanner is not integrated into the angiographic C-arm system, so the coordinate system of the CT image is different from the fluoroscopy images. Hence, it is very difficult to utilize the information obtained from CT to perform reliable 2D/3D registration with fluoroscopy images directly.

In this paper, we propose to acquire a native C-arm CT volume around the thorax and then perform 3D/3D image registration between the pre-operative CT and the intra-operative non-contrast-enhanced C-arm CT. Thus the 3D aorta model constructed from the pre-operative CT can be used intra-operatively. Due to the fact that the native C-arm CT is not able to visualize nonradiopaque structures, the structures in the heart are hardly visible. Actually the only visible features in the native C-arm CT images are the heart surface, the epicardium, the spine and the thoracic cavity (see Fig. 1
                     (b)–(d)). The poor quality of the native C-arm CT image further increases the registration difficulty. In contrast, there are clear cardiac structures in the CT volume (Fig. 1(a)). As the result of large mismatched areas between the C-arm CT and CT, conventional intensity-based deformable image registration techniques lead to significant errors in the area where the structures appear only in CT images but not in the native C-arm CT images. Pre-operative CT images had been deployed in the cardiac catheterization laboratory as reported in [5]. This study confirms the importance of the fusion of pre-operative CT and non-contrast-enhanced C-arm CT images. However, only rigid registration was performed and human intervention was required. Grbić et al. proposed to fuse the aortic root in pre-operative CT and contrast-enhanced C-arm CT volumes using a model-based method [6]. In fact, minimizing the usage of contrast agent is crucial for TAVI patients, and clinically it is not practical to have a contrast-enhanced C-arm CT image for the sole purpose of segmentation/registration, as proposed in [2,6]. Our prior work incorporates the motion correlation with the spine and structural encoded mutual information into the registration framework [7]. But the deformation field inferred from the spine is rigid and not capable of modeling the heart motion. Therefore, the deformation field prior in [7] becomes less effective at locations further away from the spine area, resulting in inaccuracies when the aorta is distant from the spine. To the best of our knowledge, our prior work is the first literature reporting on automatic image registration of CT and non-contrast-enhanced C-arm CT for TAVI.

Nevertheless, similar multi-modality image registration problems occur in other applications, e.g., the structural appearance in wash in/out phases is largely different in the cardiac perfusion sequences; mismatching structures occur in the pre- and post-tumor resection images. To address this image registration problem, task-specific constraints are usually required. There are mainly three categories to incorporate the task-specific constraints into the registration framework. Firstly, landmark constraints are used to increase the registration accuracy and robustness [8–10]. These methods add a penalty term to constrain the corresponding pairs from moving too far apart, therefore, the accuracy of the correspondence matching is very crucial. The energy function is optimized using the thin-plate splines (TPS) and B-spline models. TPS are based on the bending energy of a thin plate, thus it only represents a relatively coarse deformation. B-spline models usually require numerical solutions at each iteration during the optimization process, which is computationally expensive and therefore may not be applicable intra-operatively. Secondly, biomechanical knowledge can be embedded into the registration framework to better regularize the registration process. In particular, Kyriacou et al. [11] used biomechanical properties to model the brain and tumor while applying deformable image registration to the anatomical atlas. Stefanescu et al. [12] filtered the deformation field using a Gaussian filter with varying standard deviations on different tissue types. Thirdly, incorporating the knowledge of statistical analysis on shape and displacement field variability is another popular approach. Wang and Staib [13] combined a statistical shape model and a physics-based regularization term to solve the atlas-based registration problem. Rueckert et al. [14] and Glocker et al. [15] performed statistical analysis on the displacements of the free form deformation grid. Xue et al. [16] tackled the problem of high dimensional statistical deformation models (SDMs) using wavelet based decompositions. Despite the promising results, training the SDMs suffers from the curse of dimensionality, and how to select the training data to represent the population remains unclear. Our method belongs to the first category, however, the target application is more challenging than the above mentioned ones with a larger area of missing/mismatched structures and poorer image quality. There is also a larger extent of deformation due to the breathing and cardiac motion. Furthermore, the volumes for our target application have very different field of views (FOVs), which may lead to significant errors in the rigid registration process.

In this paper, we provide a framework that non-linearly aligns pre-operative CT and intra-operative non-contrast-enhanced C-arm CT data. Our contribution is threefold. First, robust heart center detection in both image modalities using recursive searching rays and template matching is employed to boost the robustness of the rigid-body registration process. Second, based on the point sets obtained from spine, heart and lung surfaces, we applied the thin-plate splines parametric model to generate a prior deformation field, incorporating anatomical knowledge to facilitate the deformable registration. Third, structural encoded mutual information (SMI) incorporates the lung segmentation information into the calculation of mutual information. SMI utilizes the common anatomical structures, e.g., lung, heart surface, and epicardium, that exist in both modalities of images to make the registration context-aware. The combination of both high-level (anatomical correlation-regularized deformation field) and low-level (SMI) constraints increases the deformable registration accuracy. Our deformable registration adopts the variational formulations [17], and the gradient for the proposed similarity measure is further derived to efficiently optimize the energy functional.

The remaining of the paper is organized as follows. Section 2 describes our proposed registration framework. Section 3 provides the results of experiments and comparisons with other methods. Section 4 further expands the discussions and addresses the limitation of the current framework. Finally, Section 5 gives a short conclusion.

@&#METHOD@&#

The proposed registration framework consists of three major steps: first, rigid-body registration with increased robustness by automatically detecting and aligning the heart centers of the CT and C-arm CT volumes; second, generation of an anatomical knowledge-based prior deformation field based on a TPS model; and third, deformable registration combining SMI and the prior deformation field.

Rigid registration should be applied prior to the deformable registration process. It helps to bring the pre-operative CT to the same coordinate system as the C-arm CT. Moreover, rigid-body registration helps to correct global patient motion. A good rigid registration result will help to reduce the error in computing the deformable deformation field subsequently. For rigid-body registration, a good initialization is important for our problem due to the drastically different FOVs and the poor image quality (Fig. 2
                        ). Poor initialization (Fig. 2(a)) often causes the energy optimization to converge to a wrong optimum. On the other hand, if the initialization is close to the optimum alignment (e.g., Fig. 2(c)), correct registration can be more easily achieved by optimizing the relevant similarity measure. To ensure a more robust and reliable rigid-body registration, we firstly detect the heart center of the CT volume, considering its relatively high image quality, compared to the native C-arm CT volume. Secondly, the heart center of the C-arm CT volume is found by using template matching (Fig. 3
                        ). Lastly, rigid-body registration is applied.

To detect the heart center, we use the fact that the heart is surrounded by the two lungs. So we first segment the lung by applying [18]. A convex hull which encloses the lung area is defined to reduce the searching space of the heart center. We applied recursive casting of search rays [19] within the convex hull to detect the heart center in the CT volume. Following the property that the Hounsfield Unit (HU) value for the lung section is less than −500 and the mean value of the transverse cardiac diameter is greater than 12cm for adults [20]. Therefore, we consider the tissue sections that are bounded by −500HU with a minimum length of 60mm (half of the mean transverse cardiac diameter) as heart center candidates. To find the heart center, firstly, the search rays are cast in the left-right direction. Centers of the rays which fulfil the requirement are considered as the candidates for the heart center. Secondly, search rays are cast in the anterior–posterior direction from the candidates; if the search ray finds the required tissue section, the candidate remains in the list. Thirdly, search rays are cast in the head–foot direction as in the previous step, and thus the heart center candidates are further reduced. Lastly, from the remaining candidates, the one with the largest distance to the lung area is considered as the detected heart center. The heart center detection has been successfully performed for all the 20 pre-operative CT data sets.

A bounding box centered at the detected heart center and contained the whole heart is extracted from the CT volume. Then, using the region within the extracted bounding box as the template, an exhaustive search in translation is performed to match the template in the C-arm CT using normalized cross correlation. Here we only use translation for template matching, because it is reasonable to assume that the patient is in the lying position while scanning for CT and C-arm CT images, thus a translation model is sufficient for matching the template with high efficiency. The location with the largest response is identified as the heart center in the C-arm CT. Note that the sequential detection scheme nicely takes advantage of the fact that the image quality of the CT data is significantly better than that of the C-arm CT volume. Therefore, detection of the heart center on the CT data is reliable, while the performance of heart center detection on the low quality C-arm CT volume is boosted by using the intra-subject template obtained from the CT image. Thus, the proposed heart center detection method is capable of excluding any inter-subject variations compared to general learning-based detection methods. The process for heart center detection and template matching costs less than 30s to complete. We do not need very accurate heart center detection for the C-arm CT image, since rigid-body registration will be performed subsequently.

The rigid transformation matrix can be written as:
                              
                                 (1)
                                 
                                    
                                       T
                                       rigid
                                    
                                    =
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         
                                                            R
                                                         
                                                      
                                                   
                                                   
                                                      
                                                         
                                                            t
                                                         
                                                      
                                                   
                                                
                                                
                                                   
                                                      
                                                         
                                                            
                                                               0
                                                            
                                                         
                                                         T
                                                      
                                                   
                                                   
                                                      1
                                                   
                                                
                                             
                                          
                                       
                                    
                                    ,
                                 
                              
                           where R is the rotation matrix and t is the translation vector. To find the optimal transformation parameters, we first align the two detected heart centers. And then the rigid transformation parameters are obtained by optimizing
                              
                                 (2)
                                 
                                    
                                       
                                          
                                             T
                                             ˆ
                                          
                                       
                                       rigid
                                    
                                    =
                                    arg
                                    
                                       max
                                       
                                          
                                             T
                                             rigid
                                          
                                       
                                    
                                    MI
                                    (
                                    
                                       I
                                       1
                                    
                                    ,
                                    
                                       I
                                       2
                                    
                                    (
                                    
                                       T
                                       rigid
                                    
                                    )
                                    )
                                    ,
                                 
                              
                           where mutual information (MI) is the similarity measure and I
                           1 and I
                           2 represent the C-arm CT and CT images, respectively. A multi-resolution hill climbing optimization method [21] is implemented to iteratively optimize the similarity measure. The rigid-body registration process takes less than 1min to complete.

Deformable registration is a seriously under-determined problem for the heart area in the non-contrast-enhanced C-arm CT, because the heart anatomical structures are hardly distinguishable (Fig. 1). In other words, there is no unique solution to this problem if we only rely on the intensity information, and consequently anatomically implausible deformation may occur. Hence, to avoid implausible deformation field, integrating anatomical information into the registration process is highly desirable. Our registration framework is designed such that the deformation prior is integrated into the image registration process so that the deformation field is well constrained. Based on the anatomical knowledge, the movement of the spine should be approximately rigid, because the patients lie still on the scanners’ tables during image acquisition. We further observe that from the aortic arch, the aorta runs along with the spine all the way down to the descending aorta, thus the spatial correlation exists between the spine and the surrounding structures such as the descending aorta and the trachea. Furthermore, it is reasonable to assume that heart motion can be extracted by tracking the motion of the heart surfaces, and this motion can be modeled by thin-plate spline parametric model [22]. Based on the above prior knowledge, we model the spine and heart motion using the TPS model and integrate the knowledge into the registration framework using the following steps:
                           
                              1.
                              Align the spine of the rigidly registered CT and the reference C-arm CT volumes. A rough spine segmentation is obtained automatically from CT volumes for the registration purpose using the method in [23]. Here we do not need an accurate spine segmentation result. Instead, by simply making use of the high opacity of the spine, and the generated coarse volume of interest (VOI) which contains the spine is sufficient for the registration purpose. Based on the VOI, we perform a rigid registration using MI with the C-arm CT volume. After the rigid spine registration, we obtain the corresponding spine VOI in the C-arm CT.

To estimate the heart motion, we make use of the points from both heart and lungs surfaces. A rough heart surface point set is obtained by applying recursive searching rays. Points that are in transition with the heart and the lungs are considered as the heart surface (see Fig. 3(c)). Lung segmentation [18] is applied to both CT and C-arm CT images for obtaining the lung surfaces. Points on the lung surfaces that are within the bounding box as described in Section 2.1.2 are considered and used to generate the deformation field prior later. By including the points from both heart and lungs surfaces, we can then use point sets registration technique to generate a high-level deformation field prior for estimating the heart and lung movement (more details in the following sections). Therefore, the resulting deformation field prior well represents the heart motion.

Points from the spines and heart/lung surfaces are sampled at equal space from Steps 1 and 2. Using these point sets, we apply point set registration using mixture of Gaussians [24] based on a TPS model to generate an anatomically meaningful deformation prior 
                                    bm
                                    v
                                 . We should take note that using TPS to register the point sets only provides a coarse deformation field prior. The deformation prior is not made to be very accurate, rather it constrains the deformation field such that implausible deformation field would not occur in the registration process. Therefore, we do not require very accurate heart surface extraction to produce the coarse deformation field prior.

The similarity measure contributed from the prior term is defined as:
                                    
                                       (3)
                                       
                                          
                                             E
                                             prior
                                          
                                          (
                                          
                                             
                                                u
                                             
                                          
                                          )
                                          =
                                          −
                                          
                                             ∫
                                             Ω
                                          
                                          w
                                          (
                                          
                                             
                                                x
                                             
                                          
                                          )
                                          |
                                          |
                                          
                                             
                                                u
                                             
                                          
                                          (
                                          
                                             
                                                x
                                             
                                          
                                          )
                                          −
                                          
                                             
                                                v
                                             
                                          
                                          (
                                          
                                             
                                                x
                                             
                                          
                                          )
                                          |
                                          
                                             |
                                             2
                                          
                                          d
                                          
                                             
                                                x
                                             
                                          
                                          ,
                                       
                                    
                                 
                                 
                                    
                                       (4)
                                       
                                          w
                                          (
                                          
                                             
                                                x
                                             
                                          
                                          )
                                          =
                                          exp
                                          
                                             
                                                
                                                   −
                                                   
                                                      
                                                         
                                                            
                                                               
                                                                  
                                                                     d
                                                                     spine
                                                                  
                                                                  (
                                                                  
                                                                     
                                                                        x
                                                                     
                                                                  
                                                                  )
                                                               
                                                               W
                                                            
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                          +
                                          
                                             
                                                
                                                   1
                                                   −
                                                   exp
                                                   
                                                      
                                                         
                                                            −
                                                            
                                                               
                                                                  
                                                                     
                                                                        
                                                                           
                                                                              d
                                                                              lung
                                                                           
                                                                           (
                                                                           
                                                                              
                                                                                 x
                                                                              
                                                                           
                                                                           )
                                                                        
                                                                        W
                                                                     
                                                                  
                                                               
                                                            
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                          ,
                                       
                                    
                                 where 
                                    u
                                  is the deformation field, 
                                    
                                       v
                                    
                                  is the deformation prior which will be explained in more details, 
                                    x
                                  is the location, Ω is the image domain, d
                                 spine(
                                    x
                                 ) and d
                                 lung(
                                    x
                                 ) are the distance functions to the spine and lung borders, respectively. 
                                    w
                                    (
                                    
                                       
                                          x
                                       
                                    
                                    )
                                  is the influence factor introduced by the anatomical correlations, namely, the spine and heart movements, such that the closer a voxel is to the spine or further from the heart surface, the higher its value. The physical explanation of 
                                    w
                                    (
                                    
                                       
                                          x
                                       
                                    
                                    )
                                  is that, since we can generate an anatomically meaningful deformation prior at the spine and heart area to avoid anatomically implausible deformation during the registration process, we rely more on the generated prior deformation field at these areas. In the regions where intensity information is more reliable, it relies more on the intensity information during the registration process, thus smaller 
                                    w
                                    (
                                    
                                       
                                          x
                                       
                                    
                                    )
                                 . Empirically, W is set to 2.25cm, because at the spine area, the movements of the surrounding structures and the spine are highly correlated within this range. At the heart area that is W away from the lung border, we should rely more on the prior deformation field because there exists little or no structure information due to the low image contrast. E
                                 prior(
                                    u
                                 ) hence enforces the voxels near the spine to move along with the spine, without having much influence on the voxels far away from the spine. Similarly, voxels in the heart region rely more on the generated prior deformation field during the registration process. Note that an advantage of our deformation field prior generation scheme is that the prior is generated without the need of any pre-registered training data. More technical detail about the prior deformation field generation is given in the following section.

A TPS can be used to represent an image deformation field [25,26]. It maps a point 
                              x
                            from floating image I
                           2 to the corresponding point 
                              
                                 
                                    v
                                 
                              
                              (
                              
                                 
                                    x
                                 
                              
                              )
                            in the reference image I
                           1. Given a set of control points 
                              c
                           
                           
                              k
                           
                           ∈
                           R
                           3 and the associated coefficients a
                           
                              ij
                           , 
                              
                                 w
                                 ki
                              
                              ∈
                              R
                            with i
                           =1, 2, 3, j
                           =1, 2, 3, 4, and k
                           =1, 2, …, K, the TPS transformation 
                              
                                 v
                              
                            can be written as:
                              
                                 (5)
                                 
                                    
                                       
                                          
                                             v
                                          
                                       
                                       i
                                    
                                    (
                                    
                                       
                                          x
                                       
                                    
                                    )
                                    =
                                    
                                       a
                                       
                                          i
                                          1
                                       
                                    
                                    
                                       x
                                       1
                                    
                                    +
                                    
                                       a
                                       
                                          i
                                          2
                                       
                                    
                                    
                                       x
                                       2
                                    
                                    +
                                    
                                       a
                                       
                                          i
                                          3
                                       
                                    
                                    
                                       x
                                       3
                                    
                                    +
                                    
                                       a
                                       
                                          i
                                          4
                                       
                                    
                                    +
                                    
                                       ∑
                                       
                                          k
                                          =
                                          1
                                       
                                       K
                                    
                                    
                                       w
                                       ki
                                    
                                    ϕ
                                    (
                                    ∥
                                    
                                       
                                          x
                                       
                                    
                                    −
                                    
                                       
                                          
                                             c
                                          
                                       
                                       k
                                    
                                    ∥
                                    )
                                    ,
                                 
                              
                           with the condition
                              
                                 (6)
                                 
                                    
                                       ∑
                                       
                                          k
                                          =
                                          1
                                       
                                       K
                                    
                                    
                                       w
                                       ki
                                    
                                    =
                                    0
                                    ,
                                    
                                    and
                                    
                                    
                                       ∑
                                       
                                          k
                                          =
                                          1
                                       
                                       K
                                    
                                    
                                       
                                          
                                             c
                                          
                                       
                                       ku
                                    
                                    
                                       w
                                       ki
                                    
                                    =
                                    0
                                    ,
                                    
                                    i
                                    ,
                                    u
                                    =
                                    1
                                    ,
                                    2
                                    ,
                                    3
                                    ,
                                 
                              
                           where ϕ is a radial-basis function which is defined as
                              
                                 (7)
                                 
                                    ϕ
                                    (
                                    r
                                    )
                                    =
                                    
                                       r
                                       2
                                    
                                    log
                                    (
                                    
                                       r
                                       2
                                    
                                    )
                                    .
                                 
                              
                           
                        

Note that parameters include 12 global affine parameters a
                           
                              ij
                            and 3K local coefficients 
                              
                                 w
                                 ki
                              
                            for the control points. In our paper, the two additional constraints in (6) ensure that the plate would not move or rotate under the imposition of the loads and remain stationary [27]. The control points are placed in a uniform grid to capture the deformations.

Landmark-based methods are commonly used for non-rigid medical image registration [8–10,28]. However, in our application, it is very difficult to find exact/accurate landmark correspondences from the images due to the poor image quality and the featureless heart surface. Thus in our paper, we use mixture of Gaussians to represent the point sets obtained from the spine and the heart surface regions. Then we efficiently and robustly register the point sets using Jian and Vemuri's method [24]. It has been shown by Richa et al. [22,29] that heart motion can be modeled by TPS using heart surface points. Therefore we generate an anatomical knowledge-based deformation field prior using TPS model by optimizing the following cost function:
                              
                                 (8)
                                 
                                    
                                       E
                                       TPS
                                    
                                    (
                                    
                                       
                                          v
                                       
                                    
                                    )
                                    =
                                    ∫
                                    
                                       
                                          (
                                          
                                             f
                                             
                                                
                                                   
                                                      v
                                                   
                                                
                                             
                                          
                                          −
                                          g
                                          )
                                       
                                       2
                                    
                                    d
                                    
                                       
                                          x
                                       
                                    
                                    +
                                    λ
                                    
                                       E
                                       bending
                                    
                                    (
                                    
                                       
                                          v
                                       
                                    
                                    )
                                    ,
                                 
                              
                           where 
                              
                                 f
                                 
                                    
                                       
                                          v
                                       
                                    
                                 
                              
                            is the distribution representing the transformed point set warped by 
                              
                                 v
                              
                           , g is the distribution of the reference point set, and 
                              x
                            is the location. A small λ ensures that the TPS approximates local deformations well [30]. In our work, we experimentally set λ to 0.001. E
                           bending is the bending energy of the TPS, which can be written as:
                              
                                 (9)
                                 
                                    
                                       E
                                       bending
                                    
                                    (
                                    
                                       
                                          v
                                       
                                    
                                    )
                                    =
                                    ∫
                                    ∫
                                    ∫
                                    L
                                    (
                                    
                                       
                                          
                                             v
                                          
                                       
                                       x
                                    
                                    )
                                    +
                                    L
                                    (
                                    
                                       
                                          
                                             v
                                          
                                       
                                       y
                                    
                                    )
                                    +
                                    L
                                    (
                                    
                                       
                                          
                                             v
                                          
                                       
                                       z
                                    
                                    )
                                    dxdydz
                                    ,
                                 
                              
                           
                           
                              
                                 (10)
                                 
                                    L
                                    (
                                    ·
                                    )
                                    =
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         ∂
                                                         2
                                                      
                                                   
                                                   
                                                      ∂
                                                      
                                                         x
                                                         2
                                                      
                                                   
                                                
                                             
                                          
                                       
                                       2
                                    
                                    +
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         ∂
                                                         2
                                                      
                                                   
                                                   
                                                      ∂
                                                      
                                                         y
                                                         2
                                                      
                                                   
                                                
                                             
                                          
                                       
                                       2
                                    
                                    +
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         ∂
                                                         2
                                                      
                                                   
                                                   
                                                      ∂
                                                      
                                                         z
                                                         2
                                                      
                                                   
                                                
                                             
                                          
                                       
                                       2
                                    
                                    +
                                    2
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      ∂
                                                      2
                                                   
                                                
                                                
                                                   ∂
                                                   x
                                                   ∂
                                                   y
                                                
                                             
                                          
                                       
                                    
                                    +
                                    2
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      ∂
                                                      2
                                                   
                                                
                                                
                                                   ∂
                                                   x
                                                   ∂
                                                   z
                                                
                                             
                                          
                                       
                                    
                                    +
                                    2
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      ∂
                                                      2
                                                   
                                                
                                                
                                                   ∂
                                                   y
                                                   ∂
                                                   z
                                                
                                             
                                          
                                       
                                    
                                    ,
                                 
                              
                           where 
                              
                                 
                                    
                                       v
                                    
                                 
                                 x
                              
                           , 
                              
                                 
                                    
                                       v
                                    
                                 
                                 y
                              
                            and 
                              
                                 
                                    
                                       v
                                    
                                 
                                 z
                              
                            are components for 
                              
                                 v
                              
                            at different directions, respectively.

TPS is chosen to represent the underlying transformation model due to its nice properties, including its smoothness, no free parameters to tune manually, closed-form solutions for both warping and parameter estimation, and physical explanation for its energy function [10,29]. Compared to other transformation models that have been successfully applied in the course of heart surface registration, for instance, B-spline models [31], TPS is more suited to our application mainly in two aspects: (1) the deformation is more global: the generated deformation prior is sufficient to provide a high-level knowledge of the plausible deformation field to guide the deformable registration process; (2) the computational complexity is much lower than other transformation models where the iterative calculation in the optimization process causes long running time. In addition, the distribution of the point sets are modeled as mixture of Gaussians for the purpose of efficient and robust registration [24]. It was demonstrated in [24] that even with outliers and missing parts in the point sets, the algorithm is still able to register the point sets robustly and correctly. Registration using mixtures of Gaussians may not be highly accurate at the edges, compared to other computationally expensive landmark-based registration methods that focus on point-to-point matching. However, the deformation prior generated from the point sets registration results is sufficient to provide high-level knowledge of the plausible deformation field. Note that, unlike many other spline-based optimization schemes where iterative volume intensity interpolation is required, we only use TPS to generate a deformation prior based on the location distributions of the point sets, which leads to a much higher computational efficiency.

To further refine the registration results, deformable registration is performed after rigid-body registration. MI [32] is widely used in the field of multi-modal image registration. Despite the reported success in applying MI to various applications, MI completely decouples the intensity values from the location/structural information. To introduce the spatial information into the MI formulation, Zhuang et al. introduced the spatial encoded mutual information [33] which incorporates the spatial information by partitioning the reference images, and the energy function is optimized using the free form deformation model. Gan et al. proposed the maximum distance gradient [34] which considers the vector from every voxel to the salient points. Due to the large amount of missing structures in C-arm CT, directly using MI or the variants like [33,34] as the similarity measure for the deformable registration in our application leads to significant errors. To address the above mentioned problems, we define our deformable registration framework as the minimization of the following energy functional:
                           
                              (11)
                              
                                 E
                                 (
                                 
                                    
                                       u
                                    
                                 
                                 )
                                 =
                                 
                                    E
                                    SMI
                                 
                                 (
                                 
                                    
                                       u
                                    
                                 
                                 )
                                 +
                                 α
                                 
                                    E
                                    prior
                                 
                                 (
                                 
                                    
                                       u
                                    
                                 
                                 )
                                 ,
                              
                           
                        where 
                           u
                         is the deformation field, E
                        SMI denotes the structure-encoded mutual information of the observed and reference data, and E
                        prior denotes the similarity measure of the current deformation field 
                           u
                         and the prior deformation field 
                           
                              v
                           
                         which is generated by optimizing (3). A deformation field that maximizes the SMI is influenced by the prior deformation field to achieve a more clinically meaningful alignment. The factor α controls the amount of guidance by the prior deformation field. We set α to 0.1 in our experiments. It can be seen that our similarity measure considers both the low-level information from the image content and the high-level prior on the deformation field. The combination of the two soft constraints integrates the anatomical information which largely helps the registration process. Compared to other registration methods that use some image salient features or boundary features as additional constraints, our proposed method does not require numerical solutions to optimize the energy function. We provide the analytical solution for the optimization process, thus the computational time is largely reduced which is very important for clinical usage. The details of structural encoded mutual information and regularization are given in the following sections.

Encoding location/structural information into the MI similarity measure is investigated by Suh et al. [35] where they only consider the statistics in the region of interest. Different from [35], we emphasize the structure information contained in each voxel. In particular, the statistics collected from the heart surface, the thoracic cavity and the spine are more reliable than the statistics from the structure-less homogeneous area in the C-arm CT image. Therefore, we propose to weigh the intensity statistics adaptively according to the location of the voxels, and give higher weights to those voxels near the heart surface or thoracic cavity while calculating the joint histogram. Specifically, to compute the joint density P(
                              i
                           , 
                              u
                           ), we introduce a weight term D(
                              x
                           ) which yields the expression:
                              
                                 (12)
                                 
                                    P
                                    (
                                    
                                       
                                          i
                                       
                                    
                                    ,
                                    
                                       
                                          u
                                       
                                    
                                    )
                                    =
                                    
                                       1
                                       
                                          |
                                          
                                             
                                                ∑
                                                Ω
                                             
                                          
                                          D
                                          (
                                          
                                             
                                                x
                                             
                                          
                                          )
                                          |
                                       
                                    
                                    
                                       ∫
                                       Ω
                                    
                                    D
                                    (
                                    
                                       
                                          x
                                       
                                    
                                    )
                                    
                                       G
                                       β
                                    
                                    (
                                    
                                       
                                          
                                             I
                                          
                                       
                                       u
                                    
                                    (
                                    
                                       
                                          x
                                       
                                    
                                    )
                                    −
                                    
                                       
                                          i
                                       
                                    
                                    )
                                    d
                                    
                                       
                                          x
                                       
                                    
                                    ,
                                 
                              
                           
                           
                              
                                 (13)
                                 
                                    D
                                    (
                                    
                                       
                                          x
                                       
                                    
                                    )
                                    =
                                    exp
                                    
                                       
                                          
                                             −
                                             
                                                
                                                   
                                                      
                                                         
                                                            
                                                               d
                                                               lung
                                                            
                                                            (
                                                            
                                                               
                                                                  x
                                                               
                                                            
                                                            )
                                                         
                                                         W
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                    ,
                                 
                              
                           where 
                              i
                            represents the co-occurrence of an intensity pair, W is a constant that controls the effective confidence region introduced by the edge. We choose W
                           =2.25cm because within this range of the lung border, clear structures exist in both images, e.g., heart surface. The weight term D(
                              x
                           ) decays as the location moves away from the lung surface, because in our application, the structures that appear in both modalities are mainly around the lung surfaces. Our density estimator is based on a normalized Gaussian kernel of variance β, denoted by G
                           
                              β
                           (i), with β being commonly set to 1.

The definition of the SMI is the same as MI which takes the following form:
                              
                                 (14)
                                 
                                    
                                       E
                                       SMI
                                    
                                    =
                                    
                                       ∫
                                       
                                          
                                             R
                                             2
                                          
                                       
                                    
                                    P
                                    (
                                    
                                       
                                          i
                                       
                                    
                                    ,
                                    
                                       
                                          u
                                       
                                    
                                    )
                                    log
                                    
                                       
                                          P
                                          (
                                          
                                             
                                                i
                                             
                                          
                                          ,
                                          
                                             
                                                u
                                             
                                          
                                          )
                                       
                                       
                                          p
                                          (
                                          
                                             i
                                             1
                                          
                                          )
                                          p
                                          (
                                          
                                             i
                                             2
                                          
                                          )
                                       
                                    
                                    d
                                    
                                       
                                          i
                                       
                                    
                                    ,
                                 
                              
                           where p(i
                           1) and p(i
                           2) are the marginal probability density functions of the reference and floating images, respectively. Compared to the conventional MI, we encode the lung segmentation information into the calculation of joint density function which implicitly makes the SMI content-aware. The deformation field therefore is driven more by the areas that are regarded as more reliable, making the optimization less prone to noise and local optima, and therefore leading to more accurate registration results.

For the optimization step, we follow the variational framework proposed by Hermosillo et al. [17] that has demonstrated nice properties in terms of accuracy and capture range compared to the parametric deformable registration. In particular, we perform variational minimization of the proposed energy functional by gradient descent:
                           
                              (15)
                              
                                 
                                    
                                       ∂
                                       
                                          
                                             u
                                          
                                       
                                    
                                    
                                       ∂
                                       t
                                    
                                 
                                 =
                                 −
                                 
                                    
                                       ∂
                                       E
                                       (
                                       
                                          
                                             u
                                          
                                       
                                       )
                                    
                                    
                                       ∂
                                       
                                          
                                             u
                                          
                                       
                                    
                                 
                                 =
                                 −
                                 
                                    
                                       ∂
                                       
                                          E
                                          SMI
                                       
                                       (
                                       
                                          
                                             u
                                          
                                       
                                       )
                                    
                                    
                                       ∂
                                       
                                          
                                             u
                                          
                                       
                                    
                                 
                                 −
                                 α
                                 
                                    
                                       ∂
                                       
                                          E
                                          prior
                                       
                                       (
                                       
                                          
                                             u
                                          
                                       
                                       )
                                    
                                    
                                       ∂
                                       
                                          
                                             u
                                          
                                       
                                    
                                 
                                 .
                              
                           
                        
                     

Based on (15), the deformation field 
                           u
                         is updated at every iteration. The gradient of SMI is similar to the gradient of MI [17] with an additional term on the structure weight term D(
                           x
                        ), and can be shown to be:
                           
                              (16)
                              
                                 
                                    
                                       ∂
                                       
                                          E
                                          SMI
                                       
                                    
                                    
                                       ∂
                                       
                                          
                                             u
                                          
                                       
                                       (
                                       
                                          
                                             x
                                          
                                       
                                       )
                                    
                                 
                                 =
                                 
                                    
                                       D
                                       (
                                       
                                          
                                             x
                                          
                                       
                                       )
                                    
                                    
                                       |
                                       
                                          
                                             ∑
                                             Ω
                                          
                                       
                                       D
                                       (
                                       
                                          
                                             x
                                          
                                       
                                       )
                                       |
                                    
                                 
                                 
                                    G
                                    β
                                 
                                 *
                                 
                                    
                                       
                                          
                                             
                                                
                                                   ∂
                                                   2
                                                
                                                P
                                                (
                                                
                                                   
                                                      i
                                                   
                                                
                                                ,
                                                
                                                   
                                                      u
                                                   
                                                
                                                (
                                                
                                                   
                                                      x
                                                   
                                                
                                                )
                                                )
                                             
                                             
                                                P
                                                (
                                                
                                                   
                                                      i
                                                   
                                                
                                                ,
                                                
                                                   
                                                      u
                                                   
                                                
                                                (
                                                
                                                   
                                                      x
                                                   
                                                
                                                )
                                                )
                                             
                                          
                                          −
                                          
                                             
                                                
                                                   p
                                                   ′
                                                
                                                (
                                                
                                                   i
                                                   2
                                                
                                                ,
                                                
                                                   
                                                      u
                                                   
                                                
                                                (
                                                
                                                   
                                                      x
                                                   
                                                
                                                )
                                                )
                                             
                                             
                                                p
                                                (
                                                
                                                   i
                                                   2
                                                
                                                ,
                                                
                                                   
                                                      u
                                                   
                                                
                                                (
                                                
                                                   
                                                      x
                                                   
                                                
                                                )
                                                )
                                             
                                          
                                       
                                    
                                 
                                 ∇
                                 
                                    I
                                    2
                                    σ
                                 
                                 (
                                 
                                    
                                       x
                                    
                                 
                                 +
                                 
                                    
                                       u
                                    
                                 
                                 (
                                 
                                    
                                       x
                                    
                                 
                                 )
                                 )
                                 ,
                              
                           
                        where ∂2
                        P denotes the partial derivative of P with respect to its second variable, p′ is the derivative of the marginal pdf, and * is the convolution operator.

Following the notation in [17], the gradient of E
                        prior(
                           u
                        ) is derived from:


                        
                           
                              (17)
                              
                                 
                                    
                                       
                                          
                                             δ
                                             
                                                
                                                   k
                                                
                                             
                                          
                                          
                                             E
                                             prior
                                          
                                          (
                                          
                                             
                                                u
                                             
                                          
                                          )
                                       
                                       
                                          =
                                          
                                             ∫
                                             Ω
                                          
                                          
                                             ∂
                                             
                                                ∂
                                                ϵ
                                             
                                          
                                          w
                                          (
                                          
                                             
                                                x
                                             
                                          
                                          )
                                          |
                                          |
                                          
                                             
                                                u
                                             
                                          
                                          (
                                          
                                             
                                                x
                                             
                                          
                                          )
                                          +
                                          ɛ
                                          
                                             
                                                k
                                             
                                          
                                          (
                                          
                                             
                                                x
                                             
                                          
                                          )
                                          −
                                          v
                                          (
                                          
                                             
                                                x
                                             
                                          
                                          )
                                          |
                                          
                                             |
                                             2
                                          
                                          
                                             |
                                             
                                                ϵ
                                                =
                                                0
                                             
                                          
                                          d
                                          
                                             
                                                x
                                             
                                          
                                       
                                    
                                    
                                       
                                       
                                          =
                                          
                                             ∫
                                             Ω
                                          
                                          w
                                          (
                                          
                                             
                                                x
                                             
                                          
                                          )
                                          (
                                          2
                                          (
                                          
                                             
                                                u
                                             
                                          
                                          (
                                          
                                             
                                                x
                                             
                                          
                                          )
                                          −
                                          
                                             
                                                v
                                             
                                          
                                          (
                                          
                                             
                                                x
                                             
                                          
                                          )
                                          )
                                          ·
                                          
                                             
                                                k
                                             
                                          
                                          (
                                          
                                             
                                                x
                                             
                                          
                                          )
                                          )
                                          d
                                          
                                             
                                                x
                                             
                                          
                                          ,
                                       
                                    
                                 
                              
                           
                        where δ
                        
                           
                              k
                           
                        
                        E
                        prior(
                           u
                        ) is the first variation of E
                        prior(
                           u
                        ) at 
                           u
                         in the direction of 
                           k
                         (see [36]).

Thus we have
                           
                              (18)
                              
                                 
                                    
                                       ∂
                                       
                                          E
                                          prior
                                       
                                       (
                                       
                                          
                                             u
                                          
                                       
                                       )
                                    
                                    
                                       ∂
                                       
                                          
                                             u
                                          
                                       
                                       (
                                       
                                          
                                             x
                                          
                                       
                                       )
                                    
                                 
                                 =
                                 2
                                 w
                                 (
                                 
                                    
                                       x
                                    
                                 
                                 )
                                 (
                                 
                                    
                                       u
                                    
                                 
                                 (
                                 
                                    
                                       x
                                    
                                 
                                 )
                                 −
                                 
                                    
                                       v
                                    
                                 
                                 (
                                 
                                    
                                       x
                                    
                                 
                                 )
                                 )
                                 .
                              
                           
                        
                     

From (16) and (18), we immediately notice the term ((∂2
                        P(
                           i
                        , 
                           u
                        (
                           x
                        )))/(P(
                           i
                        , 
                           u
                        (
                           x
                        )))−(p′(i
                        2, 
                           u
                        (
                           x
                        )))/(p(i
                        2, 
                           u
                        (
                           x
                        )))) and 
                           (
                           
                              
                                 u
                              
                           
                           (
                           
                              
                                 x
                              
                           
                           )
                           −
                           
                              
                                 v
                              
                           
                           (
                           
                              
                                 x
                              
                           
                           )
                           )
                         as the comparison functions of our registration method. (∂2
                        P(
                           i
                        , 
                           u
                        (
                           x
                        )))/(P(
                           i
                        , 
                           u
                        (
                           x
                        ))) tends to cluster the joint histogram P(
                           i
                        , 
                           u
                        ), while −(p′(i
                        2, 
                           u
                        (
                           x
                        )))/(p(i
                        2, 
                           u
                        (
                           x
                        ))) prevents the marginal distribution of the deformed CT image from becoming too clustered. For 
                           (
                           
                              
                                 u
                              
                           
                           (
                           
                              
                                 x
                              
                           
                           )
                           −
                           
                              
                                 v
                              
                           
                           (
                           
                              
                                 x
                              
                           
                           )
                           )
                        , the deformation field 
                           u
                         is lead by 
                           
                              v
                           
                        , thus 
                           u
                         will not deviate significantly from the prior deformation field 
                           
                              v
                           
                        . In addition, the use of the weight terms D(
                           x
                        ) and 
                           w
                           (
                           
                              
                                 x
                              
                           
                           )
                         leads to desirable properties while updating the deformation field at each iteration. Specifically, in the locations where D(
                           x
                        ) is large, the deformation field will be dominated by the SMI term, because in these regions, there is clear structure information in both CT and C-arm CT volumes. Thus the registration benefits from the intensity information. While in the regions with larger 
                           w
                           (
                           
                              
                                 x
                              
                           
                           )
                        , these regions typically contain nonradiopaque structures in the non-contrast-enhanced C-arm CT and mismatched structures between the CT and C-arm CT volumes occur. A larger 
                           w
                           (
                           
                              
                                 x
                              
                           
                           )
                         imposes a stronger prior deformation knowledge at location 
                           x
                         to avoid anatomically implausible deformation. The combination effect from D(
                           x
                        ) and 
                           w
                           (
                           
                              
                                 x
                              
                           
                           )
                         ensures that our deformable registration is context-aware and well regularized.

The proposed registration framework is implemented using C++. Our implementation is advanced with efficient filtering and parallelization. OpenMP is deployed to reduce the computational time of the proposed framework. Multi-resolution scheme is adopted to speed up the registration process and also to reduce local minima while minimizing the energy function. It takes less than 4min on a PC with a dual core CPU, 3GB RAM and running Microsoft XP OS. If we only consider the deformable registration process alone, our implementation takes only around 2min compared to 105min for the closest algorithm in EMPIRE10 Challenge [37], thanks to efficient filtering and parallelization. More advanced CPU and a larger memory can be used to reduce the process time. Furthermore, we are still working on further parallelizing the current implementation. Therefore, with a more advanced computer in the operating room and a more efficient parallelization scheme, shorter process time of our proposed framework is expected which makes the framework more clinically applicable. Having said that, the proposed 3D/3D registration is performed in the operating room at the beginning of the interventional procedure to acquire the 3D aorta model, therefore, the current full process time of 4 minutes is considered to be viable in the clinical setup.

@&#EXPERIMENTS@&#

In this section, we quantitatively and qualitatively evaluate our proposed 3D/3D registration framework. First, we demonstrate that our proposed framework provides high rigid registration success rate. Second, we show that the deformable registration improves the registration accuracy and the registration results are potentially applicable in the clinical environment.

We validated our proposed method on 20 TAVI patients who had undergone both CT and contrast-enhanced C-arm CT scans. The 20 C-arm CT images are with standard quality. The size of each slice in a volume is 256×256 or 512×512 pixels. A volume contains around 100–300 slices. The image resolution is isotropic and varies from 0.49 to 0.92mm3. We artificially removed the contrast in the aorta area for C-arm CT by replacing intensities corresponding to the contrast agent with intensities generated from a Gaussian distribution with the mean equal to the heart area of the C-arm CT volume. The generated data are visually inspected to be non-distinguishable from the real non-contrast enhanced C-arm CT volumes (Fig. 4
                           ). Thus in the experiments, we are essentially matching the CT volume with non-contrast-enhanced C-arm CT volume. The experimental setup takes advantage of the known ground truth. Although artificially generated non-contrast enhanced C-arm CT image may not be an ideal experiment setup, it is so far the best way to make quantitative evaluation on the performance of the proposed registration algorithm for real patient data. Compared to possibly alternative validation methods on animal/cadaver data, the deformation property of the heart is more realistic for the target (live human being) application. In addition, using metallic markers to generate ground truth positions raises the issue of the interference of the markers on registration performance due to their high gradients in the images. For all the experiments, the parameters are fixed and without tuning for the best performance for individual data. For quantitative evaluation purpose, a cardiologist manually delineated the aortic root of all the CT and C-arm CT data sets.

A conventional way to perform rigid-body registration is to first align the center of mass of both images. Hence, we compare the results obtained from two different initial positions, center of mass and heart center, respectively. As an intermediate stage of our framework, we quantify the registration result by examining whether the rigid registration result is reasonably correct. More specifically, if the distance between the aortic roots is greater than 6cm, we classify the rigid registration as failed, otherwise the rigid registration is considered as successful. The use of the 6cm distance threshold for the evaluation of rigid-body registration is determined empirically. Based on the 20 image pairs we have, and by performing non-rigid registration after rigid registration, we found that for rigid registration errors that are larger than 6cm, the subsequent non-rigid registration is typically not able to reduce the registration error to become clinically acceptable.

Among the 20 experiment data sets, initializing from the center of mass only successfully register to the optimum position in 4 cases. In comparison, using the heart center as the initialization successfully registers 17 of the 20 cases. The high rigid-body registration failure rate using center of mass is mainly because of the following two reasons. First, for some full-body CT scanned volumes, the center of mass is far way from the heart area, thus the initialization is too far away from the optimum solution (Fig. 2). Second, there is currently no standard protocol for acquiring the C-arm CT images. The captured C-arm CT mainly focuses on the heart or more specifically, the aortic area. Due to this reason, some structures that are valuable for rigid-body registration are missing in the C-arm CT, e.g., part of the lungs. The second point is also the reason for causing three failure cases even with the proposed method. Implicitly, this will cause the aperture problem while performing rigid-body registration. Consequently, if the CT and C-arm CT images are not initialized properly, the registration process may converge to a wrong optimum. Our proposed initialization scheme brings the two volumes to be registered close enough, therefore, the above mention problems can be minimized. The high success rate of the rigid-body registration step makes it possible for the whole framework to be fully automatic. The human intervention during the registration process can thus be minimized.

To evaluate the deformable registration results, we further compared the results obtained from rigid-body registration initialized using the heart center (for the three cases where both initialization methods failed, we used the manual rigid registration results), conventional MI-based deformable registration under variational framework [17], purely relying on our proposed deformation prior, Lu et al.'s method [7], and the proposed method. For evaluation purpose, we extract surface meshes of the aortic roots from the deformed CT and the C-arm CT images (see Fig. 5
                           ). In our experiment, the segmentation of the aortic roots is done by a cardiologist, however, it can also be achieved automatically by using the method in [38]. The mesh-to-mesh distance is calculated by the average distance from the points on the aortic root surface mesh root of the deformed CT to the closest point on the aortic root surface mesh of the C-arm CT. The mesh-to-mesh errors are 3.22±1.14mm, 3.26±1.60mm, 2.05±0.67mm, 2.16±0.64mm, and 1.76±0.43mm, respectively. The comprehensive comparison can be found in Fig. 6
                           .

The mesh-to-mesh error from the rigid registration is larger than 3mm on average, which exceeds the tolerance in the practical requirement. The result from the rigid registration indicates that the residual motion of the heart still exists after rigid registration. Therefore, deformable registration should be applied to compensate for the residual motion.

However, using pure intensity-based conventional MI does not reduce the amount of registration error on average, adversely, it introduces a much larger variance. A closer look at every individual cases reveals that pure intensity-based MI reduces the registration error in majority of the cases comparing to rigid registration. But unfortunately, pure intensity-based MI produces significant errors for the cases in which C-arm CT has bad quality. Without incorporating any anatomical information, pure intensity-based MI generates deformation fields that are anatomically implausible, which leads to significant registration errors (see Fig. 7
                           (b)). As robustness is extremely critical for medical applications, and there is no guarantee to acquire C-arm CT data with good image quality, pure intensity-based conventional MI cannot be applied in the practical situation due to its unreliability.

On the other hand, we also tested the reliability of our proposed deformation field prior. Without incorporating any of the intensity information, we directly apply our proposed prior deformation field on the pre-operative CT data. It can be seen that our proposed prior deformation field produces robust and reasonable registration results. This is because the proposed deformation field prior is derived based on the global motion of the heart, thus the result obtained using the prior directly is quite robust. A comparison is made on the results obtained from solely the deformation field prior and the proposed method where intensity information is further incorporated through SMI. Paired t-test between these two methods results a two-tailed P-value of 0.0293. By conventional criteria, this difference is considered to be statistically significant, indicating that the proposed method is statistically significantly better than applying the prior deformation field alone. The improvement can be explained as the followings. The deformation field prior is derived using the method of point set registration, which is less sensitive to points at the area with sharp changes. Therefore, the deformation at those areas may not be fully captured by the deformation prior. To demonstrate this, one registration example from Patient 5 is shown in Fig. 7, Row 1. In this case, the deformation field prior is not well generated mainly because point sets registration using TPS model does not do well in the region with sharp structures, e.g., the sharp thoracic cavity (because the image was acquired at the inspiratory phase). Furthermore, although the prior deformation field provides a high level prior knowledge about how the heart deforms, inaccurate estimation may occur due to the errors from the lung segmentation. One such case is shown in Fig. 7, Row 2. In this case, because of the inaccurate segmentation on the right lung, solely applying the deformation prior would cause the epicardium area to be misaligned and thus leads to inaccurate registration result in the aortic root area. Despite the above mentioned shortcomings of the deformation field prior, with further incorporating the SMI term, the misaligned area can be well corrected which leads to a more desirable registration result. Therefore, the aortic root is registered to a more optimum position.

Our proposed method is closely related to Lu et al.'s method [7] which combines strength from intensity-based method and the anatomical knowledge into the deformable registration framework. Compared to Lu et al.'s method [7] where only rigid nature of the spine is incorporated, our proposed method further constrains the deformation field by using a TPS model to estimate the heart motion. With the least registration error and standard deviation, the result demonstrates the superiority of the proposed similarity measure which combines soft constraints derived from the anatomy, as well as the numerical stability of our gradient descent based optimization scheme. Clinically, a registration error below 2.5mm is deemed acceptable. Compared to Lu et al.'s method, we improve the results for Patients 3, 15 and 16 from borderline acceptable to very accurate, and furthermore, the results for Patients 10, 18 and 19 are improved from clinically not acceptable to acceptable. We further perform a paired t-test between these two methods, and the two-tailed P value equals to 0.0012, showing that the proposed method is statistically significantly better than Lu et al.'s method. This is largely attributed to the proposed deformation prior, which is able to model the deformable heart motion, instead of simple rigid-body motion in the spine area as proposed in [7].

To qualitatively compare our method with Lu et al.'s method. We show another registration example from Patient 9 in Fig. 7, Row 2. In this case, the C-arm CT image is very noisy especially at the area near the spine. The proposed method produces the most accurate registration result at the targeted area – the aortic root (red contours). Furthermore, the anatomical structure at the heart area is nicely preserved, thanks to the incorporated deformation prior. We can see that MI-based method fails completely because of the large area of mismatched structures, while Lu et al.'s method performs well around the spine and heart surface (yellow contours). However, because the aortic root is quite far away from both the heart surface and the spine area, the constraints imposed by [7] is not strong enough to produce a good registration result. Furthermore, due to the significant noise, the registration result at the heart area is not clinically meaningful, e.g., the myocardium (green contours) is badly distorted.

A nice property of our proposed similarity measure is the balance between E
                           SMI and E
                           prior. At the initial stages of the registration process, E
                           prior is the main driving force because initially, the deformation field is very different from the deformation prior, thus the magnitude of E
                           prior is large. As the registration process continues, the E
                           SMI term acts to fine tune the registration results by utilizing the intensity information. And E
                           prior constrains the registration process by penalizing significant deviation from the prior. Note that these two terms are both soft constraints, and the combination of these constraints nicely present the best registration results.

Registration accuracy in the aortic valve landmark detection is measured to further validate the clinical applicability of the proposed registration framework. During the TAVI procedure, the left and right coronary ostia are overlaid onto 2-D fluoroscopic images to provide guidance to physicians to avoid blocking the ostia after valve deployment. Thus accurate registration of left and right coronary ostia is crucial for the TAVI procedure. The landmark registration accuracy of the coronary ostia is measured using the Euclidean distance from the coronary ostia in the C-arm CT image to the corresponding coronary ostia in the registered CT image. We can see that the landmark registration accuracy of the coronary ostia is significantly improved from 6.78±7.32mm to 2.86±0.77mm. The average landmark registration error of below 3mm indicates the clinical feasibility of our proposed registration framework. Fig. 8
                            shows the coronary ostia from C-arm CT and pre-operative CT, respectively.

We also perform our proposed registration framework on three sets of CT/real non-contrast enhanced C-arm CT data. The specs of the three data sets are similar to those in Section 3.1.1. The non-contrast C-arm CT images do not have any visible structure at the targeted area of this application – aorta. Furthermore, as mentioned in Section 3.1.1, the only way to determine positions on non-contrast-enhanced C-arm CT image is to place metallic markers to obtain the ground truth. However, doing so raises the issue of the interference of the markers on registration performance due to their high gradients in the images. Therefore, we are not able to provide quantitative comparison, and only qualitative evaluation is performed.

It is found that the experiment results are very similar to the results obtained by using artificially generated non-contrast enhanced C-arm CT. This validates that the quantitative evaluation in the Section 3.1. We qualitatively evaluate our image registration framework on CT and real non-contrast enhanced C-arm CT. An example is shown in Fig. 9
                        . Firstly, rigid-body registration brings the pre-operative CT to the same coordinate system as C-arm CT image. However, major misalignment still exits mainly due to the cardiac and respiratory motion (see the red arrows in Fig. 9, Row 2). After performing deformable registration, the cardiac and respiratory motion is corrected, and the aortic root is registered to a more optimum location (Fig. 9, Row 3). In this example, we show that the proposed image registration framework successfully registers the CT image to the non-contrast enhanced C-arm CT image. In particular, the spine is correctly registered with its rigid nature embedded in the deformable registration process. Furthermore, the heart structure is nicely preserved and the aortic root is registered to a optimum position, which is clinically applicable, thanks to the anatomic knowledge based deformation field prior.

@&#DISCUSSIONS@&#

In this paper, we used TPS model to generate the prior deformation field. One may argue that other transformation models, e.g., B-spline, have also been successful in tracking the heart surface [31]. We would like to address that we choose TPS model mainly for the following two reasons. First, the computational efficiency. It is well-known that B-spline involves iterative calculation in the optimization process that causes longer computational time, as mentioned in Section 2.2. Second, in our application, TPS model is more accurate in producing deformation prior, compared to the B-spline model. To validate, we calculated the Hausdorff distance between the point sets before point sets registration, using B-spline model, and TPS model. The calculated Hausdorff distances are 7.40±3.35mm, 5.94±3.75mm and 5.83±3.53mm respectively. The point sets registration significantly reduces the distance between the point sets, and the results produced by B-spline model and TPS model are quite similar. We then further compared the deformable registration results using deformation priors using B-spline and TPS models. It is found that using the prior generated by TPS model significantly outperforms generated by the prior generated by B-spline model. Using the prior generated by B-spline model increases the registration error from 1.76±0.43mm to 2.15±0.78mm. This is because TPS produces a more global deformation prior, while the control points of the B-spline model have more effect on the local regions. Due to the nature of this application, we have only points from the heart surface, but we need to estimate the deformation field at the aorta (near the center of the heart), using TPS is a more robust and better solution as the deformation prior estimated is based more on the global deformation. On the contrary, by using B-spline, although the registration accuracy at the heart surface is comparable with TPS, at the aorta where it is further away from the heart surface, the deformation field is not well predicted. Therefore, in our algorithm, we choose to use TPS model that has a higher computation efficiency and more robust registration accuracy.

The proposed fully automatic registration framework minimizes the interaction needed from the doctors. However, our framework also offers the flexibility of human interaction, including manual heart center identification and manual rigid-body registration. Therefore, the doctors are free to modify/adjust the rigid-body registration results.

The main concern of our proposed framework is the usability of our framework in the clinical TAVI procedure. The current study towards standardizing the pre-operative CT acquisition procedure [4] makes pre-operative CT suitable for patients with renal problems using low contrast agent dose. Utilizing the 3D aortic model acquired from pre-operative CT for the TAVI procedure has been reported with positive results despite the need for correctly positioning the 3D aortic model to the 2D fluoroscopy images [5]. The above facts support that our registration framework is well suited for the TAVI procedure to acquire and apply the aortic model from pre-operative CT images. Furthermore, our proposed registration framework eliminating the need for manually registering the pre-operative CT with non-contrast-enhanced C-arm CT images as compared to [5]. The deformable registration step further accounts the respiratory and cardiac motion which increases the registration accuracy.

We would like to stress that our framework serves for the sole purpose of 3D aorta model acquisition. And although it takes few minutes to complete the registration process, the registration only needs to perform once, the subsequent TAVI procedures including landmarks detection, aorta 3D model extraction, computation of volume positions, and 2D/3D intraoperative registration do not need to change (we refer the readers to the complete system description of TAVI in [2]). With the minimum adjustment of the original TAVI procedure, our proposed registration framework well suits the original TAVI framework.

@&#LIMITATIONS@&#

The proposed registration framework was evaluated with a limited number of patients from four medical institutes. C-arm CT data from other medical institutes can vary drastically, therefore, to more fully test the current framework, future experiments with a larger cohort need to be carried out.

Our proposed registration framework is dependent on the prior deformation field generated from the heart anatomy. Therefore, it is critical to capture the whole heart while acquiring the images, especially the C-arm CT images. Furthermore, respiratory and cardiac motion between the CT and C-arm CT should be minimized which suggests that the images should be acquired at the same or nearly the same respiratory and cardiac phases. We believe that our proposed registration framework will largely benefit from a more standardized image acquiring process which is considered to be completely feasible by our collaborating physicians, and thus achieving better registration results.

@&#CONCLUSIONS@&#

In this paper, we presented a general 3D/3D image registration framework to overlay CT image onto non-contrast-enhanced C-arm CT. We proposed a clinically more relevant initialization scheme to significantly improve the success rate of rigid-body registration, thus enabling a fully automatic registration framework. Unlike the existing methods that generate deformation field prior using large amount of training data sets, we make use of the anatomical information from the spine and heart surface, to generate an anatomically meaningful deformation field prior based on a TPS model. In addition, a novel energy function for deformable registration is proposed which combines the strength of SMI and the derived prior deformation field. The proposed framework is validated on 20 sets of clinical TAVI data. We show that the proposed method provides robust rigid-body registration results. Deformable registration further reduces the registration errors. For deformable registration, we compared the proposed method with pure intensity-based MI, directly applying the deformation field prior and our previous method [7]. Due to the lack of intensity information in the heart area, pure intensity-based MI method is prone to registration errors, consequently, implausible deformation field may occur which produces unreasonable registration results. Directly applying the deformation field prior provides robust and reasonable registration results, however, because the deformation field prior is estimated globally, it is not accurate at the edges and the areas with sharp structure, the registration result can be further improved. On the other hand, our proposed deformable registration method combines two soft constraints that jointly constrain the deformable registration process, and lead to a more accurate and anatomical meaningful registration result. We also showed that with incorporating the heart motion, the anatomical knowledge is more complete compared to our previously proposed method [7], and thus a better registration result. Paired t-test has shown that our proposed method is significantly better than the other three methods compared in the paper. Furthermore, we also reported the landmark errors based on measurement of the coronary ostia, the registration error of 2.86±0.77mm confirms the feasibility of our proposed framework on the clinical usage. Overall, our procedure eliminates the need for contrast agent injection while acquiring C-arm CT images. More importantly, the proposed framework can be nicely fit into the TAVI procedure as described in [2], without the need to change the system significantly. The proposed method is of a general form for heart registration and hence not limited to TAVI applications, but can be straightforwardly applied to other applications that require cross-modality registration of the heart. Future work includes clinically validating the framework on a larger number of data sets and applying the resulting 3D aorta model to 2D/3D image registration. We are also working on improving the parallelization of our implementation, and with more advanced CPU, a much faster registration process is expected. Regularization based on biomechanical properties could be further imposed to produce more anatomically plausible deformation field.

@&#REFERENCES@&#

