@&#MAIN-TITLE@&#Curve fitting and optimal interpolation for CNC machining under confined error using quadratic B-splines

@&#HIGHLIGHTS@&#


               
               
                  
                     
                        
                           
                           The explicit Hausdorff distance of a line segment and a quadratic curve is given.


                        
                        
                           
                           G01 codes can be fitted by quadratic B-splines with confined error.


                        
                        
                           
                           We combine the tool path generating and optimal velocity planning in one step.


                        
                        
                           
                           We simulate the manufacture process with our proposed method.


                        
                     
                  
               
            

@&#KEYPHRASES@&#

CNC interpolation

G01 code

Curve fitting of polyline

Quadratic B-spline

Trajectory planning

Confined error

@&#ABSTRACT@&#


               
               
                  In CNC machining, fitting the polyline machining tool path with parametric curves can be used for smooth tool path generation and data compression. In this paper, an optimization problem is solved to find a quadratic B-spline curve whose Hausdorff distance to the given polyline tool path is within a given precision. Furthermore, adopting time parameter for the fitting curve, we combine the usual two stages of tool path generation and optimal velocity planning to derive a one-step solution for the CNC optimal interpolation problem of polyline tool paths. Compared with the traditional decoupled model of curve fitting and velocity planning, experimental results show that our method generates a smoother path with minimal machining time.
               
            

@&#INTRODUCTION@&#

The G01 codes in the form of polylines or microlines have been used extensively in CNC machining. Since the polyline segment is usually very small, this representation is highly memory consuming and tends to introduce extreme changes in traveling directions. The corner transition process is used to improve the smoothness in  [1,2], but it enlarges the data and the smooth degree is not high enough. Yau and Wang  [3,4] address a continuous-short-blocks criterion, that initially divides the G01 codes into groups, and then finds the spline that interpolates all points in a group. This procedure may introduce too many short curves when the points generated by G01 codes are very close to each other. Hence, for a large data set, people generally choose to fit the original data with an approximate curve to achieve the required smoothness and data compression. After this fitting process, feedrates are designed along the new curve for CNC interpolation.

Curve fitting has undergone deep investigation in CAD. Fitting a set of points 
                        
                           
                              
                                 p
                              
                           
                           
                              k
                           
                        
                        ,
                        
                        k
                        =
                        1
                        ,
                        …
                        ,
                        m
                      by a curve 
                        
                           f
                        
                        
                           (
                           s
                           )
                        
                      is an optimization problem of minimizing the total squared distances: 
                        
                           (1)
                           
                              min
                              
                              F
                              =
                              
                                 
                                    1
                                 
                                 
                                    2
                                 
                              
                              
                                 
                                    ∑
                                 
                                 
                                    k
                                    =
                                    1
                                 
                                 
                                    m
                                 
                              
                              
                                 
                                    d
                                 
                                 
                                    2
                                 
                              
                              
                                 (
                                 
                                    
                                       
                                          p
                                       
                                    
                                    
                                       k
                                    
                                 
                                 ,
                                 
                                    f
                                 
                                 
                                    (
                                    s
                                    )
                                 
                                 )
                              
                              +
                              λ
                              η
                              ,
                           
                        
                      where 
                        d
                        
                           (
                           
                              
                                 
                                    p
                                 
                              
                              
                                 k
                              
                           
                           ,
                           
                              f
                           
                           
                              (
                              s
                              )
                           
                           )
                        
                      is the distance between 
                        
                           
                              
                                 p
                              
                           
                           
                              k
                           
                        
                      and the target curve 
                        
                           f
                        
                        
                           (
                           s
                           )
                        
                     , and 
                        η
                      is an auxiliary smooth function with weight 
                        λ
                     . A suitable choice of the distance function 
                        d
                      is key to the optimization problem. Some nice distance estimation methods including PDM (Point Distance Minimization), TDM (Tangent Distance Minimization), SDM (Squared Distance Minimization), GTDM (Generalized Tangent Distance Minimization) and CDM (Curvature Distance Minimization) are proposed by  [5,6], which possess different advantages either in numerical accuracy or in computational efficiency. Special requirements for the fitting curve can be involved as additional constraints for the optimization problem. For instance, Flöry  [7] fit the points with B-spline curves which can avoid the given obstacles.

In CNC machining, the G01 codes represent a tool path in the form of polylines. If we consider only fitting the G01 points, the result curve may go far from those non endpoints on the polylines (see Fig. 3(a)). This situation is unacceptable in CNC machining, since the CNC error control is to guarantee that the fitting curve lie completely within the “band” of a given width along the polyline. Therefore, the fitting problem should be considered under the confined error constraint, which hereby we apply the Hausdorff distance between the original polylines and result fitting curve. Then the optimization problem of (1) becomes: 
                        
                           
                              (2)
                              
                                 min
                                 
                                 F
                                 =
                                 
                                    
                                       1
                                    
                                    
                                       2
                                    
                                 
                                 
                                    
                                       ∑
                                    
                                    
                                       k
                                       =
                                       1
                                    
                                    
                                       m
                                       −
                                       1
                                    
                                 
                                 
                                    
                                       d
                                    
                                    
                                       2
                                    
                                 
                                 
                                    (
                                    
                                       
                                          
                                             p
                                          
                                       
                                       
                                          k
                                       
                                    
                                    
                                       
                                          
                                             p
                                          
                                       
                                       
                                          k
                                          +
                                          1
                                       
                                    
                                    ,
                                    
                                       f
                                    
                                    
                                       (
                                       s
                                       )
                                    
                                    )
                                 
                                 +
                                 λ
                                 η
                                 ,
                              
                           
                           
                              
                                 s.t.
                                 
                                 d
                                 
                                    (
                                    
                                       
                                          
                                             p
                                          
                                       
                                       
                                          k
                                       
                                    
                                    
                                       
                                          
                                             p
                                          
                                       
                                       
                                          k
                                          +
                                          1
                                       
                                    
                                    ,
                                    
                                       f
                                    
                                    
                                       (
                                       s
                                       )
                                    
                                    )
                                 
                                 ≤
                                 ϵ
                                 ,
                              
                           
                        
                      where 
                        d
                        
                           (
                           
                              
                                 
                                    p
                                 
                              
                              
                                 k
                              
                           
                           
                              
                                 
                                    p
                                 
                              
                              
                                 k
                                 +
                                 1
                              
                           
                           ,
                           
                              f
                           
                           
                              (
                              s
                              )
                           
                           )
                        
                      is the Hausdorff distance between the line segment 
                        
                           
                              
                                 p
                              
                           
                           
                              k
                           
                        
                        
                           
                              
                                 p
                              
                           
                           
                              k
                              +
                              1
                           
                        
                      and 
                        
                           f
                        
                        
                           (
                           s
                           )
                        
                     , and 
                        ϵ
                      is the error bound. It is clear that problem (2) is much more difficult to solve than problem (1); however, we shall show that when we choose 
                        
                           f
                        
                        
                           (
                           s
                           )
                        
                      to be quadratic B-splines, problem (2) can be nicely solved.

Throughout the following context, 
                        
                           f
                        
                        
                           (
                           s
                           )
                        
                      is assumed to be a quadratic B-spline. We shall show the explicit formulas of the Hausdorff distance and the distance constraint between a line segment and 
                        
                           f
                        
                        
                           (
                           s
                           )
                        
                     , which directly facilitate our solution of (2). It is worth mentioning that the distance constraint between a line segment and a curve of degree higher than two does not have explicit representation, and its numerical computation is also time consuming.

In CNC machining, given a smooth parametric tool path, there are various ways for velocity planning according to different constraints  [8–14]. Bobrow et al.  [8] give a time-optimal interpolation method for robotics under the kinematic constraints. Timar et al.  [11] propose a time-optimal interpolation method for general spline curves under the constraints of maximal acceleration capabilities of each motor axis. Yuan et al.  [9] present a time-optimal interpolation method for curved tool path with confined chord error and tangential acceleration. Boyadjieff et al.  [15] and Zhang et al.  [13] use different approaches to smoothing the acceleration profile. Erkorkmaz and Altintas  [14] give a quintic spline trajectory generation algorithm with velocity, acceleration and jerk constraints. Dong et al.  [10], Beudaert et al.  [16] and Zhang et al.  [12] present different velocity planning methods with acceleration and jerk constraints for each axis under a greedy way. As another important issue for high-speed machining is the kinematic performances of cutter. Nam et al.  [17], Lin et al.  [18] and Lai et al.  [19] investigate velocity planning methods based on tangential acceleration and jerk constraints with look-ahead facility. Jin et al.  [20] use two stages way to do the interpolation, that is, use line segments to interpolate the parametric tool path first then to do the fine interpolation. In this paper, once the fitting curve is computed, we use the interpolation method given by  [21] for velocity planning. Our approach generates the time optimal feedrate for quadratic B-splines efficiently.

Moreover, taking the fitting curve to be time-parameterized, a two-in-one (which combines the usual two stages of tool path generation and velocity planning) optimization target is built under the constraints of distance, velocity and acceleration boundaries. The solution for this optimization problem is a time optimal trajectory with confined error. Here, quadratic B-spline shows its advantage in providing velocity and accelerations with convex property in each segment, hence restriction of the velocity and accelerations to each knot point is allowed.

The paper is organized as follows. First, some necessary preliminaries are presented in Section  2. In Section  3, we compute the fitting curve of given data with confined error. An alternative numerical method is introduced in Section  4. Setting the parameter as time parameter, we give the trajectory planning method in Section  5. The examples and simulation results are proposed in Section  6. Finally, we conclude the paper in Section  7.

Let a planar B-spline curve 
                           
                              f
                           
                           :
                           R
                           →
                           
                              
                                 R
                              
                              
                                 2
                              
                           
                           :
                           s
                           ↦
                           
                              f
                           
                           
                              (
                              s
                              )
                           
                         with 
                           n
                         control points 
                           
                              
                                 
                                    c
                                 
                              
                              
                                 i
                              
                           
                           =
                           
                              
                                 
                                    (
                                    
                                       
                                          x
                                       
                                       
                                          i
                                       
                                    
                                    ,
                                    
                                       
                                          y
                                       
                                       
                                          i
                                       
                                    
                                    )
                                 
                              
                              
                                 T
                              
                           
                           ∈
                           
                              
                                 R
                              
                              
                                 2
                              
                           
                         be presented as  [22]
                        
                           
                              
                                 
                                    f
                                 
                                 
                                    (
                                    s
                                    )
                                 
                                 =
                                 
                                    
                                       ∑
                                    
                                    
                                       i
                                       =
                                       1
                                    
                                    
                                       n
                                    
                                 
                                 
                                    
                                       B
                                    
                                    
                                       i
                                       ,
                                       k
                                    
                                 
                                 
                                    (
                                    s
                                    )
                                 
                                 
                                    
                                       
                                          c
                                       
                                    
                                    
                                       i
                                    
                                 
                                 ,
                              
                           
                         where 
                           
                              
                                 B
                              
                              
                                 i
                                 ,
                                 k
                              
                           
                           
                              (
                              s
                              )
                           
                           ∈
                           R
                           
                              [
                              s
                              ]
                           
                         is the 
                           i
                        th Bernstein basis function of degree 
                           k
                        . For convenience, 
                           
                              f
                           
                           
                              (
                              s
                              )
                           
                         can be written in the matrix form 
                           
                              f
                           
                           
                              (
                              s
                              )
                           
                           =
                           
                              B
                           
                           
                              (
                              s
                              )
                           
                           
                              c
                           
                        .

For given knots 
                           
                              
                                 τ
                              
                              
                                 1
                              
                           
                           ≤
                           ⋯
                           ≤
                           
                              
                                 τ
                              
                              
                                 n
                                 +
                                 k
                                 +
                                 1
                              
                           
                        , the Bernstein basis functions are defined as 
                           
                              (3)
                              
                                 
                                    
                                       B
                                    
                                    
                                       i
                                       ,
                                       0
                                    
                                 
                                 
                                    (
                                    s
                                    )
                                 
                                 =
                                 
                                    {
                                    
                                       
                                          
                                             1
                                             ,
                                             
                                             s
                                             ∈
                                             
                                                [
                                                
                                                   
                                                      τ
                                                   
                                                   
                                                      i
                                                   
                                                
                                                ,
                                                
                                                   
                                                      τ
                                                   
                                                   
                                                      i
                                                      +
                                                      1
                                                   
                                                
                                                )
                                             
                                             ;
                                          
                                       
                                       
                                          
                                             0
                                             ,
                                             
                                             else .
                                          
                                       
                                    
                                 
                              
                           
                         For 
                           r
                           =
                           1
                           ,
                           2
                           ,
                           …
                           ,
                           k
                           ,
                           
                           i
                           =
                           1
                           ,
                           2
                           ,
                           …
                           ,
                           n
                           +
                           k
                           −
                           r
                        , 
                           
                              (4)
                              
                                 
                                    
                                       B
                                    
                                    
                                       i
                                       ,
                                       r
                                    
                                 
                                 
                                    (
                                    s
                                    )
                                 
                                 =
                                 
                                    
                                       s
                                       −
                                       
                                          
                                             τ
                                          
                                          
                                             i
                                          
                                       
                                    
                                    
                                       
                                          
                                             τ
                                          
                                          
                                             i
                                             +
                                             r
                                          
                                       
                                       −
                                       
                                          
                                             τ
                                          
                                          
                                             i
                                          
                                       
                                    
                                 
                                 
                                    
                                       B
                                    
                                    
                                       i
                                       ,
                                       r
                                       −
                                       1
                                    
                                 
                                 
                                    (
                                    s
                                    )
                                 
                                 +
                                 
                                    
                                       
                                          
                                             τ
                                          
                                          
                                             i
                                             +
                                             r
                                             +
                                             1
                                          
                                       
                                       −
                                       s
                                    
                                    
                                       
                                          
                                             τ
                                          
                                          
                                             i
                                             +
                                             r
                                             +
                                             1
                                          
                                       
                                       −
                                       
                                          
                                             τ
                                          
                                          
                                             i
                                             +
                                             1
                                          
                                       
                                    
                                 
                                 
                                    
                                       B
                                    
                                    
                                       i
                                       +
                                       1
                                       ,
                                       r
                                       −
                                       1
                                    
                                 
                                 
                                    (
                                    s
                                    )
                                 
                                 .
                              
                           
                         One can find that 
                           
                              
                                 B
                              
                              
                                 i
                                 ,
                                 k
                              
                           
                           
                              (
                              s
                              )
                           
                         is associated with the knots 
                           
                              {
                              
                                 
                                    τ
                                 
                                 
                                    i
                                 
                              
                              ,
                              …
                              ,
                              
                                 
                                    τ
                                 
                                 
                                    i
                                    +
                                    k
                                    +
                                    1
                                 
                              
                              }
                           
                        . In this paper, we investigate the quadratic B-spline curve, i.e., 
                           k
                           =
                           2
                        . According to the above definition, the curve in 
                           
                              [
                              
                                 
                                    τ
                                 
                                 
                                    i
                                 
                              
                              ,
                              
                                 
                                    τ
                                 
                                 
                                    i
                                    +
                                    1
                                 
                              
                              ]
                           
                         is 
                           
                              (5)
                              
                                 
                                    
                                       
                                          f
                                       
                                    
                                    
                                       i
                                    
                                 
                                 
                                    (
                                    s
                                    )
                                 
                                 =
                                 
                                    
                                       B
                                    
                                    
                                       i
                                       ,
                                       2
                                    
                                 
                                 
                                    (
                                    s
                                    )
                                 
                                 
                                    
                                       
                                          c
                                       
                                    
                                    
                                       i
                                    
                                 
                                 +
                                 
                                    
                                       B
                                    
                                    
                                       i
                                       −
                                       1
                                       ,
                                       2
                                    
                                 
                                 
                                    (
                                    s
                                    )
                                 
                                 
                                    
                                       
                                          c
                                       
                                    
                                    
                                       i
                                       −
                                       1
                                    
                                 
                                 +
                                 
                                    
                                       B
                                    
                                    
                                       i
                                       −
                                       2
                                       ,
                                       2
                                    
                                 
                                 
                                    (
                                    s
                                    )
                                 
                                 
                                    
                                       
                                          c
                                       
                                    
                                    
                                       i
                                       −
                                       2
                                    
                                 
                                 =
                                 
                                    
                                       
                                          
                                             
                                                (
                                                s
                                                −
                                                
                                                   
                                                      τ
                                                   
                                                   
                                                      i
                                                   
                                                
                                                )
                                             
                                          
                                          
                                             2
                                          
                                       
                                       
                                          (
                                          
                                             
                                                
                                                   c
                                                
                                             
                                             
                                                i
                                             
                                          
                                          −
                                          
                                             
                                                
                                                   c
                                                
                                             
                                             
                                                i
                                                −
                                                1
                                             
                                          
                                          )
                                       
                                    
                                    
                                       
                                          (
                                          
                                             
                                                τ
                                             
                                             
                                                i
                                                +
                                                2
                                             
                                          
                                          −
                                          
                                             
                                                τ
                                             
                                             
                                                i
                                             
                                          
                                          )
                                       
                                       
                                          (
                                          
                                             
                                                τ
                                             
                                             
                                                i
                                                +
                                                1
                                             
                                          
                                          −
                                          
                                             
                                                τ
                                             
                                             
                                                i
                                             
                                          
                                          )
                                       
                                    
                                 
                                 +
                                 
                                    
                                       
                                          
                                             
                                                (
                                                s
                                                −
                                                
                                                   
                                                      τ
                                                   
                                                   
                                                      i
                                                      +
                                                      1
                                                   
                                                
                                                )
                                             
                                          
                                          
                                             2
                                          
                                       
                                       
                                          (
                                          
                                             
                                                
                                                   c
                                                
                                             
                                             
                                                i
                                                −
                                                2
                                             
                                          
                                          −
                                          
                                             
                                                
                                                   c
                                                
                                             
                                             
                                                i
                                                −
                                                1
                                             
                                          
                                          )
                                       
                                    
                                    
                                       
                                          (
                                          
                                             
                                                τ
                                             
                                             
                                                i
                                                +
                                                1
                                             
                                          
                                          −
                                          
                                             
                                                τ
                                             
                                             
                                                i
                                                −
                                                1
                                             
                                          
                                          )
                                       
                                       
                                          (
                                          
                                             
                                                τ
                                             
                                             
                                                i
                                                +
                                                1
                                             
                                          
                                          −
                                          
                                             
                                                τ
                                             
                                             
                                                i
                                             
                                          
                                          )
                                       
                                    
                                 
                                 +
                                 
                                    
                                       
                                          c
                                       
                                    
                                    
                                       i
                                       −
                                       1
                                    
                                 
                                 .
                              
                           
                         The first and second differentials of 
                           
                              
                                 
                                    f
                                 
                              
                              
                                 i
                              
                           
                           
                              (
                              s
                              )
                           
                           ,
                           s
                           ∈
                           
                              [
                              
                                 
                                    τ
                                 
                                 
                                    i
                                 
                              
                              ,
                              
                                 
                                    τ
                                 
                                 
                                    i
                                    +
                                    1
                                 
                              
                              ]
                           
                         are 
                           
                              
                                 (6)
                                 
                                    
                                       
                                          
                                             f
                                          
                                       
                                       
                                          i
                                       
                                       
                                          ′
                                       
                                    
                                    
                                       (
                                       s
                                       )
                                    
                                    =
                                    
                                       
                                          2
                                          
                                             (
                                             s
                                             −
                                             
                                                
                                                   τ
                                                
                                                
                                                   i
                                                
                                             
                                             )
                                          
                                          
                                             (
                                             
                                                
                                                   
                                                      c
                                                   
                                                
                                                
                                                   i
                                                
                                             
                                             −
                                             
                                                
                                                   
                                                      c
                                                   
                                                
                                                
                                                   i
                                                   −
                                                   1
                                                
                                             
                                             )
                                          
                                       
                                       
                                          
                                             (
                                             
                                                
                                                   τ
                                                
                                                
                                                   i
                                                   +
                                                   2
                                                
                                             
                                             −
                                             
                                                
                                                   τ
                                                
                                                
                                                   i
                                                
                                             
                                             )
                                          
                                          
                                             (
                                             
                                                
                                                   τ
                                                
                                                
                                                   i
                                                   +
                                                   1
                                                
                                             
                                             −
                                             
                                                
                                                   τ
                                                
                                                
                                                   i
                                                
                                             
                                             )
                                          
                                       
                                    
                                    +
                                    
                                       
                                          2
                                          
                                             (
                                             s
                                             −
                                             
                                                
                                                   τ
                                                
                                                
                                                   i
                                                   +
                                                   1
                                                
                                             
                                             )
                                          
                                          
                                             (
                                             
                                                
                                                   
                                                      c
                                                   
                                                
                                                
                                                   i
                                                   −
                                                   2
                                                
                                             
                                             −
                                             
                                                
                                                   
                                                      c
                                                   
                                                
                                                
                                                   i
                                                   −
                                                   1
                                                
                                             
                                             )
                                          
                                       
                                       
                                          
                                             (
                                             
                                                
                                                   τ
                                                
                                                
                                                   i
                                                   +
                                                   1
                                                
                                             
                                             −
                                             
                                                
                                                   τ
                                                
                                                
                                                   i
                                                   −
                                                   1
                                                
                                             
                                             )
                                          
                                          
                                             (
                                             
                                                
                                                   τ
                                                
                                                
                                                   i
                                                   +
                                                   1
                                                
                                             
                                             −
                                             
                                                
                                                   τ
                                                
                                                
                                                   i
                                                
                                             
                                             )
                                          
                                       
                                    
                                    ,
                                 
                              
                              
                                 (7)
                                 
                                    
                                       
                                          
                                             f
                                          
                                       
                                       
                                          i
                                       
                                       
                                          ″
                                       
                                    
                                    
                                       (
                                       s
                                       )
                                    
                                    =
                                    
                                       
                                          2
                                          
                                             (
                                             
                                                
                                                   
                                                      c
                                                   
                                                
                                                
                                                   i
                                                
                                             
                                             −
                                             
                                                
                                                   
                                                      c
                                                   
                                                
                                                
                                                   i
                                                   −
                                                   1
                                                
                                             
                                             )
                                          
                                       
                                       
                                          
                                             (
                                             
                                                
                                                   τ
                                                
                                                
                                                   i
                                                   +
                                                   2
                                                
                                             
                                             −
                                             
                                                
                                                   τ
                                                
                                                
                                                   i
                                                
                                             
                                             )
                                          
                                          
                                             (
                                             
                                                
                                                   τ
                                                
                                                
                                                   i
                                                   +
                                                   1
                                                
                                             
                                             −
                                             
                                                
                                                   τ
                                                
                                                
                                                   i
                                                
                                             
                                             )
                                          
                                       
                                    
                                    +
                                    
                                       
                                          2
                                          
                                             (
                                             
                                                
                                                   
                                                      c
                                                   
                                                
                                                
                                                   i
                                                   −
                                                   2
                                                
                                             
                                             −
                                             
                                                
                                                   
                                                      c
                                                   
                                                
                                                
                                                   i
                                                   −
                                                   1
                                                
                                             
                                             )
                                          
                                       
                                       
                                          
                                             (
                                             
                                                
                                                   τ
                                                
                                                
                                                   i
                                                   +
                                                   1
                                                
                                             
                                             −
                                             
                                                
                                                   τ
                                                
                                                
                                                   i
                                                   −
                                                   1
                                                
                                             
                                             )
                                          
                                          
                                             (
                                             
                                                
                                                   τ
                                                
                                                
                                                   i
                                                   +
                                                   1
                                                
                                             
                                             −
                                             
                                                
                                                   τ
                                                
                                                
                                                   i
                                                
                                             
                                             )
                                          
                                       
                                    
                                    .
                                 
                              
                           
                        
                     

Fitting a given point set 
                           
                              {
                              
                                 
                                    
                                       p
                                    
                                 
                                 
                                    k
                                 
                              
                              ,
                              
                              k
                              =
                              1
                              ,
                              …
                              ,
                              m
                              }
                           
                         by a parametric curve 
                           
                              f
                           
                           
                              (
                              s
                              )
                           
                         can be reduced to solving a nonlinear optimization problem, i.e., find control points 
                           
                              
                                 
                                    c
                                 
                              
                              
                                 i
                              
                           
                           ,
                           
                           i
                           =
                           1
                           ,
                           …
                           ,
                           n
                         for the objective function (1). In the iterative solving process, we assume that 
                           
                              f
                           
                           
                              (
                              
                                 
                                    s
                                 
                                 
                                    k
                                 
                              
                              )
                           
                         is the nearest foot point of 
                           
                              
                                 
                                    p
                                 
                              
                              
                                 k
                              
                           
                         in 
                           
                              f
                           
                           
                              (
                              s
                              )
                           
                        , so the distance between 
                           
                              
                                 
                                    p
                                 
                              
                              
                                 k
                              
                           
                         and 
                           
                              f
                           
                           
                              (
                              s
                              )
                           
                         is 
                           d
                           
                              (
                              
                                 
                                    
                                       p
                                    
                                 
                                 
                                    k
                                 
                              
                              ,
                              
                                 f
                              
                              
                                 (
                                 s
                                 )
                              
                              )
                           
                           =
                           
                              ‖
                              
                                 f
                              
                              
                                 (
                                 
                                    
                                       s
                                    
                                    
                                       k
                                    
                                 
                                 )
                              
                              −
                              
                                 
                                    
                                       p
                                    
                                 
                                 
                                    k
                                 
                              
                              ‖
                           
                        , and the objective function is the sum of squared distances 
                           d
                           
                              
                                 
                                    (
                                    
                                       
                                          
                                             p
                                          
                                       
                                       
                                          k
                                       
                                    
                                    ,
                                    
                                       f
                                    
                                    
                                       (
                                       s
                                       )
                                    
                                    )
                                 
                              
                              
                                 2
                              
                           
                           ,
                           
                           k
                           =
                           1
                           ,
                           …
                           ,
                           m
                        . To update the control points, we introduce the position perturbation 
                           δ
                           
                              c
                           
                         of 
                           
                              c
                           
                        . Hence, the updated control points is 
                           
                              c
                           
                           +
                           δ
                           
                              c
                           
                         and the updated fitting curve is 
                           
                              
                                 
                                    
                                       
                                          f
                                       
                                    
                                    
                                       ˜
                                    
                                 
                                 
                                    (
                                    s
                                    )
                                 
                                 =
                                 
                                    f
                                 
                                 
                                    (
                                    δ
                                    
                                       c
                                    
                                    ;
                                    s
                                    )
                                 
                                 =
                                 
                                    B
                                 
                                 
                                    (
                                    s
                                    )
                                 
                                 
                                    (
                                    
                                       c
                                    
                                    +
                                    δ
                                    
                                       c
                                    
                                    )
                                 
                                 .
                              
                           
                         Then 
                           δ
                           
                              c
                           
                         should be solved from 
                           
                              (8)
                              
                                 
                                    
                                       min
                                    
                                    
                                       δ
                                       
                                          c
                                       
                                    
                                 
                                 
                                 F
                                 
                                    (
                                    δ
                                    
                                       c
                                    
                                    )
                                 
                                 =
                                 
                                    
                                       1
                                    
                                    
                                       2
                                    
                                 
                                 
                                    
                                       ∑
                                    
                                    
                                       k
                                       =
                                       1
                                    
                                    
                                       m
                                    
                                 
                                 
                                    
                                       d
                                    
                                    
                                       2
                                    
                                 
                                 
                                    (
                                    
                                       
                                          
                                             p
                                          
                                       
                                       
                                          k
                                       
                                    
                                    ,
                                    
                                       
                                          
                                             f
                                          
                                       
                                       
                                          ˜
                                       
                                    
                                    
                                       (
                                       s
                                       )
                                    
                                    )
                                 
                                 +
                                 λ
                                 η
                                 .
                              
                           
                         The smooth function 
                           η
                         can be designed according to different demands. For instance, it can be taken as the arc length 
                           ∫
                           
                              
                                 
                                    ‖
                                    
                                       
                                          
                                             
                                                
                                                   f
                                                
                                             
                                             
                                                ˜
                                             
                                          
                                       
                                       
                                          ′
                                       
                                    
                                    
                                       (
                                       s
                                       )
                                    
                                    ‖
                                 
                              
                              
                                 2
                              
                           
                           d
                           s
                         for geodesic fitting or the simplified plate energy 
                           ∫
                           
                              
                                 
                                    ‖
                                    
                                       
                                          
                                             
                                                
                                                   f
                                                
                                             
                                             
                                                ˜
                                             
                                          
                                       
                                       
                                          ″
                                       
                                    
                                    
                                       (
                                       s
                                       )
                                    
                                    ‖
                                 
                              
                              
                                 2
                              
                           
                           d
                           s
                         for general smooth curve fitting  [23]. Here we use the latter one, 
                           
                              
                                 η
                                 =
                                 ∫
                                 
                                    
                                       
                                          ‖
                                          
                                             
                                                
                                                   
                                                      
                                                         f
                                                      
                                                   
                                                   
                                                      ˜
                                                   
                                                
                                             
                                             
                                                ″
                                             
                                          
                                          
                                             (
                                             s
                                             )
                                          
                                          ‖
                                       
                                    
                                    
                                       2
                                    
                                 
                                 d
                                 s
                                 =
                                 
                                    
                                       
                                          (
                                          
                                             c
                                          
                                          +
                                          δ
                                          
                                             c
                                          
                                          )
                                       
                                    
                                    
                                       T
                                    
                                 
                                 
                                    (
                                    ∫
                                    
                                       
                                          
                                             B
                                          
                                       
                                       
                                          ″
                                       
                                    
                                    
                                       
                                          
                                             (
                                             s
                                             )
                                          
                                       
                                       
                                          T
                                       
                                    
                                    
                                       
                                          
                                             B
                                          
                                       
                                       
                                          ″
                                       
                                    
                                    
                                       (
                                       s
                                       )
                                    
                                    d
                                    s
                                    )
                                 
                                 
                                    (
                                    
                                       c
                                    
                                    +
                                    δ
                                    
                                       c
                                    
                                    )
                                 
                                 .
                              
                           
                         The weight 
                           λ
                         is set to control the curve shape, and it can be determined by the users and we just select a fixed value in our experiments. The unknown distance 
                           d
                           
                              (
                              
                                 
                                    
                                       p
                                    
                                 
                                 
                                    k
                                 
                              
                              ,
                              
                                 
                                    
                                       f
                                    
                                 
                                 
                                    ˜
                                 
                              
                              
                                 (
                                 s
                                 )
                              
                              )
                           
                         between 
                           
                              
                                 
                                    p
                                 
                              
                              
                                 k
                              
                           
                         and 
                           
                              
                                 
                                    f
                                 
                              
                              
                                 ˜
                              
                           
                           
                              (
                              s
                              )
                           
                         can be estimated by 
                           
                              
                                 
                                    p
                                 
                              
                              
                                 k
                              
                           
                         and 
                           
                              
                                 
                                    f
                                 
                              
                              
                                 ˜
                              
                           
                           
                              (
                              
                                 
                                    s
                                 
                                 
                                    k
                                 
                              
                              )
                           
                        . See  [5,6] for PDM, TDM and SDM of different estimation methods (see Fig. 1
                        ). We here apply SDM since it takes both computational efficiency and fitting effect into account. Then, the estimated distance is 
                           
                              (9)
                              
                                 
                                    
                                       d
                                    
                                    
                                       2
                                    
                                 
                                 
                                    (
                                    
                                       
                                          
                                             p
                                          
                                       
                                       
                                          k
                                       
                                    
                                    ,
                                    
                                       
                                          
                                             f
                                          
                                       
                                       
                                          ˜
                                       
                                    
                                    
                                       (
                                       s
                                       )
                                    
                                    )
                                 
                                 =
                                 
                                    {
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         d
                                                      
                                                      
                                                         k
                                                      
                                                   
                                                
                                                
                                                   
                                                      
                                                         d
                                                      
                                                      
                                                         k
                                                      
                                                   
                                                   −
                                                   
                                                      
                                                         ρ
                                                      
                                                      
                                                         k
                                                      
                                                   
                                                
                                             
                                             
                                                
                                                   
                                                      [
                                                      
                                                         
                                                            
                                                               (
                                                               
                                                                  
                                                                     
                                                                        p
                                                                     
                                                                  
                                                                  
                                                                     k
                                                                  
                                                               
                                                               −
                                                               
                                                                  
                                                                     
                                                                        f
                                                                     
                                                                  
                                                                  
                                                                     ˜
                                                                  
                                                               
                                                               
                                                                  (
                                                                  
                                                                     
                                                                        s
                                                                     
                                                                     
                                                                        k
                                                                     
                                                                  
                                                                  )
                                                               
                                                               )
                                                            
                                                         
                                                         
                                                            T
                                                         
                                                      
                                                      
                                                         
                                                            
                                                               T
                                                            
                                                         
                                                         
                                                            k
                                                         
                                                      
                                                      ]
                                                   
                                                
                                                
                                                   2
                                                
                                             
                                             +
                                             
                                                
                                                   
                                                      [
                                                      
                                                         
                                                            
                                                               (
                                                               
                                                                  
                                                                     
                                                                        p
                                                                     
                                                                  
                                                                  
                                                                     k
                                                                  
                                                               
                                                               −
                                                               
                                                                  
                                                                     
                                                                        f
                                                                     
                                                                  
                                                                  
                                                                     ˜
                                                                  
                                                               
                                                               
                                                                  (
                                                                  
                                                                     
                                                                        s
                                                                     
                                                                     
                                                                        k
                                                                     
                                                                  
                                                                  )
                                                               
                                                               )
                                                            
                                                         
                                                         
                                                            T
                                                         
                                                      
                                                      
                                                         
                                                            
                                                               N
                                                            
                                                         
                                                         
                                                            k
                                                         
                                                      
                                                      ]
                                                   
                                                
                                                
                                                   2
                                                
                                             
                                             ,
                                             
                                             
                                                
                                                   d
                                                
                                                
                                                   k
                                                
                                             
                                             <
                                             0
                                             ;
                                          
                                       
                                       
                                          
                                             
                                                
                                                   
                                                      [
                                                      
                                                         
                                                            
                                                               (
                                                               
                                                                  
                                                                     
                                                                        p
                                                                     
                                                                  
                                                                  
                                                                     k
                                                                  
                                                               
                                                               −
                                                               
                                                                  
                                                                     
                                                                        f
                                                                     
                                                                  
                                                                  
                                                                     ˜
                                                                  
                                                               
                                                               
                                                                  (
                                                                  
                                                                     
                                                                        s
                                                                     
                                                                     
                                                                        k
                                                                     
                                                                  
                                                                  )
                                                               
                                                               )
                                                            
                                                         
                                                         
                                                            T
                                                         
                                                      
                                                      
                                                         
                                                            
                                                               N
                                                            
                                                         
                                                         
                                                            k
                                                         
                                                      
                                                      ]
                                                   
                                                
                                                
                                                   2
                                                
                                             
                                             ,
                                             
                                             0
                                             ≤
                                             
                                                
                                                   d
                                                
                                                
                                                   k
                                                
                                             
                                             <
                                             
                                                
                                                   ρ
                                                
                                                
                                                   k
                                                
                                             
                                             ,
                                          
                                       
                                    
                                 
                              
                           
                         where 
                           
                              
                                 
                                    T
                                 
                              
                              
                                 k
                              
                           
                           ,
                           
                           
                              
                                 
                                    N
                                 
                              
                              
                                 k
                              
                           
                         and 
                           
                              
                                 ρ
                              
                              
                                 k
                              
                           
                         are unit tangent vector, unit normal vector and radius of curvature of curve 
                           
                              f
                           
                           
                              (
                              s
                              )
                           
                         at 
                           s
                           =
                           
                              
                                 s
                              
                              
                                 k
                              
                           
                        , respectively, and 
                           
                              |
                              
                                 
                                    d
                                 
                                 
                                    k
                                 
                              
                              |
                           
                           =
                           
                              ‖
                              
                                 
                                    
                                       p
                                    
                                 
                                 
                                    k
                                 
                              
                              −
                              
                                 f
                              
                              
                                 (
                                 
                                    
                                       s
                                    
                                    
                                       k
                                    
                                 
                                 )
                              
                              ‖
                           
                        . Note that 
                           
                              
                                 d
                              
                              
                                 k
                              
                           
                           >
                           0
                         if 
                           
                              
                                 
                                    p
                                 
                              
                              
                                 k
                              
                           
                         and the curvature center of 
                           
                              f
                           
                           
                              (
                              
                                 
                                    s
                                 
                                 
                                    k
                                 
                              
                              )
                           
                         are on the same side of 
                           f
                           
                              (
                              s
                              )
                           
                        ; otherwise, 
                           
                              
                                 d
                              
                              
                                 k
                              
                           
                           <
                           0
                        . The distance (9) is exact if there is no perturbation, i.e., 
                           
                              
                                 
                                    f
                                 
                              
                              
                                 ˜
                              
                           
                           
                              (
                              s
                              )
                           
                           =
                           
                              f
                           
                           
                              (
                              s
                              )
                           
                        .

By (8) and (9), one can solve for 
                           δ
                           
                              c
                           
                         from a quadratic programming problem without constraints. We summarize the above discussion as the general B-spline curve fitting process:
                           
                              1.
                              Compute an initial B-spline curve 
                                    
                                       
                                          
                                             f
                                          
                                       
                                       
                                          0
                                       
                                    
                                    
                                       (
                                       s
                                       )
                                    
                                    =
                                    
                                       B
                                    
                                    
                                       (
                                       s
                                       )
                                    
                                    
                                       
                                          
                                             c
                                          
                                       
                                       
                                          0
                                       
                                    
                                  for the points 
                                    
                                       
                                          
                                             p
                                          
                                       
                                       
                                          k
                                       
                                    
                                    ,
                                    
                                    k
                                    =
                                    1
                                    ,
                                    …
                                    ,
                                    m
                                 .

Find the nearest foot point 
                                    
                                       
                                          
                                             f
                                          
                                       
                                       
                                          r
                                       
                                    
                                    
                                       (
                                       
                                          
                                             s
                                          
                                          
                                             k
                                          
                                       
                                       )
                                    
                                  in the current curve 
                                    
                                       
                                          
                                             f
                                          
                                       
                                       
                                          r
                                       
                                    
                                    
                                       (
                                       s
                                       )
                                    
                                  for the point 
                                    
                                       
                                          
                                             p
                                          
                                       
                                       
                                          k
                                       
                                    
                                 , and compute the estimated distance by (9).

Solve (8) for 
                                    δ
                                    
                                       
                                          
                                             c
                                          
                                       
                                       
                                          r
                                       
                                    
                                  and update the current curve by 
                                    
                                       
                                          
                                             f
                                          
                                       
                                       
                                          r
                                          +
                                          1
                                       
                                    
                                    
                                       (
                                       s
                                       )
                                    
                                    =
                                    
                                       B
                                    
                                    
                                       (
                                       s
                                       )
                                    
                                    
                                       (
                                       
                                          
                                             
                                                c
                                             
                                          
                                          
                                             r
                                          
                                       
                                       +
                                       δ
                                       
                                          
                                             
                                                c
                                             
                                          
                                          
                                             r
                                          
                                       
                                       )
                                    
                                 . If 
                                    
                                       
                                          
                                             f
                                          
                                       
                                       
                                          r
                                          +
                                          1
                                       
                                    
                                    
                                       (
                                       s
                                       )
                                    
                                  satisfies the precondition (e.g. error bound or maximum iteration), output it. Otherwise, go step 2.

We solve the optimization problem given in (2) following the classic routine for point set fitting given at the end of Section  2.2. Three key points for consideration here: the initial curve fitting, the distance computation, and the foot-point location (i.e., to solve for 
                        δ
                        
                           
                              
                                 c
                              
                           
                           
                              r
                           
                        
                     ).

Let 
                           
                              
                                 
                                    p
                                 
                              
                              
                                 k
                              
                           
                           ,
                           
                           k
                           =
                           1
                           ,
                           …
                           ,
                           m
                         be given CNC points. To avoid fitting along straight lines or losing sharp geometry features, we first segment the data by long-line segment detection and extreme discrete curvature detection  [21,24]. Then for each segmented CNC point set, we select those feature points with large discrete curvatures and force the fitting curve to pass these feature points.  [21] shows that proper selection of feature points can reduce curve fluctuations and preserve the expected features at the same time.

For the long-line segment detection, 
                           
                              
                                 
                                    p
                                 
                              
                              
                                 k
                              
                           
                           
                              
                                 
                                    p
                                 
                              
                              
                                 k
                                 +
                                 1
                              
                           
                         is set to be a long line segment if 
                           
                              
                                 L
                              
                              
                                 k
                              
                           
                           =
                           
                              ‖
                              
                                 
                                    
                                       p
                                    
                                 
                                 
                                    k
                                 
                              
                              −
                              
                                 
                                    
                                       p
                                    
                                 
                                 
                                    k
                                    +
                                    1
                                 
                              
                              ‖
                           
                         is greater than a threshold value 
                           
                              
                                 L
                              
                              
                                 
                                    max
                                 
                              
                           
                        . For the extreme discrete curvature detection, we compute the discrete curvature of each point 
                           
                              
                                 
                                    p
                                 
                              
                              
                                 k
                              
                           
                         by the following formula  [25]. 
                           
                              (10)
                              
                                 
                                    
                                       K
                                    
                                    
                                       k
                                    
                                 
                                 =
                                 
                                    
                                       2
                                       △
                                       
                                          
                                             
                                                p
                                             
                                          
                                          
                                             k
                                             −
                                             1
                                          
                                       
                                       
                                          
                                             
                                                p
                                             
                                          
                                          
                                             k
                                          
                                       
                                       
                                          
                                             
                                                p
                                             
                                          
                                          
                                             k
                                             +
                                             1
                                          
                                       
                                    
                                    
                                       
                                          
                                             L
                                          
                                          
                                             k
                                             −
                                             1
                                          
                                       
                                       
                                          
                                             L
                                          
                                          
                                             k
                                          
                                       
                                       
                                          ‖
                                          
                                             
                                                
                                                   p
                                                
                                             
                                             
                                                k
                                                −
                                                1
                                             
                                          
                                          −
                                          
                                             
                                                
                                                   p
                                                
                                             
                                             
                                                k
                                                +
                                                1
                                             
                                          
                                          ‖
                                       
                                    
                                 
                                 =
                                 
                                    sgn
                                 
                                 
                                    (
                                    △
                                    
                                       
                                          
                                             p
                                          
                                       
                                       
                                          k
                                          −
                                          1
                                       
                                    
                                    
                                       
                                          
                                             p
                                          
                                       
                                       
                                          k
                                       
                                    
                                    
                                       
                                          
                                             p
                                          
                                       
                                       
                                          k
                                          +
                                          1
                                       
                                    
                                    )
                                 
                                 
                                    
                                       2
                                       sin
                                       
                                          
                                             α
                                          
                                          
                                             k
                                          
                                       
                                    
                                    
                                       
                                          ‖
                                          
                                             
                                                
                                                   p
                                                
                                             
                                             
                                                k
                                                −
                                                1
                                             
                                          
                                          −
                                          
                                             
                                                
                                                   p
                                                
                                             
                                             
                                                k
                                                +
                                                1
                                             
                                          
                                          ‖
                                       
                                    
                                 
                                 ,
                              
                           
                         where 
                           △
                           
                              
                                 
                                    p
                                 
                              
                              
                                 k
                                 −
                                 1
                              
                           
                           
                              
                                 
                                    p
                                 
                              
                              
                                 k
                              
                           
                           
                              
                                 
                                    p
                                 
                              
                              
                                 k
                                 +
                                 1
                              
                           
                         is the signed area of triangle, and 
                           
                              
                                 α
                              
                              
                                 k
                              
                           
                         is angle of 
                           
                              
                                 
                                    
                                       
                                          p
                                       
                                    
                                    
                                       k
                                       −
                                       1
                                    
                                 
                                 
                                    
                                       
                                          p
                                       
                                    
                                    
                                       k
                                    
                                 
                              
                              
                                 ⃗
                              
                           
                         and 
                           
                              
                                 
                                    
                                       
                                          p
                                       
                                    
                                    
                                       k
                                    
                                 
                                 
                                    
                                       
                                          p
                                       
                                    
                                    
                                       k
                                       +
                                       1
                                    
                                 
                              
                              
                                 ⃗
                              
                           
                        . Similarly, 
                           
                              
                                 
                                    p
                                 
                              
                              
                                 k
                              
                           
                         is set as segment point if its curvature 
                           
                              |
                              
                                 
                                    K
                                 
                                 
                                    k
                                 
                              
                              |
                           
                         is larger than a threshold value 
                           
                              
                                 K
                              
                              
                                 
                                    max
                                 
                              
                           
                        .

In the following, we assume that the data under investigation has already been segmented and inner feature points on the current segment are already computed  [21].

To fit data with a degree 
                           k
                         open curve, we usually fix the start and end control points and associate them with knots of multiplicity 
                           k
                           +
                           1
                        . Knots determination is key to the fitting effect. For example, the knots are automatically determined according to the discrete curvatures of data points in  [26], and by the dominant points in  [27]. In this paper, we compute the initial curve with an adaptive method  [21]. The parameter value 
                           
                              
                                 s
                              
                              
                                 k
                              
                           
                         for 
                           
                              
                                 
                                    p
                                 
                              
                              
                                 k
                              
                           
                         is computed using the approximate arc length 
                           
                              
                                 
                                    
                                       s
                                    
                                    
                                       k
                                    
                                 
                                 =
                                 
                                    
                                       ∑
                                    
                                    
                                       i
                                       =
                                       1
                                    
                                    
                                       k
                                       −
                                       1
                                    
                                 
                                 
                                    
                                       L
                                    
                                    
                                       i
                                    
                                 
                                 /
                                 
                                    
                                       ∑
                                    
                                    
                                       i
                                       =
                                       1
                                    
                                    
                                       m
                                       −
                                       1
                                    
                                 
                                 
                                    
                                       L
                                    
                                    
                                       i
                                    
                                 
                                 .
                              
                           
                         Then one can get an initial quadratic B-spline curve interpolating the inner feature points.

The confined error analysis is based on the distance computation of polyline and B-spline curve. Let 
                           P
                           =
                           
                              {
                              
                                 
                                    
                                       p
                                    
                                 
                                 
                                    k
                                 
                              
                              ∈
                              
                                 
                                    R
                                 
                                 
                                    2
                                 
                              
                              ,
                              
                              k
                              =
                              1
                              ,
                              …
                              ,
                              m
                              }
                           
                         be an ordered point set which defines a polyline. Let 
                           
                              f
                           
                           
                              (
                              s
                              )
                           
                         be a quadratic B-spline curve and 
                           
                              f
                           
                           
                              (
                              
                                 
                                    s
                                 
                                 
                                    k
                                 
                              
                              )
                           
                         be the foot point of 
                           
                              
                                 
                                    p
                                 
                              
                              
                                 k
                              
                           
                         on 
                           
                              f
                           
                           
                              (
                              s
                              )
                           
                        . Denote the distance from 
                           
                              
                                 
                                    p
                                 
                              
                              
                                 k
                              
                           
                         to 
                           
                              f
                           
                           
                              (
                              s
                              )
                           
                         by 
                           
                              
                                 d
                              
                              
                                 k
                              
                           
                           =
                           
                              ‖
                              
                                 f
                              
                              
                                 (
                                 
                                    
                                       s
                                    
                                    
                                       k
                                    
                                 
                                 )
                              
                              −
                              
                                 
                                    
                                       p
                                    
                                 
                                 
                                    k
                                 
                              
                              ‖
                           
                        . The distance between the point 
                           
                              f
                           
                           
                              (
                              
                                 
                                    s
                                 
                                 
                                    0
                                 
                              
                              )
                           
                         and line segment 
                           
                              
                                 
                                    
                                       
                                          p
                                       
                                    
                                    
                                       k
                                    
                                 
                                 
                                    
                                       
                                          p
                                       
                                    
                                    
                                       k
                                       +
                                       1
                                    
                                 
                              
                              ¯
                           
                         can be defined as 
                           
                              (11)
                              
                                 
                                    
                                       d
                                    
                                    
                                       p
                                       ,
                                       k
                                    
                                 
                                 
                                    (
                                    
                                       
                                          s
                                       
                                       
                                          0
                                       
                                    
                                    )
                                 
                                 ≔
                                 
                                    {
                                    
                                       
                                          
                                             
                                                ‖
                                                
                                                   f
                                                
                                                
                                                   (
                                                   
                                                      
                                                         s
                                                      
                                                      
                                                         0
                                                      
                                                   
                                                   )
                                                
                                                −
                                                
                                                   
                                                      
                                                         p
                                                      
                                                   
                                                   
                                                      k
                                                   
                                                
                                                ‖
                                             
                                             ,
                                             
                                             if
                                             
                                             
                                                
                                                   
                                                      (
                                                      
                                                         
                                                            
                                                               p
                                                            
                                                         
                                                         
                                                            k
                                                            +
                                                            1
                                                         
                                                      
                                                      −
                                                      
                                                         
                                                            
                                                               p
                                                            
                                                         
                                                         
                                                            k
                                                         
                                                      
                                                      )
                                                   
                                                
                                                
                                                   T
                                                
                                             
                                             
                                                (
                                                
                                                   f
                                                
                                                
                                                   (
                                                   
                                                      
                                                         s
                                                      
                                                      
                                                         0
                                                      
                                                   
                                                   )
                                                
                                                −
                                                
                                                   
                                                      
                                                         p
                                                      
                                                   
                                                   
                                                      k
                                                   
                                                
                                                )
                                             
                                             ≤
                                             0
                                             ;
                                          
                                       
                                       
                                          
                                             
                                                ‖
                                                
                                                   f
                                                
                                                
                                                   (
                                                   
                                                      
                                                         s
                                                      
                                                      
                                                         0
                                                      
                                                   
                                                   )
                                                
                                                −
                                                
                                                   
                                                      
                                                         p
                                                      
                                                   
                                                   
                                                      k
                                                      +
                                                      1
                                                   
                                                
                                                ‖
                                             
                                             ,
                                             
                                             if
                                             
                                             
                                                
                                                   
                                                      (
                                                      
                                                         
                                                            
                                                               p
                                                            
                                                         
                                                         
                                                            k
                                                            +
                                                            1
                                                         
                                                      
                                                      −
                                                      
                                                         
                                                            
                                                               p
                                                            
                                                         
                                                         
                                                            k
                                                         
                                                      
                                                      )
                                                   
                                                
                                                
                                                   T
                                                
                                             
                                             
                                                (
                                                
                                                   f
                                                
                                                
                                                   (
                                                   
                                                      
                                                         s
                                                      
                                                      
                                                         0
                                                      
                                                   
                                                   )
                                                
                                                −
                                                
                                                   
                                                      
                                                         p
                                                      
                                                   
                                                   
                                                      k
                                                      +
                                                      1
                                                   
                                                
                                                )
                                             
                                             ≥
                                             0
                                             ;
                                          
                                       
                                       
                                          
                                             
                                                |
                                                
                                                   
                                                      
                                                         
                                                            
                                                               (
                                                               
                                                                  
                                                                     
                                                                        p
                                                                     
                                                                  
                                                                  
                                                                     k
                                                                     +
                                                                     1
                                                                  
                                                               
                                                               −
                                                               
                                                                  
                                                                     
                                                                        p
                                                                     
                                                                  
                                                                  
                                                                     k
                                                                  
                                                               
                                                               )
                                                            
                                                         
                                                         
                                                            T
                                                         
                                                      
                                                   
                                                   
                                                      
                                                         ‖
                                                         
                                                            
                                                               
                                                                  p
                                                               
                                                            
                                                            
                                                               k
                                                               +
                                                               1
                                                            
                                                         
                                                         −
                                                         
                                                            
                                                               
                                                                  p
                                                               
                                                            
                                                            
                                                               k
                                                            
                                                         
                                                         ‖
                                                      
                                                   
                                                
                                                J
                                                
                                                   (
                                                   
                                                      f
                                                   
                                                   
                                                      (
                                                      
                                                         
                                                            s
                                                         
                                                         
                                                            0
                                                         
                                                      
                                                      )
                                                   
                                                   −
                                                   
                                                      
                                                         
                                                            p
                                                         
                                                      
                                                      
                                                         k
                                                      
                                                   
                                                   )
                                                
                                                |
                                             
                                             ,
                                             
                                             otherwise ,
                                          
                                       
                                    
                                 
                              
                           
                         where 
                           J
                         is the rotation matrix by angle of 
                           π
                           /
                           2
                        .

The Hausdorff distance of the line segment 
                           
                              
                                 
                                    
                                       
                                          p
                                       
                                    
                                    
                                       k
                                    
                                 
                                 
                                    
                                       
                                          p
                                       
                                    
                                    
                                       k
                                       +
                                       1
                                    
                                 
                              
                              ¯
                           
                         and curve segment 
                           
                              
                                 
                                    
                                       
                                          f
                                       
                                    
                                    
                                       k
                                    
                                 
                                 
                                    
                                       
                                          f
                                       
                                    
                                    
                                       k
                                       +
                                       1
                                    
                                 
                              
                              
                                 ˜
                              
                           
                         is denoted by 
                           
                              
                                 d
                              
                              
                                 H
                                 ,
                                 k
                              
                           
                           =
                           
                              
                                 d
                              
                              
                                 H
                              
                           
                           
                              (
                              
                                 
                                    
                                       
                                          
                                             p
                                          
                                       
                                       
                                          k
                                       
                                    
                                    
                                       
                                          
                                             p
                                          
                                       
                                       
                                          k
                                          +
                                          1
                                       
                                    
                                 
                                 ¯
                              
                              ,
                              
                                 
                                    
                                       
                                          
                                             f
                                          
                                       
                                       
                                          k
                                       
                                    
                                    
                                       
                                          
                                             f
                                          
                                       
                                       
                                          k
                                          +
                                          1
                                       
                                    
                                 
                                 
                                    ˜
                                 
                              
                              )
                           
                        , where 
                           
                              
                                 
                                    f
                                 
                              
                              
                                 k
                              
                           
                           =
                           
                              f
                           
                           
                              (
                              
                                 
                                    s
                                 
                                 
                                    k
                                 
                              
                              )
                           
                         and 
                           
                              
                                 
                                    f
                                 
                              
                              
                                 k
                                 +
                                 1
                              
                           
                           =
                           
                              f
                           
                           
                              (
                              
                                 
                                    s
                                 
                                 
                                    k
                                    +
                                    1
                                 
                              
                              )
                           
                        . Then the distance of the polyline 
                           P
                         and 
                           
                              f
                           
                           
                              (
                              s
                              )
                           
                         is 
                           max
                           
                              {
                              
                                 
                                    d
                                 
                                 
                                    H
                                    ,
                                    k
                                 
                              
                              ,
                              
                              k
                              =
                              1
                              ,
                              …
                              ,
                              m
                              −
                              1
                              }
                           
                        . 
                           Lemma 1
                           
                              The Hausdorff distance is computed by
                              
                                 
                                    (12)
                                    
                                       
                                          
                                             d
                                          
                                          
                                             H
                                             ,
                                             k
                                          
                                       
                                       =
                                       max
                                       
                                          (
                                          
                                             {
                                             
                                                
                                                   d
                                                
                                                
                                                   k
                                                
                                             
                                             ,
                                             
                                                
                                                   d
                                                
                                                
                                                   k
                                                   +
                                                   1
                                                
                                             
                                             }
                                          
                                          ∪
                                          
                                             {
                                             
                                                |
                                                
                                                   
                                                      
                                                         
                                                            
                                                               (
                                                               
                                                                  
                                                                     
                                                                        p
                                                                     
                                                                  
                                                                  
                                                                     k
                                                                     +
                                                                     1
                                                                  
                                                               
                                                               −
                                                               
                                                                  
                                                                     
                                                                        p
                                                                     
                                                                  
                                                                  
                                                                     k
                                                                  
                                                               
                                                               )
                                                            
                                                         
                                                         
                                                            T
                                                         
                                                      
                                                   
                                                   
                                                      
                                                         ‖
                                                         
                                                            
                                                               
                                                                  p
                                                               
                                                            
                                                            
                                                               k
                                                               +
                                                               1
                                                            
                                                         
                                                         −
                                                         
                                                            
                                                               
                                                                  p
                                                               
                                                            
                                                            
                                                               k
                                                            
                                                         
                                                         ‖
                                                      
                                                   
                                                
                                                J
                                                
                                                   (
                                                   
                                                      f
                                                   
                                                   
                                                      (
                                                      s
                                                      )
                                                   
                                                   −
                                                   
                                                      
                                                         
                                                            p
                                                         
                                                      
                                                      
                                                         k
                                                      
                                                   
                                                   )
                                                
                                                |
                                             
                                             ∣
                                             s
                                             ∈
                                             
                                                [
                                                
                                                   
                                                      s
                                                   
                                                   
                                                      k
                                                   
                                                
                                                ,
                                                
                                                   
                                                      s
                                                   
                                                   
                                                      k
                                                      +
                                                      1
                                                   
                                                
                                                ]
                                             
                                             ,
                                             
                                                
                                                   
                                                      (
                                                      
                                                         
                                                            
                                                               p
                                                            
                                                         
                                                         
                                                            k
                                                            +
                                                            1
                                                         
                                                      
                                                      −
                                                      
                                                         
                                                            
                                                               p
                                                            
                                                         
                                                         
                                                            k
                                                         
                                                      
                                                      )
                                                   
                                                
                                                
                                                   T
                                                
                                             
                                             J
                                             
                                                
                                                   
                                                      f
                                                   
                                                
                                                
                                                   ′
                                                
                                             
                                             
                                                (
                                                s
                                                )
                                             
                                             =
                                             0
                                             ,
                                             
                                                
                                                   
                                                      (
                                                      
                                                         
                                                            
                                                               p
                                                            
                                                         
                                                         
                                                            k
                                                            +
                                                            1
                                                         
                                                      
                                                      −
                                                      
                                                         
                                                            
                                                               p
                                                            
                                                         
                                                         
                                                            k
                                                         
                                                      
                                                      )
                                                   
                                                
                                                
                                                   T
                                                
                                             
                                             
                                                (
                                                
                                                   f
                                                
                                                
                                                   (
                                                   s
                                                   )
                                                
                                                −
                                                
                                                   
                                                      
                                                         p
                                                      
                                                   
                                                   
                                                      k
                                                      +
                                                      1
                                                   
                                                
                                                )
                                             
                                             <
                                             0
                                             ,
                                             
                                                
                                                   
                                                      (
                                                      
                                                         
                                                            
                                                               p
                                                            
                                                         
                                                         
                                                            k
                                                            +
                                                            1
                                                         
                                                      
                                                      −
                                                      
                                                         
                                                            
                                                               p
                                                            
                                                         
                                                         
                                                            k
                                                         
                                                      
                                                      )
                                                   
                                                
                                                
                                                   T
                                                
                                             
                                             
                                                (
                                                
                                                   f
                                                
                                                
                                                   (
                                                   s
                                                   )
                                                
                                                −
                                                
                                                   
                                                      
                                                         p
                                                      
                                                   
                                                   
                                                      k
                                                   
                                                
                                                )
                                             
                                             >
                                             0
                                             }
                                          
                                          ∪
                                          
                                             {
                                             
                                                ‖
                                                
                                                   f
                                                
                                                
                                                   (
                                                   s
                                                   )
                                                
                                                −
                                                
                                                   
                                                      
                                                         p
                                                      
                                                   
                                                   
                                                      k
                                                   
                                                
                                                ‖
                                             
                                             ∣
                                             s
                                             ∈
                                             
                                                [
                                                
                                                   
                                                      s
                                                   
                                                   
                                                      k
                                                   
                                                
                                                ,
                                                
                                                   
                                                      s
                                                   
                                                   
                                                      k
                                                      +
                                                      1
                                                   
                                                
                                                ]
                                             
                                             ,
                                             
                                                
                                                   
                                                      (
                                                      
                                                         
                                                            
                                                               p
                                                            
                                                         
                                                         
                                                            k
                                                            +
                                                            1
                                                         
                                                      
                                                      −
                                                      
                                                         
                                                            
                                                               p
                                                            
                                                         
                                                         
                                                            k
                                                         
                                                      
                                                      )
                                                   
                                                
                                                
                                                   T
                                                
                                             
                                             
                                                (
                                                
                                                   f
                                                
                                                
                                                   (
                                                   s
                                                   )
                                                
                                                −
                                                
                                                   
                                                      
                                                         p
                                                      
                                                   
                                                   
                                                      k
                                                   
                                                
                                                )
                                             
                                             ≤
                                             0
                                             ,
                                             
                                                
                                                   
                                                      (
                                                      
                                                         f
                                                      
                                                      
                                                         (
                                                         s
                                                         )
                                                      
                                                      −
                                                      
                                                         
                                                            
                                                               p
                                                            
                                                         
                                                         
                                                            k
                                                         
                                                      
                                                      )
                                                   
                                                
                                                
                                                   T
                                                
                                             
                                             
                                                
                                                   
                                                      f
                                                   
                                                
                                                
                                                   ′
                                                
                                             
                                             
                                                (
                                                s
                                                )
                                             
                                             =
                                             0
                                             }
                                          
                                          ∪
                                          
                                             {
                                             
                                                ‖
                                                
                                                   f
                                                
                                                
                                                   (
                                                   s
                                                   )
                                                
                                                −
                                                
                                                   
                                                      
                                                         p
                                                      
                                                   
                                                   
                                                      k
                                                      +
                                                      1
                                                   
                                                
                                                ‖
                                             
                                             ∣
                                             s
                                             ∈
                                             
                                                [
                                                
                                                   
                                                      s
                                                   
                                                   
                                                      k
                                                   
                                                
                                                ,
                                                
                                                   
                                                      s
                                                   
                                                   
                                                      k
                                                      +
                                                      1
                                                   
                                                
                                                ]
                                             
                                             ,
                                             
                                                
                                                   
                                                      (
                                                      
                                                         
                                                            
                                                               p
                                                            
                                                         
                                                         
                                                            k
                                                            +
                                                            1
                                                         
                                                      
                                                      −
                                                      
                                                         
                                                            
                                                               p
                                                            
                                                         
                                                         
                                                            k
                                                         
                                                      
                                                      )
                                                   
                                                
                                                
                                                   T
                                                
                                             
                                             
                                                (
                                                
                                                   f
                                                
                                                
                                                   (
                                                   s
                                                   )
                                                
                                                −
                                                
                                                   
                                                      
                                                         p
                                                      
                                                   
                                                   
                                                      k
                                                      +
                                                      1
                                                   
                                                
                                                )
                                             
                                             ≥
                                             0
                                             ,
                                             
                                                
                                                   
                                                      (
                                                      
                                                         f
                                                      
                                                      
                                                         (
                                                         s
                                                         )
                                                      
                                                      −
                                                      
                                                         
                                                            
                                                               p
                                                            
                                                         
                                                         
                                                            k
                                                            +
                                                            1
                                                         
                                                      
                                                      )
                                                   
                                                
                                                
                                                   T
                                                
                                             
                                             
                                                
                                                   
                                                      f
                                                   
                                                
                                                
                                                   ′
                                                
                                             
                                             
                                                (
                                                s
                                                )
                                             
                                             =
                                             0
                                             }
                                          
                                          )
                                       
                                       .
                                    
                                 
                              
                           


                        
                           Proof
                           See Appendix A.□


                        
                           Remark 1
                           
                              Lemma 1 gives an explicit form of the Hausdorff distance between a given line segment and a curve segment (not necessarily quadratic), which helps check whether the fitting curve is within the confined error bound.

In practical fitting process, we need to use the distance constraints on the line segments and the curve segments 
                                 
                                    f
                                 
                                 
                                    (
                                    δ
                                    
                                       c
                                    
                                    ;
                                    s
                                    )
                                 
                               with undeterminate coefficients 
                                 
                                    c
                                 
                                 +
                                 δ
                                 
                                    c
                                 
                               (to be updated); however, we prefer not to use the distance given by Lemma 1 since it is too complicated. Fortunately, if the curve is quadratic, the distance constraints on the updating curve 
                                 
                                    f
                                 
                                 
                                    (
                                    δ
                                    
                                       c
                                    
                                    ;
                                    s
                                    )
                                 
                               and the line segments has a more compact form (see Lemma 2).

The constraints on distance between 
                           
                              
                                 
                                    p
                                 
                              
                              
                                 k
                              
                           
                         and 
                           
                              f
                           
                           
                              (
                              δ
                              
                                 c
                              
                              ;
                              s
                              )
                           
                         is constrained by 
                           
                              ‖
                              
                                 f
                              
                              
                                 (
                                 
                                    
                                       s
                                    
                                    
                                       k
                                    
                                 
                                 )
                              
                              −
                              
                                 
                                    
                                       p
                                    
                                 
                                 
                                    k
                                 
                              
                              ‖
                           
                           ≤
                           ε
                        , which can be approximated by SDM (9). In our implementation, the data has been segmented hence is without large curvature point. In this situation, SDM can be degenerated to TDM for approximation 
                           
                              (13)
                              
                                 
                                    
                                       d
                                    
                                    
                                       
                                          TD
                                       
                                    
                                 
                                 
                                    (
                                    
                                       
                                          
                                             p
                                          
                                       
                                       
                                          k
                                       
                                    
                                    ,
                                    
                                       f
                                    
                                    
                                       (
                                       δ
                                       
                                          c
                                       
                                       ;
                                       s
                                       )
                                    
                                    )
                                 
                                 =
                                 
                                    |
                                    
                                       
                                          
                                             (
                                             
                                                
                                                   
                                                      p
                                                   
                                                
                                                
                                                   k
                                                
                                             
                                             −
                                             
                                                f
                                             
                                             
                                                (
                                                δ
                                                
                                                   c
                                                
                                                ;
                                                s
                                                )
                                             
                                             )
                                          
                                       
                                       
                                          T
                                       
                                    
                                    
                                       
                                          
                                             N
                                          
                                       
                                       
                                          k
                                       
                                    
                                    |
                                 
                                 ,
                              
                           
                         where 
                           
                              
                                 
                                    N
                                 
                              
                              
                                 k
                              
                           
                         is the unit normal vector of 
                           
                              f
                           
                           
                              (
                              
                                 
                                    s
                                 
                                 
                                    k
                                 
                              
                              )
                           
                         associated with 
                           
                              
                                 
                                    p
                                 
                              
                              
                                 k
                              
                           
                        . Then the distance constraint 
                           
                              |
                              
                                 
                                    d
                                 
                                 
                                    
                                       TD
                                    
                                 
                              
                              
                                 (
                                 
                                    
                                       
                                          p
                                       
                                    
                                    
                                       k
                                    
                                 
                                 ,
                                 
                                    f
                                 
                                 
                                    (
                                    δ
                                    
                                       c
                                    
                                    ;
                                    s
                                    )
                                 
                                 )
                              
                              |
                           
                           ≤
                           ε
                         of 
                           
                              
                                 
                                    p
                                 
                              
                              
                                 k
                              
                           
                         and 
                           
                              f
                           
                           
                              (
                              δ
                              
                                 c
                              
                              ;
                              s
                              )
                           
                         is approximated by linear constraint 
                           
                              (14)
                              
                                 
                                    
                                       d
                                    
                                    
                                       k
                                    
                                 
                                 −
                                 ε
                                 ≤
                                 
                                    
                                       
                                          N
                                       
                                    
                                    
                                       k
                                    
                                    
                                       T
                                    
                                 
                                 
                                    B
                                 
                                 
                                    
                                       
                                          (
                                          
                                             
                                                s
                                             
                                             
                                                k
                                             
                                          
                                          )
                                       
                                    
                                    
                                       T
                                    
                                 
                                 δ
                                 
                                    c
                                 
                                 ≤
                                 
                                    
                                       d
                                    
                                    
                                       k
                                    
                                 
                                 +
                                 ε
                                 .
                              
                           
                        
                     

The quadratic B-spine 
                           
                              f
                           
                           
                              (
                              s
                              )
                           
                         is a piecewise continuous function, whose segment 
                           
                              
                                 
                                    f
                                 
                              
                              
                                 i
                              
                           
                           
                              (
                              s
                              )
                           
                         of the form (5) for the knot interval 
                           
                              [
                              
                                 
                                    τ
                                 
                                 
                                    i
                                 
                              
                              ,
                              
                                 
                                    τ
                                 
                                 
                                    i
                                    +
                                    1
                                 
                              
                              ]
                           
                         is determined by the control points 
                           
                              
                                 
                                    c
                                 
                              
                              
                                 i
                              
                           
                           ,
                           
                              
                                 
                                    c
                                 
                              
                              
                                 i
                                 −
                                 1
                              
                           
                           ,
                           
                              
                                 
                                    c
                                 
                              
                              
                                 i
                                 −
                                 2
                              
                           
                        . Since 
                           d
                           
                              (
                              
                                 
                                    
                                       f
                                    
                                 
                                 
                                    i
                                 
                              
                              
                                 (
                                 s
                                 )
                              
                              ,
                              
                                 
                                    
                                       p
                                    
                                 
                                 
                                    k
                                 
                              
                              
                                 
                                    
                                       p
                                    
                                 
                                 
                                    k
                                    +
                                    1
                                 
                              
                              )
                           
                           ≤
                           ε
                         for 
                           
                              
                                 
                                    f
                                 
                              
                              
                                 i
                              
                           
                           
                              (
                              s
                              )
                           
                           ,
                           s
                           ∈
                           
                              [
                              
                                 
                                    τ
                                 
                                 
                                    i
                                 
                              
                              ,
                              
                                 
                                    τ
                                 
                                 
                                    i
                                    +
                                    1
                                 
                              
                              ]
                           
                         and 
                           
                              
                                 
                                    
                                       
                                          p
                                       
                                    
                                    
                                       k
                                    
                                 
                                 
                                    
                                       
                                          p
                                       
                                    
                                    
                                       k
                                       +
                                       1
                                    
                                 
                              
                              ¯
                           
                        , the parameter 
                           s
                         then locates within 
                           
                              [
                              max
                              
                                 (
                                 
                                    
                                       s
                                    
                                    
                                       k
                                    
                                 
                                 ,
                                 
                                    
                                       τ
                                    
                                    
                                       i
                                    
                                 
                                 )
                              
                              ,
                              min
                              
                                 (
                                 
                                    
                                       s
                                    
                                    
                                       k
                                       +
                                       1
                                    
                                 
                                 ,
                                 
                                    
                                       τ
                                    
                                    
                                       i
                                       +
                                       1
                                    
                                 
                                 )
                              
                              ]
                           
                        . We now derive the explicit distance constraints for quadratic B-spline curves. 
                           Lemma 2
                           
                              For 
                              
                                 s
                                 ∈
                                 
                                    [
                                    max
                                    
                                       (
                                       
                                          
                                             s
                                          
                                          
                                             k
                                          
                                       
                                       ,
                                       
                                          
                                             τ
                                          
                                          
                                             i
                                          
                                       
                                       )
                                    
                                    ,
                                    min
                                    
                                       (
                                       
                                          
                                             s
                                          
                                          
                                             k
                                             +
                                             1
                                          
                                       
                                       ,
                                       
                                          
                                             τ
                                          
                                          
                                             i
                                             +
                                             1
                                          
                                       
                                       )
                                    
                                    ]
                                 
                              
                              , we have that
                              
                                 
                                    1.
                                    
                                       If there exists an 
                                       
                                          
                                             
                                                s
                                             
                                             
                                                m
                                             
                                          
                                        
                                       such that 
                                       
                                          
                                             
                                                
                                                   (
                                                   
                                                      f
                                                   
                                                   
                                                      (
                                                      
                                                         
                                                            s
                                                         
                                                         
                                                            m
                                                         
                                                      
                                                      )
                                                   
                                                   −
                                                   
                                                      
                                                         
                                                            p
                                                         
                                                      
                                                      
                                                         k
                                                      
                                                   
                                                   )
                                                
                                             
                                             
                                                T
                                             
                                          
                                          
                                             
                                                
                                                   f
                                                
                                             
                                             
                                                ′
                                             
                                          
                                          
                                             (
                                             
                                                
                                                   s
                                                
                                                
                                                   m
                                                
                                             
                                             )
                                          
                                          =
                                          0
                                        
                                       and 
                                       
                                          
                                             
                                                
                                                   (
                                                   
                                                      
                                                         
                                                            p
                                                         
                                                      
                                                      
                                                         k
                                                         +
                                                         1
                                                      
                                                   
                                                   −
                                                   
                                                      
                                                         
                                                            p
                                                         
                                                      
                                                      
                                                         k
                                                      
                                                   
                                                   )
                                                
                                             
                                             
                                                T
                                             
                                          
                                          
                                             (
                                             
                                                f
                                             
                                             
                                                (
                                                
                                                   
                                                      s
                                                   
                                                   
                                                      m
                                                   
                                                
                                                )
                                             
                                             −
                                             
                                                
                                                   
                                                      p
                                                   
                                                
                                                
                                                   k
                                                
                                             
                                             )
                                          
                                          ≤
                                          0
                                       
                                       , then the distance constraint is
                                       
                                          
                                             (15)
                                             
                                                
                                                   
                                                      
                                                         c
                                                      
                                                   
                                                   
                                                      T
                                                   
                                                
                                                
                                                   
                                                      
                                                         B
                                                      
                                                   
                                                   
                                                      T
                                                   
                                                
                                                
                                                   (
                                                   
                                                      
                                                         s
                                                      
                                                      
                                                         m
                                                      
                                                   
                                                   )
                                                
                                                
                                                   B
                                                
                                                
                                                   (
                                                   
                                                      
                                                         s
                                                      
                                                      
                                                         m
                                                      
                                                   
                                                   )
                                                
                                                
                                                   c
                                                
                                                −
                                                2
                                                
                                                   
                                                      
                                                         p
                                                      
                                                   
                                                   
                                                      k
                                                   
                                                   
                                                      T
                                                   
                                                
                                                
                                                   B
                                                
                                                
                                                   (
                                                   
                                                      
                                                         s
                                                      
                                                      
                                                         m
                                                      
                                                   
                                                   )
                                                
                                                
                                                   c
                                                
                                                +
                                                
                                                   
                                                      
                                                         p
                                                      
                                                   
                                                   
                                                      k
                                                   
                                                   
                                                      T
                                                   
                                                
                                                
                                                   
                                                      
                                                         p
                                                      
                                                   
                                                   
                                                      k
                                                   
                                                
                                                −
                                                
                                                   
                                                      ε
                                                   
                                                   
                                                      2
                                                   
                                                
                                                ≤
                                                0
                                                .
                                             
                                          
                                       
                                    


                                       If there exists an 
                                       
                                          
                                             
                                                s
                                             
                                             
                                                m
                                             
                                          
                                        
                                       such that 
                                       
                                          
                                             
                                                
                                                   (
                                                   
                                                      f
                                                   
                                                   
                                                      (
                                                      
                                                         
                                                            s
                                                         
                                                         
                                                            m
                                                         
                                                      
                                                      )
                                                   
                                                   −
                                                   
                                                      
                                                         
                                                            p
                                                         
                                                      
                                                      
                                                         k
                                                         +
                                                         1
                                                      
                                                   
                                                   )
                                                
                                             
                                             
                                                T
                                             
                                          
                                          
                                             
                                                
                                                   f
                                                
                                             
                                             
                                                ′
                                             
                                          
                                          
                                             (
                                             
                                                
                                                   s
                                                
                                                
                                                   m
                                                
                                             
                                             )
                                          
                                          =
                                          0
                                        
                                       and 
                                       
                                          
                                             
                                                
                                                   (
                                                   
                                                      
                                                         
                                                            p
                                                         
                                                      
                                                      
                                                         k
                                                         +
                                                         1
                                                      
                                                   
                                                   −
                                                   
                                                      
                                                         
                                                            p
                                                         
                                                      
                                                      
                                                         k
                                                      
                                                   
                                                   )
                                                
                                             
                                             
                                                T
                                             
                                          
                                          
                                             (
                                             
                                                f
                                             
                                             
                                                (
                                                
                                                   
                                                      s
                                                   
                                                   
                                                      m
                                                   
                                                
                                                )
                                             
                                             −
                                             
                                                
                                                   
                                                      p
                                                   
                                                
                                                
                                                   k
                                                   +
                                                   1
                                                
                                             
                                             )
                                          
                                          ≥
                                          0
                                       
                                       , then the distance constraint is
                                       
                                          
                                             (16)
                                             
                                                
                                                   
                                                      
                                                         c
                                                      
                                                   
                                                   
                                                      T
                                                   
                                                
                                                
                                                   
                                                      
                                                         B
                                                      
                                                   
                                                   
                                                      T
                                                   
                                                
                                                
                                                   (
                                                   
                                                      
                                                         s
                                                      
                                                      
                                                         m
                                                      
                                                   
                                                   )
                                                
                                                
                                                   B
                                                
                                                
                                                   (
                                                   
                                                      
                                                         s
                                                      
                                                      
                                                         m
                                                      
                                                   
                                                   )
                                                
                                                
                                                   c
                                                
                                                −
                                                2
                                                
                                                   
                                                      
                                                         p
                                                      
                                                   
                                                   
                                                      k
                                                      +
                                                      1
                                                   
                                                   
                                                      T
                                                   
                                                
                                                
                                                   B
                                                
                                                
                                                   (
                                                   
                                                      
                                                         s
                                                      
                                                      
                                                         m
                                                      
                                                   
                                                   )
                                                
                                                
                                                   c
                                                
                                                +
                                                
                                                   
                                                      
                                                         p
                                                      
                                                   
                                                   
                                                      k
                                                      +
                                                      1
                                                   
                                                   
                                                      T
                                                   
                                                
                                                
                                                   
                                                      
                                                         p
                                                      
                                                   
                                                   
                                                      k
                                                      +
                                                      1
                                                   
                                                
                                                −
                                                
                                                   
                                                      ε
                                                   
                                                   
                                                      2
                                                   
                                                
                                                ≤
                                                0
                                                .
                                             
                                          
                                       
                                    


                                       If there exists an 
                                       
                                          
                                             
                                                s
                                             
                                             
                                                m
                                             
                                          
                                        
                                       such that 
                                       
                                          
                                             
                                                
                                                   (
                                                   
                                                      
                                                         
                                                            p
                                                         
                                                      
                                                      
                                                         k
                                                         +
                                                         1
                                                      
                                                   
                                                   −
                                                   
                                                      
                                                         
                                                            p
                                                         
                                                      
                                                      
                                                         k
                                                      
                                                   
                                                   )
                                                
                                             
                                             
                                                T
                                             
                                          
                                          J
                                          
                                             
                                                
                                                   f
                                                
                                             
                                             
                                                ′
                                             
                                          
                                          
                                             (
                                             
                                                
                                                   s
                                                
                                                
                                                   m
                                                
                                             
                                             )
                                          
                                          =
                                          0
                                        
                                       and 
                                       
                                          
                                             
                                                
                                                   (
                                                   
                                                      
                                                         
                                                            p
                                                         
                                                      
                                                      
                                                         k
                                                         +
                                                         1
                                                      
                                                   
                                                   −
                                                   
                                                      
                                                         
                                                            p
                                                         
                                                      
                                                      
                                                         k
                                                      
                                                   
                                                   )
                                                
                                             
                                             
                                                T
                                             
                                          
                                          
                                             (
                                             
                                                f
                                             
                                             
                                                (
                                                
                                                   
                                                      s
                                                   
                                                   
                                                      m
                                                   
                                                
                                                )
                                             
                                             −
                                             
                                                
                                                   
                                                      p
                                                   
                                                
                                                
                                                   k
                                                   +
                                                   1
                                                
                                             
                                             )
                                          
                                          <
                                          0
                                          ,
                                          
                                          
                                             
                                                
                                                   (
                                                   
                                                      
                                                         
                                                            p
                                                         
                                                      
                                                      
                                                         k
                                                         +
                                                         1
                                                      
                                                   
                                                   −
                                                   
                                                      
                                                         
                                                            p
                                                         
                                                      
                                                      
                                                         k
                                                      
                                                   
                                                   )
                                                
                                             
                                             
                                                T
                                             
                                          
                                          
                                             (
                                             
                                                f
                                             
                                             
                                                (
                                                
                                                   
                                                      s
                                                   
                                                   
                                                      m
                                                   
                                                
                                                )
                                             
                                             −
                                             
                                                
                                                   
                                                      p
                                                   
                                                
                                                
                                                   k
                                                
                                             
                                             )
                                          
                                          >
                                          0
                                       
                                       , then the distance constraint is
                                       
                                          
                                             (17)
                                             
                                                
                                                   
                                                      
                                                         p
                                                      
                                                   
                                                   
                                                      k
                                                      +
                                                      1
                                                   
                                                   
                                                      T
                                                   
                                                
                                                J
                                                
                                                   
                                                      
                                                         p
                                                      
                                                   
                                                   
                                                      k
                                                   
                                                
                                                −
                                                ε
                                                
                                                   
                                                      L
                                                   
                                                   
                                                      k
                                                   
                                                
                                                ≤
                                                
                                                   
                                                      
                                                         (
                                                         
                                                            
                                                               
                                                                  p
                                                               
                                                            
                                                            
                                                               k
                                                               +
                                                               1
                                                            
                                                         
                                                         −
                                                         
                                                            
                                                               
                                                                  p
                                                               
                                                            
                                                            
                                                               k
                                                            
                                                         
                                                         )
                                                      
                                                   
                                                   
                                                      T
                                                   
                                                
                                                J
                                                
                                                   B
                                                
                                                
                                                   (
                                                   
                                                      
                                                         s
                                                      
                                                      
                                                         m
                                                      
                                                   
                                                   )
                                                
                                                
                                                   c
                                                
                                                ≤
                                                
                                                   
                                                      
                                                         p
                                                      
                                                   
                                                   
                                                      k
                                                      +
                                                      1
                                                   
                                                   
                                                      T
                                                   
                                                
                                                J
                                                
                                                   
                                                      
                                                         p
                                                      
                                                   
                                                   
                                                      k
                                                   
                                                
                                                +
                                                ε
                                                
                                                   
                                                      L
                                                   
                                                   
                                                      k
                                                   
                                                
                                                .
                                             
                                          
                                       
                                    


                        
                           Proof
                           See Appendix B.□


                        
                           Remark 2
                           Case 1 is degenerated to the greatest distance from 
                                 
                                    
                                       
                                          f
                                       
                                    
                                    
                                       i
                                    
                                 
                                 
                                    (
                                    s
                                    )
                                 
                               to 
                                 
                                    
                                       
                                          p
                                       
                                    
                                    
                                       k
                                    
                                 
                              , similarly for case 2. These two situations seldom occur in the practical experiments.

In Lemma 2, we give the constraints on distance between 
                           
                              
                                 
                                    f
                                 
                              
                              
                                 i
                              
                           
                           
                              (
                              s
                              )
                           
                         and 
                           
                              
                                 
                                    
                                       
                                          p
                                       
                                    
                                    
                                       k
                                    
                                 
                                 
                                    
                                       
                                          p
                                       
                                    
                                    
                                       k
                                       +
                                       1
                                    
                                 
                              
                              ¯
                           
                        . Similar as before, we shall approximate these distance constraints for the new curve 
                           
                              f
                           
                           
                              (
                              δ
                              
                                 c
                              
                              ;
                              s
                              )
                           
                         in the next iteration with control points 
                           
                              c
                           
                           +
                           δ
                           
                              c
                           
                        . Notice that the solution 
                           
                              
                                 s
                              
                              
                                 m
                              
                           
                         is associated with 
                           
                              c
                           
                        , but 
                           
                              
                                 s
                              
                              
                                 m
                              
                           
                           
                              (
                              
                                 c
                              
                              +
                              δ
                              
                                 c
                              
                              )
                           
                         is not explicit for 
                           
                              f
                           
                           
                              (
                              δ
                              
                                 c
                              
                              ;
                              s
                              )
                           
                         since 
                           δ
                           
                              c
                           
                         is unknown. A natural approximation is to replace 
                           
                              
                                 s
                              
                              
                                 m
                              
                           
                           
                              (
                              
                                 c
                              
                              +
                              δ
                              
                                 c
                              
                              )
                           
                         by 
                           
                              
                                 s
                              
                              
                                 m
                              
                           
                           
                              (
                              
                                 c
                              
                              )
                           
                        , then the constraints on distance between 
                           
                              
                                 
                                    f
                                 
                              
                              
                                 i
                              
                           
                           
                              (
                              δ
                              
                                 c
                              
                              ;
                              s
                              )
                           
                         and 
                           
                              
                                 
                                    
                                       
                                          p
                                       
                                    
                                    
                                       k
                                    
                                 
                                 
                                    
                                       
                                          p
                                       
                                    
                                    
                                       k
                                       +
                                       1
                                    
                                 
                              
                              ¯
                           
                         are quadratic polynomials of 
                           δ
                           
                              c
                           
                         for case 1 and case 2, but linear for case 3. Precisely, the linear approximations of the case 1, case 2 and case 3 can be proposed as follows (details refer to Appendix C). 
                           
                              
                                 (18)
                                 
                                    
                                       
                                          ∇
                                       
                                       
                                          
                                             c
                                          
                                       
                                    
                                    
                                       
                                          g
                                       
                                       
                                          1
                                       
                                    
                                    
                                       
                                          
                                             (
                                             
                                                c
                                             
                                             )
                                          
                                       
                                       
                                          T
                                       
                                    
                                    δ
                                    
                                       c
                                    
                                    ≤
                                    
                                       
                                          ε
                                       
                                       
                                          2
                                       
                                    
                                    −
                                    
                                       
                                          g
                                       
                                       
                                          1
                                       
                                    
                                    
                                       (
                                       
                                          c
                                       
                                       )
                                    
                                    ,
                                    
                                    
                                       
                                          ∇
                                       
                                       
                                          
                                             c
                                          
                                       
                                    
                                    
                                       
                                          g
                                       
                                       
                                          2
                                       
                                    
                                    
                                       
                                          
                                             (
                                             
                                                c
                                             
                                             )
                                          
                                       
                                       
                                          T
                                       
                                    
                                    δ
                                    
                                       c
                                    
                                    ≤
                                    
                                       
                                          ε
                                       
                                       
                                          2
                                       
                                    
                                    −
                                    
                                       
                                          g
                                       
                                       
                                          2
                                       
                                    
                                    
                                       (
                                       
                                          c
                                       
                                       )
                                    
                                    ,
                                 
                              
                              
                                 (19)
                                 
                                    
                                       
                                          
                                             p
                                          
                                       
                                       
                                          k
                                          +
                                          1
                                       
                                       
                                          T
                                       
                                    
                                    J
                                    
                                       
                                          
                                             p
                                          
                                       
                                       
                                          k
                                       
                                    
                                    −
                                    ε
                                    
                                       
                                          L
                                       
                                       
                                          k
                                       
                                    
                                    −
                                    
                                       
                                          g
                                       
                                       
                                          3
                                       
                                    
                                    
                                       (
                                       
                                          
                                             
                                                c
                                             
                                          
                                          
                                             0
                                          
                                       
                                       )
                                    
                                    ≤
                                    
                                       
                                          ∇
                                       
                                       
                                          
                                             c
                                          
                                       
                                    
                                    
                                       
                                          g
                                       
                                       
                                          3
                                       
                                    
                                    
                                       
                                          
                                             (
                                             
                                                
                                                   
                                                      c
                                                   
                                                
                                                
                                                   0
                                                
                                             
                                             )
                                          
                                       
                                       
                                          T
                                       
                                    
                                    δ
                                    
                                       c
                                    
                                    ≤
                                    
                                       
                                          
                                             p
                                          
                                       
                                       
                                          k
                                          +
                                          1
                                       
                                       
                                          T
                                       
                                    
                                    J
                                    
                                       
                                          
                                             p
                                          
                                       
                                       
                                          k
                                       
                                    
                                    +
                                    ε
                                    
                                       
                                          L
                                       
                                       
                                          k
                                       
                                    
                                    −
                                    
                                       
                                          g
                                       
                                       
                                          3
                                       
                                    
                                    
                                       (
                                       
                                          
                                             
                                                c
                                             
                                          
                                          
                                             0
                                          
                                       
                                       )
                                    
                                    ,
                                 
                              
                           
                         where 
                           
                              
                                 ∇
                              
                              
                                 
                                    c
                                 
                              
                           
                         is the gradient with respect to 
                           
                              c
                           
                        .

Now we are ready to give the curve fitting algorithm with confined error. 
                           Algorithm 1
                           Curve fitting algorithm


                              Input: The G01 points 
                                 
                                    
                                       
                                          p
                                       
                                    
                                    
                                       k
                                    
                                 
                                 ,
                                 
                                 k
                                 =
                                 1
                                 ,
                                 …
                                 ,
                                 m
                               which can be approximated by a quadratic B-spline and the error bound 
                                 ε
                              .


                              Output: The quadratic B-spline with confined error 
                                 
                                    1.
                                    For the given points 
                                          
                                             
                                                
                                                   p
                                                
                                             
                                             
                                                k
                                             
                                          
                                          ,
                                          
                                          k
                                          =
                                          1
                                          ,
                                          …
                                          ,
                                          m
                                       , by the adaptive feature points selecting method, find an initial quadratic B-spline curve 
                                          
                                             
                                                
                                                   f
                                                
                                             
                                             
                                                0
                                             
                                          
                                          
                                             (
                                             s
                                             )
                                          
                                          =
                                          
                                             B
                                          
                                          
                                             (
                                             s
                                             )
                                          
                                          
                                             
                                                
                                                   c
                                                
                                             
                                             
                                                0
                                             
                                          
                                        using chord length parameter  [21]. Let 
                                          r
                                          =
                                          0
                                       .

Find the nearest foot point 
                                          
                                             
                                                
                                                   f
                                                
                                             
                                             
                                                r
                                             
                                          
                                          
                                             (
                                             
                                                
                                                   s
                                                
                                                
                                                   k
                                                
                                             
                                             )
                                          
                                        of 
                                          
                                             
                                                
                                                   f
                                                
                                             
                                             
                                                r
                                             
                                          
                                          
                                             (
                                             s
                                             )
                                          
                                        for each 
                                          
                                             
                                                
                                                   p
                                                
                                             
                                             
                                                k
                                             
                                          
                                       , and compute the distance using (9).

Let 
                                          U
                                          =
                                          ∅
                                       , for each line segment 
                                          
                                             
                                                
                                                   
                                                      
                                                         p
                                                      
                                                   
                                                   
                                                      k
                                                   
                                                
                                                
                                                   
                                                      
                                                         p
                                                      
                                                   
                                                   
                                                      k
                                                      +
                                                      1
                                                   
                                                
                                             
                                             ¯
                                          
                                       , if 
                                          
                                             [
                                             
                                                
                                                   τ
                                                
                                                
                                                   i
                                                
                                             
                                             ,
                                             
                                                
                                                   τ
                                                
                                                
                                                   i
                                                   +
                                                   1
                                                
                                             
                                             ]
                                          
                                          ∩
                                          
                                             [
                                             
                                                
                                                   s
                                                
                                                
                                                   k
                                                
                                             
                                             ,
                                             
                                                
                                                   s
                                                
                                                
                                                   k
                                                   +
                                                   1
                                                
                                             
                                             ]
                                          
                                          ≠
                                          ∅
                                        and there exists an 
                                          
                                             
                                                s
                                             
                                             
                                                m
                                             
                                          
                                        in Lemma 2, then 
                                          U
                                          =
                                          U
                                          ∪
                                          
                                             {
                                             
                                                (
                                                k
                                                ,
                                                i
                                                )
                                             
                                             }
                                          
                                       . If 
                                          
                                             |
                                             
                                                
                                                   d
                                                
                                                
                                                   H
                                                
                                             
                                             
                                                (
                                                
                                                   
                                                      
                                                         f
                                                      
                                                   
                                                   
                                                      i
                                                   
                                                   
                                                      r
                                                   
                                                
                                                
                                                   (
                                                   s
                                                   )
                                                
                                                ,
                                                
                                                   
                                                      
                                                         p
                                                      
                                                   
                                                   
                                                      k
                                                   
                                                
                                                
                                                   
                                                      
                                                         p
                                                      
                                                   
                                                   
                                                      k
                                                      +
                                                      1
                                                   
                                                
                                                )
                                             
                                             |
                                          
                                          ≤
                                          ε
                                          ,
                                          
                                          ∀
                                          
                                             (
                                             k
                                             ,
                                             i
                                             )
                                          
                                          ∈
                                          U
                                        and 
                                          
                                             ‖
                                             
                                                
                                                   
                                                      f
                                                   
                                                
                                                
                                                   r
                                                
                                             
                                             
                                                (
                                                
                                                   
                                                      s
                                                   
                                                   
                                                      k
                                                   
                                                
                                                )
                                             
                                             −
                                             
                                                
                                                   
                                                      p
                                                   
                                                
                                                
                                                   k
                                                
                                             
                                             ‖
                                          
                                          ≤
                                          ε
                                          ,
                                          
                                          k
                                          =
                                          1
                                          ,
                                          …
                                          ,
                                          m
                                       , output 
                                          
                                             
                                                
                                                   f
                                                
                                             
                                             
                                                r
                                             
                                          
                                          
                                             (
                                             s
                                             )
                                          
                                       .

Optimize the distance between curve and line segments by solving the following optimization problem with constraints (14), (18) and (19), 
                                          
                                             
                                                
                                                   
                                                      
                                                         min
                                                      
                                                      
                                                         δ
                                                         
                                                            c
                                                         
                                                      
                                                   
                                                   
                                                   F
                                                   =
                                                   
                                                      
                                                         1
                                                      
                                                      
                                                         2
                                                      
                                                   
                                                   
                                                      [
                                                      
                                                         
                                                            ∑
                                                         
                                                         
                                                            k
                                                            =
                                                            1
                                                         
                                                         
                                                            m
                                                         
                                                      
                                                      
                                                         
                                                            d
                                                         
                                                         
                                                            2
                                                         
                                                      
                                                      
                                                         (
                                                         
                                                            
                                                               
                                                                  p
                                                               
                                                            
                                                            
                                                               k
                                                            
                                                         
                                                         ,
                                                         
                                                            
                                                               
                                                                  f
                                                               
                                                            
                                                            
                                                               r
                                                               +
                                                               1
                                                            
                                                         
                                                         
                                                            (
                                                            s
                                                            )
                                                         
                                                         )
                                                      
                                                      +
                                                      
                                                         
                                                            ∑
                                                         
                                                         
                                                            
                                                               (
                                                               k
                                                               ,
                                                               i
                                                               )
                                                            
                                                            ∈
                                                            U
                                                         
                                                      
                                                      
                                                         
                                                            d
                                                         
                                                         
                                                            2
                                                         
                                                      
                                                      
                                                         (
                                                         
                                                            
                                                               
                                                                  f
                                                               
                                                            
                                                            
                                                               i
                                                            
                                                            
                                                               r
                                                               +
                                                               1
                                                            
                                                         
                                                         
                                                            (
                                                            s
                                                            )
                                                         
                                                         ,
                                                         
                                                            
                                                               
                                                                  p
                                                               
                                                            
                                                            
                                                               k
                                                            
                                                         
                                                         
                                                            
                                                               
                                                                  p
                                                               
                                                            
                                                            
                                                               k
                                                               +
                                                               1
                                                            
                                                         
                                                         )
                                                      
                                                      ]
                                                   
                                                   +
                                                   λ
                                                   η
                                                
                                             
                                             
                                                (20)
                                                
                                                   s.t.
                                                   
                                                   
                                                      
                                                         d
                                                      
                                                      
                                                         
                                                            TD
                                                         
                                                      
                                                   
                                                   
                                                      (
                                                      
                                                         
                                                            
                                                               p
                                                            
                                                         
                                                         
                                                            k
                                                         
                                                      
                                                      ,
                                                      
                                                         
                                                            
                                                               f
                                                            
                                                         
                                                         
                                                            r
                                                            +
                                                            1
                                                         
                                                      
                                                      
                                                         (
                                                         s
                                                         )
                                                      
                                                      )
                                                   
                                                   ≤
                                                   ε
                                                   ,
                                                   
                                                   k
                                                   =
                                                   1
                                                   ,
                                                   …
                                                   ,
                                                   m
                                                   ;
                                                
                                             
                                             
                                                
                                                   d
                                                   
                                                      (
                                                      
                                                         
                                                            
                                                               f
                                                            
                                                         
                                                         
                                                            i
                                                         
                                                         
                                                            r
                                                            +
                                                            1
                                                         
                                                      
                                                      
                                                         (
                                                         s
                                                         )
                                                      
                                                      ,
                                                      
                                                         
                                                            
                                                               p
                                                            
                                                         
                                                         
                                                            k
                                                         
                                                      
                                                      
                                                         
                                                            
                                                               p
                                                            
                                                         
                                                         
                                                            k
                                                            +
                                                            1
                                                         
                                                      
                                                      )
                                                   
                                                   ≤
                                                   ε
                                                   ,
                                                   
                                                   ∀
                                                   
                                                      (
                                                      k
                                                      ,
                                                      i
                                                      )
                                                   
                                                   ∈
                                                   U
                                                   .
                                                
                                             
                                          
                                        Find the solution 
                                          δ
                                          
                                             
                                                
                                                   c
                                                
                                             
                                             
                                                r
                                             
                                          
                                        and update the curve by 
                                          
                                             
                                                
                                                   f
                                                
                                             
                                             
                                                r
                                                +
                                                1
                                             
                                          
                                          
                                             (
                                             s
                                             )
                                          
                                          =
                                          
                                             B
                                          
                                          
                                             (
                                             s
                                             )
                                          
                                          
                                             (
                                             
                                                
                                                   
                                                      c
                                                   
                                                
                                                
                                                   r
                                                
                                             
                                             +
                                             δ
                                             
                                                
                                                   
                                                      c
                                                   
                                                
                                                
                                                   r
                                                
                                             
                                             )
                                          
                                          ,
                                          r
                                          =
                                          r
                                          +
                                          1
                                       , then go to step 2.


                        
                           Remark 3
                           In Step 3, we check the Hausdorff distance by Lemma 1, to guarantee the confined error. In Step 4, the optimization problem (2) is simplified for quadratic curve (see Lemma 2).

For spline curves of degree higher than two, Lemma 2 does not hold, then an important task is to simplify and solve the optimization problem in Step 4.

To solve the problem given in (2), another way is to discretize the boundary of the “band” and then set the discretized points as obstacles to replace the Hausdorff distance condition. This can be done by Flöry’s method  [7].

Let 
                        d
                        
                           (
                           
                              
                                 
                                    u
                                 
                              
                              
                                 j
                              
                           
                           ,
                           
                              f
                           
                           
                              (
                              s
                              )
                           
                           )
                        
                      be the directed distance from 
                        
                           
                              
                                 u
                              
                           
                           
                              j
                           
                        
                      to 
                        
                           f
                        
                        
                           (
                           s
                           )
                        
                     , the plane can be divided into inner part and outer part of 
                        
                           f
                        
                        
                           (
                           s
                           )
                        
                     , i.e., 
                        
                           
                              
                                 u
                              
                           
                           
                              j
                           
                        
                      is inside 
                        
                           f
                        
                        
                           (
                           s
                           )
                        
                      if 
                        d
                        
                           (
                           
                              
                                 
                                    u
                                 
                              
                              
                                 j
                              
                           
                           ,
                           
                              f
                           
                           
                              (
                              s
                              )
                           
                           )
                        
                        <
                        0
                      and 
                        
                           
                              
                                 u
                              
                           
                           
                              j
                           
                        
                      is outside 
                        
                           f
                        
                        
                           (
                           s
                           )
                        
                      if 
                        d
                        
                           (
                           
                              
                                 
                                    u
                                 
                              
                              
                                 j
                              
                           
                           ,
                           
                              f
                           
                           
                              (
                              s
                              )
                           
                           )
                        
                        >
                        0
                     . Without loss of generality, we assume that the obstacle point 
                        
                           
                              
                                 u
                              
                           
                           
                              j
                           
                        
                      is in the inner part of 
                        f
                        
                           (
                           s
                           )
                        
                     . Let 
                        
                           f
                        
                        
                           (
                           
                              
                                 s
                              
                              
                                 j
                              
                           
                           )
                        
                      be the nearest foot point of 
                        
                           
                              
                                 u
                              
                           
                           
                              j
                           
                        
                      and 
                        
                           N
                        
                        
                           (
                           
                              
                                 s
                              
                              
                                 j
                              
                           
                           )
                        
                      the unit outer normal vector at 
                        
                           f
                        
                        
                           (
                           
                              
                                 s
                              
                              
                                 j
                              
                           
                           )
                        
                     . The constraint 
                        d
                        
                           (
                           
                              
                                 
                                    u
                                 
                              
                              
                                 j
                              
                           
                           ,
                           
                              f
                           
                           
                              (
                              
                                 
                                    s
                                 
                                 
                                    j
                                 
                              
                              )
                           
                           )
                        
                        <
                        0
                      is equivalent to 
                        
                           (21)
                           
                              
                                 
                                    
                                       (
                                       
                                          
                                             
                                                u
                                             
                                          
                                          
                                             j
                                          
                                       
                                       −
                                       
                                          f
                                       
                                       
                                          (
                                          
                                             
                                                s
                                             
                                             
                                                j
                                             
                                          
                                          )
                                       
                                       )
                                    
                                 
                                 
                                    T
                                 
                              
                              
                                 N
                              
                              
                                 (
                                 
                                    
                                       s
                                    
                                    
                                       j
                                    
                                 
                                 )
                              
                              <
                              0
                              .
                           
                        
                      The parameter 
                        
                           
                              s
                           
                           
                              j
                           
                        
                      is associated with control points; on other words, 
                        
                           
                              s
                           
                           
                              j
                           
                        
                      can be regarded as a function 
                        
                           
                              s
                           
                           
                              j
                           
                        
                        
                           (
                           
                              c
                           
                           )
                        
                     . Then 
                        
                           
                              
                                 (
                                 
                                    
                                       
                                          u
                                       
                                    
                                    
                                       j
                                    
                                 
                                 −
                                 
                                    f
                                 
                                 
                                    (
                                    
                                       
                                          s
                                       
                                       
                                          j
                                       
                                    
                                    )
                                 
                                 )
                              
                           
                           
                              T
                           
                        
                        
                           N
                        
                        
                           (
                           
                              
                                 s
                              
                              
                                 j
                              
                           
                           )
                        
                      is a function with respect to 
                        
                           c
                        
                     , which has a linear approximation 
                        
                           
                              l
                           
                           
                              j
                           
                        
                        
                           (
                           
                              c
                           
                           )
                        
                     , where 
                        
                           (22)
                           
                              
                                 
                                    l
                                 
                                 
                                    j
                                 
                              
                              
                                 (
                                 
                                    c
                                 
                                 )
                              
                              =
                              
                                 
                                    l
                                 
                                 
                                    j
                                 
                              
                              
                                 (
                                 
                                    
                                       
                                          c
                                       
                                    
                                    
                                       0
                                    
                                 
                                 )
                              
                              +
                              
                                 
                                    ∇
                                 
                                 
                                    
                                       c
                                    
                                 
                              
                              
                                 
                                    l
                                 
                                 
                                    j
                                 
                              
                              
                                 
                                    
                                       (
                                       
                                          
                                             
                                                c
                                             
                                          
                                          
                                             0
                                          
                                       
                                       )
                                    
                                 
                                 
                                    T
                                 
                              
                              
                                 (
                                 
                                    c
                                 
                                 −
                                 
                                    
                                       
                                          c
                                       
                                    
                                    
                                       0
                                    
                                 
                                 )
                              
                              .
                           
                        
                      Let 
                        δ
                        
                           c
                        
                        =
                        
                           c
                        
                        −
                        
                           
                              
                                 c
                              
                           
                           
                              0
                           
                        
                     , the constraint is approximated by 
                        
                           (23)
                           
                              
                                 
                                    ∇
                                 
                                 
                                    
                                       c
                                    
                                 
                              
                              
                                 
                                    l
                                 
                                 
                                    j
                                 
                              
                              
                                 
                                    
                                       (
                                       
                                          
                                             
                                                c
                                             
                                          
                                          
                                             0
                                          
                                       
                                       )
                                    
                                 
                                 
                                    T
                                 
                              
                              δ
                              
                                 c
                              
                              <
                              −
                              
                                 
                                    
                                       (
                                       
                                          
                                             
                                                u
                                             
                                          
                                          
                                             j
                                          
                                       
                                       −
                                       
                                          f
                                       
                                       
                                          (
                                          
                                             
                                                s
                                             
                                             
                                                j
                                             
                                          
                                          
                                             (
                                             
                                                
                                                   
                                                      c
                                                   
                                                
                                                
                                                   0
                                                
                                             
                                             )
                                          
                                          )
                                       
                                       )
                                    
                                 
                                 
                                    T
                                 
                              
                              
                                 N
                              
                              
                                 (
                                 
                                    
                                       s
                                    
                                    
                                       j
                                    
                                 
                                 
                                    (
                                    
                                       
                                          
                                             c
                                          
                                       
                                       
                                          0
                                       
                                    
                                    )
                                 
                                 )
                              
                              .
                           
                        
                      In the gradient matrix 
                        
                           
                              ∇
                           
                           
                              
                                 c
                              
                           
                        
                        
                           
                              l
                           
                           
                              j
                           
                        
                        
                           (
                           
                              
                                 
                                    c
                                 
                              
                              
                                 0
                              
                           
                           )
                        
                     , the differential of 
                        
                           
                              l
                           
                           
                              j
                           
                        
                      w.r.t. 
                        
                           
                              
                                 c
                              
                           
                           
                              i
                           
                        
                      is 
                        
                           (24)
                           
                              
                                 
                                    ∂
                                    
                                       
                                          l
                                       
                                       
                                          j
                                       
                                    
                                    
                                       (
                                       
                                          c
                                       
                                       )
                                    
                                 
                                 
                                    ∂
                                    
                                       
                                          
                                             c
                                          
                                       
                                       
                                          i
                                       
                                    
                                 
                              
                              =
                              −
                              
                                 
                                    B
                                 
                                 
                                    i
                                 
                              
                              ⋅
                              
                                 N
                              
                              
                                 (
                                 
                                    
                                       s
                                    
                                    
                                       j
                                    
                                 
                                 )
                              
                              +
                              
                                 [
                                 
                                    
                                       B
                                    
                                    
                                       i
                                    
                                 
                                 ⋅
                                 I
                                 −
                                 J
                                 ⋅
                                 
                                    
                                       
                                          f
                                       
                                    
                                    
                                       ″
                                    
                                 
                                 ⋅
                                 
                                    
                                       
                                          (
                                          
                                             
                                                
                                                   
                                                      B
                                                   
                                                   
                                                      i
                                                   
                                                   
                                                      ′
                                                   
                                                
                                                ⋅
                                                
                                                   (
                                                   
                                                      f
                                                   
                                                   −
                                                   
                                                      
                                                         
                                                            u
                                                         
                                                      
                                                      
                                                         j
                                                      
                                                   
                                                   )
                                                
                                                +
                                                
                                                   
                                                      B
                                                   
                                                   
                                                      i
                                                   
                                                
                                                ⋅
                                                
                                                   
                                                      
                                                         f
                                                      
                                                   
                                                   
                                                      ′
                                                   
                                                
                                             
                                             
                                                
                                                   
                                                      
                                                         f
                                                      
                                                   
                                                   
                                                      ″
                                                      T
                                                   
                                                
                                                ⋅
                                                
                                                   (
                                                   
                                                      f
                                                   
                                                   −
                                                   
                                                      
                                                         
                                                            u
                                                         
                                                      
                                                      
                                                         j
                                                      
                                                   
                                                   )
                                                
                                                +
                                                
                                                   
                                                      
                                                         f
                                                      
                                                   
                                                   
                                                      ′
                                                      T
                                                   
                                                
                                                ⋅
                                                
                                                   f
                                                
                                             
                                          
                                          )
                                       
                                    
                                    
                                       T
                                    
                                 
                                 ]
                              
                              
                                 (
                                 
                                    
                                       
                                          u
                                       
                                    
                                    
                                       j
                                    
                                 
                                 −
                                 
                                    f
                                 
                                 )
                              
                              ,
                           
                        
                      where 
                        
                           
                              B
                           
                           
                              i
                           
                        
                      is the 
                        i
                     th Bernstein function, 
                        I
                      is the identity matrix with degree two and 
                        J
                      is the rotation matrix which rotates the tangent vector by 
                        π
                        /
                        2
                     ; 
                        
                           f
                        
                     , 
                        
                           
                              
                                 f
                              
                           
                           
                              ′
                           
                        
                      and 
                        
                           
                              
                                 f
                              
                           
                           
                              ″
                           
                        
                      are differentials of 
                        
                           f
                        
                      at  
                        
                           
                              s
                           
                           
                              j
                           
                        
                     . The detailed deductions can be found in  [7].

Once the offset of polyline of given points by translation 
                        ±
                        ε
                        ,
                        ε
                        >
                        0
                      is computed, we shall fit the curve in the pipeline of the offset. Discretize the two offsets to two point sets 
                        
                           
                              
                                 u
                              
                           
                           
                              j
                           
                        
                      and 
                        
                           
                              
                                 v
                              
                           
                           
                              k
                           
                        
                     , 
                        j
                        =
                        1
                        ,
                        …
                        ,
                        
                           
                              l
                           
                           
                              1
                           
                        
                        ,
                        
                        k
                        =
                        1
                        ,
                        …
                        ,
                        
                           
                              l
                           
                           
                              2
                           
                        
                      and regard them as two obstacles respectively. Then the associated inequality constraints are 
                        d
                        
                           (
                           
                              
                                 
                                    u
                                 
                              
                              
                                 j
                              
                           
                           ,
                           
                              f
                           
                           
                              (
                              s
                              )
                           
                           )
                        
                        ≤
                        0
                      and 
                        d
                        
                           (
                           
                              
                                 
                                    v
                                 
                              
                              
                                 k
                              
                           
                           ,
                           
                              f
                           
                           
                              (
                              s
                              )
                           
                           )
                        
                        ≥
                        0
                     . By (21), in step 3 of the general algorithm framework in Section  2.2, we need to solve an optimization problem with inequality constraints
                        
                           
                              
                                 
                                    
                                       min
                                    
                                    
                                       δ
                                       
                                          c
                                       
                                    
                                 
                                 
                                 F
                                 
                                    (
                                    δ
                                    
                                       c
                                    
                                    )
                                 
                                 =
                                 
                                    
                                       1
                                    
                                    
                                       2
                                    
                                 
                                 
                                    
                                       ∑
                                    
                                    
                                       k
                                       =
                                       1
                                    
                                    
                                       m
                                    
                                 
                                 
                                    
                                       d
                                    
                                    
                                       2
                                    
                                 
                                 
                                    (
                                    
                                       
                                          
                                             p
                                          
                                       
                                       
                                          k
                                       
                                    
                                    ,
                                    
                                       
                                          
                                             f
                                          
                                       
                                       
                                          ˜
                                       
                                    
                                    
                                       (
                                       s
                                       )
                                    
                                    )
                                 
                                 +
                                 λ
                                 η
                              
                           
                           
                              (25)
                              
                                 s.t.
                                 
                                 
                                    
                                       
                                          (
                                          
                                             
                                                
                                                   u
                                                
                                             
                                             
                                                j
                                             
                                          
                                          −
                                          
                                             f
                                          
                                          
                                             (
                                             
                                                
                                                   s
                                                
                                                
                                                   j
                                                
                                             
                                             )
                                          
                                          )
                                       
                                    
                                    
                                       T
                                    
                                 
                                 
                                    N
                                 
                                 
                                    (
                                    
                                       
                                          s
                                       
                                       
                                          j
                                       
                                    
                                    )
                                 
                                 <
                                 0
                                 ,
                                 
                                 j
                                 =
                                 1
                                 ,
                                 …
                                 ,
                                 
                                    
                                       l
                                    
                                    
                                       1
                                    
                                 
                                 ;
                              
                           
                           
                              
                                 
                                    
                                       
                                          (
                                          
                                             
                                                
                                                   v
                                                
                                             
                                             
                                                k
                                             
                                          
                                          −
                                          
                                             f
                                          
                                          
                                             (
                                             
                                                
                                                   s
                                                
                                                
                                                   k
                                                
                                             
                                             )
                                          
                                          )
                                       
                                    
                                    
                                       T
                                    
                                 
                                 
                                    N
                                 
                                 
                                    (
                                    
                                       
                                          s
                                       
                                       
                                          k
                                       
                                    
                                    )
                                 
                                 >
                                 0
                                 ,
                                 
                                 k
                                 =
                                 1
                                 ,
                                 …
                                 ,
                                 
                                    
                                       l
                                    
                                    
                                       2
                                    
                                 
                                 .
                              
                           
                        
                     
                  

The discrete error conditions are added to refine the error control. The constraints are applicable to any target curve since only the discrete points are needed, and one can get correct fitting curve in many examples. In the discretization of the offset polylines, the number of points may increase the reliability of error control but also the computing time. Such numerical approach may fail in some cases (see Fig. 3(b)).

In CNC data trajectory planning, under the confined error control, we need to decrease the machining time as possible as we can. In the practical manufacture process, the velocity and acceleration of kinematics are generally limited by certain values. Hence, the maximum velocity and acceleration constraints should be added to the optimization model.

Regarding the parameter 
                        s
                      as the time parameter 
                        t
                     , the equation (6) indicates the axis velocity to be linear at every interval 
                        
                           [
                           
                              
                                 τ
                              
                              
                                 i
                              
                           
                           ,
                           
                              
                                 τ
                              
                              
                                 i
                                 +
                                 1
                              
                           
                           ]
                        
                     . The squared velocity function is quadratic with positive leading coefficient. Hence, we need only to check the velocity constraints at each knot 
                        
                           (26)
                           
                              
                                 ‖
                                 
                                    
                                       
                                          f
                                       
                                    
                                    
                                       ′
                                    
                                 
                                 
                                    (
                                    
                                       
                                          τ
                                       
                                       
                                          i
                                       
                                    
                                    )
                                 
                                 ‖
                              
                              =
                              
                                 ‖
                                 
                                    
                                       2
                                       
                                          (
                                          
                                             
                                                
                                                   c
                                                
                                             
                                             
                                                i
                                                −
                                                1
                                             
                                          
                                          −
                                          
                                             
                                                
                                                   c
                                                
                                             
                                             
                                                i
                                                −
                                                2
                                             
                                          
                                          )
                                       
                                    
                                    
                                       
                                          
                                             τ
                                          
                                          
                                             i
                                             +
                                             1
                                          
                                       
                                       −
                                       
                                          
                                             τ
                                          
                                          
                                             i
                                             −
                                             1
                                          
                                       
                                    
                                 
                                 ‖
                              
                              ≤
                              
                                 
                                    V
                                 
                                 
                                    
                                       max
                                    
                                 
                              
                              ,
                              
                              i
                              =
                              3
                              ,
                              …
                              ,
                              n
                              +
                              1
                              .
                           
                        
                      By (7), the acceleration is a constant at every knot interval and the acceleration constraints are then 
                        
                           (27)
                           
                              
                                 |
                                 
                                    
                                       
                                          f
                                       
                                    
                                    
                                       i
                                    
                                    
                                       ″
                                    
                                 
                                 
                                    (
                                    
                                       
                                          τ
                                       
                                       
                                          i
                                       
                                    
                                    )
                                 
                                 |
                              
                              ≤
                              
                                 
                                    
                                       A
                                    
                                 
                                 
                                    
                                       max
                                    
                                 
                              
                              ,
                              
                              i
                              =
                              3
                              ,
                              …
                              ,
                              n
                              ,
                           
                        
                      where 
                        
                           
                              
                                 A
                              
                           
                           
                              
                                 max
                              
                           
                        
                        =
                        
                           
                              
                                 (
                                 
                                    
                                       A
                                    
                                    
                                       x
                                       
                                          max
                                       
                                    
                                 
                                 ,
                                 
                                    
                                       A
                                    
                                    
                                       y
                                       
                                          max
                                       
                                    
                                 
                                 )
                              
                           
                           
                              T
                           
                        
                      and 
                        
                           
                              A
                           
                           
                              x
                              
                                 max
                              
                           
                        
                      and 
                        
                           
                              A
                           
                           
                              y
                              
                                 max
                              
                           
                        
                      are the acceleration bounds for 
                        x
                     - and 
                        y
                     - axis respectively. Then, the constraints (26) and (27) can be reduced to the constraints on the control points and the knots of B-spline curves.

In Section  3, the objective function is the squared distance in the optimization model. In this section, we need to optimize the time with distance constraints. The time optimization is achieved by the knots refinement and hence the optimization model is now 
                        
                           
                              
                                 
                                    
                                       min
                                    
                                    
                                       
                                          f
                                       
                                    
                                 
                                 
                                 F
                                 =
                                 
                                    
                                       τ
                                    
                                    
                                       n
                                       +
                                       1
                                    
                                 
                              
                           
                           
                              
                                 s.t.
                                 
                                 d
                                 
                                    (
                                    
                                       
                                          
                                             f
                                          
                                       
                                       
                                          i
                                       
                                       
                                          r
                                          +
                                          1
                                       
                                    
                                    
                                       (
                                       t
                                       )
                                    
                                    ,
                                    
                                       
                                          
                                             p
                                          
                                       
                                       
                                          k
                                       
                                    
                                    
                                       
                                          
                                             p
                                          
                                       
                                       
                                          k
                                          +
                                          1
                                       
                                    
                                    )
                                 
                                 ≤
                                 ε
                                 ,
                                 
                                 ∀
                                 
                                    (
                                    k
                                    ,
                                    i
                                    )
                                 
                                 ∈
                                 U
                                 ;
                              
                           
                           
                              (28)
                              
                                 d
                                 
                                    (
                                    
                                       
                                          
                                             p
                                          
                                       
                                       
                                          k
                                       
                                    
                                    ,
                                    
                                       
                                          
                                             f
                                          
                                       
                                       
                                          r
                                          +
                                          1
                                       
                                    
                                    
                                       (
                                       t
                                       )
                                    
                                    )
                                 
                                 ≤
                                 ε
                                 ,
                                 
                                 k
                                 =
                                 1
                                 ,
                                 …
                                 ,
                                 m
                                 ;
                              
                           
                           
                              
                                 
                                    ‖
                                    
                                       
                                          
                                             f
                                          
                                       
                                       
                                          ′
                                       
                                    
                                    
                                       (
                                       
                                          
                                             τ
                                          
                                          
                                             i
                                          
                                       
                                       )
                                    
                                    ‖
                                 
                                 ≤
                                 
                                    
                                       V
                                    
                                    
                                       
                                          max
                                       
                                    
                                 
                                 ,
                                 
                                 i
                                 =
                                 3
                                 ,
                                 …
                                 ,
                                 n
                                 +
                                 1
                                 ;
                              
                           
                           
                              
                                 
                                    |
                                    
                                       
                                          
                                             f
                                          
                                       
                                       
                                          i
                                       
                                       
                                          ″
                                       
                                    
                                    |
                                 
                                 ≤
                                 
                                    
                                       
                                          A
                                       
                                    
                                    
                                       
                                          max
                                       
                                    
                                 
                                 ,
                                 
                                 i
                                 =
                                 3
                                 ,
                                 …
                                 ,
                                 n
                                 ,
                              
                           
                        
                      where 
                        U
                      can be computed by Step 3 of Algorithm 1.

Using time parameter in curve fitting, it is possible to compromise the fitting accuracy. This is the fact the accuracy is compromised when the machining time is shorten (see Figs. 3(c) and 5(b)). But we should emphasis that our model is designed with confined error by adding the exact distance constraints, that means the fitting accuracy is always controlled.

Similar to discussions in Section  3, we can approximate the constraints by linear ones to simplify the optimization problem. However, here we prefer to solve the problem with a faster two-step process.

For a time-optimal velocity function, a necessary condition is that it is “Bang–Bang-Singular”, that is, the velocity or acceleration of one axis reaches its bound for every point on the tool path  [12]. For the initial curve, this property is usually not satisfied.

For the first step, starting from a given curve, we use the time transformations 
                        t
                        →
                        
                           
                              α
                           
                           
                              i
                           
                        
                        t
                        +
                        
                           
                              t
                           
                           
                              i
                           
                        
                        ,
                        
                        t
                        ∈
                        
                           [
                           
                              
                                 τ
                              
                              
                                 i
                              
                           
                           ,
                           
                              
                                 τ
                              
                              
                                 i
                                 +
                                 1
                              
                           
                           ]
                        
                        ,
                        
                        i
                        =
                        1
                        ,
                        …
                        ,
                        n
                      such that for each curve segment 
                        
                           f
                        
                        
                           (
                           t
                           )
                        
                        ,
                        
                        t
                        ∈
                        
                           [
                           
                              
                                 τ
                              
                              
                                 i
                              
                           
                           ,
                           
                              
                                 τ
                              
                              
                                 i
                                 +
                                 1
                              
                           
                           ]
                        
                      the velocity or acceleration of one axis reaches its bound. This can be done since when 
                        
                           
                              α
                           
                           
                              i
                           
                        
                      converges to zero, the velocity and acceleration of each axis will converge to zero, and when 
                        
                           
                              α
                           
                           
                              i
                           
                        
                      converge to infinity, the velocity or at least one of the axis will converge to infinity. To be concrete, let 
                        
                           (29)
                           
                              
                                 f
                              
                              
                                 (
                                 t
                                 )
                              
                              =
                              
                                 (
                                 
                                    
                                       a
                                    
                                    
                                       1
                                    
                                 
                                 
                                    
                                       t
                                    
                                    
                                       2
                                    
                                 
                                 +
                                 
                                    
                                       b
                                    
                                    
                                       1
                                    
                                 
                                 t
                                 +
                                 
                                    
                                       c
                                    
                                    
                                       1
                                    
                                 
                                 ,
                                 
                                    
                                       a
                                    
                                    
                                       2
                                    
                                 
                                 
                                    
                                       t
                                    
                                    
                                       2
                                    
                                 
                                 +
                                 
                                    
                                       b
                                    
                                    
                                       2
                                    
                                 
                                 t
                                 +
                                 
                                    
                                       c
                                    
                                    
                                       2
                                    
                                 
                                 )
                              
                              ,
                              
                              t
                              ∈
                              
                                 [
                                 
                                    
                                       τ
                                    
                                    
                                       i
                                    
                                 
                                 ,
                                 
                                    
                                       τ
                                    
                                    
                                       i
                                       +
                                       1
                                    
                                 
                                 ]
                              
                              ,
                           
                        
                      then 
                        
                           
                              
                                 f
                              
                           
                           
                              ′
                           
                        
                        
                           (
                           t
                           )
                        
                        =
                        
                           (
                           2
                           
                              
                                 a
                              
                              
                                 1
                              
                           
                           t
                           +
                           
                              
                                 b
                              
                              
                                 1
                              
                           
                           ,
                           2
                           
                              
                                 a
                              
                              
                                 2
                              
                           
                           t
                           +
                           
                              
                                 b
                              
                              
                                 2
                              
                           
                           )
                        
                      and the accelerations of 
                        x
                     - and 
                        y
                     - axis are 
                        
                           
                              a
                           
                           
                              x
                           
                        
                        =
                        2
                        
                           
                              a
                           
                           
                              1
                           
                        
                      and 
                        
                           
                              a
                           
                           
                              y
                           
                        
                        =
                        2
                        
                           
                              a
                           
                           
                              2
                           
                        
                      respectively. The velocity function is 
                        
                           (30)
                           
                              v
                              
                                 (
                                 t
                                 )
                              
                              =
                              
                                 
                                    
                                       
                                          
                                             (
                                             2
                                             
                                                
                                                   a
                                                
                                                
                                                   1
                                                
                                             
                                             t
                                             +
                                             
                                                
                                                   b
                                                
                                                
                                                   1
                                                
                                             
                                             )
                                          
                                       
                                       
                                          2
                                       
                                    
                                    +
                                    
                                       
                                          
                                             (
                                             2
                                             
                                                
                                                   a
                                                
                                                
                                                   2
                                                
                                             
                                             t
                                             +
                                             
                                                
                                                   b
                                                
                                                
                                                   2
                                                
                                             
                                             )
                                          
                                       
                                       
                                          2
                                       
                                    
                                 
                              
                              .
                           
                        
                      Under time transformation, 
                        
                           
                              
                                 f
                              
                           
                           
                              ̃
                           
                        
                        
                           (
                           t
                           )
                        
                        =
                        
                           f
                        
                        
                           (
                           
                              
                                 α
                              
                              
                                 i
                              
                           
                           t
                           +
                           
                              
                                 t
                              
                              
                                 i
                              
                           
                           )
                        
                     . Then, the accelerations of 
                        x
                     - and 
                        y
                     - axis are 
                        
                           
                              
                                 
                                    a
                                 
                                 
                                    ̃
                                 
                              
                           
                           
                              x
                           
                        
                        =
                        2
                        
                           
                              α
                           
                           
                              i
                           
                           
                              2
                           
                        
                        
                           
                              a
                           
                           
                              1
                           
                        
                      and 
                        
                           
                              
                                 
                                    a
                                 
                                 
                                    ̃
                                 
                              
                           
                           
                              y
                           
                        
                        =
                        2
                        
                           
                              α
                           
                           
                              i
                           
                           
                              2
                           
                        
                        
                           
                              a
                           
                           
                              2
                           
                        
                      respectively and the velocity function is
                        
                           (31)
                           
                              
                                 
                                    v
                                 
                                 
                                    ̃
                                 
                              
                              
                                 (
                                 t
                                 )
                              
                              =
                              
                                 
                                    α
                                 
                                 
                                    i
                                 
                              
                              
                                 
                                    
                                       
                                          
                                             (
                                             2
                                             
                                                
                                                   a
                                                
                                                
                                                   1
                                                
                                             
                                             
                                                
                                                   α
                                                
                                                
                                                   i
                                                
                                             
                                             t
                                             +
                                             2
                                             
                                                
                                                   a
                                                
                                                
                                                   1
                                                
                                             
                                             
                                                
                                                   t
                                                
                                                
                                                   i
                                                
                                             
                                             +
                                             
                                                
                                                   b
                                                
                                                
                                                   1
                                                
                                             
                                             )
                                          
                                       
                                       
                                          2
                                       
                                    
                                    +
                                    
                                       
                                          
                                             (
                                             2
                                             
                                                
                                                   a
                                                
                                                
                                                   2
                                                
                                             
                                             
                                                
                                                   α
                                                
                                                
                                                   i
                                                
                                             
                                             t
                                             +
                                             2
                                             
                                                
                                                   a
                                                
                                                
                                                   2
                                                
                                             
                                             
                                                
                                                   t
                                                
                                                
                                                   i
                                                
                                             
                                             +
                                             
                                                
                                                   b
                                                
                                                
                                                   2
                                                
                                             
                                             )
                                          
                                       
                                       
                                          2
                                       
                                    
                                 
                              
                              .
                           
                        
                     
                  

Let 
                        
                           
                              
                                 
                                    τ
                                 
                                 
                                    ̃
                                 
                              
                           
                           
                              0
                           
                        
                        =
                        
                           
                              τ
                           
                           
                              0
                           
                        
                        =
                        0
                     . By induction, we get the 
                        i
                        −
                        1
                     th curve segment of the quadratic B-spline, hence we know 
                        
                           
                              
                                 
                                    τ
                                 
                                 
                                    ̃
                                 
                              
                           
                           
                              i
                           
                        
                     . Note that 
                        
                           
                              τ
                           
                           
                              i
                           
                        
                        =
                        
                           
                              α
                           
                           
                              i
                           
                        
                        
                           
                              
                                 
                                    τ
                                 
                                 
                                    ̃
                                 
                              
                           
                           
                              i
                           
                        
                        +
                        
                           
                              t
                           
                           
                              i
                           
                        
                      and 
                        
                           
                              τ
                           
                           
                              i
                              +
                              1
                           
                        
                        =
                        
                           
                              α
                           
                           
                              i
                           
                        
                        
                           
                              
                                 
                                    τ
                                 
                                 
                                    ̃
                                 
                              
                           
                           
                              i
                              +
                              1
                           
                        
                        +
                        
                           
                              t
                           
                           
                              i
                           
                        
                     . Hence we can omit 
                        
                           
                              t
                           
                           
                              i
                           
                        
                      in the velocity function, 
                        
                           (32)
                           
                              
                                 
                                    v
                                 
                                 
                                    ̃
                                 
                              
                              
                                 (
                                 t
                                 )
                              
                              =
                              
                                 
                                    α
                                 
                                 
                                    i
                                 
                              
                              
                                 
                                    
                                       
                                          
                                             (
                                             2
                                             
                                                
                                                   a
                                                
                                                
                                                   1
                                                
                                             
                                             
                                                
                                                   α
                                                
                                                
                                                   i
                                                
                                             
                                             
                                                (
                                                t
                                                −
                                                
                                                   
                                                      
                                                         
                                                            τ
                                                         
                                                         
                                                            ̃
                                                         
                                                      
                                                   
                                                   
                                                      i
                                                   
                                                
                                                )
                                             
                                             +
                                             2
                                             
                                                
                                                   a
                                                
                                                
                                                   1
                                                
                                             
                                             
                                                
                                                   τ
                                                
                                                
                                                   i
                                                
                                             
                                             +
                                             
                                                
                                                   b
                                                
                                                
                                                   1
                                                
                                             
                                             )
                                          
                                       
                                       
                                          2
                                       
                                    
                                    +
                                    
                                       
                                          
                                             (
                                             2
                                             
                                                
                                                   a
                                                
                                                
                                                   2
                                                
                                             
                                             
                                                
                                                   α
                                                
                                                
                                                   i
                                                
                                             
                                             
                                                (
                                                t
                                                −
                                                
                                                   
                                                      
                                                         
                                                            τ
                                                         
                                                         
                                                            ̃
                                                         
                                                      
                                                   
                                                   
                                                      i
                                                   
                                                
                                                )
                                             
                                             +
                                             2
                                             
                                                
                                                   a
                                                
                                                
                                                   2
                                                
                                             
                                             
                                                
                                                   τ
                                                
                                                
                                                   i
                                                
                                             
                                             +
                                             
                                                
                                                   b
                                                
                                                
                                                   2
                                                
                                             
                                             )
                                          
                                       
                                       
                                          2
                                       
                                    
                                 
                              
                              .
                           
                        
                      The above function is convex, hence the maximum value of 
                        
                           
                              v
                           
                           
                              ̃
                           
                        
                        
                           (
                           t
                           )
                        
                        ,
                        t
                        ∈
                        
                           [
                           
                              
                                 
                                    
                                       τ
                                    
                                    
                                       ̃
                                    
                                 
                              
                              
                                 i
                              
                           
                           ,
                           
                              
                                 
                                    
                                       τ
                                    
                                    
                                       ̃
                                    
                                 
                              
                              
                                 i
                                 +
                                 1
                              
                           
                           ]
                        
                      can be obtained at the ending points, that is, 
                        
                           
                              max
                           
                           
                              
                                 
                                    
                                       
                                          τ
                                       
                                       
                                          ̃
                                       
                                    
                                 
                                 
                                    i
                                 
                              
                              ≤
                              t
                              ≤
                              
                                 
                                    
                                       
                                          τ
                                       
                                       
                                          ̃
                                       
                                    
                                 
                                 
                                    i
                                    +
                                    1
                                 
                              
                           
                        
                        
                           
                              v
                           
                           
                              ̃
                           
                        
                        
                           (
                           t
                           )
                        
                        =
                        max
                        
                           (
                           
                              
                                 v
                              
                              
                                 ̃
                              
                           
                           
                              (
                              
                                 
                                    
                                       
                                          τ
                                       
                                       
                                          ̃
                                       
                                    
                                 
                                 
                                    i
                                 
                              
                              )
                           
                           ,
                           
                              
                                 v
                              
                              
                                 ̃
                              
                           
                           
                              (
                              
                                 
                                    
                                       
                                          τ
                                       
                                       
                                          ̃
                                       
                                    
                                 
                                 
                                    i
                                    +
                                    1
                                 
                              
                              )
                           
                           )
                        
                     . Here 
                        
                           
                              (33)
                              
                                 
                                    
                                       v
                                    
                                    
                                       ̃
                                    
                                 
                                 
                                    (
                                    
                                       
                                          
                                             
                                                τ
                                             
                                             
                                                ̃
                                             
                                          
                                       
                                       
                                          i
                                       
                                    
                                    )
                                 
                                 =
                                 
                                    
                                       α
                                    
                                    
                                       i
                                    
                                 
                                 
                                    
                                       
                                          
                                             
                                                (
                                                2
                                                
                                                   
                                                      a
                                                   
                                                   
                                                      1
                                                   
                                                
                                                
                                                   
                                                      τ
                                                   
                                                   
                                                      i
                                                   
                                                
                                                +
                                                
                                                   
                                                      b
                                                   
                                                   
                                                      1
                                                   
                                                
                                                )
                                             
                                          
                                          
                                             2
                                          
                                       
                                       +
                                       
                                          
                                             
                                                (
                                                2
                                                
                                                   
                                                      a
                                                   
                                                   
                                                      2
                                                   
                                                
                                                
                                                   
                                                      τ
                                                   
                                                   
                                                      i
                                                   
                                                
                                                +
                                                
                                                   
                                                      b
                                                   
                                                   
                                                      2
                                                   
                                                
                                                )
                                             
                                          
                                          
                                             2
                                          
                                       
                                    
                                 
                                 =
                                 
                                    
                                       α
                                    
                                    
                                       i
                                    
                                 
                                 v
                                 
                                    (
                                    
                                       
                                          τ
                                       
                                       
                                          i
                                       
                                    
                                    )
                                 
                                 ,
                              
                           
                           
                              (34)
                              
                                 
                                    
                                       v
                                    
                                    
                                       ̃
                                    
                                 
                                 
                                    (
                                    
                                       
                                          
                                             
                                                τ
                                             
                                             
                                                ̃
                                             
                                          
                                       
                                       
                                          i
                                          +
                                          1
                                       
                                    
                                    )
                                 
                                 =
                                 
                                    
                                       α
                                    
                                    
                                       i
                                    
                                 
                                 
                                    
                                       
                                          
                                             h
                                          
                                          
                                             1
                                          
                                          
                                             2
                                          
                                       
                                       +
                                       
                                          
                                             h
                                          
                                          
                                             2
                                          
                                          
                                             2
                                          
                                       
                                    
                                 
                                 =
                                 
                                    
                                       α
                                    
                                    
                                       i
                                    
                                 
                                 v
                                 
                                    (
                                    
                                       
                                          τ
                                       
                                       
                                          i
                                          +
                                          1
                                       
                                    
                                    )
                                 
                                 
                                 where
                                 
                                 
                                    
                                       h
                                    
                                    
                                       k
                                    
                                 
                                 =
                                 
                                    (
                                    2
                                    
                                       
                                          a
                                       
                                       
                                          k
                                       
                                    
                                    
                                       
                                          α
                                       
                                       
                                          i
                                       
                                    
                                    
                                       (
                                       
                                          
                                             
                                                
                                                   τ
                                                
                                                
                                                   ̃
                                                
                                             
                                          
                                          
                                             i
                                             +
                                             1
                                          
                                       
                                       −
                                       
                                          
                                             
                                                
                                                   τ
                                                
                                                
                                                   ̃
                                                
                                             
                                          
                                          
                                             i
                                          
                                       
                                       )
                                    
                                    +
                                    2
                                    
                                       
                                          a
                                       
                                       
                                          k
                                       
                                    
                                    
                                       
                                          τ
                                       
                                       
                                          i
                                       
                                    
                                    +
                                    
                                       
                                          b
                                       
                                       
                                          k
                                       
                                    
                                    )
                                 
                                 .
                              
                           
                        
                      By solving for the minimal positive solution 
                        
                           
                              α
                           
                           
                              i
                           
                        
                      (and 
                        
                           
                              t
                           
                           
                              i
                           
                        
                      is obtained at the same time) of


                     
                        
                           
                              
                                 
                                    a
                                 
                                 
                                    ̃
                                 
                              
                           
                           
                              x
                           
                        
                        =
                        
                           
                              A
                           
                           
                              x
                              
                                 max
                              
                           
                        
                        ,
                        
                        
                           
                              
                                 
                                    a
                                 
                                 
                                    ̃
                                 
                              
                           
                           
                              y
                           
                        
                        =
                        
                           
                              A
                           
                           
                              y
                              
                                 max
                              
                           
                        
                        ,
                        
                        
                           
                              v
                           
                           
                              ̃
                           
                        
                        
                           (
                           
                              
                                 
                                    
                                       τ
                                    
                                    
                                       ̃
                                    
                                 
                              
                              
                                 i
                              
                           
                           )
                        
                        =
                        
                           
                              v
                           
                           
                              
                                 max
                              
                           
                        
                        ,
                        
                        
                           
                              v
                           
                           
                              ̃
                           
                        
                        
                           (
                           
                              
                                 
                                    
                                       τ
                                    
                                    
                                       ̃
                                    
                                 
                              
                              
                                 i
                                 +
                                 1
                              
                           
                           )
                        
                        =
                        
                           
                              v
                           
                           
                              
                                 max
                              
                           
                        
                     , one can make one reach the boundary and others controlled by the given bounds. Specifically, 
                        
                           (35)
                           
                              
                                 
                                    
                                       α
                                    
                                    
                                       i
                                    
                                 
                                 =
                                 min
                                 
                                    (
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      A
                                                   
                                                   
                                                      x
                                                      
                                                         max
                                                      
                                                   
                                                
                                             
                                             
                                                2
                                                
                                                   |
                                                   
                                                      
                                                         a
                                                      
                                                      
                                                         1
                                                      
                                                   
                                                   |
                                                
                                             
                                          
                                       
                                    
                                    ,
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      A
                                                   
                                                   
                                                      y
                                                      
                                                         max
                                                      
                                                   
                                                
                                             
                                             
                                                2
                                                
                                                   |
                                                   
                                                      
                                                         a
                                                      
                                                      
                                                         2
                                                      
                                                   
                                                   |
                                                
                                             
                                          
                                       
                                    
                                    ,
                                    
                                       
                                          
                                             
                                                v
                                             
                                             
                                                
                                                   max
                                                
                                             
                                          
                                       
                                       
                                          v
                                          
                                             (
                                             
                                                
                                                   τ
                                                
                                                
                                                   i
                                                
                                             
                                             )
                                          
                                       
                                    
                                    ,
                                    
                                       
                                          
                                             
                                                v
                                             
                                             
                                                
                                                   max
                                                
                                             
                                          
                                       
                                       
                                          v
                                          
                                             (
                                             
                                                
                                                   τ
                                                
                                                
                                                   i
                                                   +
                                                   1
                                                
                                             
                                             )
                                          
                                       
                                    
                                    )
                                 
                                 ,
                              
                           
                           
                              
                                 
                                    
                                       t
                                    
                                    
                                       i
                                    
                                 
                                 =
                                 
                                    
                                       τ
                                    
                                    
                                       i
                                    
                                 
                                 −
                                 
                                    
                                       α
                                    
                                    
                                       i
                                    
                                 
                                 
                                    
                                       
                                          
                                             τ
                                          
                                          
                                             ̃
                                          
                                       
                                    
                                    
                                       i
                                    
                                 
                                 .
                              
                           
                        
                      Note that, if any 
                        
                           
                              a
                           
                           
                              i
                           
                        
                        =
                        0
                        ,
                        
                        i
                        =
                        1
                        ,
                        2
                     , we delete the associated 
                        
                           
                              
                                 
                                    
                                       
                                          A
                                       
                                       
                                          x
                                          
                                             max
                                          
                                       
                                    
                                 
                                 
                                    2
                                    
                                       |
                                       
                                          
                                             a
                                          
                                          
                                             1
                                          
                                       
                                       |
                                    
                                 
                              
                           
                        
                      or 
                        
                           
                              
                                 
                                    
                                       
                                          A
                                       
                                       
                                          y
                                          
                                             max
                                          
                                       
                                    
                                 
                                 
                                    2
                                    
                                       |
                                       
                                          
                                             a
                                          
                                          
                                             2
                                          
                                       
                                       |
                                    
                                 
                              
                           
                        
                      from the above equation, since the velocity of 
                        x
                     - or 
                        y
                     -axis is a constant.

For the second step, we fix the knots and reduce the optimization problem to the one in Section  3. In other words, we use the squared distance instead of the time objective function. We find the solution and update the curve. Now, since the objective function is squared distance, the velocity and acceleration of the curve is generally loose. Then we go to the first step if the time optimization problem does not reach their bounds.

Except for the initial curve, the machining time 
                        
                           
                              τ
                           
                           
                              n
                              +
                              1
                           
                        
                      is strictly decreased in the iteration, hence the two-step process will terminate. The solution of (28) proposes a new trajectory with optimal machining time and confined error, and at each instant, the velocity and acceleration are bounded by 
                        
                           
                              V
                           
                           
                              
                                 max
                              
                           
                        
                      and 
                        
                           
                              
                                 A
                              
                           
                           
                              
                                 max
                              
                           
                        
                      respectively. From the experimental results, one can see that the velocity of the B-spline curve is almost “Bang–Bang-Singular”. Now, we give the trajectory planning algorithm for the given G01 codes under the confined error. 
                        Algorithm 2
                        Trajectory planning algorithm


                           Input: The G01 points 
                              
                                 
                                    
                                       p
                                    
                                 
                                 
                                    k
                                 
                              
                              ,
                              
                              k
                              =
                              1
                              ,
                              …
                              ,
                              m
                            which can be approximated by a quadratic B-spline and the error bound 
                              ε
                           
                        


                           Output: The time parameterized quadratic B-spline with confined error 
                              
                                 1.
                                 Solve the following optimization problem by Algorithm 1
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      min
                                                   
                                                   
                                                      
                                                         f
                                                      
                                                   
                                                
                                                
                                                F
                                                =
                                                
                                                   
                                                      1
                                                   
                                                   
                                                      2
                                                   
                                                
                                                
                                                   [
                                                   
                                                      
                                                         ∑
                                                      
                                                      
                                                         k
                                                         =
                                                         1
                                                      
                                                      
                                                         m
                                                      
                                                   
                                                   
                                                      
                                                         d
                                                      
                                                      
                                                         2
                                                      
                                                   
                                                   
                                                      (
                                                      
                                                         
                                                            
                                                               p
                                                            
                                                         
                                                         
                                                            k
                                                         
                                                      
                                                      ,
                                                      
                                                         
                                                            
                                                               f
                                                            
                                                         
                                                         
                                                            r
                                                            +
                                                            1
                                                         
                                                      
                                                      
                                                         (
                                                         s
                                                         )
                                                      
                                                      )
                                                   
                                                   +
                                                   
                                                      
                                                         ∑
                                                      
                                                      
                                                         
                                                            (
                                                            k
                                                            ,
                                                            i
                                                            )
                                                         
                                                         ∈
                                                         U
                                                      
                                                   
                                                   
                                                      
                                                         d
                                                      
                                                      
                                                         2
                                                      
                                                   
                                                   
                                                      (
                                                      
                                                         
                                                            
                                                               f
                                                            
                                                         
                                                         
                                                            i
                                                         
                                                         
                                                            r
                                                            +
                                                            1
                                                         
                                                      
                                                      
                                                         (
                                                         s
                                                         )
                                                      
                                                      ,
                                                      
                                                         
                                                            
                                                               p
                                                            
                                                         
                                                         
                                                            k
                                                         
                                                      
                                                      
                                                         
                                                            
                                                               p
                                                            
                                                         
                                                         
                                                            k
                                                            +
                                                            1
                                                         
                                                      
                                                      )
                                                   
                                                   ]
                                                
                                                +
                                                λ
                                                η
                                             
                                          
                                          
                                             
                                                s.t.
                                                
                                                d
                                                
                                                   (
                                                   
                                                      
                                                         
                                                            f
                                                         
                                                      
                                                      
                                                         i
                                                      
                                                      
                                                         r
                                                         +
                                                         1
                                                      
                                                   
                                                   
                                                      (
                                                      t
                                                      )
                                                   
                                                   ,
                                                   
                                                      
                                                         
                                                            p
                                                         
                                                      
                                                      
                                                         k
                                                      
                                                   
                                                   
                                                      
                                                         
                                                            p
                                                         
                                                      
                                                      
                                                         k
                                                         +
                                                         1
                                                      
                                                   
                                                   )
                                                
                                                ≤
                                                ε
                                                ,
                                                
                                                ∀
                                                
                                                   (
                                                   k
                                                   ,
                                                   i
                                                   )
                                                
                                                ∈
                                                U
                                                ;
                                             
                                          
                                          
                                             (36)
                                             
                                                d
                                                
                                                   (
                                                   
                                                      
                                                         
                                                            p
                                                         
                                                      
                                                      
                                                         k
                                                      
                                                   
                                                   ,
                                                   
                                                      
                                                         
                                                            f
                                                         
                                                      
                                                      
                                                         r
                                                         +
                                                         1
                                                      
                                                   
                                                   
                                                      (
                                                      t
                                                      )
                                                   
                                                   )
                                                
                                                ≤
                                                ε
                                                ,
                                                
                                                k
                                                =
                                                1
                                                ,
                                                …
                                                ,
                                                m
                                                ;
                                             
                                          
                                          
                                             
                                                
                                                   ‖
                                                   
                                                      
                                                         
                                                            f
                                                         
                                                      
                                                      
                                                         ′
                                                      
                                                   
                                                   
                                                      (
                                                      
                                                         
                                                            τ
                                                         
                                                         
                                                            i
                                                         
                                                      
                                                      )
                                                   
                                                   ‖
                                                
                                                ≤
                                                
                                                   
                                                      V
                                                   
                                                   
                                                      
                                                         max
                                                      
                                                   
                                                
                                                ,
                                                
                                                i
                                                =
                                                3
                                                ,
                                                …
                                                ,
                                                n
                                                +
                                                1
                                                ;
                                             
                                          
                                          
                                             
                                                
                                                   |
                                                   
                                                      
                                                         
                                                            f
                                                         
                                                      
                                                      
                                                         i
                                                      
                                                      
                                                         ″
                                                      
                                                   
                                                   |
                                                
                                                ≤
                                                
                                                   
                                                      
                                                         A
                                                      
                                                   
                                                   
                                                      
                                                         max
                                                      
                                                   
                                                
                                                ,
                                                
                                                i
                                                =
                                                3
                                                ,
                                                …
                                                ,
                                                n
                                                .
                                             
                                          
                                       
                                     Find the solution 
                                       
                                          f
                                       
                                       
                                          (
                                          t
                                          )
                                       
                                       =
                                       
                                          B
                                       
                                       
                                          (
                                          t
                                          )
                                       
                                       
                                          (
                                          
                                             c
                                          
                                          )
                                       
                                    .

Let the 
                                       i
                                    th curve segment of 
                                       
                                          f
                                       
                                       
                                          (
                                          t
                                          )
                                       
                                     be of the form (29). Starting from 
                                       
                                          
                                             τ
                                          
                                          
                                             0
                                          
                                       
                                       =
                                       0
                                       ,
                                       
                                       
                                          
                                             t
                                          
                                          
                                             1
                                          
                                       
                                       =
                                       0
                                    , use the time transformations 
                                       t
                                       →
                                       
                                          
                                             α
                                          
                                          
                                             i
                                          
                                       
                                       t
                                       +
                                       
                                          
                                             t
                                          
                                          
                                             i
                                          
                                       
                                       ,
                                       t
                                       ∈
                                       
                                          [
                                          
                                             
                                                τ
                                             
                                             
                                                i
                                             
                                          
                                          ,
                                          
                                             
                                                τ
                                             
                                             
                                                i
                                                +
                                                1
                                             
                                          
                                          ]
                                       
                                       ,
                                       
                                       i
                                       =
                                       1
                                       ,
                                       …
                                       ,
                                       n
                                    , where 
                                       
                                          
                                             α
                                          
                                          
                                             i
                                          
                                       
                                     and 
                                       
                                          
                                             t
                                          
                                          
                                             i
                                          
                                       
                                     are obtained by Eq. (35). Update 
                                       
                                          f
                                       
                                       
                                          (
                                          t
                                          )
                                       
                                     by the above time transformation. If 
                                       
                                          |
                                          
                                             
                                                α
                                             
                                             
                                                i
                                             
                                          
                                          −
                                          1
                                          |
                                       
                                       <
                                       0.001
                                     for each 
                                       i
                                    , output 
                                       
                                          f
                                       
                                       
                                          (
                                          t
                                          )
                                       
                                    ; otherwise, goto the above step and let 
                                       
                                          f
                                       
                                       
                                          (
                                          t
                                          )
                                       
                                     be the initial curve of the optimization problem (36).


                     
                        Remark 4
                        Note that the tangential acceleration is bounded by 
                              
                                 
                                    
                                       
                                          A
                                       
                                       
                                          x
                                          
                                             max
                                          
                                       
                                       
                                          2
                                       
                                    
                                    +
                                    
                                       
                                          A
                                       
                                       
                                          y
                                          
                                             max
                                          
                                       
                                       
                                          2
                                       
                                    
                                 
                              
                           . The tangential acceleration along the tool path 
                              
                                 f
                              
                              
                                 (
                                 t
                                 )
                              
                            is 
                              
                                 
                                    
                                       
                                          a
                                       
                                       
                                          T
                                       
                                    
                                    
                                       (
                                       t
                                       )
                                    
                                    =
                                    
                                       
                                          v
                                       
                                       
                                          ′
                                       
                                    
                                    
                                       (
                                       t
                                       )
                                    
                                    =
                                    
                                       
                                          4
                                          
                                             (
                                             
                                                
                                                   a
                                                
                                                
                                                   1
                                                
                                             
                                             +
                                             
                                                
                                                   a
                                                
                                                
                                                   2
                                                
                                             
                                             )
                                          
                                          t
                                          +
                                          2
                                          
                                             
                                                a
                                             
                                             
                                                1
                                             
                                          
                                          
                                             
                                                b
                                             
                                             
                                                1
                                             
                                          
                                          +
                                          2
                                          
                                             
                                                a
                                             
                                             
                                                2
                                             
                                          
                                          
                                             
                                                b
                                             
                                             
                                                2
                                             
                                          
                                       
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         (
                                                         2
                                                         
                                                            
                                                               a
                                                            
                                                            
                                                               1
                                                            
                                                         
                                                         t
                                                         +
                                                         
                                                            
                                                               b
                                                            
                                                            
                                                               1
                                                            
                                                         
                                                         )
                                                      
                                                   
                                                   
                                                      2
                                                   
                                                
                                                +
                                                
                                                   
                                                      
                                                         (
                                                         2
                                                         
                                                            
                                                               a
                                                            
                                                            
                                                               2
                                                            
                                                         
                                                         t
                                                         +
                                                         
                                                            
                                                               b
                                                            
                                                            
                                                               2
                                                            
                                                         
                                                         )
                                                      
                                                   
                                                   
                                                      2
                                                   
                                                
                                             
                                          
                                       
                                    
                                    ,
                                 
                              
                            since 
                              
                                 
                                    a
                                 
                                 
                                    T
                                 
                                 
                                    ′
                                 
                              
                              
                                 (
                                 t
                                 )
                              
                              =
                              4
                              
                                 
                                    
                                       (
                                       
                                          
                                             a
                                          
                                          
                                             1
                                          
                                       
                                       
                                          
                                             b
                                          
                                          
                                             2
                                          
                                       
                                       −
                                       
                                          
                                             a
                                          
                                          
                                             2
                                          
                                       
                                       
                                          
                                             b
                                          
                                          
                                             1
                                          
                                       
                                       )
                                    
                                 
                                 
                                    2
                                 
                              
                              /
                              v
                              
                                 
                                    
                                       (
                                       t
                                       )
                                    
                                 
                                 
                                    3
                                 
                              
                              ≥
                              0
                              ,
                              
                              
                                 
                                    a
                                 
                                 
                                    T
                                 
                              
                              
                                 (
                                 t
                                 )
                              
                            is monotone with respect to 
                              t
                           . Hence, if we consider the tangential constraints along the tool path, we need only to add the tangential acceleration constraints at each knot point to the optimization model since they are convex with respect to parameter 
                              t
                            for the quadratic B-splines, that is, add 
                              
                                 |
                                 
                                    
                                       a
                                    
                                    
                                       T
                                    
                                 
                                 
                                    (
                                    
                                       
                                          τ
                                       
                                       
                                          i
                                       
                                    
                                    )
                                 
                                 |
                              
                              ≤
                              
                                 
                                    A
                                 
                                 
                                    T
                                 
                              
                            to the optimization problem (36).


                     
                        Remark 5
                        The quadratic B-spline curve obtained above is a trajectory with confined velocity, and acceleration for each axis. The jerk limitation is not considered since the acceleration is not continuous at each knot point of the quadratic B-spline. However, one can get the smooth acceleration (associated with tangential jerk) by the method given in  [15,13].

@&#EXPERIMENTAL RESULTS@&#

The G01 codes and the quadratic B-spline representation  [21] of the vase model can be found in http://www.mmrc.iss.ac.cn/~xgao/cnc/vase.html. We take a part of points from the vase G01 codes (see Fig. 2
                        ).  We compute the quadratic B-spline curve by different curve fitting methods and show their error comparison in Fig. 3. One can find that the error of Fig. 3(b) is smaller than that of Fig. 3(a), whereas there are still some points beyond the given error bound 0.05. The fitting curve with confined error is given in Fig. 3(c).

To illustrate details, we show a part of the fitting curve in Fig. 4
                        . In Fig. 4(a),  the curve interpolates the feature points  [21]. The curve is quite far away from the line segments in certain region. Adding the discrete offset constraint and applying Flöry’s method, we get the fitting curve in Fig. 4(b). To achieve a fitting curve with better error bound, we need more discrete points, which bring more computations. In fact, in Fig. 4(b), the result by Flöry’s method costs more computing time than our distance constraint method. Finally, the curve fit by our method is shown in Fig. 4(c). The fitting curve is much better when the error bound is taken into account.

To increase the feedrate in practical manufacturing with the confined error, we should smooth the curve as possible as we can. The model is given in Section  5 and the segmental result is shown in Fig. 5(a). The error, the maximum velocity and acceleration bounds are set as 0.05 mm, 
                           
                              
                                 V
                              
                              
                                 
                                    max
                                 
                              
                           
                           =
                           100
                           
                           
                              mm
                           
                           /
                           
                              s
                           
                         and 
                           
                              
                                 A
                              
                              
                                 y
                                 
                                    max
                                 
                              
                           
                           =
                           
                              
                                 A
                              
                              
                                 z
                                 
                                    max
                                 
                              
                           
                           =
                           1000
                           
                           
                              mm
                           
                           /
                           
                              
                                 
                                    s
                                 
                              
                              
                                 2
                              
                           
                        , respectively. From Fig. 6
                        (a), the velocity is bounded by 
                           
                              
                                 V
                              
                              
                                 
                                    max
                                 
                              
                           
                        , and the axis accelerations are bounded by 
                           
                              
                                 A
                              
                              
                                 y
                                 
                                    max
                                 
                              
                           
                           ,
                           
                              
                                 A
                              
                              
                                 z
                                 
                                    max
                                 
                              
                           
                         (see Fig. 6(b) and (c)).

For the given data of the Butterfly curve  [12], we segment it to five parts and fit them by quadratic B-spline curves. Two adjacent curves have the same tangent direction at their common end point. These five segments can finally be composed to one B-spline curve. Setting the error bound to 0.1 mm, we fit the data using distance constraints. The given data and its fitting curve are shown in Fig. 7
                        (a) and (b). The fitting error is illustrated in Fig. 7(c).

In the trajectory planning, the error bound, the maximum velocity and acceleration bounds are set as 0.1 mm, 
                           
                              
                                 V
                              
                              
                                 
                                    max
                                 
                              
                           
                           =
                           200
                           
                           
                              mm
                           
                           /
                           
                              s
                           
                         and 
                           
                              
                                 A
                              
                              
                                 x
                                 
                                    max
                                 
                              
                           
                           =
                           
                              
                                 A
                              
                              
                                 y
                                 
                                    max
                                 
                              
                           
                           =
                           1000
                           
                           
                              mm
                           
                           /
                           
                              
                                 
                                    s
                                 
                              
                              
                                 2
                              
                           
                         respectively. We have five B-spline curve segments with large curvatures at their end points. Hence, we set the velocity to zero at the end points of each curve segment. Fig. 8
                        (a) shows that the final curve satisfies the error condition, whose velocity curve is shown in Fig. 8(b) and the 
                           x
                        - and 
                           y
                        -axis acceleration curves are illustrated in Fig. 8(c) and (d), respectively. One can find that the 
                           x
                        - or 
                           y
                        -axis acceleration reaches the maximum value at any time since the velocity does not reach its boundary.

According to the results, we can get the fitting quadratic B-spline curve within the confined error. By the methods of [11,21], we solve the time optimal feedrate problem for the fitting curve Fig. 7(a) with the given bounds, the machining time is 5.37 s. The trajectory planning with the confined error takes 4.33 s in total (see Fig. 8) which show that this two-in-one strategy leads to better path than the traditional decoupled model of curve fitting and interpolation.

For the fitting curve of the butterfly, we interpolate the curve with sampling time 0.002 s, or equivalently, discretize the path according to the time parameter with 0.002 s. Then we simulate the manufacture process on these discrete points using Simulink in Matlab. Fig. 9
                        (a) is the simulation result of the butterfly curve output from the simulated CNC machine. Due to unexpected influences of the machine controller, each axis will generate a certain position deviation. Fig. 9(b) shows the differences of simulation output and the corresponding input points. The position errors are illustrated as two error curves corresponding to 
                           x
                        -axis deviation (solid line) and 
                           y
                        -axis deviation (dotted line).

Finally, we compute the error between the original data and the simulated curve (see Fig. 9(c)). The simulated curve is not bounded by the given error since the disturbances associated with the machine controllers are beyond the scope of this paper. Notice that the simulated curve have lots of points out of expected error control. The reason is that our pursuit for optimal machining time leads to the touching of lots of points to the error boundary in trajectory planning (see Fig. 8(a)).

@&#CONCLUSION@&#

This paper discusses the curve fitting method from the prospect of ensuring the distance between the fitting curve and the polylines given by the G01 codes within a certain accuracy. To meet the error control for the distance between the curve segments and polylines, two methods are proposed: the first sets the exact distance between the curve segments and polylines as constraints in the optimization model, while the second is to discretize the offsets as the boundary obstacles in the process of solving optimization problem. The first method is based on the distance computation and approximation, hence is efficient for quadratic B-spline curve fitting and can minimize the distance. The second method proposes a numerical way which is easy to be generalized to higher order spline curve, but the obstacle constraints depend on density of the discrete points.

Instead of fitting the curve and planning the velocity curve separately, we combine these two processes by letting the curve be time-parameterized. The ideal is to minimize the machining time as possible as we can under the confined error, velocity and acceleration bounds.

Our optimization model is designed for a quadratic B-spline locally. As a future work, we shall consider the best global velocity blending for B-spline segments.

@&#ACKNOWLEDGMENTS@&#

This project is partially supported by Beijing Nova Program (Z121104002512065), a National Key Basic Research Project of China (2011CB302400) and by grants from NSFC (60821002, 11101411).


                     
                        Proof
                        Let the point 
                              
                                 p
                              
                              ∈
                              
                                 
                                    
                                       
                                          
                                             p
                                          
                                       
                                       
                                          k
                                       
                                    
                                    
                                       
                                          
                                             p
                                          
                                       
                                       
                                          k
                                          +
                                          1
                                       
                                    
                                 
                                 ¯
                              
                            have the maximum distance to 
                              
                                 
                                    
                                       
                                          
                                             f
                                          
                                       
                                       
                                          k
                                       
                                    
                                    
                                       
                                          
                                             f
                                          
                                       
                                       
                                          k
                                          +
                                          1
                                       
                                    
                                 
                                 
                                    ˜
                                 
                              
                           . If 
                              
                                 
                                    
                                       (
                                       
                                          
                                             
                                                p
                                             
                                          
                                          
                                             k
                                             +
                                             1
                                          
                                       
                                       −
                                       
                                          
                                             
                                                p
                                             
                                          
                                          
                                             k
                                          
                                       
                                       )
                                    
                                 
                                 
                                    T
                                 
                              
                              
                                 (
                                 
                                    f
                                 
                                 
                                    (
                                    
                                       
                                          s
                                       
                                       
                                          k
                                       
                                    
                                    )
                                 
                                 −
                                 
                                    p
                                 
                                 )
                              
                              ≥
                              0
                           , i.e., 
                              
                                 
                                    
                                       (
                                       
                                          
                                             
                                                p
                                             
                                          
                                          
                                             k
                                          
                                       
                                       −
                                       
                                          p
                                       
                                       )
                                    
                                 
                                 
                                    T
                                 
                              
                              
                                 (
                                 
                                    f
                                 
                                 
                                    (
                                    
                                       
                                          s
                                       
                                       
                                          k
                                       
                                    
                                    )
                                 
                                 −
                                 
                                    p
                                 
                                 )
                              
                              <
                              0
                            (see Fig. A.1
                           (a)), then we have 
                              d
                              
                                 (
                                 
                                    p
                                 
                                 ,
                                 
                                    f
                                 
                                 
                                    (
                                    
                                       
                                          s
                                       
                                       
                                          k
                                       
                                    
                                    )
                                 
                                 
                                    f
                                 
                                 
                                    (
                                    
                                       
                                          s
                                       
                                       
                                          k
                                          +
                                          1
                                       
                                    
                                    )
                                 
                                 )
                              
                              ≤
                              d
                              
                                 (
                                 
                                    f
                                 
                                 
                                    (
                                    
                                       
                                          s
                                       
                                       
                                          k
                                       
                                    
                                    )
                                 
                                 ,
                                 
                                    p
                                 
                                 )
                              
                              ≤
                              
                                 
                                    d
                                 
                                 
                                    k
                                 
                              
                            by the properties of obtuse triangle. If 
                              
                                 
                                    
                                       (
                                       
                                          
                                             
                                                p
                                             
                                          
                                          
                                             k
                                             +
                                             1
                                          
                                       
                                       −
                                       
                                          
                                             
                                                p
                                             
                                          
                                          
                                             k
                                          
                                       
                                       )
                                    
                                 
                                 
                                    T
                                 
                              
                              
                                 (
                                 
                                    f
                                 
                                 
                                    (
                                    
                                       
                                          s
                                       
                                       
                                          k
                                          +
                                          1
                                       
                                    
                                    )
                                 
                                 −
                                 
                                    p
                                 
                                 )
                              
                              ≤
                              0
                           , we have 
                              d
                              
                                 (
                                 
                                    p
                                 
                                 ,
                                 
                                    f
                                 
                                 
                                    (
                                    
                                       
                                          s
                                       
                                       
                                          k
                                       
                                    
                                    )
                                 
                                 
                                    f
                                 
                                 
                                    (
                                    
                                       
                                          s
                                       
                                       
                                          k
                                          +
                                          1
                                       
                                    
                                    )
                                 
                                 )
                              
                              ≤
                              
                                 
                                    d
                                 
                                 
                                    k
                                    +
                                    1
                                 
                              
                            similarly.

If 
                              
                                 
                                    
                                       (
                                       
                                          
                                             
                                                p
                                             
                                          
                                          
                                             k
                                             +
                                             1
                                          
                                       
                                       −
                                       
                                          
                                             
                                                p
                                             
                                          
                                          
                                             k
                                          
                                       
                                       )
                                    
                                 
                                 
                                    T
                                 
                              
                              
                                 (
                                 
                                    f
                                 
                                 
                                    (
                                    
                                       
                                          s
                                       
                                       
                                          k
                                       
                                    
                                    )
                                 
                                 −
                                 
                                    p
                                 
                                 )
                              
                              <
                              0
                            and 
                              
                                 
                                    
                                       (
                                       
                                          
                                             
                                                p
                                             
                                          
                                          
                                             k
                                             +
                                             1
                                          
                                       
                                       −
                                       
                                          
                                             
                                                p
                                             
                                          
                                          
                                             k
                                          
                                       
                                       )
                                    
                                 
                                 
                                    T
                                 
                              
                              
                                 (
                                 
                                    f
                                 
                                 
                                    (
                                    
                                       
                                          s
                                       
                                       
                                          k
                                          +
                                          1
                                       
                                    
                                    )
                                 
                                 −
                                 
                                    p
                                 
                                 )
                              
                              >
                              0
                            (see Fig. A.1(b)), then there exists an 
                              
                                 
                                    s
                                 
                                 
                                    0
                                 
                              
                              ∈
                              
                                 [
                                 
                                    
                                       s
                                    
                                    
                                       k
                                    
                                 
                                 ,
                                 
                                    
                                       s
                                    
                                    
                                       k
                                       +
                                       1
                                    
                                 
                                 ]
                              
                            such that 
                              
                                 
                                    
                                       (
                                       
                                          
                                             
                                                p
                                             
                                          
                                          
                                             k
                                             +
                                             1
                                          
                                       
                                       −
                                       
                                          
                                             
                                                p
                                             
                                          
                                          
                                             k
                                          
                                       
                                       )
                                    
                                 
                                 
                                    T
                                 
                              
                              
                                 (
                                 
                                    f
                                 
                                 
                                    (
                                    
                                       
                                          s
                                       
                                       
                                          0
                                       
                                    
                                    )
                                 
                                 −
                                 
                                    p
                                 
                                 )
                              
                              =
                              0
                            since 
                              
                                 f
                              
                              
                                 (
                                 s
                                 )
                              
                            is continuously differentiable. Hence, 
                              d
                              
                                 (
                                 
                                    p
                                 
                                 ,
                                 
                                    f
                                 
                                 
                                    (
                                    
                                       
                                          s
                                       
                                       
                                          k
                                       
                                    
                                    )
                                 
                                 
                                    f
                                 
                                 
                                    (
                                    
                                       
                                          s
                                       
                                       
                                          k
                                          +
                                          1
                                       
                                    
                                    )
                                 
                                 )
                              
                              ≤
                              d
                              
                                 (
                                 
                                    f
                                 
                                 
                                    (
                                    
                                       
                                          s
                                       
                                       
                                          0
                                       
                                    
                                    )
                                 
                                 ,
                                 
                                    p
                                 
                                 )
                              
                              =
                              
                                 
                                    d
                                 
                                 
                                    p
                                    ,
                                    k
                                 
                              
                              
                                 (
                                 
                                    
                                       s
                                    
                                    
                                       0
                                    
                                 
                                 )
                              
                           .

On the other hand, let 
                              
                                 f
                              
                              
                                 (
                                 s
                                 )
                              
                              ∈
                              
                                 
                                    
                                       
                                          
                                             f
                                          
                                       
                                       
                                          k
                                       
                                    
                                    
                                       
                                          
                                             f
                                          
                                       
                                       
                                          k
                                          +
                                          1
                                       
                                    
                                 
                                 
                                    ˜
                                 
                              
                            have the maximum distance to 
                              
                                 
                                    
                                       
                                          
                                             p
                                          
                                       
                                       
                                          k
                                       
                                    
                                    
                                       
                                          
                                             p
                                          
                                       
                                       
                                          k
                                          +
                                          1
                                       
                                    
                                 
                                 ¯
                              
                           . We have 
                              
                                 
                                    d
                                 
                                 
                                    p
                                    ,
                                    k
                                 
                              
                              
                                 (
                                 s
                                 )
                              
                              ≤
                              
                                 
                                    d
                                 
                                 
                                    k
                                 
                              
                            if 
                              s
                              =
                              
                                 
                                    s
                                 
                                 
                                    k
                                 
                              
                            and 
                              
                                 
                                    d
                                 
                                 
                                    p
                                    ,
                                    k
                                    +
                                    1
                                 
                              
                              
                                 (
                                 s
                                 )
                              
                              ≤
                              
                                 
                                    d
                                 
                                 
                                    k
                                    +
                                    1
                                 
                              
                            if 
                              s
                              =
                              
                                 
                                    s
                                 
                                 
                                    k
                                    +
                                    1
                                 
                              
                           . If 
                              
                                 f
                              
                              
                                 (
                                 s
                                 )
                              
                            is not the ending points, there are three more cases: 
                              
                                 I.
                                 If 
                                       
                                          
                                             
                                                (
                                                
                                                   
                                                      
                                                         p
                                                      
                                                   
                                                   
                                                      k
                                                      +
                                                      1
                                                   
                                                
                                                −
                                                
                                                   
                                                      
                                                         p
                                                      
                                                   
                                                   
                                                      k
                                                   
                                                
                                                )
                                             
                                          
                                          
                                             T
                                          
                                       
                                       
                                          (
                                          
                                             f
                                          
                                          
                                             (
                                             s
                                             )
                                          
                                          −
                                          
                                             
                                                
                                                   p
                                                
                                             
                                             
                                                k
                                             
                                          
                                          )
                                       
                                       ≤
                                       0
                                     (see Fig. A.2
                                    (a)), we have 
                                       
                                          
                                             
                                                (
                                                
                                                   f
                                                
                                                
                                                   (
                                                   s
                                                   )
                                                
                                                −
                                                
                                                   
                                                      
                                                         p
                                                      
                                                   
                                                   
                                                      k
                                                   
                                                
                                                )
                                             
                                          
                                          
                                             T
                                          
                                       
                                       
                                          
                                             
                                                f
                                             
                                          
                                          
                                             ′
                                          
                                       
                                       
                                          (
                                          s
                                          )
                                       
                                       =
                                       0
                                     and 
                                       
                                          
                                             d
                                          
                                          
                                             p
                                             ,
                                             k
                                          
                                       
                                       
                                          (
                                          s
                                          )
                                       
                                       =
                                       
                                          ‖
                                          
                                             f
                                          
                                          
                                             (
                                             s
                                             )
                                          
                                          −
                                          
                                             
                                                
                                                   p
                                                
                                             
                                             
                                                k
                                             
                                          
                                          ‖
                                       
                                    ;

If 
                                       
                                          
                                             
                                                (
                                                
                                                   
                                                      
                                                         p
                                                      
                                                   
                                                   
                                                      k
                                                      +
                                                      1
                                                   
                                                
                                                −
                                                
                                                   
                                                      
                                                         p
                                                      
                                                   
                                                   
                                                      k
                                                   
                                                
                                                )
                                             
                                          
                                          
                                             T
                                          
                                       
                                       
                                          (
                                          
                                             f
                                          
                                          
                                             (
                                             s
                                             )
                                          
                                          −
                                          
                                             
                                                
                                                   p
                                                
                                             
                                             
                                                k
                                             
                                          
                                          )
                                       
                                       ≤
                                       0
                                    , we have 
                                       
                                          
                                             
                                                (
                                                
                                                   f
                                                
                                                
                                                   (
                                                   s
                                                   )
                                                
                                                −
                                                
                                                   
                                                      
                                                         p
                                                      
                                                   
                                                   
                                                      k
                                                      +
                                                      1
                                                   
                                                
                                                )
                                             
                                          
                                          
                                             T
                                          
                                       
                                       
                                          
                                             
                                                f
                                             
                                          
                                          
                                             ′
                                          
                                       
                                       
                                          (
                                          s
                                          )
                                       
                                       =
                                       0
                                     and 
                                       
                                          
                                             d
                                          
                                          
                                             p
                                             ,
                                             k
                                          
                                       
                                       
                                          (
                                          s
                                          )
                                       
                                       =
                                       
                                          ‖
                                          
                                             f
                                          
                                          
                                             (
                                             s
                                             )
                                          
                                          −
                                          
                                             
                                                
                                                   p
                                                
                                             
                                             
                                                k
                                                +
                                                1
                                             
                                          
                                          ‖
                                       
                                    ;

If 
                                       
                                          
                                             
                                                (
                                                
                                                   
                                                      
                                                         p
                                                      
                                                   
                                                   
                                                      k
                                                      +
                                                      1
                                                   
                                                
                                                −
                                                
                                                   
                                                      
                                                         p
                                                      
                                                   
                                                   
                                                      k
                                                   
                                                
                                                )
                                             
                                          
                                          
                                             T
                                          
                                       
                                       
                                          (
                                          
                                             f
                                          
                                          
                                             (
                                             s
                                             )
                                          
                                          −
                                          
                                             
                                                
                                                   p
                                                
                                             
                                             
                                                k
                                                +
                                                1
                                             
                                          
                                          )
                                       
                                       <
                                       0
                                     and 
                                       
                                          
                                             
                                                (
                                                
                                                   
                                                      
                                                         p
                                                      
                                                   
                                                   
                                                      k
                                                      +
                                                      1
                                                   
                                                
                                                −
                                                
                                                   
                                                      
                                                         p
                                                      
                                                   
                                                   
                                                      k
                                                   
                                                
                                                )
                                             
                                          
                                          
                                             T
                                          
                                       
                                       
                                          (
                                          
                                             f
                                          
                                          
                                             (
                                             s
                                             )
                                          
                                          −
                                          
                                             
                                                
                                                   p
                                                
                                             
                                             
                                                k
                                             
                                          
                                          )
                                       
                                       >
                                       0
                                     (see Fig. A.2(b)), we have 
                                       
                                          
                                             
                                                (
                                                
                                                   
                                                      
                                                         p
                                                      
                                                   
                                                   
                                                      k
                                                      +
                                                      1
                                                   
                                                
                                                −
                                                
                                                   
                                                      
                                                         p
                                                      
                                                   
                                                   
                                                      k
                                                   
                                                
                                                )
                                             
                                          
                                          
                                             T
                                          
                                       
                                       J
                                       
                                          
                                             
                                                f
                                             
                                          
                                          
                                             ′
                                          
                                       
                                       
                                          (
                                          s
                                          )
                                       
                                       /
                                       
                                          ‖
                                          
                                             
                                                
                                                   p
                                                
                                             
                                             
                                                k
                                                +
                                                1
                                             
                                          
                                          −
                                          
                                             
                                                
                                                   p
                                                
                                             
                                             
                                                k
                                             
                                          
                                          ‖
                                       
                                       =
                                       0
                                     and 
                                       
                                          
                                             d
                                          
                                          
                                             p
                                             ,
                                             k
                                          
                                       
                                       
                                          (
                                          s
                                          )
                                       
                                       =
                                       
                                          |
                                          
                                             
                                                
                                                   
                                                      
                                                         (
                                                         
                                                            
                                                               
                                                                  p
                                                               
                                                            
                                                            
                                                               k
                                                               +
                                                               1
                                                            
                                                         
                                                         −
                                                         
                                                            
                                                               
                                                                  p
                                                               
                                                            
                                                            
                                                               k
                                                            
                                                         
                                                         )
                                                      
                                                   
                                                   
                                                      T
                                                   
                                                
                                             
                                             
                                                
                                                   ‖
                                                   
                                                      
                                                         
                                                            p
                                                         
                                                      
                                                      
                                                         k
                                                         +
                                                         1
                                                      
                                                   
                                                   −
                                                   
                                                      
                                                         
                                                            p
                                                         
                                                      
                                                      
                                                         k
                                                      
                                                   
                                                   ‖
                                                
                                             
                                          
                                          J
                                          
                                             (
                                             
                                                f
                                             
                                             
                                                (
                                                s
                                                )
                                             
                                             −
                                             
                                                
                                                   
                                                      p
                                                   
                                                
                                                
                                                   k
                                                
                                             
                                             )
                                          
                                          |
                                       
                                    .□


                     
                        Proof
                        The case 1 is similar to the case 2, so we only need to prove the case 2 and case 3 (see Fig. B.3
                           ).

Case 2: Find the three solutions of 
                              
                                 
                                    
                                       (
                                       
                                          f
                                       
                                       
                                          (
                                          
                                             
                                                s
                                             
                                             
                                                m
                                             
                                          
                                          )
                                       
                                       −
                                       
                                          
                                             
                                                p
                                             
                                          
                                          
                                             k
                                             +
                                             1
                                          
                                       
                                       )
                                    
                                 
                                 
                                    T
                                 
                              
                              
                                 
                                    
                                       f
                                    
                                 
                                 
                                    ′
                                 
                              
                              
                                 (
                                 
                                    
                                       s
                                    
                                    
                                       m
                                    
                                 
                                 )
                              
                              =
                              0
                           . Since 
                              
                                 f
                              
                              
                                 (
                                 s
                                 )
                              
                            is quadratic, there is a unique 
                              
                                 
                                    s
                                 
                                 
                                    m
                                 
                              
                            such that 
                              
                                 
                                    
                                       (
                                       
                                          f
                                       
                                       
                                          (
                                          
                                             
                                                s
                                             
                                             
                                                m
                                             
                                          
                                          )
                                       
                                       −
                                       
                                          
                                             
                                                p
                                             
                                          
                                          
                                             k
                                             +
                                             1
                                          
                                       
                                       )
                                    
                                 
                                 
                                    T
                                 
                              
                              
                                 
                                    
                                       f
                                    
                                 
                                 
                                    ″
                                 
                              
                              
                                 (
                                 
                                    
                                       s
                                    
                                    
                                       m
                                    
                                 
                                 )
                              
                              +
                              
                                 
                                    
                                       ‖
                                       
                                          
                                             
                                                f
                                             
                                          
                                          
                                             ′
                                          
                                       
                                       
                                          (
                                          
                                             
                                                s
                                             
                                             
                                                m
                                             
                                          
                                          )
                                       
                                       ‖
                                    
                                 
                                 
                                    2
                                 
                              
                              ≤
                              0
                            if exists, i.e., the greatest distance from 
                              
                                 f
                              
                              
                                 (
                                 s
                                 )
                              
                            to 
                              
                                 
                                    
                                       p
                                    
                                 
                                 
                                    k
                                    +
                                    1
                                 
                              
                            occurs at 
                              
                                 
                                    s
                                 
                                 
                                    m
                                 
                              
                           . Then the distance constraint 
                              
                                 (B.1)
                                 
                                    
                                       
                                          g
                                       
                                       
                                          2
                                       
                                    
                                    
                                       (
                                       
                                          c
                                       
                                       )
                                    
                                    =
                                    
                                       
                                          
                                             (
                                             
                                                
                                                   
                                                      f
                                                   
                                                
                                                
                                                   i
                                                
                                             
                                             
                                                (
                                                
                                                   
                                                      s
                                                   
                                                   
                                                      m
                                                   
                                                
                                                )
                                             
                                             −
                                             
                                                
                                                   
                                                      p
                                                   
                                                
                                                
                                                   k
                                                   +
                                                   1
                                                
                                             
                                             )
                                          
                                       
                                       
                                          T
                                       
                                    
                                    
                                       (
                                       
                                          
                                             
                                                f
                                             
                                          
                                          
                                             i
                                          
                                       
                                       
                                          (
                                          
                                             
                                                s
                                             
                                             
                                                m
                                             
                                          
                                          )
                                       
                                       −
                                       
                                          
                                             
                                                p
                                             
                                          
                                          
                                             k
                                             +
                                             1
                                          
                                       
                                       )
                                    
                                    ≤
                                    
                                       
                                          ε
                                       
                                       
                                          2
                                       
                                    
                                 
                              
                            can be expanded in the form of 
                              
                                 
                                    
                                       c
                                    
                                 
                                 
                                    T
                                 
                              
                              
                                 
                                    
                                       B
                                    
                                 
                                 
                                    T
                                 
                              
                              
                                 (
                                 
                                    
                                       s
                                    
                                    
                                       m
                                    
                                 
                                 )
                              
                              
                                 B
                              
                              
                                 (
                                 
                                    
                                       s
                                    
                                    
                                       m
                                    
                                 
                                 )
                              
                              
                                 c
                              
                              −
                              2
                              
                                 
                                    
                                       p
                                    
                                 
                                 
                                    k
                                    +
                                    1
                                 
                                 
                                    T
                                 
                              
                              
                                 B
                              
                              
                                 (
                                 
                                    
                                       s
                                    
                                    
                                       m
                                    
                                 
                                 )
                              
                              
                                 c
                              
                              +
                              
                                 
                                    
                                       p
                                    
                                 
                                 
                                    k
                                    +
                                    1
                                 
                                 
                                    T
                                 
                              
                              
                                 
                                    
                                       p
                                    
                                 
                                 
                                    k
                                    +
                                    1
                                 
                              
                              −
                              
                                 
                                    ε
                                 
                                 
                                    2
                                 
                              
                              ≤
                              0
                           . Similarly, the distance constraint of case 1 is 
                              
                                 (B.2)
                                 
                                    
                                       
                                          g
                                       
                                       
                                          1
                                       
                                    
                                    
                                       (
                                       
                                          c
                                       
                                       )
                                    
                                    =
                                    
                                       
                                          
                                             (
                                             
                                                
                                                   
                                                      f
                                                   
                                                
                                                
                                                   i
                                                
                                             
                                             
                                                (
                                                
                                                   
                                                      s
                                                   
                                                   
                                                      m
                                                   
                                                
                                                )
                                             
                                             −
                                             
                                                
                                                   
                                                      p
                                                   
                                                
                                                
                                                   k
                                                
                                             
                                             )
                                          
                                       
                                       
                                          T
                                       
                                    
                                    
                                       (
                                       
                                          
                                             
                                                f
                                             
                                          
                                          
                                             i
                                          
                                       
                                       
                                          (
                                          
                                             
                                                s
                                             
                                             
                                                m
                                             
                                          
                                          )
                                       
                                       −
                                       
                                          
                                             
                                                p
                                             
                                          
                                          
                                             k
                                          
                                       
                                       )
                                    
                                    ≤
                                    
                                       
                                          ε
                                       
                                       
                                          2
                                       
                                    
                                    ,
                                 
                              
                            which can be expanded as the form of 
                              
                                 
                                    
                                       c
                                    
                                 
                                 
                                    T
                                 
                              
                              
                                 
                                    
                                       B
                                    
                                 
                                 
                                    T
                                 
                              
                              
                                 (
                                 
                                    
                                       s
                                    
                                    
                                       m
                                    
                                 
                                 )
                              
                              
                                 B
                              
                              
                                 (
                                 
                                    
                                       s
                                    
                                    
                                       m
                                    
                                 
                                 )
                              
                              
                                 c
                              
                              −
                              2
                              
                                 
                                    
                                       p
                                    
                                 
                                 
                                    k
                                 
                                 
                                    T
                                 
                              
                              
                                 B
                              
                              
                                 (
                                 
                                    
                                       s
                                    
                                    
                                       m
                                    
                                 
                                 )
                              
                              
                                 c
                              
                              +
                              
                                 
                                    
                                       p
                                    
                                 
                                 
                                    k
                                 
                                 
                                    T
                                 
                              
                              
                                 
                                    
                                       p
                                    
                                 
                                 
                                    k
                                 
                              
                              −
                              
                                 
                                    ε
                                 
                                 
                                    2
                                 
                              
                              ≤
                              0
                           .

Case 3: 
                              
                                 
                                    
                                       (
                                       
                                          
                                             
                                                p
                                             
                                          
                                          
                                             k
                                             +
                                             1
                                          
                                       
                                       −
                                       
                                          
                                             
                                                p
                                             
                                          
                                          
                                             k
                                          
                                       
                                       )
                                    
                                 
                                 
                                    T
                                 
                              
                              J
                              
                                 
                                    
                                       f
                                    
                                 
                                 
                                    ′
                                 
                              
                              
                                 (
                                 
                                    
                                       s
                                    
                                    
                                       m
                                    
                                 
                                 )
                              
                              =
                              0
                            means that the tangent line of 
                              
                                 
                                    
                                       f
                                    
                                 
                                 
                                    i
                                 
                              
                              
                                 (
                                 s
                                 )
                              
                            at 
                              
                                 
                                    s
                                 
                                 
                                    m
                                 
                              
                            is parallel to line segment 
                              
                                 
                                    
                                       p
                                    
                                 
                                 
                                    k
                                 
                              
                              
                                 
                                    
                                       p
                                    
                                 
                                 
                                    k
                                    +
                                    1
                                 
                              
                           . Let the slope of 
                              
                                 
                                    
                                       p
                                    
                                 
                                 
                                    k
                                 
                              
                              
                                 
                                    
                                       p
                                    
                                 
                                 
                                    k
                                    +
                                    1
                                 
                              
                            be 
                              
                                 
                                    k
                                 
                                 
                                    k
                                 
                              
                           , then we have 
                              
                                 (B.3)
                                 
                                    
                                       
                                          
                                             
                                                y
                                             
                                             
                                                ′
                                             
                                          
                                          
                                             (
                                             
                                                
                                                   s
                                                
                                                
                                                   m
                                                
                                             
                                             )
                                          
                                       
                                       
                                          
                                             
                                                x
                                             
                                             
                                                ′
                                             
                                          
                                          
                                             (
                                             
                                                
                                                   s
                                                
                                                
                                                   m
                                                
                                             
                                             )
                                          
                                       
                                    
                                    =
                                    
                                       
                                          
                                             
                                                
                                                   (
                                                   
                                                      
                                                         s
                                                      
                                                      
                                                         m
                                                      
                                                   
                                                   −
                                                   
                                                      
                                                         τ
                                                      
                                                      
                                                         i
                                                      
                                                   
                                                   )
                                                
                                                
                                                   (
                                                   
                                                      
                                                         y
                                                      
                                                      
                                                         i
                                                      
                                                   
                                                   −
                                                   
                                                      
                                                         y
                                                      
                                                      
                                                         i
                                                         −
                                                         1
                                                      
                                                   
                                                   )
                                                
                                             
                                             
                                                
                                                   (
                                                   
                                                      
                                                         τ
                                                      
                                                      
                                                         i
                                                         +
                                                         2
                                                      
                                                   
                                                   −
                                                   
                                                      
                                                         τ
                                                      
                                                      
                                                         i
                                                      
                                                   
                                                   )
                                                
                                             
                                          
                                          +
                                          
                                             
                                                
                                                   (
                                                   
                                                      
                                                         s
                                                      
                                                      
                                                         m
                                                      
                                                   
                                                   −
                                                   
                                                      
                                                         τ
                                                      
                                                      
                                                         i
                                                         +
                                                         1
                                                      
                                                   
                                                   )
                                                
                                                
                                                   (
                                                   
                                                      
                                                         y
                                                      
                                                      
                                                         i
                                                         −
                                                         2
                                                      
                                                   
                                                   −
                                                   
                                                      
                                                         y
                                                      
                                                      
                                                         i
                                                         −
                                                         1
                                                      
                                                   
                                                   )
                                                
                                             
                                             
                                                
                                                   (
                                                   
                                                      
                                                         τ
                                                      
                                                      
                                                         i
                                                         +
                                                         1
                                                      
                                                   
                                                   −
                                                   
                                                      
                                                         τ
                                                      
                                                      
                                                         i
                                                         −
                                                         1
                                                      
                                                   
                                                   )
                                                
                                             
                                          
                                       
                                       
                                          
                                             
                                                
                                                   (
                                                   
                                                      
                                                         s
                                                      
                                                      
                                                         m
                                                      
                                                   
                                                   −
                                                   
                                                      
                                                         τ
                                                      
                                                      
                                                         i
                                                      
                                                   
                                                   )
                                                
                                                
                                                   (
                                                   
                                                      
                                                         x
                                                      
                                                      
                                                         i
                                                      
                                                   
                                                   −
                                                   
                                                      
                                                         x
                                                      
                                                      
                                                         i
                                                         −
                                                         1
                                                      
                                                   
                                                   )
                                                
                                             
                                             
                                                
                                                   (
                                                   
                                                      
                                                         τ
                                                      
                                                      
                                                         i
                                                         +
                                                         2
                                                      
                                                   
                                                   −
                                                   
                                                      
                                                         τ
                                                      
                                                      
                                                         i
                                                      
                                                   
                                                   )
                                                
                                             
                                          
                                          +
                                          
                                             
                                                
                                                   (
                                                   
                                                      
                                                         s
                                                      
                                                      
                                                         m
                                                      
                                                   
                                                   −
                                                   
                                                      
                                                         τ
                                                      
                                                      
                                                         i
                                                         +
                                                         1
                                                      
                                                   
                                                   )
                                                
                                                
                                                   (
                                                   
                                                      
                                                         x
                                                      
                                                      
                                                         i
                                                         −
                                                         2
                                                      
                                                   
                                                   −
                                                   
                                                      
                                                         x
                                                      
                                                      
                                                         i
                                                         −
                                                         1
                                                      
                                                   
                                                   )
                                                
                                             
                                             
                                                
                                                   (
                                                   
                                                      
                                                         τ
                                                      
                                                      
                                                         i
                                                         +
                                                         1
                                                      
                                                   
                                                   −
                                                   
                                                      
                                                         τ
                                                      
                                                      
                                                         i
                                                         −
                                                         1
                                                      
                                                   
                                                   )
                                                
                                             
                                          
                                       
                                    
                                    =
                                    
                                       
                                          k
                                       
                                       
                                          k
                                       
                                    
                                    .
                                 
                              
                            It has a unique solution 
                              
                                 (B.4)
                                 
                                    
                                       
                                          s
                                       
                                       
                                          m
                                       
                                    
                                    =
                                    
                                       
                                          
                                             
                                                τ
                                             
                                             
                                                i
                                             
                                          
                                          
                                             (
                                             
                                                
                                                   τ
                                                
                                                
                                                   i
                                                   +
                                                   1
                                                
                                             
                                             −
                                             
                                                
                                                   τ
                                                
                                                
                                                   i
                                                   −
                                                   1
                                                
                                             
                                             )
                                          
                                          
                                             
                                                A
                                             
                                             
                                                i
                                             
                                          
                                          −
                                          
                                             
                                                τ
                                             
                                             
                                                i
                                                +
                                                1
                                             
                                          
                                          
                                             (
                                             
                                                
                                                   τ
                                                
                                                
                                                   i
                                                   +
                                                   2
                                                
                                             
                                             −
                                             
                                                
                                                   τ
                                                
                                                
                                                   i
                                                
                                             
                                             )
                                          
                                          ,
                                          
                                             
                                                A
                                             
                                             
                                                i
                                                −
                                                1
                                             
                                          
                                       
                                       
                                          
                                             (
                                             
                                                
                                                   τ
                                                
                                                
                                                   i
                                                   +
                                                   1
                                                
                                             
                                             −
                                             
                                                
                                                   τ
                                                
                                                
                                                   i
                                                   −
                                                   1
                                                
                                             
                                             )
                                          
                                          
                                             
                                                A
                                             
                                             
                                                i
                                             
                                          
                                          −
                                          
                                             (
                                             
                                                
                                                   τ
                                                
                                                
                                                   i
                                                   +
                                                   2
                                                
                                             
                                             −
                                             
                                                
                                                   τ
                                                
                                                
                                                   i
                                                
                                             
                                             )
                                          
                                          
                                             
                                                A
                                             
                                             
                                                i
                                                −
                                                1
                                             
                                          
                                       
                                    
                                    ,
                                 
                              
                            where 
                              
                                 
                                    A
                                 
                                 
                                    i
                                 
                              
                              =
                              
                                 (
                                 −
                                 
                                    
                                       k
                                    
                                    
                                       k
                                    
                                 
                                 ,
                                 1
                                 )
                              
                              
                                 (
                                 
                                    
                                       
                                          c
                                       
                                    
                                    
                                       i
                                    
                                 
                                 −
                                 
                                    
                                       
                                          c
                                       
                                    
                                    
                                       i
                                       −
                                       1
                                    
                                 
                                 )
                              
                           , 
                              
                                 
                                    A
                                 
                                 
                                    i
                                    −
                                    1
                                 
                              
                              =
                              
                                 (
                                 −
                                 
                                    
                                       k
                                    
                                    
                                       k
                                    
                                 
                                 ,
                                 1
                                 )
                              
                              
                                 (
                                 
                                    
                                       
                                          c
                                       
                                    
                                    
                                       i
                                       −
                                       1
                                    
                                 
                                 −
                                 
                                    
                                       
                                          c
                                       
                                    
                                    
                                       i
                                       −
                                       2
                                    
                                 
                                 )
                              
                           . Now the distance constraint 
                              
                                 |
                                 
                                    
                                       
                                          (
                                          
                                             
                                                
                                                   p
                                                
                                             
                                             
                                                k
                                                +
                                                1
                                             
                                          
                                          −
                                          
                                             
                                                
                                                   p
                                                
                                             
                                             
                                                k
                                             
                                          
                                          )
                                       
                                    
                                    
                                       T
                                    
                                 
                                 J
                                 
                                    (
                                    
                                       
                                          
                                             f
                                          
                                       
                                       
                                          i
                                       
                                    
                                    
                                       (
                                       
                                          
                                             s
                                          
                                          
                                             m
                                          
                                       
                                       )
                                    
                                    −
                                    
                                       
                                          
                                             p
                                          
                                       
                                       
                                          k
                                       
                                    
                                    )
                                 
                                 |
                              
                              /
                              
                                 
                                    L
                                 
                                 
                                    k
                                 
                              
                              ≤
                              ε
                            can be written as 
                              
                                 (B.5)
                                 
                                    
                                       
                                          
                                             p
                                          
                                       
                                       
                                          k
                                          +
                                          1
                                       
                                       
                                          T
                                       
                                    
                                    J
                                    
                                       
                                          
                                             p
                                          
                                       
                                       
                                          k
                                       
                                    
                                    −
                                    ε
                                    
                                       
                                          L
                                       
                                       
                                          k
                                       
                                    
                                    ≤
                                    
                                       
                                          
                                             (
                                             
                                                
                                                   
                                                      p
                                                   
                                                
                                                
                                                   k
                                                   +
                                                   1
                                                
                                             
                                             −
                                             
                                                
                                                   
                                                      p
                                                   
                                                
                                                
                                                   k
                                                
                                             
                                             )
                                          
                                       
                                       
                                          T
                                       
                                    
                                    J
                                    
                                       B
                                    
                                    
                                       (
                                       
                                          
                                             s
                                          
                                          
                                             m
                                          
                                       
                                       )
                                    
                                    
                                       c
                                    
                                    ≤
                                    
                                       
                                          
                                             p
                                          
                                       
                                       
                                          k
                                          +
                                          1
                                       
                                       
                                          T
                                       
                                    
                                    J
                                    
                                       
                                          
                                             p
                                          
                                       
                                       
                                          k
                                       
                                    
                                    +
                                    ε
                                    
                                       
                                          L
                                       
                                       
                                          k
                                       
                                    
                                    .
                                 
                              
                           
                           □

For case 1 and case 2, we can give linear approximations for the quadratic constraints by series expansion at 
                        
                           c
                        
                     . Computing the differential at 
                        
                           
                              
                                 c
                              
                           
                           
                              j
                           
                        
                        ,
                        j
                        =
                        i
                        ,
                        i
                        −
                        1
                        ,
                        i
                        −
                        2
                     
                     
                        
                           (C.1)
                           
                              
                                 
                                    ∂
                                    
                                       
                                          g
                                       
                                       
                                          1
                                       
                                    
                                    
                                       (
                                       
                                          c
                                       
                                       )
                                    
                                 
                                 
                                    ∂
                                    
                                       
                                          
                                             c
                                          
                                       
                                       
                                          j
                                       
                                    
                                 
                              
                              =
                              2
                              
                                 
                                    
                                       (
                                       
                                          f
                                       
                                       
                                          (
                                          
                                             
                                                s
                                             
                                             
                                                m
                                             
                                          
                                          )
                                       
                                       −
                                       
                                          
                                             
                                                p
                                             
                                          
                                          
                                             k
                                          
                                       
                                       )
                                    
                                 
                                 
                                    T
                                 
                              
                              
                                 
                                    ∂
                                    
                                       
                                          
                                             f
                                          
                                       
                                       
                                          i
                                       
                                    
                                    
                                       (
                                       
                                          
                                             s
                                          
                                          
                                             m
                                          
                                       
                                       )
                                    
                                 
                                 
                                    ∂
                                    
                                       
                                          
                                             c
                                          
                                       
                                       
                                          j
                                       
                                    
                                 
                              
                              ,
                              
                              
                                 
                                    ∂
                                    
                                       
                                          g
                                       
                                       
                                          2
                                       
                                    
                                    
                                       (
                                       
                                          c
                                       
                                       )
                                    
                                 
                                 
                                    ∂
                                    
                                       
                                          
                                             c
                                          
                                       
                                       
                                          j
                                       
                                    
                                 
                              
                              =
                              2
                              
                                 
                                    
                                       (
                                       
                                          f
                                       
                                       
                                          (
                                          
                                             
                                                s
                                             
                                             
                                                m
                                             
                                          
                                          )
                                       
                                       −
                                       
                                          
                                             
                                                p
                                             
                                          
                                          
                                             k
                                             +
                                             1
                                          
                                       
                                       )
                                    
                                 
                                 
                                    T
                                 
                              
                              
                                 
                                    ∂
                                    
                                       
                                          
                                             f
                                          
                                       
                                       
                                          i
                                       
                                    
                                    
                                       (
                                       
                                          
                                             s
                                          
                                          
                                             m
                                          
                                       
                                       )
                                    
                                 
                                 
                                    ∂
                                    
                                       
                                          
                                             c
                                          
                                       
                                       
                                          j
                                       
                                    
                                 
                              
                              ,
                           
                        
                      then the linear approximations are 
                        
                           (C.2)
                           
                              
                                 
                                    ∇
                                 
                                 
                                    
                                       c
                                    
                                 
                              
                              
                                 
                                    g
                                 
                                 
                                    1
                                 
                              
                              
                                 
                                    
                                       (
                                       
                                          c
                                       
                                       )
                                    
                                 
                                 
                                    T
                                 
                              
                              δ
                              
                                 c
                              
                              ≤
                              
                                 
                                    ε
                                 
                                 
                                    2
                                 
                              
                              −
                              
                                 
                                    g
                                 
                                 
                                    1
                                 
                              
                              
                                 (
                                 
                                    c
                                 
                                 )
                              
                              ,
                              
                              
                                 
                                    ∇
                                 
                                 
                                    
                                       c
                                    
                                 
                              
                              
                                 
                                    g
                                 
                                 
                                    2
                                 
                              
                              
                                 
                                    
                                       (
                                       
                                          c
                                       
                                       )
                                    
                                 
                                 
                                    T
                                 
                              
                              δ
                              
                                 c
                              
                              ≤
                              
                                 
                                    ε
                                 
                                 
                                    2
                                 
                              
                              −
                              
                                 
                                    g
                                 
                                 
                                    2
                                 
                              
                              
                                 (
                                 
                                    c
                                 
                                 )
                              
                              .
                           
                        
                     
                  

For general case 3, we use a linear approximation, that is, replacing 
                        
                           
                              s
                           
                           
                              m
                           
                        
                        
                           (
                           
                              c
                           
                           +
                           δ
                           
                              c
                           
                           )
                        
                      by 
                        
                           
                              s
                           
                           
                              m
                           
                        
                        
                           (
                           
                              c
                           
                           )
                        
                     . By (B.4), the differentials of 
                        
                           
                              s
                           
                           
                              m
                           
                        
                      at 
                        
                           
                              
                                 c
                              
                           
                           
                              j
                           
                        
                        ,
                        
                        j
                        =
                        i
                        ,
                        i
                        −
                        1
                        ,
                        i
                        −
                        2
                      are 
                        
                           (C.3)
                           
                              
                                 
                                    ∂
                                    
                                       
                                          s
                                       
                                       
                                          m
                                       
                                    
                                 
                                 
                                    ∂
                                    
                                       
                                          
                                             c
                                          
                                       
                                       
                                          i
                                       
                                    
                                 
                              
                              =
                              
                                 
                                    A
                                 
                                 
                                    i
                                    −
                                    1
                                 
                              
                              D
                              ,
                              
                              
                                 
                                    ∂
                                    
                                       
                                          s
                                       
                                       
                                          m
                                       
                                    
                                 
                                 
                                    ∂
                                    
                                       
                                          
                                             c
                                          
                                       
                                       
                                          i
                                          −
                                          1
                                       
                                    
                                 
                              
                              =
                              
                                 (
                                 
                                    
                                       A
                                    
                                    
                                       i
                                       −
                                       1
                                    
                                 
                                 +
                                 
                                    
                                       A
                                    
                                    
                                       i
                                    
                                 
                                 )
                              
                              D
                              ,
                              
                              
                                 
                                    ∂
                                    
                                       
                                          s
                                       
                                       
                                          m
                                       
                                    
                                 
                                 
                                    ∂
                                    
                                       
                                          
                                             c
                                          
                                       
                                       
                                          i
                                          −
                                          2
                                       
                                    
                                 
                              
                              =
                              
                                 
                                    A
                                 
                                 
                                    i
                                 
                              
                              D
                              ,
                           
                        
                      where 
                        D
                        =
                        
                           (
                           
                              
                                 τ
                              
                              
                                 i
                                 +
                                 1
                              
                           
                           −
                           
                              
                                 τ
                              
                              
                                 i
                                 −
                                 1
                              
                           
                           )
                        
                        
                           (
                           
                              
                                 τ
                              
                              
                                 i
                                 +
                                 2
                              
                           
                           −
                           
                              
                                 τ
                              
                              
                                 i
                              
                           
                           )
                        
                        
                           (
                           
                              
                                 τ
                              
                              
                                 i
                                 +
                                 1
                              
                           
                           −
                           
                              
                                 τ
                              
                              
                                 i
                              
                           
                           )
                        
                        
                           (
                           −
                           
                              
                                 k
                              
                              
                                 k
                              
                           
                           ,
                           1
                           )
                        
                        /
                        
                           
                              
                                 [
                                 
                                    (
                                    
                                       
                                          τ
                                       
                                       
                                          i
                                          +
                                          1
                                       
                                    
                                    −
                                    
                                       
                                          τ
                                       
                                       
                                          i
                                          −
                                          1
                                       
                                    
                                    )
                                 
                                 
                                    
                                       A
                                    
                                    
                                       i
                                    
                                 
                                 −
                                 
                                    (
                                    
                                       
                                          τ
                                       
                                       
                                          i
                                          +
                                          2
                                       
                                    
                                    −
                                    
                                       
                                          τ
                                       
                                       
                                          i
                                       
                                    
                                    )
                                 
                                 
                                    
                                       A
                                    
                                    
                                       i
                                       −
                                       1
                                    
                                 
                                 ]
                              
                           
                           
                              2
                           
                        
                     . According to Bernstein functions at 
                        
                           [
                           
                              
                                 τ
                              
                              
                                 i
                              
                           
                           ,
                           
                              
                                 τ
                              
                              
                                 i
                                 +
                                 1
                              
                           
                           ]
                        
                     
                     (3)
                     (4) and the differential (6), the differential of 
                        
                           
                              
                                 f
                              
                           
                           
                              i
                           
                        
                      at 
                        
                           
                              s
                           
                           
                              m
                           
                        
                      is 
                        
                           (C.4)
                           
                              
                                 
                                    ∂
                                    
                                       
                                          
                                             f
                                          
                                       
                                       
                                          i
                                       
                                    
                                    
                                       (
                                       
                                          
                                             s
                                          
                                          
                                             m
                                          
                                       
                                       )
                                    
                                 
                                 
                                    ∂
                                    
                                       
                                          
                                             c
                                          
                                       
                                       
                                          j
                                       
                                    
                                 
                              
                              =
                              
                                 
                                    B
                                 
                                 
                                    j
                                 
                              
                              
                                 (
                                 
                                    
                                       s
                                    
                                    
                                       m
                                    
                                 
                                 )
                              
                              +
                              
                                 
                                    ∑
                                 
                                 
                                    r
                                    =
                                    i
                                    −
                                    2
                                 
                                 
                                    i
                                 
                              
                              
                                 
                                    ∂
                                    
                                       
                                          B
                                       
                                       
                                          r
                                       
                                    
                                    
                                       (
                                       
                                          
                                             s
                                          
                                          
                                             m
                                          
                                       
                                       )
                                    
                                 
                                 
                                    ∂
                                    
                                       
                                          
                                             c
                                          
                                       
                                       
                                          j
                                       
                                    
                                 
                              
                              
                                 
                                    
                                       c
                                    
                                 
                                 
                                    r
                                 
                              
                              ,
                              
                              where  
                              
                                 
                                    ∂
                                    
                                       
                                          B
                                       
                                       
                                          r
                                       
                                    
                                    
                                       (
                                       
                                          
                                             s
                                          
                                          
                                             m
                                          
                                       
                                       )
                                    
                                 
                                 
                                    ∂
                                    
                                       
                                          
                                             c
                                          
                                       
                                       
                                          j
                                       
                                    
                                 
                              
                              =
                              
                                 
                                    B
                                 
                                 
                                    r
                                    ,
                                    2
                                 
                                 
                                    ′
                                 
                              
                              
                                 (
                                 
                                    
                                       s
                                    
                                    
                                       m
                                    
                                 
                                 )
                              
                              
                                 
                                    ∂
                                    
                                       
                                          s
                                       
                                       
                                          m
                                       
                                    
                                 
                                 
                                    ∂
                                    
                                       
                                          
                                             c
                                          
                                       
                                       
                                          j
                                       
                                    
                                 
                              
                              .
                           
                        
                      Let 
                        
                           
                              g
                           
                           
                              3
                           
                        
                        
                           (
                           
                              c
                           
                           )
                        
                        =
                        
                           
                              
                                 (
                                 
                                    
                                       
                                          p
                                       
                                    
                                    
                                       k
                                       +
                                       1
                                    
                                 
                                 −
                                 
                                    
                                       
                                          p
                                       
                                    
                                    
                                       k
                                    
                                 
                                 )
                              
                           
                           
                              T
                           
                        
                        J
                        
                           
                              
                                 f
                              
                           
                           
                              i
                           
                        
                        
                           (
                           
                              
                                 s
                              
                              
                                 m
                              
                           
                           )
                        
                     , its differential at 
                        
                           
                              
                                 c
                              
                           
                           
                              j
                           
                        
                      is 
                        
                           (C.5)
                           
                              
                                 
                                    ∂
                                    
                                       
                                          g
                                       
                                       
                                          3
                                       
                                    
                                    
                                       (
                                       
                                          c
                                       
                                       )
                                    
                                 
                                 
                                    ∂
                                    
                                       
                                          
                                             c
                                          
                                       
                                       
                                          j
                                       
                                    
                                 
                              
                              =
                              
                                 
                                    
                                       (
                                       
                                          
                                             
                                                p
                                             
                                          
                                          
                                             k
                                             +
                                             1
                                          
                                       
                                       −
                                       
                                          
                                             
                                                p
                                             
                                          
                                          
                                             k
                                          
                                       
                                       )
                                    
                                 
                                 
                                    T
                                 
                              
                              J
                              
                                 
                                    ∂
                                    
                                       
                                          
                                             f
                                          
                                       
                                       
                                          i
                                       
                                    
                                    
                                       (
                                       
                                          
                                             s
                                          
                                          
                                             m
                                          
                                       
                                       )
                                    
                                 
                                 
                                    ∂
                                    
                                       
                                          
                                             c
                                          
                                       
                                       
                                          j
                                       
                                    
                                 
                              
                              .
                           
                        
                      Then the linear approximation of the constraint for case 3 is 
                        
                           (C.6)
                           
                              
                                 
                                    
                                       p
                                    
                                 
                                 
                                    k
                                    +
                                    1
                                 
                                 
                                    T
                                 
                              
                              J
                              
                                 
                                    
                                       p
                                    
                                 
                                 
                                    k
                                 
                              
                              −
                              ε
                              
                                 
                                    L
                                 
                                 
                                    k
                                 
                              
                              −
                              
                                 
                                    g
                                 
                                 
                                    3
                                 
                              
                              
                                 (
                                 
                                    
                                       
                                          c
                                       
                                    
                                    
                                       0
                                    
                                 
                                 )
                              
                              ≤
                              
                                 
                                    ∇
                                 
                                 
                                    
                                       c
                                    
                                 
                              
                              
                                 
                                    g
                                 
                                 
                                    3
                                 
                              
                              
                                 
                                    
                                       (
                                       
                                          
                                             
                                                c
                                             
                                          
                                          
                                             0
                                          
                                       
                                       )
                                    
                                 
                                 
                                    T
                                 
                              
                              δ
                              
                                 c
                              
                              ≤
                              
                                 
                                    
                                       p
                                    
                                 
                                 
                                    k
                                    +
                                    1
                                 
                                 
                                    T
                                 
                              
                              J
                              
                                 
                                    
                                       p
                                    
                                 
                                 
                                    k
                                 
                              
                              +
                              ε
                              
                                 
                                    L
                                 
                                 
                                    k
                                 
                              
                              −
                              
                                 
                                    g
                                 
                                 
                                    3
                                 
                              
                              
                                 (
                                 
                                    
                                       
                                          c
                                       
                                    
                                    
                                       0
                                    
                                 
                                 )
                              
                              .
                           
                        
                     
                  

@&#REFERENCES@&#

