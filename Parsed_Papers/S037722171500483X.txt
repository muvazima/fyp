@&#MAIN-TITLE@&#Maximizing Nash product social welfare in allocating indivisible goods

@&#HIGHLIGHTS@&#


               Highlights
               
                  
                     
                        
                           
                           Indivisible goods are allocated to agents.


                        
                        
                           
                           The goal is to maximize Nash product social welfare w.r.t. classical scores.


                        
                        
                           
                           Complexity results are given for approval, Borda, and lexicographic scores.


                        
                     
                  
               
            

@&#KEYPHRASES@&#

Fair division

Social welfare

Nash product

Computational complexity

Scoring rules

@&#ABSTRACT@&#


               
               
                  We consider the problem of allocating indivisible goods to agents who have preferences over the goods. In such a setting, a central task is to maximize social welfare. In this paper, we assume the preferences to be additive and measure social welfare by means of the Nash product. We focus on the computational complexity involved in maximizing Nash product social welfare when scores inherent in classical voting procedures such as approval or Borda voting are used to associate utilities with the agents’ preferences. In particular, we show that the maximum Nash product social welfare can be computed efficiently when approval scores are used, while for Borda and lexicographic scores the corresponding decision problem becomes 
                        NP
                     -complete.
               
            

@&#INTRODUCTION@&#

The allocation of goods (items, resources) to agents who have preferences over these goods (multiagent resource allocation) is a fundamental problem of economics, and, in particular, social choice theory. This problem has been tackled in various scenarios (see, e.g., Chevaleyre et al., 2006 for a survey), where, e.g., we distinguish between divisible and indivisible goods, and centralized and decentralized approaches. Here, we consider the case of m indivisible and nonshareable goods to be distributed among agents who report their preferences to a central authority. Typically, individual utilities of (bundles of) items are associated with the preferences over the items. In this work, this is done via numerical scores used in voting rules. Now, a major task is to find an allocation which maximizes the social welfare achieved. Different notions of social welfare have been introduced, the most important being utilitarian, egalitarian, and Nash product social welfare (cf. Brandt, Conitzer, & Endriss, 2013).

Utilitarian social welfare of an allocation is given by the sum of the agents’ utilities resulting from the allocation. A more fine-grained approach is egalitarian social welfare, where the lowest of the agents’ individual utilities in a given allocation is considered. In a certain sense, the Nash product social welfare links these two approaches: by measuring the product of the agents’ utilities in an allocation, maximizing the Nash product social welfare targets at a “balanced” allocation (see also Nguyen, Nguyen, Roos, & Rothe, 2014).

The Nash product as a measure for social welfare satisfies several desirable properties (see Moulin, 2003 for an explicit treatment). For example, it satisfies the basic fairness criterion that it increases when inequality among two agents is reduced (given the respective change is mean-preserving; see also Ramezani & Endriss, 2010). Clearly, the Nash product also satisfies the monotonicity property that an increase of an agent’s utility yields an increase in the Nash product. In addition, it is independent of both common utility scale and individual utility scale: the social welfare ordering, i.e., the ordering of the allocations according to their Nash product, remains unchanged both if (i) all agents rescale their utilities with the same factor, and (ii) each agent rescales her utility using a different factor.

A central question in maximizing social welfare is the computational complexity involved. We assume that the agents have additive preferences, i.e., for each agent, the utility of a set of goods is the sum of the utilities of the single goods it contains.

Clearly, maximizing utilitarian social welfare is an easy task – simply allocate each item to an agent who it yields the highest utility for (see also Brandt et al., 2013). In contrast, it is known that maximizing egalitarian social welfare and Nash product social welfare are 
                        NP
                     -complete for additive utilities and general scoring functions (Roos & Rothe, 2010). Recently, Baumeister et al. (2013) have shown that maximizing egalitarian social welfare remains 
                        NP
                     -complete for a number of prototypical scoring functions from voting theory: quasi-indifference, Borda, and lexicographic scoring. On the positive side, it is known that the maximum egalitarian social welfare can be computed in polynomial time for approval scores (Golovin, 2005). To the best of our knowledge, the computational complexity of maximizing Nash product social welfare under scoring functions such as approval, Borda, or lexicographic scoring has not been considered yet. In this paper, we investigate the computational complexity involved in maximizing Nash product social welfare under these classical scoring functions.


                     Related work and our contribution. In the Santa Claus problem (Bansal & Sviridenko, 2006), the goal is to maximize egalitarian social welfare when indivisible items have to be allocated among agents. There, the agents associate an arbitrary numerical value with each item, i.e., the input is numerical, and the utility of an agent is the sum of the values of the items assigned to her. In contrast, as done in our work, in the setting presented in Brams, Edelman, and Fishburn (2003) the agents’ preferences are expressed ordinally. Brams et al. (2003) introduce the notion of a Borda-optimal allocation, which is defined as an allocation maximizing egalitarian social welfare where an agent’s utility is the sum of the Borda scores of the items the agent receives. We translate this concept to maximizing Nash product social welfare, and expand the perspective from Borda scores to approval (and, in particular, k-approval) and lexicographic scores. Informally speaking, in k-approval scoring a distinction between “good” (approved) and “bad” (disapproved) items is made: the top k items in the ranking of an agent receive a score of 1, while the remaining items get score 0. In Borda scoring, an agent’s most preferred item gets a score of m, her second-ranked item a score of 
                        
                           m
                           −
                           1
                           ,
                        
                      and so on; her least preferred item has a score of 1. In lexicographic scoring, the position of the item in the ranking is even more crucial: any item r yields a higher score than the total of all items ranked below r. Our goal is to analyze the computational complexity involved in maximizing Nash product social welfare with respect to these types of scores. In the context of maximizing social welfare in multiagent resource allocation, complexity results have been achieved with respect to different types of utility representation: the bundle form, k-additive form, or straight-line programs. For the bundle form representation, 
                        NP
                     -completeness results for utilitarian (Chevaleyre, Endriss, Estivie, & Maudet, 2008), egalitarian (Roos & Rothe, 2010), and Nash product social welfare (Ramezani & Endriss, 2010; Roos & Rothe, 2010) are known. For straight-line programs, Dunne, Wooldridge, and Laurence (2005) show that maximizing utilitarian social welfare is 
                        NP
                     -complete, while Nguyen et al. (2014) show that maximizing social welfare is 
                        NP
                     -complete both for the egalitarian and Nash product approach. Both maximizing egalitarian social welfare and maximizing Nash product social welfare turn out to be 
                        NP
                     -complete for 1-additive, i.e., additive utilities already (Lipton, Markakis, Mossel, & Saberi, 2004; Roos & Rothe, 2010). In these works, however, reductions from Partition are given, which do not imply the 
                        NP
                     -completeness for any of the scoring functions considered in our work. Given additive utilities, Baumeister et al. (2013), besides many other results, have proven that maximizing egalitarian social welfare is 
                        NP
                     -complete for Borda, lexicographic, and quasi-indifference scoring.

In this paper, we show that maximizing Nash product social welfare is 
                        NP
                     -complete for Borda and lexicographic scores, whereas it is polynomially solvable for approval scores. The computational complexity involved when quasi-indifference scores are used is still open.

Let 
                           
                              R
                              =
                              {
                              
                                 r
                                 1
                              
                              ,
                              
                                 r
                                 2
                              
                              ,
                              …
                              ,
                              
                                 r
                                 m
                              
                              }
                           
                         be a set of m indivisible resources (items) and let 
                           
                              A
                              =
                              {
                              
                                 a
                                 1
                              
                              ,
                              …
                              ,
                              
                                 a
                                 n
                              
                              }
                           
                         be a set of n agents. An allocation is a mapping that assigns to each agent a subset of resources such that each resource is handed to exactly one agent. Formally, an allocation P is a mapping P: A → 2
                           R
                         with 
                           
                              
                                 ⋃
                                 
                                    a
                                    ∈
                                    A
                                 
                              
                              P
                              
                                 (
                                 a
                                 )
                              
                              =
                              R
                           
                         and 
                           
                              P
                              
                                 (
                                 
                                    a
                                    i
                                 
                                 )
                              
                              ∩
                              P
                              
                                 (
                                 
                                    a
                                    j
                                 
                                 )
                              
                              =
                              ∅
                           
                         whenever 
                           
                              i
                              ≠
                              j
                           
                        .

Now, in our model, we start with ordinal inputs, i.e., the agents rank resources, and map these ranks to numerical scores then. Note that we do not claim that these numerical scores are equivalent or at least close to the agents’ actual utilities. However, starting with numerical inputs instead would have several drawbacks (see also Baumeister et al., 2013); e.g., often it is easier for agents to rank items instead of associating numerical values with each single item, especially in contexts where money is not a key factor. Next, as also pointed out in Baumeister et al. (2013), the use of numerical inputs has the severe disadvantage that it insinuates comparability of interpersonal preferences. Finally, note that our approach is very common in voting theory, as in fact it resembles the way that positional scoring rules proceed.
                           1
                        
                        
                           1
                           Obviously, with the clear difference that we are finally interested in allocations instead of winners of elections.
                        
                     

In particular, we assume that agents have preferences over the single resources. The preferences are expressed by means of strict orders 
                           
                              ≻
                              
                                 a
                                 i
                              
                           
                         over R, which are summarized by the n-tuple 
                           
                              π
                              =
                              (
                              
                                 ≻
                                 
                                    a
                                    1
                                 
                              
                              ,
                              
                                 ≻
                                 
                                    a
                                    2
                                 
                              
                              ,
                              …
                              ,
                              
                                 ≻
                                 
                                    a
                                    n
                                 
                              
                              )
                           
                         called profile. We denote by 
                           
                              r
                              a
                              n
                              k
                              
                                 
                                 
                                    a
                                    i
                                 
                              
                              
                                 (
                                 r
                                 )
                              
                           
                         the rank of resource r in the ranking of agent ai
                        .

We adopt scores used in voting procedures to evaluate these preferences by means of utility functions 
                           
                              
                                 u
                                 a
                              
                              :
                              R
                              →
                              Q
                              ,
                           
                         
                        a ∈ A. We assume that the utility functions are additive, i.e., for any subset R′⊆R we have 
                           
                              
                                 u
                                 a
                              
                              
                                 (
                                 
                                    R
                                    ′
                                 
                                 )
                              
                              =
                              
                                 ∑
                                 
                                    r
                                    ∈
                                    
                                       R
                                       ′
                                    
                                 
                              
                              
                                 u
                                 a
                              
                              
                                 (
                                 
                                    R
                                    ′
                                 
                                 )
                              
                           
                        . For the sake of readability, we may write ua
                        (P) instead of ua
                        (P(a)).

Given a profile π, we consider the following types of scores (where r ∈ R):

                           
                              •
                              
                                 k-approval scores: For each agent a ∈ A,

                                    
                                       
                                          
                                             
                                                u
                                                a
                                             
                                             
                                                (
                                                r
                                                )
                                             
                                             =
                                             
                                                {
                                                
                                                   
                                                      
                                                         1
                                                      
                                                      
                                                         
                                                            
                                                            if
                                                            
                                                            r
                                                            a
                                                            n
                                                            
                                                               k
                                                               a
                                                            
                                                            
                                                               (
                                                               r
                                                               )
                                                            
                                                            ≤
                                                            k
                                                         
                                                      
                                                   
                                                   
                                                      
                                                         0
                                                      
                                                      
                                                         
                                                            
                                                            otherwise
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                              


                                 Borda scores: For each agent a ∈ A, 
                                    
                                       
                                          u
                                          a
                                       
                                       
                                          (
                                          r
                                          )
                                       
                                       =
                                       m
                                       +
                                       1
                                       −
                                       r
                                       a
                                       n
                                       
                                          k
                                          a
                                       
                                       
                                          (
                                          r
                                          )
                                       
                                    
                                 .


                                 Lexicographic scores: For each agent a ∈ A, 
                                    
                                       
                                          u
                                          a
                                       
                                       
                                          (
                                          r
                                          )
                                       
                                       =
                                       
                                          2
                                          
                                             m
                                             −
                                             r
                                             a
                                             n
                                             
                                                k
                                                a
                                             
                                             
                                                (
                                                r
                                                )
                                             
                                          
                                       
                                    
                                 .

Given k-approval scores, for each a ∈ A, ua
                         partitions the set R into a set 
                           
                              
                                 S
                                 a
                              
                              :
                              =
                              
                                 {
                                 r
                                 ∈
                                 R
                                 :
                                 
                                 
                                    u
                                    a
                                 
                                 
                                    (
                                    r
                                    )
                                 
                                 =
                                 1
                                 }
                              
                           
                         (the set of resources agent a approves of) and a set 
                           
                              
                                 S
                                 
                                    a
                                 
                                 c
                              
                              :
                              =
                              
                                 {
                                 r
                                 ∈
                                 R
                                 :
                                 
                                 
                                    u
                                    a
                                 
                                 
                                    (
                                    r
                                    )
                                 
                                 =
                                 0
                                 }
                              
                           
                         (the set of resources agent a disapproves of). Conversely, specifying the set Sa
                         (of size k) for each agent a uniquely determines the corresponding k-approval scores. More generally (and slightly abusing notation), given a set S(a)⊆R for each a ∈ A, approval scores are given by 
                           
                              
                                 u
                                 a
                              
                              
                                 (
                                 r
                                 )
                              
                              =
                              1
                           
                         for r ∈ S(a) and 
                           
                              
                                 u
                                 a
                              
                              
                                 (
                                 r
                                 )
                              
                              =
                              0
                           
                         for r ∈ R∖S(a).

Given an allocation P, the Nash product social welfare for P is given by 
                           
                              s
                              
                                 w
                                 N
                              
                              
                                 (
                                 P
                                 )
                              
                              =
                              
                                 ∏
                                 
                                    1
                                    ≤
                                    i
                                    ≤
                                    n
                                 
                              
                              
                                 u
                                 
                                    a
                                    i
                                 
                              
                              
                                 (
                                 P
                                 )
                              
                           
                        .

In this paper, we consider the problem of maximizing the Nash product social welfare with respect to the above scores, i.e., utility functions. The corresponding decision problems are defined as follows.

                           Definition 2.1
                           (Nash Product Social Welfare Maximization-Approval)

                                 GIVEN:
                                 
                                    Quadruple (R, A, S, k): R is a set of resources, A a set of agents, a collection 
                                          
                                             S
                                             =
                                             {
                                             
                                                S
                                                
                                                   a
                                                   1
                                                
                                             
                                             ,
                                             
                                                S
                                                
                                                   a
                                                   2
                                                
                                             
                                             ,
                                             …
                                             ,
                                             
                                                S
                                                
                                                   a
                                                   n
                                                
                                             
                                             }
                                          
                                        of subsets 
                                          
                                             
                                                S
                                                
                                                   a
                                                   i
                                                
                                             
                                             ⊆
                                             R
                                             ,
                                          
                                        and 
                                          
                                             k
                                             ∈
                                             N
                                          
                                       .

Is there an allocation P such that swN
                                       (P) ≥ k, where 
                                          
                                             
                                                u
                                                
                                                   a
                                                   i
                                                
                                             
                                             
                                                (
                                                r
                                                )
                                             
                                             =
                                             1
                                          
                                        if 
                                          
                                             r
                                             ∈
                                             
                                                S
                                                
                                                   a
                                                   i
                                                
                                             
                                          
                                        and 
                                          
                                             
                                                u
                                                
                                                   a
                                                   i
                                                
                                             
                                             
                                                (
                                                r
                                                )
                                             
                                             =
                                             0
                                          
                                        otherwise?

Analogously, we defineNash Product Social Welfare Maximization-Borda.

                           Definition 2.2
                           (Nash Product Social Welfare Maximization-Borda)

                                 GIVEN:
                                 
                                    Quadruple (R, A, π, k): R is a set of resources, A a set of agents, π is a profile, and 
                                          
                                             k
                                             ∈
                                             N
                                          
                                       .

Is there an allocation P such that swN
                                       (P) ≥ k for Borda scores?

It is straightforward to define Nash Product Social Welfare Maximization-Lexicographic for lexicographic scores. In what follows, we use the shortcut NPSW for Nash Product Social Welfare Maximization.

First, we show that NPSW is in 
                           P
                         for approval scores. This is done by a transformation to the polynomially solvable Min Cost Flow problem (cf. Ahuja, Magnanti, & Orlin, 1993). In particular, it follows that in the case of approval scores, an actual allocation that maximizes Nash product social welfare can be found in polynomial time.

We begin with some basic definitions and two known properties of a min cost flow (i.e., an optimal solution of the Min Cost Flow problem).

                           Definition 3.1
                           In an instance 
                                 
                                    M
                                    =
                                    (
                                    G
                                    ,
                                    c
                                    ,
                                    ℓ
                                    ,
                                    p
                                    ,
                                    b
                                    )
                                 
                               of Min Cost Flow, we are given a directed graph 
                                 
                                    G
                                    =
                                    (
                                    V
                                    ,
                                    E
                                    )
                                 
                              . With each edge e ∈ E, two rational numbers are associated: a cost c(e) and an upper bound p(e) on the capacity of e. For each v ∈ V, we are given the rational-valued vertex demand b(v). The Min Cost Flow problem can be stated as follows:

                                 
                                    
                                       
                                          min
                                          
                                             ∑
                                             
                                                (
                                                u
                                                ,
                                                v
                                                )
                                                ∈
                                                E
                                             
                                          
                                          c
                                          
                                             (
                                             u
                                             ,
                                             v
                                             )
                                          
                                          f
                                          
                                             (
                                             u
                                             ,
                                             v
                                             )
                                          
                                       
                                    
                                 
                              
                              
                                 
                                    (1)
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      s
                                                      .
                                                      t
                                                      .
                                                      
                                                         ∑
                                                         
                                                            v
                                                            :
                                                            (
                                                            u
                                                            ,
                                                            v
                                                            )
                                                            ∈
                                                            E
                                                         
                                                      
                                                      f
                                                      
                                                         (
                                                         u
                                                         ,
                                                         v
                                                         )
                                                      
                                                      −
                                                      
                                                         ∑
                                                         
                                                            v
                                                            :
                                                            (
                                                            v
                                                            ,
                                                            u
                                                            )
                                                            ∈
                                                            E
                                                         
                                                      
                                                      f
                                                      
                                                         (
                                                         u
                                                         ,
                                                         v
                                                         )
                                                      
                                                      =
                                                      b
                                                      
                                                         (
                                                         u
                                                         )
                                                      
                                                   
                                                
                                             
                                             
                                                
                                                   for
                                                   
                                                   all
                                                   
                                                   u
                                                   ∈
                                                   V
                                                
                                             
                                          
                                          
                                             
                                                
                                                   
                                                   0
                                                   ≤
                                                   f
                                                   (
                                                   u
                                                   ,
                                                   v
                                                   )
                                                   ≤
                                                   p
                                                   (
                                                   u
                                                   ,
                                                   v
                                                   )
                                                
                                             
                                             
                                                
                                                   for
                                                   
                                                   all
                                                   (
                                                   u
                                                   ,
                                                   v
                                                   )
                                                   ∈
                                                   E
                                                
                                             
                                          
                                       
                                    
                                 
                              A function 
                                 
                                    f
                                    :
                                    E
                                    →
                                    Q
                                 
                               is called flow, if f satisfies the conditions stated in (1). The cost of a flow f is defined by 
                                 
                                    c
                                    
                                       (
                                       f
                                       )
                                    
                                    =
                                    
                                       ∑
                                       
                                          (
                                          u
                                          ,
                                          v
                                          )
                                          ∈
                                          E
                                       
                                    
                                    c
                                    
                                       (
                                       u
                                       ,
                                       v
                                       )
                                    
                                    f
                                    
                                       (
                                       u
                                       ,
                                       v
                                       )
                                    
                                 
                              .

In an instance 
                           
                              M
                              =
                              (
                              G
                              ,
                              c
                              ,
                              ℓ
                              ,
                              p
                              ,
                              b
                              )
                           
                         of Min Cost Flow, the capacity constraints on the edges are written by means of [0, p(e)]. The cost of a directed cycle defined as the sum of the costs of the edges in the cycle.

In 
                           
                              M
                              ,
                           
                         we associate a residual network Gf
                         with a flow f. Gf
                         is constructed from G as follows. Each edge (i, j) ∈ E is replaced by the edges (i, j) and (j, i). In Gf
                        , the arc (i, j) has cost c(i, j) and residual capacity 
                           
                              [
                              0
                              ,
                              p
                              (
                              i
                              ,
                              j
                              )
                              −
                              f
                              (
                              i
                              ,
                              j
                              )
                              ]
                           
                        ; the arc (j, i) has cost 
                           
                              c
                              (
                              j
                              ,
                              i
                              )
                              =
                              −
                              c
                              (
                              i
                              ,
                              j
                              )
                           
                         and residual capacity [0, f(i, j)]. Finally, Gf
                         consists of edges with positive residual capacity only.

                           Theorem 3.1
                           Negative cycle optimality condition; cf. Ahuja et al., 1993
                           


                           
                              A flow f is an optimal solution of Min Cost Flow, if and only if Gf does not contain a negative cost directed cycle.
                           


                              If all arc capacities and all node demands are integer, then there is an integer min cost flow.
                           


                              NPSW-Approval is in
                              
                                 P
                              
                              .
                           

Let 
                                 
                                    I
                                    =
                                    (
                                    R
                                    ,
                                    A
                                    ,
                                    π
                                    ,
                                    k
                                    )
                                 
                               be an instance of NPSW-Approval. We assume that each item is approved of by at least one agent (otherwise, items which are not approved by any agent are removed in a preprocessing step). We argue that 
                                 I
                               can be decided by solving an instance 
                                 M
                               of Min Cost Flow.


                              
                                 M
                               is defined as follows. In the graph 
                                 
                                    G
                                    =
                                    (
                                    V
                                    ,
                                    E
                                    )
                                    ,
                                 
                               certain vertices are identified with items/agents of the same label. In particular, 
                                 
                                    V
                                    =
                                    
                                       {
                                       s
                                       ,
                                       t
                                       }
                                    
                                    ∪
                                    A
                                    ∪
                                    R
                                    ∪
                                    
                                       {
                                       
                                          t
                                          
                                             i
                                             ,
                                             j
                                          
                                       
                                       |
                                       i
                                       ∈
                                       A
                                       ,
                                       j
                                       ∈
                                       R
                                       }
                                    
                                 
                              . The vertex demands are 
                                 
                                    b
                                    (
                                    s
                                    )
                                    =
                                    m
                                    ,
                                 
                              
                              
                                 
                                    b
                                    (
                                    t
                                    )
                                    =
                                    −
                                    m
                                 
                               and 
                                 
                                    b
                                    (
                                    v
                                    )
                                    =
                                    0
                                 
                               for each v ∈ V∖{s, t}. In order to construct the edge set E,

                                 
                                    •
                                    For each r ∈ R we introduce edge (s, r) with capacity [0, 1] and zero cost.

For each ai
                                        ∈ A and for each r ∈ R with 
                                          
                                             
                                                u
                                                
                                                   a
                                                   i
                                                
                                             
                                             
                                                (
                                                r
                                                )
                                             
                                             =
                                             1
                                          
                                        we introduce the edge (r, ai
                                       ) with capacity [0, 1] and zero cost.

For each ai
                                        ∈ A and 1 ≤ j ≤ m, we introduce

                                          
                                             •
                                             the edge (ai, t
                                                
                                                   i, j
                                                ) with capacity [0, 1] and cost 
                                                   
                                                      c
                                                      
                                                         (
                                                         
                                                            a
                                                            i
                                                         
                                                         ,
                                                         
                                                            t
                                                            
                                                               i
                                                               ,
                                                               j
                                                            
                                                         
                                                         )
                                                      
                                                      =
                                                      
                                                         n
                                                         j
                                                      
                                                   
                                                
                                             

the edge (t
                                                
                                                   i, j
                                                , t) with capacity [0, 1] and zero cost.

By the integrality property, there is an integer min cost flow f in 
                                 M
                              . That is, for each e ∈ E, f either does not send flow along e or f sends exactly 1 unit of flow along e. Clearly, due to the choice of the vertex demands and the edge capacities [0, 1] of the edges (s, r), for each r ∈ R there is exactly one unit of flow sent through vertex r. Due to the capacities of the edges (r, a) this means that for each r ∈ R, there is exactly one a ∈ A such that f sends (one unit of) flow along (r, a). Thus, the mapping Pf
                              : A → R defined by r ∈ Pf
                               (a) iff 
                                 
                                    f
                                    (
                                    r
                                    ,
                                    a
                                    )
                                    =
                                    1
                                 
                               is an allocation in 
                                 I
                              . On the other hand, it is not hard to see that an allocation P induces an integer flow f P
                               in 
                                 M
                               by

                                 
                                    •
                                    Sending one unit of flow along (s, r) for each r ∈ R
                                    

For each ai
                                        ∈ A and for each r ∈ R, sending one unit of flow along (r, ai
                                       ) iff r ∈ P(ai
                                       )

Sending one unit of flow along (ai, t
                                       
                                          i, h
                                       ) and (t
                                       
                                          i, h
                                       , t) for each 
                                          
                                             1
                                             ≤
                                             h
                                             ≤
                                             
                                                u
                                                
                                                   a
                                                   i
                                                
                                             
                                             
                                                (
                                                P
                                                )
                                             
                                          
                                       
                                    

The proof proceeds in three steps.


                              Step 1: Let f be an integer flow in instance 
                                 
                                    M
                                    ,
                                 
                               where fi
                               denotes the amount of flow sent through vertex ai
                              . We show that the following holds: f is a min cost flow if and only if the two properties

                                 
                                    1.
                                    For each ai
                                        ∈ A, f sends flow along the arcs (ai, t
                                       
                                          i, h
                                       ), for all 1 ≤ h ≤ fi
                                       , and

There is no sequence 
                                          
                                             (
                                             
                                                a
                                                
                                                   i
                                                   1
                                                
                                             
                                             ,
                                             
                                                r
                                                
                                                   j
                                                   1
                                                
                                             
                                             ,
                                             
                                                a
                                                
                                                   i
                                                   2
                                                
                                             
                                             ,
                                             
                                                r
                                                
                                                   j
                                                   2
                                                
                                             
                                             ,
                                             …
                                             ,
                                             
                                                r
                                                
                                                   j
                                                   
                                                      ℓ
                                                      −
                                                      1
                                                   
                                                
                                             
                                             ,
                                             
                                                a
                                                
                                                   i
                                                   ℓ
                                                
                                             
                                             )
                                          
                                        with 
                                          
                                             
                                                f
                                                
                                                   i
                                                   1
                                                
                                             
                                             −
                                             
                                                f
                                                
                                                   i
                                                   ℓ
                                                
                                             
                                             ≥
                                             2
                                             ,
                                          
                                        such that for all 
                                          
                                             1
                                             ≤
                                             h
                                             ≤
                                             ℓ
                                             −
                                             1
                                          
                                        we have (i) 
                                          
                                             (
                                             
                                                r
                                                
                                                   j
                                                   h
                                                
                                             
                                             ,
                                             
                                                a
                                                
                                                   i
                                                   
                                                      h
                                                      +
                                                      1
                                                   
                                                
                                             
                                             )
                                             ∈
                                             E
                                          
                                        and (ii) f sends flow along the arc 
                                          
                                             (
                                             
                                                r
                                                
                                                   j
                                                   h
                                                
                                             
                                             ,
                                             
                                                a
                                                
                                                   i
                                                   h
                                                
                                             
                                             )
                                          
                                       
                                    

are satisfied. Note that the second property reflects the idea that a more “balanced” and thus cheaper flow cannot be immediately derived from f.

In particular, we show that the above conditions are equivalent to the negative cycle optimality condition. First, note that due to the fact that for each edge (s, rj
                              ) demand and upper bound equal to 1, the residual capacity of the edge is 0. That is, the edge is not contained in the residual network H. Thus, H does not contain any edge emanating from s. Hence, s cannot be part of any cycle in R.


                              Step 1a: Assume that one of the two conditions above is not satisfied. Case I considers the case that the first condition is violated. Case II considers the situation that the first condition holds, but the second is violated.


                              Case I: For some ai
                               ∈ A, there is an 1 ≤ h ≤ fi
                               such that f does not send flow along the edges (ai, t
                              
                                 i, h
                              ). Then, f must send along an edge (ai, t
                              
                                 i, ℓ) for some ℓ > fi
                              . But then it is easy to see that in the residual network H the cycle 
                                 
                                    γ
                                    =
                                    (
                                    t
                                    ,
                                    
                                       t
                                       
                                          i
                                          ,
                                          ℓ
                                       
                                    
                                    ,
                                    
                                       a
                                       i
                                    
                                    ,
                                    
                                       t
                                       
                                          i
                                          ,
                                          h
                                       
                                    
                                    ,
                                    t
                                    )
                                 
                               is a cycle of cost 
                                 
                                    c
                                    
                                       (
                                       γ
                                       )
                                    
                                    =
                                    −
                                    
                                       n
                                       ℓ
                                    
                                    +
                                    
                                       n
                                       h
                                    
                                    <
                                    0
                                 
                               due to ℓ > h.


                              Case II: For all ai
                               ∈ A, f sends one unit of flow along the edges (ai, t
                              
                                 i, h
                              ), 1 ≤ h ≤ fi
                              . Assume there is a pair (ai, aj
                              ) with 
                                 
                                    
                                       f
                                       i
                                    
                                    −
                                    
                                       f
                                       j
                                    
                                    ≥
                                    2
                                 
                               such that (i) (r, aj
                              ) ∈ E and (ii) f sends flow along the arc (r, ai
                              ). Then, in the residual network H the cycle 
                                 
                                    
                                       γ
                                       ′
                                    
                                    =
                                    
                                       (
                                       t
                                       ,
                                       
                                          t
                                          
                                             i
                                             ,
                                             
                                                f
                                                i
                                             
                                          
                                       
                                       ,
                                       
                                          a
                                          i
                                       
                                       ,
                                       r
                                       ,
                                       
                                          a
                                          j
                                       
                                       ,
                                       
                                          t
                                          
                                             j
                                             ,
                                             
                                                f
                                                j
                                             
                                             +
                                             1
                                          
                                       
                                       ,
                                       t
                                       )
                                    
                                 
                               has negative cost: 
                                 
                                    c
                                    
                                       (
                                       
                                          γ
                                          ′
                                       
                                       )
                                    
                                    =
                                    −
                                    
                                       n
                                       
                                          f
                                          i
                                       
                                    
                                    +
                                    
                                       n
                                       
                                          
                                             f
                                             j
                                          
                                          +
                                          1
                                       
                                    
                                    <
                                    0
                                    ,
                                 
                               because 
                                 
                                    
                                       f
                                       i
                                    
                                    −
                                    
                                       f
                                       j
                                    
                                    ≥
                                    2
                                 
                               by assumption.

Hence, if one of the two conditions is violated, there is a negative cost cycle.


                              Step 1b: On the other hand, assume H contains a negative cost cycle γ. We show that this implies that at least one of the two conditions is violated. Clearly, s cannot be contained in γ. In addition, γ cannot be made up of vertex t and vertices t
                              
                                 i, j
                               only, since each edge (t
                              
                                 i, j
                              , t) is of zero cost.

Assume γ does not contain a vertex rj
                              , 1 ≤ j ≤ m. Then, for some i, x, y, 
                                 
                                    γ
                                    =
                                    (
                                    t
                                    ,
                                    
                                       t
                                       
                                          i
                                          ,
                                          x
                                       
                                    
                                    ,
                                    
                                       a
                                       i
                                    
                                    ,
                                    
                                       t
                                       
                                          i
                                          ,
                                          y
                                       
                                    
                                    ,
                                    t
                                    )
                                 
                               holds. Note that 
                                 
                                    c
                                    
                                       (
                                       γ
                                       )
                                    
                                    =
                                    −
                                    c
                                    
                                       (
                                       
                                          t
                                          
                                             i
                                             ,
                                             x
                                          
                                       
                                       ,
                                       
                                          a
                                          i
                                       
                                       )
                                    
                                    +
                                    c
                                    
                                       (
                                       
                                          a
                                          i
                                       
                                       ,
                                       
                                          t
                                          
                                             i
                                             ,
                                             y
                                          
                                       
                                       )
                                    
                                    =
                                    −
                                    
                                       n
                                       x
                                    
                                    +
                                    
                                       n
                                       y
                                    
                                 
                              . Thus, c(γ) < 0 implies

                                 
                                    (2)
                                    
                                       
                                          x
                                          >
                                          y
                                       
                                    
                                 
                              Assume that f sends flow along (ai, t
                              
                                 i, h
                              ) for all 1 ≤ h ≤ fi
                              . Then the residual network H must contain (i) the edges (t
                              
                                 i, h
                              , ai
                              ) for 1 ≤ h ≤ fi
                               as only edges with head ai
                              . Thus, x ≤ fi
                               follows. In addition, since f is integer and in the original network G the upper bound of the capacity of each of the edges (ai, t
                              
                                 i, h
                              ) equals 1, it follows that f sends exactly one unit of flow along each of the arcs (ai, t
                              
                                 i, h
                              ), for 1 ≤ h ≤ fi
                              . Hence, H cannot contain any of these edges. Thus, y > fi
                               must hold. Putting things together, we get x ≤ fi
                               < y, in contradiction with (2). Hence, the first condition is violated.

Thus, γ contains a vertex r ∈ R. Assume the first condition is not violated (otherwise there is nothing to show). Then, there is a sequence 
                                 
                                    (
                                    
                                       a
                                       
                                          i
                                          1
                                       
                                    
                                    ,
                                    
                                       r
                                       
                                          j
                                          1
                                       
                                    
                                    ,
                                    
                                       a
                                       
                                          i
                                          2
                                       
                                    
                                    ,
                                    
                                       r
                                       
                                          j
                                          2
                                       
                                    
                                    ,
                                    …
                                    ,
                                    
                                       r
                                       
                                          j
                                          
                                             ℓ
                                             −
                                             1
                                          
                                       
                                    
                                    ,
                                    
                                       a
                                       
                                          i
                                          ℓ
                                       
                                    
                                    )
                                 
                               such that

                                 
                                    
                                       
                                          γ
                                          =
                                          (
                                          t
                                          ,
                                          
                                             t
                                             
                                                
                                                   i
                                                   1
                                                
                                                ,
                                                x
                                             
                                          
                                          ,
                                          
                                             a
                                             
                                                i
                                                1
                                             
                                          
                                          ,
                                          
                                             r
                                             
                                                j
                                                1
                                             
                                          
                                          ,
                                          
                                             a
                                             
                                                i
                                                2
                                             
                                          
                                          ,
                                          
                                             r
                                             
                                                j
                                                2
                                             
                                          
                                          ,
                                          …
                                          ,
                                          
                                             r
                                             
                                                j
                                                
                                                   ℓ
                                                   −
                                                   1
                                                
                                             
                                          
                                          ,
                                          
                                             a
                                             
                                                i
                                                ℓ
                                             
                                          
                                          ,
                                          
                                             t
                                             
                                                
                                                   i
                                                   ℓ
                                                
                                                ,
                                                y
                                             
                                          
                                          ,
                                          t
                                          )
                                       
                                    
                                 
                              for some ℓ ≥ 2 and some x, y, with 
                                 
                                    
                                       i
                                       1
                                    
                                    ≠
                                    
                                       i
                                       ℓ
                                    
                                 
                              .

Since by assumption the first condition is satisfied, 
                                 
                                    x
                                    ≤
                                    
                                       f
                                       
                                          i
                                          1
                                       
                                    
                                 
                               and 
                                 
                                    y
                                    ≥
                                    
                                       f
                                       
                                          i
                                          ℓ
                                       
                                    
                                    +
                                    1
                                 
                               hold. 
                                 
                                    c
                                    
                                       (
                                       γ
                                       )
                                    
                                    =
                                    −
                                    c
                                    
                                       (
                                       
                                          t
                                          
                                             
                                                i
                                                1
                                             
                                             ,
                                             x
                                          
                                       
                                       ,
                                       
                                          a
                                          
                                             i
                                             1
                                          
                                       
                                       )
                                    
                                    +
                                    c
                                    
                                       (
                                       
                                          a
                                          
                                             i
                                             ℓ
                                          
                                       
                                       ,
                                       
                                          t
                                          
                                             
                                                i
                                                ℓ
                                             
                                             ,
                                             y
                                          
                                       
                                       )
                                    
                                    =
                                    −
                                    
                                       n
                                       x
                                    
                                    +
                                    
                                       n
                                       y
                                    
                                    ≥
                                    −
                                    
                                       n
                                       x
                                    
                                    +
                                    
                                       n
                                       
                                          
                                             f
                                             
                                                i
                                                ℓ
                                             
                                          
                                          +
                                          1
                                       
                                    
                                 
                              . Now, c(γ) < 0 implies 
                                 
                                    −
                                    
                                       n
                                       x
                                    
                                    +
                                    
                                       n
                                       
                                          
                                             f
                                             
                                                i
                                                ℓ
                                             
                                          
                                          +
                                          1
                                       
                                    
                                    <
                                    0
                                    ,
                                 
                               i.e., 
                                 
                                    x
                                    >
                                    
                                       f
                                       
                                          i
                                          ℓ
                                       
                                    
                                    +
                                    1
                                 
                              . Hence, 
                                 
                                    
                                       f
                                       
                                          i
                                          1
                                       
                                    
                                    ≥
                                    x
                                    >
                                    
                                       f
                                       
                                          i
                                          ℓ
                                       
                                    
                                    +
                                    1
                                 
                               holds. Thus, 
                                 
                                    
                                       f
                                       
                                          i
                                          1
                                       
                                    
                                    ≥
                                    
                                       f
                                       
                                          i
                                          ℓ
                                       
                                    
                                    +
                                    2
                                 
                               holds, since all flow values are integer. That is, the second condition is violated.

As a consequence, the negative cycle condition is in fact equivalent to the two above stated conditions.


                              Step 2: Let P′ be an allocation that maximizes Nash product social welfare. Throughout this proof, let g be the integer flow induced by allocation P′. We show that g is a min cost flow.

For each ai
                               ∈ A, g sends 
                                 
                                    
                                       g
                                       i
                                    
                                    =
                                    
                                       u
                                       
                                          a
                                          i
                                       
                                    
                                    
                                       (
                                       
                                          P
                                          ′
                                       
                                       )
                                    
                                 
                               units of flow through vertex ai
                               and one unit of flow through each of the arcs (ai, t
                              
                                 i, h
                              ) for 1 ≤ h ≤ gi
                              . Assume there is a pair (ai, aj
                              ) with 
                                 
                                    
                                       g
                                       i
                                    
                                    −
                                    
                                       g
                                       j
                                    
                                    ≥
                                    2
                                 
                               such that (i) (r, aj
                              ) ∈ E and (ii) g sends flow along the arc (r, ai
                              ). Then, both ai, aj
                               approve of item r. Consider the assignment P′′ defined by 
                                 
                                    
                                       P
                                       
                                          ′
                                          ′
                                       
                                    
                                    
                                       (
                                       a
                                       )
                                    
                                    =
                                    P
                                    
                                       (
                                       a
                                       )
                                    
                                 
                               for a ∈ A∖{ai, aj
                              }, 
                                 
                                    
                                       P
                                       
                                          ′
                                          ′
                                       
                                    
                                    
                                       (
                                       
                                          a
                                          i
                                       
                                       )
                                    
                                    =
                                    
                                       P
                                       ′
                                    
                                    
                                       (
                                       
                                          a
                                          i
                                       
                                       )
                                    
                                    ∖
                                    
                                       {
                                       r
                                       }
                                    
                                 
                               and 
                                 
                                    
                                       P
                                       
                                          ′
                                          ′
                                       
                                    
                                    
                                       (
                                       
                                          a
                                          j
                                       
                                       )
                                    
                                    =
                                    
                                       P
                                       ′
                                    
                                    
                                       (
                                       
                                          a
                                          j
                                       
                                       )
                                    
                                    ∪
                                    
                                       {
                                       r
                                       }
                                    
                                 
                              . Then,

                                 
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         
                                                            ∏
                                                            
                                                               
                                                                  a
                                                                  i
                                                               
                                                               ∈
                                                               A
                                                            
                                                         
                                                         
                                                            u
                                                            
                                                               a
                                                               i
                                                            
                                                         
                                                         
                                                            (
                                                            
                                                               P
                                                               
                                                                  ′
                                                                  ′
                                                               
                                                            
                                                            )
                                                         
                                                      
                                                      
                                                         
                                                            ∏
                                                            
                                                               
                                                                  a
                                                                  i
                                                               
                                                               ∈
                                                               A
                                                            
                                                         
                                                         
                                                            u
                                                            
                                                               a
                                                               i
                                                            
                                                         
                                                         
                                                            (
                                                            
                                                               P
                                                               ′
                                                            
                                                            )
                                                         
                                                      
                                                   
                                                
                                             
                                             
                                                =
                                             
                                             
                                                
                                                   
                                                      
                                                         (
                                                         
                                                            u
                                                            
                                                               a
                                                               i
                                                            
                                                         
                                                         
                                                            (
                                                            
                                                               P
                                                               ′
                                                            
                                                            )
                                                         
                                                         −
                                                         1
                                                         )
                                                      
                                                      
                                                         (
                                                         
                                                            u
                                                            
                                                               a
                                                               j
                                                            
                                                         
                                                         
                                                            (
                                                            
                                                               P
                                                               ′
                                                            
                                                            )
                                                         
                                                         +
                                                         1
                                                         )
                                                      
                                                   
                                                   
                                                      
                                                         u
                                                         
                                                            a
                                                            i
                                                         
                                                      
                                                      
                                                         (
                                                         
                                                            P
                                                            ′
                                                         
                                                         )
                                                      
                                                      
                                                         (
                                                      
                                                      
                                                         u
                                                         
                                                            a
                                                            j
                                                         
                                                      
                                                      
                                                         (
                                                         
                                                            P
                                                            ′
                                                         
                                                         )
                                                      
                                                   
                                                
                                             
                                          
                                          
                                             
                                             
                                                =
                                             
                                             
                                                
                                                   
                                                      
                                                         
                                                            u
                                                            
                                                               a
                                                               i
                                                            
                                                         
                                                         
                                                            (
                                                            
                                                               P
                                                               ′
                                                            
                                                            )
                                                         
                                                         
                                                            u
                                                            
                                                               a
                                                               j
                                                            
                                                         
                                                         
                                                            (
                                                            
                                                               P
                                                               ′
                                                            
                                                            )
                                                         
                                                         +
                                                         
                                                            u
                                                            
                                                               a
                                                               i
                                                            
                                                         
                                                         
                                                            (
                                                            
                                                               P
                                                               ′
                                                            
                                                            )
                                                         
                                                         −
                                                         
                                                            u
                                                            
                                                               a
                                                               j
                                                            
                                                         
                                                         
                                                            (
                                                            
                                                               P
                                                               ′
                                                            
                                                            )
                                                         
                                                         −
                                                         1
                                                      
                                                      
                                                         
                                                            u
                                                            
                                                               a
                                                               i
                                                            
                                                         
                                                         
                                                            (
                                                            
                                                               P
                                                               ′
                                                            
                                                            )
                                                         
                                                         
                                                            (
                                                         
                                                         
                                                            u
                                                            
                                                               a
                                                               j
                                                            
                                                         
                                                         
                                                            (
                                                            
                                                               P
                                                               ′
                                                            
                                                            )
                                                         
                                                      
                                                   
                                                   >
                                                   1
                                                
                                             
                                          
                                       
                                    
                                 
                              where the last inequality follows from 
                                 
                                    
                                       u
                                       
                                          a
                                          i
                                       
                                    
                                    
                                       (
                                       
                                          P
                                          ′
                                       
                                       )
                                    
                                    −
                                    
                                       u
                                       
                                          a
                                          j
                                       
                                    
                                    
                                       (
                                       
                                          P
                                          ′
                                       
                                       )
                                    
                                    −
                                    1
                                    =
                                    
                                       g
                                       i
                                    
                                    −
                                    
                                       g
                                       j
                                    
                                    −
                                    1
                                    ≥
                                    1
                                 
                              . This contradicts with the fact that P′ maximizes Nash social welfare. With Step 1, if follows that g is a min cost flow.


                              Step 3: Let f be an integer min cost flow. We show that 
                                 
                                    
                                       ∏
                                       
                                          
                                             a
                                             i
                                          
                                          ∈
                                          A
                                       
                                    
                                    
                                       f
                                       i
                                    
                                    =
                                    
                                       ∏
                                       
                                          
                                             a
                                             i
                                          
                                          ∈
                                          A
                                       
                                    
                                    
                                       g
                                       i
                                    
                                 
                               holds. W.l.o.g., we assume f
                              1 ≥ f
                              2 ≥ ⋅⋅⋅ ≥ fn
                              . Clearly, there is a permutation π: A → A such that g
                              
                                 π(1) ≥ g
                              
                                 π(2) ≥ ⋅⋅⋅ ≥ g
                              
                                 π(n) holds. We show that 
                                 
                                    
                                       f
                                       i
                                    
                                    =
                                    
                                       g
                                       
                                          π
                                          (
                                          i
                                          )
                                       
                                    
                                 
                               for each 1 ≤ i ≤ n.

Assume the opposite, i.e., there is an index k ≥ 1 such that 
                                 
                                    
                                       f
                                       i
                                    
                                    =
                                    
                                       g
                                       
                                          π
                                          (
                                          i
                                          )
                                       
                                    
                                 
                               for i < k and 
                                 
                                    
                                       f
                                       k
                                    
                                    ≠
                                    
                                       g
                                       
                                          π
                                          (
                                          k
                                          )
                                       
                                    
                                 
                              . If fk
                               > g
                              
                                 π(k), then

                                 
                                    (3)
                                    
                                       
                                          
                                             
                                                
                                                   c
                                                   (
                                                   f
                                                   )
                                                   −
                                                   c
                                                   (
                                                   g
                                                   )
                                                
                                             
                                             
                                                =
                                             
                                             
                                                
                                                   
                                                      ∑
                                                      
                                                         i
                                                         =
                                                         1
                                                      
                                                      n
                                                   
                                                   
                                                      (
                                                      
                                                         ∑
                                                         
                                                            h
                                                            =
                                                            1
                                                         
                                                         
                                                            f
                                                            (
                                                            i
                                                            )
                                                         
                                                      
                                                      
                                                         n
                                                         h
                                                      
                                                      −
                                                      
                                                         ∑
                                                         
                                                            
                                                               h
                                                               ′
                                                            
                                                            =
                                                            1
                                                         
                                                         
                                                            g
                                                            
                                                               π
                                                               (
                                                               i
                                                               )
                                                            
                                                         
                                                      
                                                      
                                                         n
                                                         
                                                            h
                                                            ′
                                                         
                                                      
                                                      )
                                                   
                                                
                                             
                                          
                                          
                                             
                                             
                                                =
                                             
                                             
                                                
                                                   
                                                      (
                                                      n
                                                      +
                                                      
                                                         n
                                                         2
                                                      
                                                      +
                                                      ⋯
                                                      +
                                                      
                                                         n
                                                         
                                                            f
                                                            k
                                                         
                                                      
                                                      )
                                                   
                                                   −
                                                   
                                                      (
                                                      n
                                                      +
                                                      
                                                         n
                                                         2
                                                      
                                                      +
                                                      ⋯
                                                      +
                                                      
                                                         n
                                                         
                                                            g
                                                            
                                                               π
                                                               (
                                                               k
                                                               )
                                                            
                                                         
                                                      
                                                      )
                                                   
                                                
                                             
                                          
                                          
                                             
                                             
                                             
                                                
                                                   +
                                                   
                                                      ∑
                                                      
                                                         i
                                                         =
                                                         k
                                                         +
                                                         1
                                                      
                                                      n
                                                   
                                                   
                                                      (
                                                      
                                                         ∑
                                                         
                                                            h
                                                            =
                                                            1
                                                         
                                                         
                                                            f
                                                            i
                                                         
                                                      
                                                      
                                                         n
                                                         h
                                                      
                                                      −
                                                      
                                                         ∑
                                                         
                                                            
                                                               h
                                                               ′
                                                            
                                                            =
                                                            1
                                                         
                                                         
                                                            g
                                                            
                                                               π
                                                               (
                                                               i
                                                               )
                                                            
                                                         
                                                      
                                                      
                                                         n
                                                         
                                                            h
                                                            ′
                                                         
                                                      
                                                      )
                                                   
                                                
                                             
                                          
                                          
                                             
                                             
                                                =
                                             
                                             
                                                
                                                   
                                                      n
                                                      
                                                         
                                                            g
                                                            
                                                               π
                                                               (
                                                               k
                                                               )
                                                            
                                                         
                                                         +
                                                         1
                                                      
                                                   
                                                   +
                                                   
                                                      n
                                                      
                                                         
                                                            g
                                                            
                                                               π
                                                               (
                                                               k
                                                               )
                                                            
                                                         
                                                         +
                                                         2
                                                      
                                                   
                                                   ⋯
                                                   +
                                                   
                                                      n
                                                      
                                                         f
                                                         k
                                                      
                                                   
                                                   +
                                                   
                                                      ∑
                                                      
                                                         i
                                                         =
                                                         k
                                                         +
                                                         1
                                                      
                                                      n
                                                   
                                                   
                                                      (
                                                      
                                                         ∑
                                                         
                                                            h
                                                            =
                                                            1
                                                         
                                                         
                                                            f
                                                            i
                                                         
                                                      
                                                      
                                                         n
                                                         h
                                                      
                                                      −
                                                      
                                                         ∑
                                                         
                                                            
                                                               h
                                                               ′
                                                            
                                                            =
                                                            1
                                                         
                                                         
                                                            g
                                                            
                                                               π
                                                               (
                                                               i
                                                               )
                                                            
                                                         
                                                      
                                                      
                                                         n
                                                         
                                                            h
                                                            ′
                                                         
                                                      
                                                      )
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                              Note that for any fixed 
                                 
                                    h
                                    ∈
                                    N
                                    ,
                                 
                              
                              
                                 
                                    
                                       ∑
                                       
                                          i
                                          =
                                          1
                                       
                                       h
                                    
                                    
                                       n
                                       h
                                    
                                    =
                                    
                                       
                                          
                                             n
                                             
                                                h
                                                +
                                                1
                                             
                                          
                                          −
                                          1
                                       
                                       
                                          n
                                          −
                                          1
                                       
                                    
                                    −
                                    1
                                 
                               holds. Thus,

                                 
                                    (4)
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      ∑
                                                      
                                                         i
                                                         =
                                                         k
                                                         +
                                                         1
                                                      
                                                      n
                                                   
                                                   
                                                      ∑
                                                      
                                                         
                                                            h
                                                            ′
                                                         
                                                         =
                                                         1
                                                      
                                                      
                                                         g
                                                         
                                                            π
                                                            (
                                                            i
                                                            )
                                                         
                                                      
                                                   
                                                   
                                                      n
                                                      
                                                         h
                                                         ′
                                                      
                                                   
                                                
                                             
                                             
                                                ≤
                                             
                                             
                                                
                                                   
                                                      (
                                                      n
                                                      −
                                                      k
                                                      )
                                                   
                                                   
                                                      ∑
                                                      
                                                         
                                                            h
                                                            ′
                                                         
                                                         =
                                                         1
                                                      
                                                      
                                                         g
                                                         
                                                            π
                                                            (
                                                            k
                                                            )
                                                         
                                                      
                                                   
                                                   
                                                      n
                                                      
                                                         h
                                                         ′
                                                      
                                                   
                                                   <
                                                   
                                                      (
                                                      n
                                                      −
                                                      k
                                                      )
                                                   
                                                   
                                                      
                                                         n
                                                         
                                                            
                                                               g
                                                               
                                                                  π
                                                                  (
                                                                  k
                                                                  )
                                                               
                                                            
                                                            +
                                                            1
                                                         
                                                      
                                                      
                                                         n
                                                         −
                                                         1
                                                      
                                                   
                                                   ≤
                                                   
                                                      n
                                                      
                                                         
                                                            g
                                                            
                                                               π
                                                               (
                                                               k
                                                               )
                                                            
                                                         
                                                         +
                                                         1
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                              With (4) and fk
                               > g
                              
                                 π(k), we get

                                 
                                    
                                       
                                          
                                             ∑
                                             
                                                i
                                                =
                                                k
                                                +
                                                1
                                             
                                             n
                                          
                                          
                                             (
                                             
                                                ∑
                                                
                                                   h
                                                   =
                                                   1
                                                
                                                
                                                   f
                                                   i
                                                
                                             
                                             
                                                n
                                                h
                                             
                                             −
                                             
                                                ∑
                                                
                                                   
                                                      h
                                                      ′
                                                   
                                                   =
                                                   1
                                                
                                                
                                                   g
                                                   
                                                      π
                                                      (
                                                      i
                                                      )
                                                   
                                                
                                             
                                             
                                                n
                                                
                                                   h
                                                   ′
                                                
                                             
                                             )
                                          
                                          >
                                          −
                                          
                                             ∑
                                             
                                                i
                                                =
                                                k
                                                +
                                                1
                                             
                                             n
                                          
                                          
                                             ∑
                                             
                                                
                                                   h
                                                   ′
                                                
                                                =
                                                1
                                             
                                             
                                                g
                                                
                                                   π
                                                   (
                                                   i
                                                   )
                                                
                                             
                                          
                                          
                                             n
                                             
                                                h
                                                ′
                                             
                                          
                                          >
                                          −
                                          
                                             n
                                             
                                                
                                                   g
                                                   
                                                      π
                                                      (
                                                      k
                                                      )
                                                   
                                                
                                                +
                                                1
                                             
                                          
                                          ≥
                                          −
                                          
                                             n
                                             
                                                f
                                                k
                                             
                                          
                                       
                                    
                                 
                              Together with (3) we get 
                                 
                                    c
                                    (
                                    f
                                    )
                                    −
                                    c
                                    (
                                    g
                                    )
                                    >
                                    0
                                    ,
                                 
                               in contradiction with the fact that f is a min cost flow.

Analogously, fk
                               < g
                              
                                 π(k) leads to a contradiction with the fact that g is an integer min cost flow (because of 
                                 
                                    c
                                    (
                                    f
                                    )
                                    =
                                    c
                                    (
                                    g
                                    )
                                 
                              ). Thus, 
                                 
                                    
                                       f
                                       i
                                    
                                    =
                                    
                                       g
                                       
                                          π
                                          (
                                          i
                                          )
                                       
                                    
                                 
                               holds for all 1 ≤ i ≤ k. Hence, 
                                 
                                    
                                       ∏
                                       
                                          
                                             a
                                             i
                                          
                                          ∈
                                          A
                                       
                                    
                                    
                                       f
                                       i
                                    
                                    =
                                    
                                       ∏
                                       
                                          
                                             a
                                             i
                                          
                                          ∈
                                          A
                                       
                                    
                                    
                                       g
                                       i
                                    
                                 
                               follows.

Since g is an integer flow of minimum total cost (Step 2), from Step 3 
                                 
                                    
                                       ∏
                                       
                                          
                                             a
                                             i
                                          
                                          ∈
                                          A
                                       
                                    
                                    
                                       f
                                       i
                                    
                                    =
                                    
                                       ∏
                                       
                                          
                                             a
                                             i
                                          
                                          ∈
                                          A
                                       
                                    
                                    
                                       g
                                       i
                                    
                                 
                               follows for any integer min cost flow f. Hence, in order to maximize the Nash product social welfare, it is sufficient to find an integer min cost flow in instance 
                                 M
                              . This can be done in polynomial time (see, e.g., Ahuja et al., 1993).□


                           
                              Theorem 3.4
                              
                                 NPSW-Lexicographic is
                                 
                                    NP
                                 
                                 -complete.
                              

We provide a reduction from the 
                                    NP
                                 -complete problem Cubic Monotone 1-in-3 Sat (cf. Moore & Robson, 2001). An instance 
                                    
                                       I
                                       =
                                       (
                                       X
                                       ,
                                       C
                                       )
                                    
                                  of that problem consists of a set of variables X and a set C of clauses over X, such that each clause is made up of exactly three variables of X and each variable occurs in exactly three clauses. In Cubic Monotone 1-in-3 Sat we ask if there is a truth assignment for X such that exactly one variable is true in each clause of C.

Note that there are no negated literals contained in any clause of C. In addition, observe that 
                                    
                                       |
                                       X
                                       |
                                       =
                                       |
                                       C
                                       |
                                    
                                  holds. Further note that ϕ can be a satisfying truth assignment in instance 
                                    I
                                  only if it the number of variables set true under ϕ is exactly 
                                    
                                       
                                          |
                                          X
                                          |
                                       
                                       3
                                    
                                 . Thus, |X| is a multiple of 3.

Given an instance 
                                    
                                       I
                                       =
                                       (
                                       X
                                       ,
                                       C
                                       )
                                    
                                  of Cubic Monotone 1-in-3 Sat we construct an instance 
                                    
                                       L
                                       =
                                       (
                                       R
                                       ,
                                       A
                                       ,
                                       π
                                       ,
                                       k
                                       )
                                    
                                  of NPSW-Lexicographic as follows. Abusing notation, within this paper we will identify (the set of) variables and clauses respectively with (sets of) items and agents respectively. Let 
                                    
                                       n
                                       =
                                       |
                                       X
                                       |
                                       =
                                       |
                                       C
                                       |
                                       ,
                                    
                                  and 
                                    
                                       ℓ
                                       =
                                       12
                                       n
                                    
                                 .


                                 R consists of 
                                    
                                       ℓ
                                       +
                                       6
                                       n
                                       +
                                       
                                          n
                                          3
                                       
                                    
                                  items:

                                    
                                       •
                                       The items 
                                             
                                                
                                                   d
                                                   1
                                                
                                                ,
                                                
                                                   d
                                                   2
                                                
                                                ,
                                                …
                                                ,
                                                
                                                   d
                                                   ℓ
                                                
                                             
                                          
                                       

The item sets 
                                             
                                                X
                                                =
                                                {
                                                
                                                   x
                                                   1
                                                
                                                ,
                                                
                                                   x
                                                   2
                                                
                                                ,
                                                …
                                                ,
                                                
                                                   x
                                                   n
                                                
                                                }
                                                ,
                                             
                                           and 
                                             
                                                Y
                                                =
                                                {
                                                
                                                   x
                                                   
                                                      1
                                                      ,
                                                      1
                                                   
                                                
                                                ,
                                                
                                                   x
                                                   
                                                      1
                                                      ,
                                                      2
                                                   
                                                
                                                ,
                                                
                                                   x
                                                   
                                                      1
                                                      ,
                                                      3
                                                   
                                                
                                                ,
                                                
                                                   x
                                                   
                                                      2
                                                      ,
                                                      1
                                                   
                                                
                                                ,
                                                
                                                   x
                                                   
                                                      2
                                                      ,
                                                      2
                                                   
                                                
                                                ,
                                                
                                                   x
                                                   
                                                      2
                                                      ,
                                                      3
                                                   
                                                
                                                ,
                                                …
                                                ,
                                                
                                                   x
                                                   
                                                      n
                                                      ,
                                                      1
                                                   
                                                
                                                ,
                                                
                                                   x
                                                   
                                                      n
                                                      ,
                                                      2
                                                   
                                                
                                                ,
                                                
                                                   x
                                                   
                                                      n
                                                      ,
                                                      3
                                                   
                                                
                                                }
                                             
                                          
                                       

The item sets 
                                             
                                                B
                                                =
                                                {
                                                
                                                   b
                                                   
                                                      1
                                                      ,
                                                      1
                                                   
                                                
                                                ,
                                                
                                                   b
                                                   
                                                      1
                                                      ,
                                                      2
                                                   
                                                
                                                ,
                                                
                                                   b
                                                   
                                                      2
                                                      ,
                                                      1
                                                   
                                                
                                                ,
                                                
                                                   b
                                                   
                                                      2
                                                      ,
                                                      2
                                                   
                                                
                                                ,
                                                …
                                                ,
                                                
                                                   b
                                                   
                                                      n
                                                      ,
                                                      1
                                                   
                                                
                                                ,
                                                
                                                   b
                                                   
                                                      n
                                                      ,
                                                      2
                                                   
                                                
                                                }
                                             
                                           and 
                                             
                                                H
                                                =
                                                {
                                                
                                                   h
                                                   1
                                                
                                                ,
                                                
                                                   h
                                                   2
                                                
                                                ,
                                                …
                                                ,
                                                
                                                   h
                                                   
                                                      n
                                                      3
                                                   
                                                
                                                }
                                             
                                          
                                       

Over the sets B, H, X resp. Y we define the rankings τB, τH, τX
                                 , and τY
                                  as follows:

                                    
                                       •
                                       
                                          
                                             
                                                
                                                   τ
                                                   X
                                                
                                                =
                                                
                                                   x
                                                   1
                                                
                                                ≻
                                                
                                                   x
                                                   2
                                                
                                                ≻
                                                ⋯
                                                ≻
                                                
                                                   x
                                                   n
                                                
                                                ,
                                             
                                          
                                          
                                             
                                                
                                                   τ
                                                   H
                                                
                                                =
                                                
                                                   h
                                                   1
                                                
                                                ≻
                                                
                                                   h
                                                   2
                                                
                                                ≻
                                                ⋯
                                                ≻
                                                
                                                   h
                                                   
                                                      n
                                                      3
                                                   
                                                
                                                ,
                                             
                                          
                                       


                                          
                                             
                                                
                                                   τ
                                                   B
                                                
                                                =
                                                
                                                   b
                                                   
                                                      1
                                                      ,
                                                      1
                                                   
                                                
                                                ≻
                                                
                                                   b
                                                   
                                                      1
                                                      ,
                                                      2
                                                   
                                                
                                                ≻
                                                
                                                   b
                                                   
                                                      2
                                                      ,
                                                      1
                                                   
                                                
                                                ≻
                                                ⋯
                                                ≻
                                                
                                                   b
                                                   
                                                      n
                                                      ,
                                                      2
                                                   
                                                
                                                ,
                                             
                                           and 
                                             
                                                
                                                   τ
                                                   Y
                                                
                                                =
                                                
                                                   x
                                                   
                                                      1
                                                      ,
                                                      1
                                                   
                                                
                                                ≻
                                                
                                                   x
                                                   
                                                      1
                                                      ,
                                                      2
                                                   
                                                
                                                ≻
                                                
                                                   x
                                                   
                                                      1
                                                      ,
                                                      3
                                                   
                                                
                                                ≻
                                                
                                                   x
                                                   
                                                      2
                                                      ,
                                                      1
                                                   
                                                
                                                ≻
                                                ⋯
                                                ≻
                                                
                                                   x
                                                   
                                                      n
                                                      ,
                                                      3
                                                   
                                                
                                             
                                          
                                       

Let S ∈ {B, H, X, Y}. For any subset Z of S, by τZ
                                  we denote the ranking τS
                                  restricted to the subset Z. Within this proof, we represent the clause 
                                    
                                       
                                          C
                                          i
                                       
                                       =
                                       
                                          (
                                          
                                             x
                                             
                                                
                                                   i
                                                   1
                                                
                                                ,
                                                
                                                   k
                                                   1
                                                
                                             
                                          
                                          ∨
                                          
                                             x
                                             
                                                
                                                   i
                                                   2
                                                
                                                ,
                                                
                                                   k
                                                   2
                                                
                                             
                                          
                                          ∨
                                          
                                             x
                                             
                                                
                                                   i
                                                   3
                                                
                                                ,
                                                
                                                   k
                                                   3
                                                
                                             
                                          
                                          )
                                       
                                       ,
                                    
                                  where kj
                                  ∈ {1, 2, 3} denotes the kj
                                 -th occurrence of variable 
                                    
                                       x
                                       
                                          i
                                          j
                                       
                                    
                                  in C, by the set 
                                    
                                       
                                          C
                                          i
                                       
                                       =
                                       
                                          {
                                          
                                             x
                                             
                                                
                                                   i
                                                   1
                                                
                                                ,
                                                
                                                   k
                                                   1
                                                
                                             
                                          
                                          ∨
                                          
                                             x
                                             
                                                
                                                   i
                                                   2
                                                
                                                ,
                                                
                                                   k
                                                   2
                                                
                                             
                                          
                                          ∨
                                          
                                             x
                                             
                                                
                                                   i
                                                   3
                                                
                                                ,
                                                
                                                   k
                                                   3
                                                
                                             
                                          
                                          }
                                       
                                    
                                 .


                                 A consists of 
                                    
                                       ℓ
                                       +
                                       5
                                       n
                                    
                                  agents:

                                    
                                       •
                                       For each 1 ≤ i ≤ ℓ, the ranking of agent Di
                                           is given by

                                             
                                                
                                                   
                                                      
                                                         d
                                                         1
                                                      
                                                      ≻
                                                      
                                                         d
                                                         2
                                                      
                                                      ≻
                                                      ⋯
                                                      ≻
                                                      
                                                         d
                                                         ℓ
                                                      
                                                      ≻
                                                      
                                                         τ
                                                         B
                                                      
                                                      ≻
                                                      
                                                         τ
                                                         Y
                                                      
                                                      ≻
                                                      
                                                         τ
                                                         X
                                                      
                                                      ≻
                                                      
                                                         τ
                                                         H
                                                      
                                                   
                                                
                                             
                                          
                                       

For 1 ≤ i ≤ n, the ranking of agent Hi
                                           is given by

                                             
                                                
                                                   
                                                      
                                                         τ
                                                         H
                                                      
                                                      ≻
                                                      
                                                         x
                                                         i
                                                      
                                                      ≻
                                                      
                                                         d
                                                         1
                                                      
                                                      ≻
                                                      
                                                         d
                                                         2
                                                      
                                                      ≻
                                                      ⋯
                                                      ≻
                                                      
                                                         d
                                                         
                                                            5
                                                            n
                                                            −
                                                            1
                                                         
                                                      
                                                      ≻
                                                      
                                                         τ
                                                         B
                                                      
                                                      ≻
                                                      
                                                         τ
                                                         Y
                                                      
                                                      ≻
                                                      
                                                         τ
                                                         
                                                            X
                                                            ∖
                                                            {
                                                            
                                                               x
                                                               i
                                                            
                                                            }
                                                         
                                                      
                                                      ≻
                                                      
                                                         d
                                                         
                                                            5
                                                            n
                                                         
                                                      
                                                      ≻
                                                      ⋯
                                                      ≻
                                                      
                                                         d
                                                         ℓ
                                                      
                                                   
                                                
                                             
                                          
                                       

For 1 ≤ i ≤ n, the ranking of agent Xi
                                           is given by

                                             
                                                
                                                   
                                                      
                                                         
                                                         
                                                         
                                                            
                                                               
                                                                  x
                                                                  i
                                                               
                                                               ≻
                                                               
                                                                  d
                                                                  1
                                                               
                                                               ≻
                                                               ⋯
                                                               ≻
                                                               
                                                                  d
                                                                  n
                                                               
                                                               ≻
                                                               
                                                                  x
                                                                  
                                                                     i
                                                                     ,
                                                                     1
                                                                  
                                                               
                                                               ≻
                                                               
                                                                  x
                                                                  
                                                                     i
                                                                     ,
                                                                     2
                                                                  
                                                               
                                                               ≻
                                                               
                                                                  x
                                                                  
                                                                     i
                                                                     ,
                                                                     3
                                                                  
                                                               
                                                               ≻
                                                               
                                                                  d
                                                                  
                                                                     n
                                                                     +
                                                                     1
                                                                  
                                                               
                                                               ≻
                                                               ⋯
                                                               ≻
                                                               
                                                                  d
                                                                  
                                                                     5
                                                                     n
                                                                     −
                                                                     6
                                                                  
                                                               
                                                               ≻
                                                            
                                                         
                                                      
                                                      
                                                         
                                                         
                                                         
                                                            
                                                               
                                                               ≻
                                                               
                                                                  τ
                                                                  B
                                                               
                                                               ≻
                                                               
                                                                  τ
                                                                  
                                                                     Y
                                                                     ∖
                                                                     {
                                                                     
                                                                        x
                                                                        
                                                                           i
                                                                           ,
                                                                           1
                                                                        
                                                                     
                                                                     ,
                                                                     
                                                                        x
                                                                        
                                                                           i
                                                                           ,
                                                                           2
                                                                        
                                                                     
                                                                     ,
                                                                     
                                                                        x
                                                                        
                                                                           i
                                                                           ,
                                                                           3
                                                                        
                                                                     
                                                                     }
                                                                  
                                                               
                                                               ≻
                                                               
                                                                  τ
                                                                  
                                                                     X
                                                                     ∖
                                                                     {
                                                                     
                                                                        x
                                                                        i
                                                                     
                                                                     }
                                                                  
                                                               
                                                               ≻
                                                               
                                                                  d
                                                                  
                                                                     5
                                                                     n
                                                                     −
                                                                     5
                                                                  
                                                               
                                                               ≻
                                                               ⋯
                                                               ≻
                                                               
                                                                  d
                                                                  ℓ
                                                               
                                                            
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                       

For 1 ≤ i ≤ n, the rankings of the agents αi, βi, γi
                                           are as follows. Let

                                             
                                                
                                                   
                                                      
                                                         
                                                            
                                                               τ
                                                               
                                                                  α
                                                                  i
                                                               
                                                            
                                                         
                                                         
                                                            =
                                                         
                                                         
                                                            
                                                               
                                                                  x
                                                                  
                                                                     
                                                                        i
                                                                        1
                                                                     
                                                                     ,
                                                                     
                                                                        k
                                                                        1
                                                                     
                                                                  
                                                               
                                                               ≻
                                                               
                                                                  d
                                                                  
                                                                     2
                                                                     n
                                                                     +
                                                                     5
                                                                  
                                                               
                                                               ≻
                                                               
                                                                  d
                                                                  
                                                                     2
                                                                     n
                                                                     +
                                                                     6
                                                                  
                                                               
                                                               ≻
                                                               ⋯
                                                               ≻
                                                               
                                                                  d
                                                                  
                                                                     3
                                                                     n
                                                                     +
                                                                     4
                                                                  
                                                               
                                                               ≻
                                                               
                                                                  x
                                                                  
                                                                     
                                                                        i
                                                                        2
                                                                     
                                                                     ,
                                                                     
                                                                        k
                                                                        2
                                                                     
                                                                  
                                                               
                                                               ≻
                                                               
                                                                  d
                                                                  
                                                                     3
                                                                     n
                                                                     +
                                                                     5
                                                                  
                                                               
                                                               ≻
                                                               
                                                                  d
                                                                  
                                                                     3
                                                                     n
                                                                     +
                                                                     6
                                                                  
                                                               
                                                            
                                                         
                                                      
                                                      
                                                         
                                                         
                                                         
                                                            
                                                               ≻
                                                               ⋯
                                                               ≻
                                                               
                                                                  d
                                                                  
                                                                     4
                                                                     n
                                                                     +
                                                                     4
                                                                  
                                                               
                                                               ≻
                                                               
                                                                  x
                                                                  
                                                                     
                                                                        i
                                                                        3
                                                                     
                                                                     ,
                                                                     
                                                                        k
                                                                        3
                                                                     
                                                                  
                                                               
                                                            
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                          
                                             
                                                
                                                   
                                                      
                                                         
                                                            
                                                               τ
                                                               
                                                                  β
                                                                  i
                                                               
                                                            
                                                         
                                                         
                                                            =
                                                         
                                                         
                                                            
                                                               
                                                                  x
                                                                  
                                                                     
                                                                        i
                                                                        2
                                                                     
                                                                     ,
                                                                     
                                                                        k
                                                                        2
                                                                     
                                                                  
                                                               
                                                               ≻
                                                               
                                                                  d
                                                                  
                                                                     2
                                                                     n
                                                                     +
                                                                     5
                                                                  
                                                               
                                                               ≻
                                                               
                                                                  d
                                                                  
                                                                     2
                                                                     n
                                                                     +
                                                                     6
                                                                  
                                                               
                                                               ≻
                                                               ⋯
                                                               ≻
                                                               
                                                                  d
                                                                  
                                                                     3
                                                                     n
                                                                     +
                                                                     4
                                                                  
                                                               
                                                               ≻
                                                               
                                                                  x
                                                                  
                                                                     
                                                                        i
                                                                        3
                                                                     
                                                                     ,
                                                                     
                                                                        k
                                                                        3
                                                                     
                                                                  
                                                               
                                                               ≻
                                                               
                                                                  d
                                                                  
                                                                     3
                                                                     n
                                                                     +
                                                                     5
                                                                  
                                                               
                                                            
                                                         
                                                      
                                                      
                                                         
                                                         
                                                         
                                                            
                                                               ≻
                                                               
                                                                  d
                                                                  
                                                                     3
                                                                     n
                                                                     +
                                                                     6
                                                                  
                                                               
                                                               ≻
                                                               ⋯
                                                               ≻
                                                               
                                                                  d
                                                                  
                                                                     4
                                                                     n
                                                                     +
                                                                     4
                                                                  
                                                               
                                                               ≻
                                                               
                                                                  x
                                                                  
                                                                     
                                                                        i
                                                                        1
                                                                     
                                                                     ,
                                                                     
                                                                        k
                                                                        1
                                                                     
                                                                  
                                                               
                                                            
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                          
                                             
                                                
                                                   
                                                      
                                                         
                                                            
                                                               τ
                                                               
                                                                  α
                                                                  i
                                                               
                                                            
                                                         
                                                         
                                                            =
                                                         
                                                         
                                                            
                                                               
                                                                  x
                                                                  
                                                                     
                                                                        i
                                                                        3
                                                                     
                                                                     ,
                                                                     
                                                                        k
                                                                        3
                                                                     
                                                                  
                                                               
                                                               ≻
                                                               
                                                                  d
                                                                  
                                                                     2
                                                                     n
                                                                     +
                                                                     5
                                                                  
                                                               
                                                               ≻
                                                               
                                                                  d
                                                                  
                                                                     2
                                                                     n
                                                                     +
                                                                     6
                                                                  
                                                               
                                                               ≻
                                                               ⋯
                                                               ≻
                                                               
                                                                  d
                                                                  
                                                                     3
                                                                     n
                                                                     +
                                                                     4
                                                                  
                                                               
                                                               ≻
                                                               
                                                                  x
                                                                  
                                                                     
                                                                        i
                                                                        1
                                                                     
                                                                     ,
                                                                     
                                                                        k
                                                                        1
                                                                     
                                                                  
                                                               
                                                               ≻
                                                               
                                                                  d
                                                                  
                                                                     3
                                                                     n
                                                                     +
                                                                     5
                                                                  
                                                               
                                                            
                                                         
                                                      
                                                      
                                                         
                                                         
                                                         
                                                            
                                                               ≻
                                                               
                                                                  d
                                                                  
                                                                     3
                                                                     n
                                                                     +
                                                                     6
                                                                  
                                                               
                                                               ≻
                                                               ⋯
                                                               ≻
                                                               
                                                                  d
                                                                  
                                                                     4
                                                                     n
                                                                     +
                                                                     4
                                                                  
                                                               
                                                               ≻
                                                               
                                                                  x
                                                                  
                                                                     
                                                                        i
                                                                        2
                                                                     
                                                                     ,
                                                                     
                                                                        k
                                                                        2
                                                                     
                                                                  
                                                               
                                                            
                                                         
                                                      
                                                   
                                                
                                             
                                          The ranking of αi
                                           is given by

                                             
                                                
                                                   
                                                      
                                                         
                                                         
                                                         
                                                            
                                                               
                                                                  d
                                                                  1
                                                               
                                                               ≻
                                                               ⋯
                                                               ≻
                                                               
                                                                  d
                                                                  
                                                                     n
                                                                     +
                                                                     4
                                                                  
                                                               
                                                               ≻
                                                               
                                                                  b
                                                                  
                                                                     i
                                                                     ,
                                                                     1
                                                                  
                                                               
                                                               ≻
                                                               
                                                                  b
                                                                  
                                                                     i
                                                                     ,
                                                                     2
                                                                  
                                                               
                                                               ≻
                                                               
                                                                  d
                                                                  
                                                                     n
                                                                     +
                                                                     5
                                                                  
                                                               
                                                               ≻
                                                               ⋯
                                                               
                                                                  d
                                                                  
                                                                     2
                                                                     n
                                                                     +
                                                                     4
                                                                  
                                                               
                                                               ≻
                                                               
                                                                  τ
                                                                  
                                                                     α
                                                                     i
                                                                  
                                                               
                                                            
                                                         
                                                      
                                                      
                                                         
                                                         
                                                         
                                                            
                                                               
                                                               ≻
                                                               
                                                                  d
                                                                  
                                                                     4
                                                                     n
                                                                     +
                                                                     5
                                                                  
                                                               
                                                               ≻
                                                               ⋯
                                                               ≻
                                                               
                                                                  d
                                                                  
                                                                     5
                                                                     n
                                                                     −
                                                                     1
                                                                  
                                                               
                                                               ≻
                                                               
                                                                  τ
                                                                  
                                                                     B
                                                                     ∖
                                                                     {
                                                                     
                                                                        b
                                                                        
                                                                           i
                                                                           ,
                                                                           1
                                                                        
                                                                     
                                                                     ,
                                                                     
                                                                        b
                                                                        
                                                                           i
                                                                           ,
                                                                           2
                                                                        
                                                                     
                                                                     }
                                                                  
                                                               
                                                               ≻
                                                               
                                                                  τ
                                                                  
                                                                     Y
                                                                     ∖
                                                                     
                                                                        C
                                                                        i
                                                                     
                                                                  
                                                               
                                                               ≻
                                                               
                                                                  τ
                                                                  X
                                                               
                                                               ≻
                                                               
                                                                  τ
                                                                  H
                                                               
                                                            
                                                         
                                                      
                                                      
                                                         
                                                         
                                                         
                                                            
                                                               
                                                               ≻
                                                               
                                                                  d
                                                                  
                                                                     5
                                                                     n
                                                                  
                                                               
                                                               ≻
                                                               ⋯
                                                               ≻
                                                               
                                                                  d
                                                                  ℓ
                                                               
                                                            
                                                         
                                                      
                                                   
                                                
                                             
                                          The ranking of βi
                                           (resp. γi
                                          ) results from 
                                             
                                                π
                                                
                                                   α
                                                   i
                                                
                                             
                                           by replacing 
                                             
                                                τ
                                                
                                                   α
                                                   i
                                                
                                             
                                           with 
                                             
                                                τ
                                                
                                                   β
                                                   i
                                                
                                             
                                           (resp. 
                                             
                                                τ
                                                
                                                   γ
                                                   i
                                                
                                             
                                          ).

Let 
                                    
                                       M
                                       :
                                       =
                                       |
                                       R
                                       |
                                       −
                                       1
                                       ,
                                    
                                  and

                                    
                                       
                                          
                                             
                                                
                                                   κ
                                                
                                                
                                                   =
                                                
                                                
                                                   
                                                      
                                                         [
                                                         
                                                            2
                                                            
                                                               M
                                                               −
                                                               (
                                                               n
                                                               +
                                                               1
                                                               )
                                                            
                                                         
                                                         +
                                                         
                                                            2
                                                            
                                                               M
                                                               −
                                                               (
                                                               n
                                                               +
                                                               2
                                                               )
                                                            
                                                         
                                                         +
                                                         
                                                            2
                                                            
                                                               M
                                                               −
                                                               (
                                                               n
                                                               +
                                                               3
                                                               )
                                                            
                                                         
                                                         ]
                                                      
                                                      
                                                         
                                                            2
                                                            n
                                                         
                                                         3
                                                      
                                                   
                                                
                                             
                                             
                                                
                                                
                                                
                                                   
                                                      ·
                                                      
                                                         
                                                            [
                                                            
                                                               2
                                                               
                                                                  M
                                                                  −
                                                                  (
                                                                  n
                                                                  +
                                                                  4
                                                                  )
                                                               
                                                            
                                                            ·
                                                            
                                                               2
                                                               
                                                                  M
                                                                  −
                                                                  (
                                                                  n
                                                                  +
                                                                  5
                                                                  )
                                                               
                                                            
                                                            ·
                                                            
                                                               2
                                                               
                                                                  M
                                                                  −
                                                                  (
                                                                  3
                                                                  n
                                                                  +
                                                                  6
                                                                  )
                                                               
                                                            
                                                            ]
                                                         
                                                         
                                                            n
                                                            3
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                 Set

                                    
                                       
                                          
                                             
                                                
                                                   k
                                                
                                                
                                                   =
                                                
                                                
                                                   
                                                      
                                                         (
                                                         
                                                            ∏
                                                            
                                                               i
                                                               =
                                                               0
                                                            
                                                            
                                                               ℓ
                                                               −
                                                               1
                                                            
                                                         
                                                         
                                                            2
                                                            
                                                               M
                                                               −
                                                               i
                                                            
                                                         
                                                         )
                                                      
                                                      ·
                                                      
                                                         2
                                                         
                                                            n
                                                            3
                                                         
                                                      
                                                      ·
                                                      
                                                         2
                                                         
                                                            
                                                               ∑
                                                               
                                                                  i
                                                                  =
                                                                  0
                                                               
                                                               
                                                                  
                                                                     n
                                                                     3
                                                                  
                                                                  −
                                                                  1
                                                               
                                                            
                                                            
                                                               (
                                                               M
                                                               −
                                                               i
                                                               )
                                                            
                                                         
                                                      
                                                      ·
                                                      
                                                         2
                                                         
                                                            
                                                               (
                                                               M
                                                               −
                                                               
                                                                  n
                                                                  3
                                                               
                                                               )
                                                            
                                                            
                                                               
                                                                  2
                                                                  n
                                                               
                                                               3
                                                            
                                                         
                                                      
                                                      ·
                                                      κ
                                                   
                                                
                                             
                                          
                                       
                                    
                                 In instance 
                                    L
                                  we ask if there is an allocation P with swN
                                 (P) ≥ k.

We begin with two simple lemmata.

                              Lemma 3.5
                              
                                 Let P be an allocation. Let Q result from P by handing an item p ∈ P(a
                                 2) to agent a
                                 1 
                                 such that the following properties are satisfied:

                                    
                                       •
                                       ∃q ∈ P(a
                                          2) such that a
                                          2 
                                          ranks q higher than p
                                       


                                          a
                                          1 
                                          ranks p higher than the highest-ranked item of P(a
                                          1)


                                 Then, ∏
                                    a ∈ A
                                 
                                 ua
                                 (P) < ∏
                                    a ∈ A
                                 
                                 ua
                                 (Q).

Let 
                                    
                                       
                                          u
                                          
                                             a
                                             2
                                          
                                       
                                       
                                          (
                                          p
                                          )
                                       
                                       =
                                       
                                          2
                                          s
                                       
                                    
                                  and 
                                    
                                       
                                          u
                                          
                                             a
                                             1
                                          
                                       
                                       
                                          (
                                          p
                                          )
                                       
                                       =
                                       
                                          2
                                          t
                                       
                                    
                                  for some 
                                    
                                       s
                                       ,
                                       t
                                       ∈
                                       N
                                    
                                 . Clearly, the stated properties imply

                                    
                                       (5)
                                       
                                          
                                             
                                                u
                                                
                                                   a
                                                   2
                                                
                                             
                                             
                                                (
                                                P
                                                )
                                             
                                             >
                                             
                                                2
                                                
                                                   s
                                                   +
                                                   1
                                                
                                             
                                             
                                             and
                                             
                                             
                                                u
                                                
                                                   a
                                                   1
                                                
                                             
                                             
                                                (
                                                P
                                                )
                                             
                                             <
                                             
                                                2
                                                t
                                             
                                          
                                       
                                    
                                 With (5), we can conclude that

                                    
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         u
                                                         
                                                            a
                                                            1
                                                         
                                                      
                                                      
                                                         (
                                                         Q
                                                         )
                                                      
                                                      ·
                                                      
                                                         u
                                                         
                                                            a
                                                            2
                                                         
                                                      
                                                      
                                                         (
                                                         Q
                                                         )
                                                      
                                                   
                                                
                                                
                                                   =
                                                
                                                
                                                   
                                                      [
                                                      
                                                         u
                                                         
                                                            a
                                                            1
                                                         
                                                      
                                                      
                                                         (
                                                         P
                                                         )
                                                      
                                                      +
                                                      
                                                         2
                                                         t
                                                      
                                                      
                                                         )
                                                         ]
                                                         ·
                                                         [
                                                      
                                                      
                                                         u
                                                         
                                                            a
                                                            2
                                                         
                                                      
                                                      
                                                         (
                                                         P
                                                         )
                                                      
                                                      −
                                                      
                                                         2
                                                         s
                                                      
                                                      ]
                                                   
                                                
                                             
                                             
                                                
                                                
                                                   =
                                                
                                                
                                                   
                                                      
                                                         u
                                                         
                                                            a
                                                            1
                                                         
                                                      
                                                      
                                                         (
                                                         P
                                                         )
                                                      
                                                      ·
                                                      
                                                         u
                                                         
                                                            a
                                                            2
                                                         
                                                      
                                                      
                                                         (
                                                         P
                                                         )
                                                      
                                                      +
                                                      
                                                         2
                                                         t
                                                      
                                                      
                                                         u
                                                         
                                                            a
                                                            2
                                                         
                                                      
                                                      
                                                         (
                                                         P
                                                         )
                                                      
                                                      −
                                                      
                                                         2
                                                         s
                                                      
                                                      
                                                         u
                                                         
                                                            a
                                                            1
                                                         
                                                      
                                                      
                                                         (
                                                         P
                                                         )
                                                      
                                                      −
                                                      
                                                         2
                                                         
                                                            s
                                                            +
                                                            t
                                                         
                                                      
                                                   
                                                
                                             
                                             
                                                
                                                
                                                   >
                                                
                                                
                                                   
                                                      
                                                         u
                                                         
                                                            a
                                                            1
                                                         
                                                      
                                                      
                                                         (
                                                         P
                                                         )
                                                      
                                                      ·
                                                      
                                                         u
                                                         
                                                            a
                                                            2
                                                         
                                                      
                                                      
                                                         (
                                                         P
                                                         )
                                                      
                                                      +
                                                      
                                                         2
                                                         
                                                            t
                                                            +
                                                            s
                                                            +
                                                            1
                                                         
                                                      
                                                      −
                                                      
                                                         2
                                                         s
                                                      
                                                      
                                                         2
                                                         t
                                                      
                                                      −
                                                      
                                                         2
                                                         
                                                            s
                                                            +
                                                            t
                                                         
                                                      
                                                   
                                                
                                             
                                             
                                                
                                                
                                                   =
                                                
                                                
                                                   
                                                      
                                                         u
                                                         
                                                            a
                                                            1
                                                         
                                                      
                                                      
                                                         (
                                                         P
                                                         )
                                                      
                                                      ·
                                                      
                                                         u
                                                         
                                                            a
                                                            2
                                                         
                                                      
                                                      
                                                         (
                                                         P
                                                         )
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                              

holds. Therefore, ∏
                                    a ∈ A
                                 
                                 ua
                                 (P) < ∏
                                    a ∈ A
                                 
                                 ua
                                 (Q).□


                                 Let P be an allocation. Let Q result from P by handing an item p ∈ P(a
                                 2) to agent a
                                 1 
                                 and q ∈ P(a
                                 1) to agent a
                                 2 
                                 such that for some
                                 
                                    
                                       j
                                       ∈
                                       N
                                    
                                  
                                 the following properties are satisfied:

                                    
                                       •
                                       
                                          a
                                          2 
                                          ranks q at most j positions lower than p
                                       


                                          a
                                          1 
                                          ranks p at least
                                          
                                             
                                                (
                                                j
                                                +
                                                1
                                                )
                                             
                                           
                                          positions higher than the highest-ranked item of P(a
                                          1)


                                 Then, ∏
                                    a ∈ A
                                 
                                 ua
                                 (P) < ∏
                                    a ∈ A
                                 
                                 ua
                                 (Q).

Let λ denote the rank of the highest-ranked item of P(a
                                 1) in the ranking of a
                                 1. Then,

                                    
                                       (6)
                                       
                                          
                                             
                                                2
                                                λ
                                             
                                             ≤
                                             
                                                u
                                                
                                                   a
                                                   1
                                                
                                             
                                             
                                                (
                                                P
                                                )
                                             
                                             <
                                             
                                                2
                                                
                                                   λ
                                                   +
                                                   1
                                                
                                             
                                          
                                       
                                    
                                 holds. Let μ denote the rank of item p in the ranking of a
                                 2; 
                                    
                                       
                                          2
                                          μ
                                       
                                       ≤
                                       
                                          u
                                          
                                             a
                                             2
                                          
                                       
                                       
                                          (
                                          P
                                          )
                                       
                                    
                                  holds. Comparing the Nash product social welfare achieved by the allocations, it is enough to consider

                                    
                                       
                                          
                                             
                                                u
                                                
                                                   a
                                                   1
                                                
                                             
                                             
                                                (
                                                Q
                                                )
                                             
                                             ·
                                             
                                                u
                                                
                                                   a
                                                   2
                                                
                                             
                                             
                                                (
                                                Q
                                                )
                                             
                                             −
                                             
                                                u
                                                
                                                   a
                                                   1
                                                
                                             
                                             
                                                (
                                                P
                                                )
                                             
                                             ·
                                             
                                                u
                                                
                                                   a
                                                   2
                                                
                                             
                                             
                                                (
                                                P
                                                )
                                             
                                          
                                       
                                    
                                 since for the remaining the agents the utilities of P and P′ coincide. Now,

                                    
                                       
                                          
                                             
                                                
                                                
                                                
                                                   
                                                      
                                                         u
                                                         
                                                            a
                                                            1
                                                         
                                                      
                                                      
                                                         (
                                                         Q
                                                         )
                                                      
                                                      ·
                                                      
                                                         u
                                                         
                                                            a
                                                            2
                                                         
                                                      
                                                      
                                                         (
                                                         Q
                                                         )
                                                      
                                                      −
                                                      
                                                         u
                                                         
                                                            a
                                                            1
                                                         
                                                      
                                                      
                                                         (
                                                         P
                                                         )
                                                      
                                                      ·
                                                      
                                                         u
                                                         
                                                            a
                                                            2
                                                         
                                                      
                                                      
                                                         (
                                                         P
                                                         )
                                                      
                                                   
                                                
                                             
                                             
                                                
                                                
                                                
                                                   
                                                      
                                                      ≥
                                                      
                                                         (
                                                         
                                                            u
                                                            
                                                               a
                                                               1
                                                            
                                                         
                                                         
                                                            (
                                                            P
                                                            )
                                                         
                                                         +
                                                         
                                                            2
                                                            
                                                               λ
                                                               +
                                                               (
                                                               j
                                                               +
                                                               1
                                                               )
                                                            
                                                         
                                                         −
                                                         
                                                            2
                                                            λ
                                                         
                                                         )
                                                      
                                                      
                                                         (
                                                         
                                                            u
                                                            
                                                               a
                                                               2
                                                            
                                                         
                                                         
                                                            (
                                                            P
                                                            )
                                                         
                                                         +
                                                         
                                                            2
                                                            
                                                               μ
                                                               −
                                                               j
                                                            
                                                         
                                                         −
                                                         
                                                            2
                                                            μ
                                                         
                                                         )
                                                      
                                                      −
                                                      
                                                         u
                                                         
                                                            a
                                                            1
                                                         
                                                      
                                                      
                                                         (
                                                         P
                                                         )
                                                      
                                                      ·
                                                      
                                                         u
                                                         
                                                            a
                                                            2
                                                         
                                                      
                                                      
                                                         (
                                                         P
                                                         )
                                                      
                                                   
                                                
                                             
                                             
                                                
                                                
                                                
                                                   
                                                      
                                                      =
                                                      
                                                         u
                                                         
                                                            a
                                                            1
                                                         
                                                      
                                                      
                                                         (
                                                         P
                                                         )
                                                      
                                                      
                                                         (
                                                         
                                                            2
                                                            
                                                               μ
                                                               −
                                                               j
                                                            
                                                         
                                                         −
                                                         
                                                            2
                                                            μ
                                                         
                                                         )
                                                      
                                                      +
                                                      
                                                         (
                                                         
                                                            2
                                                            
                                                               λ
                                                               +
                                                               (
                                                               j
                                                               +
                                                               1
                                                               )
                                                            
                                                         
                                                         −
                                                         
                                                            2
                                                            λ
                                                         
                                                         )
                                                      
                                                      
                                                         u
                                                         
                                                            a
                                                            2
                                                         
                                                      
                                                      
                                                         (
                                                         P
                                                         )
                                                      
                                                      +
                                                      
                                                         2
                                                         
                                                            λ
                                                            +
                                                            μ
                                                            +
                                                            1
                                                         
                                                      
                                                   
                                                
                                             
                                             
                                                
                                                
                                                
                                                   
                                                      
                                                      −
                                                      
                                                         2
                                                         
                                                            λ
                                                            +
                                                            (
                                                            j
                                                            +
                                                            1
                                                            )
                                                            +
                                                            μ
                                                         
                                                      
                                                      −
                                                      
                                                         2
                                                         
                                                            λ
                                                            +
                                                            μ
                                                            −
                                                            j
                                                         
                                                      
                                                      +
                                                      
                                                         2
                                                         
                                                            λ
                                                            +
                                                            μ
                                                         
                                                      
                                                   
                                                
                                             
                                             
                                                
                                                
                                                
                                                   
                                                      
                                                      =
                                                      
                                                         [
                                                         
                                                            u
                                                            
                                                               a
                                                               1
                                                            
                                                         
                                                         
                                                            (
                                                            P
                                                            )
                                                         
                                                         
                                                            2
                                                            
                                                               μ
                                                               −
                                                               j
                                                            
                                                         
                                                         −
                                                         
                                                            2
                                                            
                                                               λ
                                                               +
                                                               μ
                                                               −
                                                               j
                                                            
                                                         
                                                         ]
                                                      
                                                      +
                                                      
                                                         [
                                                         
                                                            2
                                                            
                                                               λ
                                                               +
                                                               μ
                                                               +
                                                               1
                                                            
                                                         
                                                         −
                                                         
                                                            2
                                                            μ
                                                         
                                                         
                                                            u
                                                            
                                                               a
                                                               1
                                                            
                                                         
                                                         
                                                            (
                                                            P
                                                            )
                                                         
                                                         ]
                                                      
                                                   
                                                
                                             
                                             
                                                
                                                
                                                
                                                   
                                                      
                                                      +
                                                      [
                                                      
                                                         (
                                                         
                                                            2
                                                            
                                                               λ
                                                               +
                                                               (
                                                               j
                                                               +
                                                               1
                                                               )
                                                            
                                                         
                                                         −
                                                         
                                                            2
                                                            λ
                                                         
                                                         )
                                                      
                                                      
                                                         u
                                                         
                                                            a
                                                            2
                                                         
                                                      
                                                      
                                                         (
                                                         P
                                                         )
                                                      
                                                      −
                                                      
                                                         2
                                                         
                                                            λ
                                                            +
                                                            (
                                                            j
                                                            +
                                                            1
                                                            )
                                                            +
                                                            μ
                                                         
                                                      
                                                      +
                                                      
                                                         2
                                                         
                                                            λ
                                                            +
                                                            μ
                                                         
                                                      
                                                      ]
                                                   
                                                
                                             
                                             
                                                
                                                
                                                
                                                   
                                                      
                                                      >
                                                      [
                                                      
                                                         (
                                                         
                                                            2
                                                            
                                                               λ
                                                               +
                                                               (
                                                               j
                                                               +
                                                               1
                                                               )
                                                            
                                                         
                                                         −
                                                         
                                                            2
                                                            λ
                                                         
                                                         )
                                                      
                                                      
                                                         u
                                                         
                                                            a
                                                            2
                                                         
                                                      
                                                      
                                                         (
                                                         P
                                                         )
                                                      
                                                      −
                                                      
                                                         2
                                                         
                                                            λ
                                                            +
                                                            (
                                                            j
                                                            +
                                                            1
                                                            )
                                                            +
                                                            μ
                                                         
                                                      
                                                      +
                                                      
                                                         2
                                                         
                                                            λ
                                                            +
                                                            μ
                                                         
                                                      
                                                      ]
                                                   
                                                
                                             
                                          
                                       
                                    
                                 where the last inequality follows from (6). Since 
                                    
                                       
                                          u
                                          
                                             a
                                             2
                                          
                                       
                                       
                                          (
                                          P
                                          )
                                       
                                       ≥
                                       
                                          2
                                          μ
                                       
                                       ,
                                    
                                  we hence get

                                    
                                       
                                          
                                             
                                                
                                                
                                                
                                                   
                                                      
                                                         u
                                                         
                                                            
                                                               a
                                                               1
                                                            
                                                            
                                                               (
                                                               Q
                                                               )
                                                            
                                                            ·
                                                            
                                                               u
                                                               
                                                                  a
                                                                  2
                                                               
                                                            
                                                            
                                                               (
                                                               Q
                                                               )
                                                            
                                                            −
                                                            
                                                               u
                                                               
                                                                  a
                                                                  1
                                                               
                                                            
                                                            
                                                               (
                                                               P
                                                               )
                                                            
                                                            ·
                                                            
                                                               u
                                                               
                                                                  a
                                                                  2
                                                               
                                                            
                                                            
                                                               (
                                                               P
                                                               )
                                                            
                                                         
                                                      
                                                      
                                                         >
                                                         [
                                                      
                                                      
                                                         (
                                                         
                                                            2
                                                            
                                                               λ
                                                               +
                                                               (
                                                               j
                                                               +
                                                               1
                                                               )
                                                            
                                                         
                                                         −
                                                         
                                                            2
                                                            λ
                                                         
                                                         )
                                                      
                                                      
                                                         2
                                                         μ
                                                      
                                                   
                                                
                                             
                                             
                                                
                                                
                                                
                                                   
                                                      
                                                      −
                                                      
                                                         2
                                                         
                                                            λ
                                                            +
                                                            (
                                                            j
                                                            +
                                                            1
                                                            )
                                                            +
                                                            μ
                                                         
                                                      
                                                      +
                                                      
                                                         2
                                                         
                                                            λ
                                                            +
                                                            μ
                                                         
                                                      
                                                      
                                                         ]
                                                         =
                                                         0
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                 As a consequence, ∏
                                    a ∈ A
                                 
                                 ua
                                 (P) < ∏
                                    a ∈ A
                                 
                                 ua
                                 (Q).□


                                 
                                    I
                                  is a “yes”-instance of Cubic Monotone 1-in-3 Sat if and only if 
                                    L
                                  is a “yes”-instance of NPSW-Lexicographic.


                                 “Only-if”-part: Let ϕ be a truth assignment that sets true exactly one variable in each clause. Abusing notation, we identify ϕ with the set of variables set true under ϕ. Recall that 
                                    
                                       
                                          |
                                          ϕ
                                          |
                                       
                                       =
                                       
                                          n
                                          3
                                       
                                    
                                 . We define the allocation P as follows.

                                    
                                       •
                                       
                                          
                                             
                                                P
                                                
                                                   (
                                                   
                                                      D
                                                      i
                                                   
                                                   )
                                                
                                                =
                                                
                                                   d
                                                   i
                                                
                                             
                                           for each 1 ≤ i ≤ ℓ. Thus, the total product of the utilities of these agents is 
                                             
                                                
                                                   ∏
                                                   
                                                      i
                                                      =
                                                      0
                                                   
                                                   
                                                      ℓ
                                                      −
                                                      1
                                                   
                                                
                                                
                                                   2
                                                   
                                                      M
                                                      −
                                                      i
                                                   
                                                
                                             
                                          .

For each xi
                                           ∈ ϕ, let 
                                             
                                                P
                                                
                                                   (
                                                   
                                                      X
                                                      i
                                                   
                                                   )
                                                
                                                =
                                                
                                                   x
                                                   i
                                                
                                                ,
                                             
                                          
                                          
                                             
                                                –
                                                for the q-th clause Cj
                                                    that contains xi, q ∈ {1, 2, 3}, assign x
                                                   
                                                      i, q
                                                    to the one among αj, βj, γj
                                                    that ranks x
                                                   
                                                      i, q
                                                    highest (i.e., directly below 
                                                      
                                                         
                                                            d
                                                            
                                                               2
                                                               n
                                                               +
                                                               4
                                                            
                                                         
                                                         ,
                                                      
                                                    in position 
                                                      
                                                         3
                                                         n
                                                         +
                                                         7
                                                      
                                                   ); for the two remaining agents among αj, βj, γj
                                                   , allocate b
                                                   
                                                      i, 1 to one and b
                                                   
                                                      i, 2 to the other agent.

allocate exactly one of 
                                                      
                                                         {
                                                         
                                                            h
                                                            1
                                                         
                                                         ,
                                                         …
                                                         ,
                                                         
                                                            h
                                                            
                                                               n
                                                               3
                                                            
                                                         
                                                         }
                                                      
                                                    to agent Hi
                                                   .

Hence, the total product of the utilities of these agents is

                                             
                                                
                                                   
                                                      
                                                         
                                                            (
                                                            
                                                               2
                                                               M
                                                            
                                                            )
                                                         
                                                         
                                                            n
                                                            3
                                                         
                                                      
                                                      ·
                                                      
                                                         
                                                            (
                                                            
                                                               2
                                                               
                                                                  M
                                                                  −
                                                                  (
                                                                  3
                                                                  n
                                                                  +
                                                                  6
                                                                  )
                                                               
                                                            
                                                            ·
                                                            
                                                               2
                                                               
                                                                  M
                                                                  −
                                                                  (
                                                                  n
                                                                  +
                                                                  4
                                                                  )
                                                               
                                                            
                                                            ·
                                                            
                                                               2
                                                               
                                                                  M
                                                                  −
                                                                  (
                                                                  n
                                                                  +
                                                                  5
                                                                  )
                                                               
                                                            
                                                            )
                                                         
                                                         
                                                            n
                                                            3
                                                         
                                                      
                                                      ·
                                                      
                                                         (
                                                         
                                                            2
                                                            M
                                                         
                                                         ·
                                                         
                                                            2
                                                            
                                                               M
                                                               −
                                                               1
                                                            
                                                         
                                                         ⋯
                                                         
                                                            2
                                                            
                                                               M
                                                               −
                                                               
                                                                  n
                                                                  3
                                                               
                                                               +
                                                               1
                                                            
                                                         
                                                         )
                                                      
                                                   
                                                
                                             
                                          
                                       

For each xi
                                          ∉ϕ, let 
                                             
                                                P
                                                
                                                   (
                                                   
                                                      H
                                                      i
                                                   
                                                   )
                                                
                                                =
                                                
                                                   x
                                                   i
                                                
                                             
                                           and 
                                             
                                                P
                                                
                                                   (
                                                   
                                                      X
                                                      i
                                                   
                                                   )
                                                
                                                =
                                                
                                                   {
                                                   
                                                      x
                                                      
                                                         i
                                                         ,
                                                         1
                                                      
                                                   
                                                   ,
                                                   
                                                      x
                                                      
                                                         i
                                                         ,
                                                         2
                                                      
                                                   
                                                   ,
                                                   
                                                      x
                                                      
                                                         i
                                                         ,
                                                         3
                                                      
                                                   
                                                   }
                                                
                                             
                                          . The total product of the utilities of these agents is

                                             
                                                
                                                   
                                                      
                                                         
                                                            (
                                                            
                                                               2
                                                               M
                                                            
                                                            )
                                                         
                                                         
                                                            
                                                               2
                                                               n
                                                            
                                                            3
                                                         
                                                      
                                                      ·
                                                      
                                                         
                                                            (
                                                            
                                                               2
                                                               
                                                                  M
                                                                  −
                                                                  (
                                                                  n
                                                                  +
                                                                  1
                                                                  )
                                                               
                                                            
                                                            +
                                                            
                                                               2
                                                               
                                                                  M
                                                                  −
                                                                  (
                                                                  n
                                                                  +
                                                                  2
                                                                  )
                                                               
                                                            
                                                            +
                                                            
                                                               2
                                                               
                                                                  M
                                                                  −
                                                                  (
                                                                  n
                                                                  +
                                                                  3
                                                                  )
                                                               
                                                            
                                                            )
                                                         
                                                         
                                                            
                                                               2
                                                               n
                                                            
                                                            3
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                       

Thus, 
                                    
                                       
                                          ∏
                                          
                                             a
                                             ∈
                                             A
                                          
                                       
                                       
                                          u
                                          a
                                       
                                       
                                          (
                                          P
                                          )
                                       
                                       =
                                       k
                                       ,
                                    
                                  implying that 
                                    L
                                  is a “yes”-instance.


                                 “If”-part: Let P be an allocation with ∏
                                    a ∈ A
                                 
                                 ua
                                 (P) ≥ k. This implies that the maximum Nash product social welfare achieved exceeds the threshold k. W.l.o.g. we assume that P is an allocation of maximum Nash product social welfare. We show that P must satisfy several properties:

                                    
                                       1.
                                       
                                          di is allocated to Di for each 1 ≤ i ≤ n: Assume there is an agent Di
                                           such that 
                                             
                                                P
                                                
                                                   (
                                                   
                                                      D
                                                      i
                                                   
                                                   )
                                                
                                                ∩
                                                
                                                   {
                                                   
                                                      d
                                                      1
                                                   
                                                   ,
                                                   …
                                                   ,
                                                   
                                                      d
                                                      ℓ
                                                   
                                                   }
                                                
                                                =
                                                ∅
                                             
                                          . Let r ∈ P(Di
                                          ) denote the item which Di
                                           ranks highest among the items in P(Di
                                          ). We distinguish the following cases.
                                             
                                                (a)
                                                There is a Dj
                                                    who gets allocated at least two elements of 
                                                      
                                                         {
                                                         
                                                            d
                                                            1
                                                         
                                                         ,
                                                         …
                                                         ,
                                                         
                                                            d
                                                            ℓ
                                                         
                                                         }
                                                      
                                                   . Let d
                                                   min  be the lowest ranked of these items in the ranking of Dj
                                                   . Consider the allocation P′ which results from P by handing d
                                                   min  to Di
                                                   . With Lemma 3.5, ∏
                                                      a ∈ A
                                                   
                                                   ua
                                                   (P) < ∏
                                                      a ∈ A
                                                   
                                                   ua
                                                   (P′) holds which contradicts with the choice of P.

There is an agent 
                                                      
                                                         a
                                                         ≠
                                                         
                                                            D
                                                            j
                                                         
                                                      
                                                    who gets allocated at least one of 
                                                      
                                                         {
                                                         
                                                            d
                                                            1
                                                         
                                                         ,
                                                         …
                                                         ,
                                                         
                                                            d
                                                            ℓ
                                                         
                                                         }
                                                      
                                                   . Take an arbitrary such d ∈ P(a). Consider the allocation P′′ which results from P by handing r to a and d to Di
                                                   . If a ranks r above d, trivially ua
                                                   (P′′) > ua
                                                   (P) and 
                                                      
                                                         
                                                            u
                                                            
                                                               D
                                                               i
                                                            
                                                         
                                                         
                                                            (
                                                            
                                                               P
                                                               
                                                                  ′
                                                                  ′
                                                               
                                                            
                                                            )
                                                         
                                                         >
                                                         
                                                            u
                                                            
                                                               D
                                                               i
                                                            
                                                         
                                                         
                                                            (
                                                            P
                                                            )
                                                         
                                                      
                                                    follow, since Di
                                                    by construction ranks d above r.

Assume a ranks r below d. We can observe that in the ranking of Di, r is among the last 
                                                      
                                                         (
                                                         6
                                                         n
                                                         +
                                                         
                                                            n
                                                            3
                                                         
                                                         )
                                                      
                                                    positions. For any other agent, r is ranked higher by construction. Thus, a ranks r higher than Di
                                                    does; also by construction, Di
                                                    ranks d at least as high as a does. Hence, the number μ of items between d and r in the ranking of Di
                                                    exceeds the number of items between d and r in the ranking of a by at least one item. In other words, Lemma 3.6 can be applied, again leading to a contradiction with the choice of P.

As a consequence, each agent Di
                                           gets at least (and thus exactly) one item of 
                                             
                                                {
                                                
                                                   d
                                                   1
                                                
                                                ,
                                                …
                                                
                                                   d
                                                   ℓ
                                                
                                                }
                                             
                                          . Since the rankings of the agents Di
                                          , 1 ≤ i ≤ ℓ, coincide, w.l.o.g. we assume that di
                                           is allocated to Di
                                          .


                                          hi is allocated to one of
                                          
                                             
                                                {
                                                
                                                   H
                                                   1
                                                
                                                ,
                                                …
                                                ,
                                                
                                                   H
                                                   n
                                                
                                                }
                                                ,
                                             
                                           
                                          for each
                                          
                                             
                                                1
                                                ≤
                                                i
                                                ≤
                                                
                                                   n
                                                   3
                                                
                                             
                                          
                                          . Assume hi
                                           is allocated to an agent 
                                             
                                                a
                                                ∉
                                                {
                                                
                                                   H
                                                   1
                                                
                                                ,
                                                …
                                                ,
                                                
                                                   H
                                                   n
                                                
                                                }
                                             
                                          . Then, take an arbitrary 
                                             
                                                
                                                   H
                                                   j
                                                
                                                ∈
                                                
                                                   {
                                                   
                                                      H
                                                      1
                                                   
                                                   ,
                                                   …
                                                   ,
                                                   
                                                      H
                                                      n
                                                   
                                                   }
                                                
                                             
                                           who is not allocated any item of 
                                             
                                                {
                                                
                                                   h
                                                   1
                                                
                                                ,
                                                …
                                                ,
                                                
                                                   h
                                                   
                                                      n
                                                      3
                                                   
                                                
                                                }
                                             
                                          . Obviously, such an agent Hj
                                           exists. It is easy to see that for the allocation 
                                             
                                                P
                                                ¯
                                             
                                           which results from P by handing hi
                                           to Hj
                                          , and, in turn, any item of P(Hj
                                          ) to a satisfies 
                                             
                                                
                                                   u
                                                   
                                                      H
                                                      j
                                                   
                                                
                                                
                                                   (
                                                   
                                                      P
                                                      ¯
                                                   
                                                   )
                                                
                                                >
                                                
                                                   u
                                                   
                                                      H
                                                      j
                                                   
                                                
                                                
                                                   (
                                                   P
                                                   )
                                                
                                             
                                           and 
                                             
                                                
                                                   u
                                                   a
                                                
                                                
                                                   (
                                                   
                                                      P
                                                      ¯
                                                   
                                                   )
                                                
                                                >
                                                
                                                   u
                                                   a
                                                
                                                
                                                   (
                                                   P
                                                   )
                                                
                                                ,
                                             
                                           i.e., 
                                             
                                                
                                                   ∏
                                                   
                                                      a
                                                      ∈
                                                      A
                                                   
                                                
                                                
                                                   u
                                                   a
                                                
                                                
                                                   (
                                                   P
                                                   )
                                                
                                                <
                                                
                                                   ∏
                                                   
                                                      a
                                                      ∈
                                                      A
                                                   
                                                
                                                
                                                   u
                                                   a
                                                
                                                
                                                   (
                                                   
                                                      P
                                                      ¯
                                                   
                                                   )
                                                
                                             
                                          .


                                          xi is allocated to one of {Hi, Xi
                                          }, for each 1 ≤ i ≤ n. Assume xi
                                           is assigned to an agent a∉{Hi, Xi
                                          }. Consider the allocation 
                                             
                                                P
                                                ˜
                                             
                                           which results from P by handing xi
                                           to Xi
                                          , and, in turn, the item r′ of P(Xi
                                          ) which Xi
                                           ranks highest to agent a. Recall that 
                                             
                                                
                                                   r
                                                   ′
                                                
                                                ∉
                                                
                                                   {
                                                   
                                                      d
                                                      1
                                                   
                                                   ,
                                                   …
                                                   ,
                                                   
                                                      d
                                                      ℓ
                                                   
                                                   ,
                                                   
                                                      h
                                                      1
                                                   
                                                   ,
                                                   …
                                                   
                                                      h
                                                      
                                                         n
                                                         3
                                                      
                                                   
                                                   }
                                                
                                             
                                          . If 
                                             
                                                
                                                   r
                                                   ′
                                                
                                                ∉
                                                
                                                   {
                                                   
                                                      x
                                                      
                                                         i
                                                         +
                                                         1
                                                      
                                                   
                                                   ,
                                                   …
                                                   ,
                                                   
                                                      x
                                                      n
                                                   
                                                   }
                                                
                                                ,
                                             
                                           then obviously 
                                             
                                                
                                                   u
                                                   
                                                      X
                                                      i
                                                   
                                                
                                                
                                                   (
                                                   
                                                      P
                                                      ˜
                                                   
                                                   )
                                                
                                                >
                                                
                                                   u
                                                   
                                                      X
                                                      i
                                                   
                                                
                                                
                                                   (
                                                   P
                                                   )
                                                
                                             
                                           and 
                                             
                                                
                                                   u
                                                   a
                                                
                                                
                                                   (
                                                   
                                                      P
                                                      ˜
                                                   
                                                   )
                                                
                                                >
                                                
                                                   u
                                                   a
                                                
                                                
                                                   (
                                                   P
                                                   )
                                                
                                             
                                           hold, i.e., 
                                             
                                                
                                                   ∏
                                                   
                                                      a
                                                      ∈
                                                      A
                                                   
                                                
                                                
                                                   u
                                                   a
                                                
                                                
                                                   (
                                                   P
                                                   )
                                                
                                                <
                                                
                                                   ∏
                                                   
                                                      a
                                                      ∈
                                                      A
                                                   
                                                
                                                
                                                   u
                                                   a
                                                
                                                
                                                   (
                                                   
                                                      P
                                                      ˜
                                                   
                                                   )
                                                
                                             
                                          . Let 
                                             
                                                
                                                   r
                                                   ′
                                                
                                                ∈
                                                
                                                   {
                                                   
                                                      x
                                                      
                                                         i
                                                         +
                                                         1
                                                      
                                                   
                                                   ,
                                                   …
                                                   ,
                                                   
                                                      x
                                                      n
                                                   
                                                   }
                                                
                                             
                                          . Then, Xi
                                           ranks xi
                                           more than 3n positions above r′. Note that any agent a∉{Hi, Xi
                                          } ranks r′ at most 
                                             
                                                (
                                                n
                                                −
                                                1
                                                )
                                             
                                           positions below xi
                                          . Thus, the conditions stated in Lemma 3.6 are satisfied, and again we get a contradiction with the choice of P.


                                          Hj is allocated exactly one of
                                          
                                             
                                                
                                                   {
                                                   
                                                      h
                                                      1
                                                   
                                                   ,
                                                   …
                                                   ,
                                                   
                                                      h
                                                      
                                                         n
                                                         3
                                                      
                                                   
                                                   }
                                                
                                                ∪
                                                
                                                   {
                                                   
                                                      x
                                                      j
                                                   
                                                   }
                                                
                                                ,
                                             
                                           
                                          for each 1 ≤ j ≤ n. Note that with Step 3 this means thatHj
                                           is allocated exactly one of 
                                             
                                                
                                                   {
                                                   
                                                      h
                                                      1
                                                   
                                                   ,
                                                   …
                                                   ,
                                                   
                                                      h
                                                      
                                                         n
                                                         3
                                                      
                                                   
                                                   }
                                                
                                                ∪
                                                
                                                   {
                                                   
                                                      x
                                                      1
                                                   
                                                   ,
                                                   …
                                                   ,
                                                   
                                                      x
                                                      n
                                                   
                                                   }
                                                
                                             
                                          
                                          .
This step is split in three parts:

                                             
                                                (a)
                                                
                                                   Hj is allocated at most one of
                                                   
                                                      
                                                         {
                                                         
                                                            h
                                                            1
                                                         
                                                         ,
                                                         …
                                                         ,
                                                         
                                                            h
                                                            
                                                               n
                                                               3
                                                            
                                                         
                                                         }
                                                         ,
                                                      
                                                    
                                                   for each 1 ≤ j ≤ n. Assume there is an agent Hj
                                                    who is allocated at least two items of 
                                                      
                                                         {
                                                         
                                                            h
                                                            1
                                                         
                                                         ,
                                                         …
                                                         ,
                                                         
                                                            h
                                                            
                                                               n
                                                               3
                                                            
                                                         
                                                         }
                                                      
                                                   . Let hg
                                                    be the lower-ranked of the two items in the ranking of Hj
                                                   . For the allocation 
                                                      
                                                         P
                                                         ^
                                                      
                                                    which results from P by handing hg
                                                    to an agent 
                                                      
                                                         H
                                                         
                                                            j
                                                            ′
                                                         
                                                      
                                                    who P does not allocate an item of 
                                                      
                                                         {
                                                         
                                                            h
                                                            1
                                                         
                                                         ,
                                                         …
                                                         ,
                                                         
                                                            h
                                                            
                                                               n
                                                               3
                                                            
                                                         
                                                         }
                                                      
                                                    to, we get with Lemma 3.5
that 
                                                      
                                                         
                                                            ∏
                                                            
                                                               a
                                                               ∈
                                                               A
                                                            
                                                         
                                                         
                                                            u
                                                            a
                                                         
                                                         
                                                            (
                                                            P
                                                            )
                                                         
                                                         <
                                                         
                                                            ∏
                                                            
                                                               a
                                                               ∈
                                                               A
                                                            
                                                         
                                                         
                                                            u
                                                            a
                                                         
                                                         
                                                            (
                                                            
                                                               P
                                                               ^
                                                            
                                                            )
                                                         
                                                      
                                                    holds.


                                                   If Hj is allocated one of
                                                   
                                                      
                                                         {
                                                         
                                                            h
                                                            1
                                                         
                                                         ,
                                                         …
                                                         ,
                                                         
                                                            h
                                                            
                                                               n
                                                               3
                                                            
                                                         
                                                         }
                                                      
                                                    
                                                   , then Hj is not allocated xj. Let 
                                                      
                                                         h
                                                         ∈
                                                         {
                                                         
                                                            h
                                                            1
                                                         
                                                         ,
                                                         …
                                                         ,
                                                         
                                                            h
                                                            
                                                               n
                                                               3
                                                            
                                                         
                                                         }
                                                      
                                                    be allocated to Hj
                                                   . Assume the opposite. Consider the allocation Q which results from P by handing xj
                                                    to Xj
                                                   . Again, with Lemma 3.5
                                                   
                                                      
                                                         
                                                            u
                                                            
                                                               H
                                                               j
                                                            
                                                         
                                                         
                                                            (
                                                            Q
                                                            )
                                                         
                                                         ·
                                                         
                                                            u
                                                            
                                                               X
                                                               i
                                                            
                                                         
                                                         
                                                            (
                                                            Q
                                                            )
                                                         
                                                         >
                                                         
                                                            u
                                                            
                                                               H
                                                               j
                                                            
                                                         
                                                         
                                                            (
                                                            P
                                                            )
                                                         
                                                         ·
                                                         
                                                            u
                                                            
                                                               X
                                                               i
                                                            
                                                         
                                                         
                                                            (
                                                            P
                                                            )
                                                         
                                                      
                                                    follows.


                                                   If Hj is allocated none of
                                                   
                                                      
                                                         {
                                                         
                                                            h
                                                            1
                                                         
                                                         ,
                                                         …
                                                         ,
                                                         
                                                            h
                                                            
                                                               n
                                                               3
                                                            
                                                         
                                                         }
                                                         ,
                                                      
                                                    
                                                   then Hj is allocated xj. Assume the opposite. Since by assumption ∏
                                                      a ∈ A
                                                   
                                                   ua
                                                   (P) > 0, P must allocate an item r to agent Hj
                                                   . Again, let r be the item highest-ranked by Hj
                                                    that Hj
                                                    receives under P.

From Steps 1–3, we can conclude that 
                                                      
                                                         r
                                                         ∈
                                                         
                                                            {
                                                            
                                                               b
                                                               
                                                                  1
                                                                  ,
                                                                  1
                                                                  ,
                                                               
                                                            
                                                            …
                                                            ,
                                                            
                                                               b
                                                               
                                                                  n
                                                                  ,
                                                                  2
                                                               
                                                            
                                                            }
                                                         
                                                         ∪
                                                         
                                                            {
                                                            
                                                               x
                                                               
                                                                  1
                                                                  ,
                                                                  1
                                                               
                                                            
                                                            ,
                                                            …
                                                            ,
                                                            
                                                               x
                                                               
                                                                  n
                                                                  ,
                                                                  3
                                                               
                                                            
                                                            }
                                                         
                                                      
                                                    holds. Consider the allocation Q′ which results from P by handing xj
                                                    to Hj
                                                   , and, in turn, item r to Xj
                                                   . By construction, Xi
                                                    ranks r more than 
                                                      
                                                         n
                                                         3
                                                      
                                                    positions higher than Hj
                                                    does. On the other hand, Hj
                                                    ranks xj
                                                    exactly 
                                                      
                                                         n
                                                         3
                                                      
                                                    positions lower than Xi
                                                    does. Therefore, the number μ of items between xj
                                                    and r in the ranking of Hj
                                                    exceeds the number of items between xj
                                                    and r in the ranking of Xi
                                                    by at least one item. As a consequence, Lemma 3.6
yields a contradiction with the choice of P.


                                          Two of {αi, βi, γi
                                          } are allocated exactly one of {b
                                          
                                             i, 1, b
                                          
                                             i, 2}, for each 1 ≤ i ≤ n.This step is proven in two parts.

                                             
                                                (a)
                                                
                                                   b
                                                   
                                                      i, 1 
                                                   (resp. b
                                                   
                                                      i, 2
                                                   ) is allocated to αi, βi or γi , for each 1 ≤ i ≤ n. Assume b
                                                   
                                                      i, 1 is not allocated to one of these agents. Clearly, at most one of αi, βi, γi
                                                    is allocated b
                                                   
                                                      i, 2. W.l.o.g. assume b
                                                   
                                                      i, 2 is not allocated to αi
                                                   . By Step (1), this implies that αi
                                                    ranks b
                                                   
                                                      i, 1 more than 2n positions higher than the highest-ranked among the items in P(αi
                                                   ). Take an arbitrary p ∈ P(αi
                                                   ). Note that with Steps 1–3, 
                                                      
                                                         p
                                                         ∉
                                                         
                                                            {
                                                            
                                                               d
                                                               1
                                                            
                                                            ,
                                                            …
                                                            ,
                                                            
                                                               d
                                                               ℓ
                                                            
                                                            ,
                                                            
                                                               x
                                                               1
                                                            
                                                            ,
                                                            …
                                                            ,
                                                            
                                                               x
                                                               n
                                                            
                                                            ,
                                                            
                                                               h
                                                               1
                                                            
                                                            ,
                                                            …
                                                            ,
                                                            
                                                               h
                                                               
                                                                  n
                                                                  3
                                                               
                                                            
                                                            }
                                                         
                                                         ∪
                                                         
                                                            {
                                                            
                                                               b
                                                               
                                                                  i
                                                                  ,
                                                                  2
                                                               
                                                            
                                                            }
                                                         
                                                      
                                                    follows. Consider the allocation Q which results from P by handing p to the agent a with b
                                                   
                                                      i, 1 ∈ P(a) and, in turn, b
                                                   
                                                      i, 1 to agent αi
                                                   . By construction (in particular, by the items 
                                                      
                                                         
                                                            d
                                                            
                                                               n
                                                               +
                                                               5
                                                            
                                                         
                                                         ,
                                                         …
                                                         ,
                                                         
                                                            d
                                                            
                                                               2
                                                               n
                                                               +
                                                               4
                                                            
                                                         
                                                      
                                                    in the ranking of αi
                                                   ), it follows that the conditions of Lemma 3.6 are satisfied. Thus ∏
                                                      a ∈ A
                                                   
                                                   ua
                                                   (P) < ∏
                                                      a ∈ A
                                                   
                                                   ua
                                                   (Q) holds, in contradiction with the choice of P.


                                                   b
                                                   
                                                      i, 1 
                                                   and b
                                                   
                                                      i, 2 
                                                   are not allocated to the same agent, for each 1 ≤ i ≤ n. Assume the opposite. Then, analogously to above, by the use of Lemma 3.6 we can find an allocation with a higher Nash product social welfare than P.


                                          For each 1 ≤ i ≤ n and a ∈ {αi, βi, γi
                                          }, the following holds: If b
                                          
                                             i, 1 
                                          or b
                                          
                                             i, 2 
                                          is allocated to a, then a is allocated no further item.It remains to show that no item of Y is allocated to a. We provide a proof for agent αi
                                           and b
                                          
                                             i, 2 ∈ P(αi
                                          ) (the other cases follow analogously). Assume at least one of Y is allocated to αi
                                          . Let x
                                          
                                             g, j
                                           be allocated to αi
                                          . Consider the allocation Q′ which results from P by handing x
                                          
                                             g, j
                                           to agent Xg
                                          . Let 
                                             
                                                
                                                   u
                                                   
                                                      α
                                                      
                                                         
                                                         i
                                                      
                                                   
                                                
                                                
                                                   (
                                                   
                                                      x
                                                      
                                                         g
                                                         ,
                                                         j
                                                      
                                                   
                                                   )
                                                
                                                =
                                                
                                                   2
                                                   
                                                      ɛ
                                                   
                                                
                                             
                                           for some 
                                             
                                                
                                                   ɛ
                                                
                                                ∈
                                                N
                                             
                                          . Note that 
                                             
                                                
                                                   u
                                                   
                                                      X
                                                      g
                                                   
                                                
                                                
                                                   (
                                                   
                                                      x
                                                      
                                                         g
                                                         ,
                                                         j
                                                      
                                                   
                                                   )
                                                
                                                ≥
                                                
                                                   2
                                                   
                                                      
                                                         ɛ
                                                      
                                                      +
                                                      2
                                                      n
                                                   
                                                
                                             
                                           and

                                             
                                                (7)
                                                
                                                   
                                                      
                                                         u
                                                         
                                                            α
                                                            i
                                                         
                                                      
                                                      
                                                         (
                                                         P
                                                         )
                                                      
                                                      ≥
                                                      
                                                         2
                                                         
                                                            M
                                                            −
                                                            (
                                                            n
                                                            +
                                                            4
                                                            )
                                                         
                                                      
                                                      +
                                                      
                                                         2
                                                         
                                                            ɛ
                                                         
                                                      
                                                   
                                                
                                             
                                          hold. We get

                                             
                                                
                                                   
                                                      
                                                         
                                                         
                                                         
                                                            
                                                               
                                                                  u
                                                                  
                                                                     X
                                                                     g
                                                                  
                                                               
                                                               
                                                                  (
                                                                  
                                                                     Q
                                                                     ′
                                                                  
                                                                  )
                                                               
                                                               ·
                                                               
                                                                  u
                                                                  
                                                                     α
                                                                     i
                                                                  
                                                               
                                                               
                                                                  (
                                                                  
                                                                     Q
                                                                     ′
                                                                  
                                                                  )
                                                               
                                                               −
                                                               
                                                                  u
                                                                  
                                                                     X
                                                                     g
                                                                  
                                                               
                                                               
                                                                  (
                                                                  P
                                                                  )
                                                               
                                                               ·
                                                               
                                                                  u
                                                                  
                                                                     α
                                                                     i
                                                                  
                                                               
                                                               
                                                                  (
                                                                  P
                                                                  )
                                                               
                                                            
                                                         
                                                      
                                                      
                                                         
                                                         
                                                         
                                                            
                                                               
                                                               ≥
                                                               
                                                                  (
                                                                  
                                                                     u
                                                                     
                                                                        X
                                                                        g
                                                                     
                                                                  
                                                                  
                                                                     (
                                                                     P
                                                                     )
                                                                  
                                                                  +
                                                                  
                                                                     2
                                                                     
                                                                        
                                                                           ɛ
                                                                        
                                                                        +
                                                                        2
                                                                        n
                                                                     
                                                                  
                                                                  )
                                                               
                                                               ·
                                                               
                                                                  (
                                                                  
                                                                     u
                                                                     
                                                                        α
                                                                        i
                                                                     
                                                                  
                                                                  
                                                                     (
                                                                     P
                                                                     )
                                                                  
                                                                  −
                                                                  
                                                                     2
                                                                     
                                                                        ɛ
                                                                     
                                                                  
                                                                  )
                                                               
                                                               −
                                                               
                                                                  u
                                                                  
                                                                     X
                                                                     g
                                                                  
                                                               
                                                               
                                                                  (
                                                                  P
                                                                  )
                                                               
                                                               ·
                                                               
                                                                  u
                                                                  
                                                                     α
                                                                     i
                                                                  
                                                               
                                                               
                                                                  (
                                                                  P
                                                                  )
                                                               
                                                            
                                                         
                                                      
                                                      
                                                         
                                                         
                                                         
                                                            
                                                               
                                                               ≥
                                                               
                                                                  [
                                                                  
                                                                     u
                                                                     
                                                                        X
                                                                        g
                                                                     
                                                                  
                                                                  
                                                                     (
                                                                     P
                                                                     )
                                                                  
                                                                  ·
                                                                  
                                                                     u
                                                                     
                                                                        α
                                                                        i
                                                                     
                                                                  
                                                                  
                                                                     (
                                                                     P
                                                                     )
                                                                  
                                                                  −
                                                                  
                                                                     2
                                                                     
                                                                        ɛ
                                                                     
                                                                  
                                                                  
                                                                     u
                                                                     
                                                                        X
                                                                        g
                                                                     
                                                                  
                                                                  
                                                                     (
                                                                     P
                                                                     )
                                                                  
                                                                  +
                                                                  
                                                                     2
                                                                     
                                                                        
                                                                           ɛ
                                                                        
                                                                        +
                                                                        2
                                                                        n
                                                                     
                                                                  
                                                                  
                                                                     2
                                                                     
                                                                        M
                                                                        −
                                                                        (
                                                                        n
                                                                        +
                                                                        4
                                                                        )
                                                                     
                                                                  
                                                                  ]
                                                               
                                                               −
                                                               
                                                                  u
                                                                  
                                                                     X
                                                                     g
                                                                  
                                                               
                                                               
                                                                  (
                                                                  P
                                                                  )
                                                               
                                                               ·
                                                               
                                                                  u
                                                                  
                                                                     α
                                                                     i
                                                                  
                                                               
                                                               
                                                                  (
                                                                  P
                                                                  )
                                                               
                                                            
                                                         
                                                      
                                                      
                                                         
                                                         
                                                         
                                                            
                                                               
                                                               >
                                                               −
                                                               
                                                                  2
                                                                  
                                                                     
                                                                        ɛ
                                                                     
                                                                     +
                                                                     M
                                                                     +
                                                                     1
                                                                  
                                                               
                                                               +
                                                               
                                                                  2
                                                                  
                                                                     
                                                                        ɛ
                                                                     
                                                                     +
                                                                     M
                                                                     +
                                                                     n
                                                                     −
                                                                     4
                                                                  
                                                               
                                                            
                                                         
                                                      
                                                      
                                                         
                                                         
                                                         
                                                            
                                                               
                                                               >
                                                               0
                                                            
                                                         
                                                      
                                                   
                                                
                                             
                                          where the third line follows from (7), the fourth from 
                                             
                                                
                                                   u
                                                   
                                                      X
                                                      g
                                                   
                                                
                                                
                                                   (
                                                   P
                                                   )
                                                
                                                <
                                                
                                                   2
                                                   
                                                      M
                                                      +
                                                      1
                                                   
                                                
                                                ,
                                             
                                           and the last from n > 5.


                                          For each 1 ≤ i ≤ n and a ∈ {αi, βi, γi
                                          }, the following holds: If a is allocated an item of
                                          
                                             
                                                {
                                                
                                                   x
                                                   
                                                      
                                                         i
                                                         1
                                                      
                                                      ,
                                                      
                                                         k
                                                         1
                                                      
                                                   
                                                
                                                ,
                                                
                                                   x
                                                   
                                                      
                                                         i
                                                         2
                                                      
                                                      ,
                                                      
                                                         k
                                                         2
                                                      
                                                   
                                                
                                                ,
                                                
                                                   x
                                                   
                                                      
                                                         i
                                                         3
                                                      
                                                      ,
                                                      
                                                         k
                                                         3
                                                      
                                                   
                                                
                                                }
                                                ,
                                             
                                           
                                          then a is allocated exactly one item.This follows analogously to Step 6.


                                          None of the items in
                                          Y is allocated to an agent
                                          
                                             
                                                a
                                                ∈
                                                {
                                                
                                                   D
                                                   1
                                                
                                                ,
                                                …
                                                ,
                                                
                                                   D
                                                   ℓ
                                                
                                                ,
                                                
                                                   H
                                                   1
                                                
                                                ,
                                                …
                                                ,
                                                
                                                   H
                                                   n
                                                
                                                }
                                             
                                          . Assume the opposite. Take an arbitrary item x
                                          
                                             g, j
                                           ∈ P(a)∩Y. Note that 
                                             
                                                
                                                   u
                                                   a
                                                
                                                
                                                   (
                                                   
                                                      x
                                                      
                                                         g
                                                         ,
                                                         j
                                                      
                                                   
                                                   )
                                                
                                                =
                                                
                                                   2
                                                   
                                                      ɛ
                                                   
                                                
                                             
                                           and 
                                             
                                                
                                                   u
                                                   
                                                      X
                                                      g
                                                   
                                                
                                                
                                                   (
                                                   
                                                      x
                                                      
                                                         g
                                                         ,
                                                         j
                                                      
                                                   
                                                   )
                                                
                                                ≥
                                                
                                                   2
                                                   
                                                      
                                                         ɛ
                                                      
                                                      +
                                                      3
                                                      n
                                                   
                                                
                                             
                                           for some 
                                             
                                                
                                                   ɛ
                                                
                                                <
                                                M
                                                −
                                                ℓ
                                             
                                          . Thus,

                                             
                                                (8)
                                                
                                                   
                                                      
                                                         u
                                                         a
                                                      
                                                      
                                                         (
                                                         P
                                                         )
                                                      
                                                      ≥
                                                      
                                                         2
                                                         
                                                            ɛ
                                                         
                                                      
                                                      +
                                                      
                                                         2
                                                         
                                                            M
                                                            −
                                                            
                                                               n
                                                               3
                                                            
                                                         
                                                      
                                                   
                                                
                                             
                                          Consider the allocation Q′′ which results from P by handing x
                                          
                                             g, j
                                           to agent Xg
                                          . With (8),

                                             
                                                
                                                   
                                                      
                                                         
                                                         
                                                         
                                                            
                                                               
                                                                  u
                                                                  
                                                                     X
                                                                     g
                                                                  
                                                               
                                                               
                                                                  (
                                                                  
                                                                     Q
                                                                     
                                                                        ′
                                                                        ′
                                                                     
                                                                  
                                                                  )
                                                               
                                                               ·
                                                               
                                                                  u
                                                                  a
                                                               
                                                               
                                                                  (
                                                                  
                                                                     Q
                                                                     
                                                                        ′
                                                                        ′
                                                                     
                                                                  
                                                                  )
                                                               
                                                               −
                                                               
                                                                  u
                                                                  
                                                                     X
                                                                     g
                                                                  
                                                               
                                                               
                                                                  (
                                                                  P
                                                                  )
                                                               
                                                               ·
                                                               
                                                                  u
                                                                  a
                                                               
                                                               
                                                                  (
                                                                  P
                                                                  )
                                                               
                                                            
                                                         
                                                      
                                                      
                                                         
                                                         
                                                         
                                                            
                                                               
                                                               ≥
                                                               
                                                                  (
                                                                  
                                                                     u
                                                                     
                                                                        X
                                                                        g
                                                                     
                                                                  
                                                                  
                                                                     (
                                                                     P
                                                                     )
                                                                  
                                                                  +
                                                                  
                                                                     2
                                                                     
                                                                        
                                                                           ɛ
                                                                        
                                                                        +
                                                                        3
                                                                        n
                                                                     
                                                                  
                                                                  )
                                                               
                                                               ·
                                                               
                                                                  (
                                                                  
                                                                     u
                                                                     a
                                                                  
                                                                  
                                                                     (
                                                                     P
                                                                     )
                                                                  
                                                                  −
                                                                  
                                                                     2
                                                                     
                                                                        ɛ
                                                                     
                                                                  
                                                                  )
                                                               
                                                               −
                                                               
                                                                  u
                                                                  
                                                                     X
                                                                     g
                                                                  
                                                               
                                                               
                                                                  (
                                                                  P
                                                                  )
                                                               
                                                               ·
                                                               
                                                                  u
                                                                  a
                                                               
                                                               
                                                                  (
                                                                  P
                                                                  )
                                                               
                                                            
                                                         
                                                      
                                                      
                                                         
                                                         
                                                         
                                                            
                                                               
                                                               >
                                                               
                                                               
                                                                  u
                                                                  
                                                                     X
                                                                     g
                                                                  
                                                               
                                                               
                                                                  (
                                                                  P
                                                                  )
                                                               
                                                               ·
                                                               
                                                                  u
                                                                  a
                                                               
                                                               
                                                                  (
                                                                  P
                                                                  )
                                                               
                                                               −
                                                               
                                                                  2
                                                                  
                                                                     ɛ
                                                                  
                                                               
                                                               
                                                                  u
                                                                  
                                                                     X
                                                                     g
                                                                  
                                                               
                                                               
                                                                  (
                                                                  P
                                                                  )
                                                               
                                                               +
                                                               
                                                                  2
                                                                  
                                                                     
                                                                        ɛ
                                                                     
                                                                     +
                                                                     3
                                                                     n
                                                                  
                                                               
                                                               
                                                                  2
                                                                  
                                                                     M
                                                                     −
                                                                     
                                                                        n
                                                                        3
                                                                     
                                                                  
                                                               
                                                               −
                                                               
                                                                  u
                                                                  
                                                                     X
                                                                     g
                                                                  
                                                               
                                                               
                                                                  (
                                                                  P
                                                                  )
                                                               
                                                               ·
                                                               
                                                                  u
                                                                  a
                                                               
                                                               
                                                                  (
                                                                  P
                                                                  )
                                                               
                                                            
                                                         
                                                      
                                                      
                                                         
                                                         
                                                         
                                                            
                                                               
                                                               >
                                                               −
                                                               
                                                                  2
                                                                  
                                                                     
                                                                        ɛ
                                                                     
                                                                     +
                                                                     M
                                                                     +
                                                                     1
                                                                  
                                                               
                                                               +
                                                               
                                                                  2
                                                                  
                                                                     
                                                                        ɛ
                                                                     
                                                                     +
                                                                     M
                                                                     +
                                                                     2
                                                                     n
                                                                  
                                                               
                                                            
                                                         
                                                      
                                                      
                                                         
                                                         
                                                         
                                                            
                                                               
                                                               >
                                                               
                                                               0
                                                            
                                                         
                                                      
                                                   
                                                
                                             
                                          and thus a contradiction with the choice of P is implied.


                                       If at most 2n items of Y are contained in
                                       
                                          
                                             
                                                ⋃
                                                
                                                   a
                                                   ∈
                                                   {
                                                   
                                                      X
                                                      1
                                                   
                                                   ,
                                                   …
                                                   ,
                                                   
                                                      X
                                                      n
                                                   
                                                   }
                                                
                                             
                                             P
                                             
                                                (
                                                a
                                                )
                                             
                                             ,
                                          
                                        
                                       then
                                       
                                          
                                             (10)
                                             
                                                
                                                   
                                                      ∏
                                                      
                                                         a
                                                         ∈
                                                         {
                                                         
                                                            X
                                                            1
                                                         
                                                         ,
                                                         …
                                                         ,
                                                         
                                                            X
                                                            n
                                                         
                                                         }
                                                      
                                                   
                                                   
                                                      u
                                                      a
                                                   
                                                   
                                                      (
                                                      P
                                                      )
                                                   
                                                   ≤
                                                   
                                                      
                                                         (
                                                         
                                                            2
                                                            M
                                                         
                                                         )
                                                      
                                                      
                                                         n
                                                         3
                                                      
                                                   
                                                   ·
                                                   
                                                      
                                                         (
                                                         
                                                            2
                                                            
                                                               M
                                                               −
                                                               (
                                                               n
                                                               +
                                                               1
                                                               )
                                                            
                                                         
                                                         +
                                                         
                                                            2
                                                            
                                                               M
                                                               −
                                                               (
                                                               n
                                                               +
                                                               2
                                                               )
                                                            
                                                         
                                                         +
                                                         
                                                            2
                                                            
                                                               M
                                                               −
                                                               (
                                                               n
                                                               +
                                                               3
                                                               )
                                                            
                                                         
                                                         )
                                                      
                                                      
                                                         
                                                            2
                                                            n
                                                         
                                                         3
                                                      
                                                   
                                                
                                             
                                          
                                       
                                       holds; equality in (
                                       
                                          10
                                       
                                       ) is achieved if and only if for all 1 ≤ i ≤ n, all the items
                                       
                                          
                                             {
                                             
                                                x
                                                
                                                   i
                                                   ,
                                                   1
                                                
                                             
                                             ,
                                             
                                                x
                                                
                                                   i
                                                   ,
                                                   2
                                                
                                             
                                             ,
                                             
                                                x
                                                
                                                   i
                                                   3
                                                
                                             
                                             }
                                          
                                        
                                       are allocated to the agent Xi satisfying xi
                                       ∉P(Xi
                                       ).
                                    

Now, assume for some i, there is an a ∈ {αi, βi, γi
                                 } which is allocated none of 
                                    
                                       
                                          {
                                          
                                             b
                                             
                                                i
                                                ,
                                                1
                                             
                                          
                                          ,
                                          
                                             b
                                             
                                                i
                                                ,
                                                2
                                             
                                          
                                          }
                                       
                                       ∪
                                       
                                          {
                                          
                                             x
                                             
                                                
                                                   i
                                                   1
                                                
                                                ,
                                                
                                                   k
                                                   1
                                                
                                             
                                          
                                          ,
                                          
                                             x
                                             
                                                
                                                   i
                                                   2
                                                
                                                ,
                                                
                                                   k
                                                   2
                                                
                                             
                                          
                                          ,
                                          
                                             x
                                             
                                                
                                                   i
                                                   3
                                                
                                                ,
                                                
                                                   k
                                                   3
                                                
                                             
                                          
                                          }
                                       
                                    
                                 . With Step 1, 
                                    
                                       
                                          u
                                          a
                                       
                                       
                                          (
                                          P
                                          )
                                       
                                       <
                                       
                                          2
                                          
                                             M
                                             −
                                             7
                                             n
                                          
                                       
                                    
                                  follows. With Steps 6 and 7, we get

                                    
                                       (11)
                                       
                                          
                                             
                                                
                                                
                                                
                                                   
                                                      
                                                         ∏
                                                         
                                                            a
                                                            ∈
                                                            {
                                                            
                                                               α
                                                               i
                                                            
                                                            ,
                                                            
                                                               β
                                                               i
                                                            
                                                            ,
                                                            
                                                               γ
                                                               i
                                                            
                                                            |
                                                            1
                                                            ≤
                                                            i
                                                            ≤
                                                            n
                                                            }
                                                         
                                                      
                                                      
                                                         u
                                                         a
                                                      
                                                      
                                                         (
                                                         P
                                                         )
                                                      
                                                      <
                                                      
                                                         (
                                                         
                                                            2
                                                            
                                                               M
                                                               −
                                                               7
                                                               n
                                                            
                                                         
                                                         ·
                                                         
                                                            2
                                                            
                                                               M
                                                               −
                                                               (
                                                               n
                                                               +
                                                               4
                                                               )
                                                            
                                                         
                                                         ·
                                                         
                                                            2
                                                            
                                                               M
                                                               −
                                                               (
                                                               n
                                                               +
                                                               5
                                                               )
                                                            
                                                         
                                                         )
                                                      
                                                   
                                                
                                             
                                             
                                                
                                                
                                                
                                                   
                                                      ·
                                                      
                                                         
                                                            (
                                                            
                                                               2
                                                               
                                                                  M
                                                                  −
                                                                  (
                                                                  3
                                                                  n
                                                                  +
                                                                  6
                                                                  )
                                                               
                                                            
                                                            ·
                                                            
                                                               2
                                                               
                                                                  M
                                                                  −
                                                                  (
                                                                  n
                                                                  +
                                                                  4
                                                                  )
                                                               
                                                            
                                                            ·
                                                            
                                                               2
                                                               
                                                                  M
                                                                  −
                                                                  (
                                                                  n
                                                                  +
                                                                  5
                                                                  )
                                                               
                                                            
                                                            )
                                                         
                                                         
                                                            n
                                                            −
                                                            1
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                 Combining (9), (10), (11), ∏
                                    a ∈ A
                                  < k follows.

Thus, for each i and a ∈ {αi, βi, γi
                                 }, a is allocated at least – by Steps 6 and 7, that means exactly – one of 
                                    
                                       
                                          {
                                          
                                             b
                                             
                                                i
                                                ,
                                                1
                                             
                                          
                                          ,
                                          
                                             b
                                             
                                                i
                                                ,
                                                2
                                             
                                          
                                          }
                                       
                                       ∪
                                       
                                          {
                                          
                                             x
                                             
                                                
                                                   i
                                                   1
                                                
                                                ,
                                                
                                                   k
                                                   1
                                                
                                             
                                          
                                          ,
                                          
                                             x
                                             
                                                
                                                   i
                                                   2
                                                
                                                ,
                                                
                                                   k
                                                   2
                                                
                                             
                                          
                                          ,
                                          
                                             x
                                             
                                                
                                                   i
                                                   3
                                                
                                                ,
                                                
                                                   k
                                                   3
                                                
                                             
                                          
                                          }
                                       
                                    
                                 . With Step 5, we can conclude that exactly one agent of {αi, βi, γi
                                 } is allocated exactly one of 
                                    
                                       {
                                       
                                          x
                                          
                                             
                                                i
                                                1
                                             
                                             ,
                                             
                                                k
                                                1
                                             
                                          
                                       
                                       ,
                                       
                                          x
                                          
                                             
                                                i
                                                2
                                             
                                             ,
                                             
                                                k
                                                2
                                             
                                          
                                       
                                       ,
                                       
                                          x
                                          
                                             
                                                i
                                                3
                                             
                                             ,
                                             
                                                k
                                                3
                                             
                                          
                                       
                                       }
                                       ,
                                    
                                  obviously yielding an utility of 
                                    
                                       2
                                       
                                          M
                                          −
                                          (
                                          3
                                          n
                                          +
                                          6
                                          )
                                       
                                    
                                 . Hence, we get

                                    
                                       (12)
                                       
                                          
                                             
                                                ∏
                                                
                                                   a
                                                   ∈
                                                   {
                                                   
                                                      α
                                                      i
                                                   
                                                   ,
                                                   
                                                      β
                                                      i
                                                   
                                                   ,
                                                   
                                                      γ
                                                      i
                                                   
                                                   |
                                                   1
                                                   ≤
                                                   i
                                                   ≤
                                                   n
                                                   }
                                                
                                             
                                             
                                                u
                                                a
                                             
                                             
                                                (
                                                P
                                                )
                                             
                                             =
                                             
                                                
                                                   (
                                                   
                                                      2
                                                      
                                                         M
                                                         −
                                                         (
                                                         3
                                                         n
                                                         +
                                                         6
                                                         )
                                                      
                                                   
                                                   ·
                                                   
                                                      2
                                                      
                                                         M
                                                         −
                                                         (
                                                         n
                                                         +
                                                         4
                                                         )
                                                      
                                                   
                                                   ·
                                                   
                                                      2
                                                      
                                                         M
                                                         −
                                                         (
                                                         n
                                                         +
                                                         5
                                                         )
                                                      
                                                   
                                                   )
                                                
                                                n
                                             
                                          
                                       
                                    
                                 With (9) and (12), the above observation implies that

                                    
                                       •
                                       For each clause Ci
                                          , exactly one of 
                                             
                                                {
                                                
                                                   x
                                                   
                                                      
                                                         i
                                                         1
                                                      
                                                      ,
                                                      
                                                         k
                                                         1
                                                      
                                                   
                                                
                                                ,
                                                
                                                   x
                                                   
                                                      
                                                         i
                                                         2
                                                      
                                                      ,
                                                      
                                                         k
                                                         2
                                                      
                                                   
                                                
                                                ,
                                                
                                                   x
                                                   
                                                      
                                                         i
                                                         3
                                                      
                                                      ,
                                                      
                                                         k
                                                         3
                                                      
                                                   
                                                
                                                }
                                             
                                           is allocated to one of {αi, βi, γi
                                          } (i.e., one of the variables 
                                             
                                                
                                                   x
                                                   
                                                      i
                                                      1
                                                   
                                                
                                                ,
                                                
                                                   x
                                                   
                                                      i
                                                      2
                                                   
                                                
                                                ,
                                                
                                                   x
                                                   
                                                      i
                                                      3
                                                   
                                                
                                             
                                           is set “true”), and

Either all or none of {x
                                          
                                             i, 1, x
                                          
                                             i, 2, x
                                          
                                             i, 3} are allocated to some agents of the set 
                                             
                                                C
                                                =
                                                {
                                                
                                                   α
                                                   j
                                                
                                                ,
                                                
                                                   β
                                                   j
                                                
                                                ,
                                                
                                                   γ
                                                   j
                                                
                                                |
                                                1
                                                ≤
                                                i
                                                ,
                                                j
                                                ≤
                                                n
                                                }
                                                ,
                                             
                                           i.e., either 
                                             
                                                
                                                   {
                                                   
                                                      x
                                                      
                                                         i
                                                         ,
                                                         1
                                                      
                                                   
                                                   ,
                                                   
                                                      x
                                                      
                                                         i
                                                         ,
                                                         2
                                                      
                                                   
                                                   ,
                                                   
                                                      x
                                                      
                                                         i
                                                         ,
                                                         3
                                                      
                                                   
                                                   }
                                                
                                                ⊂
                                                
                                                   (
                                                   
                                                      ⋃
                                                      
                                                         a
                                                         ∈
                                                         C
                                                      
                                                   
                                                   P
                                                   
                                                      (
                                                      a
                                                      )
                                                   
                                                   )
                                                
                                             
                                           or 
                                             
                                                
                                                   {
                                                   
                                                      x
                                                      
                                                         i
                                                         ,
                                                         1
                                                      
                                                   
                                                   ,
                                                   
                                                      x
                                                      
                                                         i
                                                         ,
                                                         2
                                                      
                                                   
                                                   ,
                                                   
                                                      x
                                                      
                                                         i
                                                         ,
                                                         3
                                                      
                                                   
                                                   }
                                                
                                                ∩
                                                
                                                   (
                                                   
                                                      ⋃
                                                      
                                                         a
                                                         ∈
                                                         C
                                                      
                                                   
                                                   P
                                                   
                                                      (
                                                      a
                                                      )
                                                   
                                                   )
                                                
                                                =
                                                ∅
                                             
                                           holds.

Therewith, the truth assignment ϕ which sets xi
                                  “true” if and only if xi
                                  ∈ P(Xi
                                 ) (i.e., x
                                 
                                    i, 1, x
                                 
                                    i, 2, x
                                 
                                    i, 3 are allocated to some agent {αj, βj, γj
                                 }, 1 ≤ j ≤ n), is a feasible truth assignment that sets “true” exactly one variable of each clause. Hence, 
                                    I
                                  is a “yes”-instance of Cubic Monotone 1-in-3 Sat.
                                 □

Next, we show that maximizing Nash Product Social Welfare remains 
                              NP
                           -complete in the case of Borda scores.
                              2
                           
                           
                              2
                              Note that in classical voting theory, the Borda scores range from 0 to 
                                    
                                       m
                                       −
                                       1
                                    
                                  (see, e.g., Brams & Fishburn, 2002, Chap. 4). We point out that our 
                                    NP
                                 -completeness result also holds for this classical version of Borda scores.
                           
                           
                              Theorem 3.7
                              
                                 NPSW-Borda is
                                 
                                    NP
                                 
                                 -complete.
                              

The proof proceeds again by a reduction from Cubic Monotone 1-in-3 Sat. Given an instance 
                                    
                                       I
                                       =
                                       (
                                       
                                          X
                                          ˜
                                       
                                       ,
                                       
                                          C
                                          ˜
                                       
                                       )
                                    
                                  of Cubic Monotone 1-in-3 Sat we construct an instance 
                                    
                                       B
                                       =
                                       (
                                       R
                                       ,
                                       A
                                       ,
                                       π
                                       ,
                                       k
                                       )
                                    
                                  of NPSW-Borda as follows. Let 
                                    
                                       
                                          n
                                          =
                                          |
                                       
                                       
                                          X
                                          ˜
                                       
                                       
                                          |
                                          =
                                          |
                                       
                                       
                                          C
                                          ˜
                                       
                                       
                                          |
                                          ,
                                       
                                    
                                  and 
                                    
                                       ℓ
                                       =
                                       10
                                       
                                          n
                                          10
                                       
                                    
                                 .


                                 R consists of 
                                    
                                       ℓ
                                       +
                                       5
                                       n
                                       +
                                       
                                          n
                                          3
                                       
                                    
                                  items:

                                    
                                       •
                                       The item set 
                                             
                                                D
                                                =
                                                {
                                                
                                                   d
                                                   1
                                                
                                                ,
                                                
                                                   d
                                                   2
                                                
                                                ,
                                                …
                                                ,
                                                
                                                   d
                                                   ℓ
                                                
                                                }
                                             
                                          
                                       

The item set 
                                             
                                                H
                                                =
                                                {
                                                
                                                   h
                                                   1
                                                
                                                ,
                                                
                                                   h
                                                   2
                                                
                                                ,
                                                …
                                                ,
                                                
                                                   h
                                                   
                                                      n
                                                      3
                                                   
                                                
                                                }
                                             
                                          
                                       

The item set 
                                             
                                                E
                                                =
                                                {
                                                
                                                   e
                                                   1
                                                
                                                ,
                                                
                                                   e
                                                   2
                                                
                                                ,
                                                …
                                                ,
                                                
                                                   e
                                                   n
                                                
                                                }
                                             
                                          
                                       

The item sets 
                                             
                                                X
                                                =
                                                {
                                                
                                                   x
                                                   1
                                                
                                                ,
                                                
                                                   x
                                                   2
                                                
                                                ,
                                                …
                                                ,
                                                
                                                   x
                                                   n
                                                
                                                }
                                             
                                           and 
                                             
                                                Y
                                                =
                                                {
                                                
                                                   x
                                                   
                                                      1
                                                      ,
                                                      1
                                                   
                                                
                                                ,
                                                
                                                   x
                                                   
                                                      1
                                                      ,
                                                      2
                                                   
                                                
                                                ,
                                                
                                                   x
                                                   
                                                      1
                                                      ,
                                                      3
                                                   
                                                
                                                ,
                                                
                                                   x
                                                   
                                                      2
                                                      ,
                                                      1
                                                   
                                                
                                                ,
                                                
                                                   x
                                                   
                                                      2
                                                      ,
                                                      2
                                                   
                                                
                                                ,
                                                
                                                   x
                                                   
                                                      2
                                                      ,
                                                      3
                                                   
                                                
                                                ,
                                                …
                                                ,
                                                
                                                   x
                                                   
                                                      n
                                                      ,
                                                      1
                                                   
                                                
                                                ,
                                                
                                                   x
                                                   
                                                      n
                                                      ,
                                                      2
                                                   
                                                
                                                ,
                                                
                                                   x
                                                   
                                                      n
                                                      ,
                                                      3
                                                   
                                                
                                                }
                                             
                                          
                                       


                                 A consists of 
                                    
                                       ℓ
                                       +
                                       3
                                       n
                                    
                                  agents:

                                    
                                       •
                                       The agent set 
                                             
                                                L
                                                =
                                                {
                                                
                                                   L
                                                   1
                                                
                                                ,
                                                
                                                   L
                                                   2
                                                
                                                ,
                                                …
                                                ,
                                                
                                                   L
                                                   ℓ
                                                
                                                }
                                             
                                          
                                       

The agent set 
                                             
                                                H
                                                =
                                                {
                                                
                                                   H
                                                   1
                                                
                                                ,
                                                
                                                   H
                                                   2
                                                
                                                ,
                                                …
                                                ,
                                                
                                                   H
                                                   n
                                                
                                                }
                                             
                                          
                                       

The agent set 
                                             
                                                X
                                                =
                                                {
                                                
                                                   X
                                                   1
                                                
                                                ,
                                                
                                                   X
                                                   2
                                                
                                                ,
                                                …
                                                ,
                                                
                                                   X
                                                   n
                                                
                                                }
                                             
                                          
                                       

The agent set 
                                             
                                                C
                                                =
                                                {
                                                
                                                   C
                                                   1
                                                
                                                ,
                                                
                                                   C
                                                   2
                                                
                                                ,
                                                …
                                                ,
                                                
                                                   C
                                                   n
                                                
                                                }
                                             
                                          
                                       

The ranking of the agents is given in Table 1
                                 , where a d in a column denotes that the next available item di
                                  is used (where the items are placed in the increasing order of their index). Note that in any case where we use this abbreviation the index of the item itself is irrelevant, since, as we will show, in an allocation of maximum Nash product social welfare all items di
                                  are allocated to agents from L. Again, we represent the clauses of instance 
                                    I
                                  in the form 
                                    
                                       
                                          C
                                          i
                                       
                                       =
                                       
                                          (
                                          
                                             x
                                             
                                                
                                                   i
                                                   1
                                                
                                                ,
                                                
                                                   k
                                                   1
                                                
                                             
                                          
                                          ∨
                                          
                                             x
                                             
                                                
                                                   i
                                                   2
                                                
                                                ,
                                                
                                                   k
                                                   2
                                                
                                             
                                          
                                          ∨
                                          
                                             x
                                             
                                                
                                                   i
                                                   3
                                                
                                                ,
                                                
                                                   k
                                                   3
                                                
                                             
                                          
                                          )
                                       
                                       ,
                                    
                                  where kj
                                  ∈ {1, 2, 3} denotes the kj
                                 -th occurrence of variable 
                                    
                                       x
                                       
                                          i
                                          j
                                       
                                    
                                  in C, by the set 
                                    
                                       
                                          C
                                          i
                                       
                                       =
                                       
                                          {
                                          
                                             x
                                             
                                                
                                                   i
                                                   1
                                                
                                                ,
                                                
                                                   k
                                                   1
                                                
                                             
                                          
                                          ∨
                                          
                                             x
                                             
                                                
                                                   i
                                                   2
                                                
                                                ,
                                                
                                                   k
                                                   2
                                                
                                             
                                          
                                          ∨
                                          
                                             x
                                             
                                                
                                                   i
                                                   3
                                                
                                                ,
                                                
                                                   k
                                                   3
                                                
                                             
                                          
                                          }
                                       
                                    
                                 . Thus, the items c
                                 
                                    i, 1, c
                                 
                                    i, 2 and c
                                 
                                    i, 3 of agent Ci
                                  thus correspond to the 
                                    
                                       
                                          x
                                          
                                             
                                                i
                                                1
                                             
                                             ,
                                             
                                                k
                                                1
                                             
                                          
                                       
                                       ,
                                       
                                          x
                                          
                                             
                                                i
                                                2
                                             
                                             ,
                                             
                                                k
                                                2
                                             
                                          
                                       
                                       ,
                                       
                                          x
                                          
                                             
                                                i
                                                3
                                             
                                             ,
                                             
                                                k
                                                3
                                             
                                          
                                       
                                    
                                  (and in this way to the three variables of the clause Ci
                                  of instance 
                                    I
                                 ). In particular, the items c
                                 
                                    i, 1, c
                                 
                                    i, 2 and c
                                 
                                    i, 3 of an agent Ci
                                  are elements of Y. In Table 1, we have 
                                    
                                       
                                          c
                                          
                                             1
                                             ,
                                             1
                                          
                                       
                                       =
                                       
                                          x
                                          
                                             1
                                             ,
                                             1
                                          
                                       
                                       ,
                                    
                                 
                                 
                                    
                                       
                                          c
                                          
                                             1
                                             ,
                                             2
                                          
                                       
                                       =
                                       
                                          x
                                          
                                             2
                                             ,
                                             1
                                          
                                       
                                       ,
                                    
                                 
                                 
                                    
                                       
                                          c
                                          
                                             1
                                             ,
                                             3
                                          
                                       
                                       =
                                       
                                          x
                                          
                                             n
                                             ,
                                             3
                                          
                                       
                                    
                                  and 
                                    
                                       
                                          c
                                          
                                             2
                                             ,
                                             1
                                          
                                       
                                       =
                                       
                                          x
                                          
                                             1
                                             ,
                                             2
                                          
                                       
                                    
                                 . The main features of the construction of the NPSW-Borda instance 
                                    B
                                  can be briefly described as follows: agents Hi
                                  rank all hj
                                  and the item xi
                                  very high when compared to agents from L. The agents Xi
                                  rank item xi
                                  in a very high position and also the items x
                                 
                                    i, j
                                  in a high position when compared to agents from L. Finally agents Ci
                                  rank item ei
                                  high when compared to agents from L and also the three items x
                                 
                                    k, l
                                  corresponding to variables in clause Ci
                                  (and represented by the three c
                                 
                                    i, j
                                 ).

Let a be an agent, l an item and S a set of items. Recall that now ua
                                 (l) denotes the Borda score of item l in the ranking of a. Again, let P be an allocation.


                                 
                                    I
                                  is a “yes”-instance of Cubic Monotone 1-in-3 Sat if and only if 
                                    B
                                  is a “yes”-instance of NPSW-Borda, where

                                    
                                       
                                          
                                             
                                                
                                                   
                                                      k
                                                      *
                                                   
                                                
                                                
                                                   =
                                                
                                                
                                                   
                                                      
                                                         M
                                                         l
                                                      
                                                      ·
                                                      
                                                         (
                                                         
                                                            ∏
                                                            
                                                               i
                                                               =
                                                               0
                                                            
                                                            
                                                               
                                                                  n
                                                                  3
                                                               
                                                               −
                                                               1
                                                            
                                                         
                                                         
                                                            (
                                                            M
                                                            −
                                                            i
                                                            )
                                                         
                                                         )
                                                      
                                                      ·
                                                      
                                                         
                                                            (
                                                            M
                                                            −
                                                            
                                                               n
                                                               3
                                                            
                                                            )
                                                         
                                                         
                                                            
                                                               2
                                                               n
                                                            
                                                            3
                                                         
                                                      
                                                      ·
                                                      
                                                         
                                                            (
                                                            M
                                                            −
                                                            
                                                               n
                                                               3
                                                            
                                                            )
                                                         
                                                         
                                                            n
                                                            3
                                                         
                                                      
                                                   
                                                
                                             
                                             
                                                
                                                
                                                
                                                   
                                                      ·
                                                      
                                                         
                                                            (
                                                            
                                                               1
                                                               2
                                                            
                                                            
                                                               (
                                                               M
                                                               −
                                                               
                                                                  n
                                                                  3
                                                               
                                                               −
                                                               2
                                                               )
                                                            
                                                            )
                                                         
                                                         
                                                            
                                                               2
                                                               n
                                                            
                                                            3
                                                         
                                                      
                                                      ·
                                                      
                                                         
                                                            (
                                                            
                                                               5
                                                               4
                                                            
                                                            
                                                               (
                                                               M
                                                               −
                                                               9
                                                               
                                                                  n
                                                                  10
                                                               
                                                               −
                                                               2
                                                               )
                                                            
                                                            )
                                                         
                                                         n
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                              

“⇐”

We will first show that in any “yes” instance 
                                    
                                       B
                                       ,
                                    
                                  there is an allocation of Nash product social welfare at least k
                                 * which satisfies:

                                    
                                       1.
                                       
                                          Li
                                           gets item di
                                          , for each 1 ≤ i ≤ ℓ.


                                          Ci
                                           gets ei
                                          , for each 1 ≤ i ≤ n.

Each hi
                                           is given to some Hj
                                          , and each 
                                             
                                                
                                                   H
                                                   j
                                                
                                                ∈
                                                H
                                             
                                           gets at most one hi
                                          .

If Hj
                                           does not get an item of H, then it gets xj
                                          .

If Hj
                                           gets an item of H, then Xj
                                           gets xj
                                          .

All items from Y are allocated to agents from 
                                             
                                                X
                                                ∪
                                                C
                                             
                                          .


                                       Li gets item di, for each 1 ≤ i ≤ ℓ.
                                    

Note that all agents Li
                                        rank all items l ∈ (H∪E∪X) in the same way. Assume that one agent Lj
                                        did not get an item of the set D. Let a be the agent such that dj
                                        ∈ P(a). We can re-write the utility achieved by agent a as 
                                          
                                             
                                                u
                                                a
                                             
                                             
                                                (
                                                P
                                                )
                                             
                                             =
                                             
                                                u
                                                a
                                             
                                             
                                                (
                                                
                                                   d
                                                   j
                                                
                                                )
                                             
                                             +
                                             
                                                u
                                                a
                                             
                                             
                                                (
                                                
                                                   R
                                                   a
                                                
                                                )
                                             
                                             ,
                                          
                                        where
                                          3
                                       
                                       
                                          3
                                          In the following, we frequently use the notation Ra
                                              in order to sum up the “rest” of items allocated to an agent a, i.e., a set of items distinguished from some dedicated items allocated to a. In what follows, it should be clear from the context which item set Ra
                                              refers to.
                                        
                                       Ra
                                        ≔ (P(a)∖dj
                                       ). Hence, a and Lj
                                        together contribute to the Nash product social welfare:

                                          
                                             
                                                
                                                   
                                                      u
                                                      a
                                                   
                                                   
                                                      (
                                                      P
                                                      )
                                                   
                                                   ·
                                                   
                                                      u
                                                      
                                                         L
                                                         j
                                                      
                                                   
                                                   
                                                      (
                                                      P
                                                      )
                                                   
                                                   =
                                                   
                                                      u
                                                      a
                                                   
                                                   
                                                      (
                                                      
                                                         h
                                                         j
                                                      
                                                      )
                                                   
                                                   ·
                                                   
                                                      u
                                                      
                                                         L
                                                         j
                                                      
                                                   
                                                   
                                                      (
                                                      I
                                                      )
                                                   
                                                   +
                                                   
                                                      u
                                                      a
                                                   
                                                   
                                                      (
                                                      
                                                         R
                                                         a
                                                      
                                                      )
                                                   
                                                   ·
                                                   
                                                      u
                                                      
                                                         L
                                                         j
                                                      
                                                   
                                                   
                                                      (
                                                      I
                                                      )
                                                   
                                                
                                             
                                          
                                       However, if we handle dj
                                        over to Lj
                                        and all items I of Lj
                                        to a we get a total contribution of the two agents of:

                                          
                                             
                                                
                                                   
                                                      (
                                                      
                                                         u
                                                         a
                                                      
                                                      
                                                         (
                                                         I
                                                         )
                                                      
                                                      +
                                                      
                                                         u
                                                         a
                                                      
                                                      
                                                         (
                                                         
                                                            R
                                                            a
                                                         
                                                         )
                                                      
                                                      )
                                                   
                                                   ·
                                                   M
                                                   =
                                                   
                                                      u
                                                      a
                                                   
                                                   
                                                      (
                                                      I
                                                      )
                                                   
                                                   ·
                                                   M
                                                   +
                                                   
                                                      u
                                                      a
                                                   
                                                   
                                                      (
                                                      
                                                         R
                                                         a
                                                      
                                                      )
                                                   
                                                   ·
                                                   M
                                                
                                             
                                          
                                       Note that 
                                          
                                             
                                                u
                                                a
                                             
                                             
                                                (
                                                I
                                                )
                                             
                                             ≥
                                             
                                                u
                                                
                                                   L
                                                   j
                                                
                                             
                                             
                                                (
                                                I
                                                )
                                             
                                             ,
                                          
                                        since a does not rank any item l ∈ {H∪E∪X} lower than Lj
                                       . In addition, 
                                          
                                             
                                                u
                                                
                                                   L
                                                   j
                                                
                                             
                                             
                                                (
                                                I
                                                )
                                             
                                             <
                                             
                                                
                                                   (
                                                   5
                                                   n
                                                   +
                                                   
                                                      n
                                                      3
                                                   
                                                   )
                                                
                                                2
                                             
                                             <
                                             M
                                          
                                        by construction. Hence this exchange does not diminish the total contribution of a and Lj
                                        to the objective value and hence there exists an assignment such that any agent Li
                                        has one dj
                                        allocated. By the pigeonhole principle this means that each agent Lj
                                        gets exactly one di
                                       . Since Lj
                                        ranks dj
                                        on top position, in an allocation that maximizes Nash product social welfare clearly Lj
                                        gets item dj
                                       , 1 ≤ j ≤ ℓ.□


                                       Ci gets ei
                                       , 1 ≤ i ≤ n. Assume the opposite, i.e., there is an agent Ci
                                        such that ei
                                       ∉P(Ci
                                       ).


                                       Case 1. Assume that ei
                                        ∈ P(Lj
                                       ): the total contribution of Lj
                                        to the Nash product achieved by P can be bounded by:

                                          
                                             
                                                
                                                   
                                                      u
                                                      
                                                         L
                                                         j
                                                      
                                                   
                                                   
                                                      (
                                                      P
                                                      )
                                                   
                                                   =
                                                   
                                                      u
                                                      
                                                         L
                                                         j
                                                      
                                                   
                                                   
                                                      (
                                                      
                                                         e
                                                         i
                                                      
                                                      )
                                                   
                                                   +
                                                   
                                                      u
                                                      
                                                         L
                                                         j
                                                      
                                                   
                                                   
                                                      (
                                                      
                                                         d
                                                         j
                                                      
                                                      )
                                                   
                                                   +
                                                   
                                                      u
                                                      
                                                         L
                                                         j
                                                      
                                                   
                                                   
                                                      (
                                                      
                                                         R
                                                         
                                                            L
                                                            j
                                                         
                                                      
                                                      )
                                                   
                                                   <
                                                   M
                                                   +
                                                   
                                                      n
                                                      3
                                                   
                                                
                                             
                                          
                                       In this respect, 
                                          
                                             R
                                             
                                                L
                                                j
                                             
                                          
                                        denotes the set of items allocated to Lj
                                        under P with the exception of ei
                                        and dj
                                       . Here, n
                                       3 is a very rough bound for the sum over the profits of all items with weight smaller or equal to 
                                          
                                             5
                                             n
                                             +
                                             
                                                n
                                                3
                                             
                                          
                                       . Let imin
                                        denote the item of smallest Borda score allocated to Ci
                                       . The contribution of Ci
                                        can be bounded as follows:

                                          
                                             
                                                
                                                   
                                                      u
                                                      
                                                         C
                                                         i
                                                      
                                                   
                                                   
                                                      (
                                                      P
                                                      )
                                                   
                                                   =
                                                   
                                                      u
                                                      
                                                         C
                                                         i
                                                      
                                                   
                                                   
                                                      (
                                                      
                                                         i
                                                         
                                                            m
                                                            i
                                                            n
                                                         
                                                      
                                                      )
                                                   
                                                   +
                                                   
                                                      u
                                                      
                                                         C
                                                         i
                                                      
                                                   
                                                   
                                                      (
                                                      
                                                         R
                                                         
                                                            C
                                                            i
                                                         
                                                      
                                                      )
                                                   
                                                   <
                                                   3
                                                   ·
                                                   
                                                      
                                                         (
                                                         M
                                                         −
                                                         9
                                                         
                                                            n
                                                            10
                                                         
                                                         )
                                                      
                                                      4
                                                   
                                                   +
                                                   
                                                      n
                                                      3
                                                   
                                                
                                             
                                          
                                       The bound comes from taking the three items c
                                       
                                          i, j
                                        and all the items of profit at most 
                                          
                                             5
                                             n
                                             +
                                             
                                                n
                                                3
                                             
                                          
                                       .

Exchanging imin
                                        with ei
                                       , however, yields a contribution of Ci
                                        and Lj
                                        to the Nash product of at least:

                                          
                                             
                                                
                                                   M
                                                   ·
                                                   (
                                                   M
                                                   −
                                                   9
                                                   
                                                      n
                                                      10
                                                   
                                                   )
                                                
                                             
                                          
                                       It remains to show that 
                                          
                                             
                                                u
                                                
                                                   C
                                                   i
                                                
                                             
                                             
                                                (
                                                P
                                                )
                                             
                                             ·
                                             
                                                u
                                                
                                                   L
                                                   j
                                                
                                             
                                             
                                                (
                                                P
                                                )
                                             
                                             ≤
                                             M
                                             ·
                                             
                                                (
                                                M
                                                −
                                                9
                                                
                                                   n
                                                   10
                                                
                                                )
                                             
                                          
                                        holds:

                                          
                                             
                                                
                                                   
                                                      
                                                         
                                                            
                                                               u
                                                               
                                                                  C
                                                                  i
                                                               
                                                            
                                                            
                                                               (
                                                               P
                                                               )
                                                            
                                                            ·
                                                            
                                                               u
                                                               
                                                                  L
                                                                  j
                                                               
                                                            
                                                            
                                                               (
                                                               P
                                                               )
                                                            
                                                         
                                                      
                                                      
                                                         <
                                                      
                                                      
                                                         
                                                            
                                                               (
                                                               3
                                                               ·
                                                               
                                                                  
                                                                     (
                                                                     M
                                                                     −
                                                                     9
                                                                     
                                                                        n
                                                                        10
                                                                     
                                                                     )
                                                                  
                                                                  4
                                                               
                                                               +
                                                               
                                                                  n
                                                                  3
                                                               
                                                               )
                                                            
                                                            ·
                                                            
                                                               (
                                                               M
                                                               +
                                                               
                                                                  n
                                                                  3
                                                               
                                                               )
                                                            
                                                         
                                                      
                                                   
                                                   
                                                      
                                                      
                                                         =
                                                      
                                                      
                                                         
                                                            
                                                               3
                                                               4
                                                            
                                                            
                                                               (
                                                               M
                                                               −
                                                               9
                                                               
                                                                  n
                                                                  10
                                                               
                                                               )
                                                            
                                                            
                                                               (
                                                               M
                                                               +
                                                               
                                                                  n
                                                                  3
                                                               
                                                               )
                                                            
                                                            +
                                                            
                                                               n
                                                               3
                                                            
                                                            
                                                               (
                                                               M
                                                               +
                                                               
                                                                  n
                                                                  3
                                                               
                                                               )
                                                            
                                                         
                                                      
                                                   
                                                   
                                                      
                                                      
                                                         <
                                                      
                                                      
                                                         
                                                            M
                                                            ·
                                                            (
                                                            M
                                                            −
                                                            9
                                                            
                                                               n
                                                               10
                                                            
                                                            )
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                       where the last inequality follows from the fact that

                                          
                                             
                                                
                                                   
                                                      
                                                         
                                                            
                                                               1
                                                               4
                                                            
                                                            
                                                               (
                                                               M
                                                               −
                                                               9
                                                               
                                                                  n
                                                                  10
                                                               
                                                               )
                                                            
                                                            M
                                                         
                                                      
                                                      
                                                         =
                                                      
                                                      
                                                         
                                                            
                                                               1
                                                               4
                                                            
                                                            
                                                               n
                                                               10
                                                            
                                                            ·
                                                            10
                                                            
                                                               n
                                                               10
                                                            
                                                         
                                                      
                                                   
                                                   
                                                      
                                                      
                                                         >
                                                      
                                                      
                                                         
                                                            
                                                               3
                                                               4
                                                            
                                                            
                                                               n
                                                               10
                                                            
                                                            ·
                                                            
                                                               n
                                                               3
                                                            
                                                            +
                                                            
                                                               n
                                                               3
                                                            
                                                            
                                                               (
                                                               
                                                                  n
                                                                  10
                                                               
                                                               +
                                                               
                                                                  n
                                                                  3
                                                               
                                                               )
                                                            
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                       is satisfied.


                                       Case 2. Assume that ei
                                        ∈ P(Hj
                                       ):

                                          
                                             
                                                
                                                   
                                                      
                                                         
                                                            
                                                               u
                                                               
                                                                  H
                                                                  j
                                                               
                                                            
                                                            
                                                               (
                                                               P
                                                               )
                                                            
                                                         
                                                      
                                                      
                                                         =
                                                      
                                                      
                                                         
                                                            
                                                               u
                                                               
                                                                  H
                                                                  j
                                                               
                                                            
                                                            
                                                               (
                                                               
                                                                  e
                                                                  i
                                                               
                                                               )
                                                            
                                                            +
                                                            
                                                               u
                                                               
                                                                  H
                                                                  j
                                                               
                                                            
                                                            
                                                               (
                                                               
                                                                  R
                                                                  
                                                                     H
                                                                     j
                                                                  
                                                               
                                                               )
                                                            
                                                            ≤
                                                            n
                                                            +
                                                            
                                                               u
                                                               
                                                                  H
                                                                  j
                                                               
                                                            
                                                            
                                                               (
                                                               
                                                                  R
                                                                  
                                                                     H
                                                                     j
                                                                  
                                                               
                                                               )
                                                            
                                                         
                                                      
                                                   
                                                   
                                                      
                                                         
                                                            
                                                               u
                                                               
                                                                  C
                                                                  i
                                                               
                                                            
                                                            
                                                               (
                                                               P
                                                               )
                                                            
                                                         
                                                      
                                                      
                                                         =
                                                      
                                                      
                                                         
                                                            
                                                               u
                                                               
                                                                  C
                                                                  i
                                                               
                                                            
                                                            
                                                               (
                                                               
                                                                  i
                                                                  
                                                                     m
                                                                     i
                                                                     n
                                                                  
                                                               
                                                               )
                                                            
                                                            +
                                                            
                                                               u
                                                               
                                                                  C
                                                                  i
                                                               
                                                            
                                                            
                                                               (
                                                               
                                                                  R
                                                                  
                                                                     C
                                                                     i
                                                                  
                                                               
                                                               )
                                                            
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    


                                       Case 2.1 If 
                                          
                                             R
                                             
                                                H
                                                j
                                             
                                          
                                        contains an item of Borda score larger than n, we handle ei
                                        over to Ci
                                        and get a new product contribution of Hj
                                        and Ci
                                        of at least:

                                          
                                             
                                                
                                                   
                                                      u
                                                      
                                                         H
                                                         j
                                                      
                                                   
                                                   
                                                      (
                                                      
                                                         R
                                                         
                                                            H
                                                            j
                                                         
                                                      
                                                      )
                                                   
                                                   ·
                                                   
                                                      (
                                                      
                                                         u
                                                         
                                                            C
                                                            i
                                                         
                                                      
                                                      
                                                         (
                                                         
                                                            i
                                                            
                                                               m
                                                               i
                                                               n
                                                            
                                                         
                                                         )
                                                      
                                                      +
                                                      
                                                         u
                                                         
                                                            C
                                                            i
                                                         
                                                      
                                                      
                                                         (
                                                         
                                                            R
                                                            
                                                               C
                                                               i
                                                            
                                                         
                                                         )
                                                      
                                                      +
                                                      
                                                         (
                                                         M
                                                         −
                                                         9
                                                         
                                                            n
                                                            10
                                                         
                                                         )
                                                      
                                                      )
                                                   
                                                
                                             
                                          
                                       
                                    

Note that

                                          
                                             
                                                
                                                   
                                                      
                                                         
                                                            
                                                               u
                                                               
                                                                  H
                                                                  j
                                                               
                                                            
                                                            
                                                               (
                                                               
                                                                  R
                                                                  
                                                                     H
                                                                     j
                                                                  
                                                               
                                                               )
                                                            
                                                            ·
                                                            
                                                               (
                                                               M
                                                               −
                                                               9
                                                               
                                                                  n
                                                                  10
                                                               
                                                               )
                                                            
                                                         
                                                      
                                                      
                                                         >
                                                      
                                                      
                                                         
                                                            n
                                                            ·
                                                            
                                                               (
                                                               3
                                                               ·
                                                               
                                                                  
                                                                     M
                                                                     −
                                                                     9
                                                                     
                                                                        n
                                                                        10
                                                                     
                                                                  
                                                                  4
                                                               
                                                               +
                                                               
                                                                  n
                                                                  3
                                                               
                                                               )
                                                            
                                                         
                                                      
                                                   
                                                   
                                                      
                                                      
                                                         ≥
                                                      
                                                      
                                                         
                                                            n
                                                            ·
                                                            (
                                                            
                                                               u
                                                               
                                                                  C
                                                                  i
                                                               
                                                            
                                                            
                                                               (
                                                               
                                                                  i
                                                                  
                                                                     m
                                                                     i
                                                                     n
                                                                  
                                                               
                                                               )
                                                            
                                                            +
                                                            
                                                               u
                                                               
                                                                  C
                                                                  i
                                                               
                                                            
                                                            
                                                               (
                                                               
                                                                  R
                                                                  
                                                                     C
                                                                     i
                                                                  
                                                               
                                                               )
                                                            
                                                            )
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                       holds; i.e., handling ei
                                        to Ci
                                        yields a higher Nash product.


                                       Case 2.2 If 
                                          
                                             R
                                             
                                                H
                                                j
                                             
                                          
                                        contains items of Borda score at most n only, then exchange ei
                                        with imax
                                       , where imax
                                        denotes the item of P(Ci
                                       ) with highest Borda score. If 
                                          
                                             
                                                u
                                                
                                                   H
                                                   j
                                                
                                             
                                             
                                                (
                                                
                                                   i
                                                   
                                                      m
                                                      a
                                                      x
                                                   
                                                
                                                )
                                             
                                             <
                                             
                                                u
                                                
                                                   H
                                                   j
                                                
                                             
                                             
                                                (
                                                
                                                   e
                                                   i
                                                
                                                )
                                             
                                             ,
                                          
                                        then 
                                          
                                             
                                                i
                                                
                                                   m
                                                   a
                                                   x
                                                
                                             
                                             ∈
                                             
                                                {
                                                
                                                   e
                                                   2
                                                
                                                ,
                                                …
                                                ,
                                                
                                                   e
                                                   n
                                                
                                                }
                                             
                                          
                                       . Thus, 
                                          
                                             
                                                u
                                                
                                                   H
                                                   j
                                                
                                             
                                             
                                                (
                                                P
                                                )
                                             
                                             ·
                                             
                                                u
                                                
                                                   C
                                                   i
                                                
                                             
                                             
                                                (
                                                P
                                                )
                                             
                                             <
                                             
                                                n
                                                4
                                             
                                             ,
                                          
                                        while the exchange leads to a contribution of at least 
                                          
                                             (
                                             M
                                             −
                                             9
                                             
                                                n
                                                10
                                             
                                             )
                                          
                                       . If 
                                          
                                             
                                                u
                                                
                                                   H
                                                   j
                                                
                                             
                                             
                                                (
                                                
                                                   i
                                                   
                                                      m
                                                      a
                                                      x
                                                   
                                                
                                                )
                                             
                                             ≥
                                             
                                                u
                                                
                                                   H
                                                   j
                                                
                                             
                                             
                                                (
                                                
                                                   e
                                                   i
                                                
                                                )
                                             
                                             ,
                                          
                                        then we have

                                          
                                             
                                                
                                                   
                                                      
                                                         
                                                            
                                                               u
                                                               
                                                                  H
                                                                  j
                                                               
                                                            
                                                            
                                                               (
                                                               P
                                                               )
                                                            
                                                            ·
                                                            
                                                               u
                                                               
                                                                  C
                                                                  i
                                                               
                                                            
                                                            
                                                               (
                                                               P
                                                               )
                                                            
                                                         
                                                      
                                                      
                                                         ≤
                                                      
                                                      
                                                         
                                                            
                                                               (
                                                               
                                                                  u
                                                                  
                                                                     H
                                                                     j
                                                                  
                                                               
                                                               
                                                                  (
                                                                  
                                                                     R
                                                                     
                                                                        H
                                                                        j
                                                                     
                                                                  
                                                                  )
                                                               
                                                               +
                                                               
                                                                  u
                                                                  
                                                                     H
                                                                     j
                                                                  
                                                               
                                                               
                                                                  (
                                                                  
                                                                     e
                                                                     i
                                                                  
                                                                  )
                                                               
                                                               )
                                                            
                                                            ·
                                                            
                                                               (
                                                               
                                                                  u
                                                                  
                                                                     C
                                                                     i
                                                                  
                                                               
                                                               
                                                                  (
                                                                  
                                                                     R
                                                                     
                                                                        C
                                                                        i
                                                                     
                                                                  
                                                                  )
                                                               
                                                               +
                                                               
                                                                  u
                                                                  
                                                                     C
                                                                     i
                                                                  
                                                               
                                                               
                                                                  (
                                                                  P
                                                                  )
                                                               
                                                               
                                                                  (
                                                                  
                                                                     i
                                                                     
                                                                        m
                                                                        a
                                                                        x
                                                                     
                                                                  
                                                                  )
                                                               
                                                               )
                                                            
                                                         
                                                      
                                                   
                                                   
                                                      
                                                      
                                                         ≤
                                                      
                                                      
                                                         
                                                            
                                                               (
                                                               
                                                                  u
                                                                  
                                                                     H
                                                                     j
                                                                  
                                                               
                                                               
                                                                  (
                                                                  
                                                                     R
                                                                     
                                                                        H
                                                                        j
                                                                     
                                                                  
                                                                  )
                                                               
                                                               +
                                                               
                                                                  u
                                                                  
                                                                     H
                                                                     j
                                                                  
                                                               
                                                               
                                                                  (
                                                                  
                                                                     i
                                                                     
                                                                        m
                                                                        a
                                                                        x
                                                                     
                                                                  
                                                                  )
                                                               
                                                               )
                                                            
                                                            ·
                                                            
                                                               (
                                                               
                                                                  u
                                                                  
                                                                     C
                                                                     i
                                                                  
                                                               
                                                               
                                                                  (
                                                                  
                                                                     R
                                                                     
                                                                        C
                                                                        i
                                                                     
                                                                  
                                                                  )
                                                               
                                                               +
                                                               
                                                                  u
                                                                  
                                                                     C
                                                                     i
                                                                  
                                                               
                                                               
                                                                  (
                                                                  P
                                                                  )
                                                               
                                                               
                                                                  (
                                                                  
                                                                     e
                                                                     i
                                                                  
                                                                  )
                                                               
                                                               )
                                                            
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    

because of 
                                          
                                             
                                                u
                                                
                                                   C
                                                   i
                                                
                                             
                                             
                                                (
                                                P
                                                )
                                             
                                             
                                                (
                                                
                                                   i
                                                   
                                                      m
                                                      a
                                                      x
                                                   
                                                
                                                )
                                             
                                             ≤
                                             
                                                u
                                                
                                                   C
                                                   i
                                                
                                             
                                             
                                                (
                                                P
                                                )
                                             
                                             
                                                (
                                                
                                                   e
                                                   i
                                                
                                                )
                                             
                                          
                                       .


                                       Case 3. Assume that ei
                                        ∈ P(Xj
                                       ). If 
                                          
                                             
                                                u
                                                
                                                   C
                                                   i
                                                
                                             
                                             
                                                (
                                                
                                                   i
                                                   
                                                      m
                                                      a
                                                      x
                                                   
                                                
                                                )
                                             
                                             >
                                             n
                                             ,
                                          
                                        then exchange ei
                                        with imax
                                       . Note that 
                                          
                                             
                                                u
                                                
                                                   X
                                                   j
                                                
                                             
                                             
                                                (
                                                
                                                   i
                                                   
                                                      m
                                                      a
                                                      x
                                                   
                                                
                                                )
                                             
                                             >
                                             
                                                u
                                                
                                                   X
                                                   j
                                                
                                             
                                             
                                                (
                                                
                                                   e
                                                   i
                                                
                                                )
                                             
                                          
                                        and 
                                          
                                             
                                                u
                                                
                                                   C
                                                   i
                                                
                                             
                                             
                                                (
                                                
                                                   i
                                                   
                                                      m
                                                      a
                                                      x
                                                   
                                                
                                                )
                                             
                                             <
                                             
                                                u
                                                
                                                   C
                                                   i
                                                
                                             
                                             
                                                (
                                                
                                                   e
                                                   i
                                                
                                                )
                                             
                                          
                                        hold, which clearly implies that the new contribution exceeds 
                                          
                                             
                                                u
                                                
                                                   X
                                                   j
                                                
                                             
                                             
                                                (
                                                P
                                                )
                                             
                                             ·
                                             
                                                u
                                                
                                                   C
                                                   i
                                                
                                             
                                             
                                                (
                                                P
                                                )
                                             
                                          
                                       .

Thus, we can assume 
                                          
                                             
                                                u
                                                
                                                   C
                                                   i
                                                
                                             
                                             
                                                (
                                                
                                                   i
                                                   
                                                      m
                                                      a
                                                      x
                                                   
                                                
                                                )
                                             
                                             ≤
                                             n
                                             ,
                                          
                                        i.e., imax
                                        ∈ E. If 
                                          
                                             
                                                R
                                                
                                                   X
                                                   j
                                                
                                             
                                             ≠
                                             ∅
                                             ,
                                          
                                        handle ei
                                        over to Ci
                                        which yields a new contribution of at least 
                                          
                                             
                                                u
                                                
                                                   X
                                                   j
                                                
                                             
                                             
                                                (
                                                
                                                   R
                                                   
                                                      X
                                                      j
                                                   
                                                
                                                )
                                             
                                             ·
                                             
                                                (
                                                M
                                                −
                                                9
                                                
                                                   n
                                                   10
                                                
                                                )
                                             
                                          
                                       . Clearly,

                                          
                                             
                                                
                                                   
                                                      u
                                                      
                                                         X
                                                         j
                                                      
                                                   
                                                   
                                                      (
                                                      P
                                                      )
                                                   
                                                   ·
                                                   
                                                      u
                                                      
                                                         C
                                                         i
                                                      
                                                   
                                                   
                                                      (
                                                      P
                                                      )
                                                   
                                                   ≤
                                                   
                                                      (
                                                      
                                                         u
                                                         
                                                            X
                                                            j
                                                         
                                                      
                                                      
                                                         (
                                                         
                                                            R
                                                            
                                                               X
                                                               j
                                                            
                                                         
                                                         )
                                                      
                                                      +
                                                      
                                                         u
                                                         
                                                            X
                                                            j
                                                         
                                                      
                                                      
                                                         (
                                                         
                                                            e
                                                            i
                                                         
                                                         )
                                                      
                                                      )
                                                   
                                                   ·
                                                   
                                                      n
                                                      2
                                                   
                                                   ≤
                                                   
                                                      u
                                                      
                                                         X
                                                         j
                                                      
                                                   
                                                   
                                                      (
                                                      
                                                         R
                                                         
                                                            X
                                                            j
                                                         
                                                      
                                                      )
                                                   
                                                   ·
                                                   
                                                      (
                                                      M
                                                      −
                                                      9
                                                      
                                                         n
                                                         10
                                                      
                                                      )
                                                   
                                                
                                             
                                          
                                       
                                    

If 
                                          
                                             
                                                R
                                                
                                                   X
                                                   j
                                                
                                             
                                             =
                                             ∅
                                             ,
                                          
                                        we handle ei
                                        over to Ci
                                        and imax
                                        over to Xj
                                        and get a new contribution of at least 
                                          
                                             M
                                             −
                                             9
                                             
                                                n
                                                10
                                             
                                          
                                       . Obviously, this exceeds the former contribution, since

                                          
                                             
                                                
                                                   
                                                      u
                                                      
                                                         X
                                                         j
                                                      
                                                   
                                                   
                                                      (
                                                      P
                                                      )
                                                   
                                                   ·
                                                   
                                                      u
                                                      
                                                         C
                                                         i
                                                      
                                                   
                                                   
                                                      (
                                                      P
                                                      )
                                                   
                                                   ≤
                                                   
                                                      u
                                                      
                                                         X
                                                         j
                                                      
                                                   
                                                   
                                                      (
                                                      
                                                         e
                                                         i
                                                      
                                                      )
                                                   
                                                   ·
                                                   
                                                      n
                                                      2
                                                   
                                                   <
                                                   
                                                      n
                                                      3
                                                   
                                                   <
                                                   
                                                      (
                                                      M
                                                      −
                                                      9
                                                      
                                                         n
                                                         10
                                                      
                                                      )
                                                   
                                                
                                             
                                          
                                       
                                    


                                       Case 4. 
                                       ei
                                        ∈ P(Cj
                                       ), for some 
                                          
                                             i
                                             ≠
                                             j
                                          
                                       . Due to Cases 1–3, we can assume that ei
                                        is allocated to one of the agents of C. Assume imax
                                       ∉E. Note that 
                                          
                                             
                                                u
                                                
                                                   C
                                                   i
                                                
                                             
                                             
                                                (
                                                
                                                   e
                                                   i
                                                
                                                )
                                             
                                             >
                                             
                                                u
                                                
                                                   C
                                                   i
                                                
                                             
                                             
                                                (
                                                
                                                   i
                                                   
                                                      m
                                                      a
                                                      x
                                                   
                                                
                                                )
                                             
                                          
                                        and 
                                          
                                             
                                                u
                                                
                                                   C
                                                   j
                                                
                                             
                                             
                                                (
                                                
                                                   e
                                                   i
                                                
                                                )
                                             
                                             <
                                             
                                                u
                                                
                                                   C
                                                   j
                                                
                                             
                                             
                                                (
                                                
                                                   i
                                                   
                                                      m
                                                      a
                                                      x
                                                   
                                                
                                                )
                                             
                                          
                                        hold. Thus, if we exchange ei
                                        with imax
                                        of Ci
                                        we get:

                                          
                                             
                                                
                                                   
                                                      
                                                         
                                                            
                                                               u
                                                               
                                                                  C
                                                                  j
                                                               
                                                            
                                                            
                                                               (
                                                               P
                                                               )
                                                            
                                                            ·
                                                            
                                                               u
                                                               
                                                                  C
                                                                  i
                                                               
                                                            
                                                            
                                                               (
                                                               P
                                                               )
                                                            
                                                         
                                                      
                                                      
                                                         =
                                                      
                                                      
                                                         
                                                            
                                                               (
                                                               
                                                                  u
                                                                  
                                                                     C
                                                                     j
                                                                  
                                                               
                                                               
                                                                  (
                                                                  
                                                                     e
                                                                     i
                                                                  
                                                                  )
                                                               
                                                               +
                                                               
                                                                  u
                                                                  
                                                                     C
                                                                     j
                                                                  
                                                               
                                                               
                                                                  (
                                                                  
                                                                     R
                                                                     
                                                                        C
                                                                        j
                                                                     
                                                                  
                                                                  )
                                                               
                                                               )
                                                            
                                                            ·
                                                            
                                                               (
                                                               
                                                                  u
                                                                  
                                                                     C
                                                                     i
                                                                  
                                                               
                                                               
                                                                  (
                                                                  
                                                                     i
                                                                     
                                                                        m
                                                                        a
                                                                        x
                                                                     
                                                                  
                                                                  )
                                                               
                                                               +
                                                               
                                                                  u
                                                                  
                                                                     C
                                                                     i
                                                                  
                                                               
                                                               
                                                                  (
                                                                  
                                                                     R
                                                                     
                                                                        C
                                                                        i
                                                                     
                                                                  
                                                                  )
                                                               
                                                               )
                                                            
                                                         
                                                      
                                                   
                                                   
                                                      
                                                      
                                                         <
                                                      
                                                      
                                                         
                                                            
                                                               (
                                                               
                                                                  u
                                                                  
                                                                     C
                                                                     j
                                                                  
                                                               
                                                               
                                                                  (
                                                                  
                                                                     i
                                                                     
                                                                        m
                                                                        a
                                                                        x
                                                                     
                                                                  
                                                                  )
                                                               
                                                               +
                                                               
                                                                  u
                                                                  
                                                                     C
                                                                     j
                                                                  
                                                               
                                                               
                                                                  (
                                                                  
                                                                     R
                                                                     
                                                                        C
                                                                        j
                                                                     
                                                                  
                                                                  )
                                                               
                                                               )
                                                            
                                                            ·
                                                            
                                                               (
                                                               
                                                                  u
                                                                  
                                                                     C
                                                                     i
                                                                  
                                                               
                                                               
                                                                  (
                                                                  
                                                                     e
                                                                     i
                                                                  
                                                                  )
                                                               
                                                               +
                                                               
                                                                  u
                                                                  
                                                                     C
                                                                     i
                                                                  
                                                               
                                                               
                                                                  (
                                                                  
                                                                     R
                                                                     
                                                                        C
                                                                        i
                                                                     
                                                                  
                                                                  )
                                                               
                                                               )
                                                            
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    

If imax
                                        ∈ E, we get

                                          
                                             
                                                
                                                   
                                                      u
                                                      
                                                         C
                                                         j
                                                      
                                                   
                                                   
                                                      (
                                                      P
                                                      )
                                                   
                                                   ·
                                                   
                                                      u
                                                      
                                                         C
                                                         i
                                                      
                                                   
                                                   
                                                      (
                                                      P
                                                      )
                                                   
                                                   ≤
                                                   
                                                      (
                                                      
                                                         u
                                                         
                                                            C
                                                            j
                                                         
                                                      
                                                      
                                                         (
                                                         
                                                            e
                                                            i
                                                         
                                                         )
                                                      
                                                      +
                                                      
                                                         u
                                                         
                                                            C
                                                            j
                                                         
                                                      
                                                      
                                                         (
                                                         
                                                            R
                                                            
                                                               C
                                                               j
                                                            
                                                         
                                                         )
                                                      
                                                      )
                                                   
                                                   ·
                                                   
                                                      n
                                                      2
                                                   
                                                   ≤
                                                   
                                                      u
                                                      
                                                         C
                                                         j
                                                      
                                                   
                                                   
                                                      (
                                                      
                                                         R
                                                         
                                                            C
                                                            j
                                                         
                                                      
                                                      )
                                                   
                                                   ·
                                                   
                                                      (
                                                      M
                                                      −
                                                      9
                                                      
                                                         n
                                                         10
                                                      
                                                      )
                                                   
                                                
                                             
                                          
                                       In the case 
                                          
                                             
                                                R
                                                
                                                   C
                                                   j
                                                
                                             
                                             ≠
                                             ∅
                                             ,
                                          
                                        this proves that the new contribution is higher. If 
                                          
                                             
                                                R
                                                
                                                   C
                                                   j
                                                
                                             
                                             =
                                             ∅
                                          
                                        we apply the same argument as in Case 3.□


                                       Each hi is given to some Hk and each
                                       
                                          
                                             
                                                H
                                                k
                                             
                                             ∈
                                             H
                                          
                                        
                                       gets at most one hi.
                                    

First, we show that each hi
                                        is given to an agent of 
                                          H
                                       . Assume the opposite, i.e., hi
                                        is given to an agent 
                                          
                                             a
                                             ∈
                                             (
                                             L
                                             ∪
                                             X
                                             ∪
                                             C
                                             )
                                          
                                       . Let Hk
                                        be an agent without any item from H (obviously, such an agent must exist). Handle the item imax
                                        ∈ P(Hk
                                       ) with the highest Borda score to a, and in turn handle hi
                                        to Hk
                                       . Note that 
                                          
                                             
                                                u
                                                
                                                   H
                                                   k
                                                
                                             
                                             
                                                (
                                                
                                                   i
                                                   
                                                      m
                                                      a
                                                      x
                                                   
                                                
                                                )
                                             
                                             <
                                             
                                                u
                                                
                                                   H
                                                   k
                                                
                                             
                                             
                                                (
                                                
                                                   h
                                                   i
                                                
                                                )
                                             
                                          
                                        and ua
                                       (imax
                                       ) > ua
                                       (hi
                                       ), since imax
                                       ∉(D∪E) by 1 and 2. Therefore, this exchange yields an allocation with a higher Nash product social welfare. Thus, hi
                                        is allocated to an agent of 
                                          H
                                       .

Second, we show that each 
                                          
                                             H
                                             ∈
                                             H
                                          
                                        gets at most one hi
                                       . Assume there exists an agent 
                                          
                                             
                                                H
                                                k
                                             
                                             ∈
                                             H
                                          
                                        with at least two items from H, say hi
                                        and hj
                                       . By the pigeonhole principle, thus at least one Hl
                                        has no item from H. If xl
                                       ∉P(Hl
                                       ), we have 
                                          
                                             
                                                u
                                                
                                                   H
                                                   l
                                                
                                             
                                             
                                                (
                                                P
                                                )
                                             
                                             <
                                             
                                                n
                                                3
                                             
                                          
                                       .

Handle hj
                                        over to Hl
                                       . Thus,

                                          
                                             
                                                
                                                   
                                                      u
                                                      
                                                         H
                                                         k
                                                      
                                                   
                                                   
                                                      (
                                                      P
                                                      )
                                                   
                                                   ·
                                                   
                                                      u
                                                      
                                                         H
                                                         l
                                                      
                                                   
                                                   
                                                      (
                                                      P
                                                      )
                                                   
                                                   <
                                                   
                                                      (
                                                      
                                                         n
                                                         3
                                                      
                                                      +
                                                      1
                                                      )
                                                   
                                                   M
                                                   ·
                                                   
                                                      n
                                                      3
                                                   
                                                   <
                                                   
                                                      
                                                         (
                                                         M
                                                         −
                                                         
                                                            n
                                                            3
                                                         
                                                         )
                                                      
                                                      2
                                                   
                                                   <
                                                   
                                                      u
                                                      
                                                         H
                                                         k
                                                      
                                                   
                                                   
                                                      (
                                                      
                                                         h
                                                         i
                                                      
                                                      )
                                                   
                                                   
                                                      u
                                                      
                                                         H
                                                         l
                                                      
                                                   
                                                   
                                                      (
                                                      
                                                         h
                                                         j
                                                      
                                                      )
                                                   
                                                
                                             
                                          
                                       implying that there is an allocation with a higher Nash product social welfare.

If xl
                                        ∈ P(Hl
                                       ), we get

                                          
                                             (13)
                                             
                                                
                                                   
                                                      u
                                                      
                                                         X
                                                         l
                                                      
                                                   
                                                   
                                                      (
                                                      P
                                                      )
                                                   
                                                   <
                                                   
                                                      1
                                                      2
                                                   
                                                   
                                                      (
                                                      M
                                                      −
                                                      
                                                         n
                                                         3
                                                      
                                                      )
                                                   
                                                   +
                                                   
                                                      n
                                                      3
                                                   
                                                
                                             
                                          
                                       Handing xl
                                        to Xl
                                        and hj
                                        to Hl
                                       , we get a new contribution of Hk, Hl
                                        and Xl
                                        to the Nash product of at least

                                          
                                             (14)
                                             
                                                
                                                   
                                                      
                                                      
                                                      
                                                         
                                                            
                                                               (
                                                               
                                                                  (
                                                                  M
                                                                  −
                                                                  
                                                                     n
                                                                     3
                                                                  
                                                                  +
                                                                  1
                                                                  )
                                                               
                                                               +
                                                               
                                                                  u
                                                                  
                                                                     H
                                                                     k
                                                                  
                                                               
                                                               
                                                                  (
                                                                  
                                                                     R
                                                                     
                                                                        H
                                                                        k
                                                                     
                                                                  
                                                                  )
                                                               
                                                               )
                                                            
                                                            ·
                                                            
                                                               (
                                                               
                                                                  (
                                                                  M
                                                                  −
                                                                  
                                                                     n
                                                                     3
                                                                  
                                                                  +
                                                                  1
                                                                  )
                                                               
                                                               +
                                                               
                                                                  u
                                                                  
                                                                     H
                                                                     l
                                                                  
                                                               
                                                               
                                                                  (
                                                                  
                                                                     R
                                                                     
                                                                        H
                                                                        l
                                                                     
                                                                  
                                                                  )
                                                               
                                                               )
                                                            
                                                         
                                                      
                                                   
                                                   
                                                      
                                                      
                                                      
                                                         
                                                            
                                                            ·
                                                            
                                                               (
                                                               
                                                                  (
                                                                  M
                                                                  −
                                                                  
                                                                     n
                                                                     3
                                                                  
                                                                  )
                                                               
                                                               +
                                                               
                                                                  u
                                                                  
                                                                     X
                                                                     l
                                                                  
                                                               
                                                               
                                                                  (
                                                                  
                                                                     R
                                                                     
                                                                        X
                                                                        l
                                                                     
                                                                  
                                                                  )
                                                               
                                                               )
                                                            
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    

However, we have

                                          
                                             (15)
                                             
                                                
                                                   
                                                      
                                                      
                                                      
                                                         
                                                            
                                                               u
                                                               
                                                                  H
                                                                  k
                                                               
                                                            
                                                            
                                                               (
                                                               P
                                                               )
                                                            
                                                            ·
                                                            
                                                               u
                                                               
                                                                  H
                                                                  l
                                                               
                                                            
                                                            
                                                               (
                                                               P
                                                               )
                                                            
                                                            ·
                                                            
                                                               u
                                                               
                                                                  X
                                                                  l
                                                               
                                                            
                                                            
                                                               (
                                                               P
                                                               )
                                                            
                                                         
                                                      
                                                   
                                                   
                                                      
                                                      
                                                      
                                                         
                                                            
                                                            ≤
                                                            
                                                               (
                                                               2
                                                               ·
                                                               M
                                                               +
                                                               
                                                                  u
                                                                  
                                                                     H
                                                                     k
                                                                  
                                                               
                                                               
                                                                  (
                                                                  
                                                                     R
                                                                     
                                                                        H
                                                                        k
                                                                     
                                                                  
                                                                  )
                                                               
                                                               )
                                                            
                                                            ·
                                                            
                                                               (
                                                               
                                                                  (
                                                                  M
                                                                  −
                                                                  
                                                                     n
                                                                     3
                                                                  
                                                                  )
                                                               
                                                               +
                                                               
                                                                  u
                                                                  
                                                                     H
                                                                     l
                                                                  
                                                               
                                                               
                                                                  (
                                                                  
                                                                     R
                                                                     
                                                                        H
                                                                        l
                                                                     
                                                                  
                                                                  )
                                                               
                                                               )
                                                            
                                                            ·
                                                            
                                                               (
                                                               
                                                                  u
                                                                  
                                                                     X
                                                                     l
                                                                  
                                                               
                                                               
                                                                  (
                                                                  
                                                                     R
                                                                     
                                                                        X
                                                                        l
                                                                     
                                                                  
                                                                  )
                                                               
                                                               )
                                                            
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    

In order to show that the new contribution, i.e., the term in (14), exceeds the contribution under P, it is sufficient to show that (14) exceeds the right-hand term of (15). Clearly, to prove this it is enough to show that

                                          
                                             
                                                
                                                   
                                                      
                                                      
                                                      
                                                         
                                                            
                                                               (
                                                               
                                                                  (
                                                                  M
                                                                  −
                                                                  
                                                                     n
                                                                     3
                                                                  
                                                                  +
                                                                  1
                                                                  )
                                                               
                                                               +
                                                               
                                                                  u
                                                                  
                                                                     H
                                                                     k
                                                                  
                                                               
                                                               
                                                                  (
                                                                  
                                                                     R
                                                                     
                                                                        H
                                                                        k
                                                                     
                                                                  
                                                                  )
                                                               
                                                               )
                                                            
                                                            ·
                                                            
                                                               (
                                                               
                                                                  (
                                                                  M
                                                                  −
                                                                  
                                                                     n
                                                                     3
                                                                  
                                                                  )
                                                               
                                                               +
                                                               
                                                                  u
                                                                  
                                                                     X
                                                                     l
                                                                  
                                                               
                                                               
                                                                  (
                                                                  
                                                                     R
                                                                     
                                                                        X
                                                                        l
                                                                     
                                                                  
                                                                  )
                                                               
                                                               )
                                                            
                                                         
                                                      
                                                   
                                                   
                                                      
                                                      
                                                      
                                                         
                                                            
                                                            >
                                                            
                                                               (
                                                               2
                                                               ·
                                                               M
                                                               +
                                                               
                                                                  u
                                                                  
                                                                     H
                                                                     k
                                                                  
                                                               
                                                               
                                                                  (
                                                                  
                                                                     R
                                                                     
                                                                        H
                                                                        k
                                                                     
                                                                  
                                                                  )
                                                               
                                                               )
                                                            
                                                            ·
                                                            
                                                               u
                                                               
                                                                  X
                                                                  l
                                                               
                                                            
                                                            
                                                               (
                                                               
                                                                  R
                                                                  
                                                                     X
                                                                     l
                                                                  
                                                               
                                                               )
                                                            
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                       holds:

                                          
                                             
                                                
                                                   
                                                      
                                                      
                                                      
                                                         
                                                            
                                                               (
                                                               
                                                                  (
                                                                  M
                                                                  −
                                                                  
                                                                     n
                                                                     3
                                                                  
                                                                  +
                                                                  1
                                                                  )
                                                               
                                                               +
                                                               
                                                                  u
                                                                  
                                                                     H
                                                                     k
                                                                  
                                                               
                                                               
                                                                  (
                                                                  
                                                                     R
                                                                     
                                                                        H
                                                                        k
                                                                     
                                                                  
                                                                  )
                                                               
                                                               )
                                                            
                                                            ·
                                                            
                                                               (
                                                               
                                                                  (
                                                                  M
                                                                  −
                                                                  
                                                                     n
                                                                     3
                                                                  
                                                                  )
                                                               
                                                               +
                                                               
                                                                  u
                                                                  
                                                                     X
                                                                     l
                                                                  
                                                               
                                                               
                                                                  (
                                                                  
                                                                     R
                                                                     
                                                                        X
                                                                        l
                                                                     
                                                                  
                                                                  )
                                                               
                                                               )
                                                            
                                                         
                                                      
                                                   
                                                   
                                                      
                                                      
                                                      
                                                         
                                                            
                                                            >
                                                            
                                                            
                                                               (
                                                               2
                                                               M
                                                               +
                                                               
                                                                  u
                                                                  
                                                                     H
                                                                     k
                                                                  
                                                               
                                                               
                                                                  (
                                                                  
                                                                     R
                                                                     
                                                                        H
                                                                        k
                                                                     
                                                                  
                                                                  )
                                                               
                                                               )
                                                            
                                                            ·
                                                            
                                                               u
                                                               
                                                                  X
                                                                  l
                                                               
                                                            
                                                            
                                                               (
                                                               
                                                                  R
                                                                  
                                                                     X
                                                                     l
                                                                  
                                                               
                                                               )
                                                            
                                                         
                                                      
                                                   
                                                   
                                                      
                                                      
                                                      
                                                         
                                                            
                                                            ⇔
                                                            
                                                               (
                                                               M
                                                               −
                                                               
                                                                  n
                                                                  3
                                                               
                                                               +
                                                               1
                                                               )
                                                            
                                                            ·
                                                            
                                                               (
                                                               M
                                                               −
                                                               
                                                                  n
                                                                  3
                                                               
                                                               )
                                                            
                                                            +
                                                            
                                                               (
                                                               M
                                                               −
                                                               
                                                                  n
                                                                  3
                                                               
                                                               )
                                                            
                                                            
                                                               u
                                                               
                                                                  H
                                                                  k
                                                               
                                                            
                                                            
                                                               (
                                                               
                                                                  R
                                                                  
                                                                     H
                                                                     k
                                                                  
                                                               
                                                               )
                                                            
                                                         
                                                      
                                                   
                                                   
                                                      
                                                      
                                                      
                                                         
                                                            
                                                            >
                                                            
                                                            
                                                               u
                                                               
                                                                  X
                                                                  l
                                                               
                                                            
                                                            
                                                               (
                                                               
                                                                  R
                                                                  
                                                                     X
                                                                     l
                                                                  
                                                               
                                                               )
                                                            
                                                            ·
                                                            
                                                               [
                                                               2
                                                               M
                                                               −
                                                               
                                                                  (
                                                                  M
                                                                  −
                                                                  
                                                                     n
                                                                     3
                                                                  
                                                                  +
                                                                  1
                                                                  )
                                                               
                                                               ]
                                                            
                                                         
                                                      
                                                   
                                                   
                                                      
                                                      
                                                      
                                                         
                                                            
                                                            ⇔
                                                            
                                                               (
                                                               M
                                                               −
                                                               
                                                                  n
                                                                  3
                                                               
                                                               +
                                                               1
                                                               )
                                                            
                                                            ·
                                                            
                                                               (
                                                               M
                                                               −
                                                               
                                                                  n
                                                                  3
                                                               
                                                               )
                                                            
                                                            +
                                                            
                                                               (
                                                               M
                                                               −
                                                               
                                                                  n
                                                                  3
                                                               
                                                               )
                                                            
                                                            
                                                               u
                                                               
                                                                  H
                                                                  k
                                                               
                                                            
                                                            
                                                               (
                                                               
                                                                  R
                                                                  
                                                                     H
                                                                     k
                                                                  
                                                               
                                                               )
                                                            
                                                         
                                                      
                                                   
                                                   
                                                      
                                                      
                                                      
                                                         
                                                            
                                                            >
                                                            
                                                            
                                                               u
                                                               
                                                                  X
                                                                  l
                                                               
                                                            
                                                            
                                                               (
                                                               
                                                                  R
                                                                  
                                                                     X
                                                                     l
                                                                  
                                                               
                                                               )
                                                            
                                                            ·
                                                            
                                                               [
                                                               M
                                                               +
                                                               
                                                                  n
                                                                  3
                                                               
                                                               −
                                                               1
                                                               ]
                                                            
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                       With 
                                          
                                             
                                                u
                                                
                                                   X
                                                   l
                                                
                                             
                                             
                                                (
                                                
                                                   R
                                                   
                                                      X
                                                      l
                                                   
                                                
                                                )
                                             
                                             <
                                             
                                                1
                                                2
                                             
                                             
                                                (
                                                M
                                                −
                                                
                                                   n
                                                   3
                                                
                                                )
                                             
                                             +
                                             
                                                n
                                                3
                                             
                                          
                                        (stated in (13)), the last inequality follows from

                                          
                                             
                                                
                                                   
                                                      
                                                      
                                                      
                                                         
                                                            
                                                               (
                                                               M
                                                               −
                                                               
                                                                  n
                                                                  3
                                                               
                                                               +
                                                               1
                                                               )
                                                            
                                                            ·
                                                            
                                                               (
                                                               M
                                                               −
                                                               
                                                                  n
                                                                  3
                                                               
                                                               )
                                                            
                                                            >
                                                            
                                                               (
                                                               
                                                                  1
                                                                  2
                                                               
                                                               
                                                                  (
                                                                  M
                                                                  −
                                                                  
                                                                     n
                                                                     3
                                                                  
                                                                  )
                                                               
                                                               +
                                                               
                                                                  n
                                                                  3
                                                               
                                                               )
                                                            
                                                            ·
                                                            
                                                               [
                                                               M
                                                               +
                                                               
                                                                  n
                                                                  3
                                                               
                                                               −
                                                               1
                                                               ]
                                                            
                                                         
                                                      
                                                   
                                                   
                                                      
                                                      
                                                      
                                                         
                                                            
                                                            ⇔
                                                            
                                                               (
                                                               M
                                                               −
                                                               
                                                                  n
                                                                  3
                                                               
                                                               )
                                                            
                                                            
                                                               [
                                                               
                                                                  (
                                                                  M
                                                                  −
                                                                  
                                                                     n
                                                                     3
                                                                  
                                                                  +
                                                                  1
                                                                  )
                                                               
                                                               −
                                                               
                                                                  1
                                                                  2
                                                               
                                                               
                                                                  (
                                                                  M
                                                                  +
                                                                  
                                                                     n
                                                                     3
                                                                  
                                                                  −
                                                                  1
                                                                  )
                                                               
                                                               ]
                                                            
                                                            >
                                                            
                                                               n
                                                               3
                                                            
                                                            
                                                               [
                                                               M
                                                               +
                                                               
                                                                  n
                                                                  3
                                                               
                                                               −
                                                               1
                                                               ]
                                                            
                                                         
                                                      
                                                   
                                                   
                                                      
                                                      
                                                      
                                                         
                                                            
                                                            ⇔
                                                            
                                                               (
                                                               M
                                                               −
                                                               
                                                                  n
                                                                  3
                                                               
                                                               )
                                                            
                                                            ·
                                                            
                                                               (
                                                               
                                                                  1
                                                                  2
                                                               
                                                               M
                                                               −
                                                               
                                                                  n
                                                                  2
                                                               
                                                               +
                                                               
                                                                  3
                                                                  2
                                                               
                                                               )
                                                            
                                                            >
                                                            
                                                               n
                                                               3
                                                            
                                                            
                                                               [
                                                               M
                                                               +
                                                               
                                                                  n
                                                                  3
                                                               
                                                               −
                                                               1
                                                               ]
                                                            
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                       where the last inequality is clearly satisfied by the choice of M.□


                                       If Hj does not get an item of H, then it gets xj.
                                    

Assume that Hj
                                        does not get an item of H. In addition, assume xj
                                       ∉P(Hj
                                       ). Let a be the agent xj
                                        is allocated to under P. Recall that 
                                          
                                             
                                                u
                                                
                                                   H
                                                   j
                                                
                                             
                                             
                                                (
                                                P
                                                )
                                             
                                             ≤
                                             
                                                n
                                                3
                                             
                                          
                                        holds.


                                       Case 1. 
                                       a ∈ (L∪C). It is easy to verify that handling over xj
                                        to Hj
                                        improves the total Nash product.


                                       Case 2.
                                       
                                          
                                             a
                                             =
                                             
                                                H
                                                k
                                             
                                             ∈
                                             H
                                          
                                       : If xj
                                        is allocated to some Hk
                                        and xk
                                        or some hi
                                        is also allocated to Hk
                                       , it is again easy to check that handling xj
                                        over to Hj
                                        improves the total contribution. If Hk
                                        does neither have xk
                                        nor any hi
                                       , then 
                                          
                                             
                                                u
                                                
                                                   H
                                                   k
                                                
                                             
                                             
                                                (
                                                P
                                                )
                                             
                                             ≤
                                             
                                                n
                                                3
                                             
                                          
                                        holds. Hence handling xj
                                        over to Hj
                                        and any item from Hj
                                        to Hk
                                        improves the total profit by reaching a value of at least 
                                          
                                             (
                                             M
                                             −
                                             
                                                n
                                                3
                                             
                                             )
                                          
                                       .


                                       Case 3.
                                       
                                          
                                             a
                                             ∈
                                             X
                                          
                                       :


                                       Case 3.1. If a ≠ Xj
                                       , then 
                                          
                                             
                                                u
                                                a
                                             
                                             
                                                (
                                                P
                                                )
                                             
                                             ≤
                                             
                                                (
                                                5
                                                n
                                                +
                                                
                                                   n
                                                   3
                                                
                                                )
                                             
                                             +
                                             
                                                u
                                                a
                                             
                                             
                                                (
                                                
                                                   R
                                                   a
                                                
                                                )
                                             
                                          
                                        holds. If Ra
                                        ≠ ∅ we handle xj
                                        over to Hj
                                        and clearly augment the total Nash product. If 
                                          
                                             
                                                R
                                                a
                                             
                                             =
                                             ∅
                                          
                                        the total contribution of a and 
                                          
                                             
                                                H
                                                j
                                             
                                             <
                                             
                                                n
                                                3
                                             
                                             ·
                                             
                                                (
                                                5
                                                n
                                                +
                                                
                                                   n
                                                   3
                                                
                                                )
                                             
                                             ,
                                          
                                        hence handling xj
                                        over to Hj
                                        and any other item from Hj
                                        to a improves the contribution as well.


                                       Case 3.2. If 
                                          
                                             a
                                             =
                                             
                                                X
                                                j
                                             
                                          
                                        we have:

                                          
                                             (16)
                                             
                                                
                                                   
                                                      u
                                                      a
                                                   
                                                   
                                                      (
                                                      P
                                                      )
                                                   
                                                   ·
                                                   
                                                      u
                                                      
                                                         H
                                                         j
                                                      
                                                   
                                                   
                                                      (
                                                      P
                                                      )
                                                   
                                                   ≤
                                                   
                                                      (
                                                      
                                                         (
                                                         M
                                                         −
                                                         
                                                            n
                                                            3
                                                         
                                                         )
                                                      
                                                      +
                                                      
                                                         u
                                                         a
                                                      
                                                      
                                                         (
                                                         
                                                            R
                                                            a
                                                         
                                                         )
                                                      
                                                      )
                                                   
                                                   ·
                                                   
                                                      n
                                                      3
                                                   
                                                
                                             
                                          
                                       
                                    

Handling xj
                                        over to Hj
                                        gives a contribution of at least:

                                          
                                             (17)
                                             
                                                
                                                   
                                                      u
                                                      a
                                                   
                                                   
                                                      (
                                                      
                                                         R
                                                         a
                                                      
                                                      )
                                                   
                                                   ·
                                                   
                                                      (
                                                      M
                                                      −
                                                      
                                                         n
                                                         3
                                                      
                                                      )
                                                   
                                                
                                             
                                          
                                       
                                    

If Ra
                                        contains at least one of the three items x
                                       
                                          j, l
                                       , then (17) is larger than the right hand side of (16), i.e., the contribution of a and Hj
                                        to the Nash product after handling xj
                                        over to is higher than before.

If Ra
                                        does not contain one of these items we exchange all the items of a with all the items of Hj
                                        and get a contribution that is at least as high as before (the contribution becomes strictly higher if any x
                                       
                                          j, l
                                        was allocated to Hj
                                       ).□


                                       If Hj gets an item of H, then Xj gets xj.
                                    

Assume that Hj
                                        gets some hi
                                       , but Xj
                                        does not get xj
                                       . Let a be the agent with xj
                                        ∈ P(a). Note that

                                          
                                             (18)
                                             
                                                
                                                   
                                                      u
                                                      
                                                         X
                                                         j
                                                      
                                                   
                                                   
                                                      (
                                                      P
                                                      )
                                                   
                                                   <
                                                   
                                                      1
                                                      2
                                                   
                                                   
                                                      (
                                                      M
                                                      −
                                                      
                                                         n
                                                         3
                                                      
                                                      )
                                                   
                                                   +
                                                   
                                                      n
                                                      3
                                                   
                                                
                                             
                                          
                                       holds.


                                       Case 1. 
                                       a ∈ (L∪C). In this case, handling over xj
                                        to Xj
                                        clearly improves the Nash product social welfare.


                                       Case 2.
                                       
                                          
                                             a
                                             ∈
                                             H
                                          
                                       . If 
                                          
                                             a
                                             ∈
                                             H
                                             ∖
                                             
                                                H
                                                j
                                             
                                             ,
                                          
                                        then with (18) is it not hard to check that handling over xj
                                        to Xj
                                        improves the Nash product social welfare:

                                          
                                             
                                                
                                                   
                                                      
                                                         
                                                            
                                                               u
                                                               a
                                                            
                                                            
                                                               (
                                                               P
                                                               )
                                                            
                                                            ·
                                                            
                                                               u
                                                               
                                                                  X
                                                                  j
                                                               
                                                            
                                                            
                                                               (
                                                               P
                                                               )
                                                            
                                                         
                                                      
                                                      
                                                         ≤
                                                      
                                                      
                                                         
                                                            
                                                               (
                                                               M
                                                               +
                                                               
                                                                  (
                                                                  5
                                                                  n
                                                                  +
                                                                  
                                                                     n
                                                                     3
                                                                  
                                                                  )
                                                               
                                                               +
                                                               
                                                                  u
                                                                  a
                                                               
                                                               
                                                                  (
                                                                  
                                                                     R
                                                                     a
                                                                  
                                                                  )
                                                               
                                                               )
                                                            
                                                            ·
                                                            
                                                               u
                                                               
                                                                  X
                                                                  j
                                                               
                                                            
                                                            
                                                               (
                                                               P
                                                               )
                                                            
                                                         
                                                      
                                                   
                                                   
                                                      
                                                      
                                                         <
                                                      
                                                      
                                                         
                                                            
                                                               (
                                                               
                                                                  (
                                                                  M
                                                                  −
                                                                  
                                                                     n
                                                                     3
                                                                  
                                                                  )
                                                               
                                                               +
                                                               
                                                                  u
                                                                  a
                                                               
                                                               
                                                                  (
                                                                  
                                                                     R
                                                                     a
                                                                  
                                                                  )
                                                               
                                                               )
                                                            
                                                            ·
                                                            
                                                               (
                                                               
                                                                  (
                                                                  M
                                                                  −
                                                                  
                                                                     n
                                                                     3
                                                                  
                                                                  )
                                                               
                                                               +
                                                               
                                                                  u
                                                                  
                                                                     X
                                                                     j
                                                                  
                                                               
                                                               
                                                                  (
                                                                  P
                                                                  )
                                                               
                                                               )
                                                            
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    

If 
                                          
                                             a
                                             =
                                             
                                                H
                                                j
                                             
                                          
                                        handling xj
                                        over also improves the Nash product – this is proven by showing that

                                          
                                             (19)
                                             
                                                
                                                   
                                                      u
                                                      
                                                         H
                                                         j
                                                      
                                                   
                                                   
                                                      (
                                                      P
                                                      )
                                                   
                                                   ·
                                                   
                                                      u
                                                      
                                                         X
                                                         j
                                                      
                                                   
                                                   
                                                      (
                                                      P
                                                      )
                                                   
                                                   <
                                                   
                                                      (
                                                      M
                                                      −
                                                      
                                                         n
                                                         3
                                                      
                                                      
                                                         +
                                                         1
                                                         )
                                                         +
                                                      
                                                      
                                                         u
                                                         a
                                                      
                                                      
                                                         (
                                                         
                                                            R
                                                            a
                                                         
                                                         )
                                                      
                                                      )
                                                   
                                                   ·
                                                   
                                                      (
                                                      
                                                         (
                                                         M
                                                         −
                                                         
                                                            n
                                                            3
                                                         
                                                         )
                                                      
                                                      +
                                                      
                                                         u
                                                         
                                                            X
                                                            j
                                                         
                                                      
                                                      
                                                         (
                                                         P
                                                         )
                                                      
                                                      )
                                                   
                                                
                                             
                                          
                                       holds. Clearly, 
                                          
                                             
                                                u
                                                
                                                   H
                                                   j
                                                
                                             
                                             
                                                (
                                                P
                                                )
                                             
                                             ·
                                             
                                                u
                                                
                                                   X
                                                   j
                                                
                                             
                                             
                                                (
                                                P
                                                )
                                             
                                             <
                                             
                                                (
                                                2
                                                M
                                                +
                                                
                                                   u
                                                   a
                                                
                                                
                                                   (
                                                   
                                                      R
                                                      a
                                                   
                                                   )
                                                
                                                )
                                             
                                             ·
                                             
                                                u
                                                
                                                   X
                                                   j
                                                
                                             
                                             
                                                (
                                                P
                                                )
                                             
                                          
                                        holds. However,

                                          
                                             
                                                
                                                   
                                                      
                                                      
                                                      
                                                         
                                                            
                                                               (
                                                               2
                                                               M
                                                               +
                                                               
                                                                  u
                                                                  a
                                                               
                                                               
                                                                  (
                                                                  
                                                                     R
                                                                     a
                                                                  
                                                                  )
                                                               
                                                               )
                                                            
                                                            ·
                                                            
                                                               u
                                                               
                                                                  X
                                                                  j
                                                               
                                                            
                                                            
                                                               (
                                                               P
                                                               )
                                                            
                                                         
                                                      
                                                   
                                                   
                                                      
                                                      
                                                      
                                                         
                                                            
                                                            <
                                                            
                                                               (
                                                               
                                                                  (
                                                                  M
                                                                  −
                                                                  
                                                                     n
                                                                     3
                                                                  
                                                                  +
                                                                  1
                                                                  )
                                                               
                                                               +
                                                               
                                                                  u
                                                                  a
                                                               
                                                               
                                                                  (
                                                                  
                                                                     R
                                                                     a
                                                                  
                                                                  )
                                                               
                                                               )
                                                            
                                                            ·
                                                            
                                                               (
                                                               
                                                                  (
                                                                  M
                                                                  −
                                                                  
                                                                     n
                                                                     3
                                                                  
                                                                  )
                                                               
                                                               +
                                                               
                                                                  u
                                                                  
                                                                     X
                                                                     j
                                                                  
                                                               
                                                               
                                                                  (
                                                                  P
                                                                  )
                                                               
                                                               )
                                                            
                                                         
                                                      
                                                   
                                                   
                                                      
                                                      
                                                      
                                                         
                                                            
                                                            ⇔
                                                            2
                                                            M
                                                            ·
                                                            
                                                               u
                                                               
                                                                  X
                                                                  j
                                                               
                                                            
                                                            
                                                               (
                                                               P
                                                               )
                                                            
                                                            <
                                                            
                                                               (
                                                               M
                                                               −
                                                               
                                                                  n
                                                                  3
                                                               
                                                               +
                                                               1
                                                               )
                                                            
                                                            
                                                               [
                                                               
                                                                  (
                                                                  M
                                                                  −
                                                                  
                                                                     n
                                                                     3
                                                                  
                                                                  )
                                                               
                                                               +
                                                               
                                                                  u
                                                                  
                                                                     X
                                                                     j
                                                                  
                                                               
                                                               
                                                                  (
                                                                  P
                                                                  )
                                                               
                                                               ]
                                                            
                                                         
                                                      
                                                   
                                                   
                                                      
                                                      
                                                      
                                                         
                                                            
                                                            +
                                                            
                                                               u
                                                               a
                                                            
                                                            
                                                               (
                                                               
                                                                  R
                                                                  a
                                                               
                                                               )
                                                            
                                                            ·
                                                            
                                                               (
                                                               M
                                                               −
                                                               
                                                                  n
                                                                  3
                                                               
                                                               )
                                                            
                                                         
                                                      
                                                   
                                                   
                                                      
                                                      
                                                      
                                                         
                                                            
                                                            ⇔
                                                            
                                                               u
                                                               
                                                                  X
                                                                  j
                                                               
                                                            
                                                            
                                                               (
                                                               P
                                                               )
                                                            
                                                            
                                                               (
                                                               M
                                                               +
                                                               
                                                                  n
                                                                  3
                                                               
                                                               −
                                                               1
                                                               )
                                                            
                                                            <
                                                            
                                                               (
                                                               M
                                                               −
                                                               
                                                                  n
                                                                  3
                                                               
                                                               +
                                                               1
                                                               )
                                                            
                                                            
                                                               (
                                                               M
                                                               −
                                                               
                                                                  n
                                                                  3
                                                               
                                                               )
                                                            
                                                         
                                                      
                                                   
                                                   
                                                      
                                                      
                                                      
                                                         
                                                            
                                                            +
                                                            
                                                               u
                                                               a
                                                            
                                                            
                                                               (
                                                               
                                                                  R
                                                                  a
                                                               
                                                               )
                                                            
                                                            ·
                                                            
                                                               (
                                                               M
                                                               −
                                                               
                                                                  n
                                                                  3
                                                               
                                                               )
                                                            
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                       With (19), the last inequality follows, since

                                          
                                             
                                                
                                                   
                                                      
                                                         
                                                            
                                                               u
                                                               
                                                                  X
                                                                  j
                                                               
                                                            
                                                            
                                                               (
                                                               P
                                                               )
                                                            
                                                            
                                                               (
                                                               M
                                                               +
                                                               
                                                                  n
                                                                  3
                                                               
                                                               −
                                                               1
                                                               )
                                                            
                                                         
                                                      
                                                      
                                                         <
                                                      
                                                      
                                                         
                                                            
                                                               [
                                                               
                                                                  1
                                                                  2
                                                               
                                                               
                                                                  (
                                                                  M
                                                                  −
                                                                  
                                                                     n
                                                                     3
                                                                  
                                                                  )
                                                               
                                                               +
                                                               
                                                                  n
                                                                  3
                                                               
                                                               ]
                                                            
                                                            
                                                               (
                                                               M
                                                               +
                                                               
                                                                  n
                                                                  3
                                                               
                                                               −
                                                               1
                                                               )
                                                            
                                                         
                                                      
                                                   
                                                   
                                                      
                                                      
                                                         <
                                                      
                                                      
                                                         
                                                            
                                                               1
                                                               2
                                                            
                                                            
                                                               (
                                                               
                                                                  M
                                                                  2
                                                               
                                                               −
                                                               
                                                                  
                                                                     n
                                                                     2
                                                                  
                                                                  9
                                                               
                                                               )
                                                            
                                                            +
                                                            
                                                               n
                                                               3
                                                            
                                                            M
                                                            +
                                                            
                                                               n
                                                               3
                                                            
                                                         
                                                      
                                                   
                                                   
                                                      
                                                      
                                                         <
                                                      
                                                      
                                                         
                                                            50
                                                            
                                                               n
                                                               20
                                                            
                                                            +
                                                            
                                                               n
                                                               13
                                                            
                                                         
                                                      
                                                   
                                                   
                                                      
                                                      
                                                         <
                                                      
                                                      
                                                         
                                                            100
                                                            
                                                               n
                                                               20
                                                            
                                                            −
                                                            
                                                               20
                                                               3
                                                            
                                                            
                                                               n
                                                               11
                                                            
                                                         
                                                      
                                                   
                                                   
                                                      
                                                      
                                                         <
                                                      
                                                      
                                                         
                                                            
                                                               (
                                                               M
                                                               −
                                                               
                                                                  n
                                                                  3
                                                               
                                                               +
                                                               1
                                                               )
                                                            
                                                            
                                                               (
                                                               M
                                                               −
                                                               
                                                                  n
                                                                  3
                                                               
                                                               )
                                                            
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    


                                       Case 3.
                                       
                                          
                                             a
                                             ∈
                                             X
                                             ∖
                                             
                                                X
                                                j
                                             
                                          
                                       . If 
                                          
                                             
                                                u
                                                
                                                   X
                                                   j
                                                
                                             
                                             
                                                (
                                                P
                                                )
                                             
                                             ≤
                                             
                                                n
                                                3
                                             
                                             ,
                                          
                                        then a hands xj
                                        to Xj
                                       , and Xj
                                        in turn hands an arbitrary item to a. This augments the Nash product, since

                                          
                                             
                                                
                                                   
                                                      
                                                         
                                                            
                                                               u
                                                               a
                                                            
                                                            
                                                               (
                                                               P
                                                               )
                                                            
                                                            ·
                                                            
                                                               u
                                                               
                                                                  X
                                                                  j
                                                               
                                                            
                                                            
                                                               (
                                                               P
                                                               )
                                                            
                                                         
                                                      
                                                      
                                                         ≤
                                                      
                                                      
                                                         
                                                            
                                                               (
                                                               
                                                                  (
                                                                  5
                                                                  n
                                                                  +
                                                                  
                                                                     n
                                                                     3
                                                                  
                                                                  )
                                                               
                                                               +
                                                               
                                                                  u
                                                                  a
                                                               
                                                               
                                                                  (
                                                                  
                                                                     R
                                                                     a
                                                                  
                                                                  )
                                                               
                                                               )
                                                            
                                                            ·
                                                            
                                                               u
                                                               
                                                                  X
                                                                  j
                                                               
                                                            
                                                            
                                                               (
                                                               P
                                                               )
                                                            
                                                         
                                                      
                                                   
                                                   
                                                      
                                                      
                                                         ≤
                                                      
                                                      
                                                         
                                                            
                                                               (
                                                               
                                                                  u
                                                                  a
                                                               
                                                               
                                                                  (
                                                                  
                                                                     R
                                                                     a
                                                                  
                                                                  )
                                                               
                                                               +
                                                               1
                                                               )
                                                            
                                                            ·
                                                            
                                                               (
                                                               
                                                                  (
                                                                  M
                                                                  −
                                                                  
                                                                     n
                                                                     3
                                                                  
                                                                  )
                                                               
                                                               +
                                                               
                                                                  u
                                                                  
                                                                     X
                                                                     j
                                                                  
                                                               
                                                               
                                                                  (
                                                                  P
                                                                  )
                                                               
                                                               )
                                                            
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    

If 
                                          
                                             
                                                u
                                                
                                                   X
                                                   j
                                                
                                             
                                             
                                                (
                                                P
                                                )
                                             
                                             >
                                             
                                                n
                                                3
                                             
                                             ,
                                          
                                        
                                       P allocates at least one of {x
                                       
                                          j, 1, x
                                       
                                          j, 2, x
                                       
                                          j, 3} to Xj
                                       . In this case, we handle them over to a in exchange for xj
                                       .

If 
                                          
                                             
                                                |
                                             
                                             
                                                {
                                                
                                                   x
                                                   
                                                      j
                                                      ,
                                                      1
                                                   
                                                
                                                ,
                                                
                                                   x
                                                   
                                                      j
                                                      ,
                                                      2
                                                   
                                                
                                                ,
                                                
                                                   x
                                                   
                                                      j
                                                      ,
                                                      3
                                                   
                                                
                                                }
                                             
                                             ∩
                                             P
                                             
                                                (
                                                
                                                   X
                                                   j
                                                
                                                )
                                             
                                             
                                                |
                                                =
                                                1
                                                ,
                                             
                                          
                                        we get

                                          
                                             
                                                
                                                   
                                                      
                                                         
                                                            
                                                               u
                                                               a
                                                            
                                                            
                                                               (
                                                               P
                                                               )
                                                            
                                                            ·
                                                            
                                                               u
                                                               
                                                                  X
                                                                  j
                                                               
                                                            
                                                            
                                                               (
                                                               P
                                                               )
                                                            
                                                         
                                                      
                                                      
                                                         <
                                                      
                                                      
                                                         
                                                            
                                                               (
                                                               
                                                                  (
                                                                  5
                                                                  n
                                                                  +
                                                                  
                                                                     n
                                                                     3
                                                                  
                                                                  )
                                                               
                                                               +
                                                               
                                                                  u
                                                                  a
                                                               
                                                               
                                                                  (
                                                                  
                                                                     R
                                                                     a
                                                                  
                                                                  )
                                                               
                                                               )
                                                            
                                                            ·
                                                            
                                                               (
                                                               
                                                                  1
                                                                  6
                                                               
                                                               
                                                                  (
                                                                  M
                                                                  −
                                                                  
                                                                     n
                                                                     3
                                                                  
                                                                  )
                                                               
                                                               +
                                                               
                                                                  n
                                                                  3
                                                               
                                                               )
                                                            
                                                         
                                                      
                                                   
                                                   
                                                      
                                                      
                                                         ≤
                                                      
                                                      
                                                         
                                                            
                                                               (
                                                               n
                                                               +
                                                               
                                                                  n
                                                                  3
                                                               
                                                               +
                                                               1
                                                               )
                                                            
                                                            +
                                                            
                                                               u
                                                               a
                                                            
                                                            
                                                               (
                                                               
                                                                  R
                                                                  a
                                                               
                                                               )
                                                            
                                                            ·
                                                            
                                                               (
                                                               M
                                                               −
                                                               
                                                                  n
                                                                  3
                                                               
                                                               )
                                                            
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    

If 
                                          
                                             
                                                |
                                             
                                             
                                                {
                                                
                                                   x
                                                   
                                                      j
                                                      ,
                                                      1
                                                   
                                                
                                                ,
                                                
                                                   x
                                                   
                                                      j
                                                      ,
                                                      2
                                                   
                                                
                                                ,
                                                
                                                   x
                                                   
                                                      j
                                                      ,
                                                      3
                                                   
                                                
                                                }
                                             
                                             ∩
                                             P
                                             
                                                (
                                                
                                                   X
                                                   j
                                                
                                                )
                                             
                                             
                                                |
                                                =
                                                2
                                                ,
                                             
                                          
                                        we get

                                          
                                             
                                                
                                                   
                                                      
                                                         
                                                            
                                                               u
                                                               a
                                                            
                                                            
                                                               (
                                                               P
                                                               )
                                                            
                                                            ·
                                                            
                                                               u
                                                               
                                                                  X
                                                                  j
                                                               
                                                            
                                                            
                                                               (
                                                               P
                                                               )
                                                            
                                                         
                                                      
                                                      
                                                         <
                                                      
                                                      
                                                         
                                                            
                                                               (
                                                               
                                                                  (
                                                                  5
                                                                  n
                                                                  +
                                                                  
                                                                     n
                                                                     3
                                                                  
                                                                  )
                                                               
                                                               +
                                                               
                                                                  u
                                                                  a
                                                               
                                                               
                                                                  (
                                                                  
                                                                     R
                                                                     a
                                                                  
                                                                  )
                                                               
                                                               )
                                                            
                                                            ·
                                                            
                                                               (
                                                               
                                                                  2
                                                                  6
                                                               
                                                               
                                                                  (
                                                                  M
                                                                  −
                                                                  
                                                                     n
                                                                     3
                                                                  
                                                                  )
                                                               
                                                               +
                                                               
                                                                  n
                                                                  3
                                                               
                                                               )
                                                            
                                                         
                                                      
                                                   
                                                   
                                                      
                                                      
                                                         ≤
                                                      
                                                      
                                                         
                                                            
                                                               (
                                                               2
                                                               ·
                                                               
                                                                  (
                                                                  n
                                                                  +
                                                                  
                                                                     n
                                                                     3
                                                                  
                                                                  +
                                                                  1
                                                                  )
                                                               
                                                               )
                                                            
                                                            +
                                                            
                                                               u
                                                               a
                                                            
                                                            
                                                               (
                                                               
                                                                  R
                                                                  a
                                                               
                                                               )
                                                            
                                                            ·
                                                            
                                                               (
                                                               M
                                                               −
                                                               
                                                                  n
                                                                  3
                                                               
                                                               )
                                                            
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    

If 
                                          
                                             
                                                |
                                             
                                             
                                                {
                                                
                                                   x
                                                   
                                                      j
                                                      ,
                                                      1
                                                   
                                                
                                                ,
                                                
                                                   x
                                                   
                                                      j
                                                      ,
                                                      2
                                                   
                                                
                                                ,
                                                
                                                   x
                                                   
                                                      j
                                                      ,
                                                      3
                                                   
                                                
                                                }
                                             
                                             ∩
                                             P
                                             
                                                (
                                                
                                                   X
                                                   j
                                                
                                                )
                                             
                                             
                                                |
                                                =
                                                3
                                                ,
                                             
                                          
                                        we get

                                          
                                             
                                                
                                                   
                                                      
                                                         
                                                            
                                                               u
                                                               a
                                                            
                                                            
                                                               (
                                                               P
                                                               )
                                                            
                                                            ·
                                                            
                                                               u
                                                               
                                                                  X
                                                                  j
                                                               
                                                            
                                                            
                                                               (
                                                               P
                                                               )
                                                            
                                                         
                                                      
                                                      
                                                         <
                                                      
                                                      
                                                         
                                                            
                                                               (
                                                               
                                                                  (
                                                                  5
                                                                  n
                                                                  +
                                                                  
                                                                     n
                                                                     3
                                                                  
                                                                  )
                                                               
                                                               +
                                                               
                                                                  u
                                                                  a
                                                               
                                                               
                                                                  (
                                                                  
                                                                     R
                                                                     a
                                                                  
                                                                  )
                                                               
                                                               )
                                                            
                                                            ·
                                                            
                                                               (
                                                               
                                                                  1
                                                                  2
                                                               
                                                               
                                                                  (
                                                                  M
                                                                  −
                                                                  
                                                                     n
                                                                     3
                                                                  
                                                                  )
                                                               
                                                               +
                                                               
                                                                  n
                                                                  3
                                                               
                                                               )
                                                            
                                                         
                                                      
                                                   
                                                   
                                                      
                                                      
                                                         ≤
                                                      
                                                      
                                                         
                                                            
                                                               (
                                                               3
                                                               ·
                                                               
                                                                  (
                                                                  n
                                                                  +
                                                                  
                                                                     n
                                                                     3
                                                                  
                                                                  +
                                                                  1
                                                                  )
                                                               
                                                               )
                                                            
                                                            +
                                                            
                                                               u
                                                               a
                                                            
                                                            
                                                               (
                                                               
                                                                  R
                                                                  a
                                                               
                                                               )
                                                            
                                                            ·
                                                            
                                                               (
                                                               M
                                                               −
                                                               
                                                                  n
                                                                  3
                                                               
                                                               )
                                                            
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    

Thus, also in the case 
                                          
                                             
                                                u
                                                
                                                   X
                                                   j
                                                
                                             
                                             
                                                (
                                                P
                                                )
                                             
                                             >
                                             
                                                n
                                                3
                                             
                                             ,
                                          
                                        exchanging items yields an allocation with a higher Nash product.□


                                       All items from Y are allocated to agents from
                                       
                                          
                                             X
                                             ∪
                                             C
                                          
                                       
                                       .
                                    

Assume that some x
                                       
                                          i, j
                                        is allocated to an agent a from 
                                          
                                             H
                                             ∪
                                             L
                                          
                                       . We handle x
                                       
                                          i, j
                                        over to Xi
                                        and get:

                                          
                                             
                                                
                                                   
                                                      
                                                         
                                                            
                                                               u
                                                               a
                                                            
                                                            
                                                               (
                                                               P
                                                               )
                                                            
                                                            ·
                                                            
                                                               u
                                                               
                                                                  X
                                                                  i
                                                               
                                                            
                                                            
                                                               (
                                                               P
                                                               )
                                                            
                                                         
                                                      
                                                      
                                                         ≤
                                                      
                                                      
                                                         
                                                            
                                                               (
                                                               
                                                                  (
                                                                  4
                                                                  n
                                                                  +
                                                                  
                                                                     n
                                                                     3
                                                                  
                                                                  )
                                                               
                                                               +
                                                               
                                                                  u
                                                                  a
                                                               
                                                               
                                                                  (
                                                                  
                                                                     R
                                                                     a
                                                                  
                                                                  )
                                                               
                                                               )
                                                            
                                                            ·
                                                            
                                                               u
                                                               
                                                                  X
                                                                  i
                                                               
                                                            
                                                            
                                                               (
                                                               P
                                                               )
                                                            
                                                         
                                                      
                                                   
                                                   
                                                      
                                                      
                                                         ≤
                                                      
                                                      
                                                         
                                                            
                                                               u
                                                               a
                                                            
                                                            
                                                               (
                                                               
                                                                  R
                                                                  a
                                                               
                                                               )
                                                            
                                                            ·
                                                            
                                                               (
                                                               
                                                                  u
                                                                  
                                                                     X
                                                                     i
                                                                  
                                                               
                                                               
                                                                  (
                                                                  P
                                                                  )
                                                               
                                                               +
                                                               
                                                                  1
                                                                  6
                                                               
                                                               
                                                                  (
                                                                  M
                                                                  −
                                                                  
                                                                     n
                                                                     3
                                                                  
                                                                  −
                                                                  2
                                                                  )
                                                               
                                                               )
                                                            
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                       The inequality holds since 
                                          
                                             
                                                u
                                                a
                                             
                                             
                                                (
                                                P
                                                )
                                             
                                             ≥
                                             
                                                (
                                                M
                                                −
                                                
                                                   n
                                                   3
                                                
                                                )
                                             
                                          
                                        and 
                                          
                                             
                                                u
                                                
                                                   X
                                                   i
                                                
                                             
                                             
                                                (
                                                P
                                                )
                                             
                                             ≤
                                             
                                                8
                                                6
                                             
                                             
                                                (
                                                M
                                                −
                                                
                                                   n
                                                   3
                                                
                                                )
                                             
                                             +
                                             
                                                n
                                                3
                                             
                                          
                                       .□

 

“⇐”

Recall that 
                                    B
                                  is a “yes”-instance of NPSW-Borda, with an allocation P such that the Nash product social welfare for P is greater or equal to:

                                    
                                       
                                          
                                             
                                                
                                                   
                                                      k
                                                      *
                                                   
                                                
                                                
                                                   =
                                                
                                                
                                                   
                                                      
                                                         M
                                                         ℓ
                                                      
                                                      ·
                                                      
                                                         (
                                                         
                                                            ∏
                                                            
                                                               i
                                                               =
                                                               0
                                                            
                                                            
                                                               
                                                                  n
                                                                  3
                                                               
                                                               −
                                                               1
                                                            
                                                         
                                                         
                                                            (
                                                            M
                                                            −
                                                            i
                                                            )
                                                         
                                                         )
                                                      
                                                      ·
                                                      
                                                         
                                                            (
                                                            M
                                                            −
                                                            
                                                               n
                                                               3
                                                            
                                                            )
                                                         
                                                         
                                                            
                                                               2
                                                               n
                                                            
                                                            3
                                                         
                                                      
                                                      ·
                                                      
                                                         
                                                            (
                                                            M
                                                            −
                                                            
                                                               n
                                                               3
                                                            
                                                            )
                                                         
                                                         
                                                            n
                                                            3
                                                         
                                                      
                                                   
                                                
                                             
                                             
                                                
                                                
                                                
                                                   
                                                      ·
                                                      
                                                         
                                                            (
                                                            
                                                               1
                                                               2
                                                            
                                                            
                                                               (
                                                               M
                                                               −
                                                               
                                                                  n
                                                                  3
                                                               
                                                               −
                                                               2
                                                               )
                                                            
                                                            )
                                                         
                                                         
                                                            
                                                               2
                                                               n
                                                            
                                                            3
                                                         
                                                      
                                                      ·
                                                      
                                                         
                                                            (
                                                            
                                                               5
                                                               4
                                                            
                                                            
                                                               (
                                                               M
                                                               −
                                                               9
                                                               
                                                                  n
                                                                  10
                                                               
                                                               −
                                                               2
                                                               )
                                                            
                                                            )
                                                         
                                                         n
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                              

In addition, we can assume that P satisfies the properties 1–6 and is an allocation of maximum Nash product. We will show that the corresponding instance of Cubic Monotone 1-in-3 Sat a “yes”-instance. Due to the six properties, we already know the exact contribution of agents from L and 
                                    H
                                 . Hence, we know that in order to reach a total profit of k the agents from 
                                    X
                                  and C have to contribute to the Nash product a factor of at least

                                    
                                       
                                          
                                             
                                                
                                                   (
                                                   M
                                                   −
                                                   
                                                      n
                                                      3
                                                   
                                                   )
                                                
                                                
                                                   n
                                                   3
                                                
                                             
                                             ·
                                             
                                                
                                                   (
                                                   
                                                      1
                                                      2
                                                   
                                                   
                                                      (
                                                      M
                                                      −
                                                      
                                                         n
                                                         3
                                                      
                                                      −
                                                      2
                                                      )
                                                   
                                                   )
                                                
                                                
                                                   
                                                      2
                                                      n
                                                   
                                                   3
                                                
                                             
                                             ·
                                             
                                                
                                                   (
                                                   
                                                      5
                                                      4
                                                   
                                                   
                                                      (
                                                      M
                                                      −
                                                      9
                                                      
                                                         n
                                                         10
                                                      
                                                      −
                                                      2
                                                      )
                                                   
                                                   )
                                                
                                                n
                                             
                                          
                                       
                                    
                                 
                              

Now, we show that we can assume that P satisfies the following additional properties:

                                    
                                       7.
                                       Each item x
                                          
                                             i, l
                                           is assigned to an agent a with 
                                             
                                                
                                                   u
                                                   a
                                                
                                                
                                                   (
                                                   
                                                      x
                                                      
                                                         i
                                                         ,
                                                         l
                                                      
                                                   
                                                   )
                                                
                                                >
                                                5
                                                n
                                                +
                                                
                                                   n
                                                   3
                                                
                                             
                                          .

If Xi
                                           gets xi
                                          , then Xi
                                           does not get an item of {x
                                          
                                             i, 1, x
                                          
                                             i, 2, x
                                          
                                             i, 3}.

If Xi
                                           does not get xi
                                          , then Xi
                                           gets all three items of {x
                                          
                                             i, 1, x
                                          
                                             i, 2, x
                                          
                                             i, 3}.


                                       Each item x
                                       
                                          i, l
                                        
                                       is allocated to an agent a with
                                       
                                          
                                             
                                                u
                                                a
                                             
                                             
                                                (
                                                
                                                   x
                                                   
                                                      i
                                                      ,
                                                      l
                                                   
                                                
                                                )
                                             
                                             >
                                             4
                                             n
                                             +
                                             
                                                n
                                                3
                                             
                                          
                                       
                                       . Assume the opposite, i.e., for some indices j, l, x
                                       
                                          j, l
                                        is allocated to an agent a with 
                                          
                                             
                                                u
                                                a
                                             
                                             
                                                (
                                                
                                                   x
                                                   
                                                      j
                                                      ,
                                                      l
                                                   
                                                
                                                )
                                             
                                             ≤
                                             4
                                             n
                                             +
                                             
                                                n
                                                3
                                             
                                          
                                       .


                                       Case 1. Assume that an agent Xi
                                        gets such an item x
                                       
                                          j, l
                                        with 
                                          
                                             
                                                u
                                                
                                                   X
                                                   i
                                                
                                             
                                             
                                                (
                                                
                                                   x
                                                   
                                                      j
                                                      ,
                                                      l
                                                   
                                                
                                                )
                                             
                                             ≤
                                             4
                                             n
                                             +
                                             
                                                n
                                                3
                                             
                                          
                                       .

If P(Xi
                                       ) contains another item of Borda score at least 
                                          
                                             
                                                1
                                                6
                                             
                                             
                                                (
                                                M
                                                −
                                                
                                                   n
                                                   3
                                                
                                                −
                                                2
                                                )
                                             
                                             ,
                                          
                                        we handle x
                                       
                                          j, l
                                        over to Xj
                                       :

                                          
                                             
                                                
                                                   
                                                      
                                                         
                                                            
                                                               u
                                                               
                                                                  X
                                                                  j
                                                               
                                                            
                                                            
                                                               (
                                                               P
                                                               )
                                                            
                                                            ·
                                                            
                                                               u
                                                               
                                                                  X
                                                                  i
                                                               
                                                            
                                                            
                                                               (
                                                               P
                                                               )
                                                            
                                                         
                                                      
                                                      
                                                         ≤
                                                      
                                                      
                                                         
                                                            
                                                               u
                                                               
                                                                  X
                                                                  j
                                                               
                                                            
                                                            
                                                               (
                                                               
                                                                  R
                                                                  
                                                                     X
                                                                     j
                                                                  
                                                               
                                                               )
                                                            
                                                            ·
                                                            
                                                               (
                                                               
                                                                  u
                                                                  
                                                                     X
                                                                     i
                                                                  
                                                               
                                                               
                                                                  (
                                                                  
                                                                     R
                                                                     
                                                                        X
                                                                        i
                                                                     
                                                                  
                                                                  )
                                                               
                                                               +
                                                               
                                                                  (
                                                                  4
                                                                  n
                                                                  +
                                                                  
                                                                     n
                                                                     3
                                                                  
                                                                  )
                                                               
                                                               )
                                                            
                                                         
                                                      
                                                   
                                                   
                                                      
                                                      
                                                         ≤
                                                      
                                                      
                                                         
                                                            
                                                               (
                                                               
                                                                  u
                                                                  
                                                                     X
                                                                     j
                                                                  
                                                               
                                                               
                                                                  (
                                                                  
                                                                     R
                                                                     
                                                                        X
                                                                        j
                                                                     
                                                                  
                                                                  )
                                                               
                                                               +
                                                               
                                                                  1
                                                                  6
                                                               
                                                               
                                                                  (
                                                                  M
                                                                  −
                                                                  
                                                                     n
                                                                     3
                                                                  
                                                                  −
                                                                  2
                                                                  )
                                                               
                                                               )
                                                            
                                                            ·
                                                            
                                                               u
                                                               
                                                                  X
                                                                  i
                                                               
                                                            
                                                            
                                                               (
                                                               
                                                                  R
                                                                  
                                                                     X
                                                                     i
                                                                  
                                                               
                                                               )
                                                            
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    

Otherwise, 
                                          
                                             
                                                u
                                                
                                                   X
                                                   i
                                                
                                             
                                             
                                                (
                                                P
                                                )
                                             
                                             <
                                             
                                                n
                                                3
                                             
                                          
                                        and P(Xi
                                       ) contains items x
                                       
                                          j, l
                                        with j ≠ i only. Let a be the agent with x
                                       
                                          i, l
                                        ∈ P(a). If a ∈ C, handling x
                                       
                                          i, l
                                        over to Xi
                                        and x
                                       
                                          j, l
                                        over to Xj
                                        yields a higher Nash product:

                                          
                                             
                                                
                                                   
                                                      
                                                      
                                                      
                                                         
                                                            
                                                               u
                                                               
                                                                  X
                                                                  j
                                                               
                                                            
                                                            
                                                               (
                                                               P
                                                               )
                                                            
                                                            ·
                                                            
                                                               u
                                                               
                                                                  X
                                                                  i
                                                               
                                                            
                                                            
                                                               (
                                                               P
                                                               )
                                                            
                                                            ·
                                                            
                                                               u
                                                               a
                                                            
                                                            
                                                               (
                                                               P
                                                               )
                                                            
                                                         
                                                      
                                                   
                                                   
                                                      
                                                      
                                                      
                                                         
                                                            
                                                            <
                                                            
                                                               u
                                                               
                                                                  X
                                                                  j
                                                               
                                                            
                                                            
                                                               (
                                                               
                                                                  R
                                                                  
                                                                     X
                                                                     j
                                                                  
                                                               
                                                               )
                                                            
                                                            ·
                                                            
                                                               n
                                                               3
                                                            
                                                            ·
                                                            
                                                               (
                                                               
                                                                  u
                                                                  a
                                                               
                                                               
                                                                  (
                                                                  
                                                                     R
                                                                     a
                                                                  
                                                                  )
                                                               
                                                               +
                                                               
                                                                  1
                                                                  4
                                                               
                                                               
                                                                  (
                                                                  M
                                                                  −
                                                                  9
                                                                  
                                                                     n
                                                                     10
                                                                  
                                                                  )
                                                               
                                                               )
                                                            
                                                         
                                                      
                                                   
                                                   
                                                      
                                                      
                                                      
                                                         
                                                            
                                                            ≤
                                                            
                                                               (
                                                               
                                                                  u
                                                                  
                                                                     X
                                                                     j
                                                                  
                                                               
                                                               
                                                                  (
                                                                  
                                                                     R
                                                                     
                                                                        X
                                                                        j
                                                                     
                                                                  
                                                                  )
                                                               
                                                               +
                                                               
                                                                  1
                                                                  6
                                                               
                                                               
                                                                  (
                                                                  M
                                                                  −
                                                                  
                                                                     n
                                                                     3
                                                                  
                                                                  −
                                                                  2
                                                                  )
                                                               
                                                               )
                                                            
                                                            ·
                                                            
                                                               1
                                                               6
                                                            
                                                            
                                                               (
                                                               M
                                                               −
                                                               
                                                                  n
                                                                  3
                                                               
                                                               −
                                                               2
                                                               )
                                                            
                                                            ·
                                                            
                                                               u
                                                               a
                                                            
                                                            
                                                               (
                                                               
                                                                  R
                                                                  a
                                                               
                                                               )
                                                            
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    

Thus, with 6 we can assume that x
                                       
                                          i, l
                                        is allocated to an agent of 
                                          
                                             
                                                X
                                                k
                                             
                                             ∈
                                             X
                                          
                                       . By construction, 
                                          
                                             
                                                u
                                                
                                                   X
                                                   k
                                                
                                             
                                             
                                                (
                                                
                                                   x
                                                   
                                                      i
                                                      ,
                                                      l
                                                   
                                                
                                                )
                                             
                                             ≤
                                             4
                                             n
                                             +
                                             
                                                n
                                                3
                                             
                                          
                                       . Exchanging x
                                       
                                          i, l
                                        with x
                                       
                                          j, l
                                       , we get a higher Nash product social welfare allocation:

                                          
                                             
                                                
                                                   
                                                      
                                                         
                                                            
                                                               u
                                                               
                                                                  X
                                                                  k
                                                               
                                                            
                                                            
                                                               (
                                                               P
                                                               )
                                                            
                                                            ·
                                                            
                                                               u
                                                               
                                                                  X
                                                                  i
                                                               
                                                            
                                                            
                                                               (
                                                               P
                                                               )
                                                            
                                                         
                                                      
                                                      
                                                         <
                                                      
                                                      
                                                         
                                                            
                                                               (
                                                               
                                                                  u
                                                                  
                                                                     X
                                                                     k
                                                                  
                                                               
                                                               
                                                                  (
                                                                  
                                                                     R
                                                                     
                                                                        X
                                                                        k
                                                                     
                                                                  
                                                                  )
                                                               
                                                               +
                                                               
                                                                  (
                                                                  4
                                                                  n
                                                                  +
                                                                  
                                                                     n
                                                                     3
                                                                  
                                                                  )
                                                               
                                                               )
                                                            
                                                            ·
                                                            
                                                               n
                                                               3
                                                            
                                                         
                                                      
                                                   
                                                   
                                                      
                                                      
                                                         <
                                                      
                                                      
                                                         
                                                            
                                                               (
                                                               
                                                                  u
                                                                  
                                                                     X
                                                                     k
                                                                  
                                                               
                                                               
                                                                  (
                                                                  
                                                                     R
                                                                     
                                                                        X
                                                                        k
                                                                     
                                                                  
                                                                  )
                                                               
                                                               +
                                                               1
                                                               )
                                                            
                                                            ·
                                                            
                                                               1
                                                               6
                                                            
                                                            
                                                               (
                                                               M
                                                               −
                                                               
                                                                  n
                                                                  3
                                                               
                                                               −
                                                               2
                                                               )
                                                            
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    


                                       Case 2. Assume that an agent Ck
                                        ∈ C gets assigned such an item x
                                       
                                          j, l
                                        with 
                                          
                                             
                                                u
                                                
                                                   C
                                                   k
                                                
                                             
                                             
                                                (
                                                
                                                   x
                                                   
                                                      j
                                                      ,
                                                      l
                                                   
                                                
                                                )
                                             
                                             ≤
                                             4
                                             n
                                             +
                                             
                                                n
                                                3
                                             
                                          
                                       . We handle x
                                       
                                          j, l
                                        over to an arbitrary agent a ∈ C with 
                                          
                                             
                                                u
                                                a
                                             
                                             
                                                (
                                                
                                                   x
                                                   
                                                      j
                                                      ,
                                                      l
                                                   
                                                
                                                )
                                             
                                             ≥
                                             
                                                1
                                                4
                                             
                                             
                                                (
                                                M
                                                −
                                                9
                                                
                                                   n
                                                   10
                                                
                                                −
                                                2
                                                )
                                             
                                          
                                        (note that by construction such an agent exists). In this way, we get a higher Nash product because

                                          
                                             
                                                
                                                   
                                                      
                                                         
                                                            
                                                               u
                                                               
                                                                  C
                                                                  k
                                                               
                                                            
                                                            
                                                               (
                                                               P
                                                               )
                                                            
                                                            ·
                                                            
                                                               u
                                                               a
                                                            
                                                            
                                                               (
                                                               P
                                                               )
                                                            
                                                         
                                                      
                                                      
                                                         ≤
                                                      
                                                      
                                                         
                                                            
                                                               (
                                                               
                                                                  u
                                                                  
                                                                     C
                                                                     k
                                                                  
                                                               
                                                               
                                                                  (
                                                                  
                                                                     R
                                                                     
                                                                        C
                                                                        k
                                                                     
                                                                  
                                                                  )
                                                               
                                                               +
                                                               
                                                                  (
                                                                  4
                                                                  n
                                                                  +
                                                                  
                                                                     n
                                                                     3
                                                                  
                                                                  +
                                                                  1
                                                                  )
                                                               
                                                               )
                                                            
                                                            ·
                                                            
                                                               u
                                                               a
                                                            
                                                            
                                                               (
                                                               
                                                                  R
                                                                  a
                                                               
                                                               )
                                                            
                                                         
                                                      
                                                   
                                                   
                                                      
                                                      
                                                         <
                                                      
                                                      
                                                         
                                                            
                                                               u
                                                               
                                                                  C
                                                                  k
                                                               
                                                            
                                                            
                                                               (
                                                               
                                                                  R
                                                                  
                                                                     C
                                                                     k
                                                                  
                                                               
                                                               )
                                                            
                                                            ·
                                                            
                                                               (
                                                               
                                                                  u
                                                                  a
                                                               
                                                               
                                                                  (
                                                                  
                                                                     R
                                                                     a
                                                                  
                                                                  )
                                                               
                                                               +
                                                               
                                                                  1
                                                                  4
                                                               
                                                               
                                                                  (
                                                                  M
                                                                  −
                                                                  9
                                                                  
                                                                     n
                                                                     10
                                                                  
                                                                  −
                                                                  2
                                                                  )
                                                               
                                                               )
                                                            
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                       
                                       
                                       
                                       
                                       
                                       
                                       
                                       
                                       
                                       
                                       
                                       
                                       
                                       
                                       
                                       
                                       
                                       
                                       
                                       
                                       
                                       
                                       
                                       
                                       
                                       
                                       □


                                       If Xi gets xi, then Xi does not get an item of {x
                                       
                                          i, 1, x
                                       
                                          i, 2, x
                                       
                                          i, 3}. Assume that Xi
                                        gets both xi
                                        and an item x
                                       
                                          i, l
                                        for some l ∈ {1, 2, 3}. We handle x
                                       
                                          i, l
                                        to an agent a ∈ C with 
                                          
                                             
                                                u
                                                a
                                             
                                             
                                                (
                                                
                                                   x
                                                   
                                                      j
                                                      ,
                                                      l
                                                   
                                                
                                                )
                                             
                                             ≥
                                             
                                                1
                                                4
                                             
                                             
                                                (
                                                M
                                                −
                                                9
                                                
                                                   n
                                                   10
                                                
                                                −
                                                2
                                                )
                                             
                                             ,
                                          
                                        which again implies that an allocation with a higher Nash product exists, since we will argue that the following inequality holds:

                                          
                                             (20)
                                             
                                                
                                                   
                                                      
                                                         
                                                            
                                                               u
                                                               a
                                                            
                                                            
                                                               (
                                                               P
                                                               )
                                                            
                                                            ·
                                                            
                                                               u
                                                               
                                                                  X
                                                                  i
                                                               
                                                            
                                                            
                                                               (
                                                               P
                                                               )
                                                            
                                                         
                                                      
                                                      
                                                         ≤
                                                      
                                                      
                                                         
                                                            
                                                               u
                                                               a
                                                            
                                                            
                                                               (
                                                               
                                                                  R
                                                                  a
                                                               
                                                               )
                                                            
                                                            ·
                                                            
                                                               (
                                                               
                                                                  1
                                                                  6
                                                               
                                                               
                                                                  (
                                                                  M
                                                                  −
                                                                  
                                                                     n
                                                                     3
                                                                  
                                                                  )
                                                               
                                                               +
                                                               
                                                                  u
                                                                  
                                                                     X
                                                                     i
                                                                  
                                                               
                                                               
                                                                  (
                                                                  
                                                                     R
                                                                     
                                                                        X
                                                                        i
                                                                     
                                                                  
                                                                  )
                                                               
                                                               )
                                                            
                                                         
                                                      
                                                   
                                                   
                                                      
                                                      
                                                         ≤
                                                      
                                                      
                                                         
                                                            
                                                               (
                                                               
                                                                  1
                                                                  4
                                                               
                                                               
                                                                  (
                                                                  M
                                                                  −
                                                                  9
                                                                  
                                                                     n
                                                                     10
                                                                  
                                                                  −
                                                                  2
                                                                  )
                                                               
                                                               +
                                                               
                                                                  u
                                                                  a
                                                               
                                                               
                                                                  (
                                                                  
                                                                     R
                                                                     a
                                                                  
                                                                  )
                                                               
                                                               )
                                                            
                                                            ·
                                                            
                                                               u
                                                               
                                                                  X
                                                                  i
                                                               
                                                            
                                                            
                                                               (
                                                               
                                                                  R
                                                                  
                                                                     X
                                                                     i
                                                                  
                                                               
                                                               )
                                                            
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    

Note that (20) holds if 
                                          
                                             
                                                u
                                                a
                                             
                                             
                                                (
                                                
                                                   R
                                                   a
                                                
                                                )
                                             
                                             ·
                                             
                                                1
                                                6
                                             
                                             
                                                (
                                                M
                                                −
                                                
                                                   n
                                                   3
                                                
                                                )
                                             
                                             ≤
                                             
                                                1
                                                4
                                             
                                             
                                                (
                                                M
                                                −
                                                9
                                                
                                                   n
                                                   10
                                                
                                                −
                                                2
                                                )
                                             
                                             ·
                                             
                                                u
                                                
                                                   X
                                                   i
                                                
                                             
                                             
                                                (
                                                
                                                   R
                                                   
                                                      X
                                                      i
                                                   
                                                
                                                )
                                             
                                          
                                       . The latter inequality, however, is clearly satisfied since 
                                          
                                             
                                                u
                                                
                                                   X
                                                   i
                                                
                                             
                                             
                                                (
                                                
                                                   R
                                                   
                                                      X
                                                      i
                                                   
                                                
                                                )
                                             
                                             ≥
                                             
                                                (
                                                M
                                                −
                                                
                                                   n
                                                   3
                                                
                                                )
                                             
                                          
                                        and 
                                          
                                             
                                                u
                                                a
                                             
                                             
                                                (
                                                
                                                   R
                                                   a
                                                
                                                )
                                             
                                             <
                                             
                                                3
                                                2
                                             
                                             
                                                (
                                                M
                                                −
                                                9
                                                
                                                   n
                                                   10
                                                
                                                −
                                                2
                                                )
                                             
                                          
                                        hold.□


                                       If Xi does not get xi, then Xi gets all three items of {x
                                       
                                          i, 1, x
                                       
                                          i, 2, x
                                       
                                          i, 3}.
                                    

Assume that Xi
                                        does not get xi
                                       . In addition, assume that Xi
                                        does not have all items of {x
                                       
                                          i, 1, x
                                       
                                          i, 2, x
                                       
                                          i, 3}. With 6 and 7, it follows that there is an agent Ck
                                        ∈ C who has at least one such item x
                                       
                                          i, l
                                       . Again from 7 we can conclude that 
                                          
                                             
                                                u
                                                
                                                   C
                                                   k
                                                
                                             
                                             
                                                (
                                                
                                                   x
                                                   
                                                      i
                                                      ,
                                                      l
                                                   
                                                
                                                )
                                             
                                             ≥
                                             
                                                1
                                                4
                                             
                                             
                                                (
                                                M
                                                −
                                                9
                                                
                                                   n
                                                   10
                                                
                                                )
                                             
                                             −
                                             2
                                          
                                        holds. We handle it over to Xi
                                        and have to distinguish a few cases:


                                       Case 1. 
                                       Xi
                                        has none of the items {x
                                       
                                          i, 1, x
                                       
                                          i, 2, x
                                       
                                          i, 3}. It follows that Xi
                                        has no items at all, and thus 
                                          
                                             
                                                ∏
                                                
                                                   a
                                                   ∈
                                                   A
                                                
                                             
                                             
                                                u
                                                a
                                             
                                             
                                                (
                                                P
                                                )
                                             
                                             =
                                             0
                                          
                                        holds, in contradiction with ∏
                                          a ∈ A
                                       
                                       ua
                                       (P) ≥ k
                                       *.


                                       Case 2. 
                                       Xi
                                        has one of the items x
                                       
                                          i, j
                                        and Ck
                                        has only its item from E and x
                                       
                                          i, l
                                       :

                                          
                                             
                                                
                                                   
                                                      
                                                         
                                                            
                                                               u
                                                               
                                                                  C
                                                                  k
                                                               
                                                            
                                                            
                                                               (
                                                               P
                                                               )
                                                            
                                                            ·
                                                            
                                                               u
                                                               
                                                                  X
                                                                  i
                                                               
                                                            
                                                            
                                                               (
                                                               P
                                                               )
                                                            
                                                         
                                                      
                                                      
                                                         ≤
                                                      
                                                      
                                                         
                                                            
                                                               5
                                                               4
                                                            
                                                            
                                                               (
                                                               M
                                                               −
                                                               9
                                                               
                                                                  n
                                                                  10
                                                               
                                                               )
                                                            
                                                            ·
                                                            
                                                               1
                                                               6
                                                            
                                                            
                                                               (
                                                               M
                                                               −
                                                               
                                                                  n
                                                                  3
                                                               
                                                               )
                                                            
                                                         
                                                      
                                                   
                                                   
                                                      
                                                      
                                                         ≤
                                                      
                                                      
                                                         
                                                            
                                                               (
                                                               M
                                                               −
                                                               9
                                                               
                                                                  n
                                                                  10
                                                               
                                                               )
                                                            
                                                            ·
                                                            
                                                               2
                                                               6
                                                            
                                                            
                                                               (
                                                               M
                                                               −
                                                               
                                                                  n
                                                                  3
                                                               
                                                               −
                                                               3
                                                               )
                                                            
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    


                                       Case 3. 
                                       Xi
                                        has one of the items x
                                       
                                          i, j
                                        and Ck
                                        has its item from E, x
                                       
                                          i, l
                                        and exactly one item c ∈ {c
                                       
                                          k, 1, c
                                       
                                          k, 2, c
                                       
                                          k, 3}, 
                                          
                                             c
                                             ≠
                                             
                                                x
                                                
                                                   i
                                                   ,
                                                   l
                                                
                                             
                                          
                                       :

                                          
                                             
                                                
                                                   
                                                      
                                                         
                                                            
                                                               u
                                                               
                                                                  C
                                                                  k
                                                               
                                                            
                                                            
                                                               (
                                                               P
                                                               )
                                                            
                                                            ·
                                                            
                                                               u
                                                               
                                                                  X
                                                                  i
                                                               
                                                            
                                                            
                                                               (
                                                               P
                                                               )
                                                            
                                                         
                                                      
                                                      
                                                         ≤
                                                      
                                                      
                                                         
                                                            
                                                               6
                                                               4
                                                            
                                                            
                                                               (
                                                               M
                                                               −
                                                               9
                                                               
                                                                  n
                                                                  10
                                                               
                                                               )
                                                            
                                                            ·
                                                            
                                                               1
                                                               6
                                                            
                                                            
                                                               (
                                                               M
                                                               −
                                                               
                                                                  n
                                                                  3
                                                               
                                                               )
                                                            
                                                         
                                                      
                                                   
                                                   
                                                      
                                                      
                                                         ≤
                                                      
                                                      
                                                         
                                                            
                                                               5
                                                               4
                                                            
                                                            
                                                               (
                                                               M
                                                               −
                                                               9
                                                               
                                                                  n
                                                                  10
                                                               
                                                               )
                                                            
                                                            ·
                                                            
                                                               2
                                                               6
                                                            
                                                            
                                                               (
                                                               M
                                                               −
                                                               
                                                                  n
                                                                  3
                                                               
                                                               −
                                                               32
                                                               )
                                                            
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    


                                       Case 4. 
                                       Xi
                                        has one of the items x
                                       
                                          i, j
                                        and Ck
                                        has its item from E, x
                                       
                                          i, l
                                        and exactly two of the items {c
                                       
                                          k, 1, c
                                       
                                          k, 2, c
                                       
                                          k, 3}∖{x
                                       
                                          i, l
                                       }:

                                          
                                             
                                                
                                                   
                                                      
                                                         
                                                            
                                                               u
                                                               
                                                                  C
                                                                  k
                                                               
                                                            
                                                            
                                                               (
                                                               P
                                                               )
                                                            
                                                            ·
                                                            
                                                               u
                                                               
                                                                  X
                                                                  i
                                                               
                                                            
                                                            
                                                               (
                                                               P
                                                               )
                                                            
                                                         
                                                      
                                                      
                                                         ≤
                                                      
                                                      
                                                         
                                                            
                                                               7
                                                               4
                                                            
                                                            
                                                               (
                                                               M
                                                               −
                                                               9
                                                               
                                                                  n
                                                                  10
                                                               
                                                               )
                                                            
                                                            ·
                                                            
                                                               1
                                                               6
                                                            
                                                            
                                                               (
                                                               M
                                                               −
                                                               
                                                                  n
                                                                  3
                                                               
                                                               )
                                                            
                                                         
                                                      
                                                   
                                                   
                                                      
                                                      
                                                         ≤
                                                      
                                                      
                                                         
                                                            
                                                               6
                                                               4
                                                            
                                                            
                                                               (
                                                               M
                                                               −
                                                               9
                                                               
                                                                  n
                                                                  10
                                                               
                                                               )
                                                            
                                                            ·
                                                            
                                                               2
                                                               6
                                                            
                                                            
                                                               (
                                                               M
                                                               −
                                                               
                                                                  n
                                                                  3
                                                               
                                                               −
                                                               3
                                                               )
                                                            
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    


                                       Case 5. 
                                       Xi
                                        has two of the items x
                                       
                                          i, j
                                        and Ck
                                        has only its item from E and x
                                       
                                          i, l
                                       :

                                          
                                             
                                                
                                                   
                                                      
                                                         
                                                            
                                                               u
                                                               
                                                                  C
                                                                  k
                                                               
                                                            
                                                            
                                                               (
                                                               P
                                                               )
                                                            
                                                            ·
                                                            
                                                               u
                                                               
                                                                  X
                                                                  i
                                                               
                                                            
                                                            
                                                               (
                                                               P
                                                               )
                                                            
                                                         
                                                      
                                                      
                                                         ≤
                                                      
                                                      
                                                         
                                                            
                                                               5
                                                               4
                                                            
                                                            
                                                               (
                                                               M
                                                               −
                                                               9
                                                               
                                                                  n
                                                                  10
                                                               
                                                               )
                                                            
                                                            ·
                                                            
                                                               2
                                                               6
                                                            
                                                            
                                                               (
                                                               M
                                                               −
                                                               
                                                                  n
                                                                  3
                                                               
                                                               )
                                                            
                                                         
                                                      
                                                   
                                                   
                                                      
                                                      
                                                         ≤
                                                      
                                                      
                                                         
                                                            
                                                               (
                                                               M
                                                               −
                                                               9
                                                               
                                                                  n
                                                                  10
                                                               
                                                               )
                                                            
                                                            ·
                                                            
                                                               1
                                                               2
                                                            
                                                            
                                                               (
                                                               M
                                                               −
                                                               
                                                                  n
                                                                  3
                                                               
                                                               −
                                                               3
                                                               )
                                                            
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    


                                       Case 6. 
                                       Xi
                                        has two of the items x
                                       
                                          i, j
                                        and Ck
                                        has its item from E, x
                                       
                                          i, l
                                        and exactly one item of {c
                                       
                                          k, 1, c
                                       
                                          k, 2, c
                                       
                                          k, 3}∖{x
                                       
                                          i, l
                                       }:

                                          
                                             
                                                
                                                   
                                                      
                                                         
                                                            
                                                               u
                                                               
                                                                  C
                                                                  k
                                                               
                                                            
                                                            
                                                               (
                                                               P
                                                               )
                                                            
                                                            ·
                                                            
                                                               u
                                                               
                                                                  X
                                                                  i
                                                               
                                                            
                                                            
                                                               (
                                                               P
                                                               )
                                                            
                                                         
                                                      
                                                      
                                                         ≤
                                                      
                                                      
                                                         
                                                            
                                                               6
                                                               4
                                                            
                                                            
                                                               (
                                                               M
                                                               −
                                                               9
                                                               
                                                                  n
                                                                  10
                                                               
                                                               )
                                                            
                                                            ·
                                                            
                                                               2
                                                               6
                                                            
                                                            
                                                               (
                                                               M
                                                               −
                                                               
                                                                  n
                                                                  3
                                                               
                                                               )
                                                            
                                                         
                                                      
                                                   
                                                   
                                                      
                                                      
                                                         ≤
                                                      
                                                      
                                                         
                                                            
                                                               5
                                                               4
                                                            
                                                            
                                                               (
                                                               M
                                                               −
                                                               9
                                                               
                                                                  n
                                                                  10
                                                               
                                                               )
                                                            
                                                            ·
                                                            
                                                               1
                                                               2
                                                            
                                                            
                                                               (
                                                               M
                                                               −
                                                               
                                                                  n
                                                                  3
                                                               
                                                               −
                                                               3
                                                               )
                                                            
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    


                                       Case 7. 
                                       Xi
                                        has two of the items x
                                       
                                          i, j
                                        and Ck
                                        has its item from E, x
                                       
                                          i, l
                                        and exactly two items of {c
                                       
                                          k, 1, c
                                       
                                          k, 2, c
                                       
                                          k, 3}∖{x
                                       
                                          i, l
                                       }:

                                          
                                             
                                                
                                                   
                                                      
                                                         
                                                            
                                                               u
                                                               
                                                                  C
                                                                  k
                                                               
                                                            
                                                            
                                                               (
                                                               P
                                                               )
                                                            
                                                            ·
                                                            
                                                               u
                                                               
                                                                  X
                                                                  i
                                                               
                                                            
                                                            
                                                               (
                                                               P
                                                               )
                                                            
                                                         
                                                      
                                                      
                                                         ≤
                                                      
                                                      
                                                         
                                                            
                                                               7
                                                               4
                                                            
                                                            
                                                               (
                                                               M
                                                               −
                                                               9
                                                               
                                                                  n
                                                                  10
                                                               
                                                               )
                                                            
                                                            ·
                                                            
                                                               2
                                                               6
                                                            
                                                            
                                                               (
                                                               M
                                                               −
                                                               
                                                                  n
                                                                  3
                                                               
                                                               )
                                                            
                                                         
                                                      
                                                   
                                                   
                                                      
                                                      
                                                         ≤
                                                      
                                                      
                                                         
                                                            
                                                               6
                                                               4
                                                            
                                                            
                                                               (
                                                               M
                                                               −
                                                               9
                                                               
                                                                  n
                                                                  10
                                                               
                                                               )
                                                            
                                                            ·
                                                            
                                                               1
                                                               2
                                                            
                                                            
                                                               (
                                                               M
                                                               −
                                                               
                                                                  n
                                                                  3
                                                               
                                                               −
                                                               3
                                                               )
                                                            
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                       
                                       
                                       
                                       
                                       
                                       
                                       
                                       
                                       
                                       
                                       
                                       
                                       
                                       
                                       
                                       
                                       
                                       
                                       
                                       
                                       
                                       
                                       
                                       
                                       
                                       
                                       □

But now we also know the exact contribution of the agent set 
                                          X
                                        to the Nash product. By the pigeonhole principle, we know that exactly n of the items of Y are still available for agents from C. The agents of C have to contribute a factor of at least 
                                          
                                             
                                                (
                                                
                                                   5
                                                   4
                                                
                                                
                                                   (
                                                   M
                                                   −
                                                   9
                                                   
                                                      n
                                                      10
                                                   
                                                   −
                                                   2
                                                   )
                                                
                                                )
                                             
                                             n
                                          
                                        in order to enable that ∏
                                          a ∈ A
                                       
                                       ua
                                       (P) ≥ k
                                       * holds. But this means that every agent Ci
                                        ∈ C has to get exactly one of the items {c
                                       
                                          i, 1, c
                                       
                                          i, 2, c
                                       
                                          i, 3}, since otherwise the required profit cannot be contributed.

“⇒” This direction is straightforward.□

@&#CONCLUSION@&#

When indivisible items are to be allocated to agents, a major task is to allocate them in such a way that social welfare is maximized. In this respect three notions of social welfare are of particular interest: utilitarian social welfare, egalitarian social welfare, and Nash product social welfare. For each notion of social welfare, a central question is the computational complexity involved in finding an allocation that maximizes social welfare.

Clearly, maximizing social welfare is an easy task for the utilitarian approach. However, the problem is known to be computationally hard for egalitarian social welfare under the use of classical scores such as Borda and lexicographic scores already (Baumeister et al., 2013); on the positive side, an allocation maximizing egalitarian social welfare can be found in polynomial time for approval scores (Golovin, 2005).

In this paper we have analyzed the computational complexity involved in allocating indivisible items to agents in order to maximize Nash product social welfare with respect to classical scores used in voting rules. We have shown that, on the negative side, maximizing Nash product social welfare is 
                        NP
                     -complete when Borda or lexicographic scores are used. On the positive side, the problem is solvable in polynomial time for approval scores. Hence, for approval scores an allocation maximizing social welfare can be found in polynomial time for utilitarian, egalitarian, and Nash product social welfare.

In addition, for the types of scores considered, i.e., for approval, Borda, and lexicographic scores, maximizing Nash product social welfare shows the same computational complexity behavior as maximizing egalitarian social welfare. However, whether or not the computational complexity statuses of the two problems also coincide when quasi-indifference scores are used is an interesting question for future research: while maximizing egalitarian social welfare is known to be computationally intractable for quasi-indifference scores (Baumeister et al., 2013), the computational complexity involved in maximizing Nash product social welfare for quasi-indifference scores is still open.

In addition, the hardness results provided in this paper hint at another interesting direction for future research: for the problem of finding an allocation of maximum Nash product social welfare under the use of Borda and lexicographic scores respectively, investigate the existence of approximation algorithms that run in polynomial time.

@&#ACKNOWLEDGMENTS@&#

Andreas Darmann was supported by the Austrian Science Fund (FWF) [P 23724-G11] “Fairness and Voting in Discrete Optimization”. Joachim Schauer was supported by the Austrian Science Fund (FWF) [P 23829-N13] “Graph Problems with Knapsack Constraints”.

@&#REFERENCES@&#

