@&#MAIN-TITLE@&#Uncertainty analysis of the DLT-Lines calibration algorithm for cameras with radial distortion

@&#HIGHLIGHTS@&#


               
               
                  
                     
                        
                           
                           Uncertainty analysis for the Direct Linear Transformation based camera calibration.


                        
                        
                           
                           Direct Linear Transformation (DLT) specialized to cameras with square pixels.


                        
                        
                           
                           Flexible DLT by combining more constraints based on a Gauss–Newton formulation.


                        
                        
                           
                           Calibration uncertainty back-projection to the ground plane.


                        
                        
                           
                           Using indoor or outdoor scene data instead of conventional calibration patterns.


                        
                     
                  
               
            

@&#KEYPHRASES@&#




                     DLT-Lines




                  

Camera calibration

Error propagation

uncertainty analysis

@&#ABSTRACT@&#


               
               
                  3D metric data of environmental structures is nowadays present in many information sources (maps, GIS) and can be easily acquired with modern depth sensing technology (RGBD, laser). This wealth of information can be readily used for single view calibration of 2D cameras with radial distortion, provided that image structures can be matched with the 3D data. In this paper we present an analysis of the level of accuracy that can be obtained when such calibration is performed with the 2D–3D DLT-Lines algorithm. The analysis propagates uncertainty in the detection of features at the image level to camera pose, and from there to 3D reconstruction. The analytic error propagation expressions are derived using first order uncertainty models, and are validated with Monte Carlo simulations in a virtual indoor environment. The method is general and can be applied to other calibration methods, as long as explicit or implicit expressions can be derived for the transformation from image coordinates to 3D reconstruction. We present results with real data for two applications: i) the 3D reconstruction of an outdoors building for which 3D information is given by a map, observed by a mobile phone camera; and ii) the uncertainty in the localization at the floor plane of points observed by a fixed camera calibrated by a robot equipped with an RGBD camera navigating in a typical indoor environment.
               
            

@&#INTRODUCTION@&#

@&#BACKGROUND@&#

Camera calibration is required in a wide range of applications. Geo-localization of detected events, measurement of people’s height or vehicle’s speed, and associating events between cameras are examples of tasks which can only be tackled if cameras are calibrated with respect to the coordinate system of a known scenario. Whereas calibrating camera translation can, in many cases, be performed by a simple measurement, calibrating rotation and intrinsic parameters are more difficult tasks. In many cases the selection of the viewing direction, zoom and focus is only done while mounting the camera. Calibration in-situ is thus convenient for many applications.

In-situ calibration with conventional calibration tools requires the use of calibration rigs or patterns which may be impractical in many cases. For instance the methods of Tsai [1], Heikkilä [2], Zhang [3], Kannala [4] and Bouguet [5] demand that the known pattern covers most of the imaged area, which requires an impractically large calibration pattern if the camera is mounted at a high position, far from the floor level. In addition, conventional calibration methodologies are mostly focused in the intrinsic parameters, and thus do not provide distances (rigid pose transformations, extrinsic parameters) among the various units within a camera network. In other words, they are not designed to provide a global coordinate system for all cameras.

In this work we consider a calibration methodology that instead of using a calibration pattern uses the scene data imaged by a camera, mounted in place, and auxiliary data encoding some 3D structure about the imaged area (Fig. 1
                        ). In some cases the auxiliary data can be simply a map or an aerial image. In-situ calibration based on world data brings two benefits, (i) there is no need for calibration patterns, and (ii) the world data specifies a coordinate system which can be used by multiple cameras.

The most common type of data used for camera calibration is the correspondence between 3D scene points and their 2D image projections [1,5]. Considering pin-hole camera models, one finds that 3D points and their 2D projections are related by simple linear constraints in homogeneous coordinates that can be combined in the so-called Direct Linear Transformation (DLT) [6,7]. Particularly in urban scenarios, straight lines are omnipresent. This motivates the use of lines for calibration. In fact, using lines instead of points is advantageous specially because simple image processing tools for local line fitting can be used to reduce the matching error between 2D and 3D structures. The identification of corresponding lines in multi-modal data is less sensitive to errors than establishing point correspondences [8,9]. Interestingly, writing linear constraints for calibration from line correspondences, i.e. estimating the projection matrix, is as simple as with points [10]. Once the projection matrix is computed, the camera pose and intrinsic parameters are readily obtained by factorization [7]. The quality of the estimated parameters depends on a series of factors: structure of the observed environment, selected data matches, model parameterization and optimization criteria [11].

The ability to assess the uncertainty in the estimates of a calibration method is important not only to infer errors on 3D reconstruction but also as a means to validate and improve the calibration process. One way to do this is to propagate the uncertainty in the measurement process (variance in pixel coordinates of the feature points or lines used for calibration) to uncertainty values on the calibration parameters, either intrinsic, extrinsic, or both; and from these uncertainties, to that of the computed 3D reconstruction when such calibration values are used.

This paper presents such detailed noise propagation analysis for the case of the DLT-Lines camera calibration process. We derive expressions to compute estimates for the covariance of the camera intrinsic parameters as well as estimates for the covariance of the camera pose. To do so, we compute a first order linearization of the calibration method around the obtained solution and use it to perform first order error propagation [12,13]. We validate the obtained uncertainty with synthetic data based on Monte-Carlo simulations, and with real data from a non-overlapped camera network.

The uncertainty analysis is derived first for the DLT-Lines formulation presented in [14] and further extended to introduce novel cases of interest, namely the combination of DLT-Lines with square pixel constraints, and with radial distortion. Finally, the analysis is also extended for the case in which the scene can be considered to obey a floor plane constraint, typical of aerial imagery.

@&#RELATED WORK@&#

Cameras can be installed outdoors or indoors [15,16], and can be used to cover overlapped or non-overlapped shared views [17,18]. Overlapping fields of view usually allow matching scene features among different cameras and therefore provide extrinsic information for their calibration. Conversely, non-overlapped fields of view require alternative sources of extrinsic information.

State of the art techniques for camera calibration require the use of non-planar [1] or planar [3] patterns, usually made of points, lines or checkerborads [19], conics [20], or even ArTag markers [21]. Unfortunately, for large outdoor camera networks, calibration patterns of reasonable sizes often project on images with very small resolution, mainly because cameras are located at a considerable height with respect to the floor. In addition, a pattern-based independent calibration of each camera would require a secondary process to relate all camera coordinate systems to a global reference frame, but establishing this relation with small to null overlapping fields of view is nearly impossible. For planar scenarios, a DLT [2,6,7] suffices to estimate image to plane homographies [22]. In practice, however, the planar scenario assumption is too restrictive as nonparallel locally planar surfaces, such as ramps and plazas, often occur in real urban environments.

An interesting in situ calibration methodology was proposed by Svoboda et al. [23]. This technique requires to use a bright moving spot to calibrate the camera network, simplifying the process with respect to the standard approaches. The technique assumes overlapping fields of view to estimate the epipolar geometry, to extract homographies, estimate depth, and finally compute the overall calibration of the camera network. However the method is not suited for outdoor scenarios or when the fields of view of the cameras do not overlap. Another alternative is to place the LED light on a moving robot and to have a secondary robot equipped with a laser sensor track the first one, relating their position estimates to the camera network [24]. Yet another system that relies on tracking a moving object to estimate the extrinsic parameters is given by Rahimi et al. [25], which assumes a constant velocity model for the target. Tracking a moving target each time the system needs recalibration might be prohibitive. The estimation of the camera location purely by analyzing cast shadows is also mathematically possible, but with very low position accuracy in practice [26], and if one is interested only in the topology of the network configuration and not in a metric calibration, multi-target tracking of people could also be an alternative [27]. In contrast to these approaches, we opt for a system that does not rely explicitly on a moving pattern or shadow to calibrate the network, and that produces accurate metric calibration, even in outdoor scenarios.

Analogously to use moving targets, one may have moving cameras, e.g. cameras encompassing controlled orientation changes (pan and tilt). Agapito et al. [28] use the properties of the image of the absolute conic to auto-calibrate such moving cameras. The computed intrinsic parameters, and the alignment of landmarks to image features allow to estimate also the extrinsic parameters [29]. However, camera networks are often composed of fixed cameras and therefore require scene information to compensate the lack of self-motion. Caprile and Torre [30] use the properties of vanishing points in two steps. First they estimate the focal length and the principal point of a camera, while in a second step they estimate the transformation between two cameras, with corresponding vanishing points. Another way to calibrate the camera network is to use a vertical vanishing point and the knowledge of a line in a plane orthogonal to the vertical direction on each camera image [31]. In [31] fundamental matrices are used to compute the relative camera positions. They utilize a vertical vanishing-point and an infinity homography. A common world coordinate system is defined to eliminate the overlapping constrain.

Our work is in this vein of fixed cameras which are calibrated with information commonly available in urban scenarios. Our calibration scenarios consist of networks of fixed monocular cameras which are traversed by an auxiliary LIDAR or color-depth (RGB-D) mobile camera (see Fig. 1). The auxiliary camera provides 3D data of the scenario which is sufficient for the calibration and thus overcomes the need of additional calibration artifacts. In addition, the mobile camera is assumed to have an estimate of its own localization, and therefore provide a global (single) coordinate system to the fixed cameras. As there are many well known methodologies for self-localizing the mobile camera, as e.g. Simultaneous Localization and Map Building (SLAM), we focus our work on the aspect of calibrating the fixed camera with respect to the mobile camera. Our recent work on camera calibration based on point clouds [14] is extended here with a more comprehensive Gauss–Newton formulation. This formulation allows the easy introduction of additional constraints and algorithm analysis.

An analysis of camera calibration uncertainty is needed to evaluate the quality of metric reconstructions that can be inferred from the images in the camera network [32]. In a wide variety of cases, uncertainty propagation can be analyzed using first order techniques [12]. In [33] for instance, a first order error analysis is used to propagate the calibration uncertainty to the motion parameters. Ansar and Daniilidis [34] study the sensitivity of the camera pose estimation while using points or lines with corresponding 3D coordinates. In Daniilidis and Ernst [35] uncertainty propagation techniques are used to develop an unbiased estimator. Salvi et al. [36] tested the accuracy of several classical calibrations methodologies. Sun and Cooperstock [37] show empirically the effects in camera camera calibration, of data size and input noise. In [11], the analysis is made via parameter correlation, and in [38] we introduce a calibration uncertainty analysis for cameras without radial distortion. In this paper we propose a first order estimation analysis of the full extrinsic calibration of cameras that have radial distortion.

The pin-hole camera model maps the 3D projective space to the 2D projective plane. Using homogeneous coordinates, a scene point, 
                        
                           M
                           =
                           
                              
                                 [
                                 X
                                 
                                 Y
                                 
                                 Z
                                 
                                 1
                                 ]
                              
                              T
                           
                        
                      is imaged as a point 
                        
                           m
                           =
                           
                              
                                 [
                                 u
                                 
                                 v
                                 
                                 1
                                 ]
                              
                              T
                           
                        
                     
                     
                        
                           (1)
                           
                              
                                 m
                                 ≐
                                 P
                                 
                                 M
                                 =
                                 K
                                 
                                 [
                                 R
                                 
                                 t
                                 ]
                                 M
                                 ,
                              
                           
                        
                     where ≐ denotes equal up to a scale factor and P is a 3 × 4 projection matrix. The 3 × 3 upper triangular matrix K contains the intrinsic parameters. The rotation matrix R and translation vector t form a rigid transformation from world to camera coordinates. In other words, t denotes the location of the origin of the world frame in camera coordinates and R describes the world frame also in camera coordinates.

To model radial distortion, we use the division model, proposed by Fitzgibbon [39], where an undistorted image point, 
                        
                           
                              
                                 m
                                 ^
                              
                              u
                           
                           =
                           
                              
                                 [
                                 
                                    u
                                    u
                                 
                                 
                                 
                                    v
                                    u
                                 
                                 ]
                              
                              T
                           
                        
                      is computed from a radially distorted image point 
                        
                           
                              
                                 m
                                 ^
                              
                              d
                           
                           =
                           
                              
                                 [
                                 
                                    u
                                    d
                                 
                                 
                                 
                                    v
                                    d
                                 
                                 ]
                              
                              T
                           
                        
                      by 
                        
                           
                              
                                 m
                                 ^
                              
                              u
                           
                           =
                           
                              
                                 m
                                 ^
                              
                              d
                           
                           /
                           
                              (
                              1
                              +
                              λ
                              
                                 
                                    ∥
                                    
                                       
                                          m
                                          ^
                                       
                                       d
                                    
                                    ∥
                                 
                                 2
                              
                              )
                           
                           ,
                        
                      and λ represents the radial distortion parameter. The coordinates of 
                        
                           
                              m
                              ^
                           
                           u
                        
                      and 
                        
                           
                              m
                              ^
                           
                           d
                        
                      are expressed in a 2D coordinate system having the origin coincident with the image principal point 
                        
                           
                              
                                 c
                                 ^
                              
                              o
                           
                           =
                           
                              
                                 [
                                 
                                    c
                                    u
                                 
                                 
                                 
                                    c
                                    v
                                 
                                 ]
                              
                              T
                           
                        
                     . The division model can also be conveniently written in homogeneous coordinates with

                        
                           (2)
                           
                              
                                 
                                    [
                                    
                                       
                                          
                                             
                                                u
                                                u
                                             
                                          
                                       
                                       
                                          
                                             
                                                v
                                                u
                                             
                                          
                                       
                                       
                                          
                                             1
                                          
                                       
                                    
                                    ]
                                 
                                 
                                    =
                                    ˙
                                 
                                 
                                    [
                                    
                                       
                                          
                                             
                                                u
                                                d
                                             
                                          
                                       
                                       
                                          
                                             
                                                v
                                                d
                                             
                                          
                                       
                                       
                                          
                                             
                                                1
                                                +
                                                λ
                                                
                                                   
                                                      ∥
                                                      
                                                         
                                                            m
                                                            ^
                                                         
                                                         d
                                                      
                                                      ∥
                                                   
                                                   2
                                                
                                             
                                          
                                       
                                    
                                    ]
                                 
                                 ⇔
                                 
                                    m
                                    u
                                 
                                 
                                    =
                                    ˙
                                 
                                 
                                    m
                                    d
                                 
                                 +
                                 λ
                                 
                                    e
                                    d
                                 
                                 .
                              
                           
                        
                     
                  

The Direct Linear Transformation (DLT), developed by Aziz and Karara [2,6], allows estimating the camera projection matrix in (1), P, by solving a linear system on the matrix entries using a set of 3D points, 
                           
                              {
                              
                                 M
                                 i
                              
                              :
                              
                                 M
                                 i
                              
                              =
                              
                                 
                                    [
                                    
                                       X
                                       i
                                    
                                    
                                    
                                       Y
                                       i
                                    
                                    
                                    
                                       Z
                                       i
                                    
                                    
                                    1
                                    ]
                                 
                                 T
                              
                              }
                           
                         and their corresponding 2D image points 
                           
                              {
                              
                                 m
                                 i
                              
                              :
                              
                                 m
                                 i
                              
                              =
                              
                                 
                                    [
                                    
                                       u
                                       i
                                    
                                    
                                    
                                       v
                                       i
                                    
                                    
                                    1
                                    ]
                                 
                                 T
                              
                              }
                           
                        . Applying a cross product by mi
                         to both sides of the equation, 
                           
                              
                                 m
                                 i
                              
                              ×
                              
                                 m
                                 i
                              
                              =
                              
                                 m
                                 i
                              
                              ×
                              
                                 (
                                 P
                                 
                                 
                                    M
                                    i
                                 
                                 )
                              
                              ,
                           
                         becomes zero in the left hand side and thus 
                           
                              
                                 
                                    [
                                    
                                       m
                                       i
                                    
                                    ]
                                 
                                 ×
                              
                              
                              P
                              
                              
                                 M
                                 i
                              
                              =
                              0
                              ,
                           
                         where [mi
                        ]× represents the linear cross product operation as a skew-symmetric matrix of mi
                        . The properties of the Kronecker product [40], ⊗, allow one to obtain an equation factorizing the data and variables to estimate

                           
                              (3)
                              
                                 
                                    
                                       (
                                       
                                          M
                                          i
                                          T
                                       
                                       ⊗
                                       
                                          
                                             [
                                             
                                                m
                                                i
                                             
                                             ]
                                          
                                          ×
                                       
                                       )
                                    
                                    
                                    v
                                    e
                                    c
                                    
                                       (
                                       P
                                       )
                                    
                                    =
                                    0
                                    ,
                                 
                              
                           
                        where vec(P) denotes the vectorization of the matrix P, formed by stacking the columns into a single column vector.

Each pair (Mi, mi
                        ) provides a set of three equations in the entries of vec(P) but only two of them are linearly independent. Therefore, one needs at least six pairs of 3D-to-2D corresponding points to estimate the projection matrix. Having N ≥ 6 pairs of 3D-to-2D correspondences, in a nondegenerate configuration, allows forming a matrix A, 3N × 12, by stacking N matrices 
                           
                              
                                 M
                                 i
                                 T
                              
                              ⊗
                              
                                 
                                    [
                                    
                                       m
                                       i
                                    
                                    ]
                                 
                                 ×
                              
                           
                        . The singular vector corresponding to the smallest singular value of A is an estimate of projection matrix (vectorized), minimizing the error ‖A 
                        vec(P)‖2 s.t. 
                           
                              
                                 ∥
                                 v
                                 e
                                 c
                                 (
                                 P
                                 )
                                 ∥
                              
                              =
                              1
                           
                         [41].

Note that pre-normalization of the input data is crucial on implementing this algorithm [42]. Hartley suggested that the appropriate pre-normalization method consists in translating all data points (3D and 2D points) so that their centroids are at the origin. Further the data should be scaled so that the average distance, of data points to the origin, is equal to 
                           
                              2
                           
                         for image points and 
                           
                              3
                           
                         for 3D points.

Fitzgibbon’s division model provides an extension of the DLT-Points calibration methodology to deal with the estimation of the camera projection matrix, P, directly from radially distorted image data. Substituting the right hand side of (2), in the DLT-Points factorized Eq. (3) results in

                           
                              (4)
                              
                                 
                                    
                                       (
                                       
                                          M
                                          i
                                          T
                                       
                                       ⊗
                                       
                                          
                                             [
                                             
                                                m
                                                
                                                   i
                                                   d
                                                
                                             
                                             +
                                             λ
                                             
                                                e
                                                
                                                   i
                                                   d
                                                
                                             
                                             ]
                                          
                                          ×
                                       
                                       )
                                    
                                    
                                    v
                                    e
                                    c
                                    
                                       (
                                       P
                                       )
                                    
                                    =
                                    0
                                 
                              
                           
                        which can be rewritten as 
                           
                              
                                 (
                                 
                                    A
                                    
                                       i
                                       1
                                    
                                 
                                 +
                                 λ
                                 
                                    A
                                    
                                       i
                                       2
                                    
                                 
                                 )
                              
                              v
                              e
                              c
                              
                                 (
                                 P
                                 )
                              
                              =
                              0
                              ,
                           
                         where 
                           
                              
                                 A
                                 
                                    i
                                    1
                                 
                              
                              =
                              
                                 M
                                 i
                                 T
                              
                              ⊗
                              
                                 
                                    [
                                    
                                       m
                                       
                                          i
                                          d
                                       
                                    
                                    ]
                                 
                                 ×
                              
                           
                         and 
                           
                              
                                 A
                                 
                                    i
                                    2
                                 
                              
                              =
                              
                                 M
                                 i
                                 T
                              
                              ⊗
                              
                                 
                                    [
                                    
                                       e
                                       
                                          i
                                          d
                                       
                                    
                                    ]
                                 
                                 ×
                              
                           
                        . Considering N pairs (Mi, mi
                        ) one forms two 3N × 12 matrices, A
                        1 and A
                        2, by stacking matrices A
                        
                           i1 and A
                        
                           i2. As suggested by Fitzgibbon [39], left-multiplying the stacked matrices by 
                           
                              A
                              1
                              T
                           
                         results in a polynomial eigenvalue problem 
                           
                              
                                 (
                                 
                                    A
                                    1
                                    T
                                 
                                 
                                    A
                                    1
                                 
                                 +
                                 λ
                                 
                                    A
                                    1
                                    T
                                 
                                 
                                    A
                                    2
                                 
                                 )
                              
                              v
                              e
                              c
                              
                                 (
                                 P
                                 )
                              
                              =
                              0
                           
                        .
                           1
                        
                        
                           1
                           Can be solved in Matlab using the polyeig function.
                        
Its solution gives simultaneously the projection matrix, vec(P) and the radial distortion parameter, λ. Noting that the distortion model involves representing points around the principal point, which we assume to be approximately equal to the image center [39], the estimated projection matrix is finally obtained with 
                           
                              
                                 P
                                 ′
                              
                              =
                              
                                 T
                                 
                                    −
                                    1
                                 
                              
                              P
                              ,
                           
                         where T is a 3 × 3 matrix defining the translation of the image coordinate reference to the principal point. Having estimated P′, one has an estimate of the principal point, which can be used to iterate the calibration procedure and therefore improve the approximation.

However, in some scenarios it is impossible to calibrate a camera using DLT-Points. An example is shown in Fig. 4 where we do not have direct 2D–3D correspondences between Fig. 4(b) and (c). In such scenarios one can use DLT-Lines, as will be discussed in Section 3.2.

The use of lines for camera calibration, as opposed to isolated image points, allows for fine tuning the location of the lines in the image through simple line fitting algorithms.

Given a 3D line Li
                        , its projection on the camera image plane, li
                         can be represented by an implicit equation, 
                           
                              f
                              
                                 (
                                 m
                                 )
                              
                              =
                              a
                              
                                 m
                                 x
                              
                              +
                              b
                              
                                 m
                                 y
                              
                              +
                              c
                              =
                              0
                              ,
                           
                         where m is a point on the line. The parameters of this equation, 
                           
                              l
                              =
                              
                                 
                                    [
                                    a
                                    
                                    b
                                    
                                    c
                                    ]
                                 
                                 T
                              
                              ,
                           
                         can be defined by the cross product of two normalized points, m
                        1 and m
                        2
                        
                           
                              (5)
                              
                                 
                                    l
                                    =
                                    
                                       m
                                       1
                                    
                                    ×
                                    
                                       m
                                       2
                                    
                                    =
                                    
                                       [
                                       
                                          
                                             
                                                
                                                   
                                                      m
                                                      
                                                         1
                                                         y
                                                      
                                                   
                                                   −
                                                   
                                                      m
                                                      
                                                         2
                                                         y
                                                      
                                                   
                                                
                                             
                                          
                                          
                                             
                                                
                                                   
                                                      m
                                                      
                                                         2
                                                         x
                                                      
                                                   
                                                   −
                                                   
                                                      m
                                                      
                                                         1
                                                         x
                                                      
                                                   
                                                
                                             
                                          
                                          
                                             
                                                
                                                   
                                                      m
                                                      
                                                         1
                                                         x
                                                      
                                                   
                                                   
                                                      m
                                                      
                                                         2
                                                         y
                                                      
                                                   
                                                   −
                                                   
                                                      m
                                                      
                                                         1
                                                         y
                                                      
                                                   
                                                   
                                                      m
                                                      
                                                         2
                                                         x
                                                      
                                                   
                                                
                                             
                                          
                                       
                                       ]
                                    
                                    .
                                 
                              
                           
                        Note that a and b form a sub-vector that is perpendicular to the line, 
                           
                              
                                 n
                                 l
                              
                              =
                              
                                 
                                    [
                                    a
                                    
                                    b
                                    ]
                                 
                                 T
                              
                           
                        . The distance from point to line is 
                           
                              d
                              =
                              
                                 l
                                 T
                              
                              m
                              /
                              
                                 ∥
                                 
                                    n
                                    l
                                 
                                 ∥
                              
                              ,
                           
                         and one can normalize the line distance with 
                           
                              
                                 ∥
                              
                              
                                 n
                                 l
                              
                              
                                 ∥
                                 =
                                 1
                              
                           
                        .

Camera calibration based in DLT-Lines involves matching image lines with 3D lines or, more precisely, 3D points. As in DLT-Points two cases are considered, namely (i) no radial distortion and (ii) significant radial distortion. In the case where the radial distortion is considered, it is modeled using Fitzgibbon’s division model. The case of radial distortion is detailed in Section 3.4. First we detail the simpler case of no radial distortion.

Any point mki
                         lying on a line li
                         satisfies 
                           
                              
                                 l
                                 i
                                 T
                              
                              
                              
                                 m
                                 
                                    k
                                    i
                                 
                              
                              =
                              0
                           
                        . Multiplying by 
                           
                              l
                              i
                              T
                           
                         on both sides of (1), i.e., 
                           
                              
                                 l
                                 i
                                 T
                              
                              
                              
                                 m
                                 
                                    k
                                    i
                                 
                              
                              =
                              
                                 l
                                 i
                                 T
                              
                              
                              P
                              
                              
                                 M
                                 
                                    k
                                    i
                                 
                              
                              ,
                           
                         leads to

                           
                              (6)
                              
                                 
                                    
                                       l
                                       i
                                       T
                                    
                                    
                                    P
                                    
                                    
                                       M
                                       
                                          k
                                          i
                                       
                                    
                                    =
                                    0
                                 
                              
                           
                        where Mki
                         is a 3D point in projective coordinates lying in Li
                         the 3D line imaged as li
                        . As in the case of DLT-Points, using the Kronecker product one obtains a form where the elements of the projection matrix are factorized

                           
                              (7)
                              
                                 
                                    
                                       (
                                       
                                          M
                                          
                                             k
                                             i
                                          
                                          T
                                       
                                       ⊗
                                       
                                          l
                                          i
                                          T
                                       
                                       )
                                    
                                    
                                    v
                                    e
                                    c
                                    
                                       (
                                       P
                                       )
                                    
                                    =
                                    0
                                    .
                                 
                              
                           
                        Each pair of 3D point and its corresponding image line, (Mki, li
                        ), provide a single linear constraint in the entries of vec(P). Considering N pairs (Mki, li
                        ), one forms a matrix B, N × 12, by stacking the N matrices 
                           
                              
                                 M
                                 
                                    k
                                    i
                                 
                                 T
                              
                              ⊗
                              
                                 l
                                 i
                                 T
                              
                           
                        .

From (7) one has that in a noiseless case 
                           
                              B
                              p
                              =
                              0
                           
                         with ‖p‖ ≠ 0 and therefore 
                           
                              m
                              a
                              x
                              (
                              r
                              a
                              n
                              k
                              (
                              B
                              )
                              )
                              =
                              11
                           
                        . Therefore, in order to estimate P one needs at least six nondegenerate 3D lines configuration and their corresponding six image lines, i.e. six four-tuples (M
                        
                           i1, M
                        
                           i2, m
                        
                           i1, m
                        
                           i2). Each four-tuple generates two pairs of a 3D point and an image line, {(M
                        
                           i1, li
                        ), (M
                        
                           i2, li
                        )} where 
                           
                              
                                 l
                                 i
                              
                              =
                              
                                 m
                                 
                                    i
                                    1
                                 
                              
                              ×
                              
                                 m
                                 
                                    i
                                    2
                                 
                              
                           
                        . Thus, the six lines generate 12 pairs (Mki, li
                        ) which allow B reaching the maximum rank.
                           2
                        
                        
                           2
                           Note that in a nondegenerate and noiseless case, the maximum rank of B is 11, and thus one can drop one of the 12 pairs (Mki, li
                              ). This is a similar case as with DLT-Points, where are required 6 pairs (Mki, mki
                              ), within which one of the pairs is needed to provide one single constraint, but provides two constraints as all the other five pairs. Nondegenerate implies, for example, that the 3D lines cannot be all co-planar. For instance, Fig. 1(b) is a case of just vertical and horizontal lines, where would be useful to have all horizontal lines co-planar but that makes the rank of B lesser than 11 (more detail in Section 5).
                         The least squares solution

                           
                              (8)
                              
                                 
                                    
                                       p
                                       *
                                    
                                    =
                                    
                                       arg
                                       
                                          
                                          p
                                          
                                       
                                    
                                    min
                                    
                                       
                                          ∥
                                          B
                                          p
                                          ∥
                                       
                                       2
                                    
                                    
                                    s.t.
                                    
                                    
                                       ∥
                                       p
                                       ∥
                                    
                                    =
                                    1
                                    ,
                                 
                              
                           
                        where 
                           
                              p
                              =
                              v
                              e
                              c
                              (
                              P
                              )
                           
                        is the right singular vector corresponding to the least singular value of B. As already discussed, to obtain the maximal rank in B requires at least six 3D lines and their images. However, if one has some calibration parameters known a priori then the rank of B may be lesser than the maximum and the amount of required 3D information diminishes.

Some more properties of interest can be stated for proposed calibration methodologies. From (7) and (3) it is possible to conclude that DLT-Points can be incorporated on DLT-Lines, by concatenation of matrices A and B, respectively. Both matrices represent equations on entries of p, allowing two paired (Mi, mi
                        ) points be combined with (Mki, li
                        ) to estimate the projection matrix P.

Comparing both DLT methods, it is important to note that while in DLT-Points one has to provide one 3D-point to one 2D-point correspondences, in DLT-Lines one 2D-line, li
                        , is an image of a 3D-line, Li
                        , and thus associates many-3D-points to one-2D-line. Any point Mki
                         ∈ Li
                         forms a linear constraint with li
                         
                        (7). This property of DLT-Lines allows to apply additional image processing tools that add robustness to the extraction of calibration data. In particular, DLT-Lines can be used for fine tuning finding lines both in the RGB and RGBD images.

In addition, any line defined in the RGBD image indicates 3D points (from the depth data) that are expected to form a line in 3D. The points forming the 3D line have noise, e.g. due to the finite depth resolution, which is important to filter using a RANSAC procedure [7].

One specific case of interest consists in knowing the pixels aspect ratio. Assuming the case of square pixels, common in modern cameras, allows decreasing the required completeness of data forming B, accepting for example 
                           
                              r
                              a
                              n
                              k
                              (
                              B
                              )
                              =
                              10
                           
                        . Using SVD factorization, let 
                           
                              B
                              =
                              U
                              Σ
                              
                                 V
                                 T
                              
                           
                         and 
                           
                              V
                              =
                              [
                              
                                 v
                                 1
                              
                              
                              …
                              
                              
                                 v
                                 11
                              
                              
                              
                                 v
                                 12
                              
                              ]
                           
                         be the singular vectors of B. In the case of 
                           
                              r
                              a
                              n
                              k
                              (
                              B
                              )
                              =
                              10
                           
                         the calibration solution is a linear combination of the last two singular vectors, v
                        11 and v
                        12. The square pixels constraint allows then writing the calibration problem as a 1D non-linear optimization problem

                           
                              (9)
                              
                                 
                                    
                                       
                                          
                                             p
                                             *
                                          
                                       
                                       
                                          =
                                       
                                       
                                          
                                             
                                                w
                                                *
                                             
                                             
                                                v
                                                11
                                             
                                             +
                                             
                                                
                                                   1
                                                   −
                                                   
                                                      
                                                         (
                                                         
                                                            w
                                                            *
                                                         
                                                         )
                                                      
                                                      2
                                                   
                                                
                                             
                                             
                                                v
                                                12
                                             
                                          
                                       
                                    
                                    
                                       
                                          
                                             w
                                             *
                                          
                                       
                                       
                                          =
                                       
                                       
                                          
                                             
                                                arg
                                                
                                                   
                                                   w
                                                
                                             
                                             
                                             min
                                             
                                                ∥
                                                K
                                                
                                                   (
                                                   1
                                                   ,
                                                   1
                                                   )
                                                
                                                −
                                                K
                                                
                                                   (
                                                   2
                                                   ,
                                                   2
                                                   )
                                                
                                                ∥
                                             
                                          
                                       
                                    
                                 
                              
                           
                        where w
                        * ∈ [0, 1] and the intrinsic parameters matrix, K, is computed through QR decomposition of the vector p
                        * reshaped to a 3 × 4 matrix. Note that by construction 
                           
                              
                                 ∥
                              
                              
                                 p
                                 *
                              
                              
                                 ∥
                                 =
                                 1
                                 ,
                              
                           
                         since v
                        11 and v
                        12 are orthogonal and have unit norm. The interval 
                           
                              
                                 w
                                 *
                              
                              ∈
                              
                                 [
                                 −
                                 1
                                 ,
                                 
                                 0
                                 ]
                              
                           
                         is not considered since 
                           
                              −
                              
                                 p
                                 *
                              
                           
                         and p
                        * lead to the same solution.

Using (2), which describes the relationship between distorted and undistorted image points, a line l
                        12 can be defined as the cross product of two undistorted points

                           
                              (10)
                              
                                 
                                    
                                       l
                                       12
                                    
                                    =
                                    
                                       [
                                       
                                          
                                             
                                                
                                                   u
                                                   
                                                      1
                                                      d
                                                   
                                                
                                             
                                          
                                          
                                             
                                                
                                                   v
                                                   
                                                      1
                                                      d
                                                   
                                                
                                             
                                          
                                          
                                             
                                                
                                                   1
                                                   +
                                                   λ
                                                   
                                                      
                                                         ∥
                                                         
                                                            
                                                               m
                                                               ^
                                                            
                                                            
                                                               1
                                                               d
                                                            
                                                         
                                                         ∥
                                                      
                                                      2
                                                   
                                                
                                             
                                          
                                       
                                       ]
                                    
                                    ×
                                    
                                       [
                                       
                                          
                                             
                                                
                                                   u
                                                   
                                                      2
                                                      d
                                                   
                                                
                                             
                                          
                                          
                                             
                                                
                                                   v
                                                   
                                                      2
                                                      d
                                                   
                                                
                                             
                                          
                                          
                                             
                                                
                                                   1
                                                   +
                                                   λ
                                                   
                                                      
                                                         ∥
                                                         
                                                            
                                                               m
                                                               ^
                                                            
                                                            
                                                               2
                                                               d
                                                            
                                                         
                                                         ∥
                                                      
                                                      2
                                                   
                                                
                                             
                                          
                                       
                                       ]
                                    
                                    =
                                    
                                       
                                          l
                                          ^
                                       
                                       12
                                    
                                    +
                                    λ
                                    
                                       e
                                       12
                                    
                                 
                              
                           
                        where the line can be divided in two terms, one without the radial distortion parameter, and a distortion correction term 
                           
                              
                                 e
                                 12
                              
                              
                                 =
                                 [
                              
                              
                                 v
                                 
                                    1
                                    d
                                 
                              
                              
                                 ∥
                              
                              
                                 
                                    m
                                    ^
                                 
                                 
                                    2
                                    d
                                 
                              
                              
                                 
                                    ∥
                                 
                                 2
                              
                              −
                              
                                 v
                                 
                                    2
                                    d
                                 
                              
                              
                                 ∥
                              
                              
                                 
                                    m
                                    ^
                                 
                                 
                                    1
                                    d
                                 
                              
                              
                                 
                                    ∥
                                 
                                 2
                              
                              ,
                              
                              
                                 u
                                 
                                    2
                                    d
                                 
                              
                              
                                 ∥
                              
                              
                                 
                                    m
                                    ^
                                 
                                 
                                    1
                                    d
                                 
                              
                              
                                 
                                    ∥
                                 
                                 2
                              
                              −
                              
                                 u
                                 
                                    1
                                    d
                                 
                              
                              
                                 ∥
                              
                              
                                 
                                    m
                                    ^
                                 
                                 
                                    2
                                    d
                                 
                              
                              
                                 
                                    
                                       ∥
                                       2
                                    
                                    ,
                                    
                                    0
                                    ]
                                 
                                 T
                              
                           
                        . Applying (10) into the point-to-line constraint (7), one has

                           
                              (11)
                              
                                 
                                    
                                       (
                                       
                                          M
                                          
                                             k
                                          
                                          T
                                       
                                       ⊗
                                       
                                          
                                             (
                                             
                                                
                                                   l
                                                   ^
                                                
                                                12
                                             
                                             +
                                             λ
                                             
                                                e
                                                12
                                             
                                             )
                                          
                                          T
                                       
                                       )
                                    
                                    v
                                    e
                                    c
                                    
                                       (
                                       P
                                       )
                                    
                                    =
                                    0
                                 
                              
                           
                        where Mk
                         denotes the kth 3D point projecting to the line l
                        12. The equation can be rewritten as

                           
                              (12)
                              
                                 
                                    
                                       (
                                       
                                          B
                                          
                                             k
                                             i
                                             1
                                          
                                       
                                       +
                                       λ
                                       
                                          B
                                          
                                             k
                                             i
                                             2
                                          
                                       
                                       )
                                    
                                    
                                    v
                                    e
                                    c
                                    
                                       (
                                       P
                                       )
                                    
                                    =
                                    0
                                 
                              
                           
                        where 
                           
                              
                                 B
                                 
                                    k
                                    i
                                    1
                                 
                              
                              =
                              
                                 M
                                 
                                    k
                                 
                                 T
                              
                              ⊗
                              
                                 
                                    l
                                    ^
                                 
                                 
                                    12
                                 
                                 T
                              
                              ,
                           
                        
                        
                           
                              
                                 B
                                 
                                    k
                                    i
                                    2
                                 
                              
                              =
                              
                                 M
                                 
                                    k
                                 
                                 T
                              
                              ⊗
                              
                                 e
                                 
                                    12
                                 
                                 T
                              
                           
                        .

Estimating P requires multiple 3D lines and the corresponding images. Large (distorted) imaged lines are divided into smaller, approximately straight, segments. Considering N ≥ 12 pairs 
                           
                              (
                              
                                 M
                                 
                                    k
                                    i
                                 
                              
                              ,
                              
                                 
                                    l
                                    ^
                                 
                                 i
                              
                              )
                              ,
                           
                         where 
                           
                              N
                              =
                              
                                 k
                                 
                                    m
                                    a
                                    x
                                 
                              
                              
                                 i
                                 
                                    m
                                    a
                                    x
                                 
                              
                              ,
                           
                         one forms two N × 12 matrices, B
                        1 and B
                        2, by stacking matrices B
                        
                           ki1 and B
                        
                           ki2. Breaking imaged lines into segments increases the number of rows of B
                        1 and B
                        2. For example, breaking one imaged line into n segments adds 
                           
                              
                                 k
                                 
                                    m
                                    a
                                    x
                                 
                              
                              
                                 (
                                 n
                                 −
                                 1
                                 )
                              
                           
                         rows to B
                        1 and B
                        2. Breaking every imaged line into two segments doubles the number of rows of B
                        1 and B
                        2.

Let us define the cost function

                           
                              (13)
                              
                                 
                                    
                                       f
                                       
                                          (
                                          m
                                          ,
                                          M
                                          )
                                       
                                       =
                                       ∥
                                    
                                    
                                       (
                                       
                                          B
                                          1
                                       
                                       +
                                       λ
                                       
                                          B
                                          2
                                       
                                       )
                                    
                                    
                                       
                                          p
                                          ∥
                                       
                                       2
                                    
                                 
                              
                           
                        
                     

The minimization problem to find 
                           
                              p
                              =
                              v
                              e
                              c
                              (
                              P
                              )
                           
                         can be written as

                           
                              (14)
                              
                                 
                                    
                                       
                                       
                                       
                                          
                                             
                                                (
                                                
                                                   p
                                                   *
                                                
                                                ,
                                                
                                                
                                                   λ
                                                   *
                                                
                                                )
                                             
                                             =
                                             
                                                arg
                                                
                                                   p
                                                   ,
                                                   λ
                                                
                                             
                                             min
                                             f
                                             
                                                (
                                                m
                                                ,
                                                M
                                                ;
                                                p
                                                ,
                                                λ
                                                )
                                             
                                          
                                       
                                    
                                    
                                       
                                       
                                       
                                          
                                             
                                             s.t.
                                             
                                             
                                                p
                                                T
                                             
                                             p
                                             −
                                             1
                                             =
                                             0
                                             .
                                          
                                       
                                    
                                 
                              
                           
                        Applying a change of variable 
                           
                              λ
                              p
                              =
                              q
                              ,
                           
                         one obtains the Lagrangian

                           
                              (15)
                              
                                 
                                    
                                       
                                          L
                                       
                                       
                                          =
                                       
                                       
                                          
                                             
                                                p
                                                T
                                             
                                             
                                                B
                                                1
                                                T
                                             
                                             
                                                B
                                                1
                                             
                                             p
                                             +
                                             
                                                p
                                                T
                                             
                                             
                                                (
                                                
                                                   B
                                                   1
                                                   T
                                                
                                                
                                                   B
                                                   2
                                                
                                                +
                                                
                                                   B
                                                   2
                                                   T
                                                
                                                
                                                   B
                                                   1
                                                
                                                )
                                             
                                             q
                                             +
                                             
                                                q
                                                T
                                             
                                             
                                                B
                                                2
                                                T
                                             
                                             
                                                B
                                                2
                                             
                                             q
                                          
                                       
                                    
                                    
                                       
                                       
                                       
                                          
                                             +
                                             σ
                                             
                                                (
                                                
                                                   p
                                                   T
                                                
                                                p
                                                −
                                                1
                                                )
                                             
                                             +
                                             
                                                v
                                                T
                                             
                                             
                                                (
                                                q
                                                −
                                                λ
                                                p
                                                )
                                             
                                          
                                       
                                    
                                 
                              
                           
                        where σ, v are KKT multipliers, therefore yielding the KKT conditions of the problem which can be written as the system of equations

                           
                              (16)
                              
                                 
                                    
                                       
                                          
                                             G
                                             
                                                (
                                                m
                                                ,
                                                M
                                                ,
                                                p
                                                ;
                                                v
                                                ,
                                                σ
                                                )
                                             
                                             
                                             =
                                             
                                             
                                                0
                                                
                                                   38
                                                   ×
                                                   1
                                                
                                             
                                             
                                             
                                             
                                             
                                          
                                       
                                    
                                    
                                       
                                          
                                             ⇕
                                             
                                             
                                             
                                             
                                             
                                             
                                             
                                             
                                          
                                       
                                    
                                    
                                       
                                          
                                             {
                                             
                                                
                                                   
                                                      
                                                         
                                                            
                                                               
                                                                  2
                                                                  
                                                                     B
                                                                     1
                                                                     T
                                                                  
                                                                  
                                                                     B
                                                                     1
                                                                  
                                                                  p
                                                                  +
                                                                  
                                                                     (
                                                                     
                                                                        B
                                                                        1
                                                                        T
                                                                     
                                                                     
                                                                        B
                                                                        2
                                                                     
                                                                     +
                                                                     
                                                                        B
                                                                        2
                                                                        T
                                                                     
                                                                     
                                                                        B
                                                                        1
                                                                     
                                                                     )
                                                                  
                                                                  q
                                                                  +
                                                                  2
                                                                  σ
                                                                  p
                                                                  −
                                                                  λ
                                                                  v
                                                                  =
                                                                  
                                                                     0
                                                                     
                                                                        12
                                                                        ×
                                                                        1
                                                                     
                                                                  
                                                               
                                                            
                                                         
                                                         
                                                            
                                                               
                                                                  
                                                                     (
                                                                     
                                                                        B
                                                                        1
                                                                        T
                                                                     
                                                                     
                                                                        B
                                                                        2
                                                                     
                                                                     +
                                                                     
                                                                        B
                                                                        2
                                                                        T
                                                                     
                                                                     
                                                                        B
                                                                        1
                                                                     
                                                                     )
                                                                  
                                                                  p
                                                                  +
                                                                  2
                                                                  
                                                                     B
                                                                     2
                                                                     T
                                                                  
                                                                  
                                                                     B
                                                                     2
                                                                  
                                                                  q
                                                                  +
                                                                  v
                                                                  =
                                                                  
                                                                     0
                                                                     
                                                                        12
                                                                        ×
                                                                        1
                                                                     
                                                                  
                                                               
                                                            
                                                         
                                                         
                                                            
                                                               
                                                                  q
                                                                  −
                                                                  λ
                                                                  p
                                                                  =
                                                                  
                                                                     0
                                                                     
                                                                        12
                                                                        ×
                                                                        1
                                                                     
                                                                  
                                                               
                                                            
                                                         
                                                         
                                                            
                                                               
                                                                  −
                                                                  
                                                                     v
                                                                     T
                                                                  
                                                                  p
                                                                  =
                                                                  
                                                                     0
                                                                     
                                                                        1
                                                                        ×
                                                                        1
                                                                     
                                                                  
                                                               
                                                            
                                                         
                                                         
                                                            
                                                               
                                                                  
                                                                     p
                                                                     T
                                                                  
                                                                  p
                                                                  −
                                                                  1
                                                                  =
                                                                  
                                                                     0
                                                                     
                                                                        1
                                                                        ×
                                                                        1
                                                                     
                                                                  
                                                               
                                                            
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           
                        Given the KKT conditions we can use Gauss–Newton to estimate p. More precisely we solve the system by iterating the solution through the linear system

                           
                              (17)
                              
                                 
                                    
                                       J
                                       G
                                    
                                    θ
                                    =
                                    −
                                    G
                                 
                              
                           
                        where θ denotes the Newton step which needs to be solved for, and will be used to update p, v and σ. The Jacobian JG
                         assumes the form

                           
                              (18)
                              
                                 
                                    
                                       J
                                       G
                                    
                                    =
                                    
                                       [
                                       
                                          
                                             
                                                
                                                   2
                                                   
                                                      B
                                                      1
                                                      T
                                                   
                                                   
                                                      B
                                                      1
                                                   
                                                   +
                                                   2
                                                   I
                                                   σ
                                                
                                             
                                             
                                                
                                                   
                                                      B
                                                      1
                                                      T
                                                   
                                                   
                                                      B
                                                      2
                                                   
                                                   +
                                                   
                                                      B
                                                      2
                                                      T
                                                   
                                                   
                                                      B
                                                      1
                                                   
                                                
                                             
                                             
                                                
                                                   −
                                                   v
                                                
                                             
                                             
                                                
                                                   2
                                                   p
                                                
                                             
                                             
                                                
                                                   −
                                                   I
                                                   λ
                                                
                                             
                                          
                                          
                                             
                                                
                                                   
                                                      B
                                                      1
                                                      T
                                                   
                                                   
                                                      B
                                                      2
                                                   
                                                   +
                                                   
                                                      B
                                                      2
                                                      T
                                                   
                                                   
                                                      B
                                                      1
                                                   
                                                
                                             
                                             
                                                
                                                   2
                                                   
                                                      B
                                                      2
                                                      T
                                                   
                                                   
                                                      B
                                                      2
                                                   
                                                
                                             
                                             
                                                0
                                             
                                             
                                                0
                                             
                                             
                                                I
                                             
                                          
                                          
                                             
                                                
                                                   −
                                                   
                                                      v
                                                      T
                                                   
                                                
                                             
                                             
                                                
                                                   0
                                                   T
                                                
                                             
                                             
                                                0
                                             
                                             
                                                0
                                             
                                             
                                                
                                                   −
                                                   
                                                      p
                                                      T
                                                   
                                                
                                             
                                          
                                          
                                             
                                                
                                                   2
                                                   
                                                      p
                                                      T
                                                   
                                                
                                             
                                             
                                                
                                                   0
                                                   T
                                                
                                             
                                             
                                                0
                                             
                                             
                                                0
                                             
                                             
                                                
                                                   0
                                                   T
                                                
                                             
                                          
                                          
                                             
                                                
                                                   −
                                                   I
                                                   λ
                                                
                                             
                                             
                                                I
                                             
                                             
                                                
                                                   −
                                                   p
                                                
                                             
                                             
                                                0
                                             
                                             
                                                0
                                             
                                          
                                       
                                       ]
                                    
                                    .
                                 
                              
                           
                        
                     

To initialize the iterative method, we use Fitzgibbon’s suggestion [39]: left-multiplying the stacked matrices by 
                           
                              B
                              
                                 1
                              
                              T
                           
                         results, once more, in a polynomial eigenvalue problem 
                           
                              
                                 (
                                 
                                    B
                                    
                                       1
                                    
                                    T
                                 
                                 
                                    B
                                    1
                                 
                                 +
                                 λ
                                 
                                    B
                                    
                                       1
                                    
                                    T
                                 
                                 
                                    B
                                    2
                                 
                                 )
                              
                              
                              v
                              e
                              c
                              
                                 (
                                 P
                                 )
                              
                              =
                              0
                              ,
                           
                         which was solved in Matlab using the polyeig function. Its solution gives simultaneously the projection matrix, vec(P), the radial distortion parameter λ, and 
                           
                              
                                 P
                                 ′
                              
                              =
                              
                                 T
                                 
                                    −
                                    1
                                 
                              
                              P
                              ,
                           
                         where T is defined in Section 3.1. In a similar way as explained before, both DLT methods applied to the radial distorted camera can be combined to estimate P and λ. Note that the solution will only be an approximation since the minimization functions are not the same.

Having estimated the projection matrix, P, the camera intrinsic and extrinsic parameters can be obtained using QR-decomposition [7].

In the previous sections we described DLT-Points and DLT-Lines, which involved solving for the intrinsic and extrinsic parameters as least squares problems. In the more general case, in which we estimate also the radial distortion, we proposed a Gauss–Newton iterative solution. Many other interesting and relevant cases can be found within these frameworks. For instance, when K is known, its inverse can be applied to the 2D data and, in the case of DLT-Points, the calibration problem is converted to solve the well known Perspective-n-Point (PnP) problem [43]. Another simple case is the one where the camera center is given and therefore DLT-Points and DLT-Lines are reduced to the estimation of an homography, KR, by subtracting the camera center to all the 3D data. Other interesting cases arise by specifying constraints in R or t, or in K, such as square pixels and principal point coincident with the image center. These cases can be dealt with Gauss–Newton solutions as proposed for DLT-Lines with radial distortion.

The simple data-based constraints, created by DLT like formulations, are useful in many applications. Here we start describing the application central to this paper, namely the analysis of uncertainty propagation in calibration. In particular we detail the effect of calibration uncertainty into the reconstruction of ground points, i.e. points back-projected to the ground plane. First we introduce back-projection and in subsequent sections we study its uncertainty propagation.

Consider a point m observed in an image, we know it is related to a 3D point on the mobile camera coordinate system, 
                           M
                        
                        M, through m ≐ P 
                        
                           M
                        
                        M. Using the transformation from the world coordinate frame to the mobile camera, 
                           M
                        
                        TW
                        , we can rewrite it to consider points in world coordinates m ≐ P 
                        
                           M
                        
                        TW
                         
                        
                           W
                        
                        M. Using the plane constraint of floor points 
                           
                              
                                 
                                 W
                              
                              
                                 M
                                 z
                              
                              =
                              0
                           
                         we can further write it as m ≐ P 
                        
                           M
                        
                        TW
                         
                        ET
                         
                        E 
                        
                           W
                        
                        M where E is an elimination matrix removing the third row of 
                           W
                        
                        M. Inverting the system we have the projection of the point on the floor in homogeneous coordinates

                           
                              (19)
                              
                                 
                                    
                                       
                                          
                                             E
                                             
                                             
                                                
                                                W
                                             
                                             M
                                          
                                       
                                       
                                          
                                             ≐
                                             
                                                
                                                   (
                                                   P
                                                   
                                                   
                                                      
                                                      M
                                                   
                                                   
                                                      T
                                                      W
                                                   
                                                   
                                                   
                                                      E
                                                      T
                                                   
                                                   )
                                                
                                                
                                                   −
                                                   1
                                                
                                             
                                             
                                             m
                                             .
                                          
                                       
                                    
                                 
                              
                           
                        
                     

In this section we derive first order error propagation formulas, from 2D and 3D data to the calibration parameters, while using the DLT-Lines calibration process. Section 4.1 shows that line fitting helps reducing 2D noise when lines are defined by their end points. However, despite the fitting, residual 2D noise remains present due to the discrete nature of pixels, the discrete nature of pixel values and noise in the pixel values.

Uncertainty in the 3D data (points) is due to a wider variety of reasons. Assuming that 3D data is acquired by a sensor such as a LIDAR or an RGBD camera, then error in the estimated pose of the sensor or error in the intrinsic parameters of the sensor or the discretization of the sensor inputs, are all sources of uncertainty. For example, an offset in the real location of a sensor implies also an offset in the position of the calibrated camera. Error in the intrinsic parameters of the 3D sensor may induce artificial zooming in the calibrated camera.

Having indicated a number of common sources of uncertainty, we detail now the uncertainty propagation analysis through the DLT-Lines calibration methodology. In a first step we derive the expression propagating error in the calibration data to error in the estimated lines parameters ①. In a second step, ②, we derive error propagation between lines parameters and the 3D data to the camera projection matrix. In a third step, ③, we derive error propagation from the matrix entries to the camera projection center, orientation and intrinsic parameters. The whole process can be summarized as shown in the next diagram

                        
                           
                              
                                 
                                    
                                       
                                          
                                             
                                                m
                                                i
                                             
                                             ,
                                             
                                                M
                                                i
                                             
                                          
                                       
                                       
                                          
                                             →
                                             ①
                                          
                                       
                                       
                                          
                                             
                                                l
                                                i
                                             
                                             ,
                                             
                                                M
                                                i
                                             
                                          
                                       
                                       
                                          
                                             →
                                             ②
                                          
                                       
                                       
                                          P
                                       
                                       
                                          
                                             →
                                             ③
                                          
                                       
                                       
                                          
                                             K
                                             ,
                                             R
                                             ,
                                             t
                                          
                                       
                                       
                                          
                                             M
                                             W
                                          
                                       
                                    
                                    
                                       
                                          
                                             
                                                Σ
                                                
                                                   m
                                                   i
                                                
                                             
                                             ,
                                             
                                                Σ
                                                
                                                   M
                                                   i
                                                
                                             
                                          
                                       
                                       
                                          →
                                       
                                       
                                          
                                             
                                                Σ
                                                
                                                   l
                                                   i
                                                
                                             
                                             ,
                                             
                                                Σ
                                                
                                                   M
                                                   i
                                                
                                             
                                          
                                       
                                       
                                          →
                                       
                                       
                                          
                                             Σ
                                             P
                                          
                                       
                                       
                                          →
                                       
                                       
                                          
                                             
                                                Σ
                                                K
                                             
                                             ,
                                             
                                                Σ
                                                R
                                             
                                             ,
                                             
                                                Σ
                                                t
                                             
                                          
                                       
                                       
                                          
                                             Σ
                                             
                                                M
                                                W
                                             
                                          
                                       
                                    
                                 
                                 .
                              
                           
                        
                     
                  

While Section 3 discussed how to compute the solution to ①, ② and ③, this section will propagate the covariance information through these same transformations. The general rule used is that given a function 
                        
                           y
                           =
                           F
                           (
                           x
                           )
                        
                      and assuming F is differentiable near a particular x, a first order covariance propagation Σy
                      is obtained from the input noise covariance as 
                        
                           
                              Σ
                              y
                           
                           =
                           
                              J
                              F
                           
                           
                              Σ
                              x
                           
                           
                              J
                              F
                              T
                           
                        
                     .

Transformation ① is explicitly available so the Jacobian is readily computable. Since the covariance of the line measurements is obtained
                      from two image points, it can be computed as

                        
                           (20)
                           
                              
                                 
                                    Σ
                                    
                                       l
                                       i
                                    
                                 
                                 =
                                 
                                    J
                                    
                                       l
                                       i
                                    
                                 
                                 
                                    Σ
                                    
                                       
                                          m
                                          
                                             1
                                             i
                                          
                                       
                                       ,
                                       
                                          m
                                          
                                             2
                                             i
                                          
                                       
                                    
                                 
                                 
                                    J
                                    
                                       l
                                       i
                                    
                                    T
                                 
                              
                           
                        
                     where 
                        
                           J
                           
                              l
                              i
                           
                        
                      is the Jacobian of either (5) or (10). The covariance matrix of the imaged line-segment end points, 
                        
                           
                              Σ
                              
                                 
                                    m
                                    
                                       1
                                       i
                                    
                                 
                                 ,
                                 
                                    m
                                    
                                       2
                                       i
                                    
                                 
                              
                           
                           ,
                        
                      is usually set a-priory according to typical user-clicking errors. Alternatively, in case one uses a line fitting process (Section 4.1), the edge points near the fitted line inform about the fitting error, 
                        
                           
                              Σ
                              
                                 l
                                 i
                              
                           
                           ,
                        
                      which is transformed to error at the line-segment end points.

The same approach cannot be used for ② and ③ where no closed form expression is known, as they are computed using numeric algorithms. Nonetheless, since an implicit characterization of these transformations exists, the Jacobian is computable using the implicit function theorem [44]. Given a system of equations 
                        
                           G
                           (
                           x
                           ,
                           y
                           )
                           =
                           0
                        
                      defining implicitly an unknown function 
                        
                           y
                           =
                           F
                           (
                           x
                           )
                        
                      satisfying the theorem conditions, the Jacobian of F can be computed from the derivatives of G as 
                        
                           
                              J
                              F
                           
                           =
                           −
                           
                              
                                 [
                                 
                                    D
                                    y
                                 
                                 G
                                 ]
                              
                              
                                 −
                                 1
                              
                           
                           
                              D
                              x
                           
                           G
                        
                      where DxG and DyG are the partial derivatives of G with respect to x and y, respectively. The implicit function theorem requires the matrix DyG to be invertible, a condition we assume to be true in this paper, as otherwise the input data consists of a singular case where a calibration solution is not possible. The rest of this section will make this propagation explicit for the two cases (with and without radial distortion).


                        DLT-Lines allows filtering the input data by using line fitting methodologies. This is beneficial as the uncertainty before ① can be attenuated and, consequently, obtaining more precise and accurate calibrations. In this section we detail the image line fitting methodology we use and study its effect on noisy data.

Each extracted 2D-line li
                         can be the result of fine tuning a line 
                           
                              l
                              ^
                           
                         to better match edge points in an image. The user defines 
                           
                              l
                              ^
                           
                         by clicking the two ends of the line. Line 
                           
                              l
                              ^
                           
                         allows defining gradient values, ∇I in a direction perpendicular to 
                           
                              l
                              ^
                           
                        . Line li
                         is therefore refined to better match the image appearance by an optimization process that maximizes the sum of image gradients and passes through a constant texture

                           
                              (21)
                              
                                 
                                    
                                       l
                                       i
                                       *
                                    
                                    =
                                    
                                       arg
                                       
                                          l
                                          i
                                       
                                    
                                    max
                                    
                                       ∑
                                       k
                                    
                                    
                                       ∥
                                       
                                          ∇
                                          I
                                          (
                                          
                                             m
                                             k
                                          
                                          )
                                       
                                       ∥
                                    
                                    −
                                    β
                                    
                                       σ
                                       
                                          I
                                          (
                                          
                                             m
                                             k
                                          
                                          )
                                       
                                    
                                    ,
                                    
                                    
                                       m
                                       k
                                    
                                    ∈
                                    
                                       (
                                       
                                          l
                                          i
                                       
                                       ∩
                                       R
                                       )
                                    
                                 
                              
                           
                        where I is the RGB image converted to gray scale, ∇ denotes the image gradient in the direction orthogonal to 
                           
                              
                                 l
                                 ^
                              
                              ,
                           
                        
                        
                           
                              σ
                              
                                 I
                                 (
                                 
                                    m
                                    k
                                 
                                 )
                              
                           
                         is the local image variance, β is a constant gain, and 
                           R
                         is a region of interest containing the straight-line segment plus some tolerance (e.g. ±10 pixel) around the segment extremes. This refinement procedure is illustrated in Fig. 2. Frame (a) shows the initialization of the algorithm. In this case, the algorithm was initialized with a significant error (see red line). After the optimization procedure one can see that the line was correctly estimated, frame (c). Frames (b) and (d) show that image gradient values at line points (black line) are maximized by the procedure.

After the optimization procedure, one obtains line end points, m
                        1 and m
                        2, whose error is propagated to the line as 
                           
                              
                                 l
                                 ^
                              
                              =
                              l
                              +
                              ϵ
                              ,
                           
                         where 
                           ϵ
                         is the estimation error. The error 
                           ϵ
                         has only significant impact on the line parameters if m
                        1 and m
                        2 are close to each other. If the points are far way, e.g. 
                           
                              
                                 ∥
                              
                              
                                 m
                                 
                                    1
                                    x
                                 
                              
                              −
                              
                                 m
                                 
                                    2
                                    x
                                 
                              
                              
                                 ∥
                                 ≫
                                 ∥
                              
                              
                                 ϵ
                                 x
                              
                              
                                 ∥
                                 ,
                              
                           
                         the pixel error can be almost ignored, 
                           
                              
                                 l
                                 ^
                              
                              
                                 =
                                 l
                                 /
                                 ∥
                              
                              
                                 
                                    n
                                    l
                                 
                                 ^
                              
                              
                                 ∥
                                 +
                                 ϵ
                                 /
                                 ∥
                              
                              
                                 
                                    n
                                    l
                                 
                                 ^
                              
                              
                                 ∥
                                 ,
                              
                           
                         since 
                           
                              
                                 ∥
                              
                              
                                 
                                    n
                                    l
                                 
                                 ^
                              
                              
                                 ∥
                                 ≫
                                 ∥
                                 ϵ
                                 ∥
                                 ⇒
                                 ϵ
                                 /
                                 ∥
                              
                              
                                 
                                    n
                                    l
                                 
                                 ^
                              
                              
                                 ∥
                                 ≈
                                 0
                              
                           
                        .

In order to study the estimation error of the line parameters we run a Monte Carlo test with a simple line fitting algorithm. The test consists in finding a line in an image, given two initial end points. Fig. 3(a-right) shows the typical image used. The test encompasses several different lines, i.e. with different angles, sizes, and sub-pixel translations. Fig. 3(a-left) shows a subset of the line orientation and sizes used. In the Monte Carlo simulation we initialized every line fitting with random uniform noise, between 
                           
                              −
                              4
                           
                         and 4 pixels in each of the u and v directions (see Fig. 3(b)).

The blue dots in Fig. 3(c) show initialization and fitting errors. The initialization error (horizontal axis) is the distance from the initialization line end points to the ground truth line, which has an approximately uniform distribution between 0 and 
                           
                              4
                              
                                 2
                              
                           
                         pixel, caused by the noise shown in Fig. 3(b). The fitting error (vertical axis) is the distance from the estimated line end points to the ground truth line and has a less than 1 pixel mean error. The red line has unitary slope and thus indicates noise reduction or amplification for blue points under or over the red line. One observes that in general fitting reduces noise except when the initialization noise is already subpixel. Fig. 3(d) is a box plot indicating median, 25th and 75th percentiles, which is obtained from (c) by splitting the horizontal axis in a number of regions. This plot shows that fitting error is approximately constant in the 75th percentiles of subpixel range, and therefore indicates an algorithm that upon convergence is independent on the initialization error.


                        Fig. 3(e) shows initialization and fitting errors as histograms. The initialization error has an approximately uniform distribution, while the fitting error has an histogram shifted to subpixel error as desired. Fig. 3(f) shows, as expected, that the angular distance (
                           
                              arccos
                              
                                 
                                    
                                       n
                                       l
                                    
                                    ^
                                 
                                 T
                              
                              
                                 n
                                 l
                              
                           
                        ) between the estimated line and the real line improves with the line width as shown in [12,45].

This section explores the sensitivity of the process ②, namely how error propagates from 
                           
                              
                                 Σ
                                 
                                    l
                                    i
                                 
                              
                              ,
                              
                                 Σ
                                 
                                    M
                                    i
                                 
                              
                           
                         to ΣP
                         when it is solved with a least squares (7).

The optimization problem in (8) can be seen as function that accepts lines (li
                        ) and points (Mi
                        ) and outputs the least squares estimate of the projection matrix P
                        
                           
                              (22)
                              
                                 
                                    P
                                    =
                                    f
                                    (
                                    
                                       l
                                       1
                                    
                                    ,
                                    …
                                    ,
                                    
                                       l
                                       N
                                    
                                    ,
                                    
                                       M
                                       1
                                    
                                    ,
                                    …
                                    ,
                                    
                                       M
                                       N
                                    
                                    )
                                    .
                                 
                              
                           
                        To compute the covariance propagation we need the Jacobian of f, i.e. Jf
                        . Although f does not have an explicit solution (it is the result of an optimization problem), an implicit system can be written from the KKT conditions of the constrained least squares problem in (8).

                           
                              (23)
                              
                                 
                                    G
                                    
                                       (
                                       l
                                       ,
                                       M
                                       ;
                                       p
                                       ,
                                       γ
                                       )
                                    
                                    =
                                    
                                       {
                                       
                                          
                                             
                                                
                                                   2
                                                   
                                                      B
                                                      
                                                         (
                                                         l
                                                         ,
                                                         M
                                                         )
                                                      
                                                   
                                                   p
                                                   +
                                                   2
                                                   γ
                                                   p
                                                   =
                                                   0
                                                   ,
                                                
                                             
                                          
                                          
                                             
                                                
                                                   
                                                      p
                                                      T
                                                   
                                                   p
                                                   −
                                                   1
                                                   =
                                                   0
                                                   .
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           
                        The implicit function theorem can then be used to provide

                           
                              
                                 
                                    
                                       J
                                       f
                                    
                                    =
                                    
                                       
                                          [
                                          
                                             −
                                             
                                                
                                                   (
                                                   
                                                      D
                                                      
                                                         {
                                                         
                                                            p
                                                            ,
                                                            γ
                                                         
                                                         }
                                                      
                                                   
                                                   G
                                                   )
                                                
                                                
                                                   −
                                                   1
                                                
                                             
                                             
                                                D
                                                
                                                   {
                                                   
                                                      l
                                                      i
                                                   
                                                   ,
                                                   
                                                      M
                                                      i
                                                   
                                                   }
                                                
                                             
                                             G
                                          
                                          ]
                                       
                                       
                                          12
                                          ×
                                          6
                                          N
                                       
                                    
                                 
                              
                           
                        
                     

where the brackets denote taking only the first 12 rows of the result since the last row is the row equivalent to the Lagrange multiplier γ.

Suppose we have used sets 
                           
                              m
                              ^
                           
                         and 
                           
                              M
                              ^
                           
                         to estimate p using the Gauss–Newton algorithm. Although 
                           
                              p
                              =
                              f
                              (
                              l
                              ,
                              e
                              ,
                              M
                              )
                           
                         does not have an explicit formulation again, we can use the implicit function theorem to compute the Jacobian of the method

                           
                              
                                 
                                    
                                       J
                                       f
                                    
                                    =
                                    
                                       
                                          [
                                          
                                             −
                                             
                                                
                                                   (
                                                   
                                                      D
                                                      
                                                         {
                                                         
                                                            p
                                                            ,
                                                            σ
                                                            ,
                                                            v
                                                         
                                                         }
                                                      
                                                   
                                                   G
                                                   )
                                                
                                                
                                                   −
                                                   1
                                                
                                             
                                             
                                                D
                                                
                                                   {
                                                   l
                                                   ,
                                                   e
                                                   ,
                                                   M
                                                   }
                                                
                                             
                                             G
                                          
                                          ]
                                       
                                       
                                          12
                                          ×
                                          6
                                          N
                                       
                                    
                                    ,
                                 
                              
                           
                        
                     

where G is the KKT system in (16), and whose derivatives are given in (18). Uncertainty can thus be propagated as

                           
                              (24)
                              
                                 
                                    
                                       Σ
                                       p
                                    
                                    =
                                    
                                       J
                                       f
                                    
                                    
                                       Σ
                                       
                                          l
                                          ,
                                          e
                                          ,
                                          M
                                       
                                    
                                    
                                       J
                                       f
                                       T
                                    
                                 
                              
                           
                        
                     

In [7] it is show how the projection matrix can be decomposed by the internal and external calibration parameters. Here we propagate the uncertainty from ΣP
                         to Σ
                        
                           K,R,t
                        , ③.

We start by looking at (1), noticing that we can divide P in two blocks, 
                           
                              
                                 P
                                 
                                    3
                                    ×
                                    3
                                 
                              
                              =
                              K
                              R
                           
                         and 
                           
                              
                                 p
                                 4
                              
                              =
                              K
                              t
                           
                        . Once again an explicit solution does not exist; however, the separation of P into two blocks defines an implicit system if we take into account the upper triangular structure of K and that R is a rotation matrix

                           
                              
                                 
                                    
                                       
                                          
                                             G
                                             
                                                (
                                                P
                                                ,
                                                K
                                                ,
                                                R
                                                ,
                                                t
                                                )
                                             
                                             =
                                             
                                                {
                                                
                                                   
                                                      
                                                         
                                                            
                                                               
                                                                  
                                                                     P
                                                                     
                                                                        3
                                                                        ×
                                                                        3
                                                                     
                                                                  
                                                               
                                                               
                                                                  
                                                                     =
                                                                     K
                                                                     R
                                                                  
                                                               
                                                            
                                                            
                                                               
                                                                  
                                                                     p
                                                                     4
                                                                  
                                                               
                                                               
                                                                  
                                                                     =
                                                                     K
                                                                     t
                                                                  
                                                               
                                                            
                                                            
                                                               
                                                                  
                                                                     
                                                                        R
                                                                        T
                                                                     
                                                                     R
                                                                  
                                                               
                                                               
                                                                  
                                                                     =
                                                                     I
                                                                  
                                                               
                                                            
                                                            
                                                               
                                                                  
                                                                     K
                                                                     21
                                                                  
                                                               
                                                               
                                                                  
                                                                     =
                                                                     0
                                                                  
                                                               
                                                            
                                                            
                                                               
                                                                  
                                                                     K
                                                                     31
                                                                  
                                                               
                                                               
                                                                  
                                                                     =
                                                                     0
                                                                  
                                                               
                                                            
                                                            
                                                               
                                                                  
                                                                     K
                                                                     32
                                                                  
                                                               
                                                               
                                                                  
                                                                     =
                                                                     0
                                                                     ,
                                                                  
                                                               
                                                            
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           
                        The derivatives of this implicit system are

                           
                              (25)
                              
                                 
                                    
                                       J
                                       G
                                    
                                    =
                                    
                                       [
                                       
                                          
                                             
                                                
                                                   −
                                                   I
                                                
                                             
                                             
                                                0
                                             
                                             
                                                
                                                   I
                                                   ⊗
                                                   K
                                                
                                             
                                             
                                                
                                                   
                                                      R
                                                      T
                                                   
                                                   ⊗
                                                   I
                                                
                                             
                                             
                                                0
                                             
                                          
                                          
                                             
                                                0
                                             
                                             
                                                
                                                   −
                                                   I
                                                
                                             
                                             
                                                0
                                             
                                             
                                                
                                                   
                                                      t
                                                      T
                                                   
                                                   ⊗
                                                   I
                                                
                                             
                                             
                                                K
                                             
                                          
                                          
                                             
                                                0
                                             
                                             
                                                0
                                             
                                             
                                                
                                                   
                                                      (
                                                      
                                                         I
                                                         9
                                                      
                                                      +
                                                      
                                                         C
                                                         
                                                            3
                                                            ×
                                                            3
                                                         
                                                      
                                                      )
                                                   
                                                   
                                                      (
                                                      I
                                                      ⊗
                                                      
                                                         R
                                                         T
                                                      
                                                      )
                                                   
                                                
                                             
                                             
                                                0
                                             
                                             
                                                0
                                             
                                          
                                          
                                             
                                                0
                                             
                                             
                                                0
                                             
                                             
                                                
                                                   
                                                      1
                                                   
                                                   2
                                                   T
                                                
                                             
                                             
                                                0
                                             
                                             
                                                0
                                             
                                          
                                          
                                             
                                                0
                                             
                                             
                                                0
                                             
                                             
                                                
                                                   
                                                      1
                                                   
                                                   3
                                                   T
                                                
                                             
                                             
                                                0
                                             
                                             
                                                0
                                             
                                          
                                          
                                             
                                                0
                                             
                                             
                                                0
                                             
                                             
                                                
                                                   
                                                      1
                                                   
                                                   6
                                                   T
                                                
                                             
                                             
                                                0
                                             
                                             
                                                0
                                             
                                          
                                       
                                       ]
                                    
                                    ,
                                 
                              
                           
                        where C
                        3×3 is a 9 × 9 circulant matrix (i.e., it is the matrix that makes 
                           
                              v
                              e
                              c
                              
                                 (
                                 
                                    R
                                    T
                                 
                                 )
                              
                              =
                              
                                 C
                                 
                                    3
                                    ×
                                    3
                                 
                              
                              v
                              e
                              c
                              
                                 (
                                 R
                                 )
                              
                           
                         true for any 3 × 3 matrix R), and 
                           
                              
                                 1
                              
                              i
                              T
                           
                         is a vector 9 × 1 of zeros with 1 in position i. Note that the constraints 
                           
                              
                                 R
                                 T
                              
                              R
                              =
                              I
                           
                         are redundant (symmetric), hence we manually remove the rows of JG
                         corresponding to the redundant equations. Once again we can use the implicit function theorem to find 
                           
                              
                                 J
                                 f
                              
                              =
                              −
                              
                                 
                                    [
                                    
                                       D
                                       
                                          K
                                          ,
                                          R
                                          ,
                                          T
                                       
                                    
                                    G
                                    ]
                                 
                                 
                                    −
                                    1
                                 
                              
                              
                                 D
                                 P
                              
                              G
                           
                        .

The estimation of ΣKRT
                         can be obtained by

                           
                              (26)
                              
                                 
                                    
                                       Σ
                                       
                                          K
                                          ,
                                          R
                                          ,
                                          T
                                       
                                    
                                    =
                                    
                                       J
                                       F
                                    
                                    
                                       Σ
                                       P
                                    
                                    
                                       J
                                       F
                                       T
                                    
                                    .
                                 
                              
                           
                        These equations are valid for both calibration methodologies, with and without radial distortion.

Propagating uncertainty from a camera point m to the world floor takes into account three sources of uncertainty: the camera point m itself, the camera position represented by the projection matrix P and the mobile camera position represented by 
                           M
                        
                        TW
                        . Eq. (19) provides an explicit equation but due to the inverse function involved, its derivatives are not trivial to compute. We do so in two steps, first interpreting (19) as an equality and then applying the normalization. The derivative of the equality with respect to m, P, and 
                           M
                        
                        TW
                         is

                           
                              
                                 
                                    D
                                    =
                                    
                                       [
                                       Q
                                       −
                                       
                                          m
                                          T
                                       
                                       
                                       
                                          Q
                                          T
                                       
                                       
                                       E
                                       
                                       
                                          
                                          M
                                       
                                       
                                          T
                                          W
                                          T
                                       
                                       ⊗
                                       Q
                                       −
                                       
                                          m
                                          T
                                       
                                       
                                       Q
                                       
                                       E
                                       ⊗
                                       Q
                                       
                                       P
                                       ]
                                    
                                 
                              
                           
                        where 
                           
                              Q
                              =
                              
                                 
                                    (
                                    P
                                    
                                    
                                       
                                       M
                                    
                                    
                                       T
                                       W
                                    
                                    
                                    
                                       E
                                       T
                                    
                                    )
                                 
                                 
                                    −
                                    1
                                 
                              
                           
                        . After applying the projective normalization, the complete Jacobian of (19) is

                           
                              
                                 
                                    
                                       
                                          
                                             J
                                             =
                                             
                                                [
                                                
                                                   
                                                      
                                                         
                                                            1
                                                            /
                                                            z
                                                         
                                                      
                                                      
                                                         0
                                                      
                                                      
                                                         
                                                            −
                                                            x
                                                            /
                                                            
                                                               z
                                                               2
                                                            
                                                         
                                                      
                                                   
                                                   
                                                      
                                                         0
                                                      
                                                      
                                                         
                                                            1
                                                            /
                                                            z
                                                         
                                                      
                                                      
                                                         
                                                            −
                                                            y
                                                            /
                                                            
                                                               z
                                                               2
                                                            
                                                         
                                                      
                                                   
                                                
                                                ]
                                             
                                             D
                                          
                                       
                                    
                                 
                              
                           
                        where [x 
                        y 
                        z]
                           T
                         is the projective result of (19). Again, the error propagation equation is

                           
                              (27)
                              
                                 
                                    
                                       Σ
                                       
                                          x
                                          ,
                                          y
                                       
                                    
                                    =
                                    J
                                    
                                       Σ
                                       
                                          m
                                          ,
                                          P
                                          ,
                                          
                                             
                                             M
                                          
                                          
                                             T
                                             W
                                          
                                       
                                    
                                    
                                       J
                                       T
                                    
                                    .
                                 
                              
                           
                        
                     

@&#EXPERIMENTAL RESULTS@&#

In order to validate the proposed methods and uncertainty analysis we conduct some experiments in a virtual indoor environment, for which one has available precise and accurate ground truth. We show a simple real degenerate case which can be solved using DLT-Lines, with a single constrain. In addition, we apply the proposed uncertainty analysis to a real setup based on an indoor scene encompassing a wall and a couple of doors, which has been reconstructed in 3D using color-depth (RGB-D) data, thus providing directly the required 3D information for the DLT-Lines calibration methodology.

In this first experiment we illustrate the DLT-Lines calibration methodology when available data does not fully constrain the solution (see Section 3.3, Eq. (9)).

The camera to calibrate is a cellphone camera using a single image of the streets and buildings from a window in the 5th floor of a tower (see Fig. 4(a)). The terrain is uneven and therefore the zero height was selected to be defined by the roof of the large building imaged in front of the camera. The 3D calibration information is only partially available as the 3D lines are pointed in a 2D aerial (orthophoto) view and therefore lack a depth coordinate, Z (see Fig. 4(b)). Vertical lines are defined by two points 
                           
                              Z
                              =
                              0
                           
                         and 
                           
                              Z
                              =
                              1
                           
                        . Horizontal lines in the planar roofs of the building are also defined by choosing 
                           
                              Z
                              =
                              0
                           
                        . Other horizontal lines, not at the roof height, have an unknown Z.

Using only vertical and horizontal lines at the roof level, 
                           
                              Z
                              =
                              0
                              ,
                           
                         results in rank deficient problem, more precisely, 
                           
                              r
                              a
                              n
                              k
                              (
                              B
                              )
                              =
                              10
                           
                         in (7). The solution based on the two singular vectors corresponding to the least singular values, 
                           
                              p
                              =
                              
                                 w
                                 11
                              
                              
                                 v
                                 11
                              
                              +
                              
                                 w
                                 12
                              
                              
                                 v
                                 12
                              
                              ,
                           
                         has an ambiguity between the camera height and the vertical focal length. The null space is a set of camera configurations where the camera is fixed at X and Y coordinates while Z varies. As the Z gets higher the camera is rotated downwards and the vertical focal length is augmented so that the imaging does not change.

In order to constrain the solution, we use the square pixels constraint proposed in the form of a 1D optimization problem in (9). The solution obtained, displayed graphically in Fig. 4(c), allows retrieving the camera pose (localization and rotation) and its intrinsic parameters. The estimated localization of the camera matches well the information of the aerial view (see in Fig. 4(b) the blue cross on the facade of the tower).

In addition, the known scale of the aerial (orthophoto) image allows converting the 3D calibration data and the projection matrix into meter units. Consequently, it is possible also to infer in meter units some distances in the scenario, such as heights of buildings. The estimated height of the building observed in the middle of the image is 11.0 meters which can be compared with the height read in blueprints, 10.4 meters, yielding an experimental error of just 6% justified by data noise.

In this section the variance of the entries of the projection matrix, ΣP
                        , predicted using the proposed uncertainty analysis is compared with a Monte Carlo based uncertainty analysis. The experiments are done using synthetic data (VRML) which allows us to define with high accuracy a camera location and a set of fixed image points and the corresponding set of 3D points. We consider various levels of white Gaussian noise in image points, 3D points, or both. Experiments are conducted in three different scenarios in order to show that the proposed uncertainty propagation methodology effectively takes into account the structure of the scenario.
                           3
                        
                        
                           3
                           The decomposition of estimated projection matrix, detailed in [7], allows factorizing the intrinsic and extrinsic parameters as 
                                 
                                    P
                                    =
                                    K
                                    [
                                    R
                                    
                                    t
                                    ]
                                    ,
                                 
                               and therefore comparing them with the ground truth. The horizontal focal length relative error is defined as 
                                 
                                    
                                       K
                                       
                                          e
                                          r
                                          r
                                       
                                    
                                    =
                                    
                                       (
                                       K
                                       
                                          (
                                          1
                                          ,
                                          1
                                          )
                                       
                                       −
                                       
                                          K
                                          e
                                       
                                       
                                          (
                                          1
                                          ,
                                          1
                                          )
                                       
                                       )
                                    
                                    /
                                    K
                                    
                                       (
                                       1
                                       ,
                                       1
                                       )
                                    
                                    ,
                                 
                               where K is the VRML camera true intrinsic parameters matrix, Ke
                               is the estimated one and 
                                 
                                    K
                                    
                                       (
                                       3
                                       ,
                                       3
                                       )
                                    
                                    =
                                    
                                       K
                                       e
                                    
                                    
                                       (
                                       3
                                       ,
                                       3
                                       )
                                    
                                    =
                                    1
                                 
                              .
                        
                     

The first setup is based on a single RGBD camera. The setup can be seen in Fig. 5
                        (a), which corresponds to a typical ‘L’ shaped corridor, the overal setup can be seen in Fig. 5(b). Camera calibration ground truth is known and is used to assess the validity of the noise propagation estimation method and the accuracy of the calibration. Fig. 5(c) shows the theoretical value for σ
                        
                           P(2,4) in the presence of noise simultaneously in both the image and the range values. The plot shows the correlated effects between the image and range noise values.

Monte Carlo simulations were also run for this setup. Plots (d) and (e) show both the analytic and estimated value of σ for P(2, 4) as a function of variations in image and depth noise.

Plot (d) shows once more that the first order approximation is only valid up to around 
                           
                              
                                 σ
                                 m
                              
                              =
                              3
                           
                         pixels. The theoretical prediction is nevertheless accurate for lower levels of noise showing that the proposed uncertainty analysis takes correctly into account the scene structure (li, Mi
                        ). Noise in range data exhibits less non-linear effects, as shown in plot (e).

The second synthetic setup is formed by two cameras, namely a mobile color-depth (RGBD) camera which collects 3D data and a fixed RGB camera (Fig. 6(a)); in this setup the cameras have different optical centers and orientations. Fig. 6(b) shows a synthetic image acquired by the RGB camera, while Fig. 6(c) and (d) shows the synthetic intensity and range images aquired by the RGBD camera.

In this setup, we analyze what happens when just the RGB image has noise. In other words, the noise in 3D points is set null (
                           
                              
                                 σ
                                 M
                              
                              =
                              0
                           
                        ).
                           4
                        
                        
                           4
                           To improve readability, variance is written using upper case, Σ, and standard deviation is written using lower case, σ.
                         Uncertainty analysis was done using both the proposed propagation methodology and Monte Carlo simulations. Monte Carlo was configured to do 300 runs for each level of noise. The standard deviation of the noise in the 2D points varies from 0 to 6 pixels (
                           
                              
                                 σ
                                 m
                              
                              =
                              
                                 0
                                 :
                                 .
                                 06
                                 :
                                 6
                              
                           
                         pixels). Having all the runs, the variance of every entry of P, i.e. Σ
                        
                           P(ij) for 
                           
                              i
                              =
                              1
                              .
                              .
                              3
                           
                         and 
                           
                              j
                              =
                              1
                              .
                              .
                              4
                              ,
                           
                         has been estimated.
                        
                     

The linear propagation of the standard deviation of each of the entries of P, computed with the proposed methodology, is shown in Fig. 6(e). As expected some entries of P are more robust to noise than others. Fig. 6(f) shows the Monte Carlo simulation results for each level of noise, again for all the entries of P. Plots (f) and (g) indicate that the analytical values obtained using the linear propagation analysis match those of Monte Carlo results for values of σm
                         lower than approximately 3 pixels. Nonlinearities have more incidence for large image noise, making our first order approximation unreliable. Nonetheless, pixel value noises in ranges below 3 pixels are acceptable for most imaging sensors.

The final synthetic experiment was done with two cameras, as the previews one, a fixed RGB camera and a mobile color-depth (RGBD) camera which collects 3D data (see Fig. 7(a)). However in this case the RGB camera has radial distortion, Fig. 7(b). Fig. 7(c) and (d) shows respectively the RGBD intensity and 3D range data. Fig. 7(e) shows a set of 3D lines given to the calibration algorithm, in red is the RGBD camera position and orientation, while in blue is the camera with radial distortion to calibrate. The proposed uncertainty analysis was once again compared to Monte Carlo simulations. In this case the standard deviation of noise in 2D varies from 0 to 4 pixels (
                           
                              
                                 σ
                                 m
                              
                              =
                              
                                 0
                                 :
                                 .
                                 05
                                 :
                                 4
                              
                           
                         pixels). For each level of noise we did 400 runs. The theoretical prediction of ΣP
                         is plotted in Fig. 7(f), while Fig. 7(g) shows the Monte Carlo results. We can observe that the theoretical results are in accordance with the Monte Carlo simulations. Fig. 7(h) shows the theoretical and the Monte Carlo Σλ
                        . Once again both results are similar empirically confirming the correctness of our approach.

In this section we present the results of our algorithm in a real data set acquired in a typical indoor scene, with several doors and a corridor, see Fig. 8(b). This experiment was done with a ASUS X-Tion (RGBD camera) mounted in a mobile robot, Fig. 8(a), and Axis P1347 (typical RGB surveillance camera). The RGB image used for calibration is shown in Fig. 8(e), and has resolution of 1920 by 2560 pixels. Twenty lines were marked in the calibration process. This camera has significant radial distortion (see for example the first door in the left). Fig. 8(c) shows the depth image of the RGBD sensor and Fig. 8(b) shows its intensity image, where the same set of 20 lines that can be seen in the RGB images are overlayed. The intensity and depth images have the same resolution, 480 by 640 pixels. 3751 3D points along the 20 lines where automatically sampled.

The calibration was done using DLT-Lines with radial distortion. Fig. 8(f) shows the original image without radial distortion. Fig. 8(d) shows the theoretical evolution of σt
                         in the presence of white Gaussian noise in the RGB camera. The plot shows the prediction of σt
                         for different levels of σm
                        , namely from 0 to 3 pixels. Fig. 8(g) shows the result of the calibration algorithm, namely the estimated pose and the position uncertainty of the RGB camera. The uncertainty, represented as an ellipsoid, was estimated assuming a white Gaussian noise with 
                           
                              
                                 σ
                                 m
                              
                              =
                              1.5
                           
                         pixels in the RGB while the 3D noise was set to zero, 
                           
                              
                                 σ
                                 M
                              
                              =
                              0
                           
                         m. Fig. 8(h) shows uncertainty at the floor plane, 
                           
                              Z
                              =
                              0
                           
                         m, for a number of image points given the estimated calibration uncertainty. As expected the uncertainty gets higher as the selected points gets farther from the camera. This is mainly explained by foreshortening. Due to the perspective view of the camera, as we get closer to the vanishing line of the ground plane the 3D distance between each pixel approaches infinity. As a result the uncertainty tends towards infinity.

@&#CONCLUSIONS@&#

In this work we presented uncertainty analysis for two in-situ camera calibration methodologies, namely DLT-Lines and DLT-Lines with radial distortion. We provide analytical solutions to uncertainty propagation from errors on the input data to the estimated parameters and empirically verify the validity of the analysis with Monte Carlo simulations. From the uncertainty in the projection matrix we derive (i) the uncertainty in intrinsic and extrinsic parameters, including radial distortion, and (ii) the uncertainty of 3D points in the ground plane.

We tested our methodologies both in a virtual environment with ground truth and with real cameras. In particular we demonstrated uncertainty propagation to the camera location and to points in the ground plane.

In the future work we will focus in finding structures that allow lower variances in the camera parameters. We also will focus in finding points and lines that increase the accuracy of the calibration.

@&#ACKNOWLEDGMENTS@&#

This work has been partially supported by the FCT project [UID/EEA/50009/2013], by the MINECO project DPI2011-27510, and by the EU Projects POETICON++EU-FP7-ICT-288382 and Cargo-ANTs FP7-SST-605598. The authors thank Manuel Silva for the valuable initial datasets.

@&#REFERENCES@&#

