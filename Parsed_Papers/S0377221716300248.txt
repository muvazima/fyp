@&#MAIN-TITLE@&#An iterative two-phase hybrid matheuristic for a multi-product short sea inventory-routing problem

@&#HIGHLIGHTS@&#


               
               
                  
                     
                        
                           
                           Presents a continuous time, multiple-product short sea inventory-routing problem.


                        
                        
                           
                           A hybrid matheuristic is developed.


                        
                        
                           
                           A regular maritime routing and scheduling problem is solved as a subproblem.


                        
                        
                           
                           Extensive testing shows that the matheuristic is efficient and effective.


                        
                     
                  
               
            

@&#KEYPHRASES@&#

Maritime transportation

Inventory-routing

Supply chain management

Adaptive large neighborhood search

Many-to-many distribution problem

@&#ABSTRACT@&#


               
               
                  This paper considers a multi-product short sea inventory-routing problem in which a heterogeneous fleet of ships transports multiple products from production sites to consumption sites in a continuous time framework. A many-to-many distribution structure is taken into account, which makes it extremely hard to even compute feasible solutions. We propose an iterative two-phase hybrid matheuristic called Hybrid Cargo Generating and Routing (HCGR) to solve the problem. In the first phase the inventory-routing problem is converted into a ship routing and scheduling problem by generating cargoes subject to inventory limits through the use of mathematical programming. In the second phase, an adaptive large neighborhood search solves the resulting ship routing and scheduling problem. The HCGR heuristic iteratively modifies the generated cargoes based on information obtained during the process. The proposed heuristic is compared with an exact algorithm on small size instances; computational results are also presented on larger and more realistic instances.
               
            

@&#INTRODUCTION@&#

Short sea shipping is one of the major modes of transportation for countries with a long shoreline or with many islands or rivers. In 2012, short sea shipping in the European Union (EU) countries accounted for nearly 1.8 billion tons of freight and for 60 percent of the total EU maritime transportation of goods (Eurostat, 2014). In short sea shipping, ships operate within a continent, make frequent port calls and often carry several products simultaneously. In contrast, in deep sea shipping, ships are much larger and sail between continents. The route structure for ships in deep sea operations is often simpler with pickup areas in one continent, and delivery areas in another. In short sea shipping, the sailing legs are relatively short compared to the time spent in ports. The port time consists of the sailing time in the inner port area, the berthing time, the set up time required for loading and unloading the equipment, and the actual loading and unloading time.

In maritime transportation, there are often inventories located at both the loading and the unloading ports. When the actors involved in a maritime supply chain have the responsibility for both the transportation of the cargoes and the inventories at the ports, the underlying planning problem is called a maritime inventory-routing problem (MIRP) (Christiansen, Fagerholt, Nygreen, & Ronen, 2013). These inventory-routing problems are very complex. Because the shipping industry is capital intensive, a modest improvement in fleet utilization can translate into a large increase in profit. This means that there exists a great potential and need for research in solving real MIRP instances.

The problem studied in this paper is a multi-product short sea inventory-routing problem (SSIRP). Maritime inventory-routing problems (MIRPs) have attracted considerable attention in the last 15 years: see the surveys on MIRPs by Andersson, Hoff, Christiansen, Hasle, and Løkketangen (2010), Coelho, Cordeau, and Laporte (2014) and Papageorgiou, Nemhauser, Sokol, Cheo, and Keha (2014), and the recent general reviews on ship routing and scheduling by Christiansen and Fagerholt (2014) and Christiansen et al. (2013). Many of the MIRPs are concerned with the transportation of a single product; see for instance the work by Agra, Andersson, Christiansen, and Wolsey (2013b), Christiansen (1999), Engineer, Furman, Nemhauser, Savelsbergh, and Song (2012), Fodstad et al. (2010), Furman, Song, Kocis, McDonald, and Warrick (2011), Goel, Furman, Song, and El-Bakry (2012), Grønhaug, Christiansen, Desaulniers, and Desrosiers (2010), Hewitt, Nemhauser, Savelsbergh, and Song (2013), Rocha et al.(2013), Shen, Chu, and Chen (2011), Sherali and Al-Yakoob, (2006a, 2006b), Song and Furman (2013) and Uggen et al. (2013). Ronen (2002) introduced a multi-product MIRP, but with no focus on ship routing. Several multi-product MIRP studies were later presented, such as those by Agra, Christiansen, and Delgado (2013a), Agra, Christiansen, Delgado, & Simonetti (2014), Al-Khayyal and Hwang (2007), Andersson (2011), Bilgen and Ozkarahan (2007), Bredström, Carlsson, and Rönnqvist (2005), Christiansen et al. (2011), Dauzère-Pérès et al. (2007), Gunnarsson, Rönnqvist, and Carlsson (2006), Li, Karimi, and Srinivasan (2010), Persson and Göthe-Lundgren (2005), Rakke et al. (2011), Rakke, Andersson, Christiansen, & Desaulniers, 2013, Siswanto, Essam, and Sarker (2011), and Stålhane et al. (2012), where the transported products include pulp, wheat, cement, slurry, bitumen, fuel oil, liquefied natural gas products and general liquid bulk. The solution approaches include exact methods such as branch-and-cut and branch-and-price, and metaheuristics such as genetic algorithms and large neighborhood search. In addition, several algorithms are matheuristics, which combine mathematical programming and heuristics, e.g. rolling horizon heuristics and various fix-and-relax heuristics. Many of the published studies are based on real cases from the industry, in which it is important to meet the demand while taking the combined inventory management and routing decisions into account. As discussed in several papers (Andersson et al., 2010; Song & Furman, 2013), most known MIRPs are special versions of a basic problem, and tailor-made methods are necessary to solve the specific problems. In this paper, we consider a more general MIRP with several products and no particular geographical structure, and we develop an efficient heuristic to solve it.

Traditionally, maritime fleet routing and scheduling have been done manually by pencil and paper or by using simple spread sheets or information systems. The planning has to a large extent been based on the planners’ knowledge and experience. Companies with combined inventory management and ship routing and scheduling issues have often handled the routing and scheduling components of the problem separately from inventory management to overcome the complex planning situation. In this way, a manual planner or simple inventory management system can produce a cargo plan that includes information about the specified quantities, pickup and delivery ports, and the time window for each cargo. Then a planner or ship routing and scheduling tool can take the specified cargoes as planning entities and design routing and scheduling plans. In Andersson et al. (2010) industrial aspects of combined inventory management and routing in maritime transportation are further discussed. These complex combined planning problems make it hard, if not impossible, to determine an optimal plan by manual planning methods or simple information systems. Therefore, the need for optimization-based decision support systems (DSSs) has increased and will probably continue to do so in the future. We have already witnessed the beginning of successful implementations of DSSs for MIPRs. Thus Dauzère-Pérès et al. (2007) describe a DSS for Omya Hustadmarmor transporting calcium carbonate slurry. Furman et al. (2011) report upon the development of a DSS for feedstock routing in the ExxonMobil downstream sector. Finally, Fodstad et al. (2010) have developed a Liquefied Natural Gas (LNG) inventory routing model for Statoil and GDF SUEZ.

The contributions of this paper lie in (1) introducing a multi-product SSIRP with a many-to-many distribution structure that is new to the literature; (2) creating realistically sized benchmark instances for the multi-product SSIRP with a many-to-many distribution structure; (3) designing a new effective and efficient iterative two-phase hybrid matheuristic, called the Hybrid Cargo Generating and Routing (HCGR) heuristic, capable of solving large and realistic instances of the multi-product SSIRP; (4) presenting a computational study which shows that the proposed heuristic can find high-quality solutions for large instances within short computing times, and including an analysis of the factors that influence the performance of the HCGR heuristic.

The remainder of this paper is organized as follows. The SSIRP is described in Section 2, together with a mathematical model of the problem. Section 3 presents the HCGR heuristic. Extensive computational results are reported and discussed in Section 4, followed by some concluding remarks in Section 5.

In the multi-product SSIRP considered in this paper, each product can be produced and consumed in any number of ports. In a particular port, there may be a net production of one or several products and a net consumption of other products. It is possible to store the products in separate capacitated facilities at the ports. The net production and consumption rates are assumed to be constant. During the planning horizon the level of each inventory must lie within fixed lower and upper limits at all times. Separate limits apply to the end of the planning horizon and these may be tighter. It is assumed that the initial inventory storage levels are known at the beginning of the planning horizon. There is no predefined rule for the sequence of loading and unloading operations, thus the ships can load or unload the products in any order. It is assumed that there are lower and upper limits on the loaded and unloaded quantities, and that the associated handling times are quantity-dependent. These operations generate fixed and variable costs. The products are transported by a heterogeneous fleet, where ships differ in attributes such as capacity, speed, and transportation cost and time. A ship may load any types of products and no allocation of products to compartments onboard the ship is considered. Partial loading and unloading is allowed, and a ship can also handle different products at the same port visit. Two or more ships cannot load or unload simultaneously at a port. Start positions of the ships are given as inputs and the ships are assumed to be empty when they arrive at the first port, as well as at the end of their route.

The multi-product short sea inventory-routing problem consists of designing routes and schedules for the fleet in order to minimize the transportation and port costs, and to determine the quantities handled at each port call without exceeding the storage limits. To define the problem precisely, we introduce a continuous time arc-flow formulation of the problem with the following notation. Throughout the paper, we use lower case letters for variables and upper case letters for parameters and sets.
                  


                     
                        Indices



                        
                           i, j:
                        
                           ports

ships

products

visit numbers in a port


                              mth
                               visit to port i
                           

direct ship movements (arcs) from port visit (i, m)to port visit (j, n)

set of ports

set of ships

set of products k that ship v can transport

set of possible port visits (i, m)for ship v
                           

set of all possible movements (i, m, j, n) for ship v
                           

1 if port i is a producer of product k; 
                                 −
                              1 if port i is a consumer of product k, and 0 if i is neither a producer nor a consumer of product k
                           

capacity of ship v
                           

minimum and maximum limits on the quantity of product k that may be unloaded or loaded at port i at each visit

time to unload or load one unit of product k at port i
                           

transportation time from ship v’s initial position to port i
                           

transportation time between ports i and j including setup time in ports by ship v
                           

length of the time horizon

upper bound on the number of visits to port i
                           

initial stock level of product k at port i
                           

net production or consumption rate of product k at port i
                           

minimum and maximum stock levels (tank capacity) of product k at port i
                           

minimum and maximum stock levels of product k at port i at the end of planning horizon

total transportation cost from ports i and j with ship v
                           

transportation cost from ship v’s origin to port i
                           

fixed cost of handling product k at port i
                           

unloading or loading cost per unit of product k at port i
                           

1 if ship v sails directly from port visit (i, m) to port visit (j, n) and 0 otherwise

1 if ship v sails directly from its initial position to port visit (i, m) and 0 otherwise

1 if ship v ends its route at port visit (i, m) and 0 otherwise

1 if ship v ends its route at the origin (it is not used) and 0 otherwise

1 if ship v arrives port i at visit number m and 0 otherwise

1 if a ship arrives port i at visit number m and 0 otherwise

1 if product k is loaded onto or unloaded from ship v at port visit (i, m) and 0 otherwise

amount of product k on board ship v when leaving from port visit (i, m)

amount of product k unloaded or loaded at port visit (i, m) by ship v
                           

start time of unloading or loading at port visit (i, m)

end time of unloading or loading at port visit (i, m)

inventory levels of product k at the start of unloading or loading at port visit (i, m)

inventory levels of product k at the end of unloading or loading at port visit (i, m)


                     Objective function
                     
                        
                           (1)
                           
                              
                                 
                                    
                                    
                                    
                                       
                                          Minimize
                                          
                                             ∑
                                             
                                                v
                                                ∈
                                                V
                                             
                                          
                                          
                                             ∑
                                             
                                                
                                                   (
                                                   
                                                      i
                                                      ,
                                                      m
                                                      ,
                                                      j
                                                      ,
                                                      n
                                                   
                                                   )
                                                
                                                ∈
                                                
                                                   S
                                                   v
                                                   X
                                                
                                             
                                          
                                          
                                             C
                                             
                                                i
                                                j
                                                v
                                             
                                             T
                                          
                                          ·
                                          
                                             x
                                             
                                                i
                                                m
                                                j
                                                n
                                                v
                                             
                                          
                                          +
                                          
                                             ∑
                                             
                                                v
                                                ∈
                                                V
                                             
                                          
                                          
                                             ∑
                                             
                                                
                                                   (
                                                   
                                                      i
                                                      ,
                                                      m
                                                   
                                                   )
                                                
                                                ∈
                                                
                                                   S
                                                   v
                                                   A
                                                
                                             
                                          
                                          
                                             C
                                             
                                                i
                                                v
                                             
                                             
                                                T
                                                O
                                             
                                          
                                          ·
                                          
                                             x
                                             
                                                i
                                                m
                                                v
                                             
                                             O
                                          
                                       
                                    
                                 
                                 
                                    
                                    
                                    
                                       
                                          +
                                          
                                             ∑
                                             
                                                v
                                                ∈
                                                V
                                             
                                          
                                          
                                             ∑
                                             
                                                
                                                   (
                                                   
                                                      i
                                                      ,
                                                      m
                                                   
                                                   )
                                                
                                                ∈
                                                
                                                   S
                                                   v
                                                   A
                                                
                                             
                                          
                                          
                                             ∑
                                             
                                                k
                                                ∈
                                                
                                                   K
                                                   v
                                                
                                             
                                          
                                          
                                             (
                                             
                                                C
                                                
                                                   i
                                                   k
                                                
                                                O
                                             
                                             ·
                                             
                                                o
                                                
                                                   i
                                                   m
                                                   v
                                                   k
                                                
                                             
                                             +
                                             
                                                C
                                                
                                                   i
                                                   k
                                                
                                                Q
                                             
                                             ·
                                             
                                                q
                                                
                                                   i
                                                   m
                                                   v
                                                   k
                                                
                                             
                                             )
                                          
                                       
                                    
                                 
                              
                           
                        
                     subject to


                     Routing constraints
                     
                        
                           (2)
                           
                              
                                 
                                    ∑
                                    
                                       
                                          (
                                          
                                             i
                                             ,
                                             m
                                          
                                          )
                                       
                                       ∈
                                       
                                          S
                                          v
                                          A
                                       
                                    
                                 
                                 
                                    x
                                    
                                       i
                                       m
                                       v
                                    
                                    O
                                 
                                 +
                                 
                                    z
                                    v
                                    O
                                 
                                 =
                                 1
                                 
                                 
                                 v
                                 ∈
                                 V
                              
                           
                        
                     
                     
                        
                           (3)
                           
                              
                                 
                                    x
                                    
                                       i
                                       m
                                       v
                                    
                                    O
                                 
                                 +
                                 
                                    ∑
                                    
                                       
                                          (
                                          
                                             j
                                             ,
                                             n
                                             ,
                                             i
                                             ,
                                             m
                                          
                                          )
                                       
                                       ∈
                                       
                                          S
                                          v
                                          X
                                       
                                    
                                 
                                 
                                    x
                                    
                                       j
                                       n
                                       i
                                       m
                                       v
                                    
                                 
                                 −
                                 
                                    w
                                    
                                       i
                                       m
                                       v
                                    
                                 
                                 =
                                 0
                                 
                                 
                                 v
                                 ∈
                                 V
                                 ,
                                 
                                 
                                    (
                                    
                                       i
                                       ,
                                       m
                                    
                                    )
                                 
                                 ∈
                                 
                                    S
                                    v
                                    A
                                 
                              
                           
                        
                     
                     
                        
                           (4)
                           
                              
                                 
                                    w
                                    
                                       i
                                       m
                                       v
                                    
                                 
                                 −
                                 
                                    ∑
                                    
                                       
                                          (
                                          
                                             i
                                             ,
                                             m
                                             ,
                                             j
                                             ,
                                             n
                                          
                                          )
                                       
                                       ∈
                                       
                                          S
                                          v
                                          X
                                       
                                    
                                 
                                 
                                    x
                                    
                                       i
                                       m
                                       j
                                       n
                                       v
                                    
                                 
                                 −
                                 
                                    z
                                    
                                       i
                                       m
                                       v
                                    
                                 
                                 =
                                 0
                                 
                                 
                                 v
                                 ∈
                                 V
                                 ,
                                 
                                 
                                    (
                                    
                                       i
                                       ,
                                       m
                                    
                                    )
                                 
                                 ∈
                                 
                                    S
                                    v
                                    A
                                 
                              
                           
                        
                     
                     
                        
                           (5)
                           
                              
                                 
                                    ∑
                                    
                                       v
                                       ∈
                                       V
                                    
                                 
                                 
                                    w
                                    
                                       i
                                       m
                                       v
                                    
                                 
                                 =
                                 
                                    y
                                    
                                       i
                                       m
                                    
                                 
                                 
                                 
                                 
                                    (
                                    
                                       i
                                       ,
                                       m
                                    
                                    )
                                 
                                 ∈
                                 
                                    S
                                    A
                                 
                              
                           
                        
                     
                     
                        
                           (6)
                           
                              
                                 
                                    y
                                    
                                       i
                                       
                                          (
                                          
                                             m
                                             −
                                             1
                                          
                                          )
                                       
                                    
                                 
                                 −
                                 
                                    y
                                    
                                       i
                                       m
                                    
                                 
                                 ≥
                                 0
                                 
                                 
                                 
                                    (
                                    
                                       i
                                       ,
                                       m
                                    
                                    )
                                 
                                 ∈
                                 
                                    S
                                    A
                                 
                                 :
                                 m
                                 ≥
                                 2
                              
                           
                        
                     
                     
                        
                           (7)
                           
                              
                                 
                                    x
                                    
                                       i
                                       m
                                       v
                                    
                                    O
                                 
                                 ,
                                 
                                 
                                    w
                                    
                                       i
                                       m
                                       v
                                    
                                 
                                 ,
                                 
                                    z
                                    
                                       i
                                       m
                                       v
                                    
                                 
                                 ∈
                                 
                                    {
                                    
                                       0
                                       ,
                                       1
                                    
                                    }
                                 
                                 
                                 
                                 v
                                 ∈
                                 V
                                 ,
                                 
                                 
                                    (
                                    
                                       i
                                       ,
                                       m
                                    
                                    )
                                 
                                 ∈
                                 
                                    S
                                    v
                                    A
                                 
                              
                           
                        
                     
                     
                        
                           (8)
                           
                              
                                 
                                    x
                                    
                                       i
                                       m
                                       j
                                       n
                                       v
                                    
                                 
                                 ∈
                                 
                                    {
                                    
                                       0
                                       ,
                                       1
                                    
                                    }
                                 
                                 
                                 
                                 v
                                 ∈
                                 V
                                 ,
                                 
                                 
                                    (
                                    
                                       i
                                       ,
                                       m
                                       ,
                                       j
                                       ,
                                       n
                                    
                                    )
                                 
                                 ∈
                                 
                                    S
                                    v
                                    X
                                 
                              
                           
                        
                     
                     
                        
                           (9)
                           
                              
                                 
                                    y
                                    
                                       i
                                       m
                                    
                                 
                                 ∈
                                 
                                    {
                                    
                                       0
                                       ,
                                       1
                                    
                                    }
                                 
                                 
                                 
                                 
                                    (
                                    
                                       i
                                       ,
                                       m
                                    
                                    )
                                 
                                 ∈
                                 
                                    S
                                    A
                                 
                              
                           
                        
                     
                     
                        
                           (10)
                           
                              
                                 
                                    z
                                    v
                                    O
                                 
                                 ∈
                                 
                                    {
                                    
                                       0
                                       ,
                                       1
                                    
                                    }
                                 
                                 
                                 
                                 v
                                 ∈
                                 V
                              
                           
                        
                     
                  


                     Loading and unloading constraints 
                     
                        
                           (11)
                           
                              
                                 
                                    x
                                    
                                       i
                                       m
                                       j
                                       n
                                       v
                                    
                                 
                                 ·
                                 
                                    (
                                    
                                       
                                          l
                                          
                                             i
                                             m
                                             v
                                             k
                                          
                                       
                                       +
                                       
                                          J
                                          
                                             j
                                             k
                                          
                                       
                                       
                                          q
                                          
                                             j
                                             n
                                             v
                                             k
                                          
                                       
                                       −
                                       
                                          l
                                          
                                             j
                                             n
                                             v
                                             k
                                          
                                       
                                    
                                    )
                                 
                                 =
                                 0
                                 
                                 v
                                 ∈
                                 V
                                 ,
                                 
                                 
                                    (
                                    
                                       i
                                       ,
                                       m
                                       ,
                                       j
                                       ,
                                       n
                                    
                                    )
                                 
                                 ∈
                                 
                                    S
                                    v
                                    X
                                 
                                 ,
                                 
                                 k
                                 ∈
                                 
                                    K
                                    v
                                 
                              
                           
                        
                     
                     
                        
                           (12)
                           
                              
                                 
                                    x
                                    
                                       i
                                       m
                                       v
                                    
                                    O
                                 
                                 ·
                                 
                                    (
                                    
                                       
                                          J
                                          
                                             i
                                             k
                                          
                                       
                                       
                                          q
                                          
                                             i
                                             m
                                             v
                                             k
                                          
                                       
                                       −
                                       
                                          l
                                          
                                             i
                                             m
                                             v
                                             k
                                          
                                       
                                    
                                    )
                                 
                                 =
                                 0
                                 
                                 
                                 v
                                 ∈
                                 V
                                 ,
                                 
                                 
                                    (
                                    
                                       i
                                       ,
                                       m
                                    
                                    )
                                 
                                 ∈
                                 
                                    S
                                    v
                                    A
                                 
                                 ,
                                 
                                 k
                                 ∈
                                 
                                    K
                                    v
                                 
                              
                           
                        
                     
                     
                        
                           (13)
                           
                              
                                 
                                    ∑
                                    
                                       k
                                       ∈
                                       
                                          K
                                          v
                                       
                                    
                                 
                                 
                                    l
                                    
                                       i
                                       m
                                       v
                                       k
                                    
                                 
                                 ≤
                                 
                                    C
                                    v
                                 
                                 ·
                                 
                                    ∑
                                    
                                       
                                          (
                                          
                                             j
                                             ,
                                             n
                                          
                                          )
                                       
                                       ∈
                                       
                                          S
                                          v
                                          A
                                       
                                    
                                 
                                 
                                    x
                                    
                                       i
                                       m
                                       j
                                       n
                                       v
                                    
                                 
                                 
                                 
                                 v
                                 ∈
                                 V
                                 ,
                                 
                                 
                                    (
                                    
                                       i
                                       ,
                                       m
                                    
                                    )
                                 
                                 ∈
                                 
                                    S
                                    v
                                    A
                                 
                              
                           
                        
                     
                     
                        
                           (14)
                           
                              
                                 
                                    
                                       Q
                                       ̲
                                    
                                    
                                       i
                                       k
                                    
                                 
                                 ·
                                 
                                    o
                                    
                                       i
                                       m
                                       v
                                       k
                                    
                                 
                                 ≤
                                 
                                    q
                                    
                                       i
                                       m
                                       v
                                       k
                                    
                                 
                                 ≤
                                 
                                    
                                       Q
                                       ¯
                                    
                                    
                                       i
                                       k
                                    
                                 
                                 ·
                                 
                                    o
                                    
                                       i
                                       m
                                       v
                                       k
                                    
                                 
                                 
                                 
                                 v
                                 ∈
                                 V
                                 ,
                                 
                                 
                                    (
                                    
                                       i
                                       ,
                                       m
                                    
                                    )
                                 
                                 ∈
                                 
                                    S
                                    v
                                    A
                                 
                                 ,
                                 
                                 k
                                 ∈
                                 
                                    K
                                    v
                                 
                              
                           
                        
                     
                     
                        
                           (15)
                           
                              
                                 
                                    ∑
                                    
                                       k
                                       ∈
                                       
                                          K
                                          v
                                       
                                    
                                 
                                 
                                    o
                                    
                                       i
                                       m
                                       v
                                       k
                                    
                                 
                                 ≥
                                 
                                    w
                                    
                                       i
                                       m
                                       v
                                    
                                 
                                 
                                 
                                 v
                                 ∈
                                 V
                                 ,
                                 
                                 
                                    (
                                    
                                       i
                                       ,
                                       m
                                    
                                    )
                                 
                                 ∈
                                 
                                    S
                                    v
                                    A
                                 
                              
                           
                        
                     
                     
                        
                           (16)
                           
                              
                                 
                                    o
                                    
                                       i
                                       m
                                       v
                                       k
                                    
                                 
                                 ≤
                                 
                                    w
                                    
                                       i
                                       m
                                       v
                                    
                                 
                                 
                                 
                                 v
                                 ∈
                                 V
                                 ,
                                 
                                 
                                    (
                                    
                                       i
                                       ,
                                       m
                                    
                                    )
                                 
                                 ∈
                                 
                                    S
                                    v
                                    A
                                 
                                 ,
                                 
                                 k
                                 ∈
                                 
                                    K
                                    v
                                 
                              
                           
                        
                     
                     
                        
                           (17)
                           
                              
                                 
                                    l
                                    
                                       i
                                       m
                                       v
                                       k
                                    
                                 
                                 ,
                                 
                                 
                                    q
                                    
                                       i
                                       m
                                       v
                                       k
                                    
                                 
                                 ≥
                                 0
                                 
                                 
                                 v
                                 ∈
                                 V
                                 ,
                                 
                                 
                                    (
                                    
                                       i
                                       ,
                                       m
                                    
                                    )
                                 
                                 ∈
                                 
                                    S
                                    v
                                    A
                                 
                                 ,
                                 
                                 k
                                 ∈
                                 
                                    K
                                    v
                                 
                              
                           
                        
                     
                     
                        
                           (18)
                           
                              
                                 
                                    o
                                    
                                       i
                                       m
                                       v
                                       k
                                    
                                 
                                 ∈
                                 
                                    {
                                    
                                       0
                                       ,
                                       1
                                    
                                    }
                                 
                                 
                                 
                                 v
                                 ∈
                                 V
                                 ,
                                 
                                 
                                    (
                                    
                                       i
                                       ,
                                       m
                                    
                                    )
                                 
                                 ∈
                                 
                                    S
                                    v
                                    A
                                 
                                 ,
                                 
                                 k
                                 ∈
                                 
                                    K
                                    v
                                 
                              
                           
                        
                     
                  


                     Time constraints
                     
                        
                           (19)
                           
                              
                                 
                                    t
                                    
                                       i
                                       m
                                    
                                    E
                                 
                                 ≥
                                 
                                    t
                                    
                                       i
                                       m
                                    
                                 
                                 +
                                 
                                    ∑
                                    
                                       v
                                       ∈
                                       V
                                    
                                 
                                 
                                    ∑
                                    
                                       k
                                       ∈
                                       
                                          K
                                          v
                                       
                                    
                                 
                                 
                                    T
                                    
                                       i
                                       k
                                    
                                    Q
                                 
                                 ·
                                 
                                    q
                                    
                                       i
                                       m
                                       v
                                       k
                                    
                                 
                                 
                                 
                                 
                                    (
                                    
                                       i
                                       ,
                                       m
                                    
                                    )
                                 
                                 ∈
                                 
                                    S
                                    A
                                 
                              
                           
                        
                     
                     
                        
                           (20)
                           
                              
                                 
                                    t
                                    
                                       i
                                       m
                                    
                                 
                                 −
                                 
                                    t
                                    
                                       i
                                       
                                          (
                                          
                                             m
                                             −
                                             1
                                          
                                          )
                                       
                                    
                                    E
                                 
                                 ≥
                                 0
                                 
                                 
                                 
                                    (
                                    
                                       i
                                       ,
                                       m
                                    
                                    )
                                 
                                 ∈
                                 
                                    S
                                    A
                                 
                                 :
                                 m
                                 ≥
                                 2
                              
                           
                        
                     
                     
                        
                           (21)
                           
                              
                                 
                                    x
                                    
                                       i
                                       m
                                       j
                                       n
                                       v
                                    
                                 
                                 ·
                                 
                                    (
                                    
                                       
                                          t
                                          
                                             i
                                             m
                                          
                                          E
                                       
                                       +
                                       
                                          T
                                          
                                             i
                                             j
                                             v
                                          
                                       
                                       −
                                       
                                          t
                                          
                                             j
                                             n
                                          
                                       
                                    
                                    )
                                 
                                 ≤
                                 0
                                 
                                 
                                 v
                                 ∈
                                 V
                                 ,
                                 
                                 
                                    (
                                    
                                       i
                                       ,
                                       m
                                       ,
                                       j
                                       ,
                                       n
                                    
                                    )
                                 
                                 ∈
                                 
                                    S
                                    v
                                    X
                                 
                              
                           
                        
                     
                     
                        
                           (22)
                           
                              
                                 
                                    ∑
                                    
                                       v
                                       ∈
                                       V
                                    
                                 
                                 
                                    T
                                    
                                       i
                                       v
                                    
                                    O
                                 
                                 ·
                                 
                                    x
                                    
                                       i
                                       m
                                       v
                                    
                                    O
                                 
                                 ≤
                                 
                                    t
                                    
                                       i
                                       m
                                    
                                 
                                 
                                 
                                 
                                    (
                                    
                                       i
                                       ,
                                       m
                                    
                                    )
                                 
                                 ∈
                                 
                                    S
                                    A
                                 
                              
                           
                        
                     
                     
                        
                           (23)
                           
                              
                                 
                                    t
                                    
                                       i
                                       m
                                    
                                 
                                 ,
                                 
                                 
                                    t
                                    
                                       i
                                       m
                                    
                                    E
                                 
                                 ≥
                                 0
                                 
                                 
                                 
                                    (
                                    
                                       i
                                       ,
                                       m
                                    
                                    )
                                 
                                 ∈
                                 
                                    S
                                    A
                                 
                              
                           
                        
                     
                  


                     Inventory constraints
                     
                        
                           (24)
                           
                              
                                 
                                    s
                                    
                                       i
                                       1
                                       k
                                    
                                 
                                 =
                                 
                                    S
                                    
                                       i
                                       k
                                    
                                    O
                                 
                                 +
                                 
                                    J
                                    
                                       i
                                       k
                                    
                                 
                                 ·
                                 
                                    R
                                    
                                       i
                                       k
                                    
                                 
                                 ·
                                 
                                    t
                                    
                                       i
                                       1
                                    
                                 
                                 
                                 
                                 i
                                 ∈
                                 N
                                 ,
                                 
                                 k
                                 ∈
                                 K
                              
                           
                        
                     
                     
                        
                           (25)
                           
                              
                                 
                                    s
                                    
                                       i
                                       m
                                       k
                                    
                                    E
                                 
                                 =
                                 
                                    s
                                    
                                       i
                                       m
                                       k
                                    
                                 
                                 −
                                 
                                    ∑
                                    
                                       v
                                       ∈
                                       V
                                    
                                 
                                 
                                    J
                                    
                                       i
                                       k
                                    
                                 
                                 ·
                                 
                                    q
                                    
                                       i
                                       m
                                       v
                                       k
                                    
                                 
                                 +
                                 
                                    J
                                    
                                       i
                                       k
                                    
                                 
                                 ·
                                 
                                    R
                                    
                                       i
                                       k
                                    
                                 
                                 ·
                                 
                                    (
                                    
                                       
                                          t
                                          
                                             i
                                             m
                                          
                                          E
                                       
                                       −
                                       
                                          t
                                          
                                             i
                                             m
                                          
                                       
                                    
                                    )
                                 
                                 
                                 
                                    (
                                    
                                       i
                                       ,
                                       m
                                    
                                    )
                                 
                                 ∈
                                 
                                    S
                                    A
                                 
                                 ,
                                 
                                 k
                                 ∈
                                 K
                              
                           
                        
                     
                     
                        
                           (26)
                           
                              
                                 
                                    s
                                    
                                       i
                                       m
                                       k
                                    
                                 
                                 =
                                 
                                    s
                                    
                                       i
                                       
                                          (
                                          
                                             m
                                             −
                                             1
                                          
                                          )
                                       
                                       k
                                    
                                    E
                                 
                                 +
                                 
                                    J
                                    
                                       i
                                       k
                                    
                                 
                                 ·
                                 
                                    R
                                    
                                       i
                                       k
                                    
                                 
                                 
                                    (
                                    
                                       
                                          t
                                          
                                             i
                                             m
                                          
                                       
                                       −
                                       
                                          t
                                          
                                             i
                                             
                                                (
                                                
                                                   m
                                                   −
                                                   1
                                                
                                                )
                                             
                                          
                                          E
                                       
                                    
                                    )
                                 
                                 
                                 
                                 
                                    (
                                    
                                       i
                                       ,
                                       m
                                    
                                    )
                                 
                                 ∈
                                 
                                    S
                                    A
                                 
                                 :
                                 m
                                 ≥
                                 2
                                 ,
                                 k
                                 ∈
                                 K
                              
                           
                        
                     
                     
                        
                           (27)
                           
                              
                                 
                                    
                                       S
                                       ̲
                                    
                                    
                                       i
                                       k
                                    
                                 
                                 ≤
                                 
                                    s
                                    
                                       i
                                       m
                                       k
                                    
                                 
                                 ,
                                 
                                    s
                                    
                                       i
                                       m
                                       k
                                    
                                    E
                                 
                                 ≤
                                 
                                    
                                       S
                                       ¯
                                    
                                    
                                       i
                                       k
                                    
                                 
                                 
                                 
                                 
                                    (
                                    
                                       i
                                       ,
                                       m
                                    
                                    )
                                 
                                 ∈
                                 
                                    S
                                    A
                                 
                                 ,
                                 
                                 k
                                 ∈
                                 K
                              
                           
                        
                     
                     
                        
                           (28)
                           
                              
                                 
                                    
                                       S
                                       ̲
                                    
                                    
                                       i
                                       k
                                    
                                    T
                                 
                                 ≤
                                 
                                    s
                                    
                                       i
                                       
                                          
                                             μ
                                             ¯
                                          
                                          i
                                       
                                       k
                                    
                                    E
                                 
                                 +
                                 
                                    J
                                    
                                       i
                                       k
                                    
                                 
                                 ·
                                 
                                    R
                                    
                                       i
                                       k
                                    
                                 
                                 ·
                                 
                                    (
                                    
                                       
                                          T
                                          ¯
                                       
                                       −
                                       
                                          t
                                          
                                             i
                                             
                                                
                                                   μ
                                                   ¯
                                                
                                                i
                                             
                                          
                                          E
                                       
                                    
                                    )
                                 
                                 ≤
                                 
                                    
                                       S
                                       ¯
                                    
                                    
                                       i
                                       k
                                    
                                    T
                                 
                                 
                                 
                                 i
                                 ∈
                                 N
                                 ,
                                 
                                 k
                                 ∈
                                 K
                              
                           
                        
                     
                     
                        
                           (29)
                           
                              
                                 
                                    s
                                    
                                       i
                                       m
                                       k
                                    
                                 
                                 ,
                                 
                                 
                                    s
                                    
                                       i
                                       m
                                       k
                                    
                                    E
                                 
                                 ≥
                                 0
                                 
                                 
                                 
                                    (
                                    
                                       i
                                       ,
                                       m
                                    
                                    )
                                 
                                 ∈
                                 
                                    S
                                    A
                                 
                                 ,
                                 
                                 k
                                 ∈
                                 K
                                 .
                              
                           
                        
                     
                  

In this formulation, the objective (1) is to minimize the total transportation and port operating cost. Eq. (2) ensure that each ship departs from its initial position and sails towards another port, or is not used. Eqs. (3) and (4) are the flow conservation constraints, ensuring that a ship arriving at a port also leaves that port either by visiting another port or ends its route. Constraints (5) ensure that each port visit (i, m)is made at most once. Constraints (6) state that if port i is visited m times, then it must also have been visited 
                        
                           m
                           −
                           1
                        
                      times before. Constraints (7)−(10) define the variables as binary.

The non-linear equations (11) determine the quantity of product k on board ship vwhen it sails from port visit (i, m) to port visit(j, n). Constraints (12) are similar to (11) and determine the load on board the ship at the first visit. The ship capacities are enforced through constraints (13). Constraints (14) impose lower and upper limits on the loaded and unloaded quantities. Constraints (15) ensure that if ship v makes port visit(i, m), then at least one product must be unloaded or loaded. Constraints (16) ensure that if ship v unloads or loads one product at visit(i, m), then wimv
                      must be equal to one. Constraints (17)−(18) define the domain of the variables.

Constraints (19) define the end time of service of port visit(i, m). Constraints (20) state that if port visit(i, m)starts, then port visit
                        
                           (
                           
                              i
                              ,
                              m
                              −
                              1
                           
                           )
                        
                     must have ended no later than the start of visit (i, m).The non-linear constraints (21) relate the end time of port visit(i, m)to the start time of port visit (j, n) when ship v sails directly from (i, m) to(j, n). Constraints (22) ensure that if ship v travels from its initial position directly to port visit(i, m), then the start time is at least the transportation time between these two positions. Constraints (23) define the continuous time variables. Constraints (11) and (21) are converted to linear constraints similarly to what was done in Agra et al. (2013a).


                     Eq. (24) provides the inventory level of each product at the first visit. Eq. (25) calculates the inventory level of each product when the service ends at port visit(i, m). Similarly, Eq. (26) relates the inventory level at the start of port visit (i, m) to the inventory level at the end of port visit
                        
                           (
                           
                              i
                              ,
                              m
                              −
                              1
                           
                           )
                        
                     . The upper and lower bounds on the inventory levels are ensured by constraints (27), and constraints (28) are imposed to deal with the stock levels at the end of the planning horizon. Finally the non-negativity of the inventory level variables is enforced by constraints (29).

The HCGR heuristic we have developed for the SSIRP is based on the idea of Hemmati, Stålhane, Hvattum, and Andersson (2015) to convert an inventory-routing problem into a ship routing and scheduling problem. In the ship routing and scheduling problem, a shipping company has a set of cargoes that it is committed to carry. Each cargo must be picked up at its port of loading, transported, and delivered to its corresponding unloading port. Time windows are specified for the allowed arrival time in ports. Cargoes with specified origin and destination ports, a quantity to transport, and time windows for both the origin and the destination ports, should therefore be defined in order to convert the SSIRP into a ship routing and scheduling problem. Hemmati et al. (2015) introduced a heuristic to solve a combined cargo routing and inventory-routing problem faced by a shipping company that offers vendor-managed inventory services to some of its customers. They assumed that the inventories are paired, and then introduced cargoes to replace the inventory management for each inventory pair. In this paper, instead of paired inventories, there are inventories for multiple products with a many-to-many distribution structure, which makes the procedure of defining the representative cargoes more difficult. Consequently, the main steps of our algorithm that define the cargoes are different from those of their algorithm.

To accomplish the required conversion, we transform the inventory management aspect of the problem into a set of cargoes with known quantities and time windows based on the information from inventory levels, the inventory limits, and the production or consumption rates. Thus, in the first phase, the SSIRP is converted into a ship routing and scheduling problem by generating cargoes based on the inventory information. The loaded and unloaded quantities for each of the cargoes generated are determined by solving a transportation model, and the time windows for start of unloading or loading operations are obtained by solving a time window model. This model generates wide, feasible time windows at the origin and destination ports corresponding to each cargo. The ship routing and scheduling problem is then solved by means of an adaptive large neighborhood search (ALNS) heuristic, a solution framework introduced by Ropke and Pisinger (2006). Furthermore, the solution is analyzed by means of several criteria and the HCGR heuristic iteratively changes the generated cargoes based on information obtained during this process.

The HCGR first computes the minimum total quantity of each product that should be loaded or unloaded at each port, considering the net production or consumption rate, the stock limits, and the stock levels at the beginning of the planning horizon. The transportation model is then applied, given the total quantities and optimistic transportation costs. The purpose of the model is to determine the amount of each product to transfer from each origin port to each destination port. Such a transfer corresponds to a cargo. Since there are limits on the quantity unloaded or loaded at ports, several cargoes may be needed to transport a given product from a specific origin to a specific destination. These cargoes will be referred to as a homogeneous cargo set, that is, a set of cargoes that have the same origin and destination ports but possibly representing different amounts of cargo and having different time windows. Cargoes belonging to a homogeneous cargo set are eventually changed in the HCGR heuristic to iteratively define new ship routing and scheduling problems. We refer to the remaining cargoes that do not belong to any homogeneous cargo set as ordinary cargoes. These do not change during the execution of the HCGR heuristic.

In the ship routing and scheduling problem, each cargo has separate time windows for the loading port and the unloading port. In the next step, the HCGR considers all inventory limits for each product in order to calculate valid time windows for the cargoes at their loading and unloading ports. The model guarantees that the inventory levels will remain within their limits as long as the cargoes are loaded and unloaded within these windows.

Having specified the initial cargoes and time windows, a first ship routing and scheduling problem is solved by an ALNS heuristic. After the first ship routing and scheduling problem has been solved, the HCGR heuristic creates new alternative cargo quantities and adds them to a list. The new cargo quantities are defined for each homogeneous cargo set based on criteria presented in Section 3.6. The HCGR heuristic then generates all possible combinations of these cargo quantities over all the homogeneous cargo sets. The number of these combinations grows exponentially in parameters such as the number of inventories, the number of products, and the length of the planning horizon. To reduce solution times, the ALNS is not applied to all possible cargo combinations. Instead, we apply a k-means clustering algorithm to partition the combinations into clusters of similar combinations. An iterative process is then used to select new cargo quantity combinations that are used as input to the ALNS.

The pseudo-code of the algorithm is presented in Algorithm 1
                        .

In line 4, the algorithm determines, for each product k and each port i, the minimum total quantity, 
                           
                              Q
                              
                                 i
                                 k
                              
                              T
                           
                        , that should be loaded or unloaded to ensure that the inventory level for product k at port i will remain within its limits at the end of the planning horizon. The minimum total quantities are computed according to Eq. (30) for the production sites (Jik
                         > 0) and the consumption sites (Jik
                         < 0). 
                           
                              (30)
                              
                                 
                                    
                                       Q
                                       
                                          i
                                          k
                                       
                                       T
                                    
                                    =
                                    
                                       {
                                       
                                          
                                             
                                                
                                                   
                                                      S
                                                      
                                                         i
                                                         k
                                                      
                                                      O
                                                   
                                                   +
                                                   
                                                      (
                                                      
                                                         
                                                            T
                                                            ¯
                                                         
                                                         ·
                                                         
                                                            R
                                                            
                                                               i
                                                               k
                                                            
                                                         
                                                      
                                                      )
                                                   
                                                   −
                                                   
                                                      
                                                         S
                                                         ¯
                                                      
                                                      
                                                         i
                                                         k
                                                      
                                                      T
                                                   
                                                   ,
                                                   
                                                   
                                                      J
                                                      
                                                         i
                                                         k
                                                      
                                                   
                                                   >
                                                   0
                                                
                                             
                                          
                                          
                                             
                                                
                                                   
                                                      
                                                         S
                                                         ̲
                                                      
                                                      
                                                         i
                                                         k
                                                      
                                                      T
                                                   
                                                   +
                                                   
                                                      (
                                                      
                                                         
                                                            T
                                                            ¯
                                                         
                                                         ·
                                                         
                                                            R
                                                            
                                                               i
                                                               k
                                                            
                                                         
                                                      
                                                      )
                                                   
                                                   −
                                                   
                                                      S
                                                      
                                                         i
                                                         k
                                                      
                                                      O
                                                   
                                                   ,
                                                   
                                                   
                                                      J
                                                      
                                                         i
                                                         k
                                                      
                                                   
                                                   <
                                                   0
                                                   .
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           
                        
                     

Having determined the quantities 
                           
                              Q
                              
                                 i
                                 k
                              
                              T
                           
                         that must be handled at each port for each product, the next step is to determine, for each product, how many times cargo should be transported between each pair of production and consumption ports. To this end, we define a modified transportation model with limits on the amounts that can be transported. These limits are derived from instance-specific data, with given lower and upper limits on the quantities loaded and unloaded. The modified transportation model minimizes the total transportation and cargo handling costs while considering the minimum total quantity 
                           
                              Q
                              
                                 i
                                 k
                              
                              T
                           
                         loaded at each production site, the minimum total quantity 
                           
                              Q
                              
                                 j
                                 k
                              
                              T
                           
                         unloaded at each consumption site, and upper and lower limits on the amounts 
                           
                              
                                 Q
                                 ¯
                              
                              
                                 i
                                 j
                                 k
                              
                           
                         and
                           
                              
                                 Q
                                 ̲
                              
                              
                                 i
                                 j
                                 k
                              
                           
                         transported. The model is applied to each product k separately. The additional notation introduced for this model is given below:

                           
                              h:
                           
                              transportation cargo number between two specific ports

minimum transportation cost from port i to j (
                                    
                                       
                                          C
                                          
                                             i
                                             j
                                          
                                       
                                       =
                                       
                                          min
                                          
                                             v
                                             ∈
                                             V
                                          
                                       
                                       
                                          C
                                          
                                             i
                                             j
                                             v
                                          
                                          T
                                       
                                       ,
                                       
                                       i
                                       ,
                                       j
                                       ∈
                                       N
                                    
                                 )

set of transportation cargoes between two specific ports

upper bound on the number of visits to port i for product k
                              

upper limit on the quantity of product k transporting from port i to j,
                                    
                                       
                                          
                                             Q
                                             ¯
                                          
                                          
                                             i
                                             j
                                             k
                                          
                                       
                                       =
                                       m
                                       i
                                       n
                                       
                                          (
                                          
                                             
                                                
                                                   Q
                                                   ¯
                                                
                                                
                                                   i
                                                   k
                                                
                                             
                                             ,
                                             
                                                
                                                   Q
                                                   ¯
                                                
                                                
                                                   j
                                                   k
                                                
                                             
                                             ,
                                             
                                                min
                                                v
                                             
                                             
                                                C
                                                v
                                             
                                          
                                          )
                                       
                                    
                                 
                              

lower limit on the quantity of product k transporting from port i to j,
                                    
                                       
                                          
                                             Q
                                             ̲
                                          
                                          
                                             i
                                             j
                                             k
                                          
                                       
                                       =
                                       max
                                       
                                          (
                                          
                                             
                                                
                                                   Q
                                                   ̲
                                                
                                                
                                                   i
                                                   k
                                                
                                             
                                             ,
                                             
                                                
                                                   Q
                                                   ̲
                                                
                                                
                                                   j
                                                   k
                                                
                                             
                                          
                                          )
                                       
                                    
                                 
                              

quantity transported from port i to port jwithcargo h
                              

=1 if the hthhth cargo from port i to port jexists, and 0 otherwise

perturbations of the objective coefficients for cargoes from port i to port j
                              

The index h, the set H, and the decision variables xijh
                         and yijh
                         are defined for product k. The transportation model for product k can be stated as follows: 
                           
                              (31)
                              
                                 
                                    
                                       Minimize
                                       
                                    
                                    
                                       ∑
                                       
                                          i
                                          ∈
                                          N
                                       
                                    
                                    
                                       ∑
                                       
                                          j
                                          ∈
                                          N
                                       
                                    
                                    
                                       ∑
                                       
                                          h
                                          ∈
                                          H
                                       
                                    
                                    
                                       (
                                       
                                          
                                             C
                                             
                                                i
                                                j
                                             
                                          
                                          +
                                          
                                             C
                                             
                                                i
                                                k
                                             
                                             O
                                          
                                          +
                                          
                                             C
                                             
                                                j
                                                k
                                             
                                             O
                                          
                                          +
                                          
                                             
                                                ɛ
                                             
                                             
                                                i
                                                j
                                             
                                          
                                       
                                       )
                                    
                                    ·
                                    
                                       y
                                       
                                          i
                                          j
                                          h
                                       
                                    
                                    +
                                    
                                       (
                                       
                                          
                                             C
                                             
                                                i
                                                k
                                             
                                             Q
                                          
                                          +
                                          
                                             C
                                             
                                                j
                                                k
                                             
                                             Q
                                          
                                          +
                                          
                                             δ
                                             
                                                i
                                                j
                                             
                                          
                                       
                                       )
                                    
                                    ·
                                    
                                       x
                                       
                                          i
                                          j
                                          h
                                       
                                    
                                 
                              
                           
                        subject to

                           
                              (32)
                              
                                 
                                    
                                       ∑
                                       
                                          j
                                          ∈
                                          N
                                       
                                    
                                    
                                       ∑
                                       
                                          h
                                          ∈
                                          H
                                       
                                    
                                    
                                       x
                                       
                                          i
                                          j
                                          h
                                       
                                    
                                    ≥
                                    
                                       Q
                                       
                                          i
                                          k
                                       
                                       T
                                    
                                    
                                    
                                    i
                                    
                                    ∈
                                    N
                                    ,
                                    
                                    
                                       J
                                       
                                          i
                                          k
                                       
                                    
                                    >
                                    0
                                 
                              
                           
                        
                        
                           
                              (33)
                              
                                 
                                    
                                       ∑
                                       
                                          i
                                          ∈
                                          N
                                       
                                    
                                    
                                       ∑
                                       
                                          h
                                          ∈
                                          H
                                       
                                    
                                    
                                       x
                                       
                                          i
                                          j
                                          h
                                       
                                    
                                    ≥
                                    
                                       Q
                                       
                                          j
                                          k
                                       
                                       T
                                    
                                    
                                    
                                    j
                                    ∈
                                    N
                                    ,
                                    
                                       J
                                       
                                          j
                                          k
                                       
                                    
                                    <
                                    0
                                 
                              
                           
                        
                        
                           
                              (34)
                              
                                 
                                    
                                       
                                          Q
                                          ̲
                                       
                                       
                                          i
                                          j
                                          k
                                       
                                    
                                    ·
                                    
                                       y
                                       
                                          i
                                          j
                                          h
                                       
                                    
                                    ≤
                                    
                                       x
                                       
                                          i
                                          j
                                          h
                                       
                                    
                                    ≤
                                    
                                       
                                          Q
                                          ¯
                                       
                                       
                                          i
                                          j
                                          k
                                       
                                    
                                    ·
                                    
                                       y
                                       
                                          i
                                          j
                                          h
                                       
                                    
                                    
                                    
                                    i
                                    ,
                                    j
                                    
                                    ∈
                                    N
                                    ,
                                    h
                                    ∈
                                    H
                                    ,
                                    
                                    
                                       J
                                       
                                          i
                                          k
                                       
                                    
                                    >
                                    0
                                    ,
                                    
                                    
                                       J
                                       
                                          j
                                          k
                                       
                                    
                                    <
                                    0
                                 
                              
                           
                        
                        
                           
                              (35)
                              
                                 
                                    
                                       ∑
                                       
                                          j
                                          ∈
                                          N
                                       
                                    
                                    
                                       ∑
                                       
                                          h
                                          ∈
                                          H
                                       
                                    
                                    
                                       y
                                       
                                          i
                                          j
                                          h
                                       
                                    
                                    ≤
                                    
                                       
                                          μ
                                          ¯
                                       
                                       
                                          i
                                          k
                                       
                                    
                                    
                                    
                                    i
                                    
                                    ∈
                                    N
                                    ,
                                    
                                    h
                                    ∈
                                    H
                                    ,
                                    
                                       J
                                       
                                          i
                                          k
                                       
                                    
                                    >
                                    0
                                 
                              
                           
                        
                        
                           
                              (36)
                              
                                 
                                    
                                       ∑
                                       
                                          i
                                          ∈
                                          N
                                       
                                    
                                    
                                       ∑
                                       
                                          h
                                          ∈
                                          H
                                       
                                    
                                    
                                       y
                                       
                                          i
                                          j
                                          h
                                       
                                    
                                    ≤
                                    
                                       
                                          μ
                                          ¯
                                       
                                       
                                          j
                                          k
                                       
                                    
                                    
                                    
                                    j
                                    ∈
                                    N
                                    
                                    ,
                                    h
                                    ∈
                                    H
                                    ,
                                    
                                       J
                                       
                                          j
                                          k
                                       
                                    
                                    <
                                    0
                                 
                              
                           
                        
                        
                           
                              (37)
                              
                                 
                                    
                                       y
                                       
                                          i
                                          j
                                          
                                             (
                                             
                                                h
                                                −
                                                1
                                             
                                             )
                                          
                                       
                                    
                                    −
                                    
                                       y
                                       
                                          i
                                          j
                                          h
                                       
                                    
                                    ≥
                                    0
                                    
                                    
                                    i
                                    ,
                                    j
                                    
                                    ∈
                                    N
                                    ,
                                    
                                    h
                                    ∈
                                    H
                                    ∖
                                    
                                       {
                                       1
                                       }
                                    
                                    ,
                                    
                                       J
                                       
                                          i
                                          k
                                       
                                    
                                    >
                                    0
                                    ,
                                    
                                    
                                       J
                                       
                                          j
                                          k
                                       
                                    
                                    <
                                    0
                                 
                              
                           
                        
                        
                           
                              (38)
                              
                                 
                                    
                                       x
                                       
                                          i
                                          j
                                          h
                                       
                                    
                                    ≥
                                    0
                                    
                                    
                                    i
                                    ,
                                    j
                                    
                                    ∈
                                    N
                                    ,
                                    h
                                    ∈
                                    H
                                    ,
                                    
                                    
                                       J
                                       
                                          i
                                          k
                                       
                                    
                                    >
                                    0
                                    ,
                                    
                                    
                                       J
                                       
                                          j
                                          k
                                       
                                    
                                    <
                                    0
                                 
                              
                           
                        
                        
                           
                              (39)
                              
                                 
                                    
                                       y
                                       
                                          i
                                          j
                                          h
                                       
                                    
                                    ∈
                                    
                                       {
                                       
                                          0
                                          ,
                                          1
                                       
                                       }
                                    
                                    
                                    
                                    i
                                    ,
                                    j
                                    
                                    ∈
                                    N
                                    ,
                                    h
                                    ∈
                                    H
                                    ,
                                    
                                    
                                       J
                                       
                                          i
                                          k
                                       
                                    
                                    >
                                    0
                                    ,
                                    
                                    
                                       J
                                       
                                          j
                                          k
                                       
                                    
                                    <
                                    0
                                    .
                                 
                              
                           
                        
                     

The objective (31) minimizes the sum of the total transportation cost, the fixed operating cost at the ports, and the unit loading and unloading costs at the ports. Perturbations may be added to the objective function, giving the possibility of obtaining different solutions. Constraints (32) ensure that the minimum required quantity is loaded over the planning horizon at ports with net production, and constraints (33) ensure that the minimum required quantity is unloaded at ports with net consumption. Constraints (34) impose lower and upper limits on the transportation amounts, while constraints (35) and (36) control the number of visits at the ports. Constraints (37) state that if cargo h for product k from port i to j exists, with h > 1, then cargo 
                           
                              h
                              −
                              1
                           
                         must also exist. Constraints (38) and (39) are non-negativity and integrality constraints. In the solution of the model, if xijh
                         > 0 then a cargo is defined from port i to j with a quantity equal to xijh
                        .

In our proposed HCGR heuristic we set 
                           
                              
                                 μ
                                 ¯
                              
                              
                                 i
                                 k
                              
                           
                         equal to 
                           
                              
                                 μ
                                 ¯
                              
                              i
                           
                        . If the transportation model does not find a feasible solution for all products, the HCGR heuristic ends without any feasible solution to the overall problem. However, the main problem may in some cases have a feasible solution, since the upper limit on the quantity of product k transported from port i to j in constraints (34) can be tighter than the original upper limit in constraints (14).

Each time a set of cargoes for product k is generated, we use a time window model to generate wide feasible time windows for the origin and destination ports corresponding to each cargo. This model guarantees that the inventory levels for product k remain within their limits throughout the planning horizon as long as the cargoes are loaded and unloaded within the time windows.

Here we provide the new notation for the time window model:

                           
                              Gk
                              :
                           
                              set of cargoes for product k indexed by g
                              

loading port of the cargo g
                              

unloading port of the cargo g
                              

quantity of the cargo g
                              

cumulative sum of the cargo quantities unloaded or loaded from or to port i just before unloading or loading cargo g at port i
                              

cumulative sum of the cargo quantities unloaded or loaded from or to port i just after unloadingor loading cargo g at port i (
                                    
                                       
                                          S
                                          
                                             i
                                             g
                                          
                                          E
                                       
                                       =
                                       
                                          S
                                          
                                             i
                                             g
                                          
                                          S
                                       
                                       +
                                       
                                          Q
                                          g
                                       
                                    
                                 )

minimum transportation time from port i to portj (
                                    
                                       
                                          T
                                          
                                             i
                                             j
                                          
                                          M
                                       
                                       =
                                       
                                          min
                                          
                                             v
                                             ∈
                                             V
                                          
                                       
                                       
                                          {
                                          
                                             T
                                             
                                                i
                                                j
                                                v
                                             
                                          
                                          }
                                       
                                       ,
                                       
                                       i
                                       ,
                                       j
                                       ∈
                                       N
                                    
                                 )

time window for cargo g at loading port

time window for cargo g at unloading port

We can now state the mathematical formulation for the time window, for each k ∈ K and g ∈ Gk
                        :

                           
                              (40)
                              
                                 
                                    Maximize
                                    
                                       t
                                       g
                                       
                                          P
                                          F
                                       
                                    
                                    −
                                    
                                       t
                                       g
                                       
                                          P
                                          S
                                       
                                    
                                    +
                                    
                                       t
                                       g
                                       
                                          D
                                          F
                                       
                                    
                                    −
                                    
                                       t
                                       g
                                       
                                          D
                                          S
                                       
                                    
                                    ,
                                 
                              
                           
                        subject to 
                           
                              (41)
                              
                                 
                                    
                                       
                                          S
                                          ̲
                                       
                                       
                                          
                                             P
                                             g
                                          
                                          k
                                       
                                    
                                    ≤
                                    
                                       S
                                       
                                          
                                             P
                                             g
                                          
                                          k
                                       
                                       O
                                    
                                    −
                                    
                                       S
                                       
                                          
                                             P
                                             g
                                          
                                          g
                                       
                                       S
                                    
                                    +
                                    
                                       (
                                       
                                          
                                             R
                                             
                                                
                                                   P
                                                   g
                                                
                                                k
                                             
                                          
                                          ·
                                          
                                             t
                                             g
                                             
                                                P
                                                S
                                             
                                          
                                       
                                       )
                                    
                                    ≤
                                    
                                       
                                          S
                                          ¯
                                       
                                       
                                          
                                             P
                                             g
                                          
                                          k
                                       
                                    
                                 
                              
                           
                        
                        
                           
                              (42)
                              
                                 
                                    
                                       
                                          S
                                          ̲
                                       
                                       
                                          
                                             P
                                             g
                                          
                                          k
                                       
                                    
                                    ≤
                                    
                                       S
                                       
                                          
                                             P
                                             g
                                          
                                          k
                                       
                                       O
                                    
                                    −
                                    
                                       S
                                       
                                          
                                             P
                                             g
                                          
                                          g
                                       
                                       S
                                    
                                    +
                                    
                                       (
                                       
                                          
                                             R
                                             
                                                
                                                   P
                                                   g
                                                
                                                k
                                             
                                          
                                          ·
                                          
                                             t
                                             g
                                             
                                                P
                                                F
                                             
                                          
                                       
                                       )
                                    
                                    ≤
                                    
                                       
                                          S
                                          ¯
                                       
                                       
                                          
                                             P
                                             g
                                          
                                          k
                                       
                                    
                                 
                              
                           
                        
                        
                           
                              (43)
                              
                                 
                                    
                                       
                                          S
                                          ̲
                                       
                                       
                                          
                                             D
                                             g
                                          
                                          k
                                       
                                    
                                    ≤
                                    
                                       S
                                       
                                          
                                             D
                                             g
                                          
                                          k
                                       
                                       O
                                    
                                    +
                                    
                                       S
                                       
                                          
                                             D
                                             g
                                          
                                          g
                                       
                                       S
                                    
                                    −
                                    
                                       (
                                       
                                          
                                             R
                                             
                                                
                                                   D
                                                   g
                                                
                                                k
                                             
                                          
                                          ·
                                          
                                             t
                                             g
                                             
                                                D
                                                S
                                             
                                          
                                       
                                       )
                                    
                                    ≤
                                    
                                       
                                          S
                                          ¯
                                       
                                       
                                          
                                             D
                                             g
                                          
                                          k
                                       
                                    
                                 
                              
                           
                        
                        
                           
                              (44)
                              
                                 
                                    
                                       
                                          S
                                          ̲
                                       
                                       
                                          
                                             D
                                             g
                                          
                                          k
                                       
                                    
                                    ≤
                                    
                                       S
                                       
                                          
                                             D
                                             g
                                          
                                          k
                                       
                                       O
                                    
                                    +
                                    
                                       S
                                       
                                          
                                             D
                                             g
                                          
                                          g
                                       
                                       S
                                    
                                    −
                                    
                                       (
                                       
                                          
                                             R
                                             
                                                
                                                   D
                                                   g
                                                
                                                k
                                             
                                          
                                          ·
                                          
                                             t
                                             g
                                             
                                                D
                                                F
                                             
                                          
                                       
                                       )
                                    
                                    ≤
                                    
                                       
                                          S
                                          ¯
                                       
                                       
                                          
                                             D
                                             g
                                          
                                          k
                                       
                                    
                                 
                              
                           
                        
                        
                           
                              (45)
                              
                                 
                                    
                                       
                                          S
                                          ̲
                                       
                                       
                                          
                                             P
                                             g
                                          
                                          k
                                       
                                    
                                    ≤
                                    
                                       S
                                       
                                          
                                             P
                                             g
                                          
                                          k
                                       
                                       O
                                    
                                    −
                                    
                                       S
                                       
                                          
                                             P
                                             g
                                          
                                          g
                                       
                                       E
                                    
                                    +
                                    
                                       (
                                       
                                          
                                             R
                                             
                                                
                                                   P
                                                   g
                                                
                                                k
                                             
                                          
                                          ·
                                          
                                             T
                                             
                                                
                                                   P
                                                   g
                                                
                                                k
                                             
                                             Q
                                          
                                          ·
                                          
                                             Q
                                             g
                                          
                                       
                                       )
                                    
                                    +
                                    
                                       (
                                       
                                          
                                             R
                                             
                                                
                                                   P
                                                   g
                                                
                                                k
                                             
                                          
                                          ·
                                          
                                             t
                                             g
                                             
                                                P
                                                S
                                             
                                          
                                       
                                       )
                                    
                                    ≤
                                    
                                       
                                          S
                                          ¯
                                       
                                       
                                          
                                             P
                                             g
                                          
                                          k
                                       
                                    
                                 
                              
                           
                        
                        
                           
                              (46)
                              
                                 
                                    
                                       
                                          S
                                          ̲
                                       
                                       
                                          
                                             P
                                             g
                                          
                                          k
                                       
                                    
                                    ≤
                                    
                                       S
                                       
                                          
                                             P
                                             g
                                          
                                          k
                                       
                                       O
                                    
                                    −
                                    
                                       S
                                       
                                          
                                             P
                                             g
                                          
                                          g
                                       
                                       E
                                    
                                    +
                                    
                                       (
                                       
                                          
                                             R
                                             
                                                
                                                   P
                                                   g
                                                
                                                k
                                             
                                          
                                          ·
                                          
                                             T
                                             
                                                
                                                   P
                                                   g
                                                
                                                k
                                             
                                             Q
                                          
                                          ·
                                          
                                             Q
                                             g
                                          
                                       
                                       )
                                    
                                    +
                                    
                                       (
                                       
                                          
                                             R
                                             
                                                
                                                   P
                                                   g
                                                
                                                k
                                             
                                          
                                          ·
                                          
                                             t
                                             g
                                             
                                                P
                                                F
                                             
                                          
                                       
                                       )
                                    
                                    ≤
                                    
                                       
                                          S
                                          ¯
                                       
                                       
                                          
                                             P
                                             g
                                          
                                          k
                                       
                                    
                                 
                              
                           
                        
                        
                           
                              (47)
                              
                                 
                                    
                                       
                                          S
                                          ̲
                                       
                                       
                                          
                                             D
                                             g
                                          
                                          k
                                       
                                    
                                    ≤
                                    
                                       S
                                       
                                          
                                             D
                                             g
                                          
                                          k
                                       
                                       O
                                    
                                    +
                                    
                                       S
                                       
                                          
                                             D
                                             g
                                          
                                          g
                                       
                                       E
                                    
                                    −
                                    
                                       (
                                       
                                          
                                             R
                                             
                                                
                                                   D
                                                   g
                                                
                                                k
                                             
                                          
                                          ·
                                          
                                             T
                                             
                                                
                                                   D
                                                   g
                                                
                                                k
                                             
                                             Q
                                          
                                          ·
                                          
                                             Q
                                             g
                                          
                                       
                                       )
                                    
                                    −
                                    
                                       (
                                       
                                          
                                             R
                                             
                                                
                                                   D
                                                   g
                                                
                                                k
                                             
                                          
                                          ·
                                          
                                             t
                                             g
                                             
                                                D
                                                S
                                             
                                          
                                       
                                       )
                                    
                                    ≤
                                    
                                       
                                          S
                                          ¯
                                       
                                       
                                          
                                             D
                                             g
                                          
                                          k
                                       
                                    
                                 
                              
                           
                        
                        
                           
                              (48)
                              
                                 
                                    
                                       
                                          S
                                          ̲
                                       
                                       
                                          
                                             D
                                             g
                                          
                                          k
                                       
                                    
                                    ≤
                                    
                                       S
                                       
                                          
                                             D
                                             g
                                          
                                          k
                                       
                                       O
                                    
                                    +
                                    
                                       S
                                       
                                          
                                             D
                                             g
                                          
                                          g
                                       
                                       E
                                    
                                    −
                                    
                                       (
                                       
                                          
                                             R
                                             
                                                
                                                   D
                                                   g
                                                
                                                k
                                             
                                          
                                          ·
                                          
                                             T
                                             
                                                
                                                   D
                                                   g
                                                
                                                k
                                             
                                             Q
                                          
                                          ·
                                          
                                             Q
                                             g
                                          
                                       
                                       )
                                    
                                    −
                                    
                                       (
                                       
                                          
                                             R
                                             
                                                
                                                   D
                                                   g
                                                
                                                k
                                             
                                          
                                          ·
                                          
                                             t
                                             g
                                             
                                                D
                                                F
                                             
                                          
                                       
                                       )
                                    
                                    ≤
                                    
                                       
                                          S
                                          ¯
                                       
                                       
                                          
                                             D
                                             g
                                          
                                          k
                                       
                                    
                                 
                              
                           
                        
                        
                           
                              (49)
                              
                                 
                                    
                                       t
                                       g
                                       
                                          P
                                          S
                                       
                                    
                                    ≤
                                    
                                       t
                                       g
                                       
                                          P
                                          F
                                       
                                    
                                 
                              
                           
                        
                        
                           
                              (50)
                              
                                 
                                    
                                       t
                                       g
                                       
                                          D
                                          S
                                       
                                    
                                    ≤
                                    
                                       t
                                       g
                                       
                                          D
                                          F
                                       
                                    
                                 
                              
                           
                        
                        
                           
                              (51)
                              
                                 
                                    
                                       t
                                       g
                                       
                                          P
                                          F
                                       
                                    
                                    ≤
                                    
                                       T
                                       ¯
                                    
                                 
                              
                           
                        
                        
                           
                              (52)
                              
                                 
                                    
                                       t
                                       g
                                       
                                          D
                                          F
                                       
                                    
                                    ≤
                                    
                                       T
                                       ¯
                                    
                                 
                              
                           
                        
                        
                           
                              (53)
                              
                                 
                                    
                                       t
                                       g
                                       
                                          D
                                          S
                                       
                                    
                                    −
                                    
                                       t
                                       g
                                       
                                          P
                                          S
                                       
                                    
                                    ≥
                                    
                                       T
                                       
                                          
                                             P
                                             g
                                          
                                          
                                             D
                                             g
                                          
                                       
                                       M
                                    
                                 
                              
                           
                        
                        
                           
                              (54)
                              
                                 
                                    
                                       t
                                       g
                                       
                                          D
                                          F
                                       
                                    
                                    −
                                    
                                       t
                                       g
                                       
                                          P
                                          F
                                       
                                    
                                    ≥
                                    
                                       T
                                       
                                          
                                             P
                                             g
                                          
                                          
                                             D
                                             g
                                          
                                       
                                       M
                                    
                                 
                              
                           
                        
                        
                           
                              (55)
                              
                                 
                                    
                                       t
                                       g
                                       
                                          P
                                          S
                                       
                                    
                                    ,
                                    
                                    
                                       t
                                       g
                                       
                                          P
                                          F
                                       
                                    
                                    ,
                                    
                                       t
                                       g
                                       
                                          D
                                          S
                                       
                                    
                                    ,
                                    
                                    
                                       t
                                       g
                                       
                                          D
                                          F
                                       
                                    
                                    ≥
                                    0
                                    .
                                 
                              
                           
                        
                     

The objective function (40) maximizes the width of the time windows, while constraints (41)−(48) ensure that the inventories stay within their limits during the planning horizon. Constraints (49) and (50) state that the time window must start before it ends and constraints (51) and (52) state that time window must end before the end of planning horizon. Constraints (53)−(54) mean that the time window at the unloading node may not start or end earlier than the start or end time at the loading node plus the shortest transportation time between them. Finally, constraints (55) express the non-negativity requirements for the variables.

The ALNS heuristic is used to solve the ship routing and scheduling problem generated by defining cargoes and corresponding time windows. A solution is represented by one vector for each of the actual ships, and one for an artificial ship that contains all cargoes not transported by the actual ships. Each vector consists of a visiting sequence of ports representing the order in which they are visited along the route of the ship. The proposed ALNS starts with a solution in which all cargoes are serviced by the artificial ship. This solution is infeasible for the SSIRP, but the ALNS considers it as a feasible solution for the ship routing and scheduling problem. Thus, there is no sailing cost for the initial solution, and the only cost is the cost of not transporting the cargoes. These costs are set to very high values, thereby pushing the algorithm towards transporting all the cargoes by the actual ships. At each iteration of the main algorithm, a new set of cargoes is considered by the ALNS heuristic. The main algorithm fails if it ends in a solution that uses the artificial ship. This means that the main algorithm could not find a set of cargoes that can be transported only by the actual ships.

The ALNS heuristic uses several competing removal and insertion operators. At each iteration, using statistics gathered during the search, the ALNS heuristic chooses one removal operators to remove cargoes from the solution and one insertion operator to re-insert the cargoes in the solution. Because this type of algorithm works with several operators, it is very well suited to problems such as ours in which the range of potential decisions is very broad. The general pseudo-code for our ALNS implementation is based on the heuristic of Hemmati, Hvattum, Fagerholt, and Norstand (2014) for the cargo routing problem. It is described in Algorithm 2
                        :

The ALNS heuristic starts with the initial solution. At each iteration, q cargoes are removed from the current solution and then reinserted in new positions. The value of q is chosen randomly from the interval [4, min(100, ξn)] where n is the number of cargoes and ξ is a constant parameter. Thus, the number of removed cargoes varies during the search to provide different neighborhood sizes. The algorithm uses three different removal operators: the Shaw removal operator, a random-removal operator, and a worst-removal operator. The Shaw removal operator is based on removing a set of similar cargoes, while the random-removal operator selects q cargoes at random and removes them from the solution. Finally, the worst-removal operator removes cargoes that are placed in high cost positions.

Two insertion operators are used in this algorithm: basic greedy insertion and regret-k insertion. The regret-k insertion first calculates the regret value, which is equal to the sum of the cost of inserting a cargo in Kth Kth best position, for 
                           
                              K
                              =
                              2
                              ,
                              …
                              ,
                              
                              k
                           
                        , minus the cost of inserting the cargo in its best position In this paper, k is drawn randomly between 2 to 4. At each iteration, the regret-k operator inserts the cargo with the highest regret value in its minimum cost position. This process continues until all cargoes have been inserted, with ties being broken by selecting the lowest cost insertion. In the basic greedy operator insertions are made on the basis of having the lowest cost only.

We use an adaptive weight adjustment in line 16 of Algorithm2 to define and adjust the weight of each removal and insertion operators by using statistics from earlier iterations. To this end, the entire search is divided into segments of 100 iterations. We then calculate a score for each of the operators during the search in the current segment, and at the end of the segment new weights are calculated based on their performances. After weighting the operators, we select one of them using a roulette wheel mechanism. The removal and insertion operators are selected independently. We have implemented a simulated annealing acceptance criterion. The ALNS heuristic stops after 1000 iterations. For additional details we refer the readers to Hemmati et al. (2014).

New cargo quantities for the cargoes belonging to a homogeneous cargo set are generated in line 14 of Algorithm 1. The total quantity transported between the origin and destination ports in a homogeneous cargo set is held constant. The sum of the cargo quantities in the homogeneous cargo set and the limits on the quantity unloaded or loaded in ports are considered when alternative quantities are generated for an individual cargo. To ensure that a constant total quantity is transported, new cargo quantities are generated for the first 
                           
                              m
                              −
                              1
                           
                         cargoes in a set, while the remaining quantity is assigned to the last cargo. If the quantity of the last cargo violates the minimum or maximum quantity limit, the quantities assigned to the 
                           
                              m
                              −
                              1
                           
                         first cargoes are infeasible and the combination is discarded.

The inputs of this algorithm are the current solution and the onboard quantities during the planning horizon. The algorithm also needs the capacity of the ships and the minimum and maximum limits on the quantity unloaded or loaded in ports. An example to illustrate the criteria used to calculate new cargo quantities now follows. Assume that 
                           
                              C
                              g
                              
                                 H
                                 p
                                 +
                              
                           
                         and 
                           
                              C
                              g
                              
                                 H
                                 p
                                 −
                              
                           
                         represent the loading and unloading visits of the cargo g in the homogeneous cargo set pand 
                           
                              C
                              g
                              
                                 O
                                 +
                              
                           
                        and 
                           
                              C
                              g
                              
                                 O
                                 −
                              
                           
                         represent the loading and unloading visits of the ordinary cargog which does not belong to any homogeneous cargo set. Table 1 presents a feasible solution to an instance with two products, four ships with given capacities, two homogeneous cargo sets (one includes two cargoes and the other one includes three), and four ordinary cargoes. The first two ordinary cargoes and the first homogeneous cargo set handle the first product while the remaining cargoes handle the second product. The four ordinary cargoes have the following sizes: 620, 184, 860, and 210.

The solution presented contains the visit sequence, the unloaded or loaded quantities at each visit and the onboard quantity after each visit. For example, ship number 3 has a capacity of 1200 units. It starts its route by loading 184 units of the ordinary cargo number 2 and then loads the ordinary cargo number 1 with the quantity of 620. Thus, the onboard quantity is equal to 804. The ship continues its route to unload them: first cargo number 1 and then cargo number 2, after which there are no more cargoes onboard. These four visits constitute a segment, i.e., a list of successive cargoes in a route from the time at which the ship is empty until the time at which is becomes empty again. Thus, a route consists of one or more segments. The ship then loads the fourth ordinary cargo and the second cargo in the second homogeneous cargo set and unloads them respectively. These four visits also set up another segment in this route.

In the following we describe six criteria for generating alternative cargo quantities for homogeneous cargo sets, and we illustrate their use for the example of Table 1. In the example, among five cargoes related to homogeneous cargo sets, one is selected to explain all six criteria. The selected cargo, which has loading and unloading visits 
                           
                              C
                              2
                              
                                 H
                                 2
                                 +
                              
                           
                         and 
                           
                              C
                              2
                              
                                 H
                                 2
                                 −
                              
                           
                        , is the second cargo of the second homogeneous cargo set and is serviced by ship 3.


                        Criterion 1: Minimum and maximum possible quantities. The idea behind this criterion is that the extreme points sometimes provide an opportunity to handle more cargoes in a route and thus exploit the ship capacity efficiently. This mostly happens when the capacities of two ships are different. The minimum and maximum amounts (
                           
                              
                                 
                                    Q
                                    ̲
                                 
                                 
                                    i
                                    k
                                 
                              
                              ,
                              
                              
                                 
                                    Q
                                    ¯
                                 
                                 
                                    i
                                    k
                                 
                              
                           
                        ) are input parameters. For the given example they
                         are (250, 1000).


                        Criterion 2: Equal quantities. Sometimes equal quantities for all cargoes in a homogeneous cargo set yield the best route, such as when the capacities of two ships are the same or when extreme points lead to inefficient routes. For the second homogeneous cargo set in the example, the equal quantity is 690.


                        Criterion 3: Ship capacities. The idea is to use the full capacity of a ship. In the example, the only ship capacity between 250 and 1000 is 900, which is for ships 1 and 4.


                        Criterion 4: Ship capacity subtracted by the maximum load of segments in the same ship. Segments are defined by the onboard quantities of a given route. The idea of this criterion is to use the ship capacity in a segment as much as possible. For cargoes that are not in the segment, a new cargo quantity is defined to allow using the full ship capacity in the segment. This criterion is implemented for all ships and segments. In the example, this criterion can be applied to the first segment of Route 3 since there are no cargoes belonging to any of the homogeneous cargo sets in this segment. The ship capacity, 1200, minus the maximum onboard quantity of the first segment 804 is equal to 396.


                        Criterion 5: Ship capacity, plus the initial cargo quantity, minus the maximum value of the segment. This criterion is used for the second segment in the example which includes the given cargo. The idea is to increase the initial quantity of the cargo and use the whole capacity of the ship. In addition to exploiting the whole ship capacity in a segment, this criterion provides the opportunity of having cargoes (the remaining cargoes in the homogeneous cargo set) of smaller size, which can fit into other routes. The ship capacity, 1200, plus initial quantity 690, minus the maximum onboard quantity of the second segment, 900, is equal to 990.


                        Criterion 6: Ship capacities minus the quantity of one ordinary cargo. The idea behind this criterion is to use the full capacity of the ship by matching a cargo related to a homogeneous cargo set with an ordinary cargo. This criterion considers the quantity of ordinary cargoes (here 620, 184, 860 and 210), and subtracts these amounts from all ship capacities and keep those between 250 and 1000. This gives potential cargo size of 280, 340, 580, 690, 716, and 990.

Thus, after applying all six criteria, the second cargo of the second homogeneous cargo set gets the following list of alternative quantities: 250, 280, 340, 396, 580, 690, 716, 900, 990, and 1000.

All feasible combinations of new quantities (see Section 3.6) are generated at line 17 of Algorithm 1. Each combination represents a ship routing and scheduling problem which is solved by the ALNS heuristic. Since the number of these combinations is enormous, the ALNS is not applied to all possible cargo combinations. Instead, a systematic selection among the combinations is performed, as described here and in Section 3.8. The combinations are first clustered using k-means clustering based on a similarity measure. In the algorithm of Section 3.8 an adaptive selection method then handles the selection of clusters and the selection of a combinations from clusters.

The k-means heuristic (MacQueen, 1967) partitions objects into a predefined number k of clusters. The similarity measure in the classic form of k-means clustering is the Euclidean norm. We first choose k cluster centers that are as far as possible from each other. Each combination is then assigned to its closest cluster center, based on the similarity measure. When this assignment process is over, a new center is calculated for each cluster using the points assigned to it. The assignment is then restarted using the new cluster centers. As a result of this loop, the k centers may change between iterations. When the centers do not move any more, a local minimum has been reached and the process terminates. This algorithm is described in Algorithm 3:

This algorithm starts with equal weights for all clusters and then automatically adjusts the weights using statistics from earlier iterations in accordance with the idea of adaptive weight adjustment (Ropke & Pisinger, 2006). To this end, the search is divided into equal parts of 10 iterations each. Clusters are assigned new weights according to the scores they obtained in the current part of the search. The score of a cluster is increased based on the quality of the selected combination. When a combination from the selected cluster improves upon the best solution of that cluster, the weight of that specific cluster is increased. The cluster receives double score if the combination selected from that cluster improves the global best solution. Let ωis
                        be the weight of cluster i in part s. The new weights which are considered during part 
                           
                              s
                              +
                              1
                           
                         are calculated as 
                           
                              (56)
                              
                                 
                                    
                                       ω
                                       
                                          i
                                          
                                             (
                                             
                                                s
                                                +
                                                1
                                             
                                             )
                                          
                                       
                                    
                                    =
                                    
                                       ω
                                       
                                          i
                                          s
                                       
                                    
                                    ·
                                    
                                       (
                                       
                                          1
                                          −
                                          r
                                       
                                       )
                                    
                                    +
                                    r
                                    ·
                                    
                                       
                                          π
                                          i
                                       
                                       
                                          θ
                                          i
                                       
                                    
                                    ,
                                 
                              
                           
                        where πi
                         is the score of cluster i, θi
                         is the number of times cluster ihas been selected, and r is a predefined parameter used to balance the earlier weights and the new normalized scores. The values of πi
                         and θi
                         are reset between parts. After assigning weights to the clusters, we have k clusters with weights ωi
                        , 
                           
                              i
                              ∈
                              {
                              
                                 1
                                 ,
                                 …
                                 
                                    ,
                                    k
                                 
                                 }
                              
                           
                        . We then select cluster j with probability 
                           
                              
                                 ω
                                 j
                              
                              /
                              
                                 ∑
                                 
                                    i
                                    =
                                    1
                                 
                                 k
                              
                              
                                 ω
                                 i
                              
                           
                         by using a roulette wheel mechanism. After picking a cluster and a combination from the selected cluster, as mentioned in Algorithm 1, we need to calculate the time windows for the new selected combination by the model of Section 3.4.

Two instance sets were defined to evaluate the proposed HCGR heuristic. The first set aims at providing an overview of the performance of the HCGR heuristic compared with exact solutions. To this end, we have generated small test instances that we were able to solve to optimality. CPLEX 12.4 was used to compute the optimal solutions to the arc-flow model of Section 2 as well as to the models of Sections 3.3 and 3.4. The first six instances of Table 2
                      were solved to optimality, but these six instances are very small. Thus, in order to evaluate the proposed algorithm for larger instances, we have combined small instances in such a way that the optimal value of the problem is the sum of the optimal solution values of the small instances. To achieve this, we have limited the compatibility between ships and ports. This structural information is not used directly by the HCGR heuristic. The second instance sets, with results presented in Tables 3
                      to 5, were generated to reflect the operation of short-sea shipping companies operating in Europe on the basis of realistic data, as shown in Fig. 1
                     . This second set was generated to analyze the performance of the algorithm on realistic size instances, and to evaluate the effect of attributes of instances on the solution quality and the running times of the HCGR.

As is characteristic of short-sea shipping, the loading and unloading times are large compared to the transportation times. In our instances, the ratio of loading and unloading times to the transportation times is set to 0.5. Moreover, the differences between the lower (
                        
                           
                              S
                              ̲
                           
                           
                              i
                              k
                           
                        
                     ) and upper limits (
                        
                           
                              S
                              ¯
                           
                           
                              i
                              k
                           
                        
                     ) on the inventory levels are set approximately equal to the capacity of the smallest ship for consumption sites, and about twice as large for production sites. All inventories are half-full at the beginning of the planning horizon. There are more consumption sites than production sites, with about three consumption sites per production site. The test instances include seven different ship sizes, all in the handy size segment, ranging from 13,000 to 33,200 tons deadweight. Hemmati et al. (2014) defined the operating costs for these ships. Three different planning horizons of 720, 1080, and 1440 hours with three different numbers of ports, 16, 20, and 24, as well as different numbers of products are considered to analyze their effects on the performance of the algorithm. Both CPLEX and the HCGR heuristic were executed on a single core, using a 2.8gigahertz CPU with 8 gigabyte RAM and a 64-bit operating system.


                     Table 2 provides results obtained from running the arc-flow model and the proposed HCGR heuristic on the first instance set, while Tables 3 to 5 provide the results obtained by executing the HCGR heuristic on the second instance set. The first four columns of Table 2 show the length of the planning horizon, the number of ports, the number of ships, and the number of products, respectively. The number of active inventories and the density are given in the next two columns. The density is the percentage of active inventories to the total number of potential inventories and is calculated as

                        
                           
                              
                                 
                                    
                                       
                                          (
                                          
                                             Number
                                             
                                             of
                                             
                                             Inventories
                                          
                                          )
                                       
                                       ·
                                       100
                                       
                                          
                                          %
                                       
                                    
                                    
                                       
                                          (
                                          
                                             Number
                                             
                                             of
                                             
                                             Ports
                                          
                                          )
                                       
                                       ·
                                       
                                          (
                                          
                                             Number
                                             
                                             of
                                             
                                             Products
                                          
                                          )
                                       
                                    
                                 
                                 .
                              
                           
                        
                     
                  


                     Tables 2 to 5 are based on running the transportation model without any perturbations in the objective function coefficients. However, the best known solutions and the associated gaps were obtained after applying perturbations to the objective function coefficients of the transportation model. Table 2 provides the optimal objective values for the first instance set. These are compared with the values obtained by the proposed HCGR heuristic. It is only fair to compare the running times of the exact method with the HCGR heuristic for the first six instances, because here no extra information is available for the exact method. For the remaining instances the running time is equal to the sum of the running times of a subset of first six instances. We have also applied the exact algorithm on the remaining instances in Table 2 without any extra information. However, after 3600 seconds, no feasible solution was found even when activating the feasibility setting, and the lower bounds were extremely weak. The last two columns in Table 2 are the average running times and the average gap to optimal values over five runs of the HCGR heuristic. The HCGR heuristic can find the same solution as the exact method for almost all instances of the first set, while its running time is significantly smaller than that of the exact method with extra information. However, we note that the instances in Table 2 have a particular structure which may favor the heuristic.


                     Tables 3 to 5 present the results of running the HCGR heuristic five times on each instance of the second set. The average gap in Tables 3 and 4
                      are based on the best known solution of the three cases presented in Table 4, plus the original instances in Table 3. The last two columns in Tables 3 and 5
                     
                      are based on the last run and denote the number of generated cargoes through lines 2 to 9 of Algorithm 1 and the number of combinations generated at line 17 in Algorithm 1. An upper limit of 100,000 was considered for generating the combinations, and the Max Iteration is set to 100 for lines 19 to 30 in Algorithm 1.


                     Table 3 shows the performance of the HCGR heuristic on the second test instances when ten ships, of seven different sizes, are available for all instances. The total average gap of 3.6 percent illustrates that the proposed algorithm performs robustly, even for realistically sized instances. The running time is also acceptable for these instance sizes.


                     Fig. 2 illustrates how the parameters of the problem affect the running time of the proposed algorithm. It shows that for each combination of planning horizon length and number of products, increasing the density leads to larger running times. In addition, increasing the planning horizon and the number of products also increases the running time. To show the effect of the number of ships on the performance of the HCGR heuristic, the same instances as in Table 3 were solved again, but with only a subset of the vessels available. Three different numbers of available ships is considered in Table 4 where in the case with |V|, the ships are those appearing in the best solutions in Table 3. For the other two cases, either the smallest ship used in the best solution of Table 3 is removed (
                        
                           |
                           V
                           |
                           −
                           1
                        
                     ) or one extra ship of the smallest size available is added (
                        
                           |
                           V
                           |
                           +
                           1
                        
                     ). The number of ports in all instances in Table 4 is equal to 16 and the average gap is based on the best known solution of the three cases presented in Table 4 plus the best known solutions in Table 3. The columns for best found and average running time are shown using values relative to the corresponding values in Table 3.

The results of Tables 3 and 4 were analyzed to assess the effect of the number of inventories on the performance of the HCGR heuristic. Fig. 3
                      shows that increasing the number of inventories increases the HCGR heuristic running time but there is no significant relationship between the number of inventories and the gap. Changing the number of ships does not affect the running time and the gap significantly. Fig. 3 suggests that the algorithm is not sensitive to the number of ships and can handle the fleet size and mix problem as well.

As Fig. 3 shows, the number of inventories apparently affects the complexity of the proposed algorithm. To analyze the effect of the rest of the parameters, the number of inventories was kept constant, and results for a subset of instances with 48 inventories are presented in Table 5, where the number of ports and products and consequently the density were allowed to vary.


                     Table 5 together with Tables 2–4 show that the number of ports does not affect the running time significantly, which means that the number of ports is not an adequate measure of instance size. It also shows that the planning horizon significantly affects the running time, as has already been illustrated in Fig. 2. We conclude from these results that that the running time of the algorithm is mostly sensitive to the length of the planning horizon and to the number of active inventories. To illustrate this, Fig. 4
                      shows the relationship between the number of active inventories multiplied by the length of the planning horizon and the number of cargoes generated, as well as the relationship between the number of cargoes generated and the running time. The figure is based on the result of all 77 instances provided in Tables 2–5.

Finally, we have performed a sensitivity analysis to examine the effect of perturbing the objective function coefficients of the transportation model. To this end, we consider two sets of perturbation parameters. In the first set which is called “10 percent perturbation”, ɛ
                        ij
                      is chosen randomly in [0, 0.1 Cij
                     ] and δij
                      is chosen to randomly in 
                        
                           [
                           0
                           ,
                           
                              (
                              0.1
                              ·
                              
                                 (
                                 
                                    C
                                    
                                       i
                                       k
                                    
                                    Q
                                 
                                 +
                                 
                                    C
                                    
                                       j
                                       k
                                    
                                    Q
                                 
                                 )
                              
                              )
                           
                           /
                           2
                           ]
                        
                     . The second set is called “20 percentperturbation” where ɛ
                        ij
                      and δij
                      are chosen randomly in [0, 0.2 · Cij
                     ] and [0, 
                        
                           (
                           0.2
                           ·
                           
                              (
                              
                                 C
                                 
                                    i
                                    k
                                 
                                 Q
                              
                              +
                              
                                 C
                                 
                                    j
                                    k
                                 
                                 Q
                              
                              )
                           
                           )
                           /
                           2
                        
                     ] respectively. Table 6
                      shows the results of comparing these two sets with the no-perturbation objective coefficients of the transportation model. The results are based on 15 runs (five run for each of no –, 10 percent, and 20 percent perturbation) of all 51 instances in Tables 3 and Table 4 (case with |V|), and Table 5. For each set of perturbation parameters the average of best gap to the best know solutions is reported together with the average of average gap to the best know solutions. The number of contributions of each set of perturbation parameters to the best known is also reported in Table 6.


                     Table 6 illustrates that perturbing the objective coefficients of the transportation model significantly downgrades the transportation model, and applying more perturbation results in worse solutions. Analyzing the solutions of 10 percent, and 20 percent perturbation with no-perturbation reveals that when we use perturbation, we obtain different cargoes in terms of origin, destination and quantity. The objective function of the transportation model in the no-perturbation mode is aligned with the objective function of the main problem, thus it is not surprising to get worse results when we add perturbation although we get a chance of having different sets of cargoes each time.

We have modeled and solved a complex multi-product short sea inventory-routing problem faced by shipping companies. Some features of the problem, such as multiple products and a many-to-many distribution structure, make the problem very difficult to model and solve exactly. The instances that can be solved to optimality by CPLEX are rather small and not representative of real-life instances. Therefore, to be able to solve larger realistic instances, we have developed an effective and efficient iterative two-phase hybrid matheuristic called hybrid cargo generating and routing (HCGR). The proposed algorithm was compared with an exact solution method on small size instances. Our computational results show that the proposed HCGR heuristic can find an optimal solution to almost all the small instances within seconds. Our results also show that the proposed heuristic is robust and can solve large and realistic instances within reasonable computing times. The performance of the algorithm was analyzed and it was observed that the running time of the algorithm is mostly sensitive to the length of the planning horizon and to the number of active inventories. We have also performed a sensitivity analysis to examine the effect of adding perturbations to the objective coefficients of the transportation model. It revealed that although perturbations provide the opportunity of generating different cargoes in the transportation model, the results are on average better when the objective functions of the transportation model and of the main problem are suitably aligned, even if this means that the cargoes generated are fixed throughout the execution of the heuristic.

@&#ACKNOWLEDGMENTS@&#

This research was carried out with financial support from the Research Council of Norway through the DOMinant II project, and from the Canadian Natural Sciences and Engineering Research Council under grant 39682-10. This support is gratefully acknowledged. Thanks are due to the referees for their valuable comments.

@&#REFERENCES@&#

