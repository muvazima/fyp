@&#MAIN-TITLE@&#Coordination of production and interstage batch delivery with outsourced distribution

@&#HIGHLIGHTS@&#


               
               
                  
                     
                        
                           
                           We model coordinated production and interstage batch delivery scheduling problems.


                        
                        
                           
                           Delivery is outsourced to a third-party logistics provider (3PP) that uses two transportation modes.


                        
                        
                           
                           We analyze the problems faced by the 3PP when either the manufacturer dominates or the 3PP dominates.


                        
                        
                           
                           We investigate the complexity of several problems, providing polynomiality and NPcompleteness results.


                        
                     
                  
               
            

@&#KEYPHRASES@&#

Supply chain scheduling

Batching and delivery

Outsourced distribution

Two delivery modes

Dynamic programming

@&#ABSTRACT@&#


               
               
                  In this paper, we consider coordinated production and interstage batch delivery scheduling problems, where a third-party logistics provider (3PP) delivers semi-finished products in batches from one production location to another production location belonging to the same manufacturer. A batch cannot be delivered until all jobs of the batch are completed at the upstream stage. The 3PP is required to deliver each product within a time T from its release at the upstream stage. We consider two transportation modes: regular transportation, for which delivery departure times are fixed at the beginning, and express transportation, for which delivery departure times are flexible. We analyze the problems faced by the 3PP when either the manufacturer dominates or the 3PP dominates. In this context, we investigate the complexity of several problems, providing polynomiality and NP-completeness results.
               
            

@&#INTRODUCTION@&#

Supply chain management is an active domain consisting of the optimization and management of flows between different actors in the chain, such as suppliers, manufacturers, logistics providers, distributors and customers. These actors generally have conflicting objectives, which makes the coordination of their decisions a crucial issue in supply chain management.

In recent years, supply chain coordination issues have received great attention from several researchers. Before 2000, most of the work has focused on coordination at the strategic and tactical levels, see e.g. the surveys by Sarmiento and Nagiy (1999) and Erengüç, Simpson, and Vakharia (1999). Thomas and Griffin (1996) pointed out the need for research that addresses supply chain issues at an operational level rather than a strategic level. This has triggered a certain amount of research on supply chain coordination at the operational level. Hall and Potts (2003) were the first to study coordination issues among scheduling, batching and delivery decisions in a three-stage supply chain formed by suppliers, manufacturers, and customers. They study two individual decision models, corresponding to the viewpoint of one supplier or one manufacturer respectively. Agnetis, Hall, and Pacciarelli (2006) also study a coordinated scheduling problem between a supplier and several manufacturers, taking into consideration an intermediate storage buffer. Dawande, Geismar, Hall, and Sriskandarajah (2006) analyze conflict and cooperation issues in distribution systems, and they evaluate the cost of conflict between the manufacturer and the distributor. They provide algorithms for scheduling problems in different bargaining power scenarios. Chen and Hall (2007) study conflict and cooperation issues in assembly systems, where several suppliers need to deliver the parts to a manufacturer. Aydinliyim and Vairaktarakis (2010) study coordination of outsourced operations among several manufacturers, using both optimization and cooperative game-theoretic models. Hall and Liu (2010) study coordination between one manufacturer and several distributors for capacity allocation and scheduling decisions. Cai and Vairaktarakis (2012) propose a cooperative model for the coordination in a supply chain where several manufacturers outsource jobs to one third party facility.

Recently, growing attention have been devoted to integrated supply chain scheduling issues. Chen (2010) surveys integrated production and outbound distribution scheduling (IPODS). Outbound distribution deals with a manufacturer shipping its products to the next stage of the supply chain, that typically belongs to another company. As a consequence, the receiving firm may set due dates or deadlines that will constrain the production/distribution problem. The focus of the analysis is on coordinating production decisions (typically, sequencing) and distribution decisions (typically, batching). These two aspects are often conflicting, and require a careful consideration of objectives and roles of the subjects involved. Most of the recent literature on integrated supply chain scheduling refers to outbound distribution. Several IPODS models have been considered. For example, Lee and Chen (2001) study an IPODS problem with batch delivery to a single customer. Pundoor and Chen (2005) consider an IPODS problem with batch delivery to multiple customers by the direct shipping method. Chen and Vairaktarakis (2005) study an IPODS problem with batch delivery to multiple customers by the routing method. Averbakh and Baysan (2012) consider an IPODS problem with batch delivery to multiple customers and semi-online environment.

In this paper, we are concerned with the situation arising when the same manufacturer owns both the upstream and the downstream stage. This case is referred to as interstage distribution. A few articles address integrated production and interstage distribution scheduling issues. Lee and Chen (2001) study a 2-machine flow shop scheduling problem, which minimizes makespan and considers constraints on both transportation capacity and transportation times. Lee and Strusevich (2005) provide approximation algorithms for the 2-machine flow shop and open shop scheduling problems with an (uncapacitated) interstage transporter. Gong and Tang (2011) propose a heuristic algorithm for a coordinated production–distribution scheduling problem in a 2-machine flow shop environment, and analyze the problem with different job physical space setting. Aloulou, Bouzaiene, Dridi, and Vanderpooten (2014) consider a bicriteria 2-machine flow shop scheduling problem with an infinite number of vehicles and limited capacity. They minimize two criteria, namely transportation cost and makespan.

These models generalize classical machine scheduling models, and are suitable for a scenario in which the owner of the two facilities takes care of transportation, so that this can be synchronized with processing at the two stages. Actually, transportation can be outsourced to a third-party logistics provider (3PP), and their relationship be regulated by a contract specifying an appropriate level of responsiveness. This is apparently a very common practice among companies (Langley, van Dort, Ang, & Sykes, 2006; Tezuka, 2011). In spite of this, there are not many articles about interstage distribution in which transportation is outsourced. Among them, Li, Sivakumar, and Ganesan (2008) study the coordinated scheduling of parallel machine manufacturing and 3PP transportation in make-to-order consumer electronics supply chain. They analyze first the 3PP transportation allocation problem, and then develop the parallel machine scheduling problem with the due date imposed by the 3PP. Zhong, Chen, and Chen (2010) study an integrated production/distribution scheduling problem, in which the 3PP specifies various shipping times for different vehicles.

In this paper, we consider production and interstage distribution scheduling, focusing on the problems faced by the 3PP. Given a set of items (jobs) produced by the manufacturer at the upstream facility, the contract requires the 3PP to deliver each of them to the downstream stage, within a certain time T from its release at the upstream stage. Small values of T indicate high responsiveness of the 3PP, which is desirable for the manufacturer. However, this may entail higher costs for the 3PP. In our models, we will consider both the 3PP cost function and responsiveness requirements.

We are going to investigate two different types of contract. In the first type, the manufacturer decides the schedule of the jobs that are being released at the upstream stage and prescribes a certain value of T. The 3PP is therefore left with the problem of minimizing its costs while complying with the responsiveness requirement. We say that in this scenario the manufacturer dominates. In the second type of contract, expectedly cheaper for the manufacturer, the responsiveness requirement is still present, but the 3PP can prescribe the order in which the jobs at the upstream stage are to be picked up. The 3PP has therefore more flexibility to conveniently arrange the jobs. In this case, we say that the 3PP dominates.

Another feature considered in our model is the presence of multiple transportation resources. As observed by Chen (2010) in his survey on integrated production and distribution scheduling problems, research has not yet adequately addressed problems with fixed delivery departure times. These refer to the fact that transportation resources are available to depart from the upstream stage only at fixed, known departure times. While a handful of papers (Li, Ganesan, & Sivakumar, 2005, 2006; Stecke & Zhao, 2007; Wang, Batta, & Szczerba, 2005) address coordination between production and outbound distribution with fixed delivery departure times, we are not aware of articles on production and interstage distribution scheduling problems with fixed delivery departure times. In this paper we consider a general setting in which transportation can be provided by means of resources with fixed departure times as well as dedicated resources which are always available. We will refer to the two transportation modes above as regular and express respectively. In general, deciding which transportation resource is the most appropriate to perform each delivery is part of the 3PP decision problem. Koc, Toptal, and Sabuncuoglu (2013) consider the similar transportation setting for an integrated production and outbound delivery planning problem.

This paper is organized as follows. In Section 2, we formally describe the problems and introduce notation and terminology. Section 3 illustrates some general properties of the optimal solutions which are common to all scenarios. Section 4 is devoted to the scenario in which the manufacturer dominates, Section 5 to the scenario in which the 3PP dominates. Section 6 contains some conclusions and suggestions for future research.

In this section, we formally define the problems addressed in this paper. We refer to the upstream and downstream stages of a supply chain as machine 
                        
                           
                              
                                 M
                              
                              
                                 1
                              
                           
                        
                      and 
                        
                           
                              
                                 M
                              
                              
                                 2
                              
                           
                        
                      respectively. The context is specified by the following points.
                        
                           •
                           A manufacturer has to process a set of n nonpreemptive jobs, 
                                 
                                    1
                                    ,
                                    …
                                    ,
                                    n
                                 
                              . Each job 
                                 
                                    j
                                    ,
                                    
                                    j
                                    =
                                    1
                                    ,
                                    …
                                    ,
                                    n
                                 
                               is processed on machine 
                                 
                                    
                                       
                                          M
                                       
                                       
                                          1
                                       
                                    
                                 
                              , with processing time 
                                 
                                    
                                       
                                          p
                                       
                                       
                                          j
                                       
                                    
                                 
                              . A production schedule 
                              
                                 
                                    σ
                                 
                               is an assignment of starting times 
                                 
                                    
                                       
                                          S
                                       
                                       
                                          j
                                       
                                    
                                 
                               to each job j on 
                                 
                                    
                                       
                                          M
                                       
                                       
                                          1
                                       
                                    
                                 
                              . Since jobs cannot be preempted, job j completes on 
                                 
                                    
                                       
                                          M
                                       
                                       
                                          1
                                       
                                    
                                 
                               at 
                                 
                                    
                                       
                                          C
                                       
                                       
                                          j
                                       
                                    
                                    =
                                    
                                       
                                          S
                                       
                                       
                                          j
                                       
                                    
                                    +
                                    
                                       
                                          p
                                       
                                       
                                          j
                                       
                                    
                                 
                              . We denote by 
                                 
                                    σ
                                    (
                                    j
                                    )
                                 
                               the j-th job in the production schedule 
                                 
                                    σ
                                 
                              , and by 
                                 
                                    
                                       
                                          C
                                       
                                       
                                          k
                                       
                                    
                                    (
                                    σ
                                    )
                                 
                               the completion time of job k on 
                                 
                                    
                                       
                                          M
                                       
                                       
                                          1
                                       
                                    
                                 
                               in the production schedule 
                                 
                                    σ
                                 
                              .

Throughout the paper we consider production schedules in which 
                                 
                                    
                                       
                                          M
                                       
                                       
                                          1
                                       
                                    
                                 
                               continuously processes jobs, with no idle time. This constraint enforces a minimum productivity requirement, which is particularly meaningful in the scenario in which the 3PP dominates.

After processing on 
                                 
                                    
                                       
                                          M
                                       
                                       
                                          1
                                       
                                    
                                 
                              , the jobs have to be shipped from 
                                 
                                    
                                       
                                          M
                                       
                                       
                                          1
                                       
                                    
                                 
                               to 
                                 
                                    
                                       
                                          M
                                       
                                       
                                          2
                                       
                                    
                                 
                               (typically, located in a different city) for further processing. A 3PP is in charge of transportation.

Transportation must comply with a certain responsiveness requirement, i.e., each job j has to be delivered to 
                                 
                                    
                                       
                                          M
                                       
                                       
                                          2
                                       
                                    
                                 
                               within a time T from its completion on 
                                 
                                    
                                       
                                          M
                                       
                                       
                                          1
                                       
                                    
                                 
                              . In other words, for each job j, a deadline 
                              
                                 
                                    
                                       
                                          
                                             
                                                d
                                             
                                             
                                                ̃
                                             
                                          
                                       
                                       
                                          j
                                       
                                    
                                    =
                                    
                                       
                                          C
                                       
                                       
                                          j
                                       
                                    
                                    +
                                    T
                                 
                               is specified. We let 
                                 
                                    
                                       
                                          D
                                       
                                       
                                          j
                                       
                                    
                                 
                               denote the actual delivery time of job j to 
                                 
                                    
                                       
                                          M
                                       
                                       
                                          2
                                       
                                    
                                 
                              , so in a feasible solution 
                                 
                                    
                                       
                                          D
                                       
                                       
                                          j
                                       
                                    
                                    ⩽
                                    
                                       
                                          
                                             
                                                d
                                             
                                             
                                                ̃
                                             
                                          
                                       
                                       
                                          j
                                       
                                    
                                 
                               for all j.

The vehicles used by the 3PP have a certain capacity, given by the maximum number of jobs a vehicle can carry (i.e., jobs are supposed to have equal size).

The 3PP uses two transportation modes.
                                 
                                    –
                                    Type-1 transportation is regular transportation. There are 
                                          
                                             
                                                
                                                   V
                                                
                                                
                                                   1
                                                
                                             
                                          
                                        identical vehicles of capacity 
                                          
                                             
                                                
                                                   c
                                                
                                                
                                                   1
                                                
                                             
                                             ⩽
                                             n
                                          
                                        each of which has a fixed departure time. The transportation time from 
                                          
                                             
                                                
                                                   M
                                                
                                                
                                                   1
                                                
                                             
                                          
                                        to 
                                          
                                             
                                                
                                                   M
                                                
                                                
                                                   2
                                                
                                             
                                          
                                        is denoted by 
                                          
                                             
                                                
                                                   ℓ
                                                
                                                
                                                   1
                                                
                                             
                                          
                                       . The transportation cost per delivery is denoted by 
                                          
                                             
                                                
                                                   h
                                                
                                                
                                                   1
                                                
                                             
                                          
                                       . We assume we have L fixed delivery departure times 
                                          
                                             
                                                
                                                   t
                                                
                                                
                                                   1
                                                
                                             
                                             <
                                             …
                                             <
                                             
                                                
                                                   t
                                                
                                                
                                                   L
                                                
                                             
                                             ,
                                             
                                                
                                                   v
                                                
                                                
                                                   s
                                                
                                             
                                             ⩽
                                             n
                                          
                                        vehicles for departure time 
                                          
                                             
                                                
                                                   t
                                                
                                                
                                                   s
                                                
                                             
                                             ,
                                             s
                                             =
                                             1
                                             ,
                                             …
                                             ,
                                             L
                                          
                                       , and consequently 
                                          
                                             
                                                
                                                   V
                                                
                                                
                                                   1
                                                
                                             
                                             ⩽
                                             Ln
                                          
                                       .

Type-2 transportation is express transportation. There are 
                                          
                                             
                                                
                                                   V
                                                
                                                
                                                   2
                                                
                                             
                                          
                                        identical vehicles of capacity 
                                          
                                             
                                                
                                                   c
                                                
                                                
                                                   2
                                                
                                             
                                             ⩽
                                             n
                                          
                                       , each of which can depart at any time, i.e., there are no fixed departure times. The transportation time from 
                                          
                                             
                                                
                                                   M
                                                
                                                
                                                   1
                                                
                                             
                                          
                                        to 
                                          
                                             
                                                
                                                   M
                                                
                                                
                                                   2
                                                
                                             
                                          
                                        is denoted by 
                                          
                                             
                                                
                                                   ℓ
                                                
                                                
                                                   2
                                                
                                             
                                          
                                        and the return time by 
                                          
                                             
                                                
                                                   ℓ
                                                
                                                
                                                   2
                                                
                                                
                                                   ′
                                                
                                             
                                          
                                       . The transportation cost per delivery is denoted by 
                                          
                                             
                                                
                                                   h
                                                
                                                
                                                   2
                                                
                                             
                                          
                                       , expectedly larger than 
                                          
                                             
                                                
                                                   h
                                                
                                                
                                                   1
                                                
                                             
                                          
                                       .

Clearly, if either 
                                 
                                    
                                       
                                          V
                                       
                                       
                                          1
                                       
                                    
                                    =
                                    0
                                 
                               or 
                                 
                                    
                                       
                                          V
                                       
                                       
                                          2
                                       
                                    
                                    =
                                    0
                                 
                              , only one transportation mode exists.

For both transportation modes, jobs in the same delivery form a batch. A batch B is available for delivery when all jobs belonging to B are completed at 
                                 
                                    
                                       
                                          M
                                       
                                       
                                          1
                                       
                                    
                                 
                              . The delivery time of a batch B, denoted by 
                                 
                                    
                                       
                                          D
                                       
                                       
                                          B
                                       
                                    
                                 
                              , is the time at which the batch reaches 
                                 
                                    
                                       
                                          M
                                       
                                       
                                          2
                                       
                                    
                                 
                              . We let a regular batch or an express batch be a batch for which regular or express transportation, respectively, is used.

Given a production schedule, a delivery schedule 
                              
                                 
                                    B
                                 
                               is a partition of the jobs into b batches, along with the specification of a transportation mode and the departure time for each batch.

A production–distribution schedule is specified by a production schedule 
                                 
                                    σ
                                 
                               and a delivery schedule 
                                 
                                    B
                                 
                              . We indicate a production–distribution schedule by the pair 
                                 
                                    (
                                    σ
                                    ,
                                    B
                                    )
                                 
                              . Given a production–distribution schedule, we let 
                                 
                                    B
                                    (
                                    j
                                    )
                                 
                               denote the batch of job j. The delivery time of a job j is therefore denoted by 
                                 
                                    
                                       
                                          D
                                       
                                       
                                          B
                                          (
                                          j
                                          )
                                       
                                    
                                 
                              .

In all scenarios, the objective of the 3PP is to minimize the transportation cost 
                                 
                                    TC
                                    =
                                    
                                       
                                          h
                                       
                                       
                                          1
                                       
                                    
                                    
                                       
                                          n
                                       
                                       
                                          1
                                       
                                    
                                    +
                                    
                                       
                                          h
                                       
                                       
                                          2
                                       
                                    
                                    
                                       
                                          n
                                       
                                       
                                          2
                                       
                                    
                                 
                              , where 
                                 
                                    
                                       
                                          n
                                       
                                       
                                          1
                                       
                                    
                                 
                               and 
                                 
                                    
                                       
                                          n
                                       
                                       
                                          2
                                       
                                    
                                 
                               are the number of batches of type 1 (regular) and type 2 (express), respectively. If only one transportation mode is present, the objective is to minimize the number of batches.


                     Scenarios. In this paper we consider two scenarios, corresponding to two types of agreements (contracts) between the manufacturer and the 3PP. These are formally defined in the following.
                        
                           1.
                           
                              Manufacturer dominates. In this scenario, the manufacturer predetermines the production schedule on 
                                 
                                    
                                       
                                          M
                                       
                                       
                                          1
                                       
                                    
                                 
                              , and hence the time 
                                 
                                    
                                       
                                          C
                                       
                                       
                                          j
                                       
                                    
                                 
                               at which each job j is released by 
                                 
                                    
                                       
                                          M
                                       
                                       
                                          1
                                       
                                    
                                 
                              . The 3PP aims at finding a delivery schedule that minimizes TC, while respecting the deadline 
                                 
                                    
                                       
                                          
                                             
                                                d
                                             
                                             
                                                ̃
                                             
                                          
                                       
                                       
                                          j
                                       
                                    
                                    =
                                    
                                       
                                          C
                                       
                                       
                                          j
                                       
                                    
                                    +
                                    T
                                 
                               of each job j. These problems can be seen as IPODS (Integrated production and outbound distribution scheduling) problems (Chen, 2010) with a single machine, deadlines and batch delivery to a single customer, in which the sequence on the machine is fixed. Throughout the paper we use the five-field notation 
                                 
                                    α
                                    |
                                    β
                                    |
                                    π
                                    |
                                    δ
                                    |
                                    γ
                                 
                               introduced by Chen (2010), the problem can therefore be denoted as 
                                 
                                    1
                                    |
                                    fseq
                                    ,
                                    
                                    
                                       
                                          
                                             
                                                d
                                             
                                             
                                                ̃
                                             
                                          
                                       
                                       
                                          j
                                       
                                    
                                    =
                                    
                                       
                                          C
                                       
                                       
                                          j
                                       
                                    
                                    +
                                    T
                                    |
                                    π
                                    |
                                    1
                                    |
                                    TC
                                 
                              , where:
                                 
                                    
                                       
                                          
                                             α
                                          
                                       :
                                    This field is equal to 1, which refers to a single machine (
                                          
                                             
                                                
                                                   M
                                                
                                                
                                                   1
                                                
                                             
                                          
                                       ).

In this field, fseq indicates that the sequence on 
                                          
                                             
                                                
                                                   M
                                                
                                                
                                                   1
                                                
                                             
                                          
                                        is fixed, and deadlines are defined as 
                                          
                                             
                                                
                                                   C
                                                
                                                
                                                   j
                                                
                                             
                                             +
                                             T
                                          
                                       .

This field may contain the following values:
                                          
                                             •
                                             
                                                
                                                   
                                                      
                                                         
                                                            V
                                                         
                                                         
                                                            1
                                                         
                                                      
                                                      (
                                                      
                                                         
                                                            x
                                                         
                                                         
                                                            1
                                                         
                                                      
                                                      ,
                                                      
                                                         
                                                            y
                                                         
                                                         
                                                            1
                                                         
                                                      
                                                      )
                                                   
                                                , where 
                                                   
                                                      
                                                         
                                                            x
                                                         
                                                         
                                                            1
                                                         
                                                      
                                                      ∈
                                                      {
                                                      
                                                         
                                                            V
                                                         
                                                         
                                                            1
                                                         
                                                      
                                                      ,
                                                      ∞
                                                      }
                                                   
                                                 is the total number of vehicles for regular transportation (either limited or unlimited) and 
                                                   
                                                      
                                                         
                                                            y
                                                         
                                                         
                                                            1
                                                         
                                                      
                                                      ∈
                                                      {
                                                      
                                                         
                                                            c
                                                         
                                                         
                                                            1
                                                         
                                                      
                                                      ,
                                                      ∞
                                                      }
                                                   
                                                 is the capacity of each vehicle for regular transportation (either limited or unlimited).


                                                
                                                   
                                                      
                                                         
                                                            V
                                                         
                                                         
                                                            2
                                                         
                                                      
                                                      (
                                                      
                                                         
                                                            x
                                                         
                                                         
                                                            2
                                                         
                                                      
                                                      ,
                                                      
                                                         
                                                            y
                                                         
                                                         
                                                            2
                                                         
                                                      
                                                      )
                                                   
                                                , where 
                                                   
                                                      
                                                         
                                                            x
                                                         
                                                         
                                                            2
                                                         
                                                      
                                                      ∈
                                                      {
                                                      
                                                         
                                                            V
                                                         
                                                         
                                                            2
                                                         
                                                      
                                                      ,
                                                      ∞
                                                      }
                                                   
                                                 represents the total number of vehicles for express transportation (either limited or unlimited) and 
                                                   
                                                      
                                                         
                                                            y
                                                         
                                                         
                                                            2
                                                         
                                                      
                                                      ∈
                                                      {
                                                      
                                                         
                                                            c
                                                         
                                                         
                                                            2
                                                         
                                                      
                                                      ,
                                                      ∞
                                                      }
                                                   
                                                 represents the capacity of each vehicle for express transportation (either limited or unlimited).

This field is equal to 1, which refers to a single customer (
                                          
                                             
                                                
                                                   M
                                                
                                                
                                                   2
                                                
                                             
                                          
                                       ).

This field contains the objective function, which is the total cost to the 3PP (TC).


                              3PP dominates. In this scenario, the 3PP decides a production–distribution schedule (hence, both a production schedule on 
                                 
                                    
                                       
                                          M
                                       
                                       
                                          1
                                       
                                    
                                 
                               and a delivery schedule) such that the transportation cost TC is minimized, while delivering each job within T from its release by 
                                 
                                    
                                       
                                          M
                                       
                                       
                                          1
                                       
                                    
                                 
                               (i.e., 
                                 
                                    
                                       
                                          
                                             
                                                d
                                             
                                             
                                                ̃
                                             
                                          
                                       
                                       
                                          j
                                       
                                    
                                    =
                                    
                                       
                                          C
                                       
                                       
                                          j
                                       
                                    
                                    +
                                    T
                                 
                               for each job j). Also this problem can be seen as an IPODS problem, denoted by 
                                 
                                    1
                                    |
                                    no
                                    -
                                    idle
                                    ,
                                    
                                       
                                          
                                             
                                                d
                                             
                                             
                                                ̃
                                             
                                          
                                       
                                       
                                          j
                                       
                                    
                                    =
                                    
                                       
                                          C
                                       
                                       
                                          j
                                       
                                    
                                    +
                                    T
                                    |
                                    π
                                    |
                                    1
                                    |
                                    TC
                                 
                              . In the 
                                 
                                    β
                                 
                               field we specify that 
                                 
                                    
                                       
                                          M
                                       
                                       
                                          1
                                       
                                    
                                 
                               must never be idle, while 
                                 
                                    π
                                 
                               is as described in the previous scenario.


                     Tables 1 and 2
                     
                      summarize the complexity results presented in this paper, in which P stands for polynomially solvable, and sNP for strongly NP-hard.

In this section we give some general properties of the optimal delivery schedule that apply to all scenarios considered in this paper, hence to all problems denoted by 
                        
                           1
                           |
                           ·
                           ,
                           
                              
                                 
                                    
                                       d
                                    
                                    
                                       ̃
                                    
                                 
                              
                              
                                 j
                              
                           
                           =
                           
                              
                                 C
                              
                              
                                 j
                              
                           
                           +
                           T
                           |
                           π
                           |
                           1
                           |
                           TC
                        
                     , where 
                        
                           ·
                        
                      may actually be either fseq (if the manufacturer dominates) or 
                        
                           no
                           -
                           idle
                        
                      (if the 3PP dominates).

In what follows, we say that a batch B is split by another batch 
                     
                        
                           
                              
                                 B
                              
                              
                                 ′
                              
                           
                        
                      if B contains some jobs that are processed before some jobs of 
                        
                           
                              
                                 B
                              
                              
                                 ′
                              
                           
                        
                     , and some jobs which are processed after some jobs of 
                        
                           
                              
                                 B
                              
                              
                                 ′
                              
                           
                        
                      on 
                        
                           
                              
                                 M
                              
                              
                                 1
                              
                           
                        
                     . Also, given a delivery schedule, we say that we swap two jobs i and j to mean that we move job i to 
                        
                           B
                           (
                           j
                           )
                        
                      and job j to 
                        
                           B
                           (
                           i
                           )
                        
                     , without changing the production schedule 
                        
                           σ
                        
                      on 
                        
                           
                              
                                 M
                              
                              
                                 1
                              
                           
                        
                      nor the departure time of each batch.
                        Lemma 1
                        
                           There exists an optimal delivery schedule for the problem 
                           
                              
                                 1
                                 |
                                 ·
                                 ,
                                 
                                    
                                       
                                          
                                             d
                                          
                                          
                                             ̃
                                          
                                       
                                    
                                    
                                       j
                                    
                                 
                                 =
                                 
                                    
                                       C
                                    
                                    
                                       j
                                    
                                 
                                 +
                                 T
                                 |
                                 π
                                 |
                                 1
                                 |
                                 TC
                              
                           
                           , such that the following properties hold:
                           
                              
                                 1.
                                 
                                    If jobs i and j are delivered by the same transportation mode and 
                                    
                                       
                                          
                                             
                                                C
                                             
                                             
                                                i
                                             
                                          
                                          <
                                          
                                             
                                                C
                                             
                                             
                                                j
                                             
                                          
                                       
                                    
                                    , then 
                                    
                                       
                                          
                                             
                                                D
                                             
                                             
                                                i
                                             
                                          
                                          ⩽
                                          
                                             
                                                D
                                             
                                             
                                                j
                                             
                                          
                                       
                                    
                                    .
                                 


                                    An express batch can be only split by regular batches and a regular batch can be only split by express batches.
                                 


                                    If there exists one transportation mode only, the jobs of each batch are processed consecutively on machine 
                                    
                                       
                                          
                                             
                                                M
                                             
                                             
                                                1
                                             
                                          
                                       
                                    
                                    .
                                 


                                    If there exist two transportation modes,
                                    
                                       
                                          (a)
                                          
                                             If 
                                             
                                                
                                                   
                                                      
                                                         ℓ
                                                      
                                                      
                                                         1
                                                      
                                                   
                                                   ⩾
                                                   
                                                      
                                                         ℓ
                                                      
                                                      
                                                         2
                                                      
                                                   
                                                
                                             
                                             , no regular batch is split.
                                          


                                             If 
                                             
                                                
                                                   
                                                      
                                                         ℓ
                                                      
                                                      
                                                         1
                                                      
                                                   
                                                   ⩽
                                                   
                                                      
                                                         ℓ
                                                      
                                                      
                                                         2
                                                      
                                                   
                                                
                                             
                                             , no express batch is split.
                                          


                                    If there exists an unlimited number of vehicles for express transportation, each express batch departs at the completion time of the last job in this batch.
                                 


                                    If there exists a limited number of vehicles for express transportation, each express batch departs either at the completion time of the last job in this batch or as soon as a vehicle for express transportation is available.
                                 

In what follows, we denote by 
                              
                                 Se
                                 (
                                 i
                                 ,
                                 j
                                 )
                              
                            the subsequence of jobs from 
                              
                                 σ
                                 (
                                 i
                                 )
                              
                            through 
                              
                                 σ
                                 (
                                 j
                                 )
                              
                            on 
                              
                                 
                                    
                                       M
                                    
                                    
                                       1
                                    
                                 
                              
                           . We do not change the production schedule 
                              
                                 σ
                              
                           .□


                           Suppose that there is an optimal delivery schedule such that job i is delivered after job j by the same transportation mode although 
                           
                              
                                 
                                    
                                       C
                                    
                                    
                                       i
                                    
                                 
                                 <
                                 
                                    
                                       C
                                    
                                    
                                       j
                                    
                                 
                              
                           
                           , i.e., 
                           
                              
                                 
                                    
                                       D
                                    
                                    
                                       B
                                       (
                                       j
                                       )
                                    
                                 
                                 <
                                 
                                    
                                       D
                                    
                                    
                                       B
                                       (
                                       i
                                       )
                                    
                                 
                              
                            
                           and 
                           
                              
                                 
                                    
                                       
                                          
                                             d
                                          
                                          
                                             ̃
                                          
                                       
                                    
                                    
                                       i
                                    
                                 
                                 <
                                 
                                    
                                       
                                          
                                             d
                                          
                                          
                                             ̃
                                          
                                       
                                    
                                    
                                       j
                                    
                                 
                              
                           
                           . Since 
                           
                              
                                 
                                    
                                       D
                                    
                                    
                                       B
                                       (
                                       i
                                       )
                                    
                                 
                                 ⩽
                                 
                                    
                                       
                                          
                                             d
                                          
                                          
                                             ̃
                                          
                                       
                                    
                                    
                                       i
                                    
                                 
                              
                           
                           , one has 
                           
                              
                                 
                                    
                                       D
                                    
                                    
                                       B
                                       (
                                       j
                                       )
                                    
                                 
                                 <
                                 
                                    
                                       D
                                    
                                    
                                       B
                                       (
                                       i
                                       )
                                    
                                 
                                 ⩽
                                 
                                    
                                       
                                          
                                             d
                                          
                                          
                                             ̃
                                          
                                       
                                    
                                    
                                       i
                                    
                                 
                                 <
                                 
                                    
                                       
                                          
                                             d
                                          
                                          
                                             ̃
                                          
                                       
                                    
                                    
                                       j
                                    
                                 
                              
                           
                           . We can then swap i and j obtaining a new delivery schedule which is still feasible and has the same transportation cost. This argument can be repeated until the delivery schedule satisfies Property 1.
                        


                           Suppose there is an optimal delivery schedule which does not respect Property 2, i.e., assume that a regular batch B is split by some express batches and some regular batches. Consider the subsequence 
                           
                              
                                 Se
                                 (
                                 i
                                 ,
                                 j
                                 )
                              
                           
                           , where 
                           
                              
                                 σ
                                 (
                                 i
                                 )
                              
                            
                           and 
                           
                              
                                 σ
                                 (
                                 j
                                 )
                              
                            
                           are respectively the first and the last job of batch B. Due to Property 1, 
                           
                              
                                 
                                    
                                       D
                                    
                                    
                                       B
                                       (
                                       σ
                                       (
                                       i
                                       )
                                       )
                                    
                                 
                                 ⩽
                                 
                                    
                                       D
                                    
                                    
                                       
                                          
                                             B
                                          
                                          
                                             ′
                                          
                                       
                                    
                                 
                                 ⩽
                                 
                                    
                                       D
                                    
                                    
                                       B
                                       (
                                       σ
                                       (
                                       j
                                       )
                                       )
                                    
                                 
                              
                           
                           , where 
                           
                              
                                 
                                    
                                       B
                                    
                                    
                                       ′
                                    
                                 
                              
                            
                           is any regular batch in 
                           
                              
                                 Se
                                 (
                                 i
                                 ,
                                 j
                                 )
                              
                           
                           . Since 
                           
                              
                                 
                                    
                                       D
                                    
                                    
                                       B
                                       (
                                       σ
                                       (
                                       i
                                       )
                                       )
                                    
                                 
                                 =
                                 
                                    
                                       D
                                    
                                    
                                       B
                                       (
                                       σ
                                       (
                                       j
                                       )
                                       )
                                    
                                 
                              
                           
                           , all regular batches in 
                           
                              
                                 Se
                                 (
                                 i
                                 ,
                                 j
                                 )
                              
                            
                           have the same departure time. In the subsequence 
                           
                              
                                 Se
                                 (
                                 i
                                 ,
                                 j
                                 )
                              
                           
                           , we do the following: as long as there is an h and an 
                           
                              
                                 k
                                 ,
                                 i
                                 ⩽
                                 h
                                 <
                                 k
                                 ⩽
                                 j
                              
                           
                           , such that 
                           
                              
                                 σ
                                 (
                                 h
                                 )
                                 ∈
                                 B
                              
                            
                           and 
                           
                              
                                 σ
                                 (
                                 k
                                 )
                                 ∈
                                 
                                    
                                       B
                                    
                                    
                                       ′
                                    
                                 
                              
                           
                           , where 
                           
                              
                                 
                                    
                                       B
                                    
                                    
                                       ′
                                    
                                 
                              
                            
                           is a regular batch different from B, swap 
                           
                              
                                 σ
                                 (
                                 h
                                 )
                              
                            
                           and 
                           
                              
                                 σ
                                 (
                                 k
                                 )
                              
                           
                           . When no further such swap is possible, we stop. In the resulting delivery schedule, batch B is split only by express batches. By a very similar argument, one can prove that there is an optimal schedule in which any express batch can be only split by regular batches.
                        


                           This is a direct consequence of Property 2. If only one transportation mode exists (i.e., either 
                           
                              
                                 
                                    
                                       V
                                    
                                    
                                       1
                                    
                                 
                                 =
                                 0
                              
                            
                           or 
                           
                              
                                 
                                    
                                       V
                                    
                                    
                                       2
                                    
                                 
                                 =
                                 0
                              
                           
                           ), no batch can be split.
                        


                           Suppose that in an optimal delivery schedule 
                           
                              
                                 B
                              
                           
                           , the jobs of a regular batch B are not processed consecutively on machine 
                           
                              
                                 
                                    
                                       M
                                    
                                    
                                       1
                                    
                                 
                              
                            
                           when 
                           
                              
                                 
                                    
                                       ℓ
                                    
                                    
                                       1
                                    
                                 
                                 ⩾
                                 
                                    
                                       ℓ
                                    
                                    
                                       2
                                    
                                 
                              
                           
                           . According to Property 2 above, batch B can be only split by express batches. Letting again 
                           
                              
                                 σ
                                 (
                                 i
                                 )
                              
                            
                           and 
                           
                              
                                 σ
                                 (
                                 j
                                 )
                              
                            
                           be the first and last job in B, consider the subsequence 
                           
                              
                                 Se
                                 (
                                 i
                                 ,
                                 j
                                 )
                              
                           
                           , and let 
                           
                              
                                 σ
                                 (
                                 u
                                 )
                              
                            
                           be the first job in 
                           
                              
                                 Se
                                 (
                                 i
                                 ,
                                 j
                                 )
                              
                            
                           belonging to an express batch such that 
                           
                              
                                 
                                    
                                       D
                                    
                                    
                                       σ
                                       (
                                       u
                                       )
                                    
                                 
                                 -
                                 
                                    
                                       ℓ
                                    
                                    
                                       2
                                    
                                 
                                 ⩾
                                 
                                    
                                       C
                                    
                                    
                                       σ
                                       (
                                       j
                                       )
                                    
                                 
                              
                            
                           (see 
                           
                              Fig. 1
                           
                           , in which 
                           
                              
                                 σ
                                 (
                                 i
                                 )
                                 =
                                 4
                                 ,
                                 σ
                                 (
                                 j
                                 )
                                 =
                                 8
                              
                            
                           and 
                           
                              
                                 σ
                                 (
                                 u
                                 )
                                 =
                                 6
                              
                           
                           ). Note that job 
                           
                              
                                 σ
                                 (
                                 u
                                 )
                              
                            
                           is the first job of an express batch. Hence, in the subsequence 
                           
                              
                                 Se
                                 (
                                 i
                                 ,
                                 u
                                 -
                                 1
                                 )
                              
                           
                           , we do the following: as long as there is an 
                           
                              
                                 h
                                 ,
                                 i
                                 ⩽
                                 h
                                 ⩽
                                 u
                                 -
                                 2
                              
                           
                           , such that 
                           
                              
                                 σ
                                 (
                                 h
                                 )
                                 ∈
                                 B
                              
                            
                           and 
                           
                              
                                 σ
                                 (
                                 h
                                 +
                                 1
                                 )
                                 ∈
                                 
                                    
                                       B
                                    
                                    
                                       ′
                                    
                                 
                              
                           
                           , where 
                           
                              
                                 
                                    
                                       B
                                    
                                    
                                       ′
                                    
                                 
                              
                            
                           is an express batch, swap 
                           
                              
                                 σ
                                 (
                                 h
                                 )
                              
                            
                           and 
                           
                              
                                 σ
                                 (
                                 h
                                 +
                                 1
                                 )
                              
                           
                           . When no further such swap is possible, we stop. In the resulting delivery schedule 
                           
                              
                                 
                                    
                                       B
                                    
                                    
                                       ^
                                    
                                 
                              
                           
                           , batch B is scheduled after all express batches preceding job u. In 
                           
                              
                                 
                                    
                                       B
                                    
                                    
                                       ^
                                    
                                 
                              
                           
                           , the deadline of the first job of batch B has been delayed, so the jobs of batch B are not late. For each job 
                           
                              
                                 σ
                                 (
                                 k
                                 )
                              
                            
                           from any express batch, recalling that 
                           
                              
                                 
                                    
                                       D
                                    
                                    
                                       σ
                                       (
                                       k
                                       )
                                    
                                 
                                 -
                                 
                                    
                                       ℓ
                                    
                                    
                                       2
                                    
                                 
                                 <
                                 
                                    
                                       C
                                    
                                    
                                       σ
                                       (
                                       j
                                       )
                                    
                                 
                                 ,
                                 
                                    
                                       C
                                    
                                    
                                       σ
                                       (
                                       j
                                       )
                                    
                                 
                                 +
                                 
                                    
                                       ℓ
                                    
                                    
                                       1
                                    
                                 
                                 ⩽
                                 
                                    
                                       
                                          
                                             d
                                          
                                          
                                             ̃
                                          
                                       
                                    
                                    
                                       σ
                                       (
                                       i
                                       )
                                    
                                 
                              
                            
                           and 
                           
                              
                                 
                                    
                                       ℓ
                                    
                                    
                                       2
                                    
                                 
                                 ⩽
                                 
                                    
                                       ℓ
                                    
                                    
                                       1
                                    
                                 
                              
                           
                           , one has that 
                           
                              
                                 
                                    
                                       D
                                    
                                    
                                       σ
                                       (
                                       k
                                       )
                                    
                                 
                                 ⩽
                                 
                                    
                                       C
                                    
                                    
                                       σ
                                       (
                                       j
                                       )
                                    
                                 
                                 +
                                 
                                    
                                       ℓ
                                    
                                    
                                       2
                                    
                                 
                                 ⩽
                                 
                                    
                                       
                                          
                                             d
                                          
                                          
                                             ̃
                                          
                                       
                                    
                                    
                                       σ
                                       (
                                       i
                                       )
                                    
                                 
                                 ⩽
                                 
                                    
                                       
                                          
                                             d
                                          
                                          
                                             ̃
                                          
                                       
                                    
                                    
                                       σ
                                       (
                                       k
                                       )
                                    
                                 
                              
                           
                           . So no job from any express batch is late. Symmetrically, starting now from 
                           
                              
                                 
                                    
                                       B
                                    
                                    
                                       ^
                                    
                                 
                              
                           
                           , consider the subsequence 
                           
                              
                                 Se
                                 (
                                 u
                                 ,
                                 j
                                 )
                              
                           
                           , and do the following: as long as there is an h such that 
                           
                              
                                 σ
                                 (
                                 h
                                 )
                                 ∈
                                 
                                    
                                       B
                                    
                                    
                                       ′
                                    
                                 
                              
                            
                           and 
                           
                              
                                 σ
                                 (
                                 h
                                 +
                                 1
                                 )
                                 ∈
                                 B
                              
                           
                           , where 
                           
                              
                                 
                                    
                                       B
                                    
                                    
                                       ′
                                    
                                 
                              
                            
                           is an express batch, then swap 
                           
                              
                                 σ
                                 (
                                 h
                                 )
                              
                            
                           and 
                           
                              
                                 σ
                                 (
                                 h
                                 +
                                 1
                                 )
                              
                           
                           . When no further such swap is possible, we stop. In the resulting delivery schedule 
                           
                              
                                 
                                    
                                       B
                                    
                                    
                                       ‾
                                    
                                 
                              
                           
                           , batch B terminates before all express batches following job u. Note that, since neither the leftmost job of B nor 
                           
                              
                                 
                                    
                                       D
                                    
                                    
                                       B
                                    
                                 
                              
                            
                           have changed, no job of batch B is late. Also, the deadline of the first job of no express batch has been anticipated, so again no job from any express batch is late. In conclusion, 
                           
                              
                                 
                                    
                                       B
                                    
                                    
                                       ‾
                                    
                                 
                              
                            
                           is optimal and the jobs of batch B are processed consecutively on machine 
                           
                              
                                 
                                    
                                       M
                                    
                                    
                                       1
                                    
                                 
                              
                            
                           (see 
                           
                              Fig. 1
                           ).
                        

Applying this argument to each regular batch B which is split, we can obtain a new optimal production–distribution schedule in which no regular batch is split.
                        Property 4(b)
                        
                           The proof is symmetrical to that of Property 4(a).
                        


                           Simply observe that if, in an optimal delivery schedule, the departure time of an express batch B is later than the completion time of the last job in B, one can simply anticipate the departure time of batch B to the completion time of the last job in batch B. If there is an unlimited number of vehicles for express transportation, this does not affect the subsequent schedule.
                        


                           Similar to that of Property 5, but since the number of vehicles is limited, now we anticipate the departure time of a batch B either to the completion time of the last job in B or to the time the vehicle transporting B becomes available.
                        

In this section we consider the scenario in which the manufacturer decides the production schedule. Throughout Section 4, since the production schedule is fixed, we can simplify the notation assuming that the jobs are numbered by increasing completion times, i.e., 
                        
                           σ
                           (
                           i
                           )
                           =
                           i
                        
                      and 
                        
                           
                              
                                 C
                              
                              
                                 1
                              
                           
                           <
                           …
                           <
                           
                              
                                 C
                              
                              
                                 n
                              
                           
                        
                     .

In the following subsections, we consider the 3PP’s problems with different transportation modes. First we consider the problems with both transportation modes (Section 4.1), then the problems with regular transportation only (Section 4.2), and finally the problems with express transportation only (Section 4.3).

We first address the problem 
                              
                                 1
                                 |
                                 fseq
                                 ,
                                 
                                 
                                    
                                       
                                          
                                             d
                                          
                                          
                                             ̃
                                          
                                       
                                    
                                    
                                       j
                                    
                                 
                                 =
                                 
                                    
                                       C
                                    
                                    
                                       j
                                    
                                 
                                 +
                                 T
                                 |
                                 
                                    
                                       V
                                    
                                    
                                       1
                                    
                                 
                                 (
                                 
                                    
                                       V
                                    
                                    
                                       1
                                    
                                 
                                 ,
                                 
                                    
                                       c
                                    
                                    
                                       1
                                    
                                 
                                 )
                                 ,
                                 
                                 
                                    
                                       V
                                    
                                    
                                       2
                                    
                                 
                                 (
                                 ∞
                                 ,
                                 
                                    
                                       c
                                    
                                    
                                       2
                                    
                                 
                                 )
                                 ,
                                 
                                 
                                    
                                       ℓ
                                    
                                    
                                       1
                                    
                                 
                                 >
                                 
                                    
                                       ℓ
                                    
                                    
                                       2
                                    
                                 
                                 |
                                 1
                                 |
                                 TC
                              
                           , in which there is a limited number 
                              
                                 
                                    
                                       V
                                    
                                    
                                       1
                                    
                                 
                              
                            of vehicles for regular transportation and an unlimited number of vehicles for express transportation, and 
                              
                                 
                                    
                                       ℓ
                                    
                                    
                                       1
                                    
                                 
                                 >
                                 
                                    
                                       ℓ
                                    
                                    
                                       2
                                    
                                 
                              
                           . We present a dynamic programming algorithm to solve this problem. Recall that according to Property 4(a) of Lemma 1, the jobs of each regular batch are processed consecutively on 
                              
                                 
                                    
                                       M
                                    
                                    
                                       1
                                    
                                 
                              
                           , according to Property 2 of Lemma 1 each express batch can be only split by regular batches, and according to Property 5 of Lemma 1 each express batch departs at the completion time of the last job in this batch.


                           Algorithm EE1.


                           State and Value Function
                        

The dynamic program considers state 
                              
                                 (
                                 i
                                 ,
                                 
                                    
                                       j
                                    
                                    
                                       1
                                    
                                 
                                 ,
                                 
                                    
                                       j
                                    
                                    
                                       2
                                    
                                 
                                 ,
                                 s
                                 ,
                                 v
                                 ,
                                 g
                                 ,
                                 m
                                 )
                              
                           , in which:
                              
                                 •
                                 The first i jobs have been delivered.

Job 
                                       
                                          
                                             
                                                j
                                             
                                             
                                                1
                                             
                                          
                                       
                                     is the first job of the last regular batch scheduled so far, job 
                                       
                                          
                                             
                                                j
                                             
                                             
                                                2
                                             
                                          
                                       
                                     is the first job of the last express batch scheduled so far.

Parameter m indicates the transportation mode of the last batch, namely 
                                       
                                          m
                                          =
                                          1
                                       
                                     stands for regular transportation, and 
                                       
                                          m
                                          =
                                          2
                                       
                                     for express transportation.

The current last regular batch departs at time 
                                       
                                          
                                             
                                                t
                                             
                                             
                                                s
                                             
                                          
                                       
                                    .

At time 
                                       
                                          
                                             
                                                t
                                             
                                             
                                                s
                                             
                                          
                                          ,
                                          
                                          v
                                          ⩽
                                          
                                             
                                                v
                                             
                                             
                                                s
                                             
                                          
                                       
                                     vehicles for regular transportation have been used.

The current last express batch consists of g jobs. If 
                                       
                                          m
                                          =
                                          2
                                       
                                    , job i is the current last job of such batch, thus it departs at time 
                                       
                                          
                                             
                                                C
                                             
                                             
                                                i
                                             
                                          
                                       
                                    .

We let 
                              
                                 f
                                 (
                                 i
                                 ,
                                 
                                    
                                       j
                                    
                                    
                                       1
                                    
                                 
                                 ,
                                 
                                    
                                       j
                                    
                                    
                                       2
                                    
                                 
                                 ,
                                 s
                                 ,
                                 v
                                 ,
                                 g
                                 ,
                                 m
                                 )
                              
                            denote the minimum transportation cost of all schedules in state (
                              
                                 i
                                 ,
                                 
                                    
                                       j
                                    
                                    
                                       1
                                    
                                 
                                 ,
                                 
                                    
                                       j
                                    
                                    
                                       2
                                    
                                 
                                 ,
                                 s
                                 ,
                                 v
                                 ,
                                 g
                                 ,
                                 m
                              
                           ).


                           Boundary condition
                           
                              
                                 
                                    f
                                    (
                                    0
                                    ,
                                    0
                                    ,
                                    0
                                    ,
                                    0
                                    ,
                                    0
                                    ,
                                    0
                                    ,
                                    1
                                    )
                                    =
                                    0
                                    ,
                                    
                                    f
                                    (
                                    0
                                    ,
                                    0
                                    ,
                                    0
                                    ,
                                    0
                                    ,
                                    0
                                    ,
                                    0
                                    ,
                                    2
                                    )
                                    =
                                    0
                                    .
                                 
                              
                           
                        


                           Optimal solution value
                           
                              
                                 
                                    
                                       
                                          min
                                       
                                       
                                          (
                                          
                                             
                                                j
                                             
                                             
                                                1
                                             
                                          
                                          ,
                                          
                                             
                                                j
                                             
                                             
                                                2
                                             
                                          
                                          ,
                                          s
                                          ,
                                          v
                                          ,
                                          g
                                          ,
                                          m
                                          )
                                          ∈
                                          A
                                       
                                    
                                    f
                                    (
                                    n
                                    ,
                                    
                                       
                                          j
                                       
                                       
                                          1
                                       
                                    
                                    ,
                                    
                                       
                                          j
                                       
                                       
                                          2
                                       
                                    
                                    ,
                                    s
                                    ,
                                    v
                                    ,
                                    g
                                    ,
                                    m
                                    )
                                    ,
                                 
                              
                           
                        

where 
                              
                                 A
                                 =
                                 {
                                 (
                                 
                                    
                                       j
                                    
                                    
                                       1
                                    
                                 
                                 ,
                                 
                                    
                                       j
                                    
                                    
                                       2
                                    
                                 
                                 ,
                                 s
                                 ,
                                 v
                                 ,
                                 g
                                 ,
                                 m
                                 )
                                 |
                                 1
                                 ⩽
                                 
                                    
                                       j
                                    
                                    
                                       1
                                    
                                 
                                 ⩽
                                 n
                                 ,
                                 1
                                 ⩽
                                 
                                    
                                       j
                                    
                                    
                                       2
                                    
                                 
                                 ⩽
                                 n
                                 ,
                                 0
                                 ⩽
                                 s
                                 ⩽
                                 L
                                 ,
                                 0
                                 ⩽
                                 v
                                 ⩽
                                 
                                    
                                       v
                                    
                                    
                                       s
                                    
                                 
                                 ,
                                 0
                                 ⩽
                                 g
                                 ⩽
                                 
                                    
                                       c
                                    
                                    
                                       2
                                    
                                 
                                 ,
                                 m
                                 =
                                 1
                                 ,
                                 2
                                 }
                              
                           .


                           Recurrence relation
                        

We next consider the recurrence relation for 
                              
                                 f
                                 (
                                 i
                                 ,
                                 
                                    
                                       j
                                    
                                    
                                       1
                                    
                                 
                                 ,
                                 
                                    
                                       j
                                    
                                    
                                       2
                                    
                                 
                                 ,
                                 s
                                 ,
                                 v
                                 ,
                                 g
                                 ,
                                 m
                                 )
                              
                           . Actually, such state is only defined for values of the indices such that:
                              
                                 •
                                 
                                    
                                       
                                          i
                                          ∈
                                          {
                                          1
                                          ,
                                          …
                                          ,
                                          n
                                          }
                                          ,
                                          
                                             
                                                j
                                             
                                             
                                                1
                                             
                                          
                                          ∈
                                          {
                                          1
                                          ,
                                          …
                                          ,
                                          i
                                          }
                                          ,
                                          
                                             
                                                j
                                             
                                             
                                                2
                                             
                                          
                                          ∈
                                          {
                                          1
                                          ,
                                          …
                                          ,
                                          i
                                          }
                                          ,
                                          s
                                          ∈
                                          {
                                          0
                                          ,
                                          …
                                          ,
                                          L
                                          }
                                          ,
                                          v
                                          ∈
                                          {
                                          0
                                          ,
                                          …
                                          ,
                                          
                                             
                                                v
                                             
                                             
                                                s
                                             
                                          
                                          }
                                       
                                    , 
                                       
                                          g
                                          ∈
                                          {
                                          0
                                          ,
                                          …
                                          ,
                                          
                                             
                                                c
                                             
                                             
                                                2
                                             
                                          
                                          }
                                          ,
                                          m
                                          ∈
                                          {
                                          1
                                          ,
                                          2
                                          }
                                       
                                    .

If 
                                       
                                          m
                                          =
                                          1
                                       
                                    , then 
                                       
                                          s
                                          >
                                          0
                                          ,
                                          
                                          v
                                          >
                                          0
                                       
                                     and:
                                       
                                          –
                                          
                                             
                                                
                                                   
                                                      
                                                         C
                                                      
                                                      
                                                         i
                                                      
                                                   
                                                   ⩽
                                                   
                                                      
                                                         t
                                                      
                                                      
                                                         s
                                                      
                                                   
                                                
                                             , i.e., job i must be completed before the batch departs.


                                             
                                                
                                                   
                                                      
                                                         t
                                                      
                                                      
                                                         s
                                                      
                                                   
                                                   +
                                                   
                                                      
                                                         ℓ
                                                      
                                                      
                                                         1
                                                      
                                                   
                                                   ⩽
                                                   
                                                      
                                                         C
                                                      
                                                      
                                                         
                                                            
                                                               j
                                                            
                                                            
                                                               1
                                                            
                                                         
                                                      
                                                   
                                                   +
                                                   T
                                                
                                             , i.e., the vehicle must arrive in 
                                                
                                                   
                                                      
                                                         M
                                                      
                                                      
                                                         2
                                                      
                                                   
                                                
                                              within the most restrictive due date of a job in the batch.


                                             
                                                
                                                   i
                                                   -
                                                   
                                                      
                                                         j
                                                      
                                                      
                                                         1
                                                      
                                                   
                                                   +
                                                   1
                                                   ⩽
                                                   
                                                      
                                                         c
                                                      
                                                      
                                                         1
                                                      
                                                   
                                                
                                             , i.e., the batch size cannot exceed the vehicle capacity.

If 
                                       
                                          m
                                          =
                                          2
                                       
                                    , then
                                       
                                          –
                                          
                                             
                                                
                                                   
                                                      
                                                         C
                                                      
                                                      
                                                         i
                                                      
                                                   
                                                   +
                                                   
                                                      
                                                         ℓ
                                                      
                                                      
                                                         2
                                                      
                                                   
                                                   ⩽
                                                   
                                                      
                                                         C
                                                      
                                                      
                                                         
                                                            
                                                               j
                                                            
                                                            
                                                               2
                                                            
                                                         
                                                      
                                                   
                                                   +
                                                   T
                                                
                                             , i.e., the vehicle must arrive in 
                                                
                                                   
                                                      
                                                         M
                                                      
                                                      
                                                         2
                                                      
                                                   
                                                
                                              within the most restrictive due date of a job in the batch.


                                             
                                                
                                                   0
                                                   <
                                                   g
                                                   ⩽
                                                   
                                                      
                                                         c
                                                      
                                                      
                                                         2
                                                      
                                                   
                                                
                                             .

If 
                                                
                                                   i
                                                   =
                                                   
                                                      
                                                         j
                                                      
                                                      
                                                         2
                                                      
                                                   
                                                
                                             , then 
                                                
                                                   g
                                                   =
                                                   1
                                                
                                              since the current last job only consists of job i.

If a state does not satisfy all these conditions, we let 
                              
                                 f
                                 (
                                 i
                                 ,
                                 
                                    
                                       j
                                    
                                    
                                       1
                                    
                                 
                                 ,
                                 
                                    
                                       j
                                    
                                    
                                       2
                                    
                                 
                                 ,
                                 s
                                 ,
                                 v
                                 ,
                                 g
                                 ,
                                 m
                                 )
                                 =
                                 +
                                 ∞
                              
                           . We can now express the recursive relation as:
                              
                                 
                                    f
                                    (
                                    i
                                    ,
                                    
                                       
                                          j
                                       
                                       
                                          1
                                       
                                    
                                    ,
                                    
                                       
                                          j
                                       
                                       
                                          2
                                       
                                    
                                    ,
                                    s
                                    ,
                                    v
                                    ,
                                    g
                                    ,
                                    m
                                    )
                                    =
                                    
                                       min
                                    
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      f
                                                      (
                                                      i
                                                      -
                                                      1
                                                      ,
                                                      
                                                         
                                                            j
                                                         
                                                         
                                                            1
                                                         
                                                      
                                                      ,
                                                      
                                                         
                                                            j
                                                         
                                                         
                                                            2
                                                         
                                                      
                                                      ,
                                                      s
                                                      ,
                                                      v
                                                      ,
                                                      g
                                                      ,
                                                      m
                                                      )
                                                      ,
                                                   
                                                   
                                                      if
                                                      
                                                      i
                                                      >
                                                      
                                                         
                                                            j
                                                         
                                                         
                                                            1
                                                         
                                                      
                                                      ,
                                                      m
                                                      =
                                                      1
                                                   
                                                
                                                
                                                   
                                                      
                                                         
                                                            
                                                               min
                                                            
                                                            
                                                               
                                                                  
                                                                     
                                                                        
                                                                           
                                                                              j
                                                                           
                                                                           
                                                                              1
                                                                           
                                                                           
                                                                              ′
                                                                           
                                                                        
                                                                        ,
                                                                        
                                                                           
                                                                              m
                                                                           
                                                                           
                                                                              ′
                                                                           
                                                                        
                                                                        ,
                                                                        
                                                                           
                                                                              s
                                                                           
                                                                           
                                                                              ′
                                                                           
                                                                        
                                                                        ,
                                                                        
                                                                           
                                                                              v
                                                                           
                                                                           
                                                                              ′
                                                                           
                                                                        
                                                                     
                                                                  
                                                               
                                                               ∈
                                                               
                                                                  
                                                                     A
                                                                  
                                                                  
                                                                     1
                                                                  
                                                               
                                                            
                                                         
                                                      
                                                      f
                                                      
                                                         
                                                            
                                                               i
                                                               -
                                                               1
                                                               ,
                                                               
                                                                  
                                                                     j
                                                                  
                                                                  
                                                                     1
                                                                  
                                                                  
                                                                     ′
                                                                  
                                                               
                                                               ,
                                                               
                                                                  
                                                                     j
                                                                  
                                                                  
                                                                     2
                                                                  
                                                               
                                                               ,
                                                               
                                                                  
                                                                     s
                                                                  
                                                                  
                                                                     ′
                                                                  
                                                               
                                                               ,
                                                               
                                                                  
                                                                     v
                                                                  
                                                                  
                                                                     ′
                                                                  
                                                               
                                                               ,
                                                               g
                                                               ,
                                                               
                                                                  
                                                                     m
                                                                  
                                                                  
                                                                     ′
                                                                  
                                                               
                                                            
                                                         
                                                      
                                                      +
                                                      
                                                         
                                                            h
                                                         
                                                         
                                                            1
                                                         
                                                      
                                                      ,
                                                   
                                                   
                                                      if
                                                      
                                                      i
                                                      =
                                                      
                                                         
                                                            j
                                                         
                                                         
                                                            1
                                                         
                                                      
                                                      ,
                                                      m
                                                      =
                                                      1
                                                   
                                                
                                                
                                                   
                                                      
                                                         min
                                                      
                                                      {
                                                      f
                                                      (
                                                      i
                                                      -
                                                      1
                                                      ,
                                                      
                                                         
                                                            j
                                                         
                                                         
                                                            1
                                                         
                                                      
                                                      ,
                                                      
                                                         
                                                            j
                                                         
                                                         
                                                            2
                                                         
                                                      
                                                      ,
                                                      s
                                                      ,
                                                      v
                                                      ,
                                                      g
                                                      -
                                                      1
                                                      ,
                                                      1
                                                      )
                                                      ,
                                                      f
                                                      (
                                                      i
                                                      -
                                                      1
                                                      ,
                                                      
                                                         
                                                            j
                                                         
                                                         
                                                            1
                                                         
                                                      
                                                      ,
                                                      
                                                         
                                                            j
                                                         
                                                         
                                                            2
                                                         
                                                      
                                                      ,
                                                      s
                                                      ,
                                                      v
                                                      ,
                                                      g
                                                      -
                                                      1
                                                      ,
                                                      2
                                                      )
                                                      }
                                                      ,
                                                   
                                                   
                                                      if
                                                      
                                                      i
                                                      >
                                                      
                                                         
                                                            j
                                                         
                                                         
                                                            2
                                                         
                                                      
                                                      ,
                                                      m
                                                      =
                                                      2
                                                   
                                                
                                                
                                                   
                                                      
                                                         
                                                            
                                                               min
                                                            
                                                            
                                                               (
                                                               
                                                                  
                                                                     j
                                                                  
                                                                  
                                                                     2
                                                                  
                                                                  
                                                                     ′
                                                                  
                                                               
                                                               ,
                                                               
                                                                  
                                                                     g
                                                                  
                                                                  
                                                                     ′
                                                                  
                                                               
                                                               ,
                                                               
                                                                  
                                                                     m
                                                                  
                                                                  
                                                                     ′
                                                                  
                                                               
                                                               )
                                                               ∈
                                                               
                                                                  
                                                                     A
                                                                  
                                                                  
                                                                     2
                                                                  
                                                               
                                                            
                                                         
                                                      
                                                      f
                                                      (
                                                      i
                                                      -
                                                      1
                                                      ,
                                                      
                                                         
                                                            j
                                                         
                                                         
                                                            1
                                                         
                                                      
                                                      ,
                                                      
                                                         
                                                            j
                                                         
                                                         
                                                            2
                                                         
                                                         
                                                            ′
                                                         
                                                      
                                                      ,
                                                      s
                                                      ,
                                                      v
                                                      ,
                                                      
                                                         
                                                            g
                                                         
                                                         
                                                            ′
                                                         
                                                      
                                                      ,
                                                      
                                                         
                                                            m
                                                         
                                                         
                                                            ′
                                                         
                                                      
                                                      )
                                                      +
                                                      
                                                         
                                                            h
                                                         
                                                         
                                                            2
                                                         
                                                      
                                                      ,
                                                   
                                                   
                                                      if
                                                      
                                                      i
                                                      =
                                                      
                                                         
                                                            j
                                                         
                                                         
                                                            2
                                                         
                                                      
                                                      ,
                                                      m
                                                      =
                                                      2
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           where


                           
                              
                                 
                                    
                                       A
                                    
                                    
                                       1
                                    
                                 
                                 =
                                 {
                                 
                                    
                                       
                                          
                                             
                                                j
                                             
                                             
                                                1
                                             
                                             
                                                ′
                                             
                                          
                                          ,
                                          
                                             
                                                m
                                             
                                             
                                                ′
                                             
                                          
                                          ,
                                          
                                             
                                                s
                                             
                                             
                                                ′
                                             
                                          
                                          ,
                                          
                                             
                                                v
                                             
                                             
                                                ′
                                             
                                          
                                       
                                    
                                 
                                 |
                                 1
                                 ⩽
                                 
                                    
                                       j
                                    
                                    
                                       1
                                    
                                    
                                       ′
                                    
                                 
                                 ⩽
                                 i
                                 -
                                 1
                                 ,
                                 
                                    
                                       m
                                    
                                    
                                       ′
                                    
                                 
                                 =
                                 1
                                 ,
                                 2
                              
                           , if 
                              
                                 v
                                 >
                                 1
                              
                           , then 
                              
                                 
                                    
                                       s
                                    
                                    
                                       ′
                                    
                                 
                                 =
                                 s
                              
                            and 
                              
                                 
                                    
                                       v
                                    
                                    
                                       ′
                                    
                                 
                                 =
                                 v
                                 -
                                 1
                              
                           , otherwise 
                              
                                 0
                                 ⩽
                                 
                                    
                                       s
                                    
                                    
                                       ′
                                    
                                 
                                 <
                                 s
                              
                            and 
                              
                                 0
                                 ⩽
                                 
                                    
                                       v
                                    
                                    
                                       ′
                                    
                                 
                                 ⩽
                                 
                                    
                                       v
                                    
                                    
                                       
                                          
                                             s
                                          
                                          
                                             ′
                                          
                                       
                                    
                                 
                                 }
                              
                           ,


                           
                              
                                 
                                    
                                       A
                                    
                                    
                                       2
                                    
                                 
                                 =
                                 {
                                 (
                                 
                                    
                                       j
                                    
                                    
                                       2
                                    
                                    
                                       ′
                                    
                                 
                                 ,
                                 
                                    
                                       g
                                    
                                    
                                       ′
                                    
                                 
                                 ,
                                 
                                    
                                       m
                                    
                                    
                                       ′
                                    
                                 
                                 )
                                 |
                                 1
                                 ⩽
                                 
                                    
                                       j
                                    
                                    
                                       2
                                    
                                    
                                       ′
                                    
                                 
                                 ⩽
                                 i
                                 -
                                 1
                                 ,
                                 0
                                 ⩽
                                 
                                    
                                       g
                                    
                                    
                                       ′
                                    
                                 
                                 ⩽
                                 
                                    
                                       c
                                    
                                    
                                       2
                                    
                                 
                                 ,
                                 
                                    
                                       m
                                    
                                    
                                       ′
                                    
                                 
                                 =
                                 1
                                 ,
                                 2
                                 }
                              
                           .

The four terms in the recurrence relation have the following meaning.
                              
                                 •
                                 The first term corresponds to the case in which job i is added to the current last batch, and such batch is regular. According to Property 4(a) of Lemma 1, such batch is not split by other batches, so it contains jobs 
                                       
                                          
                                             
                                                j
                                             
                                             
                                                1
                                             
                                          
                                          ,
                                          …
                                          ,
                                          i
                                       
                                    .

In the second term, job i is the first job of a new regular batch. In this case, we must consider all possible states of the first 
                                       
                                          i
                                          -
                                          1
                                       
                                     jobs, in which the last express batch is the same as state 
                                       
                                          (
                                          i
                                          ,
                                          
                                             
                                                j
                                             
                                             
                                                1
                                             
                                          
                                          ,
                                          
                                             
                                                j
                                             
                                             
                                                2
                                             
                                          
                                          ,
                                          s
                                          ,
                                          v
                                          ,
                                          g
                                          ,
                                          m
                                          )
                                       
                                    . All these states are described by set 
                                       
                                          
                                             
                                                A
                                             
                                             
                                                1
                                             
                                          
                                       
                                    . Note that if 
                                       
                                          v
                                          =
                                          1
                                       
                                    , the new regular batch is indeed the first being shipped at time 
                                       
                                          
                                             
                                                t
                                             
                                             
                                                s
                                             
                                          
                                       
                                    , whereas if 
                                       
                                          v
                                          >
                                          1
                                       
                                     other vehicles have been already planned to depart at 
                                       
                                          
                                             
                                                t
                                             
                                             
                                                s
                                             
                                          
                                       
                                    , so we must only consider states of type 
                                       
                                          (
                                          i
                                          -
                                          1
                                          ,
                                          
                                             
                                                j
                                             
                                             
                                                1
                                             
                                             
                                                ′
                                             
                                          
                                          ,
                                          
                                             
                                                j
                                             
                                             
                                                2
                                             
                                          
                                          ,
                                          s
                                          ,
                                          v
                                          -
                                          1
                                          ,
                                          g
                                          ,
                                          
                                             
                                                m
                                             
                                             
                                                ′
                                             
                                          
                                          )
                                       
                                    
                                 

The third term considers the case in which job i is added to the current last batch, and such batch is express. Note that job i and 
                                       
                                          
                                             
                                                j
                                             
                                             
                                                2
                                             
                                          
                                       
                                     are both in such batch, while job 
                                       
                                          i
                                          -
                                          1
                                       
                                     can either be in a regular batch (so that we consider 
                                       
                                          f
                                          (
                                          i
                                          -
                                          1
                                          ,
                                          
                                             
                                                j
                                             
                                             
                                                1
                                             
                                          
                                          ,
                                          
                                             
                                                j
                                             
                                             
                                                2
                                             
                                          
                                          ,
                                          s
                                          ,
                                          v
                                          ,
                                          g
                                          -
                                          1
                                          ,
                                          1
                                          )
                                       
                                    ) or in the same express batch as job i (and hence we consider 
                                       
                                          f
                                          (
                                          i
                                          -
                                          1
                                          ,
                                          
                                             
                                                j
                                             
                                             
                                                1
                                             
                                          
                                          ,
                                          
                                             
                                                j
                                             
                                             
                                                2
                                             
                                          
                                          ,
                                          s
                                          ,
                                          v
                                          ,
                                          g
                                          -
                                          1
                                          ,
                                          2
                                          )
                                       
                                    ). In the former case, the regular batch splits the current last batch.

The fourth term is similar to the second. In this term, job i is the first job of a new express batch. This term considers all possible states of the first 
                                       
                                          i
                                          -
                                          1
                                       
                                     jobs, in which the last regular batch is the same as state 
                                       
                                          (
                                          i
                                          ,
                                          
                                             
                                                j
                                             
                                             
                                                1
                                             
                                          
                                          ,
                                          
                                             
                                                j
                                             
                                             
                                                2
                                             
                                          
                                          ,
                                          s
                                          ,
                                          v
                                          ,
                                          g
                                          ,
                                          m
                                          )
                                       
                                    . These states are described by set 
                                       
                                          
                                             
                                                A
                                             
                                             
                                                2
                                             
                                          
                                       
                                    .


                                 Algorithm EE1 finds an optimal delivery schedule for problem 
                                 
                                    
                                       1
                                       |
                                       fseq
                                       ,
                                       
                                       
                                          
                                             
                                                
                                                   d
                                                
                                                
                                                   ̃
                                                
                                             
                                          
                                          
                                             j
                                          
                                       
                                       =
                                       
                                          
                                             C
                                          
                                          
                                             j
                                          
                                       
                                       +
                                       T
                                       |
                                       
                                          
                                             V
                                          
                                          
                                             1
                                          
                                       
                                       (
                                       
                                          
                                             V
                                          
                                          
                                             1
                                          
                                       
                                       ,
                                       
                                          
                                             c
                                          
                                          
                                             1
                                          
                                       
                                       )
                                       ,
                                       
                                       
                                          
                                             V
                                          
                                          
                                             2
                                          
                                       
                                       (
                                       ∞
                                       ,
                                       
                                          
                                             c
                                          
                                          
                                             2
                                          
                                       
                                       )
                                       ,
                                       
                                       
                                          
                                             ℓ
                                          
                                          
                                             1
                                          
                                       
                                       >
                                       
                                          
                                             ℓ
                                          
                                          
                                             2
                                          
                                       
                                       |
                                       1
                                       |
                                       TC
                                    
                                  
                                 in 
                                 
                                    
                                       O
                                       (
                                       
                                          
                                             n
                                          
                                          
                                             3
                                          
                                       
                                       (
                                       
                                          
                                             (
                                             L
                                             +
                                             
                                                
                                                   V
                                                
                                                
                                                   1
                                                
                                             
                                             )
                                          
                                          
                                             2
                                          
                                       
                                       
                                          
                                             c
                                          
                                          
                                             2
                                          
                                       
                                       +
                                       (
                                       L
                                       +
                                       
                                          
                                             V
                                          
                                          
                                             1
                                          
                                       
                                       )
                                       
                                          
                                             c
                                          
                                          
                                             2
                                          
                                          
                                             2
                                          
                                       
                                       )
                                       )
                                    
                                  
                                 time.
                              

There exists 
                                    
                                       O
                                       (
                                       
                                          
                                             n
                                          
                                          
                                             3
                                          
                                       
                                       (
                                       L
                                       +
                                       
                                          
                                             V
                                          
                                          
                                             1
                                          
                                       
                                       )
                                       
                                          
                                             c
                                          
                                          
                                             2
                                          
                                       
                                       )
                                    
                                  states. In fact, for each 
                                    
                                       s
                                       ∈
                                       {
                                       0
                                       ,
                                       …
                                       ,
                                       L
                                       }
                                       ,
                                       v
                                    
                                  can assume 
                                    
                                       
                                          
                                             v
                                          
                                          
                                             s
                                          
                                       
                                       +
                                       1
                                    
                                  distinct values. Since 
                                    
                                       
                                          
                                             ∑
                                          
                                          
                                             s
                                          
                                       
                                       
                                          
                                             v
                                          
                                          
                                             s
                                          
                                       
                                       =
                                       
                                          
                                             V
                                          
                                          
                                             1
                                          
                                       
                                    
                                 , one has 
                                    
                                       O
                                       (
                                       L
                                       +
                                       
                                          
                                             V
                                          
                                          
                                             1
                                          
                                       
                                       )
                                    
                                  possible pairs 
                                    
                                       (
                                       s
                                       ,
                                       v
                                       )
                                    
                                 . In the recurrence relation, the first and third term require 
                                    
                                       O
                                       (
                                       1
                                       )
                                    
                                  time and are applied respectively for 
                                    
                                       O
                                       (
                                       
                                          
                                             n
                                          
                                          
                                             3
                                          
                                       
                                       (
                                       L
                                       +
                                       
                                          
                                             V
                                          
                                          
                                             1
                                          
                                       
                                       )
                                       
                                          
                                             c
                                          
                                          
                                             2
                                          
                                       
                                       )
                                    
                                  states. The second term requires 
                                    
                                       O
                                       (
                                       n
                                       (
                                       L
                                       +
                                       
                                          
                                             V
                                          
                                          
                                             1
                                          
                                       
                                       )
                                       )
                                    
                                  time and is applied for 
                                    
                                       O
                                       (
                                       
                                          
                                             n
                                          
                                          
                                             2
                                          
                                       
                                       (
                                       L
                                       +
                                       
                                          
                                             V
                                          
                                          
                                             1
                                          
                                       
                                       )
                                       
                                          
                                             c
                                          
                                          
                                             2
                                          
                                       
                                       )
                                    
                                  states. The fourth term requires 
                                    
                                       O
                                       (
                                       
                                          
                                             nc
                                          
                                          
                                             2
                                          
                                       
                                       )
                                    
                                  time and is applied for 
                                    
                                       O
                                       (
                                       
                                          
                                             n
                                          
                                          
                                             2
                                          
                                       
                                       (
                                       L
                                       +
                                       
                                          
                                             V
                                          
                                          
                                             1
                                          
                                       
                                       )
                                       
                                          
                                             c
                                          
                                          
                                             2
                                          
                                       
                                       )
                                    
                                  states. Therefore, the complexity of algorithm EE1 is 
                                    
                                       O
                                       
                                          
                                             
                                                
                                                   
                                                      n
                                                   
                                                   
                                                      3
                                                   
                                                
                                                
                                                   
                                                      
                                                         
                                                            
                                                               (
                                                               L
                                                               +
                                                               
                                                                  
                                                                     V
                                                                  
                                                                  
                                                                     1
                                                                  
                                                               
                                                               )
                                                            
                                                            
                                                               2
                                                            
                                                         
                                                         
                                                            
                                                               c
                                                            
                                                            
                                                               2
                                                            
                                                         
                                                         +
                                                         (
                                                         L
                                                         +
                                                         
                                                            
                                                               V
                                                            
                                                            
                                                               1
                                                            
                                                         
                                                         )
                                                         
                                                            
                                                               c
                                                            
                                                            
                                                               2
                                                            
                                                            
                                                               2
                                                            
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                 .□

Note that since 
                              
                                 
                                    
                                       V
                                    
                                    
                                       1
                                    
                                 
                                 ⩽
                                 Ln
                              
                            and 
                              
                                 
                                    
                                       c
                                    
                                    
                                       2
                                    
                                 
                                 ⩽
                                 n
                              
                           , this problem is solvable in polynomial time. For the other problems with both transportation modes and an unlimited number of vehicles for express transportation, we can give similar dynamic programming algorithms. The complexity results are shown in the first two rows of Table 1.

Let us consider the problem 
                              
                                 1
                                 |
                                 fseq
                                 ,
                                 
                                 
                                    
                                       
                                          
                                             d
                                          
                                          
                                             ̃
                                          
                                       
                                    
                                    
                                       j
                                    
                                 
                                 =
                                 
                                    
                                       C
                                    
                                    
                                       j
                                    
                                 
                                 +
                                 T
                                 |
                                 
                                    
                                       V
                                    
                                    
                                       1
                                    
                                 
                                 (
                                 
                                    
                                       V
                                    
                                    
                                       1
                                    
                                 
                                 ,
                                 
                                    
                                       c
                                    
                                    
                                       1
                                    
                                 
                                 )
                                 ,
                                 
                                 
                                    
                                       V
                                    
                                    
                                       2
                                    
                                 
                                 (
                                 
                                    
                                       V
                                    
                                    
                                       2
                                    
                                 
                                 ,
                                 
                                    
                                       c
                                    
                                    
                                       2
                                    
                                 
                                 )
                                 ,
                                 
                                 
                                    
                                       ℓ
                                    
                                    
                                       1
                                    
                                 
                                 ⩾
                                 
                                    
                                       ℓ
                                    
                                    
                                       2
                                    
                                 
                                 |
                                 1
                                 |
                                 TC
                              
                           , where both the number of vehicles for regular transportation and that of vehicles for express transportation are limited and 
                              
                                 
                                    
                                       ℓ
                                    
                                    
                                       1
                                    
                                 
                                 ⩾
                                 
                                    
                                       ℓ
                                    
                                    
                                       2
                                    
                                 
                              
                           . According to Property 4(a) of Lemma 1, the jobs of each regular batch are processed consecutively on machine 
                              
                                 
                                    
                                       M
                                    
                                    
                                       1
                                    
                                 
                              
                           . From Property 2 of Lemma 1, each express batch can be only split by regular batches. Since, according to Property 6 of Lemma 1, each express batch departs either at the completion time of the last job in this batch or when a vehicle for express transportation becomes available, the possible departure times for vehicles for express transportation are 
                              
                                 
                                    
                                       C
                                    
                                    
                                       j
                                    
                                 
                                 ,
                                 
                                    
                                       C
                                    
                                    
                                       j
                                    
                                 
                                 +
                                 
                                    
                                       
                                          
                                             
                                                ℓ
                                             
                                             
                                                2
                                             
                                          
                                          +
                                          
                                             
                                                ℓ
                                             
                                             
                                                2
                                             
                                             
                                                ′
                                             
                                          
                                       
                                    
                                 
                                 ,
                                 …
                                 ,
                                 
                                    
                                       C
                                    
                                    
                                       j
                                    
                                 
                                 +
                                 u
                                 
                                    
                                       
                                          
                                             
                                                ℓ
                                             
                                             
                                                2
                                             
                                          
                                          +
                                          
                                             
                                                ℓ
                                             
                                             
                                                2
                                             
                                             
                                                ′
                                             
                                          
                                       
                                    
                                 
                              
                           , for some 
                              
                                 u
                                 =
                                 0
                                 ,
                                 …
                                 ,
                                 n
                                 -
                                 j
                              
                            and 
                              
                                 j
                                 =
                                 1
                                 ,
                                 …
                                 ,
                                 n
                              
                           . Assuming that there are 
                              
                                 
                                    
                                       L
                                    
                                    
                                       ′
                                    
                                 
                                 +
                                 1
                              
                            distinct candidate departure times, we denote them as 
                              
                                 
                                    
                                       t
                                    
                                    
                                       0
                                    
                                 
                                 =
                                 0
                                 ,
                                 
                                    
                                       t
                                    
                                    
                                       1
                                    
                                 
                                 ,
                                 
                                    
                                       t
                                    
                                    
                                       2
                                    
                                 
                                 ,
                                 …
                                 ,
                                 
                                    
                                       t
                                    
                                    
                                       
                                          
                                             L
                                          
                                          
                                             ′
                                          
                                       
                                    
                                 
                              
                           . Note that 
                              
                                 
                                    
                                       L
                                    
                                    
                                       ′
                                    
                                 
                                 ⩽
                                 n
                                 (
                                 n
                                 +
                                 1
                                 )
                                 /
                                 2
                              
                           , hence 
                              
                                 O
                                 (
                                 
                                    
                                       n
                                    
                                    
                                       2
                                    
                                 
                                 )
                              
                            (Lee & Chen, 2001). We assume that 
                              
                                 
                                    
                                       V
                                    
                                    
                                       2
                                    
                                 
                              
                            is fixed. The problem can be solved by a dynamic program which is similar to EE1.


                           Algorithm EE2.


                           State and value function
                        

The dynamic program considers state 
                              
                                 f
                                 (
                                 i
                                 ,
                                 
                                    
                                       j
                                    
                                    
                                       1
                                    
                                 
                                 ,
                                 
                                    
                                       j
                                    
                                    
                                       2
                                    
                                 
                                 ,
                                 s
                                 ,
                                 v
                                 ,
                                 g
                                 ,
                                 m
                                 ,
                                 
                                    
                                       s
                                    
                                    
                                       1
                                    
                                 
                                 ,
                                 …
                                 ,
                                 
                                    
                                       s
                                    
                                    
                                       
                                          
                                             V
                                          
                                          
                                             2
                                          
                                       
                                    
                                 
                                 )
                              
                           , where parameters 
                              
                                 i
                                 ,
                                 
                                    
                                       j
                                    
                                    
                                       1
                                    
                                 
                                 ,
                                 
                                    
                                       j
                                    
                                    
                                       2
                                    
                                 
                                 ,
                                 s
                                 ,
                                 v
                                 ,
                                 g
                              
                            and m are defined exactly as algorithm EE1 (see Section 4.1.1), and the last 
                              
                                 
                                    
                                       V
                                    
                                    
                                       2
                                    
                                 
                              
                            express batches depart at times 
                              
                                 
                                    
                                       t
                                    
                                    
                                       
                                          
                                             s
                                          
                                          
                                             1
                                          
                                       
                                    
                                 
                                 ,
                                 …
                                 ,
                                 
                                    
                                       t
                                    
                                    
                                       
                                          
                                             s
                                          
                                          
                                             
                                                
                                                   V
                                                
                                                
                                                   2
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           , where 
                              
                                 
                                    
                                       s
                                    
                                    
                                       k
                                    
                                 
                                 ∈
                                 {
                                 0
                                 ,
                                 1
                                 ,
                                 …
                                 ,
                                 
                                    
                                       L
                                    
                                    
                                       ′
                                    
                                 
                                 }
                              
                            for 
                              
                                 k
                                 =
                                 1
                                 ,
                                 …
                                 ,
                                 
                                    
                                       V
                                    
                                    
                                       2
                                    
                                 
                              
                            and 
                              
                                 0
                                 ⩽
                                 
                                    
                                       s
                                    
                                    
                                       1
                                    
                                 
                                 ⩽
                                 …
                                 ⩽
                                 
                                    
                                       s
                                    
                                    
                                       
                                          
                                             V
                                          
                                          
                                             2
                                          
                                       
                                    
                                 
                              
                           . We let 
                              
                                 f
                                 (
                                 i
                                 ,
                                 
                                    
                                       j
                                    
                                    
                                       1
                                    
                                 
                                 ,
                                 
                                    
                                       j
                                    
                                    
                                       2
                                    
                                 
                                 ,
                                 s
                                 ,
                                 v
                                 ,
                                 g
                                 ,
                                 m
                                 ,
                                 
                                    
                                       s
                                    
                                    
                                       1
                                    
                                 
                                 ,
                                 …
                                 ,
                                 
                                    
                                       s
                                    
                                    
                                       
                                          
                                             V
                                          
                                          
                                             2
                                          
                                       
                                    
                                 
                                 )
                              
                            denote the minimum transportation cost of all schedules in state 
                              
                                 (
                                 i
                                 ,
                                 
                                    
                                       j
                                    
                                    
                                       1
                                    
                                 
                                 ,
                                 
                                    
                                       j
                                    
                                    
                                       2
                                    
                                 
                                 ,
                                 s
                                 ,
                                 v
                                 ,
                                 g
                                 ,
                                 m
                                 ,
                                 
                                    
                                       s
                                    
                                    
                                       1
                                    
                                 
                                 ,
                                 …
                                 ,
                                 
                                    
                                       s
                                    
                                    
                                       
                                          
                                             V
                                          
                                          
                                             2
                                          
                                       
                                    
                                 
                                 )
                              
                           .


                           Boundary condition
                        


                           
                              
                                 f
                                 (
                                 0
                                 ,
                                 0
                                 ,
                                 0
                                 ,
                                 0
                                 ,
                                 0
                                 ,
                                 0
                                 ,
                                 1
                                 ,
                                 0
                                 ,
                                 …
                                 ,
                                 0
                                 )
                                 =
                                 0
                                 ,
                                 
                                 f
                                 (
                                 0
                                 ,
                                 0
                                 ,
                                 0
                                 ,
                                 0
                                 ,
                                 0
                                 ,
                                 0
                                 ,
                                 2
                                 ,
                                 0
                                 ,
                                 …
                                 ,
                                 0
                                 )
                                 =
                                 0
                              
                           .


                           Optimal solution value
                        


                           
                              
                                 
                                    
                                       min
                                    
                                    
                                       (
                                       
                                          
                                             j
                                          
                                          
                                             1
                                          
                                       
                                       ,
                                       
                                          
                                             j
                                          
                                          
                                             2
                                          
                                       
                                       ,
                                       s
                                       ,
                                       v
                                       ,
                                       g
                                       ,
                                       m
                                       ,
                                       
                                          
                                             s
                                          
                                          
                                             1
                                          
                                       
                                       ,
                                       …
                                       ,
                                       
                                          
                                             s
                                          
                                          
                                             
                                                
                                                   V
                                                
                                                
                                                   2
                                                
                                             
                                          
                                       
                                       )
                                       ∈
                                       A
                                    
                                 
                                 f
                                 (
                                 n
                                 ,
                                 
                                    
                                       j
                                    
                                    
                                       1
                                    
                                 
                                 ,
                                 
                                    
                                       j
                                    
                                    
                                       2
                                    
                                 
                                 ,
                                 s
                                 ,
                                 v
                                 ,
                                 g
                                 ,
                                 m
                                 ,
                                 
                                    
                                       s
                                    
                                    
                                       1
                                    
                                 
                                 ,
                                 …
                                 ,
                                 
                                    
                                       s
                                    
                                    
                                       
                                          
                                             V
                                          
                                          
                                             2
                                          
                                       
                                    
                                 
                                 )
                              
                           ,

where 
                              
                                 A
                                 =
                                 {
                                 (
                                 
                                    
                                       j
                                    
                                    
                                       1
                                    
                                 
                                 ,
                                 
                                    
                                       j
                                    
                                    
                                       2
                                    
                                 
                                 ,
                                 s
                                 ,
                                 v
                                 ,
                                 g
                                 ,
                                 m
                                 ,
                                 
                                    
                                       s
                                    
                                    
                                       1
                                    
                                 
                                 ,
                                 …
                                 ,
                                 
                                    
                                       s
                                    
                                    
                                       
                                          
                                             V
                                          
                                          
                                             2
                                          
                                       
                                    
                                 
                                 )
                                 |
                                 1
                                 ⩽
                                 
                                    
                                       j
                                    
                                    
                                       1
                                    
                                 
                                 ⩽
                                 n
                                 ,
                                 1
                                 ⩽
                                 
                                    
                                       j
                                    
                                    
                                       2
                                    
                                 
                                 ⩽
                                 n
                                 ,
                                 0
                                 ⩽
                                 s
                                 ⩽
                                 L
                                 ,
                                 0
                                 ⩽
                                 v
                                 ⩽
                                 
                                    
                                       v
                                    
                                    
                                       s
                                    
                                 
                                 ,
                                 0
                                 ⩽
                                 g
                                 ⩽
                                 
                                    
                                       c
                                    
                                    
                                       2
                                    
                                 
                                 ,
                                 m
                                 =
                                 1
                                 ,
                                 2
                                 ,
                                 0
                                 ⩽
                                 
                                    
                                       s
                                    
                                    
                                       k
                                    
                                 
                                 ⩽
                                 
                                    
                                       L
                                    
                                    
                                       ′
                                    
                                 
                                 ,
                                 k
                                 =
                                 1
                                 ,
                                 …
                                 ,
                                 
                                    
                                       V
                                    
                                    
                                       2
                                    
                                 
                                 }
                              
                           .


                           Recurrence relation
                        

Considering the recurrence relation for 
                              
                                 f
                                 (
                                 i
                                 ,
                                 
                                    
                                       j
                                    
                                    
                                       1
                                    
                                 
                                 ,
                                 
                                    
                                       j
                                    
                                    
                                       2
                                    
                                 
                                 ,
                                 s
                                 ,
                                 v
                                 ,
                                 g
                                 ,
                                 m
                                 ,
                                 
                                    
                                       s
                                    
                                    
                                       1
                                    
                                 
                                 ,
                                 …
                                 ,
                                 
                                    
                                       s
                                    
                                    
                                       
                                          
                                             V
                                          
                                          
                                             2
                                          
                                       
                                    
                                 
                                 )
                              
                           , we have that this is defined only for values of the indices such that:
                              
                                 •
                                 
                                    
                                       
                                          i
                                          ∈
                                          {
                                          1
                                          ,
                                          …
                                          ,
                                          n
                                          }
                                          ,
                                          
                                             
                                                j
                                             
                                             
                                                1
                                             
                                          
                                          ∈
                                          {
                                          1
                                          ,
                                          …
                                          ,
                                          i
                                          }
                                          ,
                                          
                                             
                                                j
                                             
                                             
                                                2
                                             
                                          
                                          ∈
                                          {
                                          1
                                          ,
                                          …
                                          ,
                                          i
                                          }
                                          ,
                                          s
                                          ∈
                                          {
                                          0
                                          ,
                                          …
                                          ,
                                          L
                                          }
                                          ,
                                          v
                                          ∈
                                          {
                                          0
                                          ,
                                          …
                                          ,
                                          
                                             
                                                v
                                             
                                             
                                                s
                                             
                                          
                                          }
                                       
                                    , 
                                       
                                          g
                                          ∈
                                          {
                                          0
                                          ,
                                          …
                                          ,
                                          
                                             
                                                c
                                             
                                             
                                                2
                                             
                                          
                                          }
                                          ,
                                          m
                                          ∈
                                          {
                                          1
                                          ,
                                          2
                                          }
                                       
                                    .


                                    
                                       
                                          
                                             
                                                s
                                             
                                             
                                                k
                                             
                                          
                                          ∈
                                          {
                                          0
                                          ,
                                          …
                                          ,
                                          
                                             
                                                L
                                             
                                             
                                                ′
                                             
                                          
                                          }
                                          ,
                                          k
                                          =
                                          1
                                          ,
                                          …
                                          ,
                                          
                                             
                                                V
                                             
                                             
                                                2
                                             
                                          
                                       
                                    , 
                                       
                                          
                                             
                                                s
                                             
                                             
                                                u
                                             
                                          
                                          ⩽
                                          
                                             
                                                s
                                             
                                             
                                                u
                                                +
                                                1
                                             
                                          
                                          ,
                                          u
                                          =
                                          1
                                          ,
                                          …
                                          ,
                                          
                                             
                                                V
                                             
                                             
                                                2
                                             
                                          
                                          -
                                          1
                                       
                                    .

If 
                                       
                                          m
                                          =
                                          1
                                       
                                    , then 
                                       
                                          s
                                          >
                                          0
                                          ,
                                          v
                                          >
                                          0
                                       
                                     and:
                                       
                                          –
                                          
                                             
                                                
                                                   
                                                      
                                                         C
                                                      
                                                      
                                                         i
                                                      
                                                   
                                                   ⩽
                                                   
                                                      
                                                         t
                                                      
                                                      
                                                         s
                                                      
                                                   
                                                
                                             , i.e., job i must be completed before the (regular) batch departs.


                                             
                                                
                                                   
                                                      
                                                         t
                                                      
                                                      
                                                         s
                                                      
                                                   
                                                   +
                                                   
                                                      
                                                         ℓ
                                                      
                                                      
                                                         1
                                                      
                                                   
                                                   ⩽
                                                   
                                                      
                                                         C
                                                      
                                                      
                                                         
                                                            
                                                               j
                                                            
                                                            
                                                               1
                                                            
                                                         
                                                      
                                                   
                                                   +
                                                   T
                                                
                                             , i.e., the vehicle must arrive in 
                                                
                                                   
                                                      
                                                         M
                                                      
                                                      
                                                         2
                                                      
                                                   
                                                
                                              within the most restrictive due date of a job in the batch.


                                             
                                                
                                                   i
                                                   -
                                                   
                                                      
                                                         j
                                                      
                                                      
                                                         1
                                                      
                                                   
                                                   +
                                                   1
                                                   ⩽
                                                   
                                                      
                                                         c
                                                      
                                                      
                                                         1
                                                      
                                                   
                                                
                                             , i.e., the batch size cannot exceed the vehicle capacity.

If 
                                       
                                          m
                                          =
                                          2
                                       
                                    , then
                                       
                                          –
                                          
                                             
                                                
                                                   
                                                      
                                                         C
                                                      
                                                      
                                                         i
                                                      
                                                   
                                                   ⩽
                                                   
                                                      
                                                         t
                                                      
                                                      
                                                         
                                                            
                                                               s
                                                            
                                                            
                                                               
                                                                  
                                                                     V
                                                                  
                                                                  
                                                                     2
                                                                  
                                                               
                                                            
                                                         
                                                      
                                                   
                                                
                                             , i.e., job i must be completed before the (express) batch departs.


                                             
                                                
                                                   
                                                      
                                                         t
                                                      
                                                      
                                                         
                                                            
                                                               s
                                                            
                                                            
                                                               
                                                                  
                                                                     V
                                                                  
                                                                  
                                                                     2
                                                                  
                                                               
                                                            
                                                         
                                                      
                                                   
                                                   +
                                                   
                                                      
                                                         ℓ
                                                      
                                                      
                                                         2
                                                      
                                                   
                                                   ⩽
                                                   
                                                      
                                                         C
                                                      
                                                      
                                                         
                                                            
                                                               j
                                                            
                                                            
                                                               2
                                                            
                                                         
                                                      
                                                   
                                                   +
                                                   T
                                                
                                             , i.e., the vehicle (departing at 
                                                
                                                   
                                                      
                                                         t
                                                      
                                                      
                                                         
                                                            
                                                               s
                                                            
                                                            
                                                               
                                                                  
                                                                     V
                                                                  
                                                                  
                                                                     2
                                                                  
                                                               
                                                            
                                                         
                                                      
                                                   
                                                
                                             ) must arrive in 
                                                
                                                   
                                                      
                                                         M
                                                      
                                                      
                                                         2
                                                      
                                                   
                                                
                                              within the most restrictive due date of a job in the batch.


                                             
                                                
                                                   0
                                                   <
                                                   g
                                                   ⩽
                                                   
                                                      
                                                         c
                                                      
                                                      
                                                         2
                                                      
                                                   
                                                
                                             .

If 
                                                
                                                   i
                                                   =
                                                   
                                                      
                                                         j
                                                      
                                                      
                                                         2
                                                      
                                                   
                                                
                                             , then 
                                                
                                                   g
                                                   =
                                                   1
                                                
                                              since the current last job only consists of job i.

If a state does not satisfy all these conditions, we let 
                              
                                 f
                                 (
                                 i
                                 ,
                                 
                                    
                                       j
                                    
                                    
                                       1
                                    
                                 
                                 ,
                                 
                                    
                                       j
                                    
                                    
                                       2
                                    
                                 
                                 ,
                                 s
                                 ,
                                 v
                                 ,
                                 g
                                 ,
                                 m
                                 ,
                                 
                                    
                                       s
                                    
                                    
                                       1
                                    
                                 
                                 ,
                                 …
                                 ,
                                 
                                    
                                       s
                                    
                                    
                                       
                                          
                                             V
                                          
                                          
                                             2
                                          
                                       
                                    
                                 
                                 )
                                 =
                                 +
                                 ∞
                              
                           . We can now express the recursive relation as:
                              
                                 
                                    f
                                    (
                                    i
                                    ,
                                    
                                       
                                          j
                                       
                                       
                                          1
                                       
                                    
                                    ,
                                    
                                       
                                          j
                                       
                                       
                                          2
                                       
                                    
                                    ,
                                    s
                                    ,
                                    v
                                    ,
                                    g
                                    ,
                                    m
                                    ,
                                    
                                       
                                          s
                                       
                                       
                                          1
                                       
                                    
                                    ,
                                    …
                                    ,
                                    
                                       
                                          s
                                       
                                       
                                          
                                             
                                                V
                                             
                                             
                                                2
                                             
                                          
                                       
                                    
                                    )
                                    =
                                    
                                       min
                                    
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      f
                                                      (
                                                      i
                                                      -
                                                      1
                                                      ,
                                                      
                                                         
                                                            j
                                                         
                                                         
                                                            1
                                                         
                                                      
                                                      ,
                                                      
                                                         
                                                            j
                                                         
                                                         
                                                            2
                                                         
                                                      
                                                      ,
                                                      s
                                                      ,
                                                      v
                                                      ,
                                                      g
                                                      ,
                                                      m
                                                      ,
                                                      
                                                         
                                                            s
                                                         
                                                         
                                                            1
                                                         
                                                      
                                                      ,
                                                      …
                                                      ,
                                                      
                                                         
                                                            s
                                                         
                                                         
                                                            
                                                               
                                                                  V
                                                               
                                                               
                                                                  2
                                                               
                                                            
                                                         
                                                      
                                                      )
                                                      ,
                                                   
                                                   
                                                      if
                                                      
                                                      i
                                                      >
                                                      
                                                         
                                                            j
                                                         
                                                         
                                                            1
                                                         
                                                      
                                                      ,
                                                      m
                                                      =
                                                      1
                                                   
                                                
                                                
                                                   
                                                      
                                                         
                                                            
                                                               min
                                                            
                                                            
                                                               
                                                                  
                                                                     
                                                                        
                                                                           
                                                                              j
                                                                           
                                                                           
                                                                              1
                                                                           
                                                                           
                                                                              ′
                                                                           
                                                                        
                                                                        ,
                                                                        
                                                                           
                                                                              m
                                                                           
                                                                           
                                                                              ′
                                                                           
                                                                        
                                                                        ,
                                                                        
                                                                           
                                                                              s
                                                                           
                                                                           
                                                                              ′
                                                                           
                                                                        
                                                                        ,
                                                                        
                                                                           
                                                                              v
                                                                           
                                                                           
                                                                              ′
                                                                           
                                                                        
                                                                     
                                                                  
                                                               
                                                               ∈
                                                               
                                                                  
                                                                     A
                                                                  
                                                                  
                                                                     1
                                                                  
                                                               
                                                            
                                                         
                                                      
                                                      f
                                                      
                                                         
                                                            
                                                               i
                                                               -
                                                               1
                                                               ,
                                                               
                                                                  
                                                                     j
                                                                  
                                                                  
                                                                     1
                                                                  
                                                                  
                                                                     ′
                                                                  
                                                               
                                                               ,
                                                               
                                                                  
                                                                     j
                                                                  
                                                                  
                                                                     2
                                                                  
                                                               
                                                               ,
                                                               
                                                                  
                                                                     s
                                                                  
                                                                  
                                                                     ′
                                                                  
                                                               
                                                               ,
                                                               
                                                                  
                                                                     v
                                                                  
                                                                  
                                                                     ′
                                                                  
                                                               
                                                               ,
                                                               g
                                                               ,
                                                               
                                                                  
                                                                     m
                                                                  
                                                                  
                                                                     ′
                                                                  
                                                               
                                                               ,
                                                               
                                                                  
                                                                     s
                                                                  
                                                                  
                                                                     1
                                                                  
                                                               
                                                               ,
                                                               …
                                                               ,
                                                               
                                                                  
                                                                     s
                                                                  
                                                                  
                                                                     
                                                                        
                                                                           V
                                                                        
                                                                        
                                                                           2
                                                                        
                                                                     
                                                                  
                                                               
                                                            
                                                         
                                                      
                                                      +
                                                      
                                                         
                                                            h
                                                         
                                                         
                                                            1
                                                         
                                                      
                                                      ,
                                                   
                                                   
                                                      if
                                                      
                                                      i
                                                      =
                                                      
                                                         
                                                            j
                                                         
                                                         
                                                            1
                                                         
                                                      
                                                      ,
                                                      m
                                                      =
                                                      1
                                                   
                                                
                                                
                                                   
                                                      
                                                         min
                                                      
                                                      {
                                                      f
                                                      (
                                                      i
                                                      -
                                                      1
                                                      ,
                                                      
                                                         
                                                            j
                                                         
                                                         
                                                            1
                                                         
                                                      
                                                      ,
                                                      
                                                         
                                                            j
                                                         
                                                         
                                                            2
                                                         
                                                      
                                                      ,
                                                      s
                                                      ,
                                                      v
                                                      ,
                                                      g
                                                      -
                                                      1
                                                      ,
                                                      1
                                                      ,
                                                      
                                                         
                                                            s
                                                         
                                                         
                                                            1
                                                         
                                                      
                                                      ,
                                                      …
                                                      ,
                                                      
                                                         
                                                            s
                                                         
                                                         
                                                            
                                                               
                                                                  V
                                                               
                                                               
                                                                  2
                                                               
                                                            
                                                         
                                                      
                                                      )
                                                      ,
                                                   
                                                   
                                                
                                                
                                                   
                                                      f
                                                      (
                                                      i
                                                      -
                                                      1
                                                      ,
                                                      
                                                         
                                                            j
                                                         
                                                         
                                                            1
                                                         
                                                      
                                                      ,
                                                      
                                                         
                                                            j
                                                         
                                                         
                                                            2
                                                         
                                                      
                                                      ,
                                                      s
                                                      ,
                                                      v
                                                      ,
                                                      g
                                                      -
                                                      1
                                                      ,
                                                      2
                                                      ,
                                                      
                                                         
                                                            s
                                                         
                                                         
                                                            1
                                                         
                                                      
                                                      ,
                                                      …
                                                      ,
                                                      
                                                         
                                                            s
                                                         
                                                         
                                                            
                                                               
                                                                  V
                                                               
                                                               
                                                                  2
                                                               
                                                            
                                                         
                                                      
                                                      )
                                                      }
                                                   
                                                   
                                                      if
                                                      
                                                      i
                                                      >
                                                      
                                                         
                                                            j
                                                         
                                                         
                                                            2
                                                         
                                                      
                                                      ,
                                                      m
                                                      =
                                                      2
                                                   
                                                
                                                
                                                   
                                                      
                                                         
                                                            
                                                               min
                                                            
                                                            
                                                               (
                                                               
                                                                  
                                                                     j
                                                                  
                                                                  
                                                                     2
                                                                  
                                                                  
                                                                     ′
                                                                  
                                                               
                                                               ,
                                                               
                                                                  
                                                                     g
                                                                  
                                                                  
                                                                     ′
                                                                  
                                                               
                                                               ,
                                                               
                                                                  
                                                                     m
                                                                  
                                                                  
                                                                     ′
                                                                  
                                                               
                                                               ,
                                                               
                                                                  
                                                                     s
                                                                  
                                                                  
                                                                     1
                                                                  
                                                                  
                                                                     ′
                                                                  
                                                               
                                                               )
                                                               ∈
                                                               
                                                                  
                                                                     A
                                                                  
                                                                  
                                                                     2
                                                                  
                                                               
                                                            
                                                         
                                                      
                                                      f
                                                      (
                                                      i
                                                      -
                                                      1
                                                      ,
                                                      
                                                         
                                                            j
                                                         
                                                         
                                                            1
                                                         
                                                      
                                                      ,
                                                      
                                                         
                                                            j
                                                         
                                                         
                                                            2
                                                         
                                                         
                                                            ′
                                                         
                                                      
                                                      ,
                                                      s
                                                      ,
                                                      v
                                                      ,
                                                      
                                                         
                                                            g
                                                         
                                                         
                                                            ′
                                                         
                                                      
                                                      ,
                                                      
                                                         
                                                            m
                                                         
                                                         
                                                            ′
                                                         
                                                      
                                                      ,
                                                      
                                                         
                                                            s
                                                         
                                                         
                                                            1
                                                         
                                                         
                                                            ′
                                                         
                                                      
                                                      ,
                                                      
                                                         
                                                            s
                                                         
                                                         
                                                            1
                                                         
                                                      
                                                      ,
                                                      …
                                                      ,
                                                      
                                                         
                                                            s
                                                         
                                                         
                                                            
                                                               
                                                                  V
                                                               
                                                               
                                                                  2
                                                               
                                                            
                                                            -
                                                            1
                                                         
                                                      
                                                      )
                                                      +
                                                      
                                                         
                                                            h
                                                         
                                                         
                                                            2
                                                         
                                                      
                                                      ,
                                                   
                                                   
                                                      if
                                                      
                                                      i
                                                      =
                                                      
                                                         
                                                            j
                                                         
                                                         
                                                            2
                                                         
                                                      
                                                      ,
                                                      m
                                                      =
                                                      2
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           where


                           
                              
                                 
                                    
                                       A
                                    
                                    
                                       1
                                    
                                 
                                 =
                                 {
                                 
                                    
                                       
                                          
                                             
                                                j
                                             
                                             
                                                1
                                             
                                             
                                                ′
                                             
                                          
                                          ,
                                          
                                             
                                                m
                                             
                                             
                                                ′
                                             
                                          
                                          ,
                                          
                                             
                                                s
                                             
                                             
                                                ′
                                             
                                          
                                          ,
                                          
                                             
                                                v
                                             
                                             
                                                ′
                                             
                                          
                                       
                                    
                                 
                                 |
                                 1
                                 ⩽
                                 
                                    
                                       j
                                    
                                    
                                       1
                                    
                                    
                                       ′
                                    
                                 
                                 ⩽
                                 i
                                 -
                                 1
                                 ,
                                 
                                    
                                       m
                                    
                                    
                                       ′
                                    
                                 
                                 =
                                 1
                                 ,
                                 2
                              
                           , if 
                              
                                 v
                                 >
                                 1
                              
                           , then 
                              
                                 
                                    
                                       s
                                    
                                    
                                       ′
                                    
                                 
                                 =
                                 s
                              
                            and 
                              
                                 
                                    
                                       v
                                    
                                    
                                       ′
                                    
                                 
                                 =
                                 v
                                 -
                                 1
                              
                           , otherwise 
                              
                                 0
                                 ⩽
                                 
                                    
                                       s
                                    
                                    
                                       ′
                                    
                                 
                                 <
                                 s
                              
                            and 
                              
                                 0
                                 ⩽
                                 
                                    
                                       v
                                    
                                    
                                       ′
                                    
                                 
                                 ⩽
                                 
                                    
                                       v
                                    
                                    
                                       
                                          
                                             s
                                          
                                          
                                             ′
                                          
                                       
                                    
                                 
                                 }
                              
                           .


                           
                              
                                 
                                    
                                       A
                                    
                                    
                                       2
                                    
                                 
                                 =
                                 {
                                 
                                    
                                       
                                          
                                             
                                                j
                                             
                                             
                                                2
                                             
                                             
                                                ′
                                             
                                          
                                          ,
                                          
                                             
                                                g
                                             
                                             
                                                ′
                                             
                                          
                                          ,
                                          
                                             
                                                m
                                             
                                             
                                                ′
                                             
                                          
                                          ,
                                          
                                             
                                                s
                                             
                                             
                                                ′
                                             
                                          
                                       
                                    
                                 
                                 |
                                 1
                                 ⩽
                                 
                                    
                                       j
                                    
                                    
                                       2
                                    
                                    
                                       ′
                                    
                                 
                                 ⩽
                                 i
                                 -
                                 1
                                 ,
                                 0
                                 ⩽
                                 
                                    
                                       g
                                    
                                    
                                       ′
                                    
                                 
                                 ⩽
                                 
                                    
                                       c
                                    
                                    
                                       2
                                    
                                 
                                 ,
                                 
                                    
                                       m
                                    
                                    
                                       ′
                                    
                                 
                                 =
                                 1
                                 ,
                                 2
                                 ,
                                 0
                                 ⩽
                                 
                                    
                                       s
                                    
                                    
                                       1
                                    
                                    
                                       ′
                                    
                                 
                                 ⩽
                                 
                                    
                                       s
                                    
                                    
                                       1
                                    
                                 
                                 ,
                                 
                                    
                                       t
                                    
                                    
                                       
                                          
                                             s
                                          
                                          
                                             1
                                          
                                          
                                             ′
                                          
                                       
                                    
                                 
                                 +
                                 min
                                 {
                                 1
                                 ,
                                 
                                    
                                       s
                                    
                                    
                                       1
                                    
                                    
                                       ′
                                    
                                 
                                 }
                                 ∗
                                 
                                    
                                       
                                          
                                             
                                                ℓ
                                             
                                             
                                                2
                                             
                                          
                                          +
                                          
                                             
                                                ℓ
                                             
                                             
                                                2
                                             
                                             
                                                ′
                                             
                                          
                                       
                                    
                                 
                                 ⩽
                                 
                                    
                                       t
                                    
                                    
                                       
                                          
                                             s
                                          
                                          
                                             
                                                
                                                   V
                                                
                                                
                                                   2
                                                
                                             
                                          
                                       
                                    
                                 
                                 }
                              
                           .

The four terms in the recurrence relation have the following meaning.
                              
                                 •
                                 As in EE1, the first term corresponds to the case in which job i is added to the current last batch, and such batch is regular. Due to Property 4(a) of Lemma 1, such batch is not split by other batches, so it contains jobs 
                                       
                                          
                                             
                                                j
                                             
                                             
                                                1
                                             
                                          
                                          ,
                                          …
                                          ,
                                          i
                                       
                                    .

Also the second term is very similar to the corresponding term in EE1. Job i is the first job of a new regular batch. In this case, we must consider all possible states of the first 
                                       
                                          i
                                          -
                                          1
                                       
                                     jobs, in which the last express batch is the same as state 
                                       
                                          (
                                          i
                                          ,
                                          
                                             
                                                j
                                             
                                             
                                                1
                                             
                                          
                                          ,
                                          
                                             
                                                j
                                             
                                             
                                                2
                                             
                                          
                                          ,
                                          s
                                          ,
                                          v
                                          ,
                                          g
                                          ,
                                          m
                                          ,
                                          
                                             
                                                s
                                             
                                             
                                                1
                                             
                                          
                                          ,
                                          …
                                          ,
                                          
                                             
                                                s
                                             
                                             
                                                
                                                   
                                                      V
                                                   
                                                   
                                                      2
                                                   
                                                
                                             
                                          
                                          )
                                       
                                    . All these states are described by set 
                                       
                                          
                                             
                                                A
                                             
                                             
                                                1
                                             
                                          
                                       
                                    . If 
                                       
                                          v
                                          =
                                          1
                                       
                                    , the new regular batch is indeed the first being shipped at time 
                                       
                                          
                                             
                                                t
                                             
                                             
                                                s
                                             
                                          
                                       
                                    , whereas if 
                                       
                                          v
                                          >
                                          1
                                       
                                     other vehicles have been already planned to depart at 
                                       
                                          
                                             
                                                t
                                             
                                             
                                                s
                                             
                                          
                                       
                                    , so we must only consider states of type 
                                       
                                          
                                             
                                                
                                                   i
                                                   -
                                                   1
                                                   ,
                                                   
                                                      
                                                         j
                                                      
                                                      
                                                         1
                                                      
                                                      
                                                         ′
                                                      
                                                   
                                                   ,
                                                   
                                                      
                                                         j
                                                      
                                                      
                                                         2
                                                      
                                                   
                                                   ,
                                                   s
                                                   ,
                                                   v
                                                   -
                                                   1
                                                   ,
                                                   g
                                                   ,
                                                   
                                                      
                                                         m
                                                      
                                                      
                                                         ′
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    .

The third term considers the case in which job i is added to the current last batch, and such batch is express. Note that job i and 
                                       
                                          
                                             
                                                j
                                             
                                             
                                                2
                                             
                                          
                                       
                                     are both in such batch, while job 
                                       
                                          i
                                          -
                                          1
                                       
                                     can either be in a regular batch (so that we consider 
                                       
                                          f
                                          (
                                          i
                                          -
                                          1
                                          ,
                                          
                                             
                                                j
                                             
                                             
                                                1
                                             
                                          
                                          ,
                                          
                                             
                                                j
                                             
                                             
                                                2
                                             
                                          
                                          ,
                                          s
                                          ,
                                          v
                                          ,
                                          g
                                          -
                                          1
                                          ,
                                          1
                                          ,
                                          
                                             
                                                s
                                             
                                             
                                                1
                                             
                                          
                                          ,
                                          …
                                          ,
                                          
                                             
                                                s
                                             
                                             
                                                
                                                   
                                                      V
                                                   
                                                   
                                                      2
                                                   
                                                
                                             
                                          
                                          )
                                       
                                    ) or in the same express batch as job i (and hence we consider 
                                       
                                          f
                                          (
                                          i
                                          -
                                          1
                                          ,
                                          
                                             
                                                j
                                             
                                             
                                                1
                                             
                                          
                                          ,
                                          
                                             
                                                j
                                             
                                             
                                                2
                                             
                                          
                                          ,
                                          s
                                          ,
                                          v
                                          ,
                                          g
                                          -
                                          1
                                          ,
                                          2
                                          ,
                                          
                                             
                                                s
                                             
                                             
                                                1
                                             
                                          
                                          ,
                                          …
                                          ,
                                          
                                             
                                                s
                                             
                                             
                                                
                                                   
                                                      V
                                                   
                                                   
                                                      2
                                                   
                                                
                                             
                                          
                                          )
                                       
                                    ). In the former case, the regular batch splits the current last batch.

The fourth term is similar to the second. In this term, job i is the first job of a new express batch. This term considers all possible states of the first 
                                       
                                          i
                                          -
                                          1
                                       
                                     jobs, in which the last regular batch is the same as state 
                                       
                                          (
                                          i
                                          ,
                                          
                                             
                                                j
                                             
                                             
                                                1
                                             
                                          
                                          ,
                                          
                                             
                                                j
                                             
                                             
                                                2
                                             
                                          
                                          ,
                                          s
                                          ,
                                          v
                                          ,
                                          g
                                          ,
                                          m
                                          ,
                                          
                                             
                                                s
                                             
                                             
                                                1
                                             
                                          
                                          ,
                                          …
                                          ,
                                          
                                             
                                                s
                                             
                                             
                                                
                                                   
                                                      V
                                                   
                                                   
                                                      2
                                                   
                                                
                                             
                                          
                                          )
                                       
                                    . These states are described by set 
                                       
                                          
                                             
                                                A
                                             
                                             
                                                2
                                             
                                          
                                       
                                    .


                                 Algorithm EE2 finds an optimal delivery schedule for problem 
                                 
                                    
                                       1
                                       |
                                       fseq
                                       ,
                                       
                                          
                                             
                                                
                                                   d
                                                
                                                
                                                   ̃
                                                
                                             
                                          
                                          
                                             j
                                          
                                       
                                       =
                                       
                                          
                                             C
                                          
                                          
                                             j
                                          
                                       
                                       +
                                       T
                                       |
                                       
                                          
                                             V
                                          
                                          
                                             1
                                          
                                       
                                       (
                                       ∞
                                       ,
                                       
                                          
                                             c
                                          
                                          
                                             1
                                          
                                       
                                       )
                                       ,
                                       
                                          
                                             V
                                          
                                          
                                             2
                                          
                                       
                                       (
                                       ∞
                                       ,
                                       
                                          
                                             c
                                          
                                          
                                             2
                                          
                                       
                                       )
                                       ,
                                       
                                          
                                             ℓ
                                          
                                          
                                             1
                                          
                                       
                                       ⩾
                                       
                                          
                                             ℓ
                                          
                                          
                                             2
                                          
                                       
                                       |
                                       1
                                       |
                                       TC
                                    
                                  
                                 in 
                                 
                                    
                                       O
                                       (
                                       
                                          
                                             n
                                          
                                          
                                             2
                                             
                                                
                                                   V
                                                
                                                
                                                   2
                                                
                                             
                                             +
                                             3
                                          
                                       
                                       
                                          
                                             (
                                             L
                                             +
                                             
                                                
                                                   V
                                                
                                                
                                                   1
                                                
                                             
                                             )
                                          
                                          
                                             2
                                          
                                       
                                       
                                          
                                             c
                                          
                                          
                                             2
                                          
                                       
                                       +
                                       
                                          
                                             n
                                          
                                          
                                             2
                                             
                                                
                                                   V
                                                
                                                
                                                   2
                                                
                                             
                                             +
                                             5
                                          
                                       
                                       (
                                       L
                                       +
                                       
                                          
                                             V
                                          
                                          
                                             1
                                          
                                       
                                       )
                                       
                                          
                                             c
                                          
                                          
                                             2
                                          
                                          
                                             2
                                          
                                       
                                       )
                                    
                                  
                                 time, which is polynomial if 
                                 
                                    
                                       
                                          
                                             V
                                          
                                          
                                             2
                                          
                                       
                                    
                                  
                                 is fixed.
                              

The proof is similar to that of algorithm EE1.□

For the other problems with two transportation modes and limited number of vehicles for express transportation, similar dynamic programming algorithms can be given. The results are shown in Table 1. If 
                              
                                 
                                    
                                       V
                                    
                                    
                                       2
                                    
                                 
                              
                            is fixed, all of the above problems can be solved in polynomial time. Otherwise, the problems are open.

We next consider problem 
                           
                              1
                              |
                              fseq
                              ,
                              
                                 
                                    
                                       
                                          d
                                       
                                       
                                          ̃
                                       
                                    
                                 
                                 
                                    j
                                 
                              
                              =
                              
                                 
                                    C
                                 
                                 
                                    j
                                 
                              
                              +
                              T
                              |
                              
                                 
                                    V
                                 
                                 
                                    1
                                 
                              
                              (
                              
                                 
                                    V
                                 
                                 
                                    1
                                 
                              
                              ,
                              
                                 
                                    c
                                 
                                 
                                    1
                                 
                              
                              )
                              |
                              1
                              |
                              TC
                           
                        , which can be seen as a special case of problem 
                           
                              1
                              |
                              fseq
                              ,
                              
                                 
                                    
                                       
                                          d
                                       
                                       
                                          ̃
                                       
                                    
                                 
                                 
                                    j
                                 
                              
                              =
                              
                                 
                                    C
                                 
                                 
                                    j
                                 
                              
                              +
                              T
                              |
                              
                                 
                                    V
                                 
                                 
                                    1
                                 
                              
                              (
                              
                                 
                                    V
                                 
                                 
                                    1
                                 
                              
                              ,
                              
                                 
                                    c
                                 
                                 
                                    1
                                 
                              
                              )
                              ,
                              
                                 
                                    V
                                 
                                 
                                    2
                                 
                              
                              (
                              
                                 
                                    V
                                 
                                 
                                    2
                                 
                              
                              ,
                              
                                 
                                    c
                                 
                                 
                                    2
                                 
                              
                              )
                              ,
                              
                                 
                                    ℓ
                                 
                                 
                                    1
                                 
                              
                              =
                              
                                 
                                    ℓ
                                 
                                 
                                    2
                                 
                              
                              |
                              1
                              |
                              TC
                           
                         (Section 4.1.2), with 
                           
                              
                                 
                                    V
                                 
                                 
                                    2
                                 
                              
                              =
                              0
                           
                        . We can give a similar dynamic programming algorithm that runs in 
                           
                              O
                              (
                              
                                 
                                    (
                                    n
                                    (
                                    L
                                    +
                                    
                                       
                                          V
                                       
                                       
                                          1
                                       
                                    
                                    )
                                    )
                                 
                                 
                                    2
                                 
                              
                              )
                           
                         time. Since 
                           
                              
                                 
                                    V
                                 
                                 
                                    1
                                 
                              
                              ⩽
                              Ln
                           
                        , this problem is solvable in polynomial time.

Similarly, viewing problem 
                           
                              1
                              |
                              fseq
                              ,
                              
                                 
                                    
                                       
                                          d
                                       
                                       
                                          ̃
                                       
                                    
                                 
                                 
                                    j
                                 
                              
                              =
                              
                                 
                                    C
                                 
                                 
                                    j
                                 
                              
                              +
                              T
                              |
                              
                                 
                                    V
                                 
                                 
                                    1
                                 
                              
                              (
                              ∞
                              ,
                              
                                 
                                    c
                                 
                                 
                                    1
                                 
                              
                              )
                              |
                              1
                              |
                              TC
                           
                         as a special case of 
                           
                              1
                              |
                              fseq
                              ,
                              
                                 
                                    
                                       
                                          d
                                       
                                       
                                          ̃
                                       
                                    
                                 
                                 
                                    j
                                 
                              
                              =
                              
                                 
                                    C
                                 
                                 
                                    j
                                 
                              
                              +
                              T
                              |
                              
                                 
                                    V
                                 
                                 
                                    1
                                 
                              
                              (
                              ∞
                              ,
                              
                                 
                                    c
                                 
                                 
                                    1
                                 
                              
                              )
                              ,
                              
                                 
                                    V
                                 
                                 
                                    2
                                 
                              
                              (
                              
                                 
                                    V
                                 
                                 
                                    2
                                 
                              
                              ,
                              
                                 
                                    c
                                 
                                 
                                    2
                                 
                              
                              )
                              ,
                              
                                 
                                    ℓ
                                 
                                 
                                    1
                                 
                              
                              =
                              
                                 
                                    ℓ
                                 
                                 
                                    2
                                 
                              
                              |
                              1
                              |
                              TC
                           
                         with 
                           
                              
                                 
                                    V
                                 
                                 
                                    2
                                 
                              
                              =
                              0
                           
                        , one can solve it by dynamic programming algorithm in time 
                           
                              O
                              (
                              
                                 
                                    (
                                    nL
                                    )
                                 
                                 
                                    2
                                 
                              
                              )
                           
                        . Actually, we can give a greedy algorithm having smaller complexity. Hereafter we assume, together with assumptions in Sections 2 and 4, that jobs and departure times are numbered in increasing order (of completion times and departure times respectively). In fact, for each job i, we let 
                           
                              t
                              (
                              i
                              )
                           
                         denote the first departure time after the completion of job i, i.e.:
                           
                              
                                 t
                                 (
                                 i
                                 )
                                 =
                                 
                                    min
                                 
                                 {
                                 
                                    
                                       t
                                    
                                    
                                       s
                                    
                                 
                                 :
                                 
                                    
                                       t
                                    
                                    
                                       s
                                    
                                 
                                 ⩾
                                 
                                    
                                       C
                                    
                                    
                                       i
                                    
                                 
                                 ,
                                 s
                                 =
                                 1
                                 ,
                                 …
                                 ,
                                 L
                                 }
                              
                           
                        Note that all values 
                           
                              t
                              (
                              i
                              )
                           
                         can be computed in 
                           
                              O
                              (
                              n
                              +
                              L
                              )
                           
                        , simply scanning the two ordered sets.
                           Algorithm 1
                           Algorithm EC
                                 
                                    
                                 
                              
                           

The algorithm EC greedily scans the jobs in increasing order of completion times, assigning jobs to the current batch as long as no deadline is violated. When the addition of the next job would make the first job late, a new batch is started.

The algorithm exploits the fact that there exists an optimal delivery schedule in which no batch is split (Property 3 of Lemma 1). In Algorithm EC, i is the index of the last considered job, j is the index of the last considered batch, P contains the delivery schedule and 
                           
                              
                                 
                                    t
                                 
                                 
                                    
                                       
                                          B
                                       
                                       
                                          j
                                       
                                    
                                 
                              
                           
                         is the departure time of batch 
                           
                              
                                 
                                    B
                                 
                                 
                                    j
                                 
                              
                           
                        .
                           Theorem 3
                           
                              Algorithm EC finds an optimal delivery schedule for problem 
                              
                                 
                                    1
                                    |
                                    fseq
                                    ,
                                    
                                       
                                          
                                             
                                                d
                                             
                                             
                                                ̃
                                             
                                          
                                       
                                       
                                          j
                                       
                                    
                                    =
                                    
                                       
                                          C
                                       
                                       
                                          j
                                       
                                    
                                    +
                                    T
                                    |
                                    
                                       
                                          V
                                       
                                       
                                          1
                                       
                                    
                                    (
                                    ∞
                                    ,
                                    
                                       
                                          c
                                       
                                       
                                          1
                                       
                                    
                                    )
                                 
                               
                              
                                 
                                    |
                                    1
                                    |
                                    TC
                                 
                               
                              in polynomial time 
                              
                                 
                                    O
                                    (
                                    n
                                    +
                                    L
                                    )
                                 
                              
                              .
                           

Let 
                                 
                                    ϕ
                                 
                               be the schedule generated by Algorithm EC, and consider an optimal delivery schedule 
                                 
                                    B
                                 
                              . From Property 3 of Lemma 1, no batch can be split in 
                                 
                                    B
                                 
                              . Suppose that 
                                 
                                    B
                                 
                               and 
                                 
                                    ϕ
                                 
                               coincide up to the first 
                                 
                                    k
                                    -
                                    1
                                 
                               batches. According to Algorithm EC, one has 
                                 
                                    
                                       
                                          D
                                       
                                       
                                          
                                             
                                                B
                                             
                                             
                                                k
                                             
                                          
                                       
                                    
                                    (
                                    B
                                    )
                                    ⩾
                                    
                                       
                                          D
                                       
                                       
                                          
                                             
                                                B
                                             
                                             
                                                k
                                             
                                          
                                       
                                    
                                    (
                                    ϕ
                                    )
                                 
                               and 
                                 
                                    |
                                    
                                       
                                          B
                                       
                                       
                                          k
                                       
                                    
                                    (
                                    ϕ
                                    )
                                    |
                                    ⩾
                                    |
                                    
                                       
                                          B
                                       
                                       
                                          k
                                       
                                    
                                    (
                                    B
                                    )
                                    |
                                 
                              , where 
                                 
                                    
                                       
                                          B
                                       
                                       
                                          k
                                       
                                    
                                    (
                                    ϕ
                                    )
                                 
                               and 
                                 
                                    
                                       
                                          B
                                       
                                       
                                          k
                                       
                                    
                                    (
                                    B
                                    )
                                 
                               denote the k-th batch in 
                                 
                                    ϕ
                                 
                               and 
                                 
                                    B
                                 
                               respectively, 
                                 
                                    |
                                    
                                       
                                          B
                                       
                                       
                                          k
                                       
                                    
                                    (
                                    ϕ
                                    )
                                    |
                                 
                               denotes the number of jobs in batch 
                                 
                                    
                                       
                                          B
                                       
                                       
                                          k
                                       
                                    
                                    (
                                    ϕ
                                    )
                                 
                              . We distinguish three cases.
                                 
                                    •
                                    
                                       
                                          
                                             |
                                             
                                                
                                                   B
                                                
                                                
                                                   k
                                                
                                             
                                             (
                                             ϕ
                                             )
                                             |
                                             >
                                             |
                                             
                                                
                                                   B
                                                
                                                
                                                   k
                                                
                                             
                                             (
                                             B
                                             )
                                             |
                                          
                                        and 
                                          
                                             
                                                
                                                   D
                                                
                                                
                                                   
                                                      
                                                         B
                                                      
                                                      
                                                         k
                                                      
                                                   
                                                
                                             
                                             (
                                             B
                                             )
                                             =
                                             
                                                
                                                   D
                                                
                                                
                                                   
                                                      
                                                         B
                                                      
                                                      
                                                         k
                                                      
                                                   
                                                
                                             
                                             (
                                             ϕ
                                             )
                                          
                                       . In this case, we add to 
                                          
                                             
                                                
                                                   B
                                                
                                                
                                                   k
                                                
                                             
                                             (
                                             B
                                             )
                                          
                                        the jobs in 
                                          
                                             
                                                
                                                   B
                                                
                                                
                                                   k
                                                
                                             
                                             (
                                             ϕ
                                             )
                                             ⧹
                                             
                                                
                                                   B
                                                
                                                
                                                   k
                                                
                                             
                                             (
                                             B
                                             )
                                          
                                       , so that 
                                          
                                             |
                                             
                                                
                                                   B
                                                
                                                
                                                   k
                                                
                                             
                                             (
                                             ϕ
                                             )
                                             |
                                             =
                                             |
                                             
                                                
                                                   B
                                                
                                                
                                                   k
                                                
                                             
                                             (
                                             B
                                             )
                                             |
                                          
                                        without changing 
                                          
                                             
                                                
                                                   D
                                                
                                                
                                                   
                                                      
                                                         B
                                                      
                                                      
                                                         k
                                                      
                                                   
                                                
                                             
                                             (
                                             B
                                             )
                                          
                                       , which does not increase the transportation cost.


                                       
                                          
                                             |
                                             
                                                
                                                   B
                                                
                                                
                                                   k
                                                
                                             
                                             (
                                             ϕ
                                             )
                                             |
                                             =
                                             |
                                             
                                                
                                                   B
                                                
                                                
                                                   k
                                                
                                             
                                             (
                                             B
                                             )
                                             |
                                          
                                        and 
                                          
                                             
                                                
                                                   D
                                                
                                                
                                                   
                                                      
                                                         B
                                                      
                                                      
                                                         k
                                                      
                                                   
                                                
                                             
                                             (
                                             B
                                             )
                                             >
                                             
                                                
                                                   D
                                                
                                                
                                                   
                                                      
                                                         B
                                                      
                                                      
                                                         k
                                                      
                                                   
                                                
                                             
                                             (
                                             ϕ
                                             )
                                          
                                       . In this case, we anticipate 
                                          
                                             
                                                
                                                   D
                                                
                                                
                                                   
                                                      
                                                         B
                                                      
                                                      
                                                         k
                                                      
                                                   
                                                
                                             
                                             (
                                             B
                                             )
                                          
                                       , so that 
                                          
                                             
                                                
                                                   D
                                                
                                                
                                                   
                                                      
                                                         B
                                                      
                                                      
                                                         k
                                                      
                                                   
                                                
                                             
                                             (
                                             B
                                             )
                                             =
                                             
                                                
                                                   D
                                                
                                                
                                                   
                                                      
                                                         B
                                                      
                                                      
                                                         k
                                                      
                                                   
                                                
                                             
                                             (
                                             ϕ
                                             )
                                          
                                       , and this does not increase the transportation cost.


                                       
                                          
                                             |
                                             
                                                
                                                   B
                                                
                                                
                                                   k
                                                
                                             
                                             (
                                             ϕ
                                             )
                                             |
                                             >
                                             |
                                             
                                                
                                                   B
                                                
                                                
                                                   k
                                                
                                             
                                             (
                                             B
                                             )
                                             |
                                          
                                        and 
                                          
                                             
                                                
                                                   D
                                                
                                                
                                                   
                                                      
                                                         B
                                                      
                                                      
                                                         k
                                                      
                                                   
                                                
                                             
                                             (
                                             B
                                             )
                                             >
                                             
                                                
                                                   D
                                                
                                                
                                                   
                                                      
                                                         B
                                                      
                                                      
                                                         k
                                                      
                                                   
                                                
                                             
                                             (
                                             ϕ
                                             )
                                          
                                       . In this case one can perform both previous transformations, to get both 
                                          
                                             |
                                             
                                                
                                                   B
                                                
                                                
                                                   k
                                                
                                             
                                             (
                                             ϕ
                                             )
                                             |
                                             =
                                             |
                                             
                                                
                                                   B
                                                
                                                
                                                   k
                                                
                                             
                                             (
                                             B
                                             )
                                             |
                                          
                                        and 
                                          
                                             
                                                
                                                   D
                                                
                                                
                                                   
                                                      
                                                         B
                                                      
                                                      
                                                         k
                                                      
                                                   
                                                
                                             
                                             (
                                             B
                                             )
                                             =
                                             
                                                
                                                   D
                                                
                                                
                                                   
                                                      
                                                         B
                                                      
                                                      
                                                         k
                                                      
                                                   
                                                
                                             
                                             (
                                             ϕ
                                             )
                                          
                                       , which does not increase the transportation cost.

Applying the same rule, we can transform the subsequent batches in 
                                 
                                    B
                                 
                               as in 
                                 
                                    ϕ
                                 
                               without increasing the transportation cost. So schedule 
                                 
                                    ϕ
                                 
                               produced by Algorithm EC is optimal.

For each job, Algorithm EC checks (at line 13) whether its addition to the current batch violates any deadline or the batch size. This is done in constant time. Since there are n jobs, lines 3–17 are executed in 
                                 
                                    O
                                    (
                                    n
                                    )
                                 
                              , and the complexity of Algorithm EC is therefore dominated by the computation of values 
                                 
                                    t
                                    (
                                    i
                                    )
                                 
                              , i.e., 
                                 
                                    O
                                    (
                                    n
                                    +
                                    L
                                    )
                                 
                              .□


                        Fig. 2
                         shows an example of the third case in the proof of Theorem 3, where 
                           
                              ϕ
                              ,
                              B
                              1
                           
                         and 
                           
                              B
                              2
                           
                         represent respectively the schedule created by Algorithm EC, the optimal schedule before change and that after change. In this example, 
                           
                              
                                 
                                    D
                                 
                                 
                                    
                                       
                                          B
                                       
                                       
                                          k
                                       
                                    
                                 
                              
                              (
                              ϕ
                              )
                              =
                              
                                 
                                    t
                                 
                                 
                                    s
                                 
                              
                              +
                              
                                 
                                    l
                                 
                                 
                                    1
                                 
                              
                           
                         is earlier than 
                           
                              
                                 
                                    D
                                 
                                 
                                    
                                       
                                          B
                                       
                                       
                                          k
                                       
                                    
                                 
                              
                              (
                              B
                              1
                              )
                              =
                              
                                 
                                    t
                                 
                                 
                                    s
                                    +
                                    1
                                 
                              
                              +
                              
                                 
                                    l
                                 
                                 
                                    1
                                 
                              
                           
                        . 
                           
                              
                                 
                                    B
                                 
                                 
                                    k
                                 
                              
                              (
                              ϕ
                              )
                              =
                              {
                              4
                              ,
                              5
                              ,
                              6
                              }
                           
                         has 3 jobs while 
                           
                              
                                 
                                    B
                                 
                                 
                                    k
                                 
                              
                              (
                              B
                              1
                              )
                              =
                              {
                              4
                              ,
                              5
                              }
                           
                         has 2 jobs. This accords with the condition of the third case. After change as the proof, we obtain a new optimal schedule 
                           
                              B
                              2
                           
                        , such that 
                           
                              
                                 
                                    D
                                 
                                 
                                    
                                       
                                          B
                                       
                                       
                                          k
                                       
                                    
                                 
                              
                              (
                              B
                              2
                              )
                              =
                              
                                 
                                    t
                                 
                                 
                                    s
                                 
                              
                              +
                              
                                 
                                    l
                                 
                                 
                                    1
                                 
                              
                           
                         and 
                           
                              
                                 
                                    B
                                 
                                 
                                    k
                                 
                              
                              (
                              B
                              2
                              )
                              =
                              {
                              4
                              ,
                              5
                              ,
                              6
                              }
                           
                        .

Let us now turn to problems in which 
                           
                              
                                 
                                    V
                                 
                                 
                                    1
                                 
                              
                              =
                              0
                           
                        . Again, from Property 3 of Lemma 1, there exists an optimal delivery schedule in which no batch is split.

If there is an unlimited number of vehicles, considering that 
                           
                              1
                              |
                              fseq
                              ,
                              
                                 
                                    
                                       
                                          d
                                       
                                       
                                          ̃
                                       
                                    
                                 
                                 
                                    j
                                 
                              
                              =
                              
                                 
                                    C
                                 
                                 
                                    j
                                 
                              
                              +
                              T
                              |
                              
                                 
                                    V
                                 
                                 
                                    2
                                 
                              
                              (
                              ∞
                              ,
                              
                                 
                                    c
                                 
                                 
                                    2
                                 
                              
                              )
                              |
                              1
                              |
                              TC
                           
                         is as a special case of 
                           
                              1
                              |
                              fseq
                              ,
                              
                                 
                                    
                                       
                                          d
                                       
                                       
                                          ̃
                                       
                                    
                                 
                                 
                                    j
                                 
                              
                              =
                              
                                 
                                    C
                                 
                                 
                                    j
                                 
                              
                              +
                              T
                              |
                              
                                 
                                    V
                                 
                                 
                                    1
                                 
                              
                              (
                              
                                 
                                    V
                                 
                                 
                                    1
                                 
                              
                              ,
                              
                                 
                                    c
                                 
                                 
                                    1
                                 
                              
                              )
                              ,
                              
                                 
                                    V
                                 
                                 
                                    2
                                 
                              
                              (
                              ∞
                              ,
                              
                                 
                                    c
                                 
                                 
                                    2
                                 
                              
                              )
                              ,
                              
                                 
                                    ℓ
                                 
                                 
                                    1
                                 
                              
                              =
                              
                                 
                                    ℓ
                                 
                                 
                                    2
                                 
                              
                              |
                              1
                              |
                              TC
                           
                         with 
                           
                              
                                 
                                    V
                                 
                                 
                                    1
                                 
                              
                              =
                              0
                           
                        , one can give a dynamic programming algorithm having complexity 
                           
                              O
                              (
                              
                                 
                                    n
                                 
                                 
                                    2
                                 
                              
                              )
                           
                        . Indeed, also in this case the problem can be solved more efficiently by a greedy algorithm. Such algorithm is identical to Algorithm EC, except that the departure time of a batch now coincides with the completion time of the last job in the batch, and, of course, there is no need to define 
                           
                              t
                              (
                              i
                              )
                           
                        . Hence, it suffices replacing the step at lines 12 and 17, “
                           
                              
                                 
                                    t
                                 
                                 
                                    s
                                 
                              
                              =
                              t
                              (
                              i
                              +
                              1
                              )
                           
                        ”, with “
                           
                              
                                 
                                    t
                                 
                                 
                                    s
                                 
                              
                              =
                              
                                 
                                    C
                                 
                                 
                                    i
                                    +
                                    1
                                 
                              
                           
                        ”, and the time complexity is therefore 
                           
                              O
                              (
                              n
                              )
                           
                        .

Let us now turn to problem with a limited number of vehicles, i.e., 
                           
                              1
                              |
                              fseq
                              ,
                              
                                 
                                    
                                       
                                          d
                                       
                                       
                                          ̃
                                       
                                    
                                 
                                 
                                    j
                                 
                              
                              =
                              
                                 
                                    C
                                 
                                 
                                    j
                                 
                              
                              +
                              T
                              |
                              
                                 
                                    V
                                 
                                 
                                    2
                                 
                              
                              (
                              
                                 
                                    V
                                 
                                 
                                    2
                                 
                              
                              ,
                              
                                 
                                    c
                                 
                                 
                                    2
                                 
                              
                              )
                              |
                              1
                              |
                              TC
                           
                        . Notice that in this case each roundtrip (of length 
                           
                              
                                 
                                    ℓ
                                 
                                 
                                    2
                                 
                              
                              +
                              
                                 
                                    ℓ
                                 
                                 
                                    2
                                 
                                 
                                    ′
                                 
                              
                           
                        ) corresponds to a batch, and the problem indeed consists of delivering all jobs within their respective deadlines with the minimum number of batches.

The complexity of 
                           
                              1
                              |
                              fseq
                              ,
                              
                                 
                                    
                                       
                                          d
                                       
                                       
                                          ̃
                                       
                                    
                                 
                                 
                                    j
                                 
                              
                              =
                              
                                 
                                    C
                                 
                                 
                                    j
                                 
                              
                              +
                              T
                              |
                              
                                 
                                    V
                                 
                                 
                                    2
                                 
                              
                              (
                              
                                 
                                    V
                                 
                                 
                                    2
                                 
                              
                              ,
                              
                                 
                                    c
                                 
                                 
                                    2
                                 
                              
                              )
                              |
                              1
                              |
                              TC
                           
                         is open if 
                           
                              
                                 
                                    V
                                 
                                 
                                    2
                                 
                              
                           
                         is not fixed. If 
                           
                              
                                 
                                    V
                                 
                                 
                                    2
                                 
                              
                           
                         is fixed, the problem can be seen as a special case of problem 
                           
                              1
                              |
                              fseq
                              ,
                              
                              
                                 
                                    
                                       
                                          d
                                       
                                       
                                          ̃
                                       
                                    
                                 
                                 
                                    j
                                 
                              
                              =
                              
                                 
                                    C
                                 
                                 
                                    j
                                 
                              
                              +
                              T
                              |
                              
                                 
                                    V
                                 
                                 
                                    1
                                 
                              
                              (
                              
                                 
                                    V
                                 
                                 
                                    1
                                 
                              
                              ,
                              
                                 
                                    c
                                 
                                 
                                    1
                                 
                              
                              )
                              ,
                              
                              
                                 
                                    V
                                 
                                 
                                    2
                                 
                              
                              (
                              
                                 
                                    V
                                 
                                 
                                    2
                                 
                              
                              ,
                              
                                 
                                    c
                                 
                                 
                                    2
                                 
                              
                              )
                              ,
                              
                              
                                 
                                    ℓ
                                 
                                 
                                    1
                                 
                              
                              =
                              
                                 
                                    ℓ
                                 
                                 
                                    2
                                 
                              
                              |
                              1
                              |
                              TC
                           
                         with 
                           
                              
                                 
                                    V
                                 
                                 
                                    1
                                 
                              
                              =
                              0
                           
                        , and hence one can give a similar dynamic programming algorithm that runs in 
                           
                              O
                              (
                              
                                 
                                    n
                                 
                                 
                                    2
                                    
                                       
                                          V
                                       
                                       
                                          2
                                       
                                    
                                    +
                                    4
                                 
                              
                              )
                           
                         time. In particular, when there is only one vehicle, the complexity of this algorithm is 
                           
                              O
                              (
                              
                                 
                                    n
                                 
                                 
                                    6
                                 
                              
                              )
                           
                        . Indeed, we next show that in this case the problem can be solved in 
                           
                              O
                              (
                              
                                 
                                    n
                                 
                                 
                                    3
                                 
                              
                              )
                           
                         by a different algorithm, that we present in the following.

The algorithm is based on the following idea. Since there is a single vehicle, the whole production schedule can be decomposed into contiguous subschedules, each spanning an interval of consecutive jobs. We denote by 
                           
                              [
                              i
                              ,
                              j
                              ]
                           
                         a subschedule containing jobs 
                           
                              i
                              ,
                              i
                              +
                              1
                              ,
                              …
                              ,
                              j
                              -
                              1
                              ,
                              j
                           
                        . The beginning of the subschedule is marked by the fact that the vehicle departs exactly at the time 
                           
                              
                                 
                                    C
                                 
                                 
                                    i
                                    -
                                    1
                                 
                              
                           
                         (i.e., at the starting time 
                           
                              
                                 
                                    S
                                 
                                 
                                    i
                                 
                              
                           
                         of job i). A subschedule consists of a number of consecutive roundtrips (i.e., with no idle time in between them), followed by an idle interval for the vehicle (possibly null, if it happens that the vehicle gets back to 
                           
                              
                                 
                                    M
                                 
                                 
                                    1
                                 
                              
                           
                         precisely when the last job of the subschedule completes). Each roundtrip corresponds to a batch, and a subschedule may consist of one or more batches. The key observation is that, whenever a new subschedule starts, the subsequent scheduling of the vehicle is independent of the scheduling up to that point. In the following, 
                           
                              (
                              u
                              ,
                              v
                              )
                           
                         denotes the batch containing jobs 
                           
                              u
                              ,
                              u
                              +
                              1
                              ,
                              …
                              ,
                              v
                              -
                              1
                              ,
                              v
                           
                        .

We introduce some additional notation. For a given time t, let 
                           
                              q
                              (
                              t
                              )
                           
                         be the last job completing on 
                           
                              
                                 
                                    M
                                 
                                 
                                    1
                                 
                              
                           
                         before or at t. For each job j, let also 
                           
                              k
                              (
                              j
                              )
                           
                         be the highest-indexed job that can still be included in a batch with j. It is computed as follows. Let 
                           
                              
                                 
                                    k
                                 
                                 
                                    ̃
                                 
                              
                              (
                              j
                              )
                              =
                              arg
                              max
                              {
                              h
                              :
                              
                                 
                                    C
                                 
                                 
                                    h
                                 
                              
                              ⩽
                              
                                 
                                    
                                       
                                          d
                                       
                                       
                                          ̃
                                       
                                    
                                 
                                 
                                    j
                                 
                              
                              -
                              
                                 
                                    ℓ
                                 
                                 
                                    2
                                 
                              
                              }
                           
                        . In other words, a batch containing j may contain all jobs from j to 
                           
                              
                                 
                                    k
                                 
                                 
                                    ̃
                                 
                              
                              (
                              j
                              )
                           
                        , but cannot extend beyond 
                           
                              
                                 
                                    k
                                 
                                 
                                    ̃
                                 
                              
                              (
                              j
                              )
                           
                        . Since moreover the vehicle has capacity 
                           
                              
                                 
                                    c
                                 
                                 
                                    2
                                 
                              
                           
                        , by no means a batch containing j can extend beyond job 
                           
                              k
                              (
                              j
                              )
                              =
                              min
                              {
                              
                                 
                                    k
                                 
                                 
                                    ̃
                                 
                              
                              (
                              j
                              )
                              ,
                              j
                              +
                              
                                 
                                    c
                                 
                                 
                                    2
                                 
                              
                              -
                              1
                              }
                           
                        .

Let us consider job 1, and for simplicity let us suppose that the vehicle starts (for a 0-th roundtrip) at time 0 (this hypothesis can be easily removed), so that the first batch departs not sooner than 
                           
                              
                                 
                                    t
                                 
                                 
                                    1
                                 
                              
                              =
                              
                                 
                                    ℓ
                                 
                                 
                                    2
                                 
                              
                              +
                              
                                 
                                    ℓ
                                 
                                 
                                    2
                                 
                                 
                                    ′
                                 
                              
                           
                        . The first batch may actually include jobs that will complete even after that time. Precisely, at time 
                           
                              
                                 
                                    ℓ
                                 
                                 
                                    2
                                 
                              
                              +
                              
                                 
                                    ℓ
                                 
                                 
                                    2
                                 
                                 
                                    ′
                                 
                              
                           
                        , either 
                           
                              (
                              a
                              )
                           
                         the vehicle will start immediately carrying away the jobs completed until then, or 
                           
                              (
                              b
                              )
                           
                         it waits for the rest of the batch to be completed.

If case 
                           
                              (
                              a
                              )
                           
                         occurs, clearly the first batch is 
                           
                              (
                              1
                              ,
                              q
                              (
                              
                                 
                                    t
                                 
                                 
                                    1
                                 
                              
                              )
                              )
                           
                        , and the first subschedule will include at least another batch. If case 
                           
                              (
                              b
                              )
                           
                         occurs, the first batch is one of the following (see Fig. 3
                        ):
                           
                              (1)
                              
                                 (
                                 1
                                 ,
                                 q
                                 (
                                 
                                    
                                       t
                                    
                                    
                                       1
                                    
                                 
                                 )
                                 +
                                 1
                                 )
                              
                           
                        
                        
                           
                              (2)
                              
                                 (
                                 1
                                 ,
                                 q
                                 (
                                 
                                    
                                       t
                                    
                                    
                                       1
                                    
                                 
                                 )
                                 +
                                 2
                                 )
                              
                           
                        
                        
                           
                              (3)
                              
                                 
                                    
                                       
                                       
                                          
                                             …
                                          
                                       
                                    
                                    
                                       
                                       
                                          
                                             (
                                             1
                                             ,
                                             k
                                             (
                                             1
                                             )
                                             )
                                          
                                       
                                    
                                 
                              
                           
                        Notice that if we are in case 
                           
                              (
                              b
                              )
                           
                        , the first subschedule is complete, i.e., in this case the first subschedule only contains one batch.

Now suppose we are in case 
                           
                              (
                              a
                              )
                           
                        , i.e., the vehicle restarts immediately. Then, the first job of the second batch will be 
                           
                              q
                              (
                              
                                 
                                    t
                                 
                                 
                                    1
                                 
                              
                              )
                              +
                              1
                           
                         (see Fig. 4
                        ). Now again there are two cases, depending if 
                           
                              (
                              
                                 
                                    a
                                 
                                 
                                    ′
                                 
                              
                              )
                           
                         again the vehicle restarts immediately, or 
                           
                              (
                              
                                 
                                    b
                                 
                                 
                                    ′
                                 
                              
                              )
                           
                         it is idle until completion of the second batch. If case 
                           
                              (
                              
                                 
                                    a
                                 
                                 
                                    ′
                                 
                              
                              )
                           
                         occurs, letting 
                           
                              
                                 
                                    t
                                 
                                 
                                    2
                                 
                              
                              =
                              2
                              
                                 
                                    
                                       
                                          
                                             ℓ
                                          
                                          
                                             2
                                          
                                       
                                       +
                                       
                                          
                                             ℓ
                                          
                                          
                                             2
                                          
                                          
                                             ′
                                          
                                       
                                    
                                 
                              
                           
                        , clearly the second batch will be 
                           
                              (
                              q
                              (
                              
                                 
                                    t
                                 
                                 
                                    1
                                 
                              
                              )
                              +
                              1
                              ,
                              q
                              (
                              
                                 
                                    t
                                 
                                 
                                    2
                                 
                              
                              )
                              )
                           
                         and the first subschedule will contain at least another batch. If case 
                           
                              (
                              
                                 
                                    b
                                 
                                 
                                    ′
                                 
                              
                              )
                           
                         occurs, as shown in Fig. 4, the second batch will be one of the following:
                           
                              (4)
                              
                                 (
                                 q
                                 (
                                 
                                    
                                       t
                                    
                                    
                                       1
                                    
                                 
                                 )
                                 +
                                 1
                                 ,
                                 q
                                 (
                                 
                                    
                                       t
                                    
                                    
                                       2
                                    
                                 
                                 )
                                 +
                                 1
                                 )
                              
                           
                        
                        
                           
                              (5)
                              
                                 (
                                 q
                                 (
                                 
                                    
                                       t
                                    
                                    
                                       1
                                    
                                 
                                 )
                                 +
                                 1
                                 ,
                                 q
                                 (
                                 
                                    
                                       t
                                    
                                    
                                       2
                                    
                                 
                                 )
                                 +
                                 2
                                 )
                              
                           
                        
                        
                           
                              (6)
                              
                                 
                                    
                                       
                                       
                                          
                                             …
                                          
                                       
                                    
                                    
                                       
                                       
                                          
                                             (
                                             q
                                             (
                                             
                                                
                                                   t
                                                
                                                
                                                   1
                                                
                                             
                                             )
                                             +
                                             1
                                             ,
                                             k
                                             (
                                             q
                                             (
                                             
                                                
                                                   t
                                                
                                                
                                                   1
                                                
                                             
                                             )
                                             +
                                             1
                                             )
                                             )
                                          
                                       
                                    
                                 
                              
                           
                        and the first subschedule would now be complete.

The whole reasoning can be repeated several other times, to consider all possibilities for the first subschedule. An important observation is the following. Suppose that the completion time of job 
                           
                              k
                              (
                              1
                              )
                           
                         is larger than 
                           
                              2
                              
                                 
                                    
                                       
                                          
                                             ℓ
                                          
                                          
                                             2
                                          
                                       
                                       +
                                       
                                          
                                             ℓ
                                          
                                          
                                             2
                                          
                                          
                                             ′
                                          
                                       
                                    
                                 
                              
                           
                        . This means that if the first time (after time 0) the vehicle departs from 
                           
                              
                                 
                                    M
                                 
                                 
                                    1
                                 
                              
                           
                         is at the completion of 
                           
                              k
                              (
                              1
                              )
                           
                        , all jobs completed so far can be safely delivered within their due date. So, if the first subschedule spans jobs from 1 to 
                        
                           
                              k
                              (
                              1
                              )
                           
                        , there is no point in considering two consecutive roundtrips during the first subschedule. In fact, the vehicle would anyway get back to 
                           
                              
                                 
                                    M
                                 
                                 
                                    1
                                 
                              
                           
                         before the end of 
                           
                              k
                              (
                              1
                              )
                           
                        . This is illustrated in the first depicted case in Fig. 4. This case will never occur in an optimal solution, since it is always dominated by the last case of Fig. 3. On the contrary, it does make sense to consider two consecutive roundtrips if the subschedule extends beyond 
                           
                              k
                              (
                              1
                              )
                           
                         (second and third case in Fig. 4). Hence, when enumerating possible subschedules with two roundtrips (i.e., two batches), we will start from 
                           
                              [
                              1
                              ,
                              k
                              (
                              1
                              )
                              +
                              1
                              ]
                           
                        . Such observation allows to efficiently enumerate the possible structures of the first subschedule.

Summarizing, one possibility is that the first subschedule includes only one roundtrip, in which case we have the possibilities expressed by (1)–(3) and illustrated in Fig. 3. If the first subschedule contains two roundtrips, we have the possibilities enumerated in (4)–(6) and illustrated in Fig. 4, and so on. By the way, it should be noted that it might simply not be possible to have a second roundtrip in the first subschedule, because the vehicle might arrive too late from the first roundtrip to be back on time for the completion of job 
                           
                              k
                              (
                              q
                              (
                              
                                 
                                    t
                                 
                                 
                                    1
                                 
                              
                              )
                              +
                              1
                              )
                           
                        . So, the cases enumerated in (4)–(6) are not always all feasible. Anyhow, in general one has that the vehicle will start again immediately or there will be the idle period, and so on.

In practice, if the first batch spans from 1 to a job j, we should only consider the minimum number of roundtrips (batches) that allow the subschedule to extend up to j. Hence, there will be a number of cases which are ’covered’ by a single batch (in Fig. 3, the cases in which the first subschedule is either [1,4], [1,5], [1,6] or [1,7]). Thereafter, there are cases which require two batches (in Fig. 4, the cases in which the first subschedule is either [1,8] or [1,9]), and so on. It is important that for each terminal job of the first subschedule, there is a well-defined number of batches (in Fig. 4, one batch if the last job is 4, 5, 6 or 7, and two batches if it is 8 or 9).

As a consequence of what above, we have 
                           
                              O
                              (
                              n
                              )
                           
                         possible subschedules of the type 
                           
                              [
                              1
                              ,
                              j
                              ]
                           
                        , for all j from 
                           
                              q
                              (
                              
                                 
                                    t
                                 
                                 
                                    1
                                 
                              
                              )
                              +
                              1
                           
                         onwards (possibly, up to n). The number of consecutive roundtrips corresponding to each value of j can be computed while enumerating all of them with no further computational burden, so that generating all these cases requires 
                           
                              O
                              (
                              n
                              )
                           
                        . Now suppose to associate with each of the subschedules considered a node of a graph, labeled with 
                           
                              [
                              1
                              ,
                              j
                              ]
                           
                        , and weighted by the minimum number of consecutive roundtrips that make that subschedule feasible. These nodes are obviously 
                           
                              O
                              (
                              n
                              )
                           
                        .

The whole discussion can be repeated considering as the starting job of a subschedule a job 
                           
                              p
                              >
                              1
                           
                        , instead of job 1. For each p we generate 
                           
                              O
                              (
                              n
                              )
                           
                         nodes, corresponding to subschedules 
                           
                              [
                              p
                              ,
                              p
                              +
                              1
                              ]
                           
                        , 
                           
                              [
                              p
                              ,
                              p
                              +
                              2
                              ]
                           
                        ,…, 
                           
                              [
                              p
                              ,
                              k
                              (
                              p
                              )
                              ]
                           
                        . In conclusion, we generate 
                           
                              O
                              (
                              
                                 
                                    n
                                 
                                 
                                    2
                                 
                              
                              )
                           
                         nodes, corresponding to feasible subschedules. Now simply define an arc from each node 
                           
                              [
                              i
                              ,
                              j
                              ]
                           
                         to each node 
                           
                              [
                              j
                              +
                              1
                              ,
                              h
                              ]
                           
                        . Each node has 
                           
                              O
                              (
                              n
                              )
                           
                         successors, and the graph therefore has 
                           
                              O
                              (
                              
                                 
                                    n
                                 
                                 
                                    3
                                 
                              
                              )
                           
                         arcs. We also add a dummy starting node S and a dummy ending node 
                           
                              
                                 
                                    S
                                 
                                 
                                    ′
                                 
                              
                           
                        , and connect S to all nodes 
                           
                              [
                              1
                              ,
                              j
                              ]
                           
                         and all nodes 
                           
                              [
                              j
                              ,
                              n
                              ]
                           
                         to 
                           
                              
                                 
                                    S
                                 
                                 
                                    ′
                                 
                              
                           
                        . Hence, each path from S to 
                           
                              
                                 
                                    S
                                 
                                 
                                    ′
                                 
                              
                           
                         corresponds to a delivery schedule, and the weight of the path equals the total number of batches in the schedule. Hence, 
                           
                              1
                              |
                              fseq
                              ,
                              
                              
                                 
                                    
                                       
                                          d
                                       
                                       
                                          ̃
                                       
                                    
                                 
                                 
                                    j
                                 
                              
                              =
                              
                                 
                                    C
                                 
                                 
                                    j
                                 
                              
                              +
                              T
                              |
                              
                                 
                                    V
                                 
                                 
                                    2
                                 
                              
                              (
                              1
                              ,
                              
                                 
                                    c
                                 
                                 
                                    2
                                 
                              
                              )
                              |
                              1
                              |
                              TC
                           
                         becomes finding the path of minimum weight from S to 
                           
                              
                                 
                                    S
                                 
                                 
                                    ′
                                 
                              
                           
                        . Note that the weights of the nodes can be transferred to outgoing arcs, to obtain an ordinary shortest path problem. Since the graph is acyclic, the following result holds.
                           Theorem 4
                           
                              Problem 
                              
                                 
                                    1
                                    |
                                    fseq
                                    ,
                                    
                                    
                                       
                                          
                                             
                                                d
                                             
                                             
                                                ̃
                                             
                                          
                                       
                                       
                                          j
                                       
                                    
                                    =
                                    
                                       
                                          C
                                       
                                       
                                          j
                                       
                                    
                                    +
                                    T
                                    |
                                    
                                       
                                          V
                                       
                                       
                                          2
                                       
                                    
                                    (
                                    1
                                    ,
                                    
                                       
                                          c
                                       
                                       
                                          2
                                       
                                    
                                    )
                                    |
                                    1
                                    |
                                    TC
                                 
                               
                              can be solved in 
                              
                                 
                                    O
                                    (
                                    
                                       
                                          n
                                       
                                       
                                          3
                                       
                                    
                                    )
                                 
                              
                              .
                           

We now address the set of problems in which the 3PP dominates, i.e., it is entitled to determine both a production and a delivery schedule. As discussed in Section 2, in these scenarios the problem can be seen as an IPODS (Integrated production and outbound distribution scheduling) problem, where the jobs are processed on a single machine and the batches are delivered to a single customer, with deadlines depending on the production schedule. We analyze the complexity of the problems in this scenario, denoted by 
                        
                           1
                           |
                           no
                           -
                           idle
                           ,
                           
                           
                              
                                 
                                    
                                       d
                                    
                                    
                                       ̃
                                    
                                 
                              
                              
                                 j
                              
                           
                           =
                           
                              
                                 C
                              
                              
                                 j
                              
                           
                           +
                           T
                           |
                           π
                           |
                           1
                           |
                           TC
                        
                     , where 
                        
                           π
                        
                      is the transportation parameter. Since in the literature the deadlines are independent of the production schedule, known complexity results do not in general apply to our problems. After giving some properties, we address the case in which there are only vehicles for express transportation (Section 5.1) and the case in which there are only vehicles for regular transportation (Section 5.2). We will see that most of the cases analyzed are NP-hard.

We can prove that the following property holds for these problems with all possible values of 
                        
                           π
                        
                     .
                        Lemma 2
                        
                           There exists an optimal production–distribution schedule for problem 
                           
                              
                                 1
                                 |
                                 no
                                 -
                                 idle
                                 ,
                                 
                                 
                                    
                                       
                                          
                                             d
                                          
                                          
                                             ̃
                                          
                                       
                                    
                                    
                                       j
                                    
                                 
                                 =
                                 
                                    
                                       C
                                    
                                    
                                       j
                                    
                                 
                                 +
                                 T
                                 |
                                 π
                                 |
                                 1
                                 |
                                 TC
                              
                            
                           such that, if the jobs of batch B are processed consecutively on 
                           
                              
                                 
                                    
                                       M
                                    
                                    
                                       1
                                    
                                 
                              
                           
                           , then the job having longest processing time in the batch is in first position.
                        

In a given optimal production–distribution schedule 
                              
                                 (
                                 σ
                                 ,
                                 B
                                 )
                              
                           , consider a batch B consisting of jobs consecutively processed on 
                              
                                 
                                    
                                       M
                                    
                                    
                                       1
                                    
                                 
                              
                           , and in which the first job, say job j, is not the longest job. Here the batch B can be a regular batch or an express batch. Let k be the longest job in B. Due to feasibility, 
                              
                                 
                                    
                                       D
                                    
                                    
                                       B
                                    
                                 
                                 ⩽
                                 
                                    
                                       
                                          
                                             d
                                          
                                          
                                             ̃
                                          
                                       
                                    
                                    
                                       j
                                    
                                 
                                 =
                                 
                                    
                                       C
                                    
                                    
                                       j
                                    
                                 
                                 (
                                 σ
                                 )
                                 +
                                 T
                              
                           . Now consider the new production schedule 
                              
                                 
                                    
                                       σ
                                    
                                    
                                       ′
                                    
                                 
                              
                            obtained by moving k in first position in its batch, and shifting all other jobs forward, without changing the departure time of batch B. Since k is the longest job in B, 
                              
                                 
                                    
                                       C
                                    
                                    
                                       h
                                    
                                 
                                 (
                                 
                                    
                                       σ
                                    
                                    
                                       ′
                                    
                                 
                                 )
                                 >
                                 
                                    
                                       C
                                    
                                    
                                       h
                                    
                                 
                                 (
                                 σ
                                 )
                              
                            for all 
                              
                                 h
                                 
                                 ≠
                                 
                                 k
                              
                           . Hence, since the delivery date 
                              
                                 
                                    
                                       D
                                    
                                    
                                       B
                                    
                                 
                              
                            of the batch has not changed, all these jobs are on time in 
                              
                                 
                                    
                                       σ
                                    
                                    
                                       ′
                                    
                                 
                              
                           . The only job which has been moved backward is k. Since 
                              
                                 
                                    
                                       p
                                    
                                    
                                       k
                                    
                                 
                                 >
                                 
                                    
                                       p
                                    
                                    
                                       j
                                    
                                 
                              
                           , then 
                              
                                 
                                    
                                       C
                                    
                                    
                                       k
                                    
                                 
                                 (
                                 
                                    
                                       σ
                                    
                                    
                                       ′
                                    
                                 
                                 )
                                 >
                                 
                                    
                                       C
                                    
                                    
                                       j
                                    
                                 
                                 (
                                 σ
                                 )
                              
                           , and since j was on time in 
                              
                                 σ
                                 ,
                                 
                                    
                                       D
                                    
                                    
                                       B
                                    
                                 
                                 ⩽
                                 
                                    
                                       C
                                    
                                    
                                       j
                                    
                                 
                                 (
                                 σ
                                 )
                                 +
                                 T
                                 <
                                 
                                    
                                       C
                                    
                                    
                                       k
                                    
                                 
                                 (
                                 
                                    
                                       σ
                                    
                                    
                                       ′
                                    
                                 
                                 )
                                 +
                                 T
                              
                           . In conclusion, also 
                              
                                 
                                    
                                       σ
                                    
                                    
                                       ′
                                    
                                 
                              
                            is feasible and optimal. By repeatedly applying this argument, one can find a production schedule which respects the property and having the same transportation cost as 
                              
                                 (
                                 σ
                                 ,
                                 B
                                 )
                              
                           .□

In this section we address the case in which only express transportation exists. We show that the complexity of the problem can be fully characterized. We first consider the case with an unlimited number of vehicles (Section 5.1.1), then the case in which there is actually only one vehicle (Section 5.1.2).

We next show that the complexity of the problem depends on the capacity of the vehicle. We first show that if each vehicle can carry at least 4 jobs, the problem is difficult. In what follows, we use the following strongly NP-complete problem (Garey & Johnson, 1979):


                           3-partition. Given 
                              
                                 3
                                 n
                              
                            integers 
                              
                                 
                                    
                                       a
                                    
                                    
                                       1
                                    
                                 
                                 ,
                                 …
                                 ,
                                 
                                    
                                       a
                                    
                                    
                                       3
                                       n
                                    
                                 
                              
                           , so that 
                              
                                 ∑
                                 
                                    
                                       a
                                    
                                    
                                       i
                                    
                                 
                                 =
                                 nW
                              
                           , and such that 
                              
                                 W
                                 /
                                 4
                                 <
                                 
                                    
                                       a
                                    
                                    
                                       i
                                    
                                 
                                 <
                                 W
                                 /
                                 2
                              
                            for all i, is it possible to partition them into n triples each summing up to W?
                              Theorem 5
                              
                                 The problem 
                                 
                                    
                                       1
                                       |
                                       no
                                       -
                                       idle
                                       ,
                                       
                                          
                                             
                                                
                                                   d
                                                
                                                
                                                   ̃
                                                
                                             
                                          
                                          
                                             j
                                          
                                       
                                       =
                                       
                                          
                                             C
                                          
                                          
                                             j
                                          
                                       
                                       +
                                       T
                                       |
                                       
                                          
                                             V
                                          
                                          
                                             2
                                          
                                       
                                       (
                                       ∞
                                       ,
                                       
                                          
                                             c
                                          
                                          
                                             2
                                          
                                       
                                       )
                                       |
                                       1
                                       |
                                       TC
                                    
                                  
                                 where 
                                 
                                    
                                       
                                          
                                             c
                                          
                                          
                                             2
                                          
                                       
                                       ⩾
                                       4
                                    
                                  
                                 is strongly NP-hard.
                              

We reduce 3-partition to our problem. Given an instance of 3-partition, define an instance of 
                                    
                                       1
                                       |
                                       no
                                       -
                                       idle
                                       ,
                                       
                                          
                                             
                                                
                                                   d
                                                
                                                
                                                   ̃
                                                
                                             
                                          
                                          
                                             j
                                          
                                       
                                       =
                                       
                                          
                                             C
                                          
                                          
                                             j
                                          
                                       
                                       +
                                       T
                                       |
                                       
                                          
                                             V
                                          
                                          
                                             2
                                          
                                       
                                       (
                                       ∞
                                       ,
                                       
                                          
                                             c
                                          
                                          
                                             2
                                          
                                       
                                       )
                                       |
                                       1
                                       |
                                       TC
                                    
                                  as follows. There are 
                                    
                                       4
                                       n
                                    
                                  jobs, namely n long jobs and 
                                    
                                       3
                                       n
                                    
                                  
                                 short jobs. Short jobs correspond to the integers of 3-partition, so 
                                    
                                       
                                          
                                             p
                                          
                                          
                                             i
                                          
                                       
                                       =
                                       
                                          
                                             a
                                          
                                          
                                             i
                                          
                                       
                                       ,
                                       i
                                       =
                                       1
                                       ,
                                       …
                                       ,
                                       3
                                       n
                                    
                                 . Each long job has processing time 
                                    
                                       Q
                                       ≫
                                       W
                                    
                                 . We let 
                                    
                                       T
                                       =
                                       Q
                                       +
                                       2
                                       W
                                    
                                 , hence the deadline of a job is 
                                    
                                       
                                          
                                             C
                                          
                                          
                                             j
                                          
                                       
                                       +
                                       T
                                       =
                                       
                                          
                                             C
                                          
                                          
                                             j
                                          
                                       
                                       +
                                       (
                                       Q
                                       +
                                       2
                                       W
                                       )
                                    
                                 . Transportation time is 
                                    
                                       
                                          
                                             ℓ
                                          
                                          
                                             2
                                          
                                       
                                       =
                                       Q
                                       +
                                       W
                                    
                                 . We want to know whether there exists a production–distribution schedule (
                                    
                                       σ
                                       ,
                                       B
                                    
                                 ) consisting of n batches that respects all due dates.

Suppose that a solution 
                                    
                                       Σ
                                    
                                  to 3-partition exists. Then we can build a production–distribution schedule 
                                    
                                       (
                                       σ
                                       ,
                                       
                                       B
                                       )
                                    
                                  for 3PP as follows. We put in each batch one long job, followed by one of the triples of 
                                    
                                       Σ
                                    
                                 . Doing so, the total processing time of each batch is exactly 
                                    
                                       Q
                                       +
                                       W
                                    
                                 , and so a long job j which completes at 
                                    
                                       
                                          
                                             C
                                          
                                          
                                             j
                                          
                                       
                                    
                                  will be delivered exactly at 
                                    
                                       
                                          
                                             C
                                          
                                          
                                             j
                                          
                                       
                                       +
                                       Q
                                       +
                                       2
                                       W
                                    
                                 , hence on time. Of course, also the three short jobs will be on time. So, the obtained schedule (
                                    
                                       σ
                                       ,
                                       B
                                    
                                 ) is a solution to 3PP.

Now suppose that a solution 
                                    
                                       (
                                       σ
                                       ,
                                       
                                       B
                                       )
                                    
                                  to 3PP exists, i.e., 
                                    
                                       (
                                       σ
                                       ,
                                       
                                       B
                                       )
                                    
                                  consists of n batches and respects all due dates. The following facts concerning 
                                    
                                       (
                                       σ
                                       ,
                                       
                                       B
                                       )
                                    
                                  hold.

Fact 1. Each batch contains exactly one long job. In fact, if in a batch there are two long jobs, the first of them would be certainly delivered late.

Fact 2. Each batch contains exactly three short jobs. If not, there is at least one batch with four short jobs, let 
                                    
                                       
                                          
                                             p
                                          
                                          
                                             ̃
                                          
                                       
                                    
                                  be their total processing time. From Lemma 2, the long job is the first in the batch, and it would be delivered after 
                                    
                                       
                                          
                                             p
                                          
                                          
                                             ̃
                                          
                                       
                                       +
                                       Q
                                       +
                                       W
                                    
                                  from its completion time. Since 
                                    
                                       W
                                       /
                                       4
                                       <
                                       
                                          
                                             a
                                          
                                          
                                             i
                                          
                                       
                                       ,
                                       
                                       
                                          
                                             p
                                          
                                          
                                             ̃
                                          
                                       
                                       >
                                       W
                                    
                                 . Hence, the long job would be late.

Fact 3. The total processing time of the short jobs in each batch equals W. If this is not the case, there would be at least one batch in which the total processing time of the short jobs would exceed W and hence, similarly to Fact 2, the long job in this batch would be delivered beyond its due date.

In conclusion, the short jobs in each batch define a triple which constitutes a solution to 3-partition.□

Now let us turn to the case 
                              
                                 
                                    
                                       c
                                    
                                    
                                       2
                                    
                                 
                                 =
                                 3
                              
                           . For the sake of simplicity, we suppose that in a schedule with b batches, there are 
                              
                                 3
                                 b
                                 -
                                 n
                              
                            dummy jobs with zero processing time, so that we can regard each batch as consisting of exactly three jobs.

We can prove that the following properties hold for the problem 
                              
                                 1
                                 |
                                 no
                                 -
                                 idle
                                 ,
                                 
                                 
                                    
                                       
                                          
                                             d
                                          
                                          
                                             ̃
                                          
                                       
                                    
                                    
                                       j
                                    
                                 
                                 =
                                 
                                    
                                       C
                                    
                                    
                                       j
                                    
                                 
                                 +
                                 T
                                 |
                                 
                                    
                                       V
                                    
                                    
                                       2
                                    
                                 
                                 (
                                 ∞
                                 ,
                                 3
                                 )
                                 |
                                 1
                                 |
                                 TC
                              
                           . In what follows, we suppose the jobs numbered in the longest precessing time (LPT) order, i.e., 
                              
                                 
                                    
                                       p
                                    
                                    
                                       1
                                    
                                 
                                 ⩾
                                 …
                                 ⩾
                                 
                                    
                                       p
                                    
                                    
                                       n
                                    
                                 
                              
                           .
                              Lemma 3
                              
                                 There exists an optimal production–distribution schedule, consisting of b batches, such that the following properties hold:
                                 
                                    
                                       1.
                                       
                                          The jobs 
                                          
                                             
                                                1
                                                ,
                                                …
                                                ,
                                                b
                                             
                                           
                                          are the first jobs in their respective batch.
                                       


                                          For each 
                                          
                                             
                                                i
                                                =
                                                0
                                                ,
                                                …
                                                ,
                                                b
                                                -
                                                1
                                             
                                          
                                          , the jobs 
                                          
                                             
                                                b
                                                +
                                                1
                                                +
                                                i
                                             
                                           
                                          and 
                                          
                                             
                                                3
                                                b
                                                -
                                                i
                                             
                                           
                                          are in the same batch.
                                       

Property 1: The proof of this property is illustrated by Fig. 5
                                 . Consider an optimal schedule 
                                    
                                       (
                                       σ
                                       ,
                                       
                                       B
                                       )
                                    
                                 , and suppose that there is a batch B with a job i such that 
                                    
                                       1
                                       ⩽
                                       i
                                       ⩽
                                       b
                                    
                                 , and i is not the first job in B. Since there are b batches, there is at least one batch, say 
                                    
                                       
                                          
                                             B
                                          
                                          
                                             ′
                                          
                                       
                                    
                                 , in which the first job has index 
                                    
                                       j
                                       >
                                       i
                                    
                                 . Now swap the jobs i and j among B and 
                                    
                                       
                                          
                                             B
                                          
                                          
                                             ′
                                          
                                       
                                    
                                  in 
                                    
                                       B
                                    
                                 , and update the departure time of each batch by the completion of each batch, hence obtaining a new schedule 
                                    
                                       (
                                       
                                          
                                             σ
                                          
                                          
                                             ˆ
                                          
                                       
                                       ,
                                       
                                       
                                          
                                             B
                                          
                                          
                                             ^
                                          
                                       
                                       )
                                    
                                  with the same number of batches. Note that 
                                    
                                       (
                                       
                                          
                                             σ
                                          
                                          
                                             ˆ
                                          
                                       
                                       ,
                                       
                                       
                                          
                                             B
                                          
                                          
                                             ^
                                          
                                       
                                       )
                                    
                                  is feasible. In fact, the first job of B is the same in the two schedules, and the difference between the departure time of B and the completion time of the first job of B is smaller in 
                                    
                                       
                                          
                                             B
                                          
                                          
                                             ^
                                          
                                       
                                    
                                 , so B is on time in 
                                    
                                       (
                                       
                                          
                                             σ
                                          
                                          
                                             ˆ
                                          
                                       
                                       ,
                                       
                                       
                                          
                                             B
                                          
                                          
                                             ^
                                          
                                       
                                       )
                                    
                                 . Concerning 
                                    
                                       
                                          
                                             B
                                          
                                          
                                             ′
                                          
                                       
                                    
                                 , the first job is longer in 
                                    
                                       (
                                       
                                          
                                             σ
                                          
                                          
                                             ˆ
                                          
                                       
                                       ,
                                       
                                          
                                             B
                                          
                                          
                                             ^
                                          
                                       
                                       )
                                    
                                  than in 
                                    
                                       (
                                       σ
                                       ,
                                       
                                       B
                                       )
                                    
                                  by 
                                    
                                       θ
                                       =
                                       
                                          
                                             p
                                          
                                          
                                             i
                                          
                                       
                                       -
                                       
                                          
                                             p
                                          
                                          
                                             j
                                          
                                       
                                    
                                 , so the difference between the departure time and the completion time of the first job increases by 
                                    
                                       θ
                                    
                                 . However, the difference between the deadline of the first job and the completion time of the first job increases also by 
                                    
                                       θ
                                    
                                 , so also 
                                    
                                       
                                          
                                             B
                                          
                                          
                                             ′
                                          
                                       
                                    
                                  is on time in 
                                    
                                       (
                                       
                                          
                                             σ
                                          
                                          
                                             ˆ
                                          
                                       
                                       ,
                                       
                                       
                                          
                                             B
                                          
                                          
                                             ^
                                          
                                       
                                       )
                                    
                                 . We can repeat the same argument for each job k such that 
                                    
                                       1
                                       ⩽
                                       k
                                       ⩽
                                       b
                                    
                                  and which is not the first job in its batch, until an optimal schedule respecting Property 1 is obtained.

Property 2: Let 
                                    
                                       (
                                       σ
                                       ,
                                       
                                       B
                                       )
                                    
                                  be an optimal production–distribution schedule which respects the previous Property 1. Suppose that 
                                    
                                       b
                                       +
                                       1
                                       +
                                       i
                                    
                                  and 
                                    
                                       3
                                       b
                                       -
                                       i
                                    
                                  are not in the same batch, and 
                                    
                                       b
                                       +
                                       1
                                       +
                                       i
                                    
                                  is the smallest-indexed job which is not in the same batch with 
                                    
                                       3
                                       b
                                       -
                                       i
                                    
                                 , for 
                                    
                                       i
                                       ⩽
                                       b
                                       -
                                       1
                                    
                                 . Let k denote the job in the same batch with 
                                    
                                       b
                                       +
                                       1
                                       +
                                       i
                                    
                                 , and 
                                    
                                       
                                          
                                             k
                                          
                                          
                                             ′
                                          
                                       
                                    
                                  the job in the same batch with 
                                    
                                       3
                                       b
                                       -
                                       i
                                    
                                 . Note that 
                                    
                                       
                                          
                                             p
                                          
                                          
                                             b
                                             +
                                             1
                                             +
                                             i
                                          
                                       
                                       ⩾
                                       
                                          
                                             p
                                          
                                          
                                             k
                                          
                                       
                                       ⩾
                                       
                                          
                                             p
                                          
                                          
                                             3
                                             b
                                             -
                                             i
                                          
                                       
                                    
                                  and 
                                    
                                       
                                          
                                             p
                                          
                                          
                                             b
                                             +
                                             1
                                             +
                                             i
                                          
                                       
                                       ⩾
                                       
                                          
                                             p
                                          
                                          
                                             
                                                
                                                   k
                                                
                                                
                                                   ′
                                                
                                             
                                          
                                       
                                       ⩾
                                       
                                          
                                             p
                                          
                                          
                                             3
                                             b
                                             -
                                             i
                                          
                                       
                                    
                                 . We can exchange job k with job 
                                    
                                       3
                                       b
                                       -
                                       i
                                    
                                  in 
                                    
                                       B
                                    
                                 , and update the departure time of each batch by the completion of each batch, without changing the number of batches, hence obtaining a new schedule 
                                    
                                       (
                                       
                                          
                                             σ
                                          
                                          
                                             ˆ
                                          
                                       
                                       ,
                                       
                                       
                                          
                                             B
                                          
                                          
                                             ^
                                          
                                       
                                       )
                                    
                                 . Again, 
                                    
                                       (
                                       
                                          
                                             σ
                                          
                                          
                                             ˆ
                                          
                                       
                                       ,
                                       
                                       
                                          
                                             B
                                          
                                          
                                             ^
                                          
                                       
                                       )
                                    
                                  is feasible. In fact, since 
                                    
                                       
                                          
                                             p
                                          
                                          
                                             b
                                             +
                                             1
                                             +
                                             i
                                          
                                       
                                       +
                                       
                                          
                                             p
                                          
                                          
                                             3
                                             b
                                             -
                                             i
                                          
                                       
                                       ⩽
                                       
                                          
                                             p
                                          
                                          
                                             b
                                             +
                                             1
                                             +
                                             i
                                          
                                       
                                       +
                                       
                                          
                                             p
                                          
                                          
                                             k
                                          
                                       
                                       ⩽
                                       T
                                       -
                                       
                                          
                                             ℓ
                                          
                                          
                                             2
                                          
                                       
                                    
                                 , the batch containing 
                                    
                                       b
                                       +
                                       1
                                       +
                                       i
                                    
                                  and 
                                    
                                       3
                                       b
                                       -
                                       i
                                    
                                  is on time. The batch containing k and 
                                    
                                       
                                          
                                             k
                                          
                                          
                                             ′
                                          
                                       
                                    
                                  is also on time, since 
                                    
                                       
                                          
                                             p
                                          
                                          
                                             
                                                
                                                   k
                                                
                                                
                                                   ′
                                                
                                             
                                          
                                       
                                       +
                                       
                                          
                                             p
                                          
                                          
                                             k
                                          
                                       
                                       ⩽
                                       
                                          
                                             p
                                          
                                          
                                             b
                                             +
                                             1
                                             +
                                             i
                                          
                                       
                                       +
                                       
                                          
                                             p
                                          
                                          
                                             k
                                          
                                       
                                       ⩽
                                       T
                                       -
                                       
                                          
                                             ℓ
                                          
                                          
                                             2
                                          
                                       
                                    
                                 . One can repeatedly apply the same argument until a schedule with the same number of batches is obtained that respects Property 2.□

According to Lemmas 2 and 3, we propose a greedy algorithm EX1 for the problem 
                              
                                 1
                                 |
                                 no
                                 -
                                 idle
                                 ,
                                 
                                    
                                       
                                          
                                             d
                                          
                                          
                                             ̃
                                          
                                       
                                    
                                    
                                       j
                                    
                                 
                                 =
                                 
                                    
                                       C
                                    
                                    
                                       j
                                    
                                 
                                 +
                                 T
                                 |
                                 
                                    
                                       V
                                    
                                    
                                       2
                                    
                                 
                                 (
                                 ∞
                                 ,
                                 3
                                 )
                                 |
                                 1
                                 |
                                 TC
                              
                           .
                              Theorem 6
                              
                                 Algorithm EX1 finds an optimal production–distribution schedule for problem 
                                 
                                    
                                       1
                                       |
                                       no
                                       -
                                       idle
                                       ,
                                       
                                          
                                             
                                                
                                                   d
                                                
                                                
                                                   ̃
                                                
                                             
                                          
                                          
                                             j
                                          
                                       
                                       =
                                       
                                          
                                             C
                                          
                                          
                                             j
                                          
                                       
                                       +
                                       T
                                       |
                                       
                                          
                                             V
                                          
                                          
                                             2
                                          
                                       
                                       (
                                       ∞
                                       ,
                                       3
                                       )
                                       |
                                       1
                                       |
                                       TC
                                    
                                  
                                 in 
                                 
                                    
                                       O
                                       (
                                       
                                          
                                             n
                                          
                                          
                                             2
                                          
                                       
                                       )
                                    
                                  
                                 time.
                              

In the algorithm EX1, the first step requires 
                                    
                                       O
                                       (
                                       n
                                       log
                                       n
                                       )
                                    
                                  time. The second and the fourth step require 
                                    
                                       O
                                       (
                                       1
                                       )
                                    
                                  time. The checking action in the third step requires 
                                    
                                       O
                                       (
                                       n
                                       )
                                    
                                  time and in the worst case we need to check 
                                    
                                       O
                                       (
                                       n
                                       )
                                    
                                  times. The assignment in the third step requires 
                                    
                                       O
                                       (
                                       1
                                       )
                                    
                                  time. So the algorithm EX1 finds an optimal schedule for problem 
                                    
                                       1
                                       |
                                       no
                                       -
                                       idle
                                       ,
                                       
                                          
                                             
                                                
                                                   d
                                                
                                                
                                                   ̃
                                                
                                             
                                          
                                          
                                             j
                                          
                                       
                                       =
                                       
                                          
                                             C
                                          
                                          
                                             j
                                          
                                       
                                       +
                                       T
                                       |
                                       (
                                       ∞
                                       ,
                                       3
                                       )
                                       |
                                       1
                                       |
                                       TC
                                    
                                  in 
                                    
                                       O
                                       (
                                       
                                          
                                             n
                                          
                                          
                                             2
                                          
                                       
                                       )
                                    
                                  time.□

Algorithm EX1
                                    
                                       
                                    
                                 
                              

Algorithm EX2
                                    
                                       
                                    
                                 
                              

We next propose a greedy algorithm EX2 for the problem 
                              
                                 1
                                 |
                                 no
                                 -
                                 idle
                                 ,
                                 
                                 
                                    
                                       
                                          
                                             d
                                          
                                          
                                             ̃
                                          
                                       
                                    
                                    
                                       j
                                    
                                 
                                 =
                                 
                                    
                                       C
                                    
                                    
                                       j
                                    
                                 
                                 +
                                 T
                                 |
                                 
                                    
                                       V
                                    
                                    
                                       2
                                    
                                 
                                 (
                                 ∞
                                 ,
                                 2
                                 )
                                 |
                                 1
                                 |
                                 TC
                              
                           . In this case, with a similar proof, the Property 1 of Lemma 3 holds for the problem with 
                              
                                 
                                    
                                       c
                                    
                                    
                                       2
                                    
                                 
                                 =
                                 2
                              
                           .
                              Theorem 7
                              
                                 Algorithm EX2 finds an optimal production–distribution schedule for problem 
                                 
                                    
                                       1
                                       |
                                       no
                                       -
                                       idle
                                       ,
                                       
                                          
                                             
                                                
                                                   d
                                                
                                                
                                                   ̃
                                                
                                             
                                          
                                          
                                             j
                                          
                                       
                                       =
                                       
                                          
                                             C
                                          
                                          
                                             j
                                          
                                       
                                       +
                                       T
                                       |
                                       
                                          
                                             V
                                          
                                          
                                             2
                                          
                                       
                                       (
                                       ∞
                                       ,
                                       2
                                       )
                                       |
                                       1
                                       |
                                       TC
                                    
                                  
                                 in 
                                 
                                    
                                       O
                                       (
                                       n
                                       log
                                       n
                                       )
                                    
                                  
                                 time.
                              

In the algorithm EX2, the first step requires 
                                    
                                       O
                                       (
                                       n
                                       log
                                       n
                                       )
                                    
                                  time. The second step requires 
                                    
                                       O
                                       (
                                       n
                                       )
                                    
                                 . and the forth step require 
                                    
                                       O
                                       (
                                       1
                                       )
                                    
                                  time. The check whether 
                                    
                                       
                                          
                                             p
                                          
                                          
                                             b
                                             +
                                             1
                                          
                                       
                                       ⩽
                                       T
                                       -
                                       
                                          
                                             ℓ
                                          
                                          
                                             2
                                          
                                       
                                    
                                  is done in constant time, and in the worst case we need to check it 
                                    
                                       O
                                       (
                                       n
                                       )
                                    
                                  times. As soon as 
                                    
                                       
                                          
                                             p
                                          
                                          
                                             b
                                             +
                                             1
                                          
                                       
                                       ⩽
                                       T
                                       -
                                       
                                          
                                             ℓ
                                          
                                          
                                             2
                                          
                                       
                                    
                                 , the computation of the rest of the delivery schedule can be done in 
                                    
                                       O
                                       (
                                       n
                                       )
                                    
                                 . So the algorithm EX2 finds an optimal schedule for problem 
                                    
                                       1
                                       |
                                       no
                                       -
                                       idle
                                       ,
                                       
                                          
                                             
                                                
                                                   d
                                                
                                                
                                                   ̃
                                                
                                             
                                          
                                          
                                             j
                                          
                                       
                                       =
                                       
                                          
                                             C
                                          
                                          
                                             j
                                          
                                       
                                       +
                                       T
                                       |
                                       (
                                       ∞
                                       ,
                                       2
                                       )
                                       |
                                       1
                                       |
                                       TC
                                    
                                  in 
                                    
                                       O
                                       (
                                       n
                                       log
                                       n
                                       )
                                    
                                  time.

Finally, for 
                              
                                 
                                    
                                       c
                                    
                                    
                                       2
                                    
                                 
                                 =
                                 1
                              
                           , the problem 
                              
                                 1
                                 |
                                 no
                                 -
                                 idle
                                 ,
                                 
                                    
                                       
                                          
                                             d
                                          
                                          
                                             ̃
                                          
                                       
                                    
                                    
                                       j
                                    
                                 
                                 =
                                 
                                    
                                       C
                                    
                                    
                                       j
                                    
                                 
                                 +
                                 T
                                 |
                                 
                                    
                                       V
                                    
                                    
                                       2
                                    
                                 
                                 (
                                 ∞
                                 ,
                                 1
                                 )
                                 |
                                 1
                                 |
                                 TC
                              
                           , is trivially solved in 
                              
                                 O
                                 (
                                 n
                                 )
                              
                            by randomly ordering the jobs on 
                              
                                 
                                    
                                       M
                                    
                                    
                                       1
                                    
                                 
                              
                           , and delivering each job by a different vehicle as soon as it is finished.

In Section 5.1.1 we considered only problems in which the 3PP has a sufficiently large number of vehicles for express transportation. Let us now consider the case in which there is only one vehicle which can carry only one job, i.e., problem 
                              
                                 1
                                 |
                                 no
                                 -
                                 idle
                                 ,
                                 
                                    
                                       
                                          
                                             d
                                          
                                          
                                             ̃
                                          
                                       
                                    
                                    
                                       j
                                    
                                 
                                 =
                                 
                                    
                                       C
                                    
                                    
                                       j
                                    
                                 
                                 +
                                 T
                                 |
                                 
                                    
                                       V
                                    
                                    
                                       2
                                    
                                 
                                 (
                                 1
                                 ,
                                 1
                                 )
                                 |
                                 1
                                 |
                                 TC
                              
                           . In this case, batches correspond indeed to jobs, and each roundtrip of the vehicle concerns the delivery of a single job, i.e. the transportation cost of any feasible solution is 
                              
                                 TC
                                 =
                                 
                                    
                                       h
                                    
                                    
                                       2
                                    
                                 
                                 n
                              
                           . Hence, the only issue is to check whether there exists a feasible production–distribution schedule.

A schedule for this problem has a very distinctive structure, in which we call offset 
                           
                              
                                 
                                    
                                       O
                                    
                                    
                                       j
                                    
                                 
                              
                            the difference between the departure time of the vehicle that carries away job j (equal to 
                              
                                 
                                    
                                       D
                                    
                                    
                                       j
                                    
                                 
                                 -
                                 
                                    
                                       ℓ
                                    
                                    
                                       2
                                    
                                 
                              
                           ) and the completion time 
                              
                                 
                                    
                                       C
                                    
                                    
                                       j
                                    
                                 
                              
                            of the same job on 
                              
                                 
                                    
                                       M
                                    
                                    
                                       1
                                    
                                 
                              
                           . Note that by definition the offset can never be negative. The offset is zero if a job is already completed on 
                              
                                 
                                    
                                       M
                                    
                                    
                                       1
                                    
                                 
                              
                            before (or exactly at) the time the vehicle is back in 
                              
                                 
                                    
                                       M
                                    
                                    
                                       1
                                    
                                 
                              
                           . It is easy to check that in general, if we let i be the job that immediately precedes j in a schedule:
                              
                                 (7)
                                 
                                    
                                       
                                          O
                                       
                                       
                                          j
                                       
                                    
                                    =
                                    
                                       max
                                    
                                    {
                                    0
                                    ,
                                    
                                       
                                          O
                                       
                                       
                                          i
                                       
                                    
                                    -
                                    
                                       
                                          p
                                       
                                       
                                          j
                                       
                                    
                                    +
                                    
                                       
                                          ℓ
                                       
                                       
                                          2
                                       
                                    
                                    +
                                    
                                       
                                          ℓ
                                       
                                       
                                          2
                                       
                                       
                                          ′
                                       
                                    
                                    }
                                    .
                                 
                              
                           Note that if 
                              
                                 
                                    
                                       p
                                    
                                    
                                       j
                                    
                                 
                                 >
                                 
                                    
                                       ℓ
                                    
                                    
                                       2
                                    
                                 
                                 +
                                 
                                    
                                       ℓ
                                    
                                    
                                       2
                                    
                                    
                                       ′
                                    
                                 
                              
                           , then the offset decreases (by 
                              
                                 
                                    
                                       ℓ
                                    
                                    
                                       2
                                    
                                 
                                 +
                                 
                                    
                                       ℓ
                                    
                                    
                                       2
                                    
                                    
                                       ′
                                    
                                 
                                 -
                                 
                                    
                                       p
                                    
                                    
                                       j
                                    
                                 
                              
                           ), while on the contrary, if 
                              
                                 
                                    
                                       p
                                    
                                    
                                       j
                                    
                                 
                                 <
                                 
                                    
                                       ℓ
                                    
                                    
                                       2
                                    
                                 
                                 +
                                 
                                    
                                       ℓ
                                    
                                    
                                       2
                                    
                                    
                                       ′
                                    
                                 
                              
                           , then the offset increases (by 
                              
                                 
                                    
                                       ℓ
                                    
                                    
                                       2
                                    
                                 
                                 +
                                 
                                    
                                       ℓ
                                    
                                    
                                       2
                                    
                                    
                                       ′
                                    
                                 
                                 -
                                 
                                    
                                       p
                                    
                                    
                                       j
                                    
                                 
                              
                           ). No job can be scheduled if the offset becomes larger than 
                              
                                 T
                                 -
                                 
                                    
                                       ℓ
                                    
                                    
                                       2
                                    
                                 
                              
                           , so in a feasible schedule all the offset values are below this value.

To establish the complexity of the problem, we use the following strongly NP-complete problem (Kellerer, Kotov, Rendl, & Woeginger, 1998):

Stock Size Problem (SSP). Given a set I of n nonzero integers 
                              
                                 
                                    
                                       a
                                    
                                    
                                       1
                                    
                                 
                                 ,
                                 …
                                 ,
                                 
                                    
                                       a
                                    
                                    
                                       n
                                    
                                 
                              
                           , and a positive integer Q such that 
                              
                                 
                                    
                                       ∑
                                    
                                    
                                       j
                                       ∈
                                       I
                                    
                                 
                                 
                                    
                                       a
                                    
                                    
                                       j
                                    
                                 
                                 =
                                 Q
                              
                           , is there an ordering 
                              
                                 σ
                              
                            of the n integers such that, denoting by 
                              
                                 σ
                                 (
                                 i
                                 )
                              
                            the i-th integer in the ordering, for all 
                              
                                 k
                                 =
                                 1
                                 ,
                                 …
                                 ,
                                 n
                              
                            it holds
                              
                                 (8)
                                 
                                    0
                                    ⩽
                                    
                                       
                                          
                                             ∑
                                          
                                          
                                             i
                                             =
                                             1
                                          
                                          
                                             k
                                          
                                       
                                    
                                    
                                       
                                          a
                                       
                                       
                                          σ
                                          (
                                          i
                                          )
                                       
                                    
                                    ⩽
                                    Q
                                    ?
                                 
                              
                           
                           
                              Theorem 8
                              
                                 The problem 
                                 
                                    
                                       1
                                       |
                                       no
                                       -
                                       idle
                                       ,
                                       
                                          
                                             
                                                
                                                   d
                                                
                                                
                                                   ̃
                                                
                                             
                                          
                                          
                                             j
                                          
                                       
                                       =
                                       
                                          
                                             C
                                          
                                          
                                             j
                                          
                                       
                                       +
                                       T
                                       |
                                       
                                          
                                             V
                                          
                                          
                                             2
                                          
                                       
                                       (
                                       1
                                       ,
                                       1
                                       )
                                       |
                                       1
                                       |
                                       TC
                                    
                                  
                                 is strongly NP-hard.
                              

We reduce SSP to our problem. Given an instance of SSP, we let 
                                    
                                       P
                                    
                                  and 
                                    
                                       N
                                    
                                  denote positive and negative integers in I respectively. We let 
                                    
                                       
                                          
                                             ℓ
                                          
                                          
                                             2
                                          
                                       
                                       =
                                       
                                          
                                             ℓ
                                          
                                          
                                             2
                                          
                                          
                                             ′
                                          
                                       
                                       =
                                       Q
                                       +
                                       1
                                    
                                  and 
                                    
                                       T
                                       =
                                       2
                                       Q
                                       +
                                       1
                                    
                                 . For each 
                                    
                                       
                                          
                                             a
                                          
                                          
                                             i
                                          
                                       
                                    
                                 , define a job i having processing time 
                                    
                                       
                                          
                                             p
                                          
                                          
                                             i
                                          
                                       
                                       =
                                       2
                                       
                                          
                                             ℓ
                                          
                                          
                                             2
                                          
                                       
                                       -
                                       
                                          
                                             a
                                          
                                          
                                             i
                                          
                                       
                                    
                                  (note that 
                                    
                                       
                                          
                                             p
                                          
                                          
                                             i
                                          
                                       
                                       <
                                       2
                                       
                                          
                                             ℓ
                                          
                                          
                                             2
                                          
                                       
                                    
                                  if 
                                    
                                       i
                                       ∈
                                       P
                                    
                                  and 
                                    
                                       
                                          
                                             p
                                          
                                          
                                             i
                                          
                                       
                                       >
                                       2
                                       
                                          
                                             ℓ
                                          
                                          
                                             2
                                          
                                       
                                    
                                  if 
                                    
                                       i
                                       ∈
                                       N
                                    
                                 ). We call 
                                    
                                       
                                          
                                             J
                                          
                                          
                                             P
                                          
                                       
                                    
                                  and 
                                    
                                       
                                          
                                             J
                                          
                                          
                                             N
                                          
                                       
                                    
                                  the job sets corresponding to 
                                    
                                       P
                                    
                                  and 
                                    
                                       N
                                    
                                  respectively. Finally, add a dummy job having 
                                    
                                       
                                          
                                             p
                                          
                                          
                                             0
                                          
                                       
                                       =
                                       ε
                                       >
                                       0
                                    
                                 , where 
                                    
                                       ε
                                    
                                  is very small. Note that a schedule is feasible iff the offset never exceeds 
                                    
                                       T
                                       -
                                       
                                          
                                             ℓ
                                          
                                          
                                             2
                                          
                                       
                                       =
                                       Q
                                    
                                 . We want to show that a feasible schedule exists iff a solution to SSP exists.

Given a solution to SSP, a feasible schedule can be built as follows. The first job is the dummy job, which has therefore to be carried away. We then sequence the jobs in the same order as in the solution to SSP. Each job 
                                    
                                       i
                                       ∈
                                       
                                          
                                             J
                                          
                                          
                                             P
                                          
                                       
                                    
                                  increases the offset by 
                                    
                                       
                                          
                                             a
                                          
                                          
                                             i
                                          
                                       
                                    
                                 , while each job 
                                    
                                       i
                                       ∈
                                       
                                          
                                             J
                                          
                                          
                                             N
                                          
                                       
                                    
                                  decreases it by 
                                    
                                       
                                          
                                             a
                                          
                                          
                                             i
                                          
                                       
                                    
                                 . After the k-th job, the value of the offset is precisely the value 
                                    
                                       
                                          
                                             ∑
                                          
                                          
                                             i
                                             =
                                             1
                                          
                                          
                                             k
                                          
                                       
                                       
                                          
                                             a
                                          
                                          
                                             σ
                                             (
                                             i
                                             )
                                          
                                       
                                    
                                 . From (8), for all k it does not exceed Q, and the sequence is therefore feasible.

Now viceversa, suppose that we have a feasible production–distribution schedule 
                                    
                                       (
                                       σ
                                       ,
                                       
                                       B
                                       )
                                    
                                 . First of all, the dummy job is certainly at the beginning of the schedule, and the initial offset is 
                                    
                                       
                                          
                                             O
                                          
                                          
                                             σ
                                             (
                                             0
                                             )
                                          
                                       
                                       =
                                       0
                                    
                                 . Consider now the n Eq. (7):
                                    
                                       
                                          
                                             
                                                
                                                
                                                   
                                                      
                                                         
                                                            O
                                                         
                                                         
                                                            σ
                                                            (
                                                            1
                                                            )
                                                         
                                                      
                                                      =
                                                      
                                                         max
                                                      
                                                      {
                                                      0
                                                      ,
                                                      2
                                                      
                                                         
                                                            ℓ
                                                         
                                                         
                                                            2
                                                         
                                                      
                                                      -
                                                      
                                                         
                                                            p
                                                         
                                                         
                                                            σ
                                                            (
                                                            1
                                                            )
                                                         
                                                      
                                                      }
                                                      =
                                                      
                                                         max
                                                      
                                                      {
                                                      0
                                                      ,
                                                      
                                                         
                                                            a
                                                         
                                                         
                                                            σ
                                                            (
                                                            1
                                                            )
                                                         
                                                      
                                                      }
                                                   
                                                
                                             
                                             
                                                
                                                
                                                   
                                                      
                                                         
                                                            O
                                                         
                                                         
                                                            σ
                                                            (
                                                            2
                                                            )
                                                         
                                                      
                                                      =
                                                      
                                                         max
                                                      
                                                      {
                                                      0
                                                      ,
                                                      
                                                         
                                                            O
                                                         
                                                         
                                                            σ
                                                            (
                                                            1
                                                            )
                                                         
                                                      
                                                      +
                                                      2
                                                      
                                                         
                                                            ℓ
                                                         
                                                         
                                                            2
                                                         
                                                      
                                                      -
                                                      
                                                         
                                                            p
                                                         
                                                         
                                                            σ
                                                            (
                                                            1
                                                            )
                                                         
                                                      
                                                      }
                                                      =
                                                      
                                                         max
                                                      
                                                      {
                                                      0
                                                      ,
                                                      
                                                         
                                                            O
                                                         
                                                         
                                                            σ
                                                            (
                                                            1
                                                            )
                                                         
                                                      
                                                      +
                                                      
                                                         
                                                            a
                                                         
                                                         
                                                            σ
                                                            (
                                                            2
                                                            )
                                                         
                                                      
                                                      }
                                                   
                                                
                                             
                                             
                                                
                                                
                                                   
                                                      
                                                         
                                                            O
                                                         
                                                         
                                                            σ
                                                            (
                                                            3
                                                            )
                                                         
                                                      
                                                      =
                                                      
                                                         max
                                                      
                                                      {
                                                      0
                                                      ,
                                                      
                                                         
                                                            O
                                                         
                                                         
                                                            σ
                                                            (
                                                            2
                                                            )
                                                         
                                                      
                                                      +
                                                      2
                                                      
                                                         
                                                            ℓ
                                                         
                                                         
                                                            2
                                                         
                                                      
                                                      -
                                                      
                                                         
                                                            p
                                                         
                                                         
                                                            σ
                                                            (
                                                            2
                                                            )
                                                         
                                                      
                                                      }
                                                      =
                                                      
                                                         max
                                                      
                                                      {
                                                      0
                                                      ,
                                                      
                                                         
                                                            O
                                                         
                                                         
                                                            σ
                                                            (
                                                            2
                                                            )
                                                         
                                                      
                                                      +
                                                      
                                                         
                                                            a
                                                         
                                                         
                                                            σ
                                                            (
                                                            3
                                                            )
                                                         
                                                      
                                                      }
                                                   
                                                
                                             
                                             
                                                
                                                
                                                   
                                                      …
                                                   
                                                
                                             
                                             
                                                
                                                
                                                   
                                                      
                                                         
                                                            O
                                                         
                                                         
                                                            σ
                                                            (
                                                            n
                                                            )
                                                         
                                                      
                                                      =
                                                      
                                                         max
                                                      
                                                      {
                                                      0
                                                      ,
                                                      
                                                         
                                                            O
                                                         
                                                         
                                                            σ
                                                            (
                                                            n
                                                            -
                                                            1
                                                            )
                                                         
                                                      
                                                      +
                                                      2
                                                      
                                                         
                                                            ℓ
                                                         
                                                         
                                                            2
                                                         
                                                      
                                                      -
                                                      
                                                         
                                                            p
                                                         
                                                         
                                                            σ
                                                            (
                                                            n
                                                            -
                                                            1
                                                            )
                                                         
                                                      
                                                      }
                                                      =
                                                      
                                                         max
                                                      
                                                      {
                                                      0
                                                      ,
                                                      
                                                         
                                                            O
                                                         
                                                         
                                                            σ
                                                            (
                                                            n
                                                            -
                                                            1
                                                            )
                                                         
                                                      
                                                      +
                                                      
                                                         
                                                            a
                                                         
                                                         
                                                            σ
                                                            (
                                                            n
                                                            )
                                                         
                                                      
                                                      }
                                                   
                                                
                                             
                                          
                                       
                                    
                                 Suppose that 
                                    
                                       
                                          
                                             O
                                          
                                          
                                             σ
                                             (
                                             i
                                             )
                                          
                                       
                                       +
                                       
                                          
                                             a
                                          
                                          
                                             σ
                                             (
                                             i
                                             +
                                             1
                                             )
                                          
                                       
                                       <
                                       0
                                    
                                  for some i, 
                                    
                                       0
                                       ⩽
                                       i
                                       ⩽
                                       n
                                       -
                                       1
                                    
                                 . Summing up all equations, one would get that the final offset 
                                    
                                       
                                          
                                             O
                                          
                                          
                                             σ
                                             (
                                             n
                                             )
                                          
                                       
                                       >
                                       
                                          
                                             ∑
                                          
                                          
                                             i
                                             =
                                             1
                                          
                                          
                                             n
                                          
                                       
                                       
                                          
                                             a
                                          
                                          
                                             σ
                                             (
                                             i
                                             )
                                          
                                       
                                       =
                                       Q
                                    
                                 , which would make it impossible to deliver 
                                    
                                       σ
                                       (
                                       n
                                       )
                                    
                                  within T. This would contradict the feasibility of (
                                    
                                       σ
                                       ,
                                       B
                                    
                                 ). Hence, 
                                    
                                       
                                          
                                             O
                                          
                                          
                                             σ
                                             (
                                             i
                                             )
                                          
                                       
                                       +
                                       
                                          
                                             a
                                          
                                          
                                             σ
                                             (
                                             i
                                             )
                                          
                                       
                                       ⩾
                                       0
                                    
                                  for all i. This implies that the vehicle is never idle throughout the schedule. As a consequence, the value of the offset after each job k is given precisely by 
                                    
                                       
                                          
                                             ∑
                                          
                                          
                                             i
                                             =
                                             1
                                          
                                          
                                             k
                                          
                                       
                                       
                                          
                                             a
                                          
                                          
                                             σ
                                             (
                                             i
                                             )
                                          
                                       
                                    
                                  which never exceeds Q, since 
                                    
                                       (
                                       σ
                                       ,
                                       B
                                       )
                                    
                                  is feasible. Hence, (8) is satisfied, i.e., the corresponding sequence of integers is feasible for SSP.□

The last problem we consider concerns the cases in which only regular transportation exists. We next show that the problem is difficult, even if the number of vehicles 
                           
                              
                                 
                                    v
                                 
                                 
                                    s
                                 
                              
                           
                         for each known fixed departure time 
                           
                              
                                 
                                    t
                                 
                                 
                                    s
                                 
                              
                           
                         is unlimited.
                           Theorem 9
                           
                              The problem 
                              
                                 
                                    1
                                    |
                                    no
                                    -
                                    idle
                                    ,
                                    
                                       
                                          
                                             
                                                d
                                             
                                             
                                                ̃
                                             
                                          
                                       
                                       
                                          j
                                       
                                    
                                    =
                                    
                                       
                                          C
                                       
                                       
                                          j
                                       
                                    
                                    +
                                    T
                                    |
                                    
                                       
                                          V
                                       
                                       
                                          1
                                       
                                    
                                    (
                                    ∞
                                    ,
                                    
                                       
                                          c
                                       
                                       
                                          1
                                       
                                    
                                    )
                                    |
                                    1
                                    |
                                    TC
                                 
                               
                              is strongly NP-hard, for any value of 
                              
                                 
                                    
                                       
                                          c
                                       
                                       
                                          1
                                       
                                    
                                 
                              
                              .
                           

Given an instance of 3-partition, define an instance of 3PP’s problem 
                                 
                                    1
                                    |
                                    no
                                    -
                                    idle
                                    ,
                                    
                                       
                                          
                                             
                                                d
                                             
                                             
                                                ̃
                                             
                                          
                                       
                                       
                                          j
                                       
                                    
                                    =
                                    
                                       
                                          C
                                       
                                       
                                          j
                                       
                                    
                                    +
                                    T
                                    |
                                    
                                       
                                          V
                                       
                                       
                                          1
                                       
                                    
                                    (
                                    ∞
                                    ,
                                    
                                       
                                          c
                                       
                                       
                                          1
                                       
                                    
                                    )
                                    |
                                    1
                                    |
                                    TC
                                 
                               as follows. There are 
                                 
                                    4
                                    n
                                 
                               jobs, namely n long jobs and 
                                 
                                    3
                                    n
                                 
                               
                              short jobs. The short jobs correspond to the integers of 3-partition, so 
                                 
                                    
                                       
                                          p
                                       
                                       
                                          i
                                       
                                    
                                    =
                                    
                                       
                                          a
                                       
                                       
                                          i
                                       
                                    
                                 
                               for 
                                 
                                    i
                                    =
                                    1
                                    ,
                                    …
                                    ,
                                    3
                                    n
                                 
                              . All long jobs have the same processing time 
                                 
                                    Q
                                    ≫
                                    W
                                 
                              . We let 
                                 
                                    T
                                    =
                                    Q
                                    +
                                    2
                                    w
                                 
                              , so the deadline of a job is 
                                 
                                    
                                       
                                          C
                                       
                                       
                                          j
                                       
                                    
                                    +
                                    T
                                    =
                                    
                                       
                                          C
                                       
                                       
                                          j
                                       
                                    
                                    +
                                    (
                                    Q
                                    +
                                    2
                                    W
                                    )
                                 
                              . There are n fixed departure times 
                                 
                                    Q
                                    +
                                    W
                                    ,
                                    2
                                    (
                                    Q
                                    +
                                    W
                                    )
                                    ,
                                    …
                                    ,
                                    n
                                    (
                                    Q
                                    +
                                    W
                                    )
                                 
                              . Transportation time is 
                                 
                                    
                                       
                                          ℓ
                                       
                                       
                                          1
                                       
                                    
                                    =
                                    Q
                                    +
                                    W
                                 
                              . For different values of capacity, we want to establish whether there is a feasible production–distribution schedule 
                                 
                                    σ
                                 
                               with a number of batches given by n (if 
                                 
                                    
                                       
                                          c
                                       
                                       
                                          1
                                       
                                    
                                    ⩾
                                    4
                                 
                              ), 
                                 
                                    2
                                    n
                                 
                               (if 
                                 
                                    
                                       
                                          c
                                       
                                       
                                          1
                                       
                                    
                                    =
                                    2
                                 
                               or 
                                 
                                    
                                       
                                          c
                                       
                                       
                                          1
                                       
                                    
                                    =
                                    3
                                 
                              ), or 
                                 
                                    4
                                    n
                                 
                               (if 
                                 
                                    
                                       
                                          c
                                       
                                       
                                          1
                                       
                                    
                                    =
                                    1
                                 
                              ).

Suppose that a solution 
                                 
                                    Σ
                                 
                               to 3-partition exists. Then we can build a production schedule (
                                 
                                    σ
                                    ,
                                    B
                                 
                              ) starting with a long job and in which long jobs and triples of small jobs alternate. For what concerns the delivery schedule:
                                 
                                    •
                                    
                                       
                                          
                                             
                                                
                                                   c
                                                
                                                
                                                   1
                                                
                                             
                                             ⩾
                                             4
                                          
                                       . In this case we define n batches, each consisting of one long job followed by the subsequent triple of 
                                          
                                             Σ
                                          
                                       . Doing so, the total processing time of each batch is exactly 
                                          
                                             Q
                                             +
                                             W
                                          
                                       , and each batch departs at its completion time, which is precisely one fixed departure time. Each long job is delivered exactly at its deadline.


                                       
                                          
                                             
                                                
                                                   c
                                                
                                                
                                                   1
                                                
                                             
                                             =
                                             2
                                          
                                        or 
                                          
                                             
                                                
                                                   c
                                                
                                                
                                                   1
                                                
                                             
                                             =
                                             3
                                          
                                       . In this case we define 
                                          
                                             2
                                             n
                                          
                                        batches, obtained by splitting in two each batch defined in the previous case. One has therefore that at each fixed departure time 
                                          
                                             i
                                             (
                                             Q
                                             +
                                             W
                                             )
                                          
                                       , 
                                          
                                             i
                                             =
                                             1
                                             ,
                                             …
                                             ,
                                             n
                                          
                                       , two vehicles start, each carrying two jobs (one vehicle will transport the long job and one small job, the other vehicle will transport the other two small jobs). Both batches are on time.


                                       
                                          
                                             
                                                
                                                   c
                                                
                                                
                                                   1
                                                
                                             
                                             =
                                             1
                                          
                                       . In this case we simply define one batch for each job, so that at each time 
                                          
                                             i
                                             (
                                             Q
                                             +
                                             W
                                             )
                                          
                                       , four vehicles depart from 
                                          
                                             
                                                
                                                   M
                                                
                                                
                                                   1
                                                
                                             
                                          
                                       .

In all cases, the obtained production–distribution schedule is a solution to the 3PP’s problem.

Now suppose that a feasible production–distribution schedule to 3PP exists. The following facts concerning the corresponding production schedule 
                                 
                                    (
                                    σ
                                    ,
                                    B
                                    )
                                 
                               hold, for any value of the capacity 
                                 
                                    
                                       
                                          c
                                       
                                       
                                          1
                                       
                                    
                                 
                              .

Fact 1. In 
                                 
                                    (
                                    σ
                                    ,
                                    
                                    B
                                    )
                                 
                              , exactly one long job is entirely processed between 
                                 
                                    (
                                    i
                                    -
                                    1
                                    )
                                    (
                                    Q
                                    +
                                    W
                                    )
                                 
                               and 
                                 
                                    i
                                    (
                                    Q
                                    +
                                    W
                                    )
                                 
                              , for 
                                 
                                    1
                                    ⩽
                                    i
                                    ⩽
                                    n
                                 
                              . In fact, if a long job starts before some 
                                 
                                    i
                                    (
                                    Q
                                    +
                                    W
                                    )
                                 
                               but ends after 
                                 
                                    i
                                    (
                                    Q
                                    +
                                    W
                                    )
                                 
                               for some i, it would be certainly delivered late, since it could not depart before 
                                 
                                    (
                                    i
                                    +
                                    1
                                    )
                                    (
                                    Q
                                    +
                                    W
                                    )
                                 
                              , and therefore the long job should wait more than W before leaving. With no loss of generality, we can therefore suppose that the long job starts exactly at 
                                 
                                    i
                                    (
                                    Q
                                    +
                                    W
                                    )
                                 
                              , for 
                                 
                                    0
                                    ⩽
                                    i
                                    ⩽
                                    n
                                    -
                                    1
                                 
                              .

Fact 2. In (
                                 
                                    σ
                                    ,
                                    B
                                 
                              ), each long job is followed by exactly three short jobs, and the total processing time of these three short jobs equals W. Suppose in fact that there exists a long job followed by a set of short jobs whose total processing time is not W. Then, there exists a long job j followed by short jobs whose total processing time exceeds W. As a consequence of Fact 1, the last of these short jobs, say k, cannot depart in the same batch of the long job j. But the next departure time is too far and job k could not be delivered within its deadline. So, the total processing time of these jobs is W, and since 
                                 
                                    W
                                    /
                                    4
                                    <
                                    
                                       
                                          a
                                       
                                       
                                          i
                                       
                                    
                                    <
                                    W
                                    /
                                    2
                                 
                              , there are exactly three short jobs after each long job.

In conclusion, the short jobs after each long job define a triple which constitutes a solution to 3-partition.□

In Theorem 9, we observe that in the instance of the 3PP’s problem for each case we consider the minimum number of vehicles. So this proof applies to the 3PP’s problem with limited number of vehicles for regular transportation. That means the 3PP’s problem with limited number of vehicles for regular transportation is also strongly NP-hard.

@&#CONCLUSION@&#

In this paper, we investigated a collection of models for production and interstage batch delivery scheduling problems in a supply chain, where a manufacturer processes a set of jobs in two production locations and a 3PP delivers the semi-finished products from the upstream production location to the downstream production location. We provide some polynomial time algorithms for the 3PP’s problem when the manufacturer dominates, where the 3PP’s problem is to determine an optimal delivery schedule minimizing transportation costs, while respecting the jobs release times and the deadline of each job imposed by the manufacturer. In particular, we consider several models with different transportation modes and transportation time. When the 3PP dominates, the 3PP’s problem is to determine an optimal production–distribution schedule minimizing transportation cost, while respecting the deadline of each job. We propose some polynomial time algorithms for 3PP’s problems when the 3PP dominates in some particular cases and demonstrate the NP-hardness for other 3PP’s problems when the 3PP dominates. Here we also consider several models with different transportation modes.

A number of important issues remain open. First, 3PP’s problems are open when the manufacturer dominates and the limited number of vehicles for express transportation is not fixed. Second, most of the 3PP’s problems with 3PP dominating, are shown to be intractable, which motivates the need to develop exact or approximate solution algorithms. Third, there is a need to study the model when the two players have the same negotiation power and cooperate. One objective is to determinate trade-off integrated schedules and evaluate the benefit of cooperation. Another objective is to propose mechanisms, which guide the two players to cooperate.

@&#REFERENCES@&#

