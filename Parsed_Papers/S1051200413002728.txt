@&#MAIN-TITLE@&#A pre-distortion based design method for digital audio graphic equalizer

@&#HIGHLIGHTS@&#


               
               
                  
                     
                        
                           
                           By new bilinear mapping, we give a modified design method for digital graphic EQ.


                        
                        
                           
                           The pre-distortion technique is used to obtain the accurate bandwidths.


                        
                        
                           
                           We calculate the best gain of each band based on an optimization technique.


                        
                     
                  
               
            

@&#KEYPHRASES@&#

Graphic equalizer

Digital filter

Pre-distortion

Nonlinear mapping

Digital audio

@&#ABSTRACT@&#


               
               
                  The traditional design method for digital audio graphic equalizer using infinite impulse response filters usually has some deficiencies, including center frequency shift, narrower bandwidth at high frequency and inaccurate gain. In this paper, an improved method based on the modified bilinear transformation is proposed to design a digital audio graphic equalizer. The new bilinear mapping can compensate the center frequency shift, and pre-distorting the quality factors and optimizing the gains can correct the bandwidth and gain of each sub-band respectively. Experimental results reveal that both center frequency and bandwidth of the proposed digital graphic equalizer are strictly equal to the desired ones, and the average gain error decreases at least 2 dB.
               
            

@&#INTRODUCTION@&#

The audio equalizer (EQ) is one of the most important audio effects and is widely used in many audio systems, such as broadcasting studio, sound console, audio workstation, sound recording, audio player, smart phone and mobile terminal [1–6]. By mainly changing the amplitude of audio signals in sub-bands, an EQ can emphasize or attenuate some frequency components, and thus render many special effects [7]. Most of the EQs can be divided into two basic types: parametric equalizer and graphic equalizer (GEQ). A parametric EQ usually has some adjustable parameters, including center frequency, bandwidth and gain, thus it is more flexible than a GEQ and can meet the professional application. Nevertheless, the parametric EQ is very difficult to operate for a lay person due to its complex configuration. As for the GEQ, the whole audio frequency band is divided into some sub-bands. Usually the number of sub-bands is 3, 5, 10, 15 or 31, and the gain of each sub-band is the only parameter which can be adjusted independently. Because the GEQ is simple and intuitive, it is widely used in many audio equipments, such as PDA, tablet PC, smart phone, MP3 player.

Though designing a perfect digital GEQ is a challenging task, a few valuable methods have still be given. A GEQ can be considered as a kind of filter bank, but it is special one. Due to the variable band width, computational complexity, algorithm delay and userʼs demand, the perfect reconstruction filter bank is scarcely ever used in designing a digital GEQ. Most of the design methods for a digital GEQ derive from the analog filter design techniques. In 1983, based on the Hurwitz polynomial properties, Greiner and Schoessow applied positive and real functions to design a GEQ [8]. In 1986, Bohn proposed the constant-Q GEQ, including design requirement and trade-offs of constant-Q circuitry [9]. Park designed a high-speed continuous-time CMOS analog adaptive equalizer [10] for equalization in the read channels of magnetic recording in 1998. The GEQ is implemented as the combination of several bandpass filters covering different frequency bands. The above-mentioned three methods are suitable for designing an analog prototype EQ. So far the design methods of digital equalizer are as follows. In 2005, Lee et al. proposed an adjusted-Q digital GEQ employing the opposite filters [11]. By gracefully increasing the Q-factor of the opposite filters with increasing gain, the inter-band interference can be reduced effectively in all frequency range. In 2006, Holters proposed a digital GEQ design method based on developed higher-order band shelving filters [12]. The amplitude deviation in the transitional region between two neighbor bands is very low by Holtersʼs method. In 2007, Gerdes et al designed battery powered three-band GEQ [13] and amplifier for portable MP3 player. In 2009, Cecchi and Stefania proposed an approach comprising the fixed and adaptive GEQ [14], and applied it to an automobile.

The infinite impulse response (IIR) filter is often employed to design the GEQ due to its low computational complexity and algorithm delay [15]. For an analog GEQ, the traditional design methods are good enough; but for a digital GEQ, they will result in an unexpected adjacent band interference and obvious deviations of center frequency, bandwidth and gain, especially in the sub-bands located in the high frequency region. To remedy these problems, an improved design method of the GEQ based on the modified bilinear transformation is proposed. This method combines the pre-distortion and optimization techniques to make the center frequencies and bandwidths of the GEQ equal to the desired ones, and its amplitude–frequency response is more accurate than the traditional design methods. As for the GEQ implementation, the program based on the proposed method is run on a personal computer, and the proper coefficients of GEQ are generated. These coefficients are then downloaded to a digital signal processor (DSP) to implement the audio equalization.

The paper is organized as follows: The traditional design method of digital GEQ is described in Section 2. The improved design method is proposed in Section 3. Some simulations are given in Section 4. Finally, some conclusions are drawn in Section 5.

The schematic diagram of a digital audio GEQ is shown in Fig. 1
                      
                     [5]. Without loss of generality, we only discuss the case of bandpass filter (BPF), because the result for bandstop filter (BSF) is similar [14]. In Fig. 1, the input signal is first separately filtered with the 
                        
                           
                              BPF
                           
                           
                              k
                           
                        
                     , 
                        k
                        =
                        1
                        ,
                        2
                        ,
                        …
                        ,
                        N
                     , then multiplied by the gain 
                        
                           
                              G
                           
                           
                              k
                           
                        
                     , 
                        k
                        =
                        1
                        ,
                        2
                        ,
                        …
                        ,
                        N
                     , and finally merged them as output signal.

In the Laplace domain (S-domain), the transfer function of the k-th constant-Q analog BPF is [9]
                     
                        
                           (1)
                           
                              
                                 
                                    H
                                 
                                 
                                    k
                                 
                              
                              (
                              s
                              )
                              =
                              
                                 
                                    
                                       
                                          
                                             Ω
                                          
                                          
                                             d
                                             k
                                          
                                       
                                       
                                          
                                             Q
                                          
                                          
                                             d
                                             k
                                          
                                       
                                    
                                    s
                                 
                                 
                                    
                                       
                                          s
                                       
                                       
                                          2
                                       
                                    
                                    +
                                    
                                       
                                          
                                             Ω
                                          
                                          
                                             d
                                             k
                                          
                                       
                                       
                                          
                                             Q
                                          
                                          
                                             d
                                             k
                                          
                                       
                                    
                                    s
                                    +
                                    
                                       
                                          Ω
                                       
                                       
                                          d
                                          k
                                       
                                       
                                          2
                                       
                                    
                                 
                              
                              ,
                              
                              k
                              =
                              1
                              ,
                              2
                              ,
                              …
                              ,
                              N
                           
                        
                      where 
                        
                           
                              Ω
                           
                           
                              d
                              k
                           
                        
                      is the desired analog center angular frequency of the k-th BPF, 
                        
                           
                              Q
                           
                           
                              d
                              k
                           
                        
                      is the desired quality factor of the k-th BPF, defined by the ratio of filterʼs center frequency and bandwidth.

When the bilinear mapping rule from S-domain to Z-domain is applied in Eq. (1) 
                     [14], i.e. s is replaced with the following equation
                        
                           (2)
                           
                              s
                              =
                              
                                 2
                                 
                                    
                                       T
                                    
                                    
                                       s
                                    
                                 
                              
                              
                                 
                                    1
                                    −
                                    
                                       
                                          z
                                       
                                       
                                          −
                                          1
                                       
                                    
                                 
                                 
                                    1
                                    +
                                    
                                       
                                          z
                                       
                                       
                                          −
                                          1
                                       
                                    
                                 
                              
                           
                        
                      where 
                        
                           
                              T
                           
                           
                              s
                           
                        
                      is the sampling interval, the transfer function of the corresponding digital BPF in the Z-domain is
                        
                           (3)
                           
                              
                                 
                                    H
                                 
                                 
                                    k
                                 
                              
                              (
                              z
                              )
                              =
                              
                                 
                                    2
                                    
                                       
                                          Ω
                                       
                                       
                                          d
                                          k
                                       
                                    
                                    
                                       
                                          T
                                       
                                       
                                          s
                                       
                                    
                                    (
                                    1
                                    −
                                    
                                       
                                          z
                                       
                                       
                                          −
                                          2
                                       
                                    
                                    )
                                 
                                 
                                    [
                                    4
                                    
                                       
                                          Q
                                       
                                       
                                          d
                                          k
                                       
                                    
                                    +
                                    2
                                    
                                       
                                          Ω
                                       
                                       
                                          d
                                          k
                                       
                                    
                                    
                                       
                                          T
                                       
                                       
                                          s
                                       
                                    
                                    +
                                    
                                       
                                          Q
                                       
                                       
                                          d
                                          k
                                       
                                    
                                    
                                       
                                          (
                                          
                                             
                                                Ω
                                             
                                             
                                                d
                                                k
                                             
                                          
                                          
                                             
                                                T
                                             
                                             
                                                s
                                             
                                          
                                          )
                                       
                                       
                                          2
                                       
                                    
                                    ]
                                    +
                                    [
                                    2
                                    
                                       
                                          (
                                          
                                             
                                                Ω
                                             
                                             
                                                d
                                                k
                                             
                                          
                                          
                                             
                                                T
                                             
                                             
                                                s
                                             
                                          
                                          )
                                       
                                       
                                          2
                                       
                                    
                                    −
                                    8
                                    ]
                                    
                                       
                                          Q
                                       
                                       
                                          d
                                          k
                                       
                                    
                                    
                                       
                                          z
                                       
                                       
                                          −
                                          1
                                       
                                    
                                    +
                                    [
                                    4
                                    
                                       
                                          Q
                                       
                                       
                                          d
                                          k
                                       
                                    
                                    −
                                    2
                                    
                                       
                                          Ω
                                       
                                       
                                          d
                                          k
                                       
                                    
                                    
                                       
                                          T
                                       
                                       
                                          s
                                       
                                    
                                    +
                                    
                                       
                                          (
                                          
                                             
                                                Ω
                                             
                                             
                                                d
                                                k
                                             
                                          
                                          
                                             
                                                T
                                             
                                             
                                                s
                                             
                                          
                                          )
                                       
                                       
                                          2
                                       
                                    
                                    ]
                                    
                                       
                                          Q
                                       
                                       
                                          d
                                          k
                                       
                                    
                                    
                                       
                                          z
                                       
                                       
                                          −
                                          2
                                       
                                    
                                 
                              
                           
                        
                      The overall transfer function of the GEQ is the sum of these 
                        
                           
                              H
                           
                           
                              k
                           
                        
                        (
                        z
                        )
                     
                     
                        
                           (4)
                           
                              H
                              (
                              z
                              )
                              =
                              
                                 ∑
                                 
                                    k
                                    =
                                    1
                                 
                                 N
                              
                              
                                 [
                                 
                                    
                                       G
                                    
                                    
                                       d
                                       k
                                    
                                 
                                 
                                    
                                       H
                                    
                                    
                                       k
                                    
                                 
                                 (
                                 z
                                 )
                                 ]
                              
                           
                        
                      Eqs. (3) and (4) are the traditional design method for a digital GEQ.

A 10-segment digital GEQ is designed as an example. The design parameters are chosen as shown in Table 1
                     .

The amplitude–frequency responses of analog BPFs and corresponding digital BPFs are shown in Fig. 2
                     , and the overall amplitude–frequency responses of analog GEQ, digital GEQ and desired GEQ are shown in Fig. 3
                     . In Fig. 2 and Fig. 3, the side-effect of the design method based on bilinear mapping is obvious, especially in the high frequency region, the center frequency and bandwidth shift from its expected value. Moreover, the amplitude–frequency response of the digital GEQ seriously deviates from its expected value (5 dB) in Fig. 3. To overcome these drawbacks, a more efficient design method for the digital GEQ is expected.

In the improved method, a modified mapping rule is introduced to make the digital center frequency correspond to the analog center frequency strictly, then the bandwidth of digital GEQ is adjusted by pre-distortion technique, and finally optimization technique is used to find out the best gain of each digital BPF.

The bilinear mapping used in Section 2 is nonlinear [15], which makes the center frequency shift and bandwidth gradually become narrow. An intuitive solution to remedy the side-effect is to apply different mapping rules for different BPFs.

The new mapping rule from S-domain to Z-domain for k-th BPFs is defined as
                           
                              (5)
                              
                                 s
                                 =
                                 
                                    
                                       c
                                    
                                    
                                       k
                                    
                                 
                                 
                                    
                                       1
                                       −
                                       
                                          
                                             z
                                          
                                          
                                             −
                                             1
                                          
                                       
                                    
                                    
                                       1
                                       +
                                       
                                          
                                             z
                                          
                                          
                                             −
                                             1
                                          
                                       
                                    
                                 
                              
                           
                        
                     

In order to make the digital center frequency 
                           
                              
                                 ω
                              
                              
                                 d
                                 k
                              
                           
                         correspond to the analog center frequency 
                           
                              
                                 Ω
                              
                              
                                 d
                                 k
                              
                           
                         strictly, 
                           s
                           =
                           j
                           
                              
                                 Ω
                              
                              
                                 d
                                 k
                              
                           
                         and 
                           z
                           =
                           
                              
                                 e
                              
                              
                                 j
                                 
                                    
                                       ω
                                    
                                    
                                       d
                                       k
                                    
                                 
                              
                           
                         are substituted into Eq. (5), i.e.
                           
                              (6)
                              
                                 j
                                 
                                    
                                       Ω
                                    
                                    
                                       d
                                       k
                                    
                                 
                                 =
                                 
                                    
                                       c
                                    
                                    
                                       k
                                    
                                 
                                 
                                    
                                       1
                                       −
                                       
                                          
                                             e
                                          
                                          
                                             −
                                             j
                                             
                                                
                                                   ω
                                                
                                                
                                                   d
                                                   k
                                                
                                             
                                          
                                       
                                    
                                    
                                       1
                                       +
                                       
                                          
                                             e
                                          
                                          
                                             −
                                             j
                                             
                                                
                                                   ω
                                                
                                                
                                                   d
                                                   k
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           
                         The parameter 
                           
                              
                                 c
                              
                              
                                 k
                              
                           
                         can be easily calculated as
                           
                              (7)
                              
                                 
                                    
                                       c
                                    
                                    
                                       k
                                    
                                 
                                 =
                                 
                                    
                                       
                                          Ω
                                       
                                       
                                          d
                                          k
                                       
                                    
                                    
                                       tan
                                       
                                          
                                             
                                                ω
                                             
                                             
                                                d
                                                k
                                             
                                          
                                          2
                                       
                                    
                                 
                                 =
                                 
                                    
                                       
                                          Ω
                                       
                                       
                                          d
                                          k
                                       
                                    
                                    
                                       tan
                                       
                                          
                                             
                                                
                                                   Ω
                                                
                                                
                                                   d
                                                   k
                                                
                                             
                                             
                                                
                                                   T
                                                
                                                
                                                   s
                                                
                                             
                                          
                                          2
                                       
                                    
                                 
                              
                           
                         Substituting Eq. (7) into Eq. (5), we obtain the new mapping rule
                           
                              (8)
                              
                                 s
                                 =
                                 
                                    
                                       
                                          Ω
                                       
                                       
                                          d
                                          k
                                       
                                    
                                    
                                       tan
                                       
                                          
                                             
                                                
                                                   Ω
                                                
                                                
                                                   d
                                                   k
                                                
                                             
                                             
                                                
                                                   T
                                                
                                                
                                                   s
                                                
                                             
                                          
                                          2
                                       
                                    
                                 
                                 
                                    
                                       1
                                       −
                                       
                                          
                                             z
                                          
                                          
                                             −
                                             1
                                          
                                       
                                    
                                    
                                       1
                                       +
                                       
                                          
                                             z
                                          
                                          
                                             −
                                             1
                                          
                                       
                                    
                                 
                              
                           
                         The relationship between digital frequency ω and analog frequency Ω is
                           
                              (9)
                              
                                 Ω
                                 =
                                 
                                    
                                       
                                          Ω
                                       
                                       
                                          d
                                          k
                                       
                                    
                                    
                                       tan
                                       
                                          
                                             
                                                
                                                   Ω
                                                
                                                
                                                   d
                                                   k
                                                
                                             
                                             
                                                
                                                   T
                                                
                                                
                                                   s
                                                
                                             
                                          
                                          2
                                       
                                    
                                 
                                 tan
                                 
                                    ω
                                    2
                                 
                              
                           
                         Thus substituting Eq. (8) into Eq. (1), the transfer function 
                           
                              
                                 H
                              
                              
                                 k
                              
                              
                                 ′
                              
                           
                           (
                           z
                           )
                         of the improved digital BPF can be written as
                           
                              (10)
                              
                                 
                                    
                                       H
                                    
                                    
                                       k
                                    
                                    
                                       ′
                                    
                                 
                                 (
                                 z
                                 )
                                 =
                                 
                                    
                                       sin
                                       
                                          
                                             Ω
                                          
                                          
                                             d
                                             k
                                          
                                       
                                       
                                          
                                             T
                                          
                                          
                                             s
                                          
                                       
                                       (
                                       1
                                       −
                                       
                                          
                                             z
                                          
                                          
                                             −
                                             2
                                          
                                       
                                       )
                                    
                                    
                                       (
                                       2
                                       
                                          
                                             Q
                                          
                                          
                                             d
                                             k
                                          
                                       
                                       +
                                       sin
                                       
                                          
                                             Ω
                                          
                                          
                                             d
                                             k
                                          
                                       
                                       
                                          
                                             T
                                          
                                          
                                             s
                                          
                                       
                                       )
                                       −
                                       (
                                       4
                                       
                                          
                                             Q
                                          
                                          
                                             d
                                             k
                                          
                                       
                                       cos
                                       
                                          
                                             Ω
                                          
                                          
                                             d
                                             k
                                          
                                       
                                       
                                          
                                             T
                                          
                                          
                                             s
                                          
                                       
                                       )
                                       
                                          
                                             z
                                          
                                          
                                             −
                                             1
                                          
                                       
                                       +
                                       (
                                       2
                                       
                                          
                                             Q
                                          
                                          
                                             d
                                             k
                                          
                                       
                                       −
                                       sin
                                       
                                          
                                             Ω
                                          
                                          
                                             d
                                             k
                                          
                                       
                                       
                                          
                                             T
                                          
                                          
                                             s
                                          
                                       
                                       )
                                       
                                          
                                             z
                                          
                                          
                                             −
                                             2
                                          
                                       
                                    
                                 
                              
                           
                        
                     

The bandwidth change is usually solved by the simple frequency pre-distorted technique [16]. But it is easily proved in theoretically that it is not suitable for the GEQ, because it undermines the rule that the center frequency of constant-Q BPF is the geometric center of the upper- and lower-bound frequencies, which is shown in Appendix A. In this paper, instead of frequency pre-distortion, we deal with the problem by pre-distorting 
                           
                              
                                 Q
                              
                              
                                 d
                                 k
                              
                           
                        . Assume that 
                           
                              
                                 Q
                              
                              
                                 k
                              
                           
                         is the best quality factor of the k-th BPF after pre-distorting 
                           
                              
                                 Q
                              
                              
                                 d
                                 k
                              
                           
                        , 
                           
                              
                                 Ω
                              
                              
                                 d
                                 k
                                 H
                              
                           
                         and 
                           
                              
                                 Ω
                              
                              
                                 d
                                 k
                                 L
                              
                           
                         are the analog upper- and lower-cutoff angular frequencies of the k-th BPF respectively. From Eq. (1), we have
                           
                              (11)
                              
                                 
                                    
                                       Ω
                                    
                                    
                                       d
                                       k
                                       H
                                    
                                 
                                 =
                                 
                                    
                                       
                                          
                                             Ω
                                          
                                          
                                             d
                                             k
                                          
                                       
                                       +
                                       
                                          
                                             
                                                
                                                   Ω
                                                
                                                
                                                   d
                                                   k
                                                
                                                
                                                   2
                                                
                                             
                                             +
                                             4
                                             
                                                
                                                   Q
                                                
                                                
                                                   d
                                                   k
                                                
                                                
                                                   2
                                                
                                             
                                             
                                                
                                                   Ω
                                                
                                                
                                                   d
                                                   k
                                                
                                                
                                                   2
                                                
                                             
                                          
                                       
                                    
                                    
                                       2
                                       
                                          
                                             Q
                                          
                                          
                                             d
                                             k
                                          
                                       
                                    
                                 
                              
                           
                        
                        
                           
                              (12)
                              
                                 
                                    
                                       Ω
                                    
                                    
                                       d
                                       k
                                       L
                                    
                                 
                                 =
                                 
                                    
                                       −
                                       
                                          
                                             Ω
                                          
                                          
                                             d
                                             k
                                          
                                       
                                       +
                                       
                                          
                                             
                                                
                                                   Ω
                                                
                                                
                                                   d
                                                   k
                                                
                                                
                                                   2
                                                
                                             
                                             +
                                             4
                                             
                                                
                                                   Q
                                                
                                                
                                                   d
                                                   k
                                                
                                                
                                                   2
                                                
                                             
                                             
                                                
                                                   Ω
                                                
                                                
                                                   d
                                                   k
                                                
                                                
                                                   2
                                                
                                             
                                          
                                       
                                    
                                    
                                       2
                                       
                                          
                                             Q
                                          
                                          
                                             d
                                             k
                                          
                                       
                                    
                                 
                              
                           
                         Thus the bandwidth of the k-th analog BPF is
                           
                              (13)
                              
                                 
                                    
                                       Ω
                                    
                                    
                                       d
                                       k
                                       H
                                    
                                 
                                 −
                                 
                                    
                                       Ω
                                    
                                    
                                       d
                                       k
                                       L
                                    
                                 
                                 =
                                 
                                    
                                       
                                          Ω
                                       
                                       
                                          d
                                          k
                                       
                                    
                                    
                                       
                                          Q
                                       
                                       
                                          d
                                          k
                                       
                                    
                                 
                              
                           
                        
                     

In order to keep the bandwidth of the k-th digital BPF equal to the one of its corresponding analog version, the 
                           
                              
                                 Q
                              
                              
                                 d
                                 k
                              
                           
                         should be pre-distorted as 
                           
                              
                                 Q
                              
                              
                                 k
                              
                           
                        . Thus the 
                           
                              
                                 Ω
                              
                              
                                 d
                                 k
                                 H
                              
                           
                         and 
                           
                              
                                 Ω
                              
                              
                                 d
                                 k
                                 L
                              
                           
                         are changed to 
                           
                              
                                 Ω
                              
                              
                                 k
                                 H
                              
                           
                         and 
                           
                              
                                 Ω
                              
                              
                                 k
                                 L
                              
                           
                         respectively, i.e.
                           
                              (14)
                              
                                 
                                    
                                       Ω
                                    
                                    
                                       k
                                       H
                                    
                                 
                                 =
                                 
                                    
                                       
                                          
                                             Ω
                                          
                                          
                                             d
                                             k
                                          
                                       
                                       +
                                       
                                          
                                             
                                                
                                                   Ω
                                                
                                                
                                                   d
                                                   k
                                                
                                                
                                                   2
                                                
                                             
                                             +
                                             4
                                             
                                                
                                                   Q
                                                
                                                
                                                   k
                                                
                                                
                                                   2
                                                
                                             
                                             
                                                
                                                   Ω
                                                
                                                
                                                   d
                                                   k
                                                
                                                
                                                   2
                                                
                                             
                                          
                                       
                                    
                                    
                                       2
                                       
                                          
                                             Q
                                          
                                          
                                             k
                                          
                                       
                                    
                                 
                              
                           
                        
                        
                           
                              (15)
                              
                                 
                                    
                                       Ω
                                    
                                    
                                       k
                                       L
                                    
                                 
                                 =
                                 
                                    
                                       −
                                       
                                          
                                             Ω
                                          
                                          
                                             d
                                             k
                                          
                                       
                                       +
                                       
                                          
                                             
                                                
                                                   Ω
                                                
                                                
                                                   d
                                                   k
                                                
                                                
                                                   2
                                                
                                             
                                             +
                                             4
                                             
                                                
                                                   Q
                                                
                                                
                                                   k
                                                
                                                
                                                   2
                                                
                                             
                                             
                                                
                                                   Ω
                                                
                                                
                                                   d
                                                   k
                                                
                                                
                                                   2
                                                
                                             
                                          
                                       
                                    
                                    
                                       2
                                       
                                          
                                             Q
                                          
                                          
                                             k
                                          
                                       
                                    
                                 
                              
                           
                        
                     

From the frequency mapping rule in Eq. (9), we can obtain the corresponding digital upper cutoff angular frequency 
                           
                              
                                 ω
                              
                              
                                 k
                                 H
                              
                           
                         and lower cutoff angular frequency 
                           
                              
                                 ω
                              
                              
                                 k
                                 L
                              
                           
                         as follows
                           
                              (16)
                              
                                 
                                    
                                       ω
                                    
                                    
                                       k
                                       H
                                    
                                 
                                 =
                                 2
                                 arctan
                                 
                                    
                                       
                                          
                                             Ω
                                          
                                          
                                             k
                                             H
                                          
                                       
                                       tan
                                       
                                          
                                             
                                                ω
                                             
                                             
                                                d
                                                k
                                             
                                          
                                          2
                                       
                                    
                                    
                                       
                                          Ω
                                       
                                       
                                          d
                                          k
                                       
                                    
                                 
                                 =
                                 2
                                 arctan
                                 
                                    
                                       (
                                       1
                                       +
                                       
                                          
                                             1
                                             +
                                             4
                                             
                                                
                                                   Q
                                                
                                                
                                                   k
                                                
                                                
                                                   2
                                                
                                             
                                          
                                       
                                       )
                                       tan
                                       
                                          
                                             
                                                ω
                                             
                                             
                                                d
                                                k
                                             
                                          
                                          2
                                       
                                    
                                    
                                       2
                                       
                                          
                                             Q
                                          
                                          
                                             k
                                          
                                       
                                    
                                 
                              
                           
                        
                        
                           
                              (17)
                              
                                 
                                    
                                       ω
                                    
                                    
                                       k
                                       L
                                    
                                 
                                 =
                                 2
                                 arctan
                                 
                                    
                                       
                                          
                                             Ω
                                          
                                          
                                             k
                                             L
                                          
                                       
                                       tan
                                       
                                          
                                             
                                                ω
                                             
                                             
                                                d
                                                k
                                             
                                          
                                          2
                                       
                                    
                                    
                                       
                                          Ω
                                       
                                       
                                          d
                                          k
                                       
                                    
                                 
                                 =
                                 2
                                 arctan
                                 
                                    
                                       (
                                       −
                                       1
                                       +
                                       
                                          
                                             1
                                             +
                                             4
                                             
                                                
                                                   Q
                                                
                                                
                                                   k
                                                
                                                
                                                   2
                                                
                                             
                                          
                                       
                                       )
                                       tan
                                       
                                          
                                             
                                                ω
                                             
                                             
                                                d
                                                k
                                             
                                          
                                          2
                                       
                                    
                                    
                                       2
                                       
                                          
                                             Q
                                          
                                          
                                             k
                                          
                                       
                                    
                                 
                              
                           
                         where 
                           arctan
                           (
                           ⋅
                           )
                         is the inverse tangent function. From Eqs. (16) and (17) the bandwidth of the k-th digital BPF is
                           
                              (18)
                              
                                 
                                    
                                       ω
                                    
                                    
                                       k
                                       H
                                    
                                 
                                 −
                                 
                                    
                                       ω
                                    
                                    
                                       k
                                       L
                                    
                                 
                                 =
                                 2
                                 arctan
                                 
                                    
                                       sin
                                       
                                          
                                             ω
                                          
                                          
                                             d
                                             k
                                          
                                       
                                    
                                    
                                       2
                                       
                                          
                                             Q
                                          
                                          
                                             k
                                          
                                       
                                    
                                 
                              
                           
                        
                     

Letting the bandwidth of the digital BPF equal to its desired one, from Eqs. (13) and (18), we have
                           
                              (19)
                              
                                 
                                    
                                       ω
                                    
                                    
                                       k
                                       H
                                    
                                 
                                 −
                                 
                                    
                                       ω
                                    
                                    
                                       k
                                       L
                                    
                                 
                                 =
                                 2
                                 arctan
                                 
                                    (
                                    
                                       
                                          sin
                                          
                                             
                                                ω
                                             
                                             
                                                d
                                                k
                                             
                                          
                                       
                                       
                                          2
                                          
                                             
                                                Q
                                             
                                             
                                                k
                                             
                                          
                                       
                                    
                                    )
                                 
                                 =
                                 
                                    
                                       
                                          
                                             Ω
                                          
                                          
                                             d
                                             k
                                          
                                       
                                       
                                          
                                             T
                                          
                                          
                                             s
                                          
                                       
                                    
                                    
                                       
                                          Q
                                       
                                       
                                          d
                                          k
                                       
                                    
                                 
                                 =
                                 
                                    
                                       
                                          ω
                                       
                                       
                                          d
                                          k
                                       
                                    
                                    
                                       
                                          Q
                                       
                                       
                                          d
                                          k
                                       
                                    
                                 
                              
                           
                         The explicit expression of 
                           
                              
                                 Q
                              
                              
                                 k
                              
                           
                         is
                           
                              (20)
                              
                                 
                                    
                                       Q
                                    
                                    
                                       k
                                    
                                 
                                 =
                                 
                                    
                                       sin
                                       
                                          
                                             ω
                                          
                                          
                                             d
                                             k
                                          
                                       
                                    
                                    
                                       2
                                       tan
                                       
                                          
                                             
                                                ω
                                             
                                             
                                                d
                                                k
                                             
                                          
                                          
                                             2
                                             
                                                
                                                   Q
                                                
                                                
                                                   d
                                                   k
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           
                        
                     

Substituting Eq. (20) into Eq. (10), we can further write 
                           
                              
                                 H
                              
                              
                                 k
                              
                              
                                 ′
                              
                           
                           (
                           z
                           )
                         as
                           
                              (21)
                              
                                 
                                    
                                       H
                                    
                                    
                                       k
                                    
                                    
                                       ′
                                    
                                 
                                 (
                                 z
                                 )
                                 =
                                 
                                    
                                       sin
                                       
                                          
                                             ω
                                          
                                          
                                             d
                                             k
                                          
                                       
                                       (
                                       1
                                       −
                                       
                                          
                                             z
                                          
                                          
                                             −
                                             2
                                          
                                       
                                       )
                                    
                                    
                                       (
                                       2
                                       
                                          
                                             Q
                                          
                                          
                                             k
                                          
                                       
                                       +
                                       sin
                                       
                                          
                                             ω
                                          
                                          
                                             d
                                             k
                                          
                                       
                                       )
                                       −
                                       4
                                       
                                          
                                             Q
                                          
                                          
                                             k
                                          
                                       
                                       cos
                                       
                                          
                                             ω
                                          
                                          
                                             d
                                             k
                                          
                                       
                                       
                                          
                                             z
                                          
                                          
                                             −
                                             1
                                          
                                       
                                       +
                                       (
                                       2
                                       
                                          
                                             Q
                                          
                                          
                                             k
                                          
                                       
                                       −
                                       sin
                                       
                                          
                                             ω
                                          
                                          
                                             d
                                             k
                                          
                                       
                                       )
                                       
                                          
                                             z
                                          
                                          
                                             −
                                             2
                                          
                                       
                                    
                                 
                              
                           
                        
                     

A second-order BPF usually has a relative wide transition band, which results in the adjacent band aliasing. Therefore, the amplitude–frequency response of the GEQ will shift certainly. From Eq. (4), we know that any sub-band will be inevitably affected by the others in an N-band GEQ. In order to keep the alteration of the overall amplitude–frequency response as small as possible, the gain 
                           
                              
                                 G
                              
                              
                                 d
                                 k
                              
                           
                         should be pre-distorted as 
                           
                              
                                 G
                              
                              
                                 k
                              
                           
                        , i.e. 
                           
                              
                                 G
                              
                              
                                 d
                                 k
                              
                           
                         and 
                           
                              
                                 G
                              
                              
                                 k
                              
                           
                         should satisfy the following equation set.
                           
                              (22)
                              
                                 
                                    {
                                    
                                       
                                          
                                             |
                                             
                                                
                                                   ∑
                                                
                                                
                                                   k
                                                   =
                                                   1
                                                
                                                
                                                   N
                                                
                                             
                                             
                                                
                                                   G
                                                
                                                
                                                   k
                                                
                                             
                                             ⋅
                                             
                                                
                                                   H
                                                
                                                
                                                   k
                                                
                                                
                                                   ′
                                                
                                             
                                             (
                                             
                                                
                                                   e
                                                
                                                
                                                   j
                                                   
                                                      
                                                         ω
                                                      
                                                      
                                                         1
                                                      
                                                   
                                                
                                             
                                             )
                                             |
                                             =
                                             
                                                
                                                   G
                                                
                                                
                                                   d
                                                   1
                                                
                                             
                                          
                                       
                                       
                                          
                                             |
                                             
                                                
                                                   ∑
                                                
                                                
                                                   k
                                                   =
                                                   1
                                                
                                                
                                                   N
                                                
                                             
                                             
                                                
                                                   G
                                                
                                                
                                                   k
                                                
                                             
                                             ⋅
                                             
                                                
                                                   H
                                                
                                                
                                                   k
                                                
                                                
                                                   ′
                                                
                                             
                                             (
                                             
                                                
                                                   e
                                                
                                                
                                                   j
                                                   
                                                      
                                                         ω
                                                      
                                                      
                                                         2
                                                      
                                                   
                                                
                                             
                                             )
                                             |
                                             =
                                             
                                                
                                                   G
                                                
                                                
                                                   d
                                                   2
                                                
                                             
                                          
                                       
                                       
                                          
                                             
                                             ⋮
                                          
                                       
                                       
                                          
                                             |
                                             
                                                
                                                   ∑
                                                
                                                
                                                   k
                                                   =
                                                   1
                                                
                                                
                                                   N
                                                
                                             
                                             
                                                
                                                   G
                                                
                                                
                                                   k
                                                
                                             
                                             ⋅
                                             
                                                
                                                   H
                                                
                                                
                                                   k
                                                
                                                
                                                   ′
                                                
                                             
                                             (
                                             
                                                
                                                   e
                                                
                                                
                                                   j
                                                   
                                                      
                                                         ω
                                                      
                                                      
                                                         N
                                                      
                                                   
                                                
                                             
                                             )
                                             |
                                             =
                                             
                                                
                                                   G
                                                
                                                
                                                   d
                                                   N
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           
                         where 
                           
                              
                                 G
                              
                              
                                 d
                                 k
                              
                           
                        , 
                           k
                           =
                           1
                           ,
                           2
                           ,
                           …
                           ,
                           N
                        , is the desired amplitude–frequency response at the frequency 
                           
                              
                                 ω
                              
                              
                                 d
                                 k
                              
                           
                        .

Unfortunately, Eq. (22) is not linear and has no analytic solution. To find out the gain 
                           
                              
                                 G
                              
                              
                                 k
                              
                           
                        , the optimization method can be used to solve the nonlinear equation set [17,18].

Define the cost function J as
                           
                              (23)
                              
                                 J
                                 =
                                 
                                    ∑
                                    
                                       n
                                       =
                                       1
                                    
                                    N
                                 
                                 
                                    
                                       (
                                       
                                          
                                             G
                                          
                                          
                                             d
                                             n
                                          
                                       
                                       −
                                       
                                          |
                                          
                                             ∑
                                             
                                                k
                                                =
                                                1
                                             
                                             N
                                          
                                          
                                             
                                                G
                                             
                                             
                                                k
                                             
                                          
                                          
                                             
                                                H
                                             
                                             
                                                k
                                             
                                             
                                                ′
                                             
                                          
                                          
                                             (
                                             
                                                
                                                   e
                                                
                                                
                                                   j
                                                   
                                                      
                                                         ω
                                                      
                                                      
                                                         n
                                                      
                                                   
                                                
                                             
                                             )
                                          
                                          |
                                       
                                       )
                                    
                                    
                                       2
                                    
                                 
                              
                           
                         The gradients ∇J of the cost function is
                           
                              (24)
                              
                                 ∇
                                 J
                                 =
                                 
                                    
                                       ∂
                                       J
                                    
                                    
                                       ∂
                                       
                                          
                                             G
                                          
                                          
                                             i
                                          
                                       
                                    
                                 
                                 =
                                 −
                                 2
                                 
                                    ∑
                                    
                                       n
                                       =
                                       1
                                    
                                    N
                                 
                                 
                                    (
                                    
                                       
                                          G
                                       
                                       
                                          d
                                          n
                                       
                                    
                                    −
                                    
                                       |
                                       
                                          ∑
                                          
                                             k
                                             =
                                             1
                                          
                                          N
                                       
                                       
                                          
                                             G
                                          
                                          
                                             k
                                          
                                       
                                       
                                          
                                             H
                                          
                                          
                                             k
                                          
                                          
                                             ′
                                          
                                       
                                       
                                          (
                                          
                                             
                                                e
                                             
                                             
                                                j
                                                
                                                   
                                                      ω
                                                   
                                                   
                                                      n
                                                   
                                                
                                             
                                          
                                          )
                                       
                                       |
                                    
                                    )
                                 
                                 
                                    
                                       
                                          
                                             ∑
                                          
                                          
                                             k
                                             =
                                             1
                                          
                                          
                                             N
                                          
                                       
                                       
                                          
                                             G
                                          
                                          
                                             k
                                          
                                       
                                       (
                                       
                                          
                                             a
                                          
                                          
                                             k
                                             n
                                          
                                       
                                       
                                          
                                             a
                                          
                                          
                                             i
                                             n
                                          
                                       
                                       +
                                       
                                          
                                             b
                                          
                                          
                                             k
                                             n
                                          
                                       
                                       
                                          
                                             b
                                          
                                          
                                             i
                                             n
                                          
                                       
                                       )
                                    
                                    
                                       |
                                       
                                          
                                             ∑
                                          
                                          
                                             k
                                             =
                                             1
                                          
                                          
                                             N
                                          
                                       
                                       
                                          
                                             G
                                          
                                          
                                             k
                                          
                                       
                                       
                                          
                                             H
                                          
                                          
                                             k
                                          
                                          
                                             ′
                                          
                                       
                                       (
                                       
                                          
                                             e
                                          
                                          
                                             j
                                             
                                                
                                                   ω
                                                
                                                
                                                   n
                                                
                                             
                                          
                                       
                                       )
                                       |
                                    
                                 
                              
                           
                         where 
                           
                              
                                 a
                              
                              
                                 k
                                 n
                              
                           
                         and 
                           
                              
                                 b
                              
                              
                                 k
                                 n
                              
                           
                         are the real part and imaginary part of 
                           
                              
                                 H
                              
                              
                                 k
                              
                              
                                 ′
                              
                           
                           (
                           
                              
                                 e
                              
                              
                                 j
                                 
                                    
                                       ω
                                    
                                    
                                       n
                                    
                                 
                              
                           
                           )
                         respectively. The detailed derivation of ∇J is shown in Appendix B.

From Eq. (21), we have
                           
                              (25)
                              
                                 
                                    
                                       a
                                    
                                    
                                       k
                                       n
                                    
                                 
                                 =
                                 
                                    
                                       4
                                       
                                          
                                             sin
                                          
                                          
                                             2
                                          
                                       
                                       
                                          
                                             ω
                                          
                                          
                                             d
                                             k
                                          
                                       
                                       
                                          
                                             sin
                                          
                                          
                                             2
                                          
                                       
                                       
                                          
                                             ω
                                          
                                          
                                             n
                                          
                                       
                                       −
                                       4
                                       
                                          
                                             Q
                                          
                                          
                                             k
                                          
                                       
                                       sin
                                       2
                                       
                                          
                                             ω
                                          
                                          
                                             d
                                             k
                                          
                                       
                                       sin
                                       2
                                       
                                          
                                             ω
                                          
                                          
                                             n
                                          
                                       
                                       sin
                                       
                                          
                                             ω
                                          
                                          
                                             n
                                          
                                       
                                       +
                                       2
                                       sin
                                       
                                          
                                             ω
                                          
                                          
                                             d
                                             k
                                          
                                       
                                       (
                                       2
                                       
                                          
                                             Q
                                          
                                          
                                             k
                                          
                                       
                                       −
                                       sin
                                       
                                          
                                             ω
                                          
                                          
                                             d
                                             k
                                          
                                       
                                       )
                                       
                                          
                                             sin
                                          
                                          
                                             2
                                          
                                       
                                       2
                                       
                                          
                                             ω
                                          
                                          
                                             n
                                          
                                       
                                    
                                    
                                       
                                          
                                             [
                                             2
                                             
                                                
                                                   Q
                                                
                                                
                                                   k
                                                
                                             
                                             +
                                             sin
                                             
                                                
                                                   ω
                                                
                                                
                                                   d
                                                   k
                                                
                                             
                                             −
                                             4
                                             
                                                
                                                   Q
                                                
                                                
                                                   k
                                                
                                             
                                             cos
                                             
                                                
                                                   ω
                                                
                                                
                                                   d
                                                   k
                                                
                                             
                                             cos
                                             
                                                
                                                   ω
                                                
                                                
                                                   n
                                                
                                             
                                             +
                                             (
                                             2
                                             
                                                
                                                   Q
                                                
                                                
                                                   k
                                                
                                             
                                             −
                                             sin
                                             
                                                
                                                   ω
                                                
                                                
                                                   d
                                                   k
                                                
                                             
                                             )
                                             cos
                                             2
                                             
                                                
                                                   ω
                                                
                                                
                                                   n
                                                
                                             
                                             ]
                                          
                                          
                                             2
                                          
                                       
                                       +
                                       
                                          
                                             [
                                             4
                                             
                                                
                                                   Q
                                                
                                                
                                                   k
                                                
                                             
                                             cos
                                             
                                                
                                                   ω
                                                
                                                
                                                   d
                                                   k
                                                
                                             
                                             sin
                                             
                                                
                                                   ω
                                                
                                                
                                                   n
                                                
                                             
                                             −
                                             (
                                             2
                                             
                                                
                                                   Q
                                                
                                                
                                                   k
                                                
                                             
                                             −
                                             sin
                                             
                                                
                                                   ω
                                                
                                                
                                                   d
                                                   k
                                                
                                             
                                             )
                                             sin
                                             2
                                             
                                                
                                                   ω
                                                
                                                
                                                   n
                                                
                                             
                                             ]
                                          
                                          
                                             2
                                          
                                       
                                    
                                 
                              
                           
                        
                        
                           
                              (26)
                              
                                 
                                    
                                       b
                                    
                                    
                                       k
                                       n
                                    
                                 
                                 =
                                 
                                    
                                       2
                                       
                                          
                                             sin
                                          
                                          
                                             2
                                          
                                       
                                       
                                          
                                             ω
                                          
                                          
                                             d
                                             k
                                          
                                       
                                       sin
                                       2
                                       
                                          
                                             ω
                                          
                                          
                                             n
                                          
                                       
                                       −
                                       4
                                       
                                          
                                             Q
                                          
                                          
                                             k
                                          
                                       
                                       sin
                                       2
                                       
                                          
                                             ω
                                          
                                          
                                             d
                                             k
                                          
                                       
                                       sin
                                       
                                          
                                             ω
                                          
                                          
                                             n
                                          
                                       
                                       cos
                                       2
                                       
                                          
                                             ω
                                          
                                          
                                             n
                                          
                                       
                                       +
                                       2
                                       sin
                                       
                                          
                                             ω
                                          
                                          
                                             d
                                             k
                                          
                                       
                                       (
                                       2
                                       
                                          
                                             Q
                                          
                                          
                                             k
                                          
                                       
                                       −
                                       sin
                                       
                                          
                                             ω
                                          
                                          
                                             d
                                             k
                                          
                                       
                                       )
                                       cos
                                       2
                                       
                                          
                                             ω
                                          
                                          
                                             n
                                          
                                       
                                       sin
                                       2
                                       
                                          
                                             ω
                                          
                                          
                                             n
                                          
                                       
                                    
                                    
                                       
                                          
                                             [
                                             2
                                             
                                                
                                                   Q
                                                
                                                
                                                   k
                                                
                                             
                                             +
                                             sin
                                             
                                                
                                                   ω
                                                
                                                
                                                   d
                                                   k
                                                
                                             
                                             −
                                             4
                                             
                                                
                                                   Q
                                                
                                                
                                                   k
                                                
                                             
                                             cos
                                             
                                                
                                                   ω
                                                
                                                
                                                   d
                                                   k
                                                
                                             
                                             cos
                                             
                                                
                                                   ω
                                                
                                                
                                                   n
                                                
                                             
                                             +
                                             (
                                             2
                                             
                                                
                                                   Q
                                                
                                                
                                                   k
                                                
                                             
                                             −
                                             sin
                                             
                                                
                                                   ω
                                                
                                                
                                                   d
                                                   k
                                                
                                             
                                             )
                                             cos
                                             2
                                             
                                                
                                                   ω
                                                
                                                
                                                   n
                                                
                                             
                                             ]
                                          
                                          
                                             2
                                          
                                       
                                       +
                                       
                                          
                                             [
                                             4
                                             
                                                
                                                   Q
                                                
                                                
                                                   k
                                                
                                             
                                             cos
                                             
                                                
                                                   ω
                                                
                                                
                                                   d
                                                   k
                                                
                                             
                                             sin
                                             
                                                
                                                   ω
                                                
                                                
                                                   n
                                                
                                             
                                             −
                                             (
                                             2
                                             
                                                
                                                   Q
                                                
                                                
                                                   k
                                                
                                             
                                             −
                                             sin
                                             
                                                
                                                   ω
                                                
                                                
                                                   d
                                                   k
                                                
                                             
                                             )
                                             sin
                                             2
                                             
                                                
                                                   ω
                                                
                                                
                                                   n
                                                
                                             
                                             ]
                                          
                                          
                                             2
                                          
                                       
                                    
                                 
                              
                           
                         According to the steepest decent method [19], the updating rule of 
                           
                              
                                 G
                              
                              
                                 i
                              
                           
                         is
                           
                              (27)
                              
                                 
                                    
                                       G
                                    
                                    
                                       i
                                    
                                 
                                 (
                                 m
                                 +
                                 1
                                 )
                                 =
                                 
                                    
                                       G
                                    
                                    
                                       i
                                    
                                 
                                 (
                                 m
                                 )
                                 −
                                 μ
                                 ⋅
                                 
                                    
                                       ∂
                                       J
                                    
                                    
                                       ∂
                                       
                                          
                                             G
                                          
                                          
                                             i
                                          
                                       
                                    
                                 
                                 ,
                                 
                                 m
                                 =
                                 1
                                 ,
                                 2
                                 ,
                                 …
                                 M
                                 ,
                                 k
                                 =
                                 1
                                 ,
                                 2
                                 ,
                                 …
                                 ,
                                 N
                              
                           
                         where μ is the step size. Eq. (27) is a typical gradient algorithm for solving the optimization problem. The convergence of the general gradient algorithm is discussed in detail in [19].

Let γ denote the threshold controlling the iteration time. If 
                           |
                           μ
                           
                              
                                 ∂
                                 J
                              
                              
                                 ∂
                                 
                                    
                                       G
                                    
                                    
                                       i
                                    
                                 
                              
                           
                           |
                           <
                           γ
                         or reach the maximum iteration number M, the iteration procedure will be terminated. At the same time, the 
                           
                              
                                 G
                              
                              
                                 k
                              
                           
                        , 
                           k
                           =
                           1
                           ,
                           2
                           ,
                           …
                           ,
                           N
                        , are outputted as the optimal gains.

The final transfer function of the digital GEQ can be written as
                           
                              (28)
                              
                                 H
                                 (
                                 z
                                 )
                                 =
                                 
                                    ∑
                                    
                                       k
                                       =
                                       1
                                    
                                    N
                                 
                                 
                                    [
                                    
                                       
                                          G
                                       
                                       
                                          k
                                       
                                    
                                    
                                       
                                          H
                                       
                                       
                                          k
                                       
                                       
                                          ′
                                       
                                    
                                    (
                                    z
                                    )
                                    ]
                                 
                              
                           
                        
                     

In order to verify the effectiveness of the proposed method, the simulation experiments are given by three examples.


                     
                        Example 1
                        Test for the center frequency and bandwidth in a 10-segment digital GEQ


                        According to Eqs. (10) and (28), the 10-segment GEQ in Section 2 is redesigned. The step size μ is 0.01, the sampling rate 
                              
                                 
                                    f
                                 
                                 
                                    s
                                 
                              
                            is 48 kHz, and the iteration number is 831. The GEQʼs parameters are calibrated by the proposed method and are shown in Table 2
                           .

The amplitude–frequency responses of the BPFs are shown in Fig. 4
                           . We can find that the digital center frequency is corresponding to the analog center frequency exactly from Fig. 4 and Fig. 2, and the bandwidth change at high frequency region also becomes narrow. In Fig. 5
                           , the overall gain of the GEQ obtained by the proposed method is closer to the desired version.

The sub-band gains of a 10-segment digital GEQ are set as in Table 3
                           . The step size μ is 0.01, the iteration number is 830, the calibrated gains can be also obtained in Table 3 and other parameters are the same as in Example 1.

The overall amplitude–frequency responses of the GEQ by the traditional method and proposed method with gain calibration are shown in Fig. 6
                           . We can see from Fig. 6 that the amplitude–frequency response by the proposed method is more accurate than the one by the traditional version, and its average amplitude error is reduced about 2 dB. Especially, for a typical design example, the filter gain is attenuation, but the gains at two adjacent borders are amplification. For example, when the center frequencies are 
                              62.5
                              ×
                              2
                              π
                               rad
                           , 
                              1
                              K
                              ×
                              2
                              π
                               rad
                            and 
                              8
                              K
                              ×
                              2
                              π
                               rad
                            in Fig. 6 respectively, the desired gains of digital GEQ are attenuation, the proposed method can still ensure the gains attenuation, not magnification by the traditional method.

To illustrate the versatility of the proposed method, a 30-segment GEQ is also designed. The GEQʼs parameters are chosen as in Table 4
                           .

The step size μ is 0.01, the sampling rate 
                              
                                 
                                    f
                                 
                                 
                                    s
                                 
                              
                            is 48 kHz, and the iteration number is 5120. The parameters of the digital GEQ by proposed method are shown in Table 5
                           .

The overall amplitude–frequency responses of the GEQ designed by the traditional- and proposed-methods are shown in Fig. 7
                           . We can see from Fig. 7 that the amplitude–frequency response of GEQ designed by the proposed method is almost coincident with the desired version, and is much better than the one designed by the traditional method. When 
                              
                                 
                                    G
                                 
                                 
                                    d
                                    3
                                 
                              
                           , 
                              
                                 
                                    G
                                 
                                 
                                    d
                                    12
                                 
                              
                           , 
                              
                                 
                                    G
                                 
                                 
                                    d
                                    19
                                 
                              
                            are changed to 0.707 (
                              −
                              3
                               dB
                           ), 1.4125 (3 dB), 2.519 (8 dB) respectively, the amplitude–frequency responses of the GEQ are shown in Fig. 8
                           . It is obvious that the proposed method can keep the gain unchanged, but the results by the traditional design method cannot be accepted completely.

@&#CONCLUSION@&#

An improved design method for the digital audio graphic equalizer (GEQ) is presented based on a modified bilinear mapping rule, pre-distortion and optimization technique. The proposed method uses pre-distortion technique to calibrate the center frequency and bandwidth of digital audio GEQ. The steepest decent method is used to obtain the optimal gain for each sub-band in a GEQ. In the proposed method, the adjacent band interference of each sub-band in digital GEQ is inhibited, and both center frequency and bandwidth of the GEQ are exactly equal to the analog one. In addition, the GEQʼs gain is also closer to the desired value, especially when the gain is alternated with positive and negative. Although the proposed method has been used in practice, there are also some deficiencies. For example, when the number of BPFs in GEQ is higher in a GEQ, the convergence speed of the optimization method for the optimal gain will become slower.

@&#ACKNOWLEDGEMENTS@&#

This work was supported by the National Natural Science Foundation of China (No. 61172107, No. 61172110), Dalian Municipal Science and Technology Fund Scheme of China (No. 2008J23JH025), Specialized Research Fund for the Doctoral Program of Higher Education of China (No. 200801410015) and Fundamental Research Funds for the Central Universities of China (DUT13LAB06).

To make the statement more rigorous, the proof that the simple frequency pre-distortion technique will break the rule “the center frequency of constant-Q bandpass filter (BPF) is the geometric center of the upper cutoff frequency and lower cutoff frequency” is as follows.

From Eq. (13), the bandwidth 
                        
                           
                              
                                 
                                    Ω
                                 
                                 
                                    d
                                    k
                                 
                              
                              
                                 
                                    T
                                 
                                 
                                    s
                                 
                              
                           
                           
                              
                                 Q
                              
                              
                                 d
                                 k
                              
                           
                        
                      of the k-th digital BPF is obtained. The center frequency of the k-th digital BPF is 
                        
                           
                              Ω
                           
                           
                              d
                              k
                           
                        
                        
                           
                              T
                           
                           
                              s
                           
                        
                     . Based on the bandwidth and center frequency, the corresponding digital upper cutoff angular frequency 
                        
                           
                              ω
                           
                           
                              k
                              H
                           
                        
                      and lower cutoff angular frequency 
                        
                           
                              ω
                           
                           
                              k
                              L
                           
                        
                      can be obtained as follows.
                        
                           (A.1)
                           
                              
                                 
                                    ω
                                 
                                 
                                    k
                                    H
                                 
                              
                              =
                              
                                 
                                    Ω
                                 
                                 
                                    d
                                    k
                                 
                              
                              
                                 
                                    T
                                 
                                 
                                    s
                                 
                              
                              +
                              
                                 
                                    
                                       
                                          Ω
                                       
                                       
                                          d
                                          k
                                       
                                    
                                    
                                       
                                          T
                                       
                                       
                                          s
                                       
                                    
                                 
                                 
                                    2
                                    
                                       
                                          Q
                                       
                                       
                                          d
                                          k
                                       
                                    
                                 
                              
                           
                        
                     
                     
                        
                           (A.2)
                           
                              
                                 
                                    ω
                                 
                                 
                                    k
                                    H
                                 
                              
                              =
                              
                                 
                                    Ω
                                 
                                 
                                    d
                                    k
                                 
                              
                              
                                 
                                    T
                                 
                                 
                                    s
                                 
                              
                              −
                              
                                 
                                    
                                       
                                          Ω
                                       
                                       
                                          d
                                          k
                                       
                                    
                                    
                                       
                                          T
                                       
                                       
                                          s
                                       
                                    
                                 
                                 
                                    2
                                    
                                       
                                          Q
                                       
                                       
                                          d
                                          k
                                       
                                    
                                 
                              
                           
                        
                     
                  

From Eq. (13), after the frequency pre-distortion, the analog upper cutoff angular frequency 
                        
                           
                              Ω
                           
                           
                              d
                              k
                              H
                           
                        
                      and lower cutoff angular frequency 
                        
                           
                              Ω
                           
                           
                              d
                              k
                              L
                           
                        
                      of the k-th BPF can be described as follows.
                        
                           (A.3)
                           
                              
                                 
                                    Ω
                                 
                                 
                                    d
                                    k
                                    H
                                 
                              
                              =
                              
                                 
                                    
                                       Ω
                                    
                                    
                                       d
                                       k
                                    
                                 
                                 
                                    tan
                                    
                                       
                                          
                                             
                                                Ω
                                             
                                             
                                                d
                                                k
                                             
                                          
                                          
                                             
                                                T
                                             
                                             
                                                s
                                             
                                          
                                       
                                       2
                                    
                                 
                              
                              ⋅
                              tan
                              
                                 
                                    (
                                    1
                                    +
                                    2
                                    
                                       
                                          Q
                                       
                                       
                                          d
                                          k
                                       
                                    
                                    )
                                    
                                       
                                          Ω
                                       
                                       
                                          d
                                          k
                                       
                                    
                                    
                                       
                                          T
                                       
                                       
                                          s
                                       
                                    
                                 
                                 
                                    4
                                    
                                       
                                          Q
                                       
                                       
                                          d
                                          k
                                       
                                    
                                 
                              
                           
                        
                     
                     
                        
                           (A.4)
                           
                              
                                 
                                    Ω
                                 
                                 
                                    d
                                    k
                                    L
                                 
                              
                              =
                              
                                 
                                    
                                       Ω
                                    
                                    
                                       d
                                       k
                                    
                                 
                                 
                                    tan
                                    
                                       
                                          
                                             
                                                Ω
                                             
                                             
                                                d
                                                k
                                             
                                          
                                          
                                             
                                                T
                                             
                                             
                                                s
                                             
                                          
                                       
                                       2
                                    
                                 
                              
                              ⋅
                              tan
                              
                                 
                                    (
                                    2
                                    
                                       
                                          Q
                                       
                                       
                                          d
                                          k
                                       
                                    
                                    −
                                    1
                                    )
                                    
                                       
                                          Ω
                                       
                                       
                                          d
                                          k
                                       
                                    
                                    
                                       
                                          T
                                       
                                       
                                          s
                                       
                                    
                                 
                                 
                                    4
                                    
                                       
                                          Q
                                       
                                       
                                          d
                                          k
                                       
                                    
                                 
                              
                           
                        
                     
                  

It is easily find that the geometric center of the upper cutoff frequency 
                        
                           
                              Ω
                           
                           
                              d
                              k
                              H
                           
                        
                      and lower cutoff frequency 
                        
                           
                              Ω
                           
                           
                              d
                              k
                              L
                           
                        
                      is not equal to the center frequency 
                        
                           
                              Ω
                           
                           
                              d
                              k
                           
                        
                     . And also take Example 1 of this paper as an example to illustrate this point. The center frequency 
                        
                           
                              Ω
                           
                           
                              d
                              k
                           
                        
                      is 
                        16
                        ×
                        2
                        π
                      rad, sampling rate 
                        
                           
                              f
                           
                           
                              s
                           
                        
                      is 48 kHz, and the quality factor 
                        
                           
                              Q
                           
                           
                              d
                              k
                           
                        
                      is 1.414 (3 dB). So the pre-distorted analog upper cutoff angular frequency 
                        
                           
                              Ω
                           
                           
                              d
                              k
                              H
                           
                        
                        =
                        21
                        
                        656
                        ×
                        2
                        π
                      rad and lower cutoff angular frequency 
                        
                           
                              Ω
                           
                           
                              d
                              k
                              L
                           
                        
                        =
                        10
                        
                        343
                        ×
                        2
                        π
                      rad can be obtained. Obviously, 
                        
                           
                              
                                 
                                    Ω
                                 
                                 
                                    d
                                    k
                                    H
                                 
                              
                              ⋅
                              
                                 
                                    Ω
                                 
                                 
                                    d
                                    k
                                    L
                                 
                              
                           
                        
                        =
                        14
                        
                        966
                        ×
                        2
                        π
                         rad
                        ≠
                        
                           
                              Ω
                           
                           
                              d
                              k
                           
                        
                        =
                        16
                        
                        000
                        ×
                        2
                        π
                         rad
                     . So it breaks the rule above ‘geometric center’. Based on the above-mentioned explanation, we can draw the conclusion that the simple frequency pre-distortion is not suitable for designing digital GEQ.

A detailed derivation of Eq. (24) is as follows
                        
                           (B.1)
                           
                              J
                              =
                              
                                 ∑
                                 
                                    n
                                    =
                                    1
                                 
                                 N
                              
                              
                                 
                                    (
                                    
                                       
                                          G
                                       
                                       
                                          d
                                          n
                                       
                                    
                                    −
                                    
                                       |
                                       
                                          ∑
                                          
                                             k
                                             =
                                             1
                                          
                                          N
                                       
                                       
                                          
                                             G
                                          
                                          
                                             k
                                          
                                       
                                       
                                          
                                             H
                                          
                                          
                                             k
                                          
                                          
                                             ′
                                          
                                       
                                       
                                          (
                                          
                                             
                                                e
                                             
                                             
                                                j
                                                
                                                   
                                                      ω
                                                   
                                                   
                                                      n
                                                   
                                                
                                             
                                          
                                          )
                                       
                                       |
                                    
                                    )
                                 
                                 
                                    2
                                 
                              
                           
                        
                     
                     
                        
                           (B.2)
                           
                              ∇
                              J
                              =
                              
                                 
                                    ∂
                                    J
                                 
                                 
                                    ∂
                                    
                                       
                                          G
                                       
                                       
                                          i
                                       
                                    
                                 
                              
                              =
                              −
                              2
                              
                                 ∑
                                 
                                    n
                                    =
                                    1
                                 
                                 N
                              
                              
                                 (
                                 
                                    
                                       G
                                    
                                    
                                       d
                                       n
                                    
                                 
                                 −
                                 
                                    |
                                    
                                       ∑
                                       
                                          k
                                          =
                                          1
                                       
                                       N
                                    
                                    
                                       
                                          G
                                       
                                       
                                          k
                                       
                                    
                                    
                                       
                                          H
                                       
                                       
                                          k
                                       
                                       
                                          ′
                                       
                                    
                                    
                                       (
                                       
                                          
                                             e
                                          
                                          
                                             j
                                             
                                                
                                                   ω
                                                
                                                
                                                   n
                                                
                                             
                                          
                                       
                                       )
                                    
                                    |
                                 
                                 )
                              
                              
                                 
                                    ∂
                                    (
                                    |
                                    
                                       
                                          ∑
                                       
                                       
                                          k
                                          =
                                          1
                                       
                                       
                                          N
                                       
                                    
                                    
                                       
                                          G
                                       
                                       
                                          k
                                       
                                    
                                    
                                       
                                          H
                                       
                                       
                                          k
                                       
                                       
                                          ′
                                       
                                    
                                    (
                                    
                                       
                                          e
                                       
                                       
                                          j
                                          
                                             
                                                ω
                                             
                                             
                                                n
                                             
                                          
                                       
                                    
                                    )
                                    |
                                    )
                                 
                                 
                                    ∂
                                    
                                       
                                          G
                                       
                                       
                                          i
                                       
                                    
                                 
                              
                              =
                              −
                              2
                              
                                 ∑
                                 
                                    n
                                    =
                                    1
                                 
                                 N
                              
                              
                                 (
                                 
                                    
                                       G
                                    
                                    
                                       d
                                       n
                                    
                                 
                                 −
                                 
                                    |
                                    
                                       ∑
                                       
                                          k
                                          =
                                          1
                                       
                                       N
                                    
                                    
                                       
                                          G
                                       
                                       
                                          k
                                       
                                    
                                    
                                       
                                          H
                                       
                                       
                                          k
                                       
                                       
                                          ′
                                       
                                    
                                    
                                       (
                                       
                                          
                                             e
                                          
                                          
                                             j
                                             
                                                
                                                   ω
                                                
                                                
                                                   n
                                                
                                             
                                          
                                       
                                       )
                                    
                                    |
                                 
                                 )
                              
                              
                                 
                                    ∂
                                    (
                                    |
                                    
                                       
                                          ∑
                                       
                                       
                                          k
                                          =
                                          1
                                       
                                       
                                          N
                                       
                                    
                                    
                                       
                                          G
                                       
                                       
                                          k
                                       
                                    
                                    (
                                    
                                       
                                          a
                                       
                                       
                                          k
                                          n
                                       
                                    
                                    +
                                    i
                                    
                                       
                                          b
                                       
                                       
                                          k
                                          n
                                       
                                    
                                    )
                                    |
                                    )
                                 
                                 
                                    ∂
                                    
                                       
                                          G
                                       
                                       
                                          i
                                       
                                    
                                 
                              
                              =
                              −
                              2
                              
                                 ∑
                                 
                                    n
                                    =
                                    1
                                 
                                 N
                              
                              
                                 (
                                 
                                    
                                       G
                                    
                                    
                                       d
                                       n
                                    
                                 
                                 −
                                 
                                    |
                                    
                                       ∑
                                       
                                          k
                                          =
                                          1
                                       
                                       N
                                    
                                    
                                       
                                          G
                                       
                                       
                                          k
                                       
                                    
                                    
                                       
                                          H
                                       
                                       
                                          k
                                       
                                       
                                          ′
                                       
                                    
                                    
                                       (
                                       
                                          
                                             e
                                          
                                          
                                             j
                                             
                                                
                                                   ω
                                                
                                                
                                                   n
                                                
                                             
                                          
                                       
                                       )
                                    
                                    |
                                 
                                 )
                              
                              
                                 
                                    ∂
                                    (
                                    |
                                    
                                       
                                          ∑
                                       
                                       
                                          k
                                          =
                                          1
                                       
                                       
                                          N
                                       
                                    
                                    
                                       
                                          G
                                       
                                       
                                          k
                                       
                                    
                                    
                                       
                                          a
                                       
                                       
                                          k
                                          n
                                       
                                    
                                    +
                                    i
                                    
                                       
                                          ∑
                                       
                                       
                                          k
                                          =
                                          1
                                       
                                       
                                          N
                                       
                                    
                                    
                                       
                                          b
                                       
                                       
                                          k
                                          n
                                       
                                    
                                    )
                                    |
                                    )
                                 
                                 
                                    ∂
                                    
                                       
                                          G
                                       
                                       
                                          i
                                       
                                    
                                 
                              
                              =
                              −
                              2
                              
                                 ∑
                                 
                                    n
                                    =
                                    1
                                 
                                 N
                              
                              
                                 (
                                 
                                    
                                       G
                                    
                                    
                                       d
                                       n
                                    
                                 
                                 −
                                 
                                    |
                                    
                                       ∑
                                       
                                          k
                                          =
                                          1
                                       
                                       N
                                    
                                    
                                       
                                          G
                                       
                                       
                                          k
                                       
                                    
                                    
                                       
                                          H
                                       
                                       
                                          k
                                       
                                       
                                          ′
                                       
                                    
                                    
                                       (
                                       
                                          
                                             e
                                          
                                          
                                             j
                                             
                                                
                                                   ω
                                                
                                                
                                                   n
                                                
                                             
                                          
                                       
                                       )
                                    
                                    |
                                 
                                 )
                              
                              
                                 
                                    ∂
                                    (
                                    
                                       
                                          
                                             
                                                (
                                                
                                                   
                                                      ∑
                                                   
                                                   
                                                      k
                                                      =
                                                      1
                                                   
                                                   
                                                      N
                                                   
                                                
                                                
                                                   
                                                      G
                                                   
                                                   
                                                      k
                                                   
                                                
                                                
                                                   
                                                      a
                                                   
                                                   
                                                      k
                                                      n
                                                   
                                                
                                                )
                                             
                                             
                                                2
                                             
                                          
                                          +
                                          
                                             
                                                (
                                                
                                                   
                                                      ∑
                                                   
                                                   
                                                      k
                                                      =
                                                      1
                                                   
                                                   
                                                      N
                                                   
                                                
                                                
                                                   
                                                      G
                                                   
                                                   
                                                      k
                                                   
                                                
                                                
                                                   
                                                      b
                                                   
                                                   
                                                      k
                                                      n
                                                   
                                                
                                                )
                                             
                                             
                                                2
                                             
                                          
                                       
                                    
                                    )
                                 
                                 
                                    ∂
                                    
                                       
                                          G
                                       
                                       
                                          i
                                       
                                    
                                 
                              
                              =
                              −
                              2
                              
                                 ∑
                                 
                                    n
                                    =
                                    1
                                 
                                 N
                              
                              
                                 (
                                 
                                    
                                       G
                                    
                                    
                                       d
                                       n
                                    
                                 
                                 −
                                 
                                    |
                                    
                                       ∑
                                       
                                          k
                                          =
                                          1
                                       
                                       N
                                    
                                    
                                       
                                          G
                                       
                                       
                                          k
                                       
                                    
                                    
                                       
                                          H
                                       
                                       
                                          k
                                       
                                       
                                          ′
                                       
                                    
                                    
                                       (
                                       
                                          
                                             e
                                          
                                          
                                             j
                                             
                                                
                                                   ω
                                                
                                                
                                                   n
                                                
                                             
                                          
                                       
                                       )
                                    
                                    |
                                 
                                 )
                              
                              
                                 
                                    
                                       
                                          a
                                       
                                       
                                          i
                                          n
                                       
                                    
                                    
                                       
                                          ∑
                                       
                                       
                                          k
                                          =
                                          1
                                       
                                       
                                          N
                                       
                                    
                                    
                                       
                                          G
                                       
                                       
                                          k
                                       
                                    
                                    
                                       
                                          a
                                       
                                       
                                          k
                                          n
                                       
                                    
                                    +
                                    
                                       
                                          b
                                       
                                       
                                          i
                                          n
                                       
                                    
                                    
                                       
                                          ∑
                                       
                                       
                                          k
                                          =
                                          1
                                       
                                       
                                          N
                                       
                                    
                                    
                                       
                                          G
                                       
                                       
                                          k
                                       
                                    
                                    
                                       
                                          b
                                       
                                       
                                          k
                                          n
                                       
                                    
                                 
                                 
                                    
                                       
                                          
                                             (
                                             
                                                
                                                   ∑
                                                
                                                
                                                   k
                                                   =
                                                   1
                                                
                                                
                                                   N
                                                
                                             
                                             
                                                
                                                   G
                                                
                                                
                                                   k
                                                
                                             
                                             
                                                
                                                   a
                                                
                                                
                                                   k
                                                   n
                                                
                                             
                                             )
                                          
                                          
                                             2
                                          
                                       
                                       +
                                       
                                          
                                             (
                                             
                                                
                                                   ∑
                                                
                                                
                                                   k
                                                   =
                                                   1
                                                
                                                
                                                   N
                                                
                                             
                                             
                                                
                                                   G
                                                
                                                
                                                   k
                                                
                                             
                                             
                                                
                                                   b
                                                
                                                
                                                   k
                                                   n
                                                
                                             
                                             )
                                          
                                          
                                             2
                                          
                                       
                                    
                                 
                              
                           
                        
                     
                     
                        
                           (B.3)
                           
                              ∇
                              J
                              =
                              −
                              2
                              
                                 ∑
                                 
                                    n
                                    =
                                    1
                                 
                                 N
                              
                              
                                 (
                                 
                                    
                                       G
                                    
                                    
                                       d
                                       n
                                    
                                 
                                 −
                                 
                                    |
                                    
                                       ∑
                                       
                                          k
                                          =
                                          1
                                       
                                       N
                                    
                                    
                                       
                                          G
                                       
                                       
                                          k
                                       
                                    
                                    
                                       
                                          H
                                       
                                       
                                          k
                                       
                                       
                                          ′
                                       
                                    
                                    
                                       (
                                       
                                          
                                             e
                                          
                                          
                                             j
                                             
                                                
                                                   ω
                                                
                                                
                                                   n
                                                
                                             
                                          
                                       
                                       )
                                    
                                    |
                                 
                                 )
                              
                              
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          k
                                          =
                                          1
                                       
                                       
                                          N
                                       
                                    
                                    
                                       
                                          G
                                       
                                       
                                          k
                                       
                                    
                                    (
                                    
                                       
                                          a
                                       
                                       
                                          k
                                          n
                                       
                                    
                                    
                                       
                                          a
                                       
                                       
                                          i
                                          n
                                       
                                    
                                    +
                                    
                                       
                                          b
                                       
                                       
                                          k
                                          n
                                       
                                    
                                    
                                       
                                          b
                                       
                                       
                                          i
                                          n
                                       
                                    
                                    )
                                 
                                 
                                    |
                                    
                                       
                                          ∑
                                       
                                       
                                          k
                                          =
                                          1
                                       
                                       
                                          N
                                       
                                    
                                    
                                       
                                          G
                                       
                                       
                                          k
                                       
                                    
                                    
                                       
                                          H
                                       
                                       
                                          k
                                       
                                       
                                          ′
                                       
                                    
                                    (
                                    
                                       
                                          e
                                       
                                       
                                          j
                                          
                                             
                                                ω
                                             
                                             
                                                n
                                             
                                          
                                       
                                    
                                    )
                                    |
                                 
                              
                           
                        
                      where 
                        
                           
                              a
                           
                           
                              k
                              n
                           
                        
                      and 
                        
                           
                              b
                           
                           
                              k
                              n
                           
                        
                      are the real part and imaginary part of 
                        
                           
                              H
                           
                           
                              k
                           
                           
                              ′
                           
                        
                        (
                        
                           
                              e
                           
                           
                              j
                              
                                 
                                    ω
                                 
                                 
                                    n
                                 
                              
                           
                        
                        )
                      respectively.

@&#REFERENCES@&#

