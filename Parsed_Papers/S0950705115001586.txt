@&#MAIN-TITLE@&#Pornographic images recognition based on spatial pyramid partition and multi-instance ensemble learning

@&#HIGHLIGHTS@&#


               
               
                  
                     
                        
                           
                           Spatial pyramid partition based multi-instance modeling method is proposed.


                        
                        
                           
                           Fuzzy histograms fusion based metadata extraction method is proposed.


                        
                        
                           
                           Extreme learning machine and classifier ensemble based MIL algorithm is proposed.


                        
                        
                           
                           The ELMCE-MIL is robust and comparable to other state-of-the-art MIL algorithms.


                        
                     
                  
               
            

@&#KEYPHRASES@&#

Multi-instance learning

Pornographic images recognition

Extreme learning machine

@&#ABSTRACT@&#


               
               
                  For tackling the problem of pornographic image recognition, a novel multi-instance learning (MIL) algorithm is proposed by using extreme learning machine (ELM) and classifiers ensemble. Firstly, a spatial pyramid partition-based (SPP) multi-instance modeling technique has been deployed to transform the pornographic images recognition problem into a typical MIL problem. The method has deployed a bag corresponding to an image and an instance corresponding to each partitioned sub-block described by low-level visual features (i.e. color, texture and shape). Secondly, a collection of visual word (VW) has been generated by using hierarchical k-mean clustering method, and then based on the fuzzy membership function between instance and VW, a fuzzy histogram fusion-based metadata calculation method has been proposed to convert each bag to a single sample, which allows the MIL problem to be solved directly by a standard single instance learning (SIL) machine. Finally, by using ELM, a group of base classifiers with different number of hidden nodes have been constructed, and their weights bas been dynamically determined by using performance weighting rule. Therefore, the strategy of classifiers ensemble is used to improve the overall adaptability of proposed ELMCE-MIL algorithm. Experimental results have shown that the method is robust, and its performance is superior to other similar algorithms.
               
            

@&#INTRODUCTION@&#

With the rapid development of computer and communication technologies, the Internet has become one of the primary resources to access variable information and knowledge. However, the ocean of information from the Internet not only contains useful knowledge that people need, but also rapidly increasing objectionable messages, such as violence, pornography, and rumors. Because image contains much more semantic information than texts does, the pornographic images have the most straightforward impact to the teenager’s physical and mental health. Thus, purifying the network environment and keeping teenagers away from pornographic web pages becomes a serious challenge to their family and our society. Therefore, an automated, effective and accurate pornographic images recognition method, which can prevent teenagers from browsing online pornographic images, becomes very important and necessary [1,2].

Blacklist and keyword-based approaches are two kinds of common pornographic image recognition methods [3–6]. The blacklist-based methods block all the accesses to the websites in a list of URLs where pornographic contents have been reported. However, since the highly dynamic feature of the model network system, the methods cannot filter all the URLs containing pornographic contents effectively. On the other hand, keyword-based methods attempt to filter images by analyzing the sensitive texts from webpages. But many words belonging to the pornographer’s lexicon can be also appeared in webpages for other purpose (i.e. the educational sites about breast cancer). In addition, some pornographic websites embedding their text into images which make the keyword-based analysis impossible to be applied. Therefore, in recent years, content-based pornographic image recognition technology becomes a hot research topic for pornographic images recognition, which has better adaptability when identifying pornographic content from webpages.

In recent years, many content-based pornographic image recognition methods have been proposed and they can be roughly categorized into three groups [7–9], which are model-based, feature-based and region-based methods. (1) Model-based method was first proposed by Fleck and Forsyth in 1996 [10,11]. The authors firstly detect the skin color pixels in an image using color and texture information and then find all connected columned skin regions that are candidates for trunks and limbs. These skin columns are used to combine constrained subjects derived from a geometrical model of the human body. If the combination can form a reasonable shape of a human body, the image is then treated as pornographic. This method is quite straightforward and easy to apply. However, as human bodies are non-rigid objects and have a wide variety of postures, it is very difficult to build a comprehensive body grouper effectively. Thus, the recognition accuracy is usually not very high [7,8]. (2) Feature-based methods emphasize the extraction of image features [7,8]. For example, Wang et al. [12] uses wavelet transformation to represent images, and then color histogram and normalized central moments are used to form semantic-matching vectors to classify those images. However, it generates high missing and false detection since local details of the image are ignored. (3) Rule-based methods [9] decide pornographic image according to some predefined rules such as the ratio of the skin areas against the image area, the number of connected skin regions, the ratio of the largest skin area to all skin regions etc. As rule-based methods are relatively simple, the recognition results are unsatisfactory. Recently, a bag-of-feature approach based on SIFT has been proposed [13] to classify images into nude and non-nude while the reported average recognition rate is no more than 70%. Yan et al. [14] also proposed a new approach of extracting salient region from pornographic image regions, which remarkably improves the detection rate.

Above mentioned content-based pornographic image recognition methods can be regarded as binary classification problems that the image should be classified into either pornographic or non-pornographic. Because of the users often distinguish the pornographic images by their “semantic features” rather than “visual features”, in order to bridge the “semantic gap”, the machine learning method, such as support vector machine (SVM) or neural network, can be employed to train the “visual feature” vectors for generating the classification model. But the first challenging task of such methods is to collect a large number of training samples for the learning. Unfortunately, manually collecting (and possibly further annotating, aligning, cropping, etc.) during the supervised learning processes is an expensive endeavor, which is both time consuming and error-prone [15].

To solve this problem, in this paper, the pornographic image recognition problem has been transformed into a multi-instance learning (MIL) problem by regarding each image as a bag and their low-level visual features of divided sub-blocks as instances [16]. An image can be labeled as a positive bag if it is a pornographic image (otherwise it should be labeled as a negative bag). One advantage of using the MIL is its coarse labeling processes, rather than fine labeling at region level, so it can significantly improve the efficiency when applying supervised learning.

There are three major contributions in this paper:
                        
                           •
                           A SPP-based multi-instance modeling method has been proposed. We applied SPP method to divide each image into a sequence of increasingly finer sub-blocks, and then based on the color, texture and shape features extracting from all the sub-blocks, an image are modeled as three different multi-instance bags. Compared with other method, the SPP method is not only simple and efficient, but also more adaptable and robust.

A brand new ELM and classifier ensemble based MIL algorithm has been proposed. Firstly, ELM is used to train a group of base classifiers, which the ELM with different number of hidden nodes has been deployed. Secondly, the performance weighting rule is used to determine the weights of the base classifiers dynamically. To the best of our knowledge, this is the first inductive ELM method for the MIL problem with superb efficiency and performance.

For demonstrating the promising performance of our method, an extensive comparison work was carried out for evaluating our method with many state-of-the-art MIL approaches in a real-world setting when solving pornographic image recognition problem.

The remaining paper is organized as follows: In Section 2, a brief review of recent development of MIL is introduced. Section 3 provides the details of our proposed MIL method, including the multi-instance modeling, metadata extraction, extreme learning machine and classifier ensemble. The experimental results are presented in Section 4 and the Section 5 concludes the paper.

@&#RELATED WORK@&#

MIL has become an active research area in machine learning since it was first introduced for solving drug activity prediction problems [17]. In the MIL applications, the training samples are usually regarded as bags, where each bag consists of multiple instances. Training labels are associated with bags rather than their instances. According to the original MIL definition, a bag is labeled as positive if at least one of its instances is positive, and it is labeled as negative if all of its instances are negative. The goal of a MIL algorithm is to generate a classifier that can classify unseen bags correctly.

During the last decade, many MIL algorithms have been presented, including axis parallel hyper-rectangles [17], Citation-kNN, Diverse Density (DD), DD with Expectation Maximization (EM-DD) and Neural Network et al. [18]. In those variety of solutions, support vector machines (SVM)-based methods have been highlighted, which have been successfully deployed for solving many machine-learning problems. For example, Andrews et al. [19] modified the SVM formulation, and presented mi-SVM and MI-SVM algorithms in his work. However, unlike the standard SVM, those methods usually suffer from local minima which lead to non-convex optimization problems. Gehler et al. [20] applied deterministic annealing to solve the problem by proposing so-called AL-SVM method, which could find better local minima of the objective function. Gartner et al. [21] designed kernel functions (i.e. set kernel and statistics kernel) directly from the bags, and used a standard SVM to solve the MIL problem. Due to instance labels were unavailable, these multi-instance kernels implicitly simply assumed that all instances in a bag have equally important, which is a very rough assumption. Therefore, Kwok and Cheung [22] designed marginalized kernel and Zhou et al. [23] designed graph kernel for the problem by considering the different contributions from the instances. Recently, some meta-data based methods have also been proposed, which convert each bag in the MIL problem into a single meta-data so that standard single instance learning (SIL) methods (i.e. SVM method) can be used. Name a few, DD-SVM [24], Multi-Instance Learning via Embedded Instance Selection (MILES) [25], MILD [26], MILIS [27], EC-SVM [28], etc. It has been proved that converting each bag of the MIL into a single representation vector, and then using a SIL method to solve the problem is a very effective solution. However, few existed feature representation methods are effective enough to describe the MIL bags, which lead difficulties to adapt some well-known SIL methods when solving the MIL problems. For example, the DD-SVM [24] method has to learn a collection of instance prototypes to construct a new feature space using Diverse Density (DD) function. Therefore, its representational features are very sensitive to noise and suffer from very high computation cost. The MILES [25] method uses all the instances from the training bags instead of the prototypes used by DD-SVM to construct a new feature space. Although MILES is less sensitive to noise and more efficient than the DD-SVM, the feature space for representing bags is suffer from high dimensionality due to the huge number of irrelevant features. One possible solution is applying 1-norm SVM to the SIL as it can select important features and construct classifiers simultaneously.

Recently, besides these supervised multi-instance learning algorithms, many multiple-instance semi-supervised learning (SSL) algorithms have been also presented. One of the pioneer works on MISSL is reported by Rahmani et al. [29]. The authors combined a modified version of DD-based MIL method with Gaussian fields and harmonic functions-based SSL algorithm to exploit abundant unlabeled bags. Wang et al. [30] presented a graph-based multi-instance learning (GMIL) algorithm, without loosely coupled manner in MISSL, they considered the multi-instance and semi-supervised property simultaneously, which provide a straightforward solution to the MISSL problem by minimizing a cost function of the regularization framework. Feng et al. [31] introduce a Hierarchical Sparse Representation-based Multi-Instance Semi-Supervised Learning (HSR-MISSL) algorithm. The HSR-MISSL includes two levels: The first level defines an instance disambiguation mechanism from the perspective of sparse representation at the instance-level. The second level is so-called bag-level which defines a graph based manifold regularization SSL method among bags via sparse representation after taking the unlabeled data into consideration.

To achieve the goal of pornographic image recognition under the framework of the multi-instance learning (MIL), a spatial pyramid partition (SPP) based multi-instance modeling and extreme learning machine-based (ELM) [32] classifier ensemble MIL algorithm has been proposed. Firstly, the SPP-based image partition method has been used to divide each image into a sequence of increasingly finer sub-blocks, and the color, texture and shape features of each block were extracted. We then regarded one image as a bag, and the low-level visual features from all the sub-blocks as instances. As a result, the pornographic images recognition tasks can be transformed into a MIL problem. Secondly, a fuzzy histogram fusion based metadata extraction method has been used to convert every multi-instance bag to a representative vector, so the MIL problem can be transformed to a single instance learning (SIL) problem. At the last, by combining with ELM and classifier ensemble strategy, a novel MIL algorithm, named ELMCE-MIL, has been proposed. The framework of the proposed algorithm is shown in Fig. 1
                     .

The MIL-based pornographic image recognition approach requires multi-instance bags for learning. In this research, a novel multi-instance modeling method has been developed for transforming a raw image into three bags containing several different instances respectively. Firstly, SPP method [33] has been used to divide each image into a sequence of increasingly finer sub-blocks, and then extract the low-level visual features from all the sub-blocks. Using “three-level SSP” as an example, the steps of modeling can be shown in Fig. 2
                        .

The first step towards pornographic image recognition under the framework of the MIL is multi-instance modeling, which transform each image into a multi-instance bag. In most cases, image segmentation techniques can be deployed to carry out multi-sample modeling tasks. The basic process is: Each image can be segmented into several regions by using certain image segmentation algorithms, and then the image can be regarded as a bag with low-level visual features of all sub-regions as instances. As a result, the image semantic analysis problem can be transformed into MIL problem. However, the methods based on image segmentation suffers from unsatisfied accuracy and efficiency. For example, as we all know, JSEG [34] is a robust image segmentation method developed by Deng et al., which is widely used for region-based image retrieval or classification problems. In our previous work, a JSEG-based image segmentation technique is deployed for multi-instance modeling, it will spent about 10 s to complete the segmentation task even when the image resolution is 
                              
                                 480
                                 ×
                                 640
                              
                           
                           pixels, which is too slow for real-world applications especially when we need to deal with a great number of images from the Internet to recognizing pornographic contents.

Therefore, we propose a novel multi-instance modeling method based on “spatial pyramid partition (SPP)”. In SPP, the input image is divided into a sequence of increasingly finer grids on each pyramid level, and the low-level visual features are extracted from all of the grid cells (sub-blocks). As shown in Fig. 2, in the three-layer SPP, the first layer is the original image, the second layer is a 2×2 grid partition, and the third layer is a 4×4 grid partition. Therefore we can obtain a total number of 21 image blocks. Compared with multi-instance modeling based on image segmentation, the SPP method is not only simple and efficient, but also adaptable and robust.

Note: In all the subsequent experiments, we used the following method to determine the number of layer of SPP adaptively, i.e., the dividing should be stopped when the height or width of the finest sub-block is smaller than 50pixels.

After an image is partitioned by spatial pyramid method, we extract the following low-level visual features from each sub-block.

The basis of color moments assume that the color distribution in an image can be interpreted as a probability distribution, which are characterized by a number of unique moments (e.g. Normal distributions are differentiated by their mean and variance). It therefore follows that if the color in an image follows a certain probability distribution, the moments of that distribution can then be used as features to identify the image based on color.

In order to describe the color moments of each image block 
                                 
                                    
                                       
                                          B
                                       
                                       
                                          j
                                       
                                    
                                 
                              , a well-known HSV color space has been used, where V encodes luminance and H and S encode color information (Hue and Saturation). Moments are calculated based on the three channels in the HSV space, we define the pixels of the i-th (there i
                              =1, 2, 3) color channel at an block 
                                 
                                    
                                       
                                          B
                                       
                                       
                                          j
                                       
                                    
                                 
                               as 
                                 
                                    {
                                    
                                       
                                          p
                                       
                                       
                                          j
                                          ,
                                          i
                                          ,
                                       
                                    
                                    (
                                    t
                                    )
                                    |
                                    t
                                    =
                                    1
                                    ,
                                    2
                                    ,
                                    …
                                    ,
                                    N
                                    }
                                 
                              . Two color moments are defined as follow:


                              MOMENT 1 – Mean:
                                 
                                    (1)
                                    
                                       
                                          
                                             M
                                          
                                          
                                             j
                                             ,
                                             i
                                          
                                       
                                       =
                                       
                                          
                                             1
                                          
                                          
                                             N
                                          
                                       
                                       
                                          
                                             
                                                ∑
                                             
                                             
                                                t
                                                =
                                                1
                                             
                                             
                                                N
                                             
                                          
                                       
                                       
                                          
                                             p
                                          
                                          
                                             j
                                             ,
                                             i
                                             ,
                                          
                                       
                                       (
                                       t
                                       )
                                       ,
                                    
                                 
                              where N is the total number of pixels in the block 
                                 
                                    
                                       
                                          B
                                       
                                       
                                          j
                                       
                                    
                                 
                              . In other words, the Mean is defined as the average value in a color channel for a partitioned image block.


                              MOMENT 2 – Standard Deviation:
                                 
                                    (2)
                                    
                                       
                                          
                                             σ
                                          
                                          
                                             j
                                             ,
                                             i
                                          
                                       
                                       =
                                       
                                          
                                             
                                                
                                                   1
                                                
                                                
                                                   N
                                                
                                             
                                             
                                                
                                                   ∑
                                                
                                                
                                                   t
                                                   =
                                                   1
                                                
                                                
                                                   N
                                                
                                             
                                             
                                                
                                                   (
                                                   
                                                      
                                                         p
                                                      
                                                      
                                                         j
                                                         ,
                                                         i
                                                      
                                                   
                                                   (
                                                   t
                                                   )
                                                   -
                                                   
                                                      
                                                         M
                                                      
                                                      
                                                         j
                                                         ,
                                                         i
                                                      
                                                   
                                                   )
                                                
                                                
                                                   2
                                                
                                             
                                          
                                       
                                    
                                 
                              which is the square root of the variance of the distribution.

Based on the above definition, the color feature of the j-th block 
                                 
                                    
                                       
                                          R
                                       
                                       
                                          j
                                       
                                    
                                 
                               can be characterized by 6 moments that each pair of moments for one color channel, denoted as a 6-dimensional color feature vector:
                                 
                                    (3)
                                    
                                       
                                          
                                             Cx
                                          
                                          
                                             j
                                          
                                       
                                       =
                                       [
                                       
                                          
                                             M
                                          
                                          
                                             j
                                             ,
                                             1
                                          
                                       
                                       ,
                                       
                                          
                                             M
                                          
                                          
                                             j
                                             ,
                                             2
                                          
                                       
                                       ,
                                       
                                          
                                             M
                                          
                                          
                                             j
                                             ,
                                             3
                                          
                                       
                                       ,
                                       
                                          
                                             σ
                                          
                                          
                                             j
                                             ,
                                             1
                                          
                                       
                                       ,
                                       
                                          
                                             σ
                                          
                                          
                                             j
                                             ,
                                             2
                                          
                                       
                                       ,
                                       
                                          
                                             σ
                                          
                                          
                                             j
                                             ,
                                             3
                                          
                                       
                                       ]
                                    
                                 
                              
                           

LBP [35] is an operator for describing local image texture features, which is first proposed by Ojala [36]. The main idea of LBP is that we regard the center pixel’s grayscale value as a threshold, and compare it with its neighbors to get the corresponding binary code to represent the local texture. The primary LBP pattern values calculation process is shown in Fig. 3
                              .

Suppose an image block is denoted as 
                                 
                                    B
                                    
                                       
                                          (
                                          x
                                          ,
                                          y
                                          )
                                       
                                       
                                          N
                                          ×
                                          M
                                       
                                    
                                 
                              , after calculating the LBP pattern values of each pixel 
                                 
                                    b
                                    (
                                    i
                                    ,
                                    j
                                    )
                                 
                              , the whole image block is represented by building a histogram as follow:
                                 
                                    (4)
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         H
                                                         (
                                                         t
                                                         )
                                                         =
                                                         
                                                            
                                                               
                                                                  ∑
                                                               
                                                               
                                                                  i
                                                                  =
                                                                  1
                                                               
                                                               
                                                                  N
                                                               
                                                            
                                                         
                                                         
                                                            
                                                               
                                                                  ∑
                                                               
                                                               
                                                                  j
                                                                  =
                                                                  1
                                                               
                                                               
                                                                  M
                                                               
                                                            
                                                         
                                                         f
                                                         (
                                                         LBP
                                                         (
                                                         i
                                                         ,
                                                         j
                                                         )
                                                         ,
                                                         t
                                                         )
                                                         ,
                                                      
                                                      
                                                         p
                                                         ∈
                                                         [
                                                         0
                                                         ,
                                                         T
                                                         ]
                                                      
                                                   
                                                   
                                                      
                                                         f
                                                         (
                                                         x
                                                         ,
                                                         y
                                                         )
                                                         =
                                                         
                                                            
                                                               
                                                                  
                                                                     
                                                                        
                                                                           1
                                                                           ,
                                                                        
                                                                        
                                                                           x
                                                                           =
                                                                           y
                                                                        
                                                                     
                                                                     
                                                                        
                                                                           0
                                                                           ,
                                                                        
                                                                        
                                                                           otherwise
                                                                        
                                                                     
                                                                  
                                                               
                                                            
                                                         
                                                      
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                              where 
                                 
                                    T
                                 
                               represents the number of encoding bit, N is the height of the block, M is the width of the block, 
                                 
                                    LBP
                                    (
                                    i
                                    ,
                                    j
                                    )
                                 
                               is the LBP pattern value at the location 
                                 
                                    (
                                    i
                                    ,
                                    j
                                    )
                                 
                              , thus 
                                 
                                    H
                                    (
                                    t
                                    )
                                 
                               is the number of pixels which have LBP value of t, then we can get a histogram to describe the distribution of LBP pattern values.

Since Ojala also found that the primary LBP performs not well, we use 
                                 
                                    
                                       
                                          LBP
                                       
                                       
                                          P
                                          ,
                                          R
                                       
                                    
                                 
                               to denote P sample points with radius R for LBP feature. Ojala further proposed a uniform pattern in [36] to reduce the dimension of LBP feature. The property of the uniform pattern is that the number of 0–1 transitions should not be larger than 2. Therefore, in the P neighbors, the number of uniformed patterns is P
                              ∗(P
                              −1)+3. In this paper, we set P
                              =8, R
                              =1, so the number of patterns is 59, which is more efficient than the primary number 256. In addition, Ojala demonstrated that the uniformed patterns can describe more than 90% of the texture feature in an image. Based on the above definition, each block’s normalized LBP texture feature can be denoted as a 59-dimensional vector 
                                 
                                    
                                       
                                          Tx
                                       
                                       
                                          j
                                       
                                    
                                 
                              :
                                 
                                    (5)
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         
                                                            
                                                               Tx
                                                            
                                                            
                                                               j
                                                            
                                                         
                                                         =
                                                         [
                                                         
                                                            
                                                               h
                                                            
                                                            
                                                               ′
                                                            
                                                         
                                                         (
                                                         0
                                                         )
                                                         ,
                                                         
                                                            
                                                               h
                                                            
                                                            
                                                               ′
                                                            
                                                         
                                                         (
                                                         1
                                                         )
                                                         ,
                                                         …
                                                         ,
                                                         
                                                            
                                                               h
                                                            
                                                            
                                                               ′
                                                            
                                                         
                                                         (
                                                         58
                                                         )
                                                         ]
                                                      
                                                   
                                                   
                                                      
                                                         
                                                            
                                                               h
                                                            
                                                            
                                                               ′
                                                            
                                                         
                                                         (
                                                         i
                                                         )
                                                         =
                                                         h
                                                         (
                                                         i
                                                         )
                                                         /
                                                         
                                                            
                                                               ∑
                                                            
                                                            
                                                               t
                                                               =
                                                               0
                                                            
                                                            
                                                               58
                                                            
                                                         
                                                         h
                                                         (
                                                         t
                                                         )
                                                         ,
                                                         
                                                         i
                                                         =
                                                         0
                                                         ,
                                                         1
                                                         ,
                                                         …
                                                         ,
                                                         58
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                              where 
                                 
                                    h
                                    (
                                    t
                                    )
                                    ,
                                    
                                    t
                                    =
                                    0
                                    ,
                                    1
                                    ,
                                    …
                                    ,
                                    58
                                 
                               is the number of pixels with uniformed LBP pattern value of t.

HOG [37] has been widely accepted as one of the most effective features to capture edge or local shape information in an image. Main calculation process is detailed as follows: Assume the pixel located at (x, y) has a grayscale value 
                                 
                                    f
                                    (
                                    x
                                    ,
                                    y
                                    )
                                 
                              , we adopt a one-dimensional center gradient operator indicated as [−1,0,1] (i.e. Sobel operator), then horizontal and vertical direction difference of pixel 
                                 
                                    f
                                    (
                                    x
                                    ,
                                    y
                                    )
                                 
                               are defined as:
                                 
                                    (6)
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         
                                                            
                                                               g
                                                            
                                                            
                                                               x
                                                            
                                                         
                                                         (
                                                         x
                                                         ,
                                                         y
                                                         )
                                                         =
                                                         f
                                                         (
                                                         x
                                                         +
                                                         1
                                                         ,
                                                         y
                                                         )
                                                         -
                                                         f
                                                         (
                                                         x
                                                         -
                                                         1
                                                         ,
                                                         y
                                                         )
                                                      
                                                   
                                                   
                                                      
                                                         
                                                            
                                                               g
                                                            
                                                            
                                                               y
                                                            
                                                         
                                                         (
                                                         x
                                                         ,
                                                         y
                                                         )
                                                         =
                                                         f
                                                         (
                                                         x
                                                         ,
                                                         y
                                                         +
                                                         1
                                                         )
                                                         -
                                                         f
                                                         (
                                                         x
                                                         ,
                                                         y
                                                         -
                                                         1
                                                         )
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                              Then, the magnitude 
                                 
                                    m
                                    (
                                    x
                                    ,
                                    y
                                    )
                                 
                               and the orientation 
                                 
                                    θ
                                    (
                                    x
                                    ,
                                    y
                                    )
                                 
                               of the gradient 
                                 
                                    
                                       
                                          [
                                          
                                             
                                                g
                                             
                                             
                                                x
                                             
                                          
                                          (
                                          x
                                          ,
                                          y
                                          )
                                          ,
                                          
                                             
                                                g
                                             
                                             
                                                y
                                             
                                          
                                          (
                                          x
                                          ,
                                          y
                                          )
                                          ]
                                       
                                       
                                          T
                                       
                                    
                                 
                               for pixel 
                                 
                                    f
                                    (
                                    x
                                    ,
                                    y
                                    )
                                 
                               can be calculated by [38]:
                                 
                                    (7)
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         m
                                                         (
                                                         x
                                                         ,
                                                         y
                                                         )
                                                         =
                                                         
                                                            
                                                               
                                                                  
                                                                     g
                                                                  
                                                                  
                                                                     x
                                                                  
                                                               
                                                               
                                                                  
                                                                     (
                                                                     x
                                                                     ,
                                                                     y
                                                                     )
                                                                  
                                                                  
                                                                     2
                                                                  
                                                               
                                                               +
                                                               
                                                                  
                                                                     g
                                                                  
                                                                  
                                                                     y
                                                                  
                                                               
                                                               
                                                                  
                                                                     (
                                                                     x
                                                                     ,
                                                                     y
                                                                     )
                                                                  
                                                                  
                                                                     2
                                                                  
                                                               
                                                            
                                                         
                                                      
                                                   
                                                   
                                                      
                                                         θ
                                                         (
                                                         x
                                                         ,
                                                         y
                                                         )
                                                         =
                                                         arctan
                                                         
                                                            
                                                               
                                                                  
                                                                     g
                                                                  
                                                                  
                                                                     y
                                                                  
                                                               
                                                               (
                                                               x
                                                               ,
                                                               y
                                                               )
                                                            
                                                            
                                                               
                                                                  
                                                                     g
                                                                  
                                                                  
                                                                     x
                                                                  
                                                               
                                                               (
                                                               x
                                                               ,
                                                               y
                                                            
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                              The orientation 
                                 
                                    θ
                                    (
                                    x
                                    ,
                                    y
                                    )
                                 
                               with the range 
                                 
                                    [
                                    -
                                    90
                                    °
                                    ,
                                    90
                                    °
                                    ]
                                 
                               in Eq. (7) is mapped to the range 
                                 
                                    [
                                    0
                                    °
                                    ,
                                    360
                                    °
                                    )
                                 
                              . If the gradient 
                                 
                                    
                                       
                                          [
                                          
                                             
                                                g
                                             
                                             
                                                x
                                             
                                          
                                          (
                                          x
                                          ,
                                          y
                                          )
                                          ,
                                          
                                             
                                                g
                                             
                                             
                                                y
                                             
                                          
                                          (
                                          x
                                          ,
                                          y
                                          )
                                          ]
                                       
                                       
                                          T
                                       
                                    
                                 
                               is located in the first quadrant, the mapped orientation is equal to the orientation 
                                 
                                    θ
                                    (
                                    x
                                    ,
                                    y
                                    )
                                 
                              . If the gradient 
                                 
                                    
                                       
                                          [
                                          
                                             
                                                g
                                             
                                             
                                                x
                                             
                                          
                                          (
                                          x
                                          ,
                                          y
                                          )
                                          ,
                                          
                                             
                                                g
                                             
                                             
                                                y
                                             
                                          
                                          (
                                          x
                                          ,
                                          y
                                          )
                                          ]
                                       
                                       
                                          T
                                       
                                    
                                 
                               is located in the second or third quadrants, the mapped orientation is equal to the orientation 
                                 
                                    θ
                                    (
                                    x
                                    ,
                                    y
                                    )
                                    +
                                    180
                                    °
                                 
                              . If the gradient 
                                 
                                    
                                       
                                          [
                                          
                                             
                                                g
                                             
                                             
                                                x
                                             
                                          
                                          (
                                          x
                                          ,
                                          y
                                          )
                                          ,
                                          
                                             
                                                g
                                             
                                             
                                                y
                                             
                                          
                                          (
                                          x
                                          ,
                                          y
                                          )
                                          ]
                                       
                                       
                                          T
                                       
                                    
                                 
                               is located in the fourth quadrant, the mapped orientation is equal to the orientation 
                                 
                                    θ
                                    (
                                    x
                                    ,
                                    y
                                    )
                                    +
                                    360
                                    °
                                 
                              .

The quantization method of [38] is used to evenly divide the gradient orientation into 9 bins from 0° to 180°. An orientation between 180° and 360° is regarded the same as one between 0° and 180° by ignoring the sign of the orientation. For each image block 
                                 
                                    
                                       
                                          B
                                       
                                       
                                          j
                                       
                                    
                                 
                              , the bin k (there k
                              =0,1,…,8) of HOG is obtained by summing all the gradient magnitudes whose orientations belong to bin k within 
                                 
                                    
                                       
                                          B
                                       
                                       
                                          t
                                       
                                    
                                 
                              .
                                 
                                    (8)
                                    
                                       
                                          
                                             E
                                          
                                          
                                             j
                                             ,
                                             k
                                          
                                       
                                       =
                                       
                                          
                                             
                                                ∑
                                             
                                             
                                                
                                                   
                                                      
                                                         (
                                                         x
                                                         ,
                                                         y
                                                         )
                                                         ∈
                                                         
                                                            
                                                               B
                                                            
                                                            
                                                               j
                                                            
                                                         
                                                      
                                                      
                                                         θ
                                                         (
                                                         x
                                                         ,
                                                         y
                                                         )
                                                         ∈
                                                         bin
                                                         
                                                         k
                                                      
                                                   
                                                
                                             
                                          
                                       
                                       m
                                       (
                                       x
                                       ,
                                       y
                                       )
                                    
                                 
                              Finally, the normalized HOG shape feature for image block 
                                 
                                    
                                       
                                          B
                                       
                                       
                                          j
                                       
                                    
                                 
                               can be denoted as follows:
                                 
                                    (9)
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         
                                                            
                                                               Sx
                                                            
                                                            
                                                               j
                                                            
                                                         
                                                         =
                                                         [
                                                         
                                                            
                                                               S
                                                            
                                                            
                                                               j
                                                               ,
                                                               0
                                                            
                                                         
                                                         ,
                                                         
                                                            
                                                               S
                                                            
                                                            
                                                               j
                                                               ,
                                                               1
                                                            
                                                         
                                                         ,
                                                         …
                                                         ,
                                                         
                                                            
                                                               S
                                                            
                                                            
                                                               j
                                                               ,
                                                               8
                                                            
                                                         
                                                         ]
                                                      
                                                   
                                                   
                                                      
                                                         
                                                            
                                                               S
                                                            
                                                            
                                                               j
                                                               ,
                                                               k
                                                            
                                                         
                                                         =
                                                         
                                                            
                                                               ε
                                                               +
                                                               
                                                                  
                                                                     E
                                                                  
                                                                  
                                                                     j
                                                                     ,
                                                                     k
                                                                  
                                                               
                                                            
                                                            
                                                               ε
                                                               +
                                                               
                                                                  
                                                                     ∑
                                                                  
                                                                  
                                                                     k
                                                                     =
                                                                     0
                                                                  
                                                                  
                                                                     8
                                                                  
                                                               
                                                               
                                                                  
                                                                     E
                                                                  
                                                                  
                                                                     j
                                                                     ,
                                                                     k
                                                                  
                                                               
                                                            
                                                         
                                                         ,
                                                         
                                                         k
                                                         =
                                                         0
                                                         ,
                                                         1
                                                         ,
                                                         …
                                                         ,
                                                         8
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                              where 
                                 
                                    
                                       
                                          S
                                       
                                       
                                          j
                                          ,
                                          k
                                       
                                    
                                 
                               is the k-th bin feature of the normalized HOG from block 
                                 
                                    
                                       
                                          B
                                       
                                       
                                          j
                                       
                                    
                                 
                              , and 
                                 
                                    ε
                                 
                               is a very small positive value to avoid division by zero.

Finally, to describe the MIL problem, we use the following notation throughout this paper. Let 
                              
                                 D
                                 =
                                 {
                                 (
                                 
                                    
                                       IMG
                                    
                                    
                                       1
                                    
                                 
                                 ,
                                 
                                    
                                       y
                                    
                                    
                                       1
                                    
                                 
                                 )
                                 ,
                                 (
                                 
                                    
                                       IMG
                                    
                                    
                                       2
                                    
                                 
                                 ,
                                 
                                    
                                       y
                                    
                                    
                                       2
                                    
                                 
                                 )
                                 ,
                                 …
                                 ,
                                 (
                                 
                                    
                                       IMG
                                    
                                    
                                       N
                                    
                                 
                                 ,
                                 
                                    
                                       y
                                    
                                    
                                       N
                                    
                                 
                                 )
                                 }
                              
                            denote the training dataset containing N images, where 
                              
                                 
                                    
                                       y
                                    
                                    
                                       i
                                    
                                 
                                 ∈
                                 {
                                 -
                                 1
                                 ,
                                 +
                                 1
                                 }
                              
                            is the label of image 
                              
                                 
                                    
                                       B
                                    
                                    
                                       i
                                    
                                 
                              
                           , +1/−1 denote it is a pornographic /non-pornographic image. For each image 
                              
                                 
                                    
                                       IMG
                                    
                                    
                                       i
                                    
                                 
                                 ∈
                                 D
                              
                           , let it be partitioned into 
                              
                                 
                                    
                                       n
                                    
                                    
                                       i
                                    
                                 
                              
                            blocks 
                              
                                 {
                                 
                                    
                                       B
                                    
                                    
                                       j
                                    
                                 
                                 :
                                 j
                                 =
                                 1
                                 ,
                                 2
                                 ,
                                 …
                                 ,
                                 
                                    
                                       n
                                    
                                    
                                       i
                                    
                                 
                                 }
                              
                           , and the low-level visual features of the color, texture, and shape for every sub-block are extracted. As a result, the image 
                              
                                 
                                    
                                       IMG
                                    
                                    
                                       i
                                    
                                 
                              
                            is converted to three different types of multi-instance bag, are recorded as:
                              
                                 (10)
                                 
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      ColorBag
                                                      :
                                                   
                                                   
                                                      
                                                         
                                                            BC
                                                         
                                                         
                                                            i
                                                         
                                                      
                                                      =
                                                      {
                                                      
                                                         
                                                            Cx
                                                         
                                                         
                                                            ij
                                                         
                                                      
                                                      :
                                                      j
                                                      =
                                                      1
                                                      ,
                                                      …
                                                      ,
                                                      
                                                         
                                                            n
                                                         
                                                         
                                                            i
                                                         
                                                      
                                                      }
                                                   
                                                
                                                
                                                   
                                                      TextureBag
                                                      :
                                                   
                                                   
                                                      
                                                         
                                                            BT
                                                         
                                                         
                                                            i
                                                         
                                                      
                                                      =
                                                      {
                                                      
                                                         
                                                            Tx
                                                         
                                                         
                                                            ij
                                                         
                                                      
                                                      :
                                                      j
                                                      =
                                                      1
                                                      ,
                                                      …
                                                      ,
                                                      
                                                         
                                                            n
                                                         
                                                         
                                                            i
                                                         
                                                      
                                                      }
                                                   
                                                
                                                
                                                   
                                                      ShapeBag
                                                      :
                                                   
                                                   
                                                      
                                                         
                                                            BS
                                                         
                                                         
                                                            i
                                                         
                                                      
                                                      =
                                                      {
                                                      
                                                         
                                                            Sx
                                                         
                                                         
                                                            ij
                                                         
                                                      
                                                      :
                                                      j
                                                      =
                                                      1
                                                      ,
                                                      …
                                                      ,
                                                      
                                                         
                                                            n
                                                         
                                                         
                                                            i
                                                         
                                                      
                                                      }
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           Here, 
                              
                                 
                                    
                                       Cx
                                    
                                    
                                       ij
                                    
                                 
                              
                           , 
                              
                                 
                                    
                                       Tx
                                    
                                    
                                       ij
                                    
                                 
                              
                            and 
                              
                                 
                                    
                                       Sx
                                    
                                    
                                       ij
                                    
                                 
                              
                            denote the color moment, LBP texture, and HOG shape features of the j-th block respectively, also regarded as instance in the bag. In summary, after the multi-instance modeling by the above method, we can obtain three different multi-instance training bags from the training image set 
                              
                                 D
                                 =
                                 {
                                 (
                                 
                                    
                                       IMG
                                    
                                    
                                       1
                                    
                                 
                                 ,
                                 
                                    
                                       y
                                    
                                    
                                       1
                                    
                                 
                                 )
                                 ,
                                 (
                                 
                                    
                                       IMG
                                    
                                    
                                       2
                                    
                                 
                                 ,
                                 
                                    
                                       y
                                    
                                    
                                       2
                                    
                                 
                                 )
                                 ,
                                 …
                                 ,
                                 (
                                 
                                    
                                       IMG
                                    
                                    
                                       N
                                    
                                 
                                 ,
                                 
                                    
                                       y
                                    
                                    
                                       N
                                    
                                 
                                 )
                                 }
                              
                           , denoted as:
                              
                                 (11)
                                 
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         
                                                            D
                                                         
                                                         
                                                            C
                                                         
                                                      
                                                      =
                                                      {
                                                      
                                                         
                                                            BC
                                                         
                                                         
                                                            1
                                                         
                                                      
                                                      ,
                                                      
                                                         
                                                            BC
                                                         
                                                         
                                                            2
                                                         
                                                      
                                                      ,
                                                      …
                                                      ,
                                                      
                                                         
                                                            BC
                                                         
                                                         
                                                            N
                                                         
                                                      
                                                      }
                                                   
                                                
                                                
                                                   
                                                      
                                                         
                                                            D
                                                         
                                                         
                                                            T
                                                         
                                                      
                                                      =
                                                      {
                                                      
                                                         
                                                            BT
                                                         
                                                         
                                                            1
                                                         
                                                      
                                                      ,
                                                      
                                                         
                                                            BT
                                                         
                                                         
                                                            2
                                                         
                                                      
                                                      ,
                                                      …
                                                      ,
                                                      
                                                         
                                                            BT
                                                         
                                                         
                                                            N
                                                         
                                                      
                                                      }
                                                   
                                                
                                                
                                                   
                                                      
                                                         
                                                            D
                                                         
                                                         
                                                            S
                                                         
                                                      
                                                      =
                                                      {
                                                      
                                                         
                                                            BS
                                                         
                                                         
                                                            1
                                                         
                                                      
                                                      ,
                                                      
                                                         
                                                            BS
                                                         
                                                         
                                                            2
                                                         
                                                      
                                                      ,
                                                      …
                                                      ,
                                                      
                                                         
                                                            BS
                                                         
                                                         
                                                            N
                                                         
                                                      
                                                      }
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           where 
                              
                                 
                                    
                                       D
                                    
                                    
                                       C
                                    
                                 
                              
                           , 
                              
                                 
                                    
                                       D
                                    
                                    
                                       T
                                    
                                 
                              
                            and 
                              
                                 
                                    
                                       D
                                    
                                    
                                       S
                                    
                                 
                              
                            represent the set of color, texture and shape training bags respectively.

Converting each bag in the MIL problem into a single representation vector (metadata), and then using a standard single instance learning (SIL) (i.e. SVM) method to solve the MIL problem, is a very effective MIL algorithms. However, few existing feature representation methods are effective to describe the bags. This makes it difficult to adapt some well-know SIL methods for MIL problems. So in the second stage of the proposed algorithm, we have designed a vocabulary tree based metadata extraction scheme. The proposed metadata extraction method contains of two main steps [39]:
                           
                              (1)
                              Vocabulary tree construction using hierarchical k-means clustering to obtain “visual words”.

Computing the fuzzy-histogram of multi-instance bag based on the “visual words”.

Here, we only use color training bags 
                           
                              
                                 
                                    D
                                 
                                 
                                    C
                                 
                              
                           
                         as an example to explain in detail the process of the fuzzy histogram calculation based on “visual words”.

Let 
                              
                                 
                                    
                                       D
                                    
                                    
                                       c
                                    
                                 
                                 =
                                 {
                                 
                                    
                                       BC
                                    
                                    
                                       1
                                    
                                 
                                 ,
                                 
                                    
                                       BC
                                    
                                    
                                       2
                                    
                                 
                                 ,
                                 …
                                 ,
                                 
                                    
                                       BC
                                    
                                    
                                       N
                                    
                                 
                                 }
                              
                            denote the color training bags, and 
                              
                                 
                                    
                                       BC
                                    
                                    
                                       i
                                    
                                 
                                 =
                                 {
                                 
                                    
                                       Cx
                                    
                                    
                                       i
                                       1
                                    
                                 
                                 ,
                                 
                                    
                                       Cx
                                    
                                    
                                       i
                                       2
                                    
                                 
                                 ,
                                 …
                                 ,
                                 
                                    
                                       Cx
                                    
                                    
                                       
                                          
                                             in
                                          
                                          
                                             i
                                          
                                       
                                    
                                 
                                 }
                              
                            is the i-th bag consists with 
                              
                                 
                                    
                                       n
                                    
                                    
                                       i
                                    
                                 
                              
                            instances. We line up all instances in training bags and re-index them as 
                              
                                 InstSet
                                 =
                                 {
                                 
                                    
                                       Cx
                                    
                                    
                                       i
                                    
                                 
                                 |
                                 i
                                 =
                                 1
                                 ,
                                 …
                                 ,
                                 T
                                 .
                                 }
                              
                           , where 
                              
                                 T
                                 =
                                 
                                    
                                       ∑
                                    
                                    
                                       i
                                       =
                                       1
                                    
                                    
                                       N
                                    
                                 
                                 
                                    
                                       n
                                    
                                    
                                       i
                                    
                                 
                              
                            is the total number of instances within the training bags. In order to construct a VT, vector points from 
                              
                                 InstSet
                              
                            are used as the training vectors, then these training vectors are partitioned into different groups using hierarchical k-means clustering technique. The detailed steps can be summarized as follows [39,40]:
                              
                                 
                                    
                                    
                                       
                                          
                                             Algorithm 1: Construction VT
                                       
                                    
                                    
                                       
                                          Input: A set of vector points; branching factor K; maximum level L.
                                       
                                       
                                          Output: vocabulary tree and visual words.
                                       
                                       
                                          
                                             
                                                
                                                   ①
                                                
                                              Select T numbers of the vector points as training vectors.
                                       
                                       
                                          
                                             
                                                
                                                   ②
                                                
                                              At the level l clustering, T number of training vectors are grouped into k clusters using k-means clustering algorithm.
                                       
                                       
                                          
                                             
                                                
                                                   ③
                                                
                                              Store the respective cluster centers and cluster members.
                                       
                                       
                                          
                                             
                                                
                                                   ④
                                                
                                              If the number of vector points belong to a cluster is more than K, the same process shown in step 2 and 3 is then recursively applied to the clusters of vector points so that the cluster members of respective group is further partitioned into k-groups.
                                       
                                       
                                          
                                             
                                                
                                                   ⑤
                                                
                                              This recursive process is continuing up-to maximum L levels.
                                       
                                    
                                 
                              
                           Finally, each leaf of the tree or lowest level cluster center (centroid) represents a “visual word (VW)”, as shown in Fig. 4
                           .

Let 
                              
                                 Ω
                                 =
                                 {
                                 
                                    
                                       Cv
                                    
                                    
                                       1
                                    
                                 
                                 ,
                                 
                                    
                                       Cv
                                    
                                    
                                       2
                                    
                                 
                                 ,
                                 …
                                 ,
                                 
                                    
                                       Cv
                                    
                                    
                                       
                                          
                                             K
                                          
                                          
                                             C
                                          
                                       
                                    
                                 
                                 }
                              
                            be a collection of VW obtained by Algorithm 1 corresponding to color bags 
                              
                                 
                                    
                                       D
                                    
                                    
                                       C
                                    
                                 
                              
                           , where 
                              
                                 
                                    
                                       Cv
                                    
                                    
                                       i
                                    
                                 
                              
                            is the i-th VW, 
                              
                                 
                                    
                                       K
                                    
                                    
                                       C
                                    
                                 
                              
                            is the total number of VW. We define bag’s mapping feature, 
                              
                                 ϕ
                                 (
                                 
                                    
                                       BC
                                    
                                    
                                       i
                                    
                                 
                                 )
                              
                           , for a bag 
                              
                                 
                                    
                                       BC
                                    
                                    
                                       i
                                    
                                 
                                 =
                                 {
                                 
                                    
                                       Cx
                                    
                                    
                                       ij
                                    
                                 
                                 |
                                 j
                                 =
                                 1
                                 ,
                                 2
                                 ,
                                 …
                                 ,
                                 
                                    
                                       n
                                    
                                    
                                       i
                                    
                                 
                                 }
                              
                           , as [15]:
                              
                                 (12)
                                 
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         
                                                            ϕ
                                                         
                                                         
                                                            C
                                                         
                                                      
                                                      (
                                                      
                                                         
                                                            BC
                                                         
                                                         
                                                            i
                                                         
                                                      
                                                      )
                                                      =
                                                      [
                                                      s
                                                      (
                                                      
                                                         
                                                            Cv
                                                         
                                                         
                                                            1
                                                         
                                                      
                                                      ,
                                                      
                                                         
                                                            BC
                                                         
                                                         
                                                            i
                                                         
                                                      
                                                      )
                                                      ,
                                                      s
                                                      (
                                                      
                                                         
                                                            Cv
                                                         
                                                         
                                                            2
                                                         
                                                      
                                                      ,
                                                      
                                                         
                                                            BC
                                                         
                                                         
                                                            i
                                                         
                                                      
                                                      )
                                                      ,
                                                      …
                                                      ,
                                                      s
                                                      (
                                                      
                                                         
                                                            Cv
                                                         
                                                         
                                                            
                                                               
                                                                  K
                                                               
                                                               
                                                                  C
                                                               
                                                            
                                                         
                                                      
                                                      ,
                                                      
                                                         
                                                            BC
                                                         
                                                         
                                                            i
                                                         
                                                      
                                                      )
                                                      ]
                                                   
                                                
                                                
                                                   
                                                      s
                                                      (
                                                      
                                                         
                                                            Cv
                                                         
                                                         
                                                            t
                                                         
                                                      
                                                      ,
                                                      
                                                         
                                                            BC
                                                         
                                                         
                                                            i
                                                         
                                                      
                                                      )
                                                      =
                                                      
                                                         
                                                            ∑
                                                         
                                                         
                                                            j
                                                            =
                                                            1
                                                         
                                                         
                                                            
                                                               
                                                                  n
                                                               
                                                               
                                                                  i
                                                               
                                                            
                                                         
                                                      
                                                      exp
                                                      (
                                                      -
                                                      ‖
                                                      
                                                         
                                                            Cx
                                                         
                                                         
                                                            ij
                                                         
                                                      
                                                      -
                                                      
                                                         
                                                            Cv
                                                         
                                                         
                                                            t
                                                         
                                                      
                                                      
                                                         
                                                            ‖
                                                         
                                                         
                                                            2
                                                         
                                                      
                                                      )
                                                      ,
                                                      
                                                      t
                                                      =
                                                      1
                                                      ,
                                                      2
                                                      ,
                                                      …
                                                      ,
                                                      
                                                         
                                                            K
                                                         
                                                         
                                                            C
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           where 
                              
                                 s
                                 (
                                 
                                    
                                       Cv
                                    
                                    
                                       t
                                    
                                 
                                 ,
                                 
                                    
                                       BC
                                    
                                    
                                       i
                                    
                                 
                                 )
                              
                            can be interpreted as a fuzzy frequency of “visual-word” 
                              
                                 
                                    
                                       Cv
                                    
                                    
                                       t
                                    
                                 
                              
                            in a bag 
                              
                                 
                                    
                                       BC
                                    
                                    
                                       i
                                    
                                 
                              
                           , which is determined by all the instances in this bag. Note that, before use the fuzzy histogram vector 
                              
                                 s
                                 (
                                 
                                    
                                       Cv
                                    
                                    
                                       t
                                    
                                 
                                 ,
                                 
                                    
                                       BC
                                    
                                    
                                       i
                                    
                                 
                                 )
                              
                           , we must carry out the following normalization:
                              
                                 (13)
                                 
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         
                                                            H
                                                         
                                                         
                                                            ‾
                                                         
                                                      
                                                      (
                                                      
                                                         
                                                            BC
                                                         
                                                         
                                                            i
                                                         
                                                      
                                                      )
                                                      =
                                                      [
                                                      
                                                         
                                                            s
                                                         
                                                         
                                                            ′
                                                         
                                                      
                                                      (
                                                      
                                                         
                                                            Cv
                                                         
                                                         
                                                            1
                                                         
                                                      
                                                      ,
                                                      
                                                         
                                                            BC
                                                         
                                                         
                                                            i
                                                         
                                                      
                                                      )
                                                      ,
                                                      
                                                         
                                                            s
                                                         
                                                         
                                                            ′
                                                         
                                                      
                                                      (
                                                      
                                                         
                                                            Cv
                                                         
                                                         
                                                            2
                                                         
                                                      
                                                      ,
                                                      
                                                         
                                                            BC
                                                         
                                                         
                                                            i
                                                         
                                                      
                                                      )
                                                      ,
                                                      …
                                                      ,
                                                      
                                                         
                                                            s
                                                         
                                                         
                                                            ′
                                                         
                                                      
                                                      (
                                                      
                                                         
                                                            Cv
                                                         
                                                         
                                                            
                                                               
                                                                  K
                                                               
                                                               
                                                                  C
                                                               
                                                            
                                                         
                                                      
                                                      ,
                                                      
                                                         
                                                            BC
                                                         
                                                         
                                                            i
                                                         
                                                      
                                                      )
                                                      ]
                                                   
                                                
                                                
                                                   
                                                      
                                                         
                                                            s
                                                         
                                                         
                                                            ′
                                                         
                                                      
                                                      (
                                                      
                                                         
                                                            Cv
                                                         
                                                         
                                                            k
                                                         
                                                      
                                                      ,
                                                      
                                                         
                                                            BC
                                                         
                                                         
                                                            i
                                                         
                                                      
                                                      )
                                                      =
                                                      s
                                                      (
                                                      
                                                         
                                                            Cv
                                                         
                                                         
                                                            k
                                                         
                                                      
                                                      ,
                                                      
                                                         
                                                            BC
                                                         
                                                         
                                                            i
                                                         
                                                      
                                                      )
                                                      /
                                                      
                                                         
                                                            ∑
                                                         
                                                         
                                                            t
                                                            =
                                                            1
                                                         
                                                         
                                                            
                                                               
                                                                  K
                                                               
                                                               
                                                                  C
                                                               
                                                            
                                                         
                                                      
                                                      s
                                                      (
                                                      
                                                         
                                                            Cv
                                                         
                                                         
                                                            t
                                                         
                                                      
                                                      ,
                                                      
                                                         
                                                            BC
                                                         
                                                         
                                                            i
                                                         
                                                      
                                                      )
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           where 
                              
                                 k
                                 =
                                 1
                                 ,
                                 2
                                 ,
                                 …
                                 ,
                                 
                                    
                                       K
                                    
                                    
                                       C
                                    
                                 
                              
                           . By using Eq. (13), the bag 
                              
                                 
                                    
                                       BC
                                    
                                    
                                       i
                                    
                                 
                              
                            will be represented by a KC
                           -dimensional normalized fuzzy histogram 
                              
                                 
                                    
                                       H
                                    
                                    
                                       ‾
                                    
                                 
                                 (
                                 
                                    
                                       BC
                                    
                                    
                                       i
                                    
                                 
                                 )
                              
                           .

Using the method mentioned above, based on the set of training texture bags 
                              
                                 
                                    
                                       D
                                    
                                    
                                       T
                                    
                                 
                              
                            and shape bags 
                              
                                 
                                    
                                       D
                                    
                                    
                                       S
                                    
                                 
                              
                           , we also can obtain the fuzzy histograms of bag 
                              
                                 
                                    
                                       BT
                                    
                                    
                                       i
                                    
                                 
                              
                            and 
                              
                                 
                                    
                                       BS
                                    
                                    
                                       i
                                    
                                 
                              
                            as follow:
                              
                                 (14)
                                 
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         
                                                            H
                                                         
                                                         
                                                            ‾
                                                         
                                                      
                                                      (
                                                      
                                                         
                                                            BT
                                                         
                                                         
                                                            i
                                                         
                                                      
                                                      )
                                                      =
                                                      [
                                                      
                                                         
                                                            s
                                                         
                                                         
                                                            ′
                                                         
                                                      
                                                      (
                                                      
                                                         
                                                            Tv
                                                         
                                                         
                                                            1
                                                         
                                                      
                                                      ,
                                                      
                                                         
                                                            BT
                                                         
                                                         
                                                            i
                                                         
                                                      
                                                      )
                                                      ,
                                                      
                                                         
                                                            s
                                                         
                                                         
                                                            ′
                                                         
                                                      
                                                      (
                                                      
                                                         
                                                            Tv
                                                         
                                                         
                                                            2
                                                         
                                                      
                                                      ,
                                                      
                                                         
                                                            BT
                                                         
                                                         
                                                            i
                                                         
                                                      
                                                      )
                                                      ,
                                                      …
                                                      ,
                                                      
                                                         
                                                            s
                                                         
                                                         
                                                            ′
                                                         
                                                      
                                                      (
                                                      
                                                         
                                                            Tv
                                                         
                                                         
                                                            
                                                               
                                                                  K
                                                               
                                                               
                                                                  T
                                                               
                                                            
                                                         
                                                      
                                                      ,
                                                      
                                                         
                                                            BT
                                                         
                                                         
                                                            i
                                                         
                                                      
                                                      )
                                                      ]
                                                   
                                                
                                                
                                                   
                                                      
                                                         
                                                            s
                                                         
                                                         
                                                            ′
                                                         
                                                      
                                                      (
                                                      
                                                         
                                                            Tv
                                                         
                                                         
                                                            k
                                                         
                                                      
                                                      ,
                                                      
                                                         
                                                            BT
                                                         
                                                         
                                                            i
                                                         
                                                      
                                                      )
                                                      =
                                                      s
                                                      (
                                                      
                                                         
                                                            Tv
                                                         
                                                         
                                                            k
                                                         
                                                      
                                                      ,
                                                      
                                                         
                                                            BC
                                                         
                                                         
                                                            i
                                                         
                                                      
                                                      )
                                                      /
                                                      
                                                         
                                                            ∑
                                                         
                                                         
                                                            t
                                                            =
                                                            1
                                                         
                                                         
                                                            
                                                               
                                                                  K
                                                               
                                                               
                                                                  T
                                                               
                                                            
                                                         
                                                      
                                                      s
                                                      (
                                                      
                                                         
                                                            Tv
                                                         
                                                         
                                                            t
                                                         
                                                      
                                                      ,
                                                      
                                                         
                                                            BT
                                                         
                                                         
                                                            i
                                                         
                                                      
                                                      )
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           
                           
                              
                                 (15)
                                 
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         
                                                            H
                                                         
                                                         
                                                            ‾
                                                         
                                                      
                                                      (
                                                      
                                                         
                                                            BS
                                                         
                                                         
                                                            i
                                                         
                                                      
                                                      )
                                                      =
                                                      [
                                                      
                                                         
                                                            s
                                                         
                                                         
                                                            ′
                                                         
                                                      
                                                      (
                                                      
                                                         
                                                            Sv
                                                         
                                                         
                                                            1
                                                         
                                                      
                                                      ,
                                                      
                                                         
                                                            BS
                                                         
                                                         
                                                            i
                                                         
                                                      
                                                      )
                                                      ,
                                                      
                                                         
                                                            s
                                                         
                                                         
                                                            ′
                                                         
                                                      
                                                      (
                                                      
                                                         
                                                            Sv
                                                         
                                                         
                                                            2
                                                         
                                                      
                                                      ,
                                                      
                                                         
                                                            BS
                                                         
                                                         
                                                            i
                                                         
                                                      
                                                      )
                                                      ,
                                                      …
                                                      ,
                                                      
                                                         
                                                            s
                                                         
                                                         
                                                            ′
                                                         
                                                      
                                                      (
                                                      
                                                         
                                                            Sv
                                                         
                                                         
                                                            
                                                               
                                                                  K
                                                               
                                                               
                                                                  T
                                                               
                                                            
                                                         
                                                      
                                                      ,
                                                      
                                                         
                                                            BS
                                                         
                                                         
                                                            i
                                                         
                                                      
                                                      )
                                                      ]
                                                   
                                                
                                                
                                                   
                                                      
                                                         
                                                            s
                                                         
                                                         
                                                            ′
                                                         
                                                      
                                                      (
                                                      
                                                         
                                                            Sv
                                                         
                                                         
                                                            k
                                                         
                                                      
                                                      ,
                                                      
                                                         
                                                            BS
                                                         
                                                         
                                                            i
                                                         
                                                      
                                                      )
                                                      =
                                                      s
                                                      (
                                                      
                                                         
                                                            Sv
                                                         
                                                         
                                                            k
                                                         
                                                      
                                                      ,
                                                      
                                                         
                                                            BS
                                                         
                                                         
                                                            i
                                                         
                                                      
                                                      )
                                                      /
                                                      
                                                         
                                                            ∑
                                                         
                                                         
                                                            t
                                                            =
                                                            1
                                                         
                                                         
                                                            
                                                               
                                                                  K
                                                               
                                                               
                                                                  S
                                                               
                                                            
                                                         
                                                      
                                                      s
                                                      (
                                                      
                                                         
                                                            Sv
                                                         
                                                         
                                                            t
                                                         
                                                      
                                                      ,
                                                      
                                                         
                                                            BS
                                                         
                                                         
                                                            i
                                                         
                                                      
                                                      )
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           Here 
                              
                                 
                                    
                                       Tv
                                    
                                    
                                       t
                                    
                                 
                                 (
                                 t
                                 =
                                 1
                                 ,
                                 2
                                 ,
                                 …
                                 ,
                                 
                                    
                                       K
                                    
                                    
                                       T
                                    
                                 
                                 )
                                 ,
                                 
                                    
                                       Sv
                                    
                                    
                                       t
                                    
                                 
                                 (
                                 t
                                 =
                                 1
                                 ,
                                 2
                                 ,
                                 …
                                 ,
                                 
                                    
                                       K
                                    
                                    
                                       S
                                    
                                 
                                 )
                              
                            donate the VW obtain from 
                              
                                 
                                    
                                       D
                                    
                                    
                                       T
                                    
                                 
                              
                            and 
                              
                                 
                                    
                                       D
                                    
                                    
                                       S
                                    
                                 
                              
                           , 
                              
                                 
                                    
                                       K
                                    
                                    
                                       T
                                    
                                 
                                 ,
                                 
                                    
                                       K
                                    
                                    
                                       S
                                    
                                 
                              
                            donate the number of VW respectively. At the last, the metadata of the three different bags, i.e. 
                              
                                 
                                    
                                       BC
                                    
                                    
                                       i
                                    
                                 
                              
                           , 
                              
                                 
                                    
                                       BT
                                    
                                    
                                       i
                                    
                                 
                              
                            and 
                              
                                 
                                    
                                       BS
                                    
                                    
                                       i
                                    
                                 
                              
                            for each image 
                              
                                 
                                    
                                       IMG
                                    
                                    
                                       i
                                    
                                 
                              
                           , can be defined as:
                              
                                 (16)
                                 
                                    ϕ
                                    (
                                    
                                       
                                          IMG
                                       
                                       
                                          i
                                       
                                    
                                    )
                                    =
                                    [
                                    
                                       
                                          H
                                       
                                       
                                          ‾
                                       
                                    
                                    (
                                    
                                       
                                          BC
                                       
                                       
                                          i
                                       
                                    
                                    )
                                    ,
                                    
                                       
                                          H
                                       
                                       
                                          ‾
                                       
                                    
                                    (
                                    
                                       
                                          BT
                                       
                                       
                                          i
                                       
                                    
                                    )
                                    ,
                                    
                                       
                                          H
                                       
                                       
                                          ‾
                                       
                                    
                                    (
                                    
                                       
                                          BS
                                       
                                       
                                          i
                                       
                                    
                                    )
                                    ]
                                 
                              
                           where 
                              
                                 ϕ
                                 (
                                 
                                    
                                       IMG
                                    
                                    
                                       i
                                    
                                 
                                 )
                              
                            is a 
                              
                                 
                                    
                                       K
                                    
                                    
                                       C
                                    
                                 
                                 +
                                 
                                    
                                       K
                                    
                                    
                                       T
                                    
                                 
                                 +
                                 
                                    
                                       K
                                    
                                    
                                       S
                                    
                                 
                              
                            dimensional feature vector, it is equivalent to fusion the three fuzzy histograms together as one feature vector. The diagram of the proposed metadata extraction method is shown in Fig. 5
                           . As a result, the image is representing by a single sample (metadata). If the label of an image is +1, the corresponding sample is labeled as +1, otherwise labeled as −1. Therefore, the MIL problem transforms into a standard SIL problem, so it can be resolved by the following ELM directly.

ELM was proposed by Huang et al. in [32] as a machine learning algorithm for single-hidden layer feed forward neural network (SLFN). The method can overcome the speed barrier faced by other classic machine learning algorithms and provides better generalization performance over the gradient-based training methods. So the ELM algorithm is used efficiently in many image retrieval or classification applications. The ELM aims at minimizing the training error and the norm of the output weights. The key point of ELM is that it needs no iteration when determining the parameters, which results in less computational time for training the SLFNs [32,41–43].

For a training set consisting of N arbitrary distinct samples 
                              
                                 D
                                 =
                                 {
                                 (
                                 
                                    
                                       x
                                    
                                    
                                       j
                                    
                                 
                                 ,
                                 
                                    
                                       t
                                    
                                    
                                       j
                                    
                                 
                                 )
                                 |
                                 j
                                 =
                                 1
                                 ,
                                 2
                                 ,
                                 …
                                 ,
                                 N
                                 }
                              
                           , where 
                              
                                 
                                    
                                       x
                                    
                                    
                                       j
                                    
                                 
                                 =
                                 
                                    
                                       [
                                       
                                          
                                             x
                                          
                                          
                                             j
                                             1
                                          
                                       
                                       ,
                                       
                                          
                                             x
                                          
                                          
                                             j
                                             2
                                          
                                       
                                       ,
                                       …
                                       ,
                                       
                                          
                                             x
                                          
                                          
                                             jn
                                          
                                       
                                       ]
                                    
                                    
                                       T
                                    
                                 
                                 ∈
                                 
                                    
                                       R
                                    
                                    
                                       n
                                    
                                 
                              
                            and 
                              
                                 
                                    
                                       t
                                    
                                    
                                       j
                                    
                                 
                                 =
                                 
                                    
                                       [
                                       
                                          
                                             t
                                          
                                          
                                             j
                                             1
                                          
                                       
                                       ,
                                       
                                          
                                             t
                                          
                                          
                                             j
                                             2
                                          
                                       
                                       ,
                                       …
                                       ,
                                       
                                          
                                             t
                                          
                                          
                                             jm
                                          
                                       
                                       ]
                                    
                                    
                                       T
                                    
                                 
                                 ∈
                                 
                                    
                                       R
                                    
                                    
                                       m
                                    
                                 
                              
                           , a standard ELM with 
                              
                                 P
                              
                            hidden nodes is formulated as below:
                              
                                 (17)
                                 
                                    
                                       
                                          f
                                       
                                       
                                          P
                                       
                                    
                                    (
                                    
                                       
                                          x
                                       
                                       
                                          j
                                       
                                    
                                    )
                                    =
                                    
                                       
                                          
                                             ∑
                                          
                                          
                                             i
                                             =
                                             1
                                          
                                          
                                             P
                                          
                                       
                                    
                                    
                                       
                                          β
                                       
                                       
                                          i
                                       
                                    
                                    g
                                    (
                                    
                                       
                                          w
                                       
                                       
                                          i
                                       
                                    
                                    
                                       
                                          x
                                       
                                       
                                          j
                                       
                                    
                                    +
                                    
                                       
                                          b
                                       
                                       
                                          i
                                       
                                    
                                    )
                                    =
                                    
                                       
                                          t
                                       
                                       
                                          j
                                       
                                    
                                    ,
                                    
                                    j
                                    =
                                    1
                                    ,
                                    2
                                    ,
                                    …
                                    ,
                                    N
                                 
                              
                           where 
                              
                                 g
                                 (
                                 x
                                 )
                              
                            is an activation function used as a n-dimensional weight vector connecting i-th hidden node with input neurons. When using 
                              
                                 P
                              
                            hidden nodes to approximate N samples, 
                              
                                 
                                    
                                       β
                                    
                                    
                                       i
                                    
                                 
                                 ,
                                 
                                    
                                       w
                                    
                                    
                                       i
                                    
                                 
                              
                            and 
                              
                                 
                                    
                                       b
                                    
                                    
                                       i
                                    
                                 
                              
                            are supposed to exist if zero error is to be obtained. Hence the Eq. (17) is modeled as the Eq. (18) with a more compact format.
                              
                                 (18)
                                 
                                    H
                                    β
                                    =
                                    T
                                 
                              
                           where
                              
                                 (19)
                                 
                                    
                                       
                                          
                                             H
                                             =
                                             
                                                
                                                   
                                                      
                                                         
                                                            
                                                               
                                                                  g
                                                                  (
                                                                  
                                                                     
                                                                        w
                                                                     
                                                                     
                                                                        1
                                                                     
                                                                  
                                                                  •
                                                                  
                                                                     
                                                                        x
                                                                     
                                                                     
                                                                        1
                                                                     
                                                                  
                                                                  +
                                                                  
                                                                     
                                                                        b
                                                                     
                                                                     
                                                                        1
                                                                     
                                                                  
                                                                  )
                                                               
                                                               
                                                                  ⋯
                                                               
                                                               
                                                                  g
                                                                  (
                                                                  
                                                                     
                                                                        w
                                                                     
                                                                     
                                                                        P
                                                                     
                                                                  
                                                                  •
                                                                  
                                                                     
                                                                        x
                                                                     
                                                                     
                                                                        1
                                                                     
                                                                  
                                                                  +
                                                                  
                                                                     
                                                                        b
                                                                     
                                                                     
                                                                        P
                                                                     
                                                                  
                                                                  )
                                                               
                                                            
                                                            
                                                               
                                                                  ⋮
                                                               
                                                               
                                                                  ⋱
                                                               
                                                               
                                                                  ⋮
                                                               
                                                            
                                                            
                                                               
                                                                  g
                                                                  (
                                                                  
                                                                     
                                                                        w
                                                                     
                                                                     
                                                                        1
                                                                     
                                                                  
                                                                  •
                                                                  
                                                                     
                                                                        x
                                                                     
                                                                     
                                                                        N
                                                                     
                                                                  
                                                                  +
                                                                  
                                                                     
                                                                        b
                                                                     
                                                                     
                                                                        1
                                                                     
                                                                  
                                                                  )
                                                               
                                                               
                                                                  ⋯
                                                               
                                                               
                                                                  g
                                                                  (
                                                                  
                                                                     
                                                                        w
                                                                     
                                                                     
                                                                        P
                                                                     
                                                                  
                                                                  •
                                                                  
                                                                     
                                                                        x
                                                                     
                                                                     
                                                                        N
                                                                     
                                                                  
                                                                  +
                                                                  
                                                                     
                                                                        b
                                                                     
                                                                     
                                                                        P
                                                                     
                                                                  
                                                                  )
                                                               
                                                            
                                                         
                                                      
                                                   
                                                
                                                
                                                   N
                                                   ×
                                                   P
                                                
                                             
                                          
                                       
                                       
                                          
                                             
                                                
                                                   β
                                                
                                                
                                                   ⌢
                                                
                                             
                                             =
                                             
                                                
                                                   
                                                      
                                                         
                                                            
                                                               
                                                                  
                                                                     
                                                                        β
                                                                     
                                                                     
                                                                        11
                                                                     
                                                                  
                                                               
                                                               
                                                                  
                                                                     
                                                                        β
                                                                     
                                                                     
                                                                        12
                                                                     
                                                                  
                                                               
                                                               
                                                                  ⋯
                                                               
                                                               
                                                                  
                                                                     
                                                                        β
                                                                     
                                                                     
                                                                        1
                                                                        m
                                                                     
                                                                  
                                                               
                                                            
                                                            
                                                               
                                                                  ⋮
                                                               
                                                               
                                                               
                                                                  ⋱
                                                               
                                                               
                                                                  ⋮
                                                               
                                                            
                                                            
                                                               
                                                                  
                                                                     
                                                                        β
                                                                     
                                                                     
                                                                        P
                                                                        1
                                                                     
                                                                  
                                                               
                                                               
                                                                  
                                                                     
                                                                        β
                                                                     
                                                                     
                                                                        P
                                                                        2
                                                                     
                                                                  
                                                               
                                                               
                                                                  ⋯
                                                               
                                                               
                                                                  
                                                                     
                                                                        β
                                                                     
                                                                     
                                                                        Pm
                                                                     
                                                                  
                                                               
                                                            
                                                         
                                                      
                                                   
                                                
                                                
                                                   P
                                                   ×
                                                   m
                                                
                                             
                                             
                                             and
                                             
                                             T
                                             =
                                             
                                                
                                                   
                                                      
                                                         
                                                            
                                                               
                                                                  
                                                                     
                                                                        t
                                                                     
                                                                     
                                                                        11
                                                                     
                                                                  
                                                               
                                                               
                                                                  
                                                                     
                                                                        t
                                                                     
                                                                     
                                                                        12
                                                                     
                                                                  
                                                               
                                                               
                                                                  ⋯
                                                               
                                                               
                                                                  
                                                                     
                                                                        t
                                                                     
                                                                     
                                                                        1
                                                                        m
                                                                     
                                                                  
                                                               
                                                            
                                                            
                                                               
                                                                  ⋮
                                                               
                                                               
                                                               
                                                                  ⋱
                                                               
                                                               
                                                                  ⋮
                                                               
                                                            
                                                            
                                                               
                                                                  
                                                                     
                                                                        t
                                                                     
                                                                     
                                                                        N
                                                                        1
                                                                     
                                                                  
                                                               
                                                               
                                                                  
                                                                     
                                                                        t
                                                                     
                                                                     
                                                                        N
                                                                        2
                                                                     
                                                                  
                                                               
                                                               
                                                                  ⋯
                                                               
                                                               
                                                                  
                                                                     
                                                                        t
                                                                     
                                                                     
                                                                        Nm
                                                                     
                                                                  
                                                               
                                                            
                                                         
                                                      
                                                   
                                                
                                                
                                                   N
                                                   ×
                                                   m
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           where H is called the hidden layer output matrix of the neural network. The i-th column of H is the output of the i-th hidden node with respect to inputs 
                              
                                 
                                    
                                       x
                                    
                                    
                                       1
                                    
                                 
                                 ,
                                 
                                    
                                       x
                                    
                                    
                                       2
                                    
                                 
                                 ,
                                 …
                                 ,
                                 
                                    
                                       x
                                    
                                    
                                       N
                                    
                                 
                              
                           . Considering the hidden nodes should be always less than the number of training samples N in practical application, Huang et al. [17] proposed randomly assigning values for parameters 
                              
                                 
                                    
                                       w
                                    
                                    
                                       i
                                    
                                 
                              
                            and 
                              
                                 
                                    
                                       b
                                    
                                    
                                       i
                                    
                                 
                              
                           , and thus the system becomes linear so that the output weights can be estimated by 
                              
                                 
                                    
                                       β
                                    
                                    
                                       ̃
                                    
                                 
                                 =
                                 
                                    
                                       H
                                    
                                    
                                       †
                                    
                                 
                                 T
                              
                           , where 
                              
                                 
                                    
                                       H
                                    
                                    
                                       †
                                    
                                 
                              
                            is the Moore–Penrose generalized inverse of the hidden layer output matrix H. Consequently, there are three steps to learn the model [41–43]:


                           
                              
                                 (1)
                                 Assign randomly input weight vectors or centers 
                                       
                                          
                                             
                                                w
                                             
                                             
                                                i
                                             
                                          
                                       
                                     and hidden node bias of impact factor 
                                       
                                          
                                             
                                                b
                                             
                                             
                                                i
                                             
                                          
                                       
                                    , i
                                    =1,2,…,
                                    L, where L is the number of hidden nodes.

Calculate the hidden layer output matrix H.

Calculate the output weight: 
                                       
                                          
                                             
                                                β
                                             
                                             
                                                ̃
                                             
                                          
                                          =
                                          
                                             
                                                H
                                             
                                             
                                                †
                                             
                                          
                                          T
                                       
                                    .

Based on the metadata extraction from training images according to the Fig. 5, a bag-level MIL classifier can be trained by using the ELM to perform pornographic images recognition. In the research, this algorithm was denoted as ELM-MIL. Then, for any test image IMG, the output function of ELM can be modeled as follows.
                              
                                 (20)
                                 
                                    F
                                    (
                                    IMG
                                    )
                                    =
                                    h
                                    (
                                    ϕ
                                    (
                                    IMG
                                    )
                                    )
                                    
                                       
                                          β
                                       
                                       
                                          ̃
                                       
                                    
                                    =
                                    h
                                    (
                                    ϕ
                                    (
                                    IMG
                                    )
                                    )
                                    
                                       
                                          H
                                       
                                       
                                          †
                                       
                                    
                                    T
                                 
                              
                           There 
                              
                                 h
                                 (
                                 x
                                 )
                                 =
                                 [
                                 g
                                 (
                                 
                                    
                                       w
                                    
                                    
                                       1
                                    
                                 
                                 •
                                 
                                    
                                       x
                                    
                                    
                                       1
                                    
                                 
                                 +
                                 
                                    
                                       b
                                    
                                    
                                       1
                                    
                                 
                                 )
                                 ,
                                 g
                                 (
                                 
                                    
                                       w
                                    
                                    
                                       1
                                    
                                 
                                 •
                                 
                                    
                                       x
                                    
                                    
                                       1
                                    
                                 
                                 +
                                 
                                    
                                       b
                                    
                                    
                                       1
                                    
                                 
                                 )
                                 ,
                                 ⋯
                                 ,
                                 g
                                 (
                                 
                                    
                                       w
                                    
                                    
                                       P
                                    
                                 
                                 •
                                 
                                    
                                       x
                                    
                                    
                                       1
                                    
                                 
                                 +
                                 
                                    
                                       b
                                    
                                    
                                       P
                                    
                                 
                                 )
                                 ]
                              
                           .

The classifiers ensemble strategy is used in this research, the reasons are: 
                              
                                 ①
                              
                            ELM has been proved to be an extremely fast learning algorithm in practice. The reason is that ELM randomly chooses the input weights 
                              
                                 
                                    
                                       w
                                    
                                    
                                       i
                                    
                                 
                              
                            and bias 
                              
                                 
                                    
                                       b
                                    
                                    
                                       i
                                    
                                 
                              
                            of the SLFNs instead of tuning. However, the hidden layer output matrix H may not be full column rank or singular by using this method, which will enlarges training error and lowers prediction accuracy [41–43]. 
                              
                                 ②
                              
                            Different recognition results will be obtained based on the ELM with different number of hidden nodes, and there is no uniformed criterion available for judging which number of hidden nodes 
                              
                                 P
                              
                            is the best for the pornographic images recognition problem by only using the ELM-MIL algorithm. Therefore, our proposed algorithm is to construct a group of classifiers based on ELM with different number of hidden nodes and then combine their predictions. The classifier algorithm, named as ELMCE-MIL, can obtain higher recognition accuracy and also achieve stronger generalization performance than any single classifier of this ensemble system [44]. In general, a classifier ensemble framework consists of two steps, i.e., base classifiers construction and classifiers combination.

In ELMCE-MIL, diverse base classifiers can be easily obtained because they can be constructed based on the ELM with different numbers of hidden nodes. In other word, many ELM-MIL classifiers can be trained separately when the number of hidden node 
                              
                                 P
                              
                            is changed for ELM. To combine those classifiers, two main methods can be used: weighting and meta-learning [44,45]. In this paper, the performance weighting rule can be dynamically determine the weights of the different base classifiers [44,45]. The weight 
                              
                                 
                                    
                                       w
                                    
                                    
                                       i
                                    
                                 
                              
                            of each base classifier 
                              
                                 
                                    
                                       F
                                    
                                    
                                       i
                                    
                                 
                                 (
                                 IMG
                                 )
                              
                            can be set as:
                              
                                 (21)
                                 
                                    
                                       
                                          w
                                       
                                       
                                          i
                                       
                                    
                                    =
                                    
                                       
                                          1
                                          -
                                          
                                             
                                                E
                                             
                                             
                                                i
                                             
                                          
                                       
                                       
                                          
                                             
                                                ∑
                                             
                                             
                                                j
                                                =
                                                1
                                             
                                             
                                                C
                                             
                                          
                                          (
                                          1
                                          -
                                          
                                             
                                                E
                                             
                                             
                                                j
                                             
                                          
                                          )
                                       
                                    
                                 
                              
                           where, C is total number of the base classifiers, and 
                              
                                 
                                    
                                       E
                                    
                                    
                                       i
                                    
                                 
                              
                            is the normalized error rate based on the performance evaluation of the ith base classifier 
                              
                                 
                                    
                                       F
                                    
                                    
                                       i
                                    
                                 
                              
                            on the validation set. Based on Eq. (21), the ensemble classifier 
                              
                                 CE
                                 (
                                 IMG
                                 )
                              
                            is defined as
                              
                                 (22)
                                 
                                    CE
                                    (
                                    IMG
                                    )
                                    =
                                    sign
                                    (
                                    
                                       
                                          w
                                       
                                       
                                          i
                                       
                                    
                                    ∗
                                    
                                       
                                          F
                                       
                                       
                                          i
                                       
                                    
                                    (
                                    IMG
                                    )
                                    )
                                 
                              
                           where 
                              
                                 
                                    
                                       F
                                    
                                    
                                       i
                                    
                                 
                                 (
                                 IMG
                                 )
                              
                            and 
                              
                                 
                                    
                                       w
                                    
                                    
                                       i
                                    
                                 
                              
                            denote the ith base classifier and its weight respectively.

The detailed steps of ELMCE-MIL algorithm can be summarized as follows:
                              
                                 
                                    
                                    
                                       
                                          
                                             Algorithm 2: ELMCE-MIL Algorithm
                                       
                                    
                                    
                                       
                                          
                                             1. ELMCE-MIL Training
                                          
                                       
                                       
                                          
                                             Input: Available training images set 
                                                
                                                   D
                                                   =
                                                   {
                                                   (
                                                   
                                                      
                                                         IMG
                                                      
                                                      
                                                         1
                                                      
                                                   
                                                   ,
                                                   
                                                      
                                                         y
                                                      
                                                      
                                                         1
                                                      
                                                   
                                                   )
                                                   ,
                                                   (
                                                   
                                                      
                                                         IMG
                                                      
                                                      
                                                         2
                                                      
                                                   
                                                   ,
                                                   
                                                      
                                                         y
                                                      
                                                      
                                                         2
                                                      
                                                   
                                                   )
                                                   ,
                                                   …
                                                   ,
                                                   (
                                                   
                                                      
                                                         IMG
                                                      
                                                      
                                                         N
                                                      
                                                   
                                                   ,
                                                   
                                                      
                                                         y
                                                      
                                                      
                                                         N
                                                      
                                                   
                                                   )
                                                   }
                                                
                                             , 
                                                
                                                   
                                                      
                                                         P
                                                      
                                                      
                                                         min
                                                      
                                                   
                                                   ,
                                                   
                                                      
                                                         P
                                                      
                                                      
                                                         max
                                                      
                                                   
                                                   ,
                                                   Step
                                                
                                              —the minimum and maximum number of hidden nodes and the step size to ELM;
                                       
                                       
                                          
                                             Output: Ensemble ELM classifier 
                                                
                                                   CE
                                                   (
                                                   IMG
                                                   )
                                                
                                             ;
                                       
                                       
                                          
                                             Step 1: For (each image 
                                                
                                                   
                                                      
                                                         IMG
                                                      
                                                      
                                                         i
                                                      
                                                   
                                                   ∈
                                                   D
                                                
                                             )
                                       
                                       
                                          Use SPP method to divide 
                                                
                                                   
                                                      
                                                         IMG
                                                      
                                                      
                                                         i
                                                      
                                                   
                                                
                                              into different blocks, and extract the colors, textures and shapes feature from each block. Thus transfer each image into three different multi-instance bag, denoted as 
                                                
                                                   
                                                      
                                                         BC
                                                      
                                                      
                                                         i
                                                      
                                                   
                                                   ,
                                                   
                                                      
                                                         BT
                                                      
                                                      
                                                         i
                                                      
                                                   
                                                   ,
                                                   
                                                      
                                                         BS
                                                      
                                                      
                                                         i
                                                      
                                                   
                                                
                                             .
                                       
                                       
                                          
                                             Step 2: Construction training and validating set:
                                       
                                       
                                          According to a certain proportion, all the multi-instance bags are divided into two portions, i.e. training set and validation set, denoted as T and V respectively.
                                       
                                       
                                          
                                             Step 3: Training base classifiers:
                                       
                                       
                                          For 
                                                
                                                   P
                                                   =
                                                   
                                                      
                                                         P
                                                      
                                                      
                                                         min
                                                      
                                                   
                                                
                                             : 
                                                
                                                   Step
                                                
                                             : 
                                                
                                                   P
                                                   ⇐
                                                   
                                                      
                                                         P
                                                      
                                                      
                                                         max
                                                      
                                                   
                                                
                                             
                                          
                                       
                                       
                                          A base classifier 
                                                
                                                   
                                                      
                                                         F
                                                      
                                                      
                                                         i
                                                      
                                                   
                                                   (
                                                   IMG
                                                   )
                                                
                                              based on ELM with 
                                                
                                                   P
                                                
                                              hidden nodes is trained use T as a training set.
                                       
                                       
                                          End for
                                       
                                       
                                          
                                             Step 4: Classifiers Ensemble:
                                       
                                       
                                          Calculate the weight 
                                                
                                                   
                                                      
                                                         w
                                                      
                                                      
                                                         i
                                                      
                                                   
                                                
                                              of each base classifier 
                                                
                                                   
                                                      
                                                         F
                                                      
                                                      
                                                         i
                                                      
                                                   
                                                   (
                                                   IMG
                                                   )
                                                
                                              using V as validation set, and then the ensemble classifier 
                                                
                                                   CE
                                                   (
                                                   IMG
                                                   )
                                                   =
                                                   sign
                                                   (
                                                   
                                                      
                                                         w
                                                      
                                                      
                                                         i
                                                      
                                                   
                                                   ∗
                                                   
                                                      
                                                         F
                                                      
                                                      
                                                         i
                                                      
                                                   
                                                   (
                                                   IMG
                                                   )
                                                   )
                                                
                                              can be obtained.
                                       
                                       
                                          
                                             2. ELMEC-MIL predicting
                                          
                                       
                                       
                                          Denote 
                                                
                                                   IMG
                                                
                                              as an unseen image. Firstly, SPP and feature extract methods are used to transform it into three bags, and then use ensemble classifier 
                                                
                                                   CE
                                                   (
                                                   IMG
                                                   )
                                                
                                              (Eq. (22)) to predict its label.
                                       
                                    
                                 
                              
                           
                        

To evaluate the performance of the proposed algorithm, a set of 15,000 images was collected from the Internet, and then manually classified, which contains 3000 pornographic images and 12,000 normal images. Pornographic images in our system are defined mainly as the images with naked men and women, which involve various postures and size. The normal images scenarios include 4000 pure scenery images, 3000 human images, and 5000 hybrid images that contain human and other contents. Most people in images are Caucasians and Asians, and a small number of them are Blacks. Examples of selected images are shown in Fig. 6
                        .

In our evaluation experiments, 5-fold cross validation was employed. During each trial, the available training images set 
                           
                              TrnSet
                              (
                              12
                              ,
                              000
                              )
                           
                         contains total of 12,000 images, which including 2400 pornographic images and 9600 normal image, are denoted as 
                           
                              TrnPorSet
                              (
                              2400
                              )
                           
                         and 
                           
                              TrnNorSet
                              (
                              9600
                              )
                           
                         respectively. Aims at the problem of the data imbalance, 1800 pornographic images are randomly selected from 
                           
                              TrnPorSet
                              (
                              2400
                              )
                           
                         and 1800 normal images are randomly selected from 
                           
                              TrnNorSet
                              (
                              9600
                              )
                           
                         to form the training images set 
                           
                              Re
                              alTrainSet
                              (
                              3600
                              )
                           
                        , and all the remaining images to form the validation set 
                           
                              ValTrnSet
                              (
                              8400
                              )
                           
                        . The learnt classifier was then been tested by using image set 
                           
                              TestSet
                              (
                              3000
                              )
                           
                        , which including 600 pornographic images and 2400 normal images. For the ELM-MIL base classifier training, we used Sigmoid function as the hidden activation function. Because fast learning and testing speed can be offered by ELM method, every experiment is repeated 20 times.

In the actual pornographic image recognition applications, evaluation of the recognition performance cannot be simply done by using the true positive (TP) and false positive (FP), where TP is defined as the ratio of the number of ground truth pornographic images identified to the total number of pornographic images, and FP is the ratio of the number of non-pornographic images misclassified as pornographic images to the total number of non-pornographic images. Instead, the number of unrecognized, but pornographic images and the number of recognized, but normal images are also important, i.e. the false negatives (FN) and false positives (FP). So the Correct Classification Rate (CCR=TP+TN) and False Classification Rate (FCR=FP+FN) are used to measure the performance of the proposed algorithm.

In this experiments, JSEG-based and SBN [46] bag generators were compared with the SPP-based multi-instance modeling method. When a bag generator was chosen, the MI-SVM [24] and MILES [25] algorithms were used to learn the classifiers. After 20 rounds randomly repeated training and testing, the average CCR and FCR values are shown in Table 1
                        .


                        Table 1 shows that the experimental results of improved SPP-based multi-instance modeling is better than these of SBN and JSEG-bag generators in the two classic MIL algorithms. One possible reason of the superior performance is that the SPP method is used to divide each image into a sequence of increasingly finer sub-blocks, and extraction the colors, textures and shapes of every sub-blocks, which can provides multi-scale image information to represent the semantic knowledge on variety of images.

While we use hierarchical k-means clustering method to obtain visual vocabulary, two important parameters K (branch factor) and L (Levels) must to be predefined. In order to confirm the influence of vocabulary size 
                           
                              ‖
                              VW
                              ‖
                           
                         to recognition accuracy, we set 
                           
                              
                                 
                                    P
                                 
                                 
                                    min
                                 
                              
                              =
                              100
                           
                        , 
                           
                              
                                 
                                    P
                                 
                                 
                                    max
                                 
                              
                              =
                              1000
                           
                         and Step
                        =50 for ELMCE-MIL Algorithm. After 20 rounds repeated training and testing, the average CCR and FCR are shown in Table 2
                        .

As seen in Table 2, the visual vocabulary size 
                           
                              ‖
                              VW
                              ‖
                           
                         has great influences on the recognition accuracy. For example, when 
                           
                              ‖
                              VW
                              ‖
                              =
                              32
                           
                        , the CCR
                        =61.1 and FCR
                        =38.9, but with the increasing of 
                           
                              ‖
                              VW
                              ‖
                           
                        , the recognition accuracy is improved rapidly. Notably, when 
                           
                              ‖
                              VW
                              ‖
                           
                         is increased to 729, the CCR
                        =90.6 and FCR
                        =9.4. Unfortunately, when 
                           
                              ‖
                              VW
                              ‖
                           
                         is further increased to 1024 and 3602, there is almost no increase in recognition accuracy. The reason is: while 
                           
                              ‖
                              VW
                              ‖
                           
                         is too small, the visual features of some image blocks with different semantics will be integrated into the same cluster, it will lead to the metadata lose useful classification information and affect recognition accuracy. On the other hand, while if 
                           
                              ‖
                              VW
                              ‖
                           
                         is too big, it will lead to more redundant noises information in the metadata, which does not help to improve the recognition accuracy. Therefore, in order to compromise the accuracy and efficiency, we set K
                        =4 and L
                        =5 in all the following experiments.

For the extreme learning machine (ELM), the number of hidden nodes P is the only parameter we need to maintain. In order to confirm the influence of P value to the recognition accuracy, we use 3600 images 
                           
                              Re
                              alTrainSet
                              (
                              3600
                              )
                           
                         for training and 3000 images 
                           
                              TestSet
                              (
                              3000
                              )
                           
                         for testing, and try hidden layer sizes range from 100 to 1000 hidden nodes (neurons) with an interval of 50 neurons, and then test each base classifier ELM-MIL by using different number of hidden nodes. After 20 rounds repeated 5-fold cross validation, the average CCR and FCR are shown in Fig. 7
                        , and the corresponding average training and testing times in Fig. 8
                         (in Matlab 2010b on a Intel(R) Core(TM) i5-2430M CPU 2.4GHz PC running the windows 7 operating system with 2G memory).

As seen in Fig. 7, with the increasing of P, the recognition accuracy of ELM-MIL algorithm keeps growing, which indicates the number of hidden nodes P for ELM have impacts on the performance of the base classifier. But after reaching 800 hidden nodes, the recognition accuracy of testing data increases more slowly. As can be seen from Fig. 7 and Table 2, our proposed ELMCE-MIL algorithm outperforms all the base classifiers in terms of CCR and FCR, where the best base classifier achieves CCR=0.88, and FCR=0.12, while ELMCE-MIL achieves CCR=0.92, and FCR=0.08. These results clearly highlights that the performance of the base classifier is relatively sensitive to the number of hidden nodes from ELM, while our proposed ELMCE-MIL algorithm is more stable. On the other hand, the training and testing times shown in Fig. 8 increase approximately linearly with the number of hidden nodes. For around 3600 training samples, the training time of ELM with 1000 hidden nodes is about 9s. Taking the entire accuracy, timing, and computational complexity into consideration, we selected 1000 as the maximum number of hidden nodes for our ELMCE-MIL algorithm in all the experiments.

@&#EXPERIMENTAL RESULTS@&#

In order to verify the effectiveness of the proposed method, we set 
                           
                              
                                 
                                    P
                                 
                                 
                                    min
                                 
                              
                              =
                              100
                           
                        , 
                           
                              
                                 
                                    P
                                 
                                 
                                    max
                                 
                              
                              =
                              1000
                           
                        , 
                           
                              Step
                              =
                              50
                           
                        , and compare the recognition results of the ELMCE-MIL algorithm with the results of Milis [27], MILES [25], DD-SVM [24], MI-SVM [19], Hue-SIFT [13], SIFT [13] and ROI-based [14] method. The average CCR and FCR over 20 rounds randomly repeated 5-fold cross validation are listed in Table 3
                        .

In the pornographic images recognition experiments based on the collected data set, as shown in Table 3, the performance of the ELMCE-MIL algorithm is superior to other algorithms. The reasons are: Firstly, our proposed ELMCE-MIL method adopts classifiers ensemble strategy, which can enhance the adaptive ability and generalization ability of the classifier. Secondly, each ”visual-word” extracted by hierarchical k-mean clustering method represents a group of image regions with similar visual characteristic, which has an explicit high-level semantic concept, and the fuzzy histogram reflects not only the probability of a image containing these ”visual-words”, but also the co-occurrence relationship of them in a image. So the metadata extracted by our method has the ability to represent the image semantics, and it helps ELMCE-MIL algorithm to obtain much higher recognition accuracies in the real-world pornographic images recognition application.

@&#CONCLUSIONS@&#

In this paper, we have proposed a new MIL algorithm for pornographic images recognition, named as ELMCE-MIL, which is based on ELM and classifiers ensemble. We have applied SPP method to transform images into three different multi-instance bags based on the extracted low-level visual features (i.e. color moment, LBP texture and HOG shape features). This MIL problem can then be solved by using ELMCE-MIL, which is not only shown its good metadata representation based on fuzzy histogram of VW, but also utilizes the power of ensemble paradigms to achieve strong generalization ability. We also evaluated the performance of ELMCE-MIL on the real condition data set, comparative experimental results show that this algorithm is feasible, and the performance is competitive to other state-of-the-art MIL algorithms.

@&#ACKNOWLEDGEMENTS@&#

The author acknowledges the support of the National Natural Scientific Youth Foundation (Grant No. 61202183), the Natural Science Foundation Research Project of the Shaanxi Province (Grant No. 2013JM8031), the Postdoctoral Science Foundation (Grant No. 2013M542386), Ministry of Public Security Foundation Research Project (Grant No. 2014GABJC022) and the Natural Science Foundation Research Project of Shaanxi Province Department of Education (Grant Nos. 12JK0734 and 12JK0504), China.

@&#REFERENCES@&#

