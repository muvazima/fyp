@&#MAIN-TITLE@&#Ricci flow-based spherical parameterization and surface registration

@&#HIGHLIGHTS@&#


               
               
                  
                     
                        
                           
                           An Euclidean Ricci flow for efficient and effective spherical parameterization.


                        
                        
                           
                           A scale space with Ricci energy, which offers robust scale dependent surface features.


                        
                        
                           
                           Combining local features and global Ricci energy for accurate surface registration.


                        
                        
                           
                           The brain surface registration demonstrate the accuracy of the method.


                        
                        
                           
                           The proposed framework shows the efficacy for hippocampus surface analysis.


                        
                     
                  
               
            

@&#KEYPHRASES@&#

Discrete Ricci flow

Surface parameterization

Surface registration

Scale space

@&#ABSTRACT@&#


               
               
                  This paper presents an improved Euclidean Ricci flow method for spherical parameterization. We subsequently invent a scale space processing built upon Ricci energy to extract robust surface features for accurate surface registration. Since our method is based on the proposed Euclidean Ricci flow, it inherits the properties of Ricci flow such as conformality, robustness and intrinsicalness, facilitating efficient and effective surface mapping. Compared with other surface registration methods using curvature or sulci pattern, our method demonstrates a significant improvement for surface registration. In addition, Ricci energy can capture local differences for surface analysis as shown in the experiments and applications.
               
            

@&#INTRODUCTION@&#

Image registration is the process of finding the optimal transformation that aligns different imaging data into spatial correspondence. As a result, the same anatomic structures occupy the same spatial locations in different images [40]. It is the building block for a variety of medical image analysis tasks, such as motion correction, multi-modality information fusion, atlas-based image segmentation, population-based studies, longitudinal studies, computational anatomy and image-guided surgery [8,23,28]. Usually, the image registration can be categorized into two categories, volume-based registration and surface-based registration [10]. Since the brain cortex is highly folded, cortical surface model can explicitly preserve geometric property of the cortex compared to volume space [8,26,34]. Thus, surface-based approaches have recently received great attention and been applied in brain morphometry for exploring abnormalities [4,28,31]. Many related comparisons and surveys have also been presented, as in [23,29,38].

Usually, surface is parameterized and represented in the spherical domain. There are many different methods of surface parameterization proposed in the past years [9,14,24,30]. In order to achieve spherical parameterization, some methods cut the surface into pieces and turn the problem into planar parameterization [14,21]. These methods are highly dependent on the cutting quality. Others perform the parameterization directly on the sphere by minimizing certain energy function. Gotsman et al. [11] show a nice relationship between spectral graph theory and spherical parameterization, embedding simple meshes on the sphere by solving a quadratic system.

Once the spherical representation of the surface is constructed, many image registration algorithms can be used with spherical coordinates. For cortical surface analysis, the methods usually make use of some landmark to guide the registration process. For example, manually identified cortical sulci landmarks were used in [34,39]. Surface properties such as mean curvature, or sulcal depth have also been utilized in [8,26,36]. Though the registrations with manually landmarks are more accurate than that using normal surface properties, it requires medical background and is hard to be applied on large scale data. Therefore, many studies focus on the landmark-free approach with different surface properties for surface registration [25,36].

Like Gaussian curvature, Ricci energy is an intrinsic property of surfaces, which can be used for landmark-free surface registration and analysis [12,35]. Ricci energy is computed from Ricci flow. Ricci flow was first introduced in differential geometry by Hamilton [15] for the purpose of proving Poincaré conjecture. It is also a powerful curvature flow method in geometric analysis. Unlike mean curvature flow [18], the Ricci flow is performed purely on the intrinsic geometry of the surface shape as a process of metric diffusion. With the circle packing algorithm [5,17,33], discrete surface Ricci flow theory was developed by Chow and Luo [3] and a computational algorithm was introduced in [19]. The conventional Ricci flow can be highly generalized to the three canonical background geometries, namely, the Euclidean geometry, hyperbolic geometry and spherical geometry. The Ricci energy is convex for Euclidean and hyperbolic geometries. With spherical geometry, however, Ricci energy is not strictly convex but converges to a local optimum [3,20]. Since the conventional circle packing is too restrictive, the Ricci flow algorithm has limitations. For meshes with low quality triangulations, if high conformality is required, the flow tends to be numerically unstable. If convergence to the global optimum is enforced, the conformality may be sacrificed. In order to solve this problem, inversive distance metric [1] was introduced to Ricci flow with euclidean and hyperbolic geometry in [37]. Guo proved the convexity of discrete Ricci energy with the inversive distance circle packing for Euclidean and Hyperbolic case [13]. Thus, Guo’s method is more flexible, more robust and conformal for meshes with low quality triangulations. However, the algorithm does not cover the spherical geometry. From [19], we can see that spherical Ricci flow is not strictly convex, which merely settles at a local minimum. In addition, no packing algorithm intrinsic to the spherical geometry has been found yet. Thus, it is difficult to perform the spherical Ricci flow with inversive distance metric.

In this paper, we present a framework for spherical parameterization and registration using Euclidean Ricci flow. The major contributions are summarized as follows: (1) We propose the discrete Euclidean Ricci flow for efficient and effective computation of spherical parameterization; (2) A scale space is designed with Euclidean Ricci energy, which offers robust scale dependent surface features; (3) We present an energy function in the combination of local scale dependent geometry features and global Ricci energy for accurate surface registration; and (4) Applications to the brain surface registration and hippocampus surface analysis demonstrate the efficacy of the proposed framework.

The rest of the paper is organized as follows: mathematical background is introduced in Section 2. Discrete euclidean Ricci flow algorithms are explained in Section 3. Scale dependent feature extraction and surface registration are shown in Section 4. The parameter and registration results are discussed in Section 5. We also apply Ricci energy to surface analysis of hippocampus in Section 6. The concluding remarks are given in Section 7.

In this section, we briefly introduce the most related theoretical background of discrete geometry and Ricci flow. For more information, please refer to [3,15].

Suppose S is a surface, the Riemannian metric is a tensor g
                        =(g
                        
                           ij
                        ) which is positive definite and defines an inner product for the tangent space of S.

Two Riemannian metrics on S are conformal if there is a function defined on the surface 
                           
                              u
                              :
                              S
                              →
                              R
                           
                         such that 
                           
                              
                                 
                                    g
                                 
                                 
                                    ¯
                                 
                              
                              =
                              
                                 
                                    e
                                 
                                 
                                    2
                                    u
                                 
                              
                              g
                           
                        , where u is called the conformal factor.

Curvature is determined by the Riemannian metric, and different metrics induce different curvatures. But, the total curvature is solely determined by the topology and holds the Gauss–Bonnet theorem: Let (S,
                        g) be a metric surface, the total curvature is
                           
                              (1)
                              
                                 
                                    ∫
                                    
                                       S
                                    
                                 
                                 
                                    
                                       KdA
                                    
                                    
                                       g
                                    
                                 
                                 +
                                 
                                    ∫
                                    
                                       ∂
                                       S
                                    
                                 
                                 
                                    
                                       k
                                    
                                    
                                       g
                                    
                                 
                                 ds
                                 =
                                 2
                                 π
                                 χ
                                 (
                                 S
                                 )
                                 ,
                              
                           
                        where A
                        
                           g
                         is the area of metric g,
                        χ(S) is the Euler number of the surface.

The Uniformization theorem [19] ensures that all genus zero surfaces in 
                           
                              
                                 
                                    R
                                 
                                 
                                    3
                                 
                              
                           
                         admits a uniformization metric, which is conformal to the original metric and induces constant Gaussian curvature.

Ricci flow is a powerful curvature flow method, invented by Hamilton [15] for the proof of the Poincaré conjecture. Intuitively, it describes the process to deform the Riemannian metric according to curvature such that the curvature evolves like a heat diffusion process:
                           
                              (2)
                              
                                 
                                    
                                       d
                                       g
                                    
                                    
                                       dt
                                    
                                 
                                 =
                                 -
                                 2
                                 k
                                 g
                                 .
                              
                           
                        Hamilton [15] and Chow [2] proved the convergence of surface Ricci flow. Thus, for a closed surface, if the total area of the surface is preserved during the flow, the Ricci flow will converge to a metric such that the final metric is compatible with a sphere and can be embedded in 
                           
                              
                                 
                                    S
                                 
                                 
                                    2
                                 
                              
                           
                        .

In engineering fields, smooth surfaces are often approximated by simplicial complexes. Major concepts such as curvature and conformal deformation in the continuous setting can be generalized to the discrete setting. In the following, we specifically focus on the Euclidean geometric setting, as it is the background geometry of our Ricci flow computation.

Suppose M(V,
                        E,
                        F) is a triangle mesh with vertex set V, edge set E and face set F, respectively. We use v
                        
                           i
                         to denote the ith vertex. [v
                        
                           i
                        ,
                        v
                        
                           j
                        ] is the edge between v
                        
                           i
                         and v
                        
                           j
                        , [v
                        
                           i
                        ,
                        v
                        
                           j
                        ,
                        v
                        
                           k
                        ] is the face f
                        
                           i,j,k
                         formed by v
                        
                           i
                        , v
                        
                           j
                        , v
                        
                           k
                        .

A discrete matrix on M is a function l:E
                        →
                        R
                        +, such that on each face [v
                        
                           i
                        ,
                        v
                        
                           j
                        ,
                        v
                        
                           k
                        ], the triangle inequality holds l
                        
                           ij
                        
                        +
                        l
                        
                           jk
                        
                        ⩽
                        l
                        
                           ki
                        .

The discrete metric determines the corner angles on each face by the cosine law,
                           
                              (3)
                              
                                 
                                    
                                       θ
                                    
                                    
                                       i
                                    
                                 
                                 =
                                 arccos
                                 
                                    
                                       
                                          
                                             l
                                          
                                          
                                             ij
                                          
                                          
                                             2
                                          
                                       
                                       +
                                       
                                          
                                             l
                                          
                                          
                                             ki
                                          
                                          
                                             2
                                          
                                       
                                       -
                                       
                                          
                                             l
                                          
                                          
                                             jk
                                          
                                          
                                             2
                                          
                                       
                                    
                                    
                                       2
                                       
                                          
                                             l
                                          
                                          
                                             ij
                                          
                                       
                                       
                                          
                                             l
                                          
                                          
                                             ki
                                          
                                       
                                    
                                 
                                 .
                              
                           
                        Then, we could get the discrete Gaussian curvature K
                        
                           i
                        . In general, the discrete Gaussian curvature K
                        
                           i
                         on a vertex i can be computed from the angle deficit:
                           
                              (4)
                              
                                 
                                    
                                       K
                                    
                                    
                                       i
                                    
                                 
                                 =
                                 2
                                 π
                                 -
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          
                                             
                                                f
                                             
                                             
                                                i
                                                ,
                                                j
                                                ,
                                                k
                                             
                                          
                                       
                                    
                                 
                                 
                                    
                                       θ
                                    
                                    
                                       i
                                    
                                    
                                       jk
                                    
                                 
                                 ,
                              
                           
                        where 
                           
                              
                                 
                                    θ
                                 
                                 
                                    i
                                 
                                 
                                    jk
                                 
                              
                           
                         represents the corner angle attached to vertex v
                        
                           i
                         in the face f
                        
                           i,j,k
                        .

A circle packing associates each vertex with a circle. The circle at vertex v
                        
                           i
                         is denoted as c
                        
                           i
                         (Fig. 1
                        ). Suppose the length of [v
                        
                           i
                        ,
                        v
                        
                           j
                        ] is l
                        
                           i,j
                        , the radii of c
                        
                           i
                         and c
                        
                           j
                         are γ
                        
                           i
                         and γ
                        
                           j
                        , respectively. Then, the inversive distance between c
                        
                           i
                         and c
                        
                           j
                         is given by
                           
                              (5)
                              
                                 I
                                 (
                                 
                                    
                                       c
                                    
                                    
                                       i
                                    
                                 
                                 ,
                                 
                                    
                                       c
                                    
                                    
                                       j
                                    
                                 
                                 )
                                 =
                                 
                                    
                                       
                                          
                                             l
                                          
                                          
                                             ij
                                          
                                          
                                             2
                                          
                                       
                                       -
                                       
                                          
                                             γ
                                          
                                          
                                             i
                                          
                                          
                                             2
                                          
                                       
                                       -
                                       
                                          
                                             γ
                                          
                                          
                                             j
                                          
                                          
                                             2
                                          
                                       
                                    
                                    
                                       2
                                       
                                          
                                             γ
                                          
                                          
                                             i
                                          
                                       
                                       
                                          
                                             γ
                                          
                                          
                                             j
                                          
                                       
                                    
                                 
                                 .
                              
                           
                        A generalized circle packing metric on a mesh M is to associate each vertex v
                        
                           i
                         with a circle c
                        
                           i
                        , whose radius is γ
                        
                           i
                        , and to associate each edge [v
                        
                           i
                        ,
                        v
                        
                           j
                        ] with a nonnegative number I
                        
                           ij
                        . The edge length is given by
                           
                              (6)
                              
                                 
                                    
                                       l
                                    
                                    
                                       ij
                                    
                                 
                                 =
                                 
                                    
                                       
                                          
                                             γ
                                          
                                          
                                             i
                                          
                                          
                                             2
                                          
                                       
                                       +
                                       
                                          
                                             γ
                                          
                                          
                                             i
                                          
                                          
                                             2
                                          
                                       
                                       +
                                       2
                                       
                                          
                                             I
                                          
                                          
                                             ij
                                          
                                       
                                       
                                          
                                             γ
                                          
                                          
                                             i
                                          
                                       
                                       
                                          
                                             γ
                                          
                                          
                                             j
                                          
                                       
                                    
                                 
                                 .
                              
                           
                        
                     

The circle packing metric is denoted as (Γ,
                        I,
                        M), where Γ
                        ={γ
                        
                           i
                        }, I
                        ={I
                        
                           ij
                        }.

A discrete conformal deformation is to change radii γ
                        
                           i
                         only, and preserve inversive distance I
                        
                           ij
                        . Let
                           
                              
                                 
                                    
                                       u
                                    
                                    
                                       i
                                    
                                 
                                 =
                                 log
                                 
                                    
                                       γ
                                    
                                    
                                       i
                                    
                                 
                                 ,
                              
                           
                        then, the discrete Ricci flow is
                           
                              (7)
                              
                                 
                                    
                                       
                                          
                                             du
                                          
                                          
                                             i
                                          
                                       
                                    
                                    
                                       dt
                                    
                                 
                                 =
                                 
                                    
                                       
                                          
                                             K
                                          
                                          
                                             ¯
                                          
                                       
                                    
                                    
                                       i
                                    
                                 
                                 -
                                 
                                    
                                       K
                                    
                                    
                                       i
                                    
                                 
                                 ,
                              
                           
                        where 
                           
                              
                                 
                                    
                                       
                                          K
                                       
                                       
                                          ¯
                                       
                                    
                                 
                                 
                                    i
                                 
                              
                           
                         is the user-defined curvature at vertex v
                        
                           i
                        .

Let u represent the vector (u
                        1,
                        u
                        2,…,
                        u
                        
                           n
                        ) and K represent the vector (K
                        1,
                        K
                        2,…,
                        K
                        
                           n
                        ), where n
                        =∣V∣. The discrete Euclidean Ricci energy is defined as
                           
                              (8)
                              
                                 E
                                 (
                                 u
                                 )
                                 =
                                 
                                    ∫
                                    
                                       
                                          
                                             u
                                          
                                          
                                             0
                                          
                                       
                                    
                                    
                                       u
                                    
                                 
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          i
                                       
                                    
                                 
                                 (
                                 
                                    
                                       
                                          
                                             K
                                          
                                          
                                             ¯
                                          
                                       
                                    
                                    
                                       i
                                    
                                 
                                 -
                                 
                                    
                                       K
                                    
                                    
                                       i
                                    
                                 
                                 )
                                 
                                    
                                       du
                                    
                                    
                                       i
                                    
                                 
                                 ,
                              
                           
                        where u
                        0
                        =(0,0,…,0).

The discrete Euclidean Ricci flow in (7) is the negative gradient flow of the Ricci energy. It is convex on the hyperplane 
                           
                              
                                 
                                    ∑
                                 
                                 
                                    i
                                 
                              
                              
                                 
                                    u
                                 
                                 
                                    i
                                 
                              
                              =
                              0
                           
                         in the admissible metric space. Detailed proof can be found in [3,13]. The metric inducing the target curvature is the unique global optimum of the Ricci energy. Therefore, it, unlike spherical Ricci flow, converges to the global optimum.

We use Euclidean Ricci flow for the computation of spherical parameterization. Therefore, the Ricci energy is convex and converges to the global minimum. Because the surface is approximated by a piecewise linear triangular mesh in practice, it is crucial to make certain that the curvature approximation is accurate and robust, with respect to the continuous counterpart.

From Fig. 2
                        , we can see that (4) cannot compute the Gaussian curvature accurately when mesh vertices’ distribution is non-uniform on the sphere. Thus, (4) does not satisfy the accuracy requirement. In order to solve this problem, we use Meyer’s method [27] instead.

The main idea of Meyer’s method is using a local spatial average over the immediate 1-ring neighborhood to optimize the discrete results. In this method, Gaussian curvature is calculated as:
                           
                              (9)
                              
                                 
                                    
                                       K
                                    
                                    
                                       i
                                    
                                 
                                 =
                                 
                                    
                                       1
                                    
                                    
                                       
                                          
                                             A
                                          
                                          
                                             M
                                          
                                          
                                             i
                                          
                                       
                                    
                                 
                                 
                                    
                                       
                                          2
                                          π
                                          -
                                          
                                             
                                                
                                                   ∑
                                                
                                                
                                                   
                                                      
                                                         f
                                                      
                                                      
                                                         i
                                                         ,
                                                         j
                                                         ,
                                                         k
                                                      
                                                   
                                                
                                             
                                          
                                          
                                             
                                                θ
                                             
                                             
                                                i
                                             
                                             
                                                jk
                                             
                                          
                                       
                                    
                                 
                                 ,
                              
                           
                        where f
                        
                           i,j,k
                         is 1-ring neighbor face of vertex v
                        
                           i
                        . 
                           
                              
                                 
                                    A
                                 
                                 
                                    M
                                 
                                 
                                    i
                                 
                              
                           
                         is the mixed area of v
                        
                           i
                        (Fig. 3
                        ). Fore more details, please refer to [27].

Compared with conventional discrete Gaussian curvature, (9) can be more accurate when computing the Gaussian curvature on a sphere with less computational cost (Fig. 2). Besides, the curvature by using Meyer’s method satisfies the Gauss–Bonnet theorem. Thus, when we compute Euclidean Ricci flow with Meyer’s method, it is still a heat diffusion flow, and converges to the global optimum.

This section provides the algorithm for spherical parameterization using Euclidean Ricci flow.

Here, we use (9) to calculate the Gaussian curvature. In order to get the appropriate spherical parameterization, we set the target curvature equally everywhere since the Gaussian curvature on a sphere is uniform. According to Gauss–Bonnet theorem, we can get the target curvature:
                           
                              (10)
                              
                                 
                                    
                                       c
                                    
                                    
                                       target
                                    
                                 
                                 =
                                 
                                    
                                       4
                                       π
                                    
                                    
                                       
                                          
                                             ∑
                                          
                                          
                                             i
                                          
                                       
                                       
                                          
                                             A
                                          
                                          
                                             M
                                          
                                          
                                             i
                                          
                                       
                                    
                                 
                              
                           
                        where 
                           
                              
                                 
                                    A
                                 
                                 
                                    M
                                 
                                 
                                    i
                                 
                              
                           
                         is the mixed area of v
                        
                           i
                        . Then, we use the method in [37] to calculate the inversive distance circle packing metric.

After the inversive distance circle packing metric is calculated, the conformal metric which induces the target curvature is computed as Algorithm 1.
                           Algorithm 1
                           Ricci energy optimization 
                                 
                                    
                                       
                                       
                                          
                                             Input: Initial radii Γ, edge weight I, target curvature c
                                                
                                                   target
                                                , step length δ, error tolerance τ
                                             
                                          
                                          
                                             Output: Gaussian curvature metrics 
                                                   
                                                      {
                                                      
                                                         
                                                            K
                                                         
                                                         
                                                            0
                                                            ,
                                                            …
                                                            ,
                                                            n
                                                         
                                                      
                                                      (
                                                      t
                                                      )
                                                      }
                                                   
                                                , edge length metrics 
                                                   
                                                      {
                                                      
                                                         
                                                            L
                                                         
                                                         
                                                            0
                                                            ,
                                                            …
                                                            ,
                                                            n
                                                         
                                                      
                                                      (
                                                      t
                                                      )
                                                      }
                                                   
                                                , diffused metrics {μ
                                                0,…,n
                                                (t)}. Here t is the scale factor.
                                          
                                          
                                             
                                                1. For each vertex v, set current target curvature 
                                                   
                                                      
                                                         
                                                            
                                                               
                                                                  K
                                                               
                                                               
                                                                  ¯
                                                               
                                                            
                                                         
                                                         
                                                            i
                                                         
                                                      
                                                      =
                                                      
                                                         
                                                            c
                                                         
                                                         
                                                            target
                                                         
                                                      
                                                   
                                                .
                                          
                                          
                                             
                                                2. Initialize t
                                                =0 and u
                                                
                                                   i
                                                
                                                =lnγ
                                                
                                                   i
                                                
                                             
                                          
                                          
                                             
                                                3. Repeat
                                          
                                          
                                             
                                                
                                                (a) Compute the edge length l
                                                
                                                   ij
                                                 from current vertex radii γ
                                                
                                                   i
                                                ,
                                                γ
                                                
                                                   j
                                                 and inversive distance I
                                                
                                                   ij
                                                . 
                                                   
                                                      
                                                         
                                                            l
                                                         
                                                         
                                                            ij
                                                         
                                                      
                                                      =
                                                      
                                                         
                                                            
                                                               
                                                                  γ
                                                               
                                                               
                                                                  i
                                                               
                                                               
                                                                  2
                                                               
                                                            
                                                            +
                                                            
                                                               
                                                                  γ
                                                               
                                                               
                                                                  j
                                                               
                                                               
                                                                  2
                                                               
                                                            
                                                            +
                                                            2
                                                            
                                                               
                                                                  I
                                                               
                                                               
                                                                  ij
                                                               
                                                            
                                                            
                                                               
                                                                  γ
                                                               
                                                               
                                                                  i
                                                               
                                                            
                                                            
                                                               
                                                                  γ
                                                               
                                                               
                                                                  j
                                                               
                                                            
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                          
                                             
                                                
                                                (b) Compute the corner angles on each face [v
                                                
                                                   i
                                                ,v
                                                
                                                   j
                                                ,v
                                                
                                                   k
                                                ] using current edge length: 
                                                   
                                                      
                                                         
                                                            θ
                                                         
                                                         
                                                            i
                                                         
                                                         
                                                            jk
                                                         
                                                      
                                                      =
                                                      arccos
                                                      
                                                         
                                                            
                                                               
                                                                  
                                                                     
                                                                        
                                                                           l
                                                                        
                                                                        
                                                                           ij
                                                                        
                                                                        
                                                                           2
                                                                        
                                                                     
                                                                     +
                                                                     
                                                                        
                                                                           l
                                                                        
                                                                        
                                                                           ki
                                                                        
                                                                        
                                                                           2
                                                                        
                                                                     
                                                                     -
                                                                     
                                                                        
                                                                           l
                                                                        
                                                                        
                                                                           jk
                                                                        
                                                                        
                                                                           2
                                                                        
                                                                     
                                                                  
                                                                  
                                                                     2
                                                                     
                                                                        
                                                                           l
                                                                        
                                                                        
                                                                           ij
                                                                        
                                                                     
                                                                     
                                                                        
                                                                           l
                                                                        
                                                                        
                                                                           ki
                                                                        
                                                                     
                                                                  
                                                               
                                                            
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                          
                                             
                                                
                                                (c) Compute the mixed area 
                                                   
                                                      
                                                         
                                                            A
                                                         
                                                         
                                                            M
                                                         
                                                         
                                                            i
                                                         
                                                      
                                                   
                                                 of each vertex v
                                                
                                                   i
                                                .
                                          
                                          
                                             
                                                
                                                (d) For each vertex v
                                                
                                                   i
                                                , compute current curvature 
                                                   
                                                      
                                                         
                                                            K
                                                         
                                                         
                                                            i
                                                         
                                                      
                                                      =
                                                      
                                                         
                                                            1
                                                         
                                                         
                                                            
                                                               
                                                                  A
                                                               
                                                               
                                                                  M
                                                               
                                                               
                                                                  i
                                                               
                                                            
                                                         
                                                      
                                                      
                                                         
                                                            
                                                               2
                                                               π
                                                               -
                                                               
                                                                  
                                                                     ∑
                                                                  
                                                                  
                                                                     jk
                                                                  
                                                               
                                                               
                                                                  
                                                                     θ
                                                                  
                                                                  
                                                                     i
                                                                  
                                                                  
                                                                     jk
                                                                  
                                                               
                                                            
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                          
                                             
                                                
                                                (e) Update u
                                                
                                                   i
                                                 of each vertex v
                                                
                                                   i
                                                . 
                                                   
                                                      
                                                         
                                                            u
                                                         
                                                         
                                                            i
                                                         
                                                      
                                                      =
                                                      
                                                         
                                                            u
                                                         
                                                         
                                                            i
                                                         
                                                      
                                                      +
                                                      δ
                                                      (
                                                      
                                                         
                                                            
                                                               
                                                                  K
                                                               
                                                               
                                                                  ¯
                                                               
                                                            
                                                         
                                                         
                                                            i
                                                         
                                                      
                                                      -
                                                      
                                                         
                                                            K
                                                         
                                                         
                                                            i
                                                         
                                                      
                                                      )
                                                   
                                                
                                             
                                          
                                          
                                             
                                                
                                                (f) Normalize the metrics, set 
                                                   
                                                      
                                                         
                                                            ∑
                                                         
                                                         
                                                            i
                                                         
                                                      
                                                      
                                                         
                                                            u
                                                         
                                                         
                                                            i
                                                         
                                                      
                                                      =
                                                      0
                                                   
                                                
                                             
                                          
                                          
                                             
                                                
                                                (g) Update the radius γ
                                                
                                                   i
                                                 of v
                                                
                                                   i
                                                . γ
                                                
                                                   i
                                                
                                                =exp (u
                                                
                                                   i
                                                )
                                          
                                          
                                             
                                                
                                                (h) Update the target curvature 
                                                   
                                                      
                                                         
                                                            
                                                               
                                                                  K
                                                               
                                                               
                                                                  ¯
                                                               
                                                            
                                                         
                                                         
                                                            i
                                                         
                                                      
                                                      =
                                                      
                                                         
                                                            4
                                                            π
                                                         
                                                         
                                                            
                                                               
                                                                  ∑
                                                               
                                                               
                                                                  i
                                                               
                                                            
                                                            
                                                               
                                                                  A
                                                               
                                                               
                                                                  M
                                                               
                                                               
                                                                  i
                                                               
                                                            
                                                         
                                                      
                                                   
                                                .
                                          
                                          
                                             
                                                
                                                (i) Save the edge lengths 
                                                   
                                                      L
                                                      (
                                                      t
                                                      )
                                                      :
                                                      {
                                                      
                                                         
                                                            l
                                                         
                                                         
                                                            ij
                                                         
                                                      
                                                      }
                                                   
                                                , Gaussian curvature 
                                                   
                                                      K
                                                      (
                                                      t
                                                      )
                                                      :
                                                      {
                                                      
                                                         
                                                            K
                                                         
                                                         
                                                            i
                                                         
                                                      
                                                      }
                                                   
                                                , diffused metrics μ(t):u
                                                
                                                   i
                                                 as the scale-space representation at scale t.
                                          
                                          
                                             
                                                
                                                (j) t
                                                =
                                                t
                                                +1
                                          
                                          
                                             
                                                4. Until 
                                                   
                                                      max
                                                      |
                                                      
                                                         
                                                            
                                                               
                                                                  K
                                                               
                                                               
                                                                  ¯
                                                               
                                                            
                                                         
                                                         
                                                            i
                                                         
                                                      
                                                      -
                                                      
                                                         
                                                            K
                                                         
                                                         
                                                            i
                                                         
                                                      
                                                      |
                                                      ⩽
                                                      τ
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           

After computing the discrete metric of the mesh, we can embed the mesh onto 
                           
                              
                                 
                                    S
                                 
                                 
                                    2
                                 
                              
                           
                        . Basically, we isometrically embed the mesh triangle by triangle using the Euclidean cosine law (Algorithm 2).
                           Algorithm 2
                           Sphere embedding 
                                 
                                    
                                       
                                       
                                          
                                             Input: Final diffused edge length L
                                             
                                          
                                          
                                             Output: Embedding sphere mesh
                                          
                                          
                                             
                                                1. Calculate the corresponding spherical radii 
                                                   
                                                      R
                                                      =
                                                      
                                                         
                                                            
                                                               
                                                                  
                                                                     
                                                                        ∑
                                                                     
                                                                     
                                                                        i
                                                                     
                                                                  
                                                                  
                                                                     
                                                                        A
                                                                     
                                                                     
                                                                        M
                                                                     
                                                                     
                                                                        i
                                                                     
                                                                  
                                                               
                                                               
                                                                  4
                                                                  π
                                                               
                                                            
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                          
                                             
                                                2. Flatten a seed face [v
                                                
                                                   i
                                                ,
                                                v
                                                
                                                   j
                                                ,
                                                v
                                                
                                                   k
                                                ].
                                          
                                          
                                             
                                                3. Put all the neighbored faces of seed face [v
                                                
                                                   i
                                                ,
                                                v
                                                
                                                   j
                                                ,
                                                v
                                                
                                                   k
                                                ] to a face queue.
                                          
                                          
                                             
                                                4. Repeat
                                          
                                          
                                             
                                                (a) Pop the first face [v
                                                
                                                   i
                                                ,
                                                v
                                                
                                                   j
                                                ,
                                                v
                                                
                                                   k
                                                ] from queue.
                                          
                                          
                                             
                                                (b) Suppose v
                                                
                                                   i
                                                 and v
                                                
                                                   j
                                                 have been embedded, compute the position of v
                                                
                                                   k
                                                 by using Euclidean cosine law and keep the orientation of the face.
                                          
                                          
                                             
                                                (c) Put the neighbor faces of [v
                                                
                                                   i
                                                ,
                                                v
                                                
                                                   j
                                                ,
                                                v
                                                
                                                   k
                                                ], which haven’t been accessed yet, to the queue.
                                          
                                          
                                             
                                                5. Until the face queue is empty.
                                          
                                       
                                    
                                 
                              
                           


                        Fig. 4
                         shows the spherical parameter result of left cortical surface.

Since Ricci flow energy distribution could be seen as heat diffusion, the scale-space representation of the surface geometry can be formulated as a family of diffused metrics, parameterized by time t. Consider a surface as a Riemannian manifold, the intrinsic geometry of surfaces can be presented by the pointwise Ricci energy. For a triangle mesh M(V,
                        E,
                        F), the scale-space is retained by an n
                        ×∣V∣ matrix:
                           
                              (11)
                              
                                 Mat
                                 (
                                 M
                                 )
                                 =
                                 
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         E
                                                      
                                                      
                                                         
                                                            
                                                               v
                                                            
                                                            
                                                               0
                                                            
                                                         
                                                      
                                                      
                                                         
                                                            
                                                               t
                                                            
                                                            
                                                               0
                                                            
                                                         
                                                      
                                                   
                                                
                                                
                                                   
                                                      
                                                         E
                                                      
                                                      
                                                         
                                                            
                                                               v
                                                            
                                                            
                                                               0
                                                            
                                                         
                                                      
                                                      
                                                         
                                                            
                                                               t
                                                            
                                                            
                                                               1
                                                            
                                                         
                                                      
                                                   
                                                
                                                
                                                   ⋯
                                                
                                                
                                                   
                                                      
                                                         E
                                                      
                                                      
                                                         
                                                            
                                                               v
                                                            
                                                            
                                                               0
                                                            
                                                         
                                                      
                                                      
                                                         
                                                            
                                                               t
                                                            
                                                            
                                                               n
                                                               -
                                                               1
                                                            
                                                         
                                                      
                                                   
                                                
                                             
                                             
                                                
                                                   
                                                      
                                                         E
                                                      
                                                      
                                                         
                                                            
                                                               v
                                                            
                                                            
                                                               1
                                                            
                                                         
                                                      
                                                      
                                                         
                                                            
                                                               t
                                                            
                                                            
                                                               0
                                                            
                                                         
                                                      
                                                   
                                                
                                                
                                                   
                                                      
                                                         E
                                                      
                                                      
                                                         
                                                            
                                                               v
                                                            
                                                            
                                                               1
                                                            
                                                         
                                                      
                                                      
                                                         
                                                            
                                                               t
                                                            
                                                            
                                                               1
                                                            
                                                         
                                                      
                                                   
                                                
                                                
                                                   ⋯
                                                
                                                
                                                   
                                                      
                                                         E
                                                      
                                                      
                                                         
                                                            
                                                               v
                                                            
                                                            
                                                               1
                                                            
                                                         
                                                      
                                                      
                                                         
                                                            
                                                               t
                                                            
                                                            
                                                               n
                                                               -
                                                               1
                                                            
                                                         
                                                      
                                                   
                                                
                                             
                                             
                                                
                                                   ⋮
                                                
                                                
                                                   ⋮
                                                
                                                
                                                   ⋱
                                                
                                                
                                                   ⋮
                                                
                                             
                                             
                                                
                                                   
                                                      
                                                         E
                                                      
                                                      
                                                         
                                                            
                                                               v
                                                            
                                                            
                                                               m
                                                            
                                                         
                                                      
                                                      
                                                         
                                                            
                                                               t
                                                            
                                                            
                                                               0
                                                            
                                                         
                                                      
                                                   
                                                
                                                
                                                   
                                                      
                                                         E
                                                      
                                                      
                                                         
                                                            
                                                               v
                                                            
                                                            
                                                               m
                                                            
                                                         
                                                      
                                                      
                                                         
                                                            
                                                               t
                                                            
                                                            
                                                               1
                                                            
                                                         
                                                      
                                                   
                                                
                                                
                                                   ⋯
                                                
                                                
                                                   
                                                      
                                                         E
                                                      
                                                      
                                                         
                                                            
                                                               v
                                                            
                                                            
                                                               m
                                                            
                                                         
                                                      
                                                      
                                                         
                                                            
                                                               t
                                                            
                                                            
                                                               n
                                                               -
                                                               1
                                                            
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                                 .
                              
                           
                        Here, E is calculated by (8) with the discrete method on each vertex. Compared to the simple differential of Gaussian curvature [41], the Ricci energy also takes the evolving conformal factor into account. Thus, the scale space constructed with Ricci energy (Euclidean) contains more characteristic information and lead to a better feature representation of the shape data. Each column of the matrix stands for the surface Ricci energy at scale t. The scale-space has the following properties:


                        Causality. For 3D objects, recent research in visual saliency suggests that shape features usually appear as curvature variance [41]. For this reason, we identify geometric features as diffused energy extrema in the scale space. The causality criterion can be established by requiring that all minima and maxima of the energy function belong to the original shape with the scale space.


                        Scale invariance. In the spirit of discrete geometry, the curvatures are defined as vertices, edges and faces. With the Euclidean background geometry, the edges and faces have no curvature. This setting let the scale space invariant to the similarity transformation of the objects.

Besides, based on the parallel structure of the algorithm, the scale space has the properties of parallelism and flexibility. Thus, we can introduce image scale space analytical method to process the geometric scale space [16,22,41].

Once shapes are represented at multiple scales, meaningful features can be extracted in a scale-invariant manner which are adaptive to the surface geometry. For 2D images, the Laplacian normalized with the scale parameter t has proved to be a more stable feature detector, compared to a range of other possible candidates, such as the gradient or Hessian. Let E
                        
                           t
                         be the geometric representation at scale t. The scale-normalized Laplacian operator is defined as
                           
                              (12)
                              
                                 
                                    
                                       Δ
                                    
                                    
                                       norm
                                    
                                 
                                 
                                    
                                       E
                                    
                                    
                                       t
                                    
                                 
                                 =
                                 t
                                 ·
                                 
                                    
                                       Δ
                                    
                                    
                                       g
                                       (
                                       t
                                       )
                                    
                                 
                                 
                                    
                                       E
                                    
                                    
                                       t
                                    
                                 
                                 .
                              
                           
                        To detect scale-dependent features, Δ
                           norm
                        
                        E
                        
                           t
                         is required to be the local extrema with respect to both space and scale simultaneously. For a triangular mesh, the discrete Laplacian at vertex v
                        
                           i
                         can be calculated as follows:
                           
                              (13)
                              
                                 Δ
                                 
                                    
                                       E
                                    
                                    
                                       
                                          
                                             v
                                          
                                          
                                             i
                                          
                                       
                                    
                                    
                                       t
                                    
                                 
                                 =
                                 
                                    
                                       1
                                    
                                    
                                       2
                                    
                                 
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          
                                             
                                                v
                                             
                                             
                                                j
                                             
                                          
                                          ∈
                                          
                                             
                                                N
                                             
                                             
                                                1
                                             
                                          
                                          (
                                          
                                             
                                                v
                                             
                                             
                                                i
                                             
                                          
                                          )
                                       
                                    
                                 
                                 (
                                 cot
                                 
                                    
                                       α
                                    
                                    
                                       ij
                                    
                                 
                                 +
                                 cot
                                 
                                    
                                       β
                                    
                                    
                                       ij
                                    
                                 
                                 )
                                 
                                    
                                       
                                          
                                             
                                                E
                                             
                                             
                                                
                                                   
                                                      v
                                                   
                                                   
                                                      i
                                                   
                                                
                                             
                                             
                                                t
                                             
                                          
                                          -
                                          
                                             
                                                E
                                             
                                             
                                                
                                                   
                                                      v
                                                   
                                                   
                                                      j
                                                   
                                                
                                             
                                             
                                                t
                                             
                                          
                                       
                                    
                                 
                              
                           
                        where N
                        1(v
                        
                           i
                        ) is the 1-ring neighbors of v
                        
                           i
                        . α
                        
                           ij
                         and β
                        
                           ij
                         are the two angles opposite to edge e
                        
                           ij
                        .

Consequently, we obtain
                           
                              (14)
                              
                                 
                                    
                                       Δ
                                    
                                    
                                       norm
                                    
                                 
                                 Mat
                                 =
                                 
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         t
                                                      
                                                      
                                                         0
                                                      
                                                   
                                                   Δ
                                                   
                                                      
                                                         E
                                                      
                                                      
                                                         
                                                            
                                                               v
                                                            
                                                            
                                                               0
                                                            
                                                         
                                                      
                                                      
                                                         
                                                            
                                                               t
                                                            
                                                            
                                                               0
                                                            
                                                         
                                                      
                                                   
                                                
                                                
                                                   
                                                      
                                                         t
                                                      
                                                      
                                                         1
                                                      
                                                   
                                                   Δ
                                                   
                                                      
                                                         E
                                                      
                                                      
                                                         
                                                            
                                                               v
                                                            
                                                            
                                                               0
                                                            
                                                         
                                                      
                                                      
                                                         
                                                            
                                                               t
                                                            
                                                            
                                                               1
                                                            
                                                         
                                                      
                                                   
                                                
                                                
                                                   ⋯
                                                
                                                
                                                   
                                                      
                                                         t
                                                      
                                                      
                                                         n
                                                         -
                                                         1
                                                      
                                                   
                                                   Δ
                                                   
                                                      
                                                         E
                                                      
                                                      
                                                         
                                                            
                                                               v
                                                            
                                                            
                                                               0
                                                            
                                                         
                                                      
                                                      
                                                         
                                                            
                                                               t
                                                            
                                                            
                                                               n
                                                               -
                                                               1
                                                            
                                                         
                                                      
                                                   
                                                
                                             
                                             
                                                
                                                   
                                                      
                                                         t
                                                      
                                                      
                                                         0
                                                      
                                                   
                                                   Δ
                                                   
                                                      
                                                         E
                                                      
                                                      
                                                         
                                                            
                                                               v
                                                            
                                                            
                                                               1
                                                            
                                                         
                                                      
                                                      
                                                         
                                                            
                                                               t
                                                            
                                                            
                                                               0
                                                            
                                                         
                                                      
                                                   
                                                
                                                
                                                   
                                                      
                                                         t
                                                      
                                                      
                                                         1
                                                      
                                                   
                                                   Δ
                                                   
                                                      
                                                         E
                                                      
                                                      
                                                         
                                                            
                                                               v
                                                            
                                                            
                                                               1
                                                            
                                                         
                                                      
                                                      
                                                         
                                                            
                                                               t
                                                            
                                                            
                                                               1
                                                            
                                                         
                                                      
                                                   
                                                
                                                
                                                   ⋯
                                                
                                                
                                                   
                                                      
                                                         t
                                                      
                                                      
                                                         n
                                                         -
                                                         1
                                                      
                                                   
                                                   Δ
                                                   
                                                      
                                                         E
                                                      
                                                      
                                                         
                                                            
                                                               v
                                                            
                                                            
                                                               1
                                                            
                                                         
                                                      
                                                      
                                                         
                                                            
                                                               t
                                                            
                                                            
                                                               n
                                                               -
                                                               1
                                                            
                                                         
                                                      
                                                   
                                                
                                             
                                             
                                                
                                                   ⋮
                                                
                                                
                                                   ⋮
                                                
                                                
                                                   ⋱
                                                
                                                
                                                   ⋮
                                                
                                             
                                             
                                                
                                                   
                                                      
                                                         t
                                                      
                                                      
                                                         0
                                                      
                                                   
                                                   Δ
                                                   
                                                      
                                                         E
                                                      
                                                      
                                                         
                                                            
                                                               v
                                                            
                                                            
                                                               m
                                                            
                                                         
                                                      
                                                      
                                                         
                                                            
                                                               t
                                                            
                                                            
                                                               0
                                                            
                                                         
                                                      
                                                   
                                                
                                                
                                                   
                                                      
                                                         t
                                                      
                                                      
                                                         1
                                                      
                                                   
                                                   Δ
                                                   
                                                      
                                                         E
                                                      
                                                      
                                                         
                                                            
                                                               v
                                                            
                                                            
                                                               m
                                                            
                                                         
                                                      
                                                      
                                                         
                                                            
                                                               t
                                                            
                                                            
                                                               1
                                                            
                                                         
                                                      
                                                   
                                                
                                                
                                                   ⋯
                                                
                                                
                                                   
                                                      
                                                         t
                                                      
                                                      
                                                         n
                                                         -
                                                         1
                                                      
                                                   
                                                   Δ
                                                   
                                                      
                                                         E
                                                      
                                                      
                                                         
                                                            
                                                               v
                                                            
                                                            
                                                               m
                                                            
                                                         
                                                      
                                                      
                                                         
                                                            
                                                               t
                                                            
                                                            
                                                               n
                                                               -
                                                               1
                                                            
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                                 .
                              
                           
                        Then the feature points are identified as local extrema of the normalized Laplacian of the scale space representation across scale t. Specifically, it is done by comparing each vertex in the mesh structure to its 1-ring neighbors at the same scale t and also itself as well as its 1-ring neighbors at the neighboring scales t
                        −1 and t
                        +1. Because features at small scales could be possibly due to the noise, those features have been suppressed. Also, we set a threshold of the magnitude of the scale-normalized Laplacian for another level of feature selection, when too many features cause visual cluttering.

Taking geodesic scale into consideration, all the feature points in the geodesic scale of one single coarse feature point at coarse scales will be treated as one feature point. The scale is delineated by a center-surrounded geodesic neighborhood 
                           
                              U
                              (
                              v
                              )
                           
                         of vertex v under original metric g(0), which is formulated as
                           
                              (15)
                              
                                 U
                                 (
                                 v
                                 ,
                                 t
                                 )
                                 =
                                 x
                                 |
                                 dist
                                 (
                                 x
                                 ,
                                 v
                                 )
                                 <
                                 
                                    
                                       2
                                       t
                                    
                                 
                                 ,
                                 x
                                 ∈
                                 S
                                 (
                                 t
                                 )
                                 ,
                              
                           
                        where S(t) is the diffused surface at time t, and v is detected as a feature point at S(t). dist(x,
                        v) is the geodesic distance between point x and v, estimated under the original metric. Fig. 5
                         shows the feature point at different scales on a left hemisphere.

Since Ricci energy is an intrinsic property of surface, it is not related to the position or rotation [3]. Through the algorithm, we can get the parameterization result with decreased Ricci energy and conformal factor for each vertex.

For surface registration, we need to seek a mapping P:S
                        1
                        →
                        S
                        2 between two surfaces S
                        1 and S
                        2. Instead of seeking a mapping by using the surfaces directly, we use Ricci energy to represent the surface. Thus, we can find a mapping by reducing an scale function between two surfaces:
                           
                              (16)
                              
                                 
                                    
                                       E
                                    
                                    
                                       shape
                                    
                                 
                                 (
                                 P
                                 )
                                 =
                                 α
                                 |
                                 
                                    
                                       E
                                    
                                    
                                       1
                                    
                                 
                                 -
                                 
                                    
                                       E
                                    
                                    
                                       2
                                    
                                 
                                 ∘
                                 P
                                 
                                    
                                       |
                                    
                                    
                                       2
                                    
                                 
                                 +
                                 β
                                 |
                                 
                                    
                                       F
                                    
                                    
                                       1
                                    
                                 
                                 -
                                 
                                    
                                       F
                                    
                                    
                                       2
                                    
                                 
                                 ∘
                                 P
                                 
                                    
                                       |
                                    
                                    
                                       2
                                    
                                 
                                 .
                              
                           
                        Here, E
                        1 and E
                        2 are the Ricci energy calculated from (8) of S
                        1 and S
                        2, respectively. F
                        1 and F
                        2 are the feature point positions of S
                        1 and S
                        2. α and β provide a trade-off among the different terms of the function. The first term measures the geometric information differences between the shapes, which we define as 
                           
                              
                                 
                                    ∑
                                 
                                 
                                    i
                                 
                              
                              
                                 
                                    (
                                    
                                       
                                          E
                                       
                                       
                                          1
                                       
                                    
                                    (
                                    
                                       
                                          v
                                       
                                       
                                          i
                                       
                                    
                                    )
                                    -
                                    
                                       
                                          E
                                       
                                       
                                          2
                                       
                                    
                                    (
                                    
                                       
                                          v
                                       
                                       
                                          i
                                       
                                    
                                    ∘
                                    P
                                    )
                                    )
                                 
                                 
                                    2
                                 
                              
                              ,
                              
                                 
                                    v
                                 
                                 
                                    i
                                 
                              
                           
                         is the vertex on surface S
                        1, E
                        
                           i
                        (v
                        
                           i
                        ) is the Ricci energy of v
                        
                           i
                         on the surface S
                        
                           i
                        . The second term measures the feature point differences by using a scale-dependent representation as the local shape descriptor. Thus, E
                        
                           shape
                         measures the difference distance between S
                        1 and S
                        2. Especially, when E
                        
                           shape
                        
                        =0, S
                        1 and S
                        2 become equal up to a rigid rotation. Besides, by adjusting the parameters (α and β), we can relate E
                        
                           shape
                         with other methods. When β
                        =0, E
                        
                           shape
                         measures the Ricci energy differences between shapes. With α
                        =0, E
                        
                           shape
                         is the same as shape matching with scale-dependent shape descriptor. In our work, we set α
                        =1 and β
                        =0.5 to measure the complex shape variation. Therefore, the surface map P minimizing E
                        
                           shape
                        (P) is the best registration, given the geometry of the surfaces.

In order to simplify the calculation of registration, we use the Ricci flow-based spherical parameterization to map the surface S to a simple domain D while keeping the topological connectivity and the geometrical property. Denoting the parameterizations by ϕ
                        1:S
                        1
                        →
                        D
                        1 and ϕ
                        2:S
                        2
                        →
                        D
                        2, D
                        1, D
                        2
                        ∈
                        D, the mapping P minimizing E
                        
                           shape
                         can be transferred to a composition mapping 
                           
                              
                                 
                                    P
                                 
                                 
                                    ′
                                 
                              
                              =
                              
                                 
                                    ϕ
                                 
                                 
                                    2
                                 
                              
                              ∘
                              P
                              ∘
                              
                                 
                                    ϕ
                                 
                                 
                                    1
                                 
                                 
                                    -
                                    1
                                 
                              
                              :
                              
                                 
                                    D
                                 
                                 
                                    1
                                 
                              
                              →
                              
                                 
                                    D
                                 
                                 
                                    2
                                 
                              
                           
                         (Fig. 6
                        ). Then, the registration transfers to a sphere registration problem on the spherical domain D using (16) as the scale function.

In practice, we introduce Spherical Demons algorithm to solve our registration problem. It is based on the two-step optimization of the Demons algorithm and can conduct a good registration in the spherical domain. In order to minimizing the scale function (16), we modify demons objective function to a different interpretation:
                           
                              (17)
                              
                                 (
                                 ϒ
                                 ,
                                 
                                    
                                       P
                                    
                                    
                                       ′
                                    
                                 
                                 )
                                 =
                                 arg
                                 
                                    
                                       
                                          min
                                       
                                       
                                          ϒ
                                          ,
                                          
                                             
                                                P
                                             
                                             
                                                ′
                                             
                                          
                                       
                                    
                                 
                                 α
                                 ‖
                                 Σ
                                 (
                                 E
                                 (
                                 
                                    
                                       S
                                    
                                    
                                       1
                                    
                                 
                                 )
                                 -
                                 E
                                 (
                                 
                                    
                                       S
                                    
                                    
                                       2
                                    
                                 
                                 )
                                 ∘
                                 
                                    
                                       P
                                    
                                    
                                       ′
                                    
                                 
                                 )
                                 
                                    
                                       ‖
                                    
                                    
                                       2
                                    
                                 
                                 +
                                 β
                                 ‖
                                 
                                    
                                       F
                                    
                                    
                                       1
                                    
                                 
                                 -
                                 
                                    
                                       F
                                    
                                    
                                       2
                                    
                                 
                                 ∘
                                 
                                    
                                       P
                                    
                                    
                                       ′
                                    
                                 
                                 
                                    
                                       ‖
                                    
                                    
                                       2
                                    
                                 
                                 +
                                 
                                    
                                       1
                                    
                                    
                                       
                                          
                                             σ
                                          
                                          
                                             x
                                          
                                          
                                             2
                                          
                                       
                                    
                                 
                                 dist
                                 (
                                 ϒ
                                 ,
                                 
                                    
                                       P
                                    
                                    
                                       ′
                                    
                                 
                                 )
                                 +
                                 
                                    
                                       1
                                    
                                    
                                       
                                          
                                             σ
                                          
                                          
                                             T
                                          
                                          
                                             2
                                          
                                       
                                    
                                 
                                 Reg
                                 (
                                 ϒ
                                 )
                              
                           
                        where P′ is the transformation from D
                        1 to D
                        2 and ϒ is a hidden transformation used in demons algorithm. Then, we can apply the registration process based on [36].

@&#EXPERIMENTAL RESULTS@&#

In this section, we evaluate our parameterize algorithm on left cortical surface with different quality triangulations to show the conformality and robustness of the parameterization results.


                        Conformality. From Fig. 4, we can easily see that the topological connection of vertices keeps the same between original surface and parameterize sphere. In order to quantitatively measure the conformality, we compute the ratio between each corner angle of the cortical surfaces. The histogram of the ratios is illustrated in Fig. 7
                        . The ratio is highly concentrated around 1, which means the algorithm we used achieves a conformal mapping.


                        Robustness. 
                        Fig. 8
                         shows the Ricci energy distribution on a left cortical surface with different sampling vertices. We can see that although the resolution changes, the whole energy distribution has little change. Our method is robust to capture shape characteristics for surface matching and registration.


                        Convergence and Speed. Although the target curvature changes every step in the method, the whole Ricci energy can still get a unique global minimum and can converge stably. To show the computation speed and convergence of our method, we compare our method with traditional Euclidean Ricci flow [37] with several models. In order to process the Euclidean Ricci flow, we select a vertex as the cutting edge and process the planar parameterization. All the computation are implemented using Matlab on a Windows platform desktop with a 2.33-GHz CPU Intel Core2 Duo, 2 Gbytes of RAM. Fig. 9
                         shows the convergence and computation speed comparison between our method and the traditional method. From the figure, we can easily see that the convergence of our method is much faster than the traditional method.

Our Euclidean Ricci flow method is suitable for spherical parameterization. Since it is based on Euclidean geometry, we can easily get the inversive distance matrix while avoiding the complex calculation of spherical geometry. Based on [3], the Euclidean Ricci energy is strictly convex, which means our method can avoid the limitations of the spherical Ricci energy, while retaining the properties of surface Ricci flow, such as intrinsicalness and robustness.


                        Fig. 5 shows the geometric features extracted from the left cortical surface. Each feature is visualized by a sphere centered at the key points, whose radius is proportional to the corresponding scale of the feature. Because features at small scales can be possibly due to the noise, those features have been suppressed.

We test the changes of feature detection under different noises. Random noises are injected to the surface of the left cortical surface along the normal direction. The noise magnitudes are chosen from 0%, 10% and 20% of the bounding ball radius. As shown by Fig. 10
                        , although that small features may vary in locations because of the injected noises, features detected at larger scales are highly consistent across all cases, and are robustly detected at same locations and scales.

@&#EXPERIMENTS@&#

In order to measure the accuracy of the registration, we use a set of 39 left and right cortical surface models from the NAMIC public data (http://hdl.handle.net/1926/1728) which are extracted from in vivo MRI [7]. Both hemispheres are manually parcellated by a neuroanatomist into 35 major sulci and gyri (Table 1
                           ).

We co-register all 39 cortical surfaces using our framework by iteratively building an atlas and registering the surfaces to the atlas. Fig. 11
                            shows the registration results of four different left cortical surfaces. Different colors show different cortex labels. From the figure, we can see that our method can register the cortical surface well. We compute the average dice measure between each pair of registered subjects. Dice is defined as the ratio of overlapped cortical surface area with corresponding labels to the total surface area. In another word, Dice between S
                           1 and S
                           2 is defined as
                              
                                 (18)
                                 
                                    Dice
                                    =
                                    
                                       
                                          
                                             
                                                A
                                             
                                             
                                                
                                                   
                                                      S
                                                   
                                                   
                                                      1
                                                   
                                                
                                                ∩
                                                
                                                   
                                                      S
                                                   
                                                   
                                                      2
                                                   
                                                
                                             
                                          
                                       
                                       
                                          
                                             
                                                A
                                             
                                             
                                                
                                                   
                                                      S
                                                   
                                                   
                                                      1
                                                   
                                                
                                                ∪
                                                
                                                   
                                                      S
                                                   
                                                   
                                                      2
                                                   
                                                
                                             
                                          
                                       
                                    
                                    .
                                 
                              
                           We compare our method with the registration method using sulci patterns and curvature measures [36]. On the left hemisphere, the Dice is 78.89 for our method and 76.25 for sulci and curvature data. On the right hemisphere, our method obtains a Dice of 75.20 while the sulci and curvature-based method achieve 74.27. The results confirm that our method provides an improvement on accuracy compared with sulci and curvature-based method.

We also analyze the registration accuracy for each structure, respectively. Fig. 12
                            displays the average Dice per structure for our method and the sulci and curvature-based method for the left and right hemispheres. Standard errors of the mean are displayed as well. Fig. 13
                            show the percentage Dice improvement over the sulci and curvature-based method on each structure.

@&#DISCUSSION@&#

These results suggest that our method can statistical significantly improve the registration results, especially on the structures with rich geometry feature points like cuneus (Label 6), Lateral Occipital (Label 12) and frontal pole (Label 33).

Since Ricci energy is intrinsic for surface and contains Gaussian curvature information, it can also represent the surface curvature and sulci information correctly. Besides, conformal factor can gives the diffusion information of a vertex on the surface. By combining Ricci energy and conformal factor together, we can better represent the surface and obtain an improved one-to-one mapping from the original surface to the sphere domain. The globally optimized registration can be solved in the spherical domain. We also take local geometry features into consideration. The multi-scale geometric features give more details than curvature especially on tiny structures, which allows our method to register the local tiny structure much more accurately. From Fig. 13, we can easily find out that our method can give a nice improvement on frontal, occipital and temporal lobe.

Since our method is dependent only on the surface geometry, it is suitable to register surfaces which are hard to define the landmarks, like hippocampus. Here we evaluate our method with 33 hippocampus surfaces from [32], which are from an adult schizophrenia study (mean age 32, all male gender). All cases have been fully randomized and the group association has been performed qualitatively/visually to create 2 different groups.

Hippocampus (HP) was first parameterized to sphere and then registered to each other. Fig. 14
                      shows the registration results of two different hippocampi. Fig. 15
                      shows the Ricci energy distribution of two groups. We can see that Ricci energy can collectively capture the global shape information while feature points and their scale factors can express the local significant property with local geometry.

After the registration, we construct a GLM to test the group effect and perform T-test on Ricci energy of each HP surface to analyze the shape differences between each other. Fig. 16
                      shows the significant different area on HP surfaces. By using Ricci energy and the feature scale factors, we observe that the HP surfaces have significant difference at the anterior area and the middle area of the HP, which are in accordance with the clinical acknowledge on HP with schizophrenia. In [6], the researchers reported local shape analysis results of hippocampal abnormalities in schizophrenia located mainly in the head region, but also, to a minor extent, in the tail. While in [32], the pattern of shape abnormality shows a hippocampal shape change in the tail region due to deformation and suggests deformation of the hippocampal tail at a position where it connects to the fimbria. Our results shows abnormalities on both head and tail of hippocampus, which indicates that our method constitutes a very sensitive and accurate shape analysis.

@&#CONCLUSION@&#

In this paper, we have proposed a new way to calculate spherical parameterization based on Euclidean Ricci flow. By adapting the Gaussian curvature calculation, the computation is much more efficient and effective than conventional Ricci flow methods while still retaining the basic properties of the Ricci energy such as intrinsicalness, robustness and convergence. Built upon the Ricci energy, we have designed a scale space processing for the extraction of scale dependent geometry feature points. An integrated objective function that combines Ricci energy and geometry features has been presented for surface matching and registration. From the experimental results, we can see that our method can register the cortical surface accurately. We have also applied Ricci energy to shape analysis on hippocampus. The experimental results show that Ricci energy is an intrinsic property of surface and can be used for statistical group analysis of shapes. In the future, we will take more surface intrinsic properties into account for surface feature extraction, registration and analysis. One future task is to use multivariate scale space instead of Ricci energy alone, which will locate the surface feature point more precisely and make the registration for each structure much more accurately.

@&#ACKNOWLEDGMENTS@&#

This work is supported in part by 863 Project (2013AA013803), NSFC (61271151,61228103), NSF (IIS-0915933, IIS-0937586, IIS-0713315), and NIH (1R01NS058802-01, 2R01NS041922-05). The author also gratefully acknowledges the support of K.C.Wong Education Foundation, Hong Kong.

@&#REFERENCES@&#

