@&#MAIN-TITLE@&#A progressive black top hat transformation algorithm for estimating valley volumes on Mars

@&#HIGHLIGHTS@&#


               
               
                  
                     
                        
                           
                           We developed an innovative algorithm for estimating valley volume based DEM data.


                        
                        
                           
                           Test on a simulated landform showed 96% relative accuracy in volume estimate.


                        
                        
                           
                           Application to Ma’adim Vallis, Mars, resulted in better volume estimates.


                        
                        
                           
                           Algorithm is highly automated, amendable to estimate global valley volume on Mars.


                        
                     
                  
               
            

@&#KEYPHRASES@&#

Progressive black top hat transformation

Valley volume

Mars

Water

Algorithm

@&#ABSTRACT@&#


               
               
                  The depth of valley incision and valley volume are important parameters in understanding the geologic history of early Mars, because they are related to the amount sediments eroded and the quantity of water needed to create the valley networks (VNs). With readily available digital elevation model (DEM) data, the Black Top Hat (BTH) transformation, an image processing technique for extracting dark features on a variable background, has been applied to DEM data to extract valley depth and estimate valley volume. Previous studies typically use a single window size for extracting the valley features and a single threshold value for removing noise, resulting in finer features such as tributaries not being extracted and underestimation of valley volume. Inspired by similar algorithms used in LiDAR data analysis to remove above-ground features to obtain bare-earth topography, here we propose a progressive BTH (PBTH) transformation algorithm, where the window size is progressively increased to extract valleys of different orders. In addition, a slope factor is introduced so that the noise threshold can be automatically adjusted for windows with different sizes. Independently derived VN lines were used to select mask polygons that spatially overlap the VN lines. Volume is calculated as the sum of valley depth within the selected mask multiplied by cell area. Application of the PBTH to a simulated landform (for which the amount of erosion is known) achieved an overall relative accuracy of 96%, in comparison with only 78% for BTH. Application of PBTH to Ma’adim Vallies on Mars not only produced total volume estimates consistent with previous studies, but also revealed the detailed spatial distribution of valley depth. The highly automated PBTH algorithm shows great promise for estimating the volume of VN on Mars on global scale, which is important for understanding its early hydrologic cycle.
               
            

@&#INTRODUCTION@&#

It has been generally accepted that water was an active geomorphic agent on Mars in the geologic past when the climate was warmer and wetter than present, capable of maintaining some form of precipitation, and the valley networks (VNs, dendritic patterns of river-like linear depressions) are the best evidence left behind (e.g., Carr, 1996; Craddock and Howard, 2002; Hynek and Phillips, 2003; Lamb et al., 2006; Luo and Stepinski, 2009). However, the details of how the rainfall was maintained, the style and rate of the hydrologic cycle, whether the erosion occurred in a series of episodes or continuous slow rainfall runoff events, whether oceans or seas existed, and their role in relation to rainfall and VN formation are topics of on-going research (Carr and Head, 2010; Carr, 2012). The volume of excavation by fluvial processes is a critical piece of information for better understanding these research questions. With the ready availability of digital elevation model (DEM) data for Mars (Smith et al., 2003), we are now in a better position to update the estimated volume of excavation by VNs. This paper presents a new Progressive Black Top Hat Transformation algorithm that is inspired by the Simple Morphological Filter (Pingel et al., 2013) used in LiDAR data processing to separate bare-Earth surface and above- ground features and by the Black Top Hat Transformation algorithm (Soille, 2003) used in image processing to extract dark features on a varied background (Rodriguez et al., 2002).

The inventory of water on Mars has been estimated based on a number of different sources: volatiles from volcanic activities (Carr, 1986), geomorphologic traces left by past water activities [e.g., paleolakes and deltas (Fassett and Head, 2005; Irwin et al., 2005), outflow channels (Carr, 1996), valley networks (Gulick, 2001)], and the hypothesized northern ocean (Carr and Head, 2003). The volume of VNs and the associated amount of water needed to erode VNs may hold the key to understanding the ongoing research questions mentioned above. However, these two quantities are thus far not well constrained, especially on a global scale. Previous attempts at estimating these two quantities were primarily conducted at selected local sites based on simple estimates of VN lengths and widths and depths by assuming VN wall slopes (Gulick and Baker, 1989; Greeley et al., 1990; Goldspiel and Squyres, 1991; Crown and Greeley, 1993; Gulick, 2001). The results contained large uncertainty due to crude methodology and poor data quality. A recent study used Mars Express High Resolution Stereo Camera (HRSC) DEM data (with a horizontal resolution of 75m and vertical resolution of 10m) to estimate the volume of VN erosion (V
                     
                        s
                     ) from the valley area and the average depth of the individual segments according to the following equation:
                        
                           (1)
                           
                              
                                 
                                    V
                                 
                                 
                                    s
                                 
                              
                              =
                              
                                 ∑
                                 
                              
                              
                                 
                                    a
                                 
                                 
                                    i
                                 
                              
                              
                                 
                                    h
                                 
                                 
                                    i
                                 
                              
                           
                        
                     where a
                     
                        i
                      is the valley area of segment i, and h
                     
                        i
                      the mean depth of segment i (Jaumann et al., 2010). Although the spatial resolution of HRSC DEM data is much improved, the above method is still a tedious and time-consuming process involving much human intervention, thus not amenable for global scale analysis.


                     Matsubara et al. (2013) also estimated valley depths of selected reaches of Noachian highlands by searching actual Mars Obiter Laser Altimeter (MOLA) measurements along the valley networks within a 4km×4km window and taking the difference between the 75th percentile value within the window (as elevation of valley shoulder) and the minimum elevation within the window (as elevation of valley floor). The local valley volume was measured by overlaying a 16km×16km box centered on a valley and calculating the valley volume from the detrended 75th percentile elevation (Matsubara et al., 2013). Although the process is automated, specific criteria must be met and thus only selected sample of reaches were estimated (Matsubara et al., 2013).

The Black Top Hat (BTH) transformation, a morphological image processing technique, has been successfully applied to DEM data to extract valley depth at pixel level and thus offers more accurate estimates of volumes (Rodriguez et al., 2002). It works by constructing a pre-incision surface from the current DEM and calculating the difference between the pre-incision surface and the current DEM to estimate the valley depth and derive valley volume. The construction of the pre-incision surface involves two operations, i.e., a dilation operation followed by a closing operation. The dilation operation calculates the maximum elevation within a moving circular window centered on a target cell in the original DEM. The closing operation calculates the minimum elevation within a moving circular window centered on a target cell from the dilation result (Rodriguez et al., 2002; Luo et al., 2010, 2011). A threshold value t is applied to remove noise in the data to obtain valley depth at each pixel within the valley. The valley depth at each pixel multiplied by the pixel area is the volume of that pixel. The volume of the valley is then computed as the sum of each pixel’s volume within the valley. In other words, Eq. (1) still applies, with a
                     
                        i
                      representing the area of pixel i, and h
                     
                        i
                      the depth of pixel i. This is process is schematically shown in 
                     Fig. 1 for a 2D profile case. However, since only a single window size is used in this approach, in order to capture the main valleys, a large window size is needed and this often resulted in missing the volume contribution from smaller and shallower tributaries.

With the advent of LiDAR data, various algorithms have been developed to automatically separate 3-D point clouds representing above-ground objects (e.g., buildings, trees, etc.) from those representing the bare-earth (e.g., Axelsson, 2000). If we invert the Martian topography, the valleys will become positive features and thus the procedures in these LiDAR processing algorithms can be borrowed to develop algorithms for estimating VN volume.


                     Pingel et al. (2013) developed a simple yet efficient algorithm called Simple Morphological Filter (SMRF) to remove positive features in LiDAR data to create a bare-earth DEM. The input to the SMRF algorithm is a gridded DEM that contains above-ground objects (such as buildings and trees) and the purpose is to remove these objects to create a bare-earth DEM. SMRF first finds the minimum within a moving circular window (termed erosion) and then finds the maximum of the erosion result and the process is iteratively applied with the window size increased by a small increment at each iteration to locate and remove above-ground objects of different sizes (such as buildings and trees). The parameters include a maximum window size and a slope threshold. The slope threshold value governs the above-ground object identification process, and roughly corresponds to the slope of the above-ground objects to be removed in study area. The maximum window size corresponds to the size of the largest feature to be removed (Pingel et al., 2013). By iteratively increasing the window size, SMRF identifies and removes most of the “unwanted” positive features.

The Progressive Black Top Hat (PBTH) algorithm integrates the idea of iteratively increasing window sizes into the traditional BTH algorithm to capture the smaller and shallower features such as tributaries and thus improve the accuracy of volume estimate of valleys. The algorithm is illustrated in 
                     Fig. 2 and is composed of three parts: pre-processing, PBTH, and post-processing. We will present the steps of the algorithm first and defer the discussion on how various threshold values are determined in Section 4.

The pre-processing is to remove the relatively large craters, which could complicate the PBTH processing later on, using two criteria developed in Molloy and Stepinski (2007): (1) the size has to be greater than a threshold size C
                     
                        z
                     , (2) its circularity 
                        (
                        =
                        4
                        π
                        ×
                        (
                        area
                        /
                        
                           
                              perimeter
                           
                           2
                        
                        )
                        )
                      has to be greater than a threshold C
                     
                        c
                     . Specifically, the following calculations were conducted: filling the original DEM, differencing the filled DEM and the original DEM, thresholding the difference grid (using 10% of mean), grouping the difference grid into regions, computing the area and circularity of regions, and setting regions whose area and circularity are greater than user defined thresholds (C
                     
                        z
                      and C
                     
                        c
                     , respectively) to no_data (Molloy and Stepinski, 2007), thus removing them from further processing.

The PBTH part starts with user-defined initial window radius r (measured in number of cells or pixels) and slope factor s (measured in percent rise). The BTH result at the initial window size (r
                     0) is calculated by (1) finding the maximum elevation from the original DEM within the moving window, (2) finding the minimum within the same size moving window from the result in step (1), (3) differencing result from step (2) and original DEM. Next, the threshold for removing noise t is calculated as the product of the window radius r, the slope factor s, and the cell size of the DEM. Based on t, two grids are derived: the BTHmr is a mask grid (for window size r) whose cells will receive the value of 1 if the BTH value is greater than t, otherwise the cells will be set to no_data; the BTHv
                        r
                      is a value grid (for window size r) whose cells will receive the BTH values if the BTH value is greater than t, otherwise the cells will be set to no_data. The previous process is repeated after the window size (r) is increased by an increment (Δr) until the maximum window size (r
                     
                        max
                     ) is reached. Then the BTH mask grids (BTHm
                        r
                     ) for all window sizes (r=r
                     0, …, r
                     
                        max
                     ) are merged into one mask so that its cells will receive value of 1 if any of BTHmr cell is 1 and a new maxBTH value grid is derived as the maximum from the stack of BTH value grids (BTHv
                        r
                     ) from all window sizes (r=r
                     0, …, r
                     
                        max
                     ).

The post-processing part first groups the merged mask cells into regions and remove regions (or patches) that are isolated and too small in size (smaller than a small patch threshold p). The result grid is converted into vector polygons and overlaid with the VN line data to select only the polygons that overlap with the VN lines. The selected polygons are converted back to a raster grid: mask_sel. The finalBTH is the maxBTH grid that falls within the mask_sel grid. The volume is then estimated as the sum of finalBTH cell values multiplied by the area of the each cell (see Eq. (1) with a
                     
                        i
                      as the area of pixel i, and h
                     
                        i
                      the depth of pixel i).

The above procedure is implemented as an Arc Macro Language (AML) script in ArcInfo Workstation version 10.0. The code and test data are available at http://www.journals.elsevier.com/computers-and-geosciences/.

In order to test PBTH algorithm and quantify its accuracy, we applied it to a simulated surface of Mars [
                     Fig. 3(B)], which is the result of rainfall and runoff erosion of an initial cratered landscape [Fig. 3(A)] (Howard, 2007). The simulation domain is 256×256 cells with each cell 2m, so each side is 512m. The cell size is scaled so that the slope distribution generally matches that of the real Mars landform. The purpose here is to use a simulated surface with known pre-incision elevation so we can calculate the true volume of erosion, which will then be used to test the performance of the algorithm. Also shown in Fig. 3(B) is the valley lines automatically extracted in ArcGIS with north and south portions edited out to remove edge effects in the simulation. These valley lines are used in the algorithm to automatically select PBTH-derived polygons that represent the valleys.

The true depths of valleys in the simulated landform can be easily derived by calculating the difference between the initial surface [Fig. 3(A)] and final eroded surface [Fig. 3(B)] and the result is shown in Fig. 3(C). The difference surface is thresholded at 0.2m (equivalent to t) to remove the “noise” and the result that overlaps the edited valley lines is shown in Fig. 3(D). The volume calculated based on this thresholded surface is 21,940.71m3 and will be used as the “truth” to quantify the accuracy of estimate from the BTH and PBTH algorithms.

The results of applying both BTH and PBTH algorithms to the test data are shown in Fig. 3(E–H) and 
                     Table 1 and parameter values used are summarized in 
                     Table 2. For BTH method, we used window size r=10 cells and slope factor s=0.02. For PBTH, r=3, 4, 5, …, 10 cells and s=0.02. It is clear that results from BTH and PBTH methods are generally consistent with the “truth”, but PBTH method extracts a greater number of smaller valleys, whereas the BTH misses them. From the volume estimates (Table 1), BTH has an overall relative accuracy of ~78%, whereas that for PBTH reaches ~96%, much closer to the “true” value. The spatial correlation coefficients (Goodchild, 1986) between the estimated depth grids and the “true” grid are also obtained and the coefficient for PBTH (~0.7) is also better than that for BTH (~0.6). In addition, the spatial distribution of difference between the BTH estimate and “truth” at pixel level is shown in Fig. 3(G) and reveals a general pattern of underestimates in deep depth areas and overestimates in shallow depth areas [comparing Fig. 3(D)]. The difference value ranges between −0.87m and 0.76m, with a mean of −0.16m and a standard deviation of 0.23m. A similar map for PBTH is shown in Fig. 3(H) and reveals a similar spatial pattern but with less extreme values and better statistics than those from BTH results (min=−0.80m, max=0.76m, mean=−0.09m, and standard deviation=0.2m). Comparison of Fig. 3(G) and (H) also shows more underestimates (i.e., more blue colors) in BTH method than PBTH method, again demonstrating superiority of PBTH method.


                     
                     Fig. 4 and 
                     Table 3 show the results of applying both BTH and PBTH methods to the MOLA DEM data (with a resolution of ~463m) and HRSC DEM (with a resolution of 75m) in the Ma’adim Vallis region on Mars, with the parameters values summarized in Table 2. The MOLA DEM data was generated by MOLA team (Smith et al., 2003) and we mosaicked the publically released HRSC DEMs (http://pds-geosciences.wustl.edu/missions/mars_express/hrsc.htm) to cover the whole Ma’adim Vallis. The VN vector lines are extracted from Hynek at al. (2010) and Luo and Stepinski (2009). The window radius used for BTH for MOLA data is r=21 cells (or 9723m) and that for HRSC is r=130 cells (or 9750m), which is about half the width of the widest part of the valley (see more discussion in Section 4). The radius for PBTH for MOLA is r=9, 12, 15, …, 21 cells and that for HRSC data is r=50, 70, 90, …130 cells. Again the results show that BTH method misses the smaller valleys, and thus generally gives a smaller estimate than PBTH method. The higher resolution HRSC data also gives a higher estimate because there are more sampling points with a smaller cell size. These estimates (Table 3) are generally consistent with the previous estimates of volume for this valley: 7.9×1012
                     m3 to 2.6×1013
                     m3 by Gulick (2001) and 1.3×1013
                     m3 by Goldspiel and Squyres (1991). Both of these previous studies admitted large uncertainties in their estimates (Goldspiel and Squyres, 1991; Gulick, 2001). Based on the high overall relative accuracy achieved when applying the PBTH method to the simulated data, we are confident that the PBTH result from the high resolution HRSC data not only offers the best estimate, but also shows detailed spatial variation of depths.

@&#DISCUSSION@&#

The implied assumption in both BTH and PBTH methods is that the present elevation of the valley shoulders did not change significantly from its pre-incision value. This is a reasonable assumption for Mars, as VNs are thought to have incised locally into broad upland surfaces (Howard et al., 2005; Irwin et al., 2005; Kereszturi, 2005; Barnhart et al., 2009).

The threshold values listed in Table 2 are derived as follows. Similar to what the SMRF algorithm used to separate bare-earth and above-ground object, where the maximum window size (diameter) corresponds to the largest feature to be removed and the slope factor that governs the cell-based ground/non-ground flagging, the maximum window radius used in PBTH corresponds to half of the largest valley widths to be extracted and the slope factor corresponds to the background slope of the topography. Similarly, the minimum window radius corresponds to half of the smallest valley widths to be extracted. The valley width can be easily measured or estimated based on DEM data.

The advantage of using a slope factor rather than an actual vertical height to threshold the depth grid is that as the window size increases, the threshold t (for removing noise) should be larger and it will be automatically adjusted as t=r×s×cellsize. Note here radius is used because the search is within a distance of r (i.e., within a circular window centered on the target cell). The slope factor s represents the background slope after the areas with large slopes are removed. The slope factor can also be estimated as follows: (1) calculate the slope of the input DEM, (2) set the cells in the slope grid whose values are greater than the mean slope to no_data, and (3) calculate the mean value of the resultant grid and use this new mean values as the estimate of the slope factor. The increment for window size is determined as a balance between the computational time and accuracy of the result.

The threshold values for removing large caters were determined by examining the craters within the study area, referencing previous studies (Molloy and Stepinski, 2007), and some trial and error. After the parameter values are determined, the rest of the process is automated. However, we do anticipate some minimum manual editing may be needed in some complicated terrains when apply it to all of Mars. To minimize the distortion resulted from map projection on global datasets, we will choose an equal area projection by evaluating the options suggested in Steinwand et al. (1995) or conduct geodesic area calculation using software such as “Tools for Graphics and Shapes” (http://www.jennessent.com/arcgis/shapes_graphics.htm)Although post-formational modification to the valleys may be minimum (Williams and Phillips, 2001), there may nonetheless be modifications such as eolian fill and mass wasting (e.g., Grant et al., 2008). Thus the volume estimates derived with PBTH method represents a lower bound. Comparing the estimates from MOLA and HRSC data reveals that MOLA estimate is about 91% of HRSC value. However, MOLA has global coverage whereas HRSC does not. Therefore, for areas where there is only MOLA coverage, the estimate may be scaled upward by 1.1 times. The algorithm has been tested on DEMs with various resolutions (2 m for simulated DEM, 75m for HRSC, and 463m for MOLA). It can certainly be applied to higher resolution DEMs for Mars when they become available, but the threshold values will need to be adjusted.

We have developed a new Progressive Black Top Hat (PBTH) algorithm for estimating valley volume on Mars. Two key required parameters are maximum window size r
                     
                        max
                      and the slope factor s, both of which can be measured/estimated from input DEM data and slope derived from DEM. The application of the method to a simulated landform, where we know the pre-incision surface and thus the “true” erosion volume, achieved an overall relative accuracy of 96% and spatial pattern of valley is generally consistent with the “truth”, with the spatial correlation coefficient reaching 0.7. The application of the algorithm to Ma’adim Vallis on Mars also produced results generally consistent with previous studies, but more robust and accurate. Higher resolution HRSC data generated estimate that is 1.1 times more than that from MOLA data.

It is our intention to apply this method to all of Mars to estimate the global volume of excavation by VN with the aim of shedding new insights into the hydrologic cycle and climatic history of early Mars.

@&#ACKNOWLEDGMENT@&#

This research is supported by National Aeronautics and Space Administration Grant NNX13AK65G. We would like thank Trent Hare and an anonymous reviewer for their careful review of an earlier version of the paper, which helped to improve its quality.

Supplementary data associated with this article can be found in the online version at doi:10.1016/j.cageo.2014.11.003.


                     
                        
                           
                              Supplementary Material
                           
                           
                        
                     
                  


                     
                        
                           
                              Supplementary Material
                           
                           
                        
                     
                  


                     
                        
                           
                              Supplementary Material
                           
                           
                        
                     
                  


                     
                        
                           
                              Supplementary Material
                           
                           
                        
                     
                  


                     
                        
                           
                              Supplementary Material
                           
                           
                        
                     
                  

@&#REFERENCES@&#

