@&#MAIN-TITLE@&#Dynamic allocations for currency futures under switching regimes signals

@&#HIGHLIGHTS@&#


               
               
                  
                     
                        
                           
                           Exchange carry trade returns can be classified in regimes by a Hidden Markov Model.


                        
                        
                           
                           Regime identification allows to construct outstanding carry trade strategies.


                        
                        
                           
                           Optimal mean-semivariance currency portfolio enhances carry trade strategies.


                        
                     
                  
               
            

@&#KEYPHRASES@&#

Investment analysis

Currency futures

Carry trade

Regime identification

Mean-semivariance portfolio optimization

@&#ABSTRACT@&#


               
               
                  Over the last decades, speculative investors in the FX market have profited in the well known currency carry trade strategy (CT). However, during currencies or global financial crashes, CT produces substantial losses. In this work we present a methodology that enhances CT performance significantly. For our final strategy, constructed backtests show that the mean-semivolatility ratio can be more than doubled with respect to benchmark CT.
                  To do the latter, we first identify and classify CT returns according to their behavior in different regimes, using a Hidden Markov Model (HMM). The model helps to determine when to open and close positions, depending whether the regime is favorable to CT or not. Finally we employ a mean-semivariance allocation model to improve allocations when positions are opened.
               
            

@&#INTRODUCTION@&#

A currency future (CF) is a popular contract in the FX market. It is an agreement between two parties to exchange one currency for another at some future date at a price fixed on the purchase date. CF allows companies to hedge against currency risk, and it allows speculators to bet on exchange movements with less up-front investments and high leverage.

There are multiple factors that can affect exchange movements. Thus it is hard to derive a model with good prediction powers, especially for the short run. For example, Cheung, Chinn, and Pascual (2005) or Kilian and Taylor (2003) tested several modelsand found that none could consistently beat random walk forecasts. According to them, U.S. exchange traders think that economic fundamentals are more important at longer horizons, while short-run deviations from the fundamentals are attributed to excess speculation and institutional customer/hedge fund manipulation.

A popular CF strategy among financial investors is the carry trade (CT). CT rests on foreign interest rates. It consists of taking short (long) positions in CF from low (high)-yielding currencies. Hence, this strategy expects that a currency will appreciate/ depreciate when the interest is high/low in relation to the other currencies. The strategy is net zero, that is, the total value in short positions is equal to the total value in long positions. More about CT strategies performance and details can be found in (Burnside, Eichenbaum, & Rebelo, 2008; Jylha & Suominen, 2009) and (Galati, Heath, & McGuire, 2007).

In this paper we develop CF strategies that can outperform CT. To achieve this, we first see if CT can be classified in regimes, just like many other markets do. The cyclical behavior of markets facilitates the search for regimes that emerge in different periods of time. The aim and success of this classification method is determined by the heterogeneity of the regimes. In the present case, we look for different behavior of CT returns. As explained below, the regime detection is based on a machine learning process, rather than economic fundamentals. Once regimes are identified, we will be able to create a signal for closing and opening positions depending whether the current regime is conducive to CT strategy or not. The idea is to hold onto a CT strategy when the signal is on and stay out when it is off.

One successful model for regime detection is the Hidden Markov Model (HMM). It assumes data behaves as a Markov process, but states are not observed. In this case, CT returns are the observed data, while regimes are the hidden states. Applying HMM in finance is nothing new. Pioneering work in this field was done by Hamilton (1989), who identified U.S. economy cycles with the gross national product series. Guidolin and Timmermann (2007) utilize a four-state HMM for a series of stock returns. Recently, Prajogo (2011) built an HMM for an agribusiness index. Bae, Kim, and Mulvey (2014) did HMM regime identification on equity, commodities and bond indexes, also using a four-state model. More applications of HMM in Finance can be found in (Mamon, 2014) and (Bhar & Hamori, 2006).

In a second step, we examine ways to allocate long and short positions during periods when positions open, i.e., during periods when carry trade opportunities work in general. CT strategies are based on simple allocation rules; for example, to take equally-weighted long/short positions in the highest/lowest K interest rates currencies (see Deutsche Bank G10 Currency Harvest Fund).

To improve those simple allocation rules, we therefore allocate with a mean-semivariance approach. We use this approach for several reasons. Semivariance can be considered as a downside risk measure because it belongs to the lower partial moment (LPM) of degree two (Fishburn (1977) for more details about LPM). Markowitz (2010) shows that semivariance can measure investor’s utility toward risk, and hence suggests to use the geometric mean-semivariance. We prefer to use this risk measure instead of the alternatives, such as the conditional value at risk (CVaR), because although they are widely used in practice, many of them are not considered risk measures because they are LPM of degree one (CVaR) or zero (VaR). In fact, Markowitz (2010) rejects CVaR and VaR as risk measures. For more mean-semivariance applications see Huang (2008), Ballestero (2005), Vasant, Irgolic, Kruger, and Rajaratnam (2014) and Estrada (2007).

The present work is organized as follows. Section 2 analyzes the performance of standard CT. Section 3 shows HMM fitting results for CT returns. Section 4 implements and tests HMM based strategies. Section 5 tests the same HMM-based strategies, but adding mean-semivariance allocation on openings. Finally, Section 6 concludes and points to possible future research.

When investing in CF at time t, we buy (or sell) foreign exchange at a rate of 
                        
                           F
                           
                              t
                           
                           T
                        
                      at some date T > t. Then at time T, we can earn a profit of 
                        
                           
                              S
                              T
                           
                           −
                           
                              F
                              
                                 t
                              
                              T
                           
                        
                     
                     
                        
                           (
                           
                              F
                              
                                 t
                              
                              T
                           
                           −
                           
                              S
                              T
                           
                           )
                        
                      if we sell (buy) that amount on the market. 
                        
                           F
                           
                              t
                           
                           T
                        
                      is priced according to the covered interest parity. If i and ic
                      denote the interest rate at time t of home and foreign country respectively, and St
                      the current spot rate (units of home currency in one unit of foreign currency), then:

                        
                           
                              
                                 
                                    F
                                    
                                       t
                                    
                                    T
                                 
                                 =
                                 
                                    S
                                    t
                                 
                                 exp
                                 
                                    (
                                    
                                       (
                                       i
                                       −
                                       
                                          i
                                          c
                                       
                                       )
                                    
                                    
                                       (
                                       T
                                       −
                                       t
                                       )
                                    
                                    )
                                 
                              
                           
                        
                     The return on CF investment 
                        
                           
                              r
                              
                                 t
                              
                              T
                           
                           :
                           =
                           
                              
                                 S
                                 T
                              
                              
                                 F
                                 
                                    t
                                 
                                 T
                              
                           
                           −
                           1
                        
                      is approximated by

                        
                           (1)
                           
                              
                                 
                                    r
                                    
                                       t
                                    
                                    T
                                 
                                 ≈
                                 log
                                 
                                    
                                       S
                                       T
                                    
                                    
                                       S
                                       t
                                    
                                 
                                 +
                                 
                                    (
                                    
                                       i
                                       c
                                    
                                    −
                                    i
                                    )
                                 
                                 
                                    (
                                    T
                                    −
                                    t
                                    )
                                 
                              
                           
                        
                     
                  

To include transactions costs, we denote 
                        
                           S
                           
                              t
                           
                           
                              b
                              i
                              d
                           
                        
                      and 
                        
                           S
                           
                              t
                           
                           
                              a
                              s
                              k
                           
                        
                      as the bid and ask prices respectively. For long CF, returns in (1) can be expressed as

                        
                           (2)
                           
                              
                                 
                                    r
                                    
                                       t
                                    
                                    T
                                 
                                 =
                                 log
                                 
                                    
                                       S
                                       
                                          T
                                       
                                       
                                          b
                                          i
                                          d
                                       
                                    
                                    
                                       S
                                       
                                          t
                                       
                                       
                                          a
                                          s
                                          k
                                       
                                    
                                 
                                 +
                                 
                                    (
                                    
                                       i
                                       c
                                    
                                    −
                                    i
                                    )
                                 
                                 
                                    (
                                    T
                                    −
                                    t
                                    )
                                 
                              
                           
                        
                     Analogously, the return for short CF

                        
                           (3)
                           
                              
                                 
                                    r
                                    
                                       t
                                    
                                    T
                                 
                                 =
                                 −
                                 log
                                 
                                    
                                       S
                                       
                                          T
                                       
                                       
                                          a
                                          s
                                          k
                                       
                                    
                                    
                                       S
                                       
                                          t
                                       
                                       
                                          b
                                          i
                                          d
                                       
                                    
                                 
                                 −
                                 
                                    (
                                    
                                       i
                                       c
                                    
                                    −
                                    i
                                    )
                                 
                                 
                                    (
                                    T
                                    −
                                    t
                                    )
                                 
                              
                           
                        
                     
                  

As previously mentioned, CT policy is based on ranking interest rates among the pool of currencies available. As done in (Brunnermeier, Nagel, & Pedersen, 2008), we buy (sell) equal amounts of CF in the K highest (lowest) interest rates. To test this strategy, we take interest rates differentials (relative to the U.S. interest rate) embedded in forward rates from the G10 currencies. The performance of quarterly rebalancing between January 2000 and June 2015 (62 quarters) is presented in Table 1
                     . The period January 1996 to December 1999 was assigned for training performance as explained in next sections.

The table shows that CT has been profitable on average. This aligns with the known forward premium puzzle, which basically shows empirically that 
                        
                           F
                           
                              t
                           
                           T
                        
                      is a poor estimator for ST
                      . Otherwise, r ≈ 0 for each currency and hence CT returns would have been close to zero too. The puzzle is analyzed and explained in (Bansal & Dahlquist, 2000; Fama, 1984; Pippenger, 2011) and (Reinert, Rajan, Glass, 2009). If we increase K, we observe diversification effects. The best compromise between profit and downside risk, measured by the mean semivariance ratio (MSV), is when we go long with two currencies and short with another two. The presence of negative skewness means there can be huge losses across periods.

To have some insight of the most active currencies, we look at Fig. 1
                     , which show some metrics about the weights for CT portfolio in time. The New Zealand Dollar (NZD) and the Australian Dollar (AUD) are the main target currencies (where we go long), followed by the Norwegian Krone (NOK). Oppositely, the Swiss Franc (CHF) is always a funding currency. Other funding currencies used are the Japanese Yen (JPY), Swedish Krone (SEK) and Danish Krone (DKK). The rest of the currencies are rarely used and can be either target or funding in time. The best MSV was obtained 
                        
                           K
                           =
                           2
                        
                     , meaning that carry trade is mainly constructed with four currencies (NZD, AUD CHF and JPY), followed by three other currencies (SEK, DKK and NOK).

The problem with the previous benchmark strategy is that it holds a fixed portfolio for a quarter of a year. No actions are taken when the strategy produces losses. Therefore, we construct an HMM model for CT in order to take early actions. We expect HMM to signal when conditions are unfavorable to CT.

When fitting an HMM, we need to estimate a transition probability matrix P, an initial probability vector and parameters related to the distribution of the data. When the distribution is assumed to follow a normal distribution, the HMM can be calibrated with the Baum Welch Algorithm. For details and explanations about HMM fitting and Baum Welch algorithm see Fraser (2008) and Prajogo (2011).

It’s sensible to ask why to fit the HMM with a normal distribution when Table 1 is showing returns distribution is not fitted with such. As emerges below, the strategies proposed in this paper will not depend explicitly on the mean and volatility values of the normal distribution. Rather, they depend on the qualitative characteristic of the regime and the transition probabilities between regimes. The reason to use a normal distribution for the HMM construction is that we have a known algorithm to calibrate the HMM. The assumption for using normal distribution is supported by the discussion in (Mulvey & Zhao, 2011) (pg. 21), about how normal distribution can handle fat-tail distributions properly when applied to HMM on weekly data. Besides, the methodology calibrates HMM as new data become available, so it adapts to possible non-stationarity between mean and variance. Whitelaw (1994) points out the problem with the latter. He shows there is non-stationarity between mean and volatility for stock returns, in which case aggregate distribution can be non-normal, even if returns are normal for shorter periods. Finally, any proposed strategy will account for fat tails and downside risk in case returns are not normally distributed.

To fit the HMM, we define first the CT returns so to choose (K). The best performance was with 
                        
                           K
                           =
                           2
                           ,
                        
                      so we use this strategy. Next, we define the number of states to model the chain. A common criteria used is the Bayesian Information Criteria (BIC), which is a compromise between the likelihood and the number of parameters to be fitted. Another criterion is to look at P structure. For example, it is sensible to be barred from switching between completely opposite regimes when states are more than two. We expect the latter to happen by going through a transition regime. This method is used in (Prajogo, 2011) and Bae et al. (2014).

To train the HMM model, CT returns 
                        
                           (
                           K
                           =
                           2
                           )
                        
                      are computed daily to produce sufficient data. Note that (2) (and hence (3)) can be written as the sum of daily returns 
                        
                           r
                           
                              h
                           
                           
                              h
                              +
                              1
                           
                        
                     . If t and T represent two dates in time, then

                        
                           (4)
                           
                              
                                 
                                    r
                                    
                                       h
                                    
                                    
                                       h
                                       +
                                       1
                                    
                                 
                                 
                                    {
                                    
                                       
                                          
                                             
                                                log
                                                
                                                   
                                                      S
                                                      
                                                         h
                                                         +
                                                         1
                                                      
                                                      
                                                         a
                                                         s
                                                         k
                                                      
                                                   
                                                   
                                                      S
                                                      
                                                         h
                                                      
                                                      
                                                         a
                                                         s
                                                         k
                                                      
                                                   
                                                
                                                +
                                                
                                                   (
                                                   
                                                      i
                                                      c
                                                   
                                                   −
                                                   i
                                                   )
                                                
                                                h
                                             
                                          
                                          
                                             
                                                t
                                                ≤
                                                h
                                                <
                                                T
                                                −
                                                1
                                             
                                          
                                       
                                       
                                          
                                             
                                                log
                                                
                                                   
                                                      S
                                                      
                                                         T
                                                      
                                                      
                                                         b
                                                         u
                                                         y
                                                      
                                                   
                                                   
                                                      S
                                                      
                                                         T
                                                         −
                                                         1
                                                      
                                                      
                                                         a
                                                         s
                                                         k
                                                      
                                                   
                                                
                                                +
                                                
                                                   (
                                                   
                                                      i
                                                      c
                                                   
                                                   −
                                                   i
                                                   )
                                                
                                                h
                                             
                                          
                                          
                                             
                                                h
                                                =
                                                T
                                                −
                                                1
                                             
                                          
                                       
                                    
                                 
                              
                           
                        
                     
                  

Fitting results for the HMM model are shown in Figs. 2
                      and 3
                     . HMM is retrained at every quarter as new data develop. Overall results suggest choosing two regimes until the 2008 financial crisis and then three states.

BIC results are not decisive in determining the number of states, since they are similar in every period. What makes the difference are the values from the transition probabilities, means and volatilities. Before the 2008 crisis, we can clearly see the difference between two regimes. We refer to a “good” (“bad”) state for the state with highest (lowest) mean and lowest (highest) volatility. When using three regimes for periods prior to the 2008 crisis, the third regime looked like a “good” regime.

However, we can identify three different regimes after the 2008 crisis. We label “Transition” the state that moves between the other two in terms of performance. Something not shown in the figures is that for the three state HMM, transition probabilities from “good” to “bad” and vice versa are zero. This is why we call it such, since we need to go through it when going from first to last state and vice versa.

If we look at values of a particular regime in time, there are no major changes except after the 2008 financial crisis. For example, there is a volatility increase for the “bad” regime. In any case, such a change in parameters is expected after such an event. On average, CT strategies had experienced unprecedented losses, the causes of which had been widely discussed. Investors were looking for refuge in more traditional (safe haven) currencies, which in general are used for funding. Therefore, target currencies depreciated in relation to target currencies, leading to losses for CT investment strategies. For more details on safe haven currencies during the 2008 crisis, see McCauley and McGuire (2009), and Ranaldo and Söderlind (2010).

Notice deviations around the mean are considerable, even for the good regime. Therefore, we can still have negative returns for that state. Transition probabilities to the same regime are consistently high, supporting regime existence. When all data are used for calibration, steady state probabilities for the two-states model says that the “bad” regime is visited only 11 percent of the time. For the three-states model, “bad” and “transition” regimes are visited only 34 percent of the time. All these results align with previous benchmark CT results: CT’s are profitable on average, but cause huge losses when they are not.

Regime identification with HMM allows us to design decision rules to close/open CF positions. The rule should follow this idea: We open (close) positions when we have been most likely in the “good” (“bad”) regime during the last V consecutive days. Positions are opened according to the benchmark CT rule.

Strategies with smaller V’s react faster when HMM signals a regime change. That might prevent large drawdowns when CT does not work and so avoid losing profit when CT does work. The problem with smaller V’s is that rebalancing frequency increases, which can lead to higher transaction costs. Therefore the right choice of V is not straightforward, and strategies with different V’s should be compared.

To know what is the most likely current regime each day, the Viterbi algorithm is used. This algorithm looks for the most probable sequence of states given the returns observed. The last point of the path corresponds to the current regime. This algorithm is based on a dynamic programming approach and comes with most HMM fitting packages. To see how Viterbi works and is used in HMM, see Viterbi (1967), Fraser (2008) and Prajogo (2011).


                     Fig. 4
                      shows daily returns (basis points) and the respective current regime determined by Viterbi’s algorithm. Almost 70 percent of periods were considered to be in the“good” state and only 17 percent in the “bad” state. Knowing the most likely regime, we can create a signal to open or close positions. We close when the current regime has been the “bad” state for V consecutive years. We open position when the current regime has been the “good” state for V consecutive days. More precisely, a pseudo code for the HMM-based strategy is the following. Denote:


                     currd
                     : Regime found by Viterbi algorithm for current day d.


                     opend
                     :
                        
                           {
                           
                              
                                 
                                    1
                                 
                                 
                                    
                                       i
                                       f
                                       
                                       p
                                       o
                                       s
                                       i
                                       t
                                       i
                                       o
                                       n
                                       s
                                       
                                       a
                                       r
                                       e
                                       
                                       o
                                       p
                                       e
                                       n
                                       e
                                       d
                                       
                                       a
                                       t
                                       
                                       d
                                       a
                                       y
                                       
                                       d
                                    
                                 
                              
                              
                                 
                                    0
                                 
                                 
                                    ∼
                                 
                              
                           
                        
                     
                  


                     
                        
                           
                        
                     
                  

We assume there is a full day to open or close positions. To discern the best time to trade during that day is beyond the scope of this work. Table 2
                      depicts the amount of times positions are opened, as compared to the 62 times we have with quarterly allocations.


                     Table 3
                      shows the performance of these HMM (signal)-based strategies on the same period tested for benchmark carry trade strategies in Table 1. The best results in terms of MSV are obtained with V ∈ {5, 6, 7}, which, outperform all benchmark CT strategies. Improvement comes both from higher geometric mean returns and risk reduction (semi-volatility). Note this risk reduction is equivalent for any of the strategies, since they all have the same semi-volatility of 5.5 percent. Besides, skewness and kurtosis are lower than benchmark returns.


                     Fig. 5
                      depicts P&L of best benchmark strategy against the best three HMM-based strategies. Performance is better for these signal-based strategies at almost any starting period and time length chosen. To see this, Table 5 visualizes this finding by comparing the MSV between CT
                        
                           (
                           K
                           =
                           2
                           )
                        
                      and HMM 
                        
                           (
                           V
                           =
                           5
                           )
                        
                      for different time windows. For example, when the period January 2000 to June 2015 is divided into five equal length sub-periods, the HMM strategy outperforms the benchmark at every time period. When the same period is divided in 10 or 15 subperiods this happens 80 percent of times.

As a remark, Fig. 5 helps to see the effects of the Euro–Swiss peg in September 2011. Recalling Fig. 1, CHF is a main funding currency. Prior to this event, CT
                        
                           (
                           K
                           =
                           2
                           )
                        
                      had bad performance since CHFUSD increased considerable. However, the peg suppressed the currency and consequently benefited it. The rest of the strategies are on hold during these periods and are not affected by the peg. The peg was abolished unexpectedly in January 2015 and caused a significant increase in CHFUSD which harmed the CT
                        
                           (
                           K
                           =
                           2
                           )
                        
                      strategy. Again, the new strategies were not sensitive to this announcement.

Although the last results are promising, they still leave room for improvement. Even if previous strategies outperform the benchmark, Fig. 5 shows that at the end we have lost some of the advantage produced in the first eight years. Up to this point, we have applied a very simple allocation rule and we have not done anything in this direction. In this section we show how to improve performance by allocating with other rule when signal turns on.

To put this discussion into context, we are dealing with a currency future portfolio. If allocated at time t, the portfolio return at time T is given by 
                        
                           
                              x
                              ′
                           
                           
                              r
                              t
                              T
                           
                           ,
                        
                      where 
                        
                           r
                           t
                           T
                        
                      is the return vector given by (1) and x is the net allocation at each CF. This vector can be decomposed in long 
                        
                           x
                           +
                        
                      and short 
                        
                           x
                           −
                        
                      positions, since CT is a net zero strategy (
                        
                           
                              1
                              ′
                           
                           x
                           =
                           0
                        
                     ). Thus define feasible region P:

                        
                           
                              
                                 P
                                 =
                                 {
                                 
                                    (
                                    x
                                    ,
                                    
                                       x
                                       +
                                    
                                    ,
                                    
                                       x
                                       −
                                    
                                    )
                                 
                                 :
                                 
                                    1
                                    ′
                                 
                                 
                                    x
                                    +
                                 
                                 =
                                 1
                                 ,
                                 
                                    1
                                    ′
                                 
                                 
                                    x
                                    −
                                 
                                 =
                                 1
                                 ,
                                 
                                    x
                                    +
                                 
                                 ≥
                                 0
                                 ,
                                 
                                    x
                                    −
                                 
                                 ≥
                                 0
                                 ,
                                 x
                                 =
                                 
                                    x
                                    +
                                 
                                 −
                                 
                                    x
                                    −
                                 
                                 }
                              
                           
                        
                     
                  

The idea is to improve the MSV of the strategy. So if positions are opened at time t, we allocate according to the following problem

                        
                           (5)
                           
                              
                                 
                                    max
                                    
                                       x
                                       ∈
                                       P
                                    
                                 
                                 
                                 E
                                 
                                    {
                                    log
                                    
                                       (
                                       1
                                       +
                                       
                                          x
                                          ′
                                       
                                       
                                          r
                                          t
                                          T
                                       
                                       )
                                    
                                    }
                                 
                              
                           
                        
                     
                     
                        
                           (6)
                           
                              
                                 
                                    
                                       
                                          s
                                          .
                                          t
                                          
                                       
                                    
                                    
                                       
                                          E
                                          {
                                          min
                                          
                                             
                                                {
                                                
                                                   x
                                                   ′
                                                
                                                
                                                   r
                                                   t
                                                   T
                                                
                                                −
                                                E
                                                
                                                   (
                                                   
                                                      x
                                                      ′
                                                   
                                                   
                                                      r
                                                      t
                                                      T
                                                   
                                                   )
                                                
                                                ,
                                                0
                                                }
                                             
                                             2
                                          
                                          }
                                          ≤
                                          θ
                                       
                                    
                                 
                              
                           
                        
                     
                  

That is, (5) maximizes the geometric mean return and (6) keeps semi-variance below threshold θ. Note vector ST
                      is random in two ways: Its value is uncertain at T and T is also uncertain itself, since we do not know when we close positions.

We prefer not to use the classical mean-variance allocation because exchange returns on good regime, given by 
                        
                           l
                           o
                           g
                           (
                           
                              
                                 S
                                 
                                    t
                                    +
                                    1
                                 
                              
                              
                                 S
                                 t
                              
                           
                           )
                        
                      , are empirically abnormal. (Table 6 holds more information.) Hence, not all risk is captured by volatility. As a remark, Table 7 in the appendix shows how highly correlated exchange returns correlate during a good state. The only one showing low correlation with all others is the JPY.

Denoting △it
                      as the vector of interest rates, differences between each currency and USD at time t, the problem can be written as

                        
                           
                              
                                 
                                    max
                                    
                                       x
                                       ∈
                                       P
                                    
                                 
                                 E
                                 
                                    {
                                    log
                                    
                                       [
                                       1
                                       +
                                       
                                          x
                                          ′
                                       
                                       
                                          (
                                          
                                             (
                                             T
                                             −
                                             t
                                             )
                                          
                                          ▵
                                          
                                             i
                                             t
                                          
                                          +
                                          log
                                          
                                             
                                                S
                                                T
                                             
                                             
                                                S
                                                t
                                             
                                          
                                          )
                                       
                                       ]
                                    
                                    }
                                 
                              
                           
                        
                     
                     
                        
                           
                              
                                 
                                    
                                       
                                          s
                                          .
                                          t
                                          
                                       
                                    
                                    
                                       
                                          E
                                          {
                                          min
                                          
                                             
                                                {
                                                
                                                   x
                                                   ′
                                                
                                                
                                                   (
                                                   
                                                      (
                                                      T
                                                      −
                                                      E
                                                      
                                                         (
                                                         T
                                                         )
                                                      
                                                      )
                                                   
                                                   ▵
                                                   
                                                      i
                                                      t
                                                   
                                                   +
                                                   log
                                                   
                                                      S
                                                      T
                                                   
                                                   −
                                                   E
                                                   
                                                      (
                                                      log
                                                      
                                                         S
                                                         T
                                                      
                                                      )
                                                   
                                                   )
                                                
                                                ,
                                                0
                                                }
                                             
                                             2
                                          
                                          }
                                          ≤
                                          θ
                                       
                                    
                                 
                              
                           
                        
                     
                  

To solve the previous optimization problem, we use the sample-average approximation. That is, we sample different values for time T and ST
                         to compute expected values as average. Specifically, denote Tn
                         and 
                           
                              S
                              T
                              n
                           
                         the values of T and ST
                         in scenario n, we solve:

                           
                              
                                 
                                    
                                       max
                                       
                                          x
                                          ∈
                                          P
                                       
                                    
                                    
                                    
                                       ∑
                                       
                                          n
                                          =
                                          1
                                       
                                       N
                                    
                                    
                                       {
                                       log
                                       
                                          [
                                          1
                                          +
                                          
                                             x
                                             ′
                                          
                                          
                                             (
                                             
                                                (
                                                
                                                   T
                                                   n
                                                
                                                −
                                                t
                                                )
                                             
                                             ▵
                                             
                                                i
                                                t
                                             
                                             +
                                             log
                                             
                                                
                                                   S
                                                   T
                                                   n
                                                
                                                
                                                   S
                                                   t
                                                
                                             
                                             )
                                          
                                          ]
                                       
                                       }
                                    
                                 
                              
                           
                        
                        
                           
                              
                                 
                                    s
                                    .
                                    t
                                    
                                    
                                    
                                    
                                    
                                       1
                                       N
                                    
                                    
                                       ∑
                                       
                                          n
                                          =
                                          1
                                       
                                       N
                                    
                                    
                                       y
                                       n
                                       2
                                    
                                    ≤
                                    θ
                                 
                              
                           
                        
                        
                           
                              
                                 
                                    
                                       y
                                       n
                                    
                                    ≤
                                    
                                       x
                                       ′
                                    
                                    
                                       (
                                       
                                          (
                                          
                                             T
                                             n
                                          
                                          −
                                          E
                                          
                                             (
                                             T
                                             )
                                          
                                          )
                                       
                                       ▵
                                       
                                          i
                                          t
                                       
                                       +
                                       log
                                       
                                          S
                                          T
                                          n
                                       
                                       −
                                       
                                          ∑
                                          
                                             n
                                             =
                                             1
                                          
                                          N
                                       
                                       log
                                       
                                          S
                                          T
                                          n
                                       
                                       )
                                    
                                    
                                    
                                    
                                    ∀
                                    n
                                 
                              
                           
                        
                        
                           
                              
                                 
                                    
                                       y
                                       n
                                    
                                    ≤
                                    0
                                    
                                    
                                    ∀
                                    n
                                 
                              
                           
                        
                     

To construct scenarios, we assume that each currency moves as a geometric Brownian motion with no drift. That is

                           
                              
                                 
                                    
                                       S
                                       
                                          h
                                          +
                                          1
                                       
                                       c
                                    
                                    =
                                    
                                       S
                                       h
                                       c
                                    
                                    exp
                                    
                                       {
                                       −
                                       0.5
                                       
                                          σ
                                          c
                                          2
                                       
                                       +
                                       
                                          σ
                                          c
                                       
                                       
                                          B
                                          h
                                          1
                                       
                                       }
                                    
                                    
                                    
                                    ∀
                                    c
                                    ,
                                    
                                    
                                    h
                                    :
                                    t
                                    .
                                    .
                                    T
                                 
                              
                           
                        where σc
                         is the volatility and 
                           
                              B
                              h
                              1
                           
                         is a Brownian motion with unit variance. Note that the Brownian motion is common for every currency, so currency rates are correlated. To estimate σc
                        , we use historical currency data under the good regime. Table 6 in the appendix shows estimation values.

To deal with the uncertainty T, note that T is a hitting time of a discrete Markov chain, which is derived from the HMM. T corresponds to the time when we have a non-favorable state (not the last state) for V consecutive days. For the 2 states HMM, denote Xt
                         as the number of consecutive days outside the good regime at day s ≥ t. Xt
                         ∈ {0..V}. The transition matrix structure for this Markov chain is:

                           
                              
                                 
                                    [
                                    
                                       
                                          
                                             
                                                p
                                                
                                                   G
                                                   G
                                                
                                             
                                          
                                          
                                             
                                                p
                                                
                                                   G
                                                   B
                                                
                                             
                                          
                                          
                                             0
                                          
                                          
                                             ⋯
                                          
                                          
                                             0
                                          
                                       
                                       
                                          
                                             
                                                p
                                                
                                                   B
                                                   G
                                                
                                             
                                          
                                          
                                             0
                                          
                                          
                                             
                                                p
                                                
                                                   B
                                                   B
                                                
                                             
                                          
                                          
                                             ⋯
                                          
                                          
                                             0
                                          
                                       
                                       
                                          
                                             ⋮
                                          
                                          
                                             ⋮
                                          
                                          
                                             ⋮
                                          
                                          
                                             ⋱
                                          
                                          
                                             ⋮
                                          
                                       
                                       
                                          
                                             
                                                p
                                                
                                                   B
                                                   G
                                                
                                             
                                          
                                          
                                             0
                                          
                                          
                                          
                                             ⋯
                                          
                                          
                                             
                                                p
                                                
                                                   B
                                                   B
                                                
                                             
                                          
                                       
                                       
                                          
                                             0
                                          
                                          
                                             0
                                          
                                          
                                             0
                                          
                                          
                                             ⋯
                                          
                                          
                                             1
                                          
                                       
                                    
                                    ]
                                 
                              
                           
                        
                     


                        pGG, pBG, pGB, pBB
                         are the HMM transition probabilities, where “G” refers to good state and “B” to bad state. T is the hitting time of state V beginning at state 0. For the three HMM states, the Markov chain is a little more complicated, since we need to know if we enter a bad or transition regime once we leave the good regime. But following the same idea, we can get the transition probability for that case.

To get 
                           
                              
                                 S
                                 T
                                 n
                              
                              ,
                           
                         we first obtain the hitting time T and then we choose the vector ST
                         from the currencies path simulated. Table 8 (appendix) shows that average hitting time is around a quarter of a year.

@&#RESULTS@&#


                        Table 4
                         and Fig. 6
                         show performance results for this mean-semivariance allocation methodology, applied to the best HMM-based strategy so far 
                           
                              (
                              V
                              =
                              5
                              )
                           
                        . There is consistent improvement with respect to the same strategy based purely in interest rates differential 
                           
                              (
                              K
                              =
                              2
                              )
                           
                         seen in Table 3. That is, the MSV of all strategies are above the 56 percent obtained with previous allocation rule. This improvement is also seen when using other values for V, as Tables 9 and 10 in the appendix show.

Another benefit from this allocation methodology is that it opens more options for investors. By changing θ, each user can choose their preferred risk-return relation. Fig. 7
                         shows the composition of this allocation method. Main targets and funding currency are the same as with benchmark strategies (see Fig. 1). However, especially for more conservative strategies, allocation tends to be more equally weighted. Not displayed, but important to mention, is that all currencies were used at every period at every strategy shown. Hence, there is more diversification.

@&#CONCLUSION@&#

In this paper, we have shown how to construct a CF portfolio that outperforms standard CT strategies. To this end, we implemented a two-step procedure. The first step consisted in constructing a HMM model for some benchmark CT that could classify its returns in different regimes. Fitting results showed that the two-regime model was the most suitable before the 2008 crisis and a three states one on afterwards. Basically, the first regime generated low return/high volatility returns, and the latter one the opposite. With this calibration, we were able to create strategies based on HMM. This is, we open (close) positions when we remain for V consecutive days in the good (bad) regime. Results showed a clear improvement in performance in relation to standard carry trade benchmark strategies, especially for V ∈ {5, 6, 7}.

In the second step we improved allocation methodology when positions are opened. To do this, we use a portfolio optimization model that aims for the best compromise between geometric mean return and semi-variance. Backtest results showed that by adjusting risk tolerance (θ), we achieve better and different risk-return results.

Summing up, in terms of performance, our final strategy can increase MSV by 160 percent approx. (from 27.3 percent to 70 percent). Around two thirds of that increase comes just from applying the HMM signal, while the rest come from refining allocations with mean-semivariance approach.

Although we we have achieved good results, more could be tested in order to improve the regime identification. We have not included economic fundamentals to the methodology. It is probable there are economic variables that could be added as observable data (input) to the HMM and improve fitting results, or use this information as a complement to the HMM used in this case, for example, to determine regime changes. Another possibility is to try a different distribution of the data in each regime or use a non-parametric technique.

Regarding data used, a possible extension is to increase the number of currencies in the portfolio. It will be interesting to include currencies from emerging countries and see how much benefit and new opportunities this brings. The main problem of including more countries comes with data availability, as HMM fitting requires a large amount of data. Additional improvement could be obtained by changing something different when the signal is off. Some strategies still had frequent flat periods that could be exploited. The most intuitive attempt is to reverse CT, i.e., to go long on low interest rates currencies and short on high interest rates currencies. Another possibility is to see what happens when different leverage is used.

​
                     
                     
                     
                     
                     
                  

@&#REFERENCES@&#

