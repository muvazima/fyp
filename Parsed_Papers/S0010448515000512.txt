@&#MAIN-TITLE@&#Topology authentication for piping isometric drawings

@&#HIGHLIGHTS@&#


               
               
                  
                     
                        
                           
                           The topology authentication problem of piping isometric drawings is addressed.


                        
                        
                           
                           A semi-fragile watermarking scheme for the topology authentication is proposed.


                        
                        
                           
                           The proposed scheme is robust against local similarity transformations.


                        
                        
                           
                           The proposed scheme is invariant to the stretching operation on pipes.


                        
                        
                           
                           The proposed scheme provides good tamper localization accuracy.


                        
                     
                  
               
            

@&#KEYPHRASES@&#

Topology authentication

Topology integrity

Local similarity transformations

Product and manufacturing information (PMI)

Watermarking

Piping isometric drawing

@&#ABSTRACT@&#


               
               
                  Piping isometric drawings, which feature their intrinsical topological relation rather than just geometrical shape, are important industrial art works in the field of Computer-Aided Design (CAD). This paper takes a fresh look at the topology integrity authentication of piping isometric drawings, which has not been mentioned before in the literature, from the digital watermarking perspective. A blind and semi-fragile watermarking based algorithm is proposed to address the referred interesting issue. The topology authentication problem of piping isometric drawings is investigated. In addition to the stretching operation, both global and local similarity transformation operations, which are critical problems in the case of watermarking embedding and extraction, are analyzed in detail. The topological graph is extracted and constructed from the drawing firstly. Then, similarity transformation invariants are constructed as watermarks carriers for each node. After that, the topological relation among joint components is encoded into singular watermarks for each node of the graph. These generated topology sensitive watermarks are embedded into geometrical invariants of each node via quantization index modulation. Theoretical analysis and experimental results demonstrate that our approach yields a strong ability in detecting and locating unauthorized topology attacks while achieves robustness against both global and local similarity transformations especially the stretching operation. The proposed scheme can be employed to authenticate topology integrity for each of the drawings derived from the model individually in industry practices.
               
            

@&#INTRODUCTION@&#

Piping isometric drawings, as one kind of 2D CAD drawings, are detailed orthographic drawings for plants in the petrochemical industry. Petrochemical plants usually consist of a large number of pipelines which are comprised of various components. Piping isometric drawings represent the details of 3D structure of these pipelines in the form of 2D diagrams. It is the general practice among engineering organizations to produce isometric drawings of piping systems to represent all the details in the plant design. Generally speaking, hundreds and perhaps tens of thousands of such drawings should be created for a design project. Because of their wide applications in the petrochemical industry, piping isometric drawings are of great commercial and intellectual value. However, the popularity of piping isometric drawings also raises a big concern. They can be easily edited, replicated and distributed through networks or through stored media during the design as well as the project installation and construction. What is important is that, a range of engineering reports are generated based on geometrical and topological information of the drawing. Therefore, in order to properly protect the content integrity of piping isometric drawings, it is desirable to develop an authentication mechanism that can prevent digital contents from being maliciously tampered.

Piping isometric drawings consist of various components which cover three kinds of information including geometrical information, topological information and engineering information as shown in Fig. 1
                     . Geometrical information primarily describes the entities which the drawing is composed of. Topological information provides topological relation between joint components. Engineering information refers to flow direction, design constraints, specifications, etc. Components in isometric drawings share engineering information with corresponding 3D models. Reference data held in 3D plant models can be transferred to their isometric drawings, ensuring consistency of design and control of the materials and piping specifications used by engineers on projects.

Topological information, in addition to geometrical information and engineering information, should be the focus of the integrity authentication for piping isometric drawings. Unlike the traditional mechanical CAD industry, which primarily concentrates on geometric modeling, plant design mainly focuses on optimizing the plant layout  [1,2]. The objective of plant layout design is to identify the most economical spatial arrangement of process vessels and equipment and their interconnecting pipes that satisfy construction, operation, maintenance, and safety requirements. Piping isometric drawings are derived directly from 3D plant models with emphasis on the relative topological relation among various joint components. These topological information are then employed to generate a variety of reports, including bills of materials, welding and cut pipe length lists automatically. However, to the best of our knowledge, no major work concerning the problem of topology integrity authentication has been studied yet.

The problem of digital content integrity authentication and tamper detection has become problematic in many areas. Fragile and semi-fragile digital watermark techniques provide possible and effective solutions for this problem and have been studied and used widely for images  [3], audio  [4], videos  [5,6], 3D meshes  [7,8], CAD drawings  [9–11] and so on. They authenticate and verify digital content through embedding secret information (also called watermarks) into the cover content. Moreover, semi-fragile watermarking techniques can survive in some possibly unintentional operations the digital content may undergo. However, none has referred the topology integrity authentication problem discussed above, though a few methods have been proposed for the geometrical information authentication for mechanical CAD drawings  [9–14].

To tackle this interesting problem, we therefore present a blind and semi-fragile watermarking scheme for the topology integrity authentication and verification of piping isometric drawings. The main contributions of our work can be classified as the following: 
                        
                           (1)
                           The first contribution is that a blind and semi-fragile watermarking technique is introduced to tackle the topology integrity authentication problem of piping isometric drawings. It is believed that the proposed scheme provides a practical and effective solution for resolving the topology integrity authentication problem.

The second contribution is the construction of a topological graph from the piping isometric drawing in which each piping component corresponds to a node and each pipe corresponds to two directed edges. The topological graph is then employed to generate watermarks, which are sensitive to topology modifications, for watermark embedding and tamper localization.

The third contribution is the similarity transformation invariants construction and selection for each node. These geometrical invariants which are preserved under any similarity transformation are then employed as watermark carriers.

The fourth contribution is that the proposed scheme is robust against the stretching operation, as well as both global and local similarity transformations including uniform scaling, rotation and translation. This problem is aggravated by the fact that, to make isometric drawings cleaner and more legible, it is common to revise dimensions and locations of certain individual components manually without altering their topological relation.

The remainder of the paper is organized as follows. We first investigate the proposed problem in detail in Section  2. Then, we review some related works in Section  3. After briefly summarizing the watermarking scheme in Section  4, we describe the topological graph construction method in Section  5. The proposed topology integrity authentication scheme based on the digital watermarking is detailed in Section  7. Section  8 then demonstrates and discusses the experimental results. The paper finishes with contributions and suggestions for future research in Section  9.

In this section, we first describe the geometric structure of piping isometric drawings. Then, we discuss the topology integrity authentication problem of piping isometric drawings.

The geometric structure of piping isometric drawings is described from the following two aspects: the entity-level and the object-level.

In aspect of entity-level, piping isometric drawings, as well as other kind of CAD drawings, are designed by using basic graphical entities, such as LINE, POLYLINE, POLYGON and ARC, as shown in Fig. 2
                        (a).

In aspect of object-level, a piping isometric drawing generally includes an individual pipeline or a set of multiple interconnected pipelines. The pipeline consists of various components, including pipes and piping components. Piping components cover fittings, valves, flanges, gasket, etc. Two joint pipes should be connected with each other through various piping components while two joint piping components can be connected with each other directly or through a pipe. All components are represented by basic graphical entities introduced above.

Nowadays, hundreds of thousands of built-in graphical symbols of components are included in intelligent isometric drawing tools for the project requirements. These intelligent tools are object-based modeling and edition applications. They always include hundreds of catalogs representing either dimensional standards or manufacturer specific components. It is worthwhile to point out that there may be some slight differences among graphical symbols of the same component in different piping isometric drawing applications. This is because that the piping design should follow relevant specifications, as issued by the national standards institutes of different countries.

Entities and objects in CAD drawings hold an intrinsic attribute, named handle value, which is assigned and maintained by application systems automatically. The handle value is an abstract reference to the entity or object  [9]. It is kept unique for the life of the database. This intrinsic invariance property is fully utilized in our scheme.


                        Fig. 2(b) shows some graphical symbols of piping isometric drawings. Note that, a pipe may have different symbols with respect to the spatial relationship between it and the rectangular axes. For example, a pipe is described by a simple line when it is parallel to a single coordinate axis. Otherwise, it is represented by its projection and the projection plane on the corresponding coordinate plane as illustrated in Fig. 2(b). Fig. 3
                         shows an example of a pipeline of a 3D plant model and its piping isometric drawing.

Topological information, compared with geometrical information and engineering information, is playing an increasingly important role in the modern intelligent piping isometric drawing applications. The two joint components should meet the specific requirements, such as pipe diameter, end type, pressure rating and flow direction. Moreover, a variety of reports, such as bills of materials, welding and cut pipe length lists are generated through the topological information automatically. This is significantly different from traditional mechanical CAD drawings which primarily focus on the geometric modeling.

To give an isometric a satisfactory appearance and fit, it is common to apply similarity transformations on certain individual components to revise their dimensions or locations without altering their topological relation manually. These operations include rotation, translation and uniform scaling. Piping isometric drawings are generated from 3D piping models directly by applying orthographic projection to components with different ratios. Components with large dimensions should be scaled down, since these components occupy large space on the drawings which inevitably influence the projection of other ones. In the same way, those ones with small dimensions should be scaled up to avoid any inconvenience when reading the drawings. The regions with dense pipelines should be expanded and those regions with sparse pipelines should be compressed. More importantly, translation and scaling operations on piping components discussed above will inevitably result in stretching of pipes with different factors 
                           f
                           
                           
                              (
                              f
                              >
                              0
                              )
                           
                        . Performing these changes will create a cleaner and more legible isometric drawing and further facilitate the annotation for various components.

Therefore, the problem of topology integrity authentication should draw more and more attention for piping isometric drawings. However, for 2D CAD drawings, previous studies have primarily focused on protecting and authenticating geometrical information  [9,10,12,13]. Little attention has been devoted to the referred problem. Moreover, the prospective authentication scheme is required to survive to those topology-preserving operations discussed above. These modifications do not destroy the topological relation among joint components. Thus, the modified isometric drawing should be regarded as the same as the original one. In addition, the scheme should also yield a strong ability in detecting and locating unauthorized topology attacks on each component.

@&#RELATED WORKS@&#

In this section, we review some related studies which provided the inspiration for our work. To the best of our knowledge, in the literature, no technique has been proposed for watermarking piping isometric drawings for topology integrity authentication and verification. The focus of current studies is geometrical information protection and authentication in the field of watermarking CAD drawings.

These works focus on protecting or authenticating geometrical information through exploiting the topological information. Rahman et al. utilized the redundancy of topological information as well as the layered structure of 3D meshes to embed watermarks by changing only the local numbering of the triangular patch of the model[15,16]. A blind watermarking scheme based on spatial topology domain for 2D vector map is proposed by Wang et al. Watermarks are embedded in spatial topological relation by exploiting the geometric invariance property of topological relation between map objects  [17]. Beddiaf et al. presented a robust and blind watermarking scheme for 3D meshes based on wavelet decomposition  [18]. They proposed a new topological synchronization mechanism, which is based on triangles traversal of a semi-regular mesh, for watermarks embedding and extraction procedures. Huber et al. proposed a watermarking method for planar straight-line graphs  [19]. They embedded watermarks by dislocating vertices while still preserving the topology of the input data.

For 3D CAD drawings, Ohbuchi et al. first proposed that the 3D geometric CAD model can also be viewed as a multimedia data object in  [20]. They presented multiple approaches to watermark mechanical CAD models defined by using parametric curves and surfaces  [20,21]. Lee et al. proposed two watermarking algorithms for 3D nonuniform rational B-spline (NURBS) graphic data  [22]. They embedded data into 2D virtual images extracted by parameter sampling of the 3D model. Kwon et al. proposed two algorithms for 3D CAD drawings  [23,24]. They selected LINE, FACE, and ARC components as watermark carriers. Lee et al. presented a robust watermarking algorithm based on k-means++ clustering  [14]. The proposed scheme embedded the watermark into the geometric distribution of POLYLINE, 3DFACE, and ARC objects in main layers.

For 2D CAD drawings, a watermarking scheme for a 2D architectural design drawing using LINEs and ARCs based on vertex was presented in  [12]. It embeds the watermark into the LINE’s length and ARC’s angle information. Kwon et al.  [13] proposed a digital watermarking for 2D CAD drawings. The watermark is embedded by using a self-adaptive algorithm related to the length of LINEs, angles of ARCs, and radii of CIRCLEs. A semi-fragile watermarking algorithm for authenticating 2D CAD engineering graphics based on log-polar transformation was proposed in  [9]. The watermark is embedded in the mantissa of the real-valued log-polar coordinates via bit substitution. Peng et al. also proposed a reversible watermarking scheme for 2D CAD engineering graphics based on improved difference expansion  [10]. The watermark is embedded into the scale factor of the relative coordinates by using improved difference expansion technology.

All in all, currently, the above mentioned schemes for CAD drawings typically target the geometrical information protection and authentication. Furthermore, they are primarily designed to resist global similarity transformation attacks, such as rotation, translation and uniform scaling, which applied to the whole drawings.

Recently, we have investigated the topology integrity problem of 3D plant models and relevant techniques have been proposed in  [25–27]. The topological structure of 3D plant models is described through connection points, which are selected as candidates for watermarks embedding. The topological relation among joint components is encoded into watermarks to authenticate and verify the topology of 3D plant models. However, these techniques are specifically designed for 3D plant models. Piping isometric drawings are designed and produced for individual pipeline or several pipelines of 3D plant models in the form of 2D diagrams. They are different from each other in both topological structure and geometric structure. Moreover, the proposed techniques do not take into account local similarity transformations applied to individual components and stretching operation on pipes. These operations play a vital role in the design of 2D piping isometric drawings.

In comparison, the focus of our work is on developing a blind and semi-fragile watermarking scheme to authenticate the topology integrity of piping isometric drawings in such a way that the scheme is not only robust to stretching operation on pipes, as well as both global and local similarity transformations on components, but also sensitive to malicious topological attacks.

The flowcharts of the proposed watermark embedding and extraction procedures are shown in Fig. 4
                     .

In the watermark embedding stage, we first extract and construct the topological graph for the piping isometric drawing according to the topological relationship among joint components. There is a one-to-one relationship between the node of the graph and the piping component of the drawing. Then, for each piping component, two similarity transformation invariants, namely 
                        
                           
                              r
                           
                           
                              1
                           
                        
                      and 
                        
                           
                              r
                           
                           
                              2
                           
                        
                     , are constructed based on its geometrical shape. After that, two kinds of topology-based watermarks are generated for each node. Those geometric invariants are then preferred as watermark carriers and the generated watermarks are embedded into them respectively under the control of private keys 
                        Δ
                     , 
                        k
                     , a logistic function 
                        l
                        
                           (
                           x
                           )
                        
                      and a hash function 
                        h
                        
                           (
                           x
                           )
                        
                     .

In the watermark extraction stage, the topological graph of the piping isometric drawing is first extracted. Then, two similarity transformation invariants, namely 
                        
                           
                              r
                           
                           
                              1
                           
                           
                              ′
                           
                        
                      and 
                        
                           
                              r
                           
                           
                              2
                           
                           
                              ′
                           
                        
                     , of each piping component are constructed. After that, embedded watermarks are extracted from the two invariants respectively. The tamper detection and localization procedure are carried out by checking the topology integrity according to the two extracted watermarks of each node.

We discuss how to construct the topological graph in this section. The constructed topological graph is then utilized to generate topology-based watermarks for topology integrity authentication and verification.

Topological graph deals with ways to represent the topological relation among joint components. Let 
                        G
                        =
                        
                           〈
                           V
                           ,
                           E
                           〉
                        
                      be a topological graph. The node set of the graph 
                        G
                      is referred to as 
                        V
                        
                           (
                           G
                           )
                        
                     , its edge set as 
                        E
                        
                           (
                           G
                           )
                        
                     . An edge 
                        e
                        =
                        
                           (
                           
                              
                                 v
                              
                              
                                 i
                              
                           
                           ,
                           
                              
                                 v
                              
                              
                                 t
                              
                           
                           )
                        
                      is considered to be directed from 
                        
                           
                              v
                           
                           
                              i
                           
                        
                      to 
                        
                           
                              v
                           
                           
                              t
                           
                        
                     . 
                        
                           
                              v
                           
                           
                              i
                           
                        
                      is called an initial node and 
                        
                           
                              v
                           
                           
                              t
                           
                        
                      is called a terminal node. For a node 
                        v
                     , the number of initial nodes adjacent to 
                        v
                      is called the indegree of 
                        v
                      and the number of terminal nodes adjacent to 
                        v
                      is its outdegree. The indegree is denoted as 
                        
                           
                              
                                 deg
                              
                           
                           
                              −
                           
                        
                        
                           (
                           v
                           )
                        
                      and the outdegree as 
                        
                           
                              
                                 deg
                              
                           
                           
                              +
                           
                        
                        
                           (
                           v
                           )
                        
                     . A node 
                        v
                      is isolated if 
                        
                           
                              
                                 deg
                              
                           
                           
                              −
                           
                        
                        
                           (
                           v
                           )
                        
                        =
                        
                           
                              
                                 deg
                              
                           
                           
                              +
                           
                        
                        
                           (
                           v
                           )
                        
                        =
                        0
                     .

For the sake of resisting both global and local similarity transformations on components especially stretching operation on pipes, nodes in 
                        V
                        
                           (
                           G
                           )
                        
                      are designed to refer to piping components, while edges in 
                        E
                        
                           (
                           G
                           )
                        
                      represent the topological relation between joint piping components. It should be pointed out that dotted lines in piping isometric drawings indicate that the associated piping components are connected with those ones in other such drawings of the same 3D model. Thus, a node will be added to represent a null joint piping component for the pipe which has just only one joint piping component. The edge can also be regarded as a pipe if the two corresponding piping components are connected through a pipe. By doing so, the defined topological graph can then stay the same under those operations especially the stretching operation on pipes discussed in Section  2.2. Nodes in the topological graph and their corresponding piping components have the same attributes, such as handle values, which are then employed to generate watermarks. The handle value of null piping component is defined to be 0. The degree 
                        
                           
                              
                                 deg
                              
                           
                           
                              −
                           
                        
                        
                           (
                           v
                           )
                        
                      and 
                        
                           
                              
                                 deg
                              
                           
                           
                              +
                           
                        
                        
                           (
                           v
                           )
                        
                      is equal to the total number of joint components of the corresponding component which the node 
                        v
                      corresponds to. Isolated components in the original drawing are not taken into consideration in this paper because they are valueless in the practical plant design.


                     Fig. 5
                      shows an example of the topological graph of a given piping isometric drawing with 10 piping components labeled with red circles. In Fig. 5(a), the piping component 
                        
                           
                              v
                           
                           
                              9
                           
                        
                      is connected directly with 
                        
                           
                              v
                           
                           
                              8
                           
                        
                      and 
                        
                           
                              v
                           
                           
                              10
                           
                        
                      respectively. This kind of interconnection is denoted by black edges in the constructed topological graph as shown in Fig. 5(b). The rest of joint piping components are connected with each other through pipes. Their interconnections are represented by blue edges in Fig. 5(b). The black nodes represent null joint piping components of pipes.

In this section, the similarity transformation invariants defined in coplanar quadrilaterals are first introduced. Then, the construction procedures of coplanar quadrilaterals for piping components are detailed. Finally, the selection of similarity transformation invariants is described.

The convex coplanar quadrilateral referred in this paper is a simple polygon whose every internal angle is strictly less than 180 degrees. Provided that 
                           
                              
                                 v
                              
                              
                                 1
                              
                           
                        , 
                           
                              
                                 v
                              
                              
                                 2
                              
                           
                        , 
                           
                              
                                 v
                              
                              
                                 3
                              
                           
                         and 
                           
                              
                                 v
                              
                              
                                 4
                              
                           
                         are four coplanar vertices which define a convex polygon in a two-dimensional space, where any three points are not collinear. Let 
                           
                              
                                 v
                              
                              
                                 1
                              
                           
                           
                              
                                 v
                              
                              
                                 3
                              
                           
                         and 
                           
                              
                                 v
                              
                              
                                 2
                              
                           
                           
                              
                                 v
                              
                              
                                 4
                              
                           
                         be two lines that intersect at an intermediate vertex 
                           o
                        . The set of coplanar vertices 
                           V
                           ≡
                           
                              {
                              
                                 
                                    v
                                 
                                 
                                    1
                                 
                              
                              ,
                              
                                 
                                    v
                                 
                                 
                                    2
                                 
                              
                              ,
                              
                                 
                                    v
                                 
                                 
                                    3
                                 
                              
                              ,
                              
                                 
                                    v
                                 
                                 
                                    4
                                 
                              
                              }
                           
                         defines two independent ratios of three collinear vertices. Let 
                           
                              
                                 r
                              
                              
                                 1
                              
                           
                         and 
                           
                              
                                 r
                              
                              
                                 2
                              
                           
                         be two ratios, where 
                           
                              (1)
                              
                                 
                                    {
                                    
                                       
                                          
                                             
                                                
                                                   r
                                                
                                                
                                                   1
                                                
                                             
                                             =
                                             
                                                
                                                   
                                                      ‖
                                                      
                                                         
                                                            v
                                                         
                                                         
                                                            1
                                                         
                                                      
                                                      −
                                                      o
                                                      ‖
                                                   
                                                
                                                
                                                   
                                                      ‖
                                                      
                                                         
                                                            v
                                                         
                                                         
                                                            1
                                                         
                                                      
                                                      −
                                                      
                                                         
                                                            v
                                                         
                                                         
                                                            3
                                                         
                                                      
                                                      ‖
                                                   
                                                
                                             
                                          
                                       
                                       
                                          
                                             
                                                
                                                   r
                                                
                                                
                                                   2
                                                
                                             
                                             =
                                             
                                                
                                                   
                                                      ‖
                                                      
                                                         
                                                            v
                                                         
                                                         
                                                            2
                                                         
                                                      
                                                      −
                                                      o
                                                      ‖
                                                   
                                                
                                                
                                                   
                                                      ‖
                                                      
                                                         
                                                            v
                                                         
                                                         
                                                            2
                                                         
                                                      
                                                      −
                                                      
                                                         
                                                            v
                                                         
                                                         
                                                            4
                                                         
                                                      
                                                      ‖
                                                   
                                                
                                             
                                             .
                                          
                                       
                                    
                                 
                              
                           
                         The two ratios are invariant under similarity transformations, and uniquely define four vertices up to affine transformations  [28,29]. These similarity transformation invariants are very favorable for watermarking since watermarks can be embedded into these invariants which are preserved under any similarity transformation.

For the graphical symbol of each piping component, details of the convex coplanar quadrilaterals construction method are described as follows. 
                           
                              (1)
                              Extract all the vertices of the graphical symbol to look for convex coplanar quadrilaterals sets. If none, go to Step (3).

For each convex quadrilateral 
                                    
                                       
                                          Q
                                       
                                       
                                          i
                                       
                                    
                                    
                                       {
                                       
                                          
                                             v
                                          
                                          
                                             i
                                             1
                                          
                                       
                                       ,
                                       
                                          
                                             v
                                          
                                          
                                             i
                                             2
                                          
                                       
                                       ,
                                       
                                          
                                             v
                                          
                                          
                                             i
                                             3
                                          
                                       
                                       ,
                                       
                                          
                                             v
                                          
                                          
                                             i
                                             4
                                          
                                       
                                       }
                                    
                                 , compute its quadrilateral identifier (ID) by: 
                                    
                                       (2)
                                       
                                          
                                             
                                                
                                                   ID
                                                
                                             
                                             
                                                i
                                             
                                          
                                          =
                                          
                                             Cat
                                          
                                          
                                             (
                                             
                                                
                                                   H
                                                
                                                
                                                   
                                                      
                                                         v
                                                      
                                                      
                                                         i
                                                         1
                                                      
                                                   
                                                
                                             
                                             ,
                                             
                                                
                                                   H
                                                
                                                
                                                   
                                                      
                                                         v
                                                      
                                                      
                                                         i
                                                         2
                                                      
                                                   
                                                
                                             
                                             ,
                                             
                                                
                                                   H
                                                
                                                
                                                   
                                                      
                                                         v
                                                      
                                                      
                                                         i
                                                         3
                                                      
                                                   
                                                
                                             
                                             ,
                                             
                                                
                                                   H
                                                
                                                
                                                   
                                                      
                                                         v
                                                      
                                                      
                                                         i
                                                         4
                                                      
                                                   
                                                
                                             
                                             )
                                          
                                          ,
                                       
                                    
                                  where 
                                    
                                       
                                          H
                                       
                                       
                                          v
                                       
                                    
                                  represents the handle value of the vertex entity 
                                    v
                                 , Cat() is a function which concatenates the input handle values into a new value under the assumption that 
                                    
                                       
                                          H
                                       
                                       
                                          
                                             
                                                v
                                             
                                             
                                                i
                                                1
                                             
                                          
                                       
                                    
                                    >
                                    
                                       
                                          H
                                       
                                       
                                          
                                             
                                                v
                                             
                                             
                                                i
                                                2
                                             
                                          
                                       
                                    
                                    >
                                    
                                       
                                          H
                                       
                                       
                                          
                                             
                                                v
                                             
                                             
                                                i
                                                3
                                             
                                          
                                       
                                    
                                    >
                                    
                                       
                                          H
                                       
                                       
                                          
                                             
                                                v
                                             
                                             
                                                i
                                                4
                                             
                                          
                                       
                                    
                                 . Select the quadrilateral with the maximum ID as the candidate. Exit the construction and selection procedure.

When there are no convex coplanar four vertices of the graphical symbol, we construct and select the candidate as follows. 
                                    
                                       (a)
                                       Extract all the non-convex polygons that consist of four vertices. These qualified non-convex polygons can always be found in consideration of graphical symbols of piping components.

Calculate the ID for each polygon. Select the polygon with the maximum ID as the candidate.

Construct a convex quadrilateral from the selected polygon by using the convex quadrilateral construction method for non-convex polygons described as follows. Then prefer the constructed convex quadrilateral as the candidate.


                        Convex quadrilateral construction method for non-convex polygons. The selected non-convex polygon 
                           Q
                         can be classified into two types with respect to the spatial relation among the four vertices: concave quadrilateral and triangle.

Provided that 
                           Q
                         is a concave quadrilateral which consists of four vertices 
                           
                              {
                              
                                 
                                    v
                                 
                                 
                                    1
                                 
                              
                              ,
                              
                                 
                                    v
                                 
                                 
                                    2
                                 
                              
                              ,
                              
                                 
                                    v
                                 
                                 
                                    3
                                 
                              
                              ,
                              
                                 
                                    v
                                 
                                 
                                    4
                                 
                              
                              }
                           
                        . Without loss of generality, we assume that the interior angle 
                           ∠
                           
                              
                                 v
                              
                              
                                 2
                              
                           
                           
                              
                                 v
                              
                              
                                 3
                              
                           
                           
                              
                                 v
                              
                              
                                 4
                              
                           
                         is greater than 180 degrees as illustrated in Fig. 6
                        (a). We seek to find a new vertex on either of the two other edges 
                           
                              
                                 v
                              
                              
                                 1
                              
                           
                           
                              
                                 v
                              
                              
                                 4
                              
                           
                         and 
                           
                              
                                 v
                              
                              
                                 1
                              
                           
                           
                              
                                 v
                              
                              
                                 2
                              
                           
                         to construct a convex quadrilateral. There are several ways to construct such convex quadrilaterals. In this paper, the vertex is selected simply by making the new edge parallel to either of 
                           
                              
                                 v
                              
                              
                                 1
                              
                           
                           
                              
                                 v
                              
                              
                                 4
                              
                           
                         and 
                           
                              
                                 v
                              
                              
                                 1
                              
                           
                           
                              
                                 v
                              
                              
                                 2
                              
                           
                        , as illustrated in Fig. 6(b) and Fig. 6(c). We prefer the constructed convex quadrilateral with the maximum ID as the candidate. Note that, for the newly added vertex, its handle value is set to 0. Fig. 6 shows an example of the convex quadrilateral construction from a non-convex polygon. Two convex quadrilaterals can be constructed through the convex quadrilateral construction method discussed above. Finally, the convex quadrilateral 
                           
                              
                                 Q
                              
                              
                                 1
                              
                           
                         is selected since 
                           
                              
                                 
                                    ID
                                 
                              
                              
                                 1
                              
                           
                           >
                           
                              
                                 
                                    ID
                                 
                              
                              
                                 2
                              
                           
                        , where 
                           
                              
                                 H
                              
                              
                                 
                                    
                                       v
                                    
                                    
                                       2
                                    
                                    
                                       ′
                                    
                                 
                              
                           
                           =
                           
                              
                                 H
                              
                              
                                 
                                    
                                       v
                                    
                                    
                                       4
                                    
                                    
                                       ′
                                    
                                 
                              
                           
                           =
                           0
                        .

Given that 
                           Q
                         is a triangle that consists of four vertices 
                           
                              {
                              
                                 
                                    v
                                 
                                 
                                    1
                                 
                              
                              ,
                              
                                 
                                    v
                                 
                                 
                                    2
                                 
                              
                              ,
                              
                                 
                                    v
                                 
                                 
                                    3
                                 
                              
                              ,
                              
                                 
                                    v
                                 
                                 
                                    4
                                 
                              
                              }
                           
                        , three of which are collinear as shown in Fig. 7
                        (a). We construct the convex quadrilateral 
                           
                              
                                 Q
                              
                              
                                 ′
                              
                           
                           
                              {
                              
                                 
                                    v
                                 
                                 
                                    1
                                 
                              
                              ,
                              
                                 
                                    v
                                 
                                 
                                    2
                                 
                              
                              ,
                              
                                 
                                    v
                                 
                                 
                                    3
                                 
                              
                              ,
                              
                                 
                                    v
                                 
                                 
                                    4
                                 
                                 
                                    ′
                                 
                              
                              }
                           
                         by moving the vertex 
                           
                              
                                 v
                              
                              
                                 4
                              
                           
                         outwards a little bit following the direction of the diagonal 
                           
                              
                                 v
                              
                              
                                 2
                              
                           
                           
                              
                                 v
                              
                              
                                 4
                              
                           
                        , as illustrated in Fig. 7(b). The new vertex 
                           
                              
                                 v
                              
                              
                                 4
                              
                              
                                 ′
                              
                           
                         is calculated as follows: 
                           
                              (3)
                              
                                 
                                    
                                       v
                                    
                                    
                                       4
                                    
                                    
                                       ′
                                    
                                 
                                 =
                                 
                                    
                                       v
                                    
                                    
                                       4
                                    
                                 
                                 +
                                 m
                                 ×
                                 
                                    (
                                    
                                       
                                          v
                                       
                                       
                                          4
                                       
                                    
                                    −
                                    
                                       
                                          v
                                       
                                       
                                          2
                                       
                                    
                                    )
                                 
                                 ,
                              
                           
                         where 
                           m
                           =
                           
                              
                                 k
                              
                              
                                 
                                    ‖
                                    
                                       
                                          v
                                       
                                       
                                          4
                                       
                                    
                                    −
                                    
                                       
                                          v
                                       
                                       
                                          2
                                       
                                    
                                    ‖
                                 
                              
                           
                        , 
                           k
                           
                              (
                              k
                              >
                              0
                              )
                           
                         is a control parameter.


                        Fig. 8
                         gives two examples of constructing convex coplanar quadrilaterals which are represented by red edges for two different piping components. For the valve symbol, the convex coplanar quadrilateral is constructed directly by selecting a convex coplanar quadrilateral with the maximum ID. For the tee symbol, the convex coplanar quadrilateral is constructed by applying the convex quadrilateral construction method for non-convex polygons.

For each selected convex coplanar quadrilateral, we select two similarity transformation invariants for watermarks embedding and extraction.

Two candidate length ratios may be selected as watermark carriers for each diagonal of a given convex coplanar quadrilateral 
                           Q
                           
                              {
                              
                                 
                                    v
                                 
                                 
                                    1
                                 
                              
                              ,
                              
                                 
                                    v
                                 
                                 
                                    2
                                 
                              
                              ,
                              
                                 
                                    v
                                 
                                 
                                    3
                                 
                              
                              ,
                              
                                 
                                    v
                                 
                                 
                                    4
                                 
                              
                              }
                           
                         as illustrated in Fig. 9
                        (a) 
                           
                              (4)
                              
                                 
                                    {
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      ‖
                                                      
                                                         
                                                            v
                                                         
                                                         
                                                            1
                                                         
                                                      
                                                      −
                                                      o
                                                      ‖
                                                   
                                                
                                                
                                                   
                                                      ‖
                                                      
                                                         
                                                            v
                                                         
                                                         
                                                            1
                                                         
                                                      
                                                      −
                                                      
                                                         
                                                            v
                                                         
                                                         
                                                            3
                                                         
                                                      
                                                      ‖
                                                   
                                                
                                             
                                             ,
                                             
                                                
                                                   
                                                      ‖
                                                      
                                                         
                                                            v
                                                         
                                                         
                                                            3
                                                         
                                                      
                                                      −
                                                      o
                                                      ‖
                                                   
                                                
                                                
                                                   
                                                      ‖
                                                      
                                                         
                                                            v
                                                         
                                                         
                                                            1
                                                         
                                                      
                                                      −
                                                      
                                                         
                                                            v
                                                         
                                                         
                                                            3
                                                         
                                                      
                                                      ‖
                                                   
                                                
                                             
                                          
                                       
                                       
                                          
                                             
                                                
                                                   
                                                      ‖
                                                      
                                                         
                                                            v
                                                         
                                                         
                                                            2
                                                         
                                                      
                                                      −
                                                      o
                                                      ‖
                                                   
                                                
                                                
                                                   
                                                      ‖
                                                      
                                                         
                                                            v
                                                         
                                                         
                                                            2
                                                         
                                                      
                                                      −
                                                      
                                                         
                                                            v
                                                         
                                                         
                                                            4
                                                         
                                                      
                                                      ‖
                                                   
                                                
                                             
                                             ,
                                             
                                                
                                                   
                                                      ‖
                                                      
                                                         
                                                            v
                                                         
                                                         
                                                            4
                                                         
                                                      
                                                      −
                                                      o
                                                      ‖
                                                   
                                                
                                                
                                                   
                                                      ‖
                                                      
                                                         
                                                            v
                                                         
                                                         
                                                            2
                                                         
                                                      
                                                      −
                                                      
                                                         
                                                            v
                                                         
                                                         
                                                            4
                                                         
                                                      
                                                      ‖
                                                   
                                                
                                             
                                             .
                                          
                                       
                                    
                                 
                              
                           
                         To identify and differentiate length ratios without any prior knowledge of the vertex order, for each diagonal, the length ratio is chosen according to handle values of vertices. Without loss of generality, we assume that 
                           m
                           a
                           x
                           
                              (
                              
                                 
                                    H
                                 
                                 
                                    
                                       
                                          v
                                       
                                       
                                          1
                                       
                                    
                                 
                              
                              ,
                              
                                 
                                    H
                                 
                                 
                                    
                                       
                                          v
                                       
                                       
                                          3
                                       
                                    
                                 
                              
                              )
                           
                           >
                           max
                           
                              (
                              
                                 
                                    H
                                 
                                 
                                    
                                       
                                          v
                                       
                                       
                                          2
                                       
                                    
                                 
                              
                              ,
                              
                                 
                                    H
                                 
                                 
                                    
                                       
                                          v
                                       
                                       
                                          4
                                       
                                    
                                 
                              
                              )
                           
                        . Thus, the two selected ratios, namely 
                           
                              
                                 r
                              
                              
                                 1
                              
                           
                         and 
                           
                              
                                 r
                              
                              
                                 2
                              
                           
                        , preferred as watermark carriers are defined as follows: 
                           
                              
                                 (5)
                                 
                                    
                                       
                                          r
                                       
                                       
                                          1
                                       
                                    
                                    =
                                    
                                       {
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         ‖
                                                         
                                                            
                                                               v
                                                            
                                                            
                                                               1
                                                            
                                                         
                                                         −
                                                         o
                                                         ‖
                                                      
                                                   
                                                   
                                                      
                                                         ‖
                                                         
                                                            
                                                               v
                                                            
                                                            
                                                               1
                                                            
                                                         
                                                         −
                                                         
                                                            
                                                               v
                                                            
                                                            
                                                               3
                                                            
                                                         
                                                         ‖
                                                      
                                                   
                                                
                                                ,
                                                
                                                   
                                                      H
                                                   
                                                   
                                                      
                                                         
                                                            v
                                                         
                                                         
                                                            1
                                                         
                                                      
                                                   
                                                
                                                >
                                                
                                                   
                                                      H
                                                   
                                                   
                                                      
                                                         
                                                            v
                                                         
                                                         
                                                            3
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                          
                                             
                                                
                                                   
                                                      
                                                         ‖
                                                         
                                                            
                                                               v
                                                            
                                                            
                                                               3
                                                            
                                                         
                                                         −
                                                         o
                                                         ‖
                                                      
                                                   
                                                   
                                                      
                                                         ‖
                                                         
                                                            
                                                               v
                                                            
                                                            
                                                               1
                                                            
                                                         
                                                         −
                                                         
                                                            
                                                               v
                                                            
                                                            
                                                               3
                                                            
                                                         
                                                         ‖
                                                      
                                                   
                                                
                                                ,
                                                
                                                   
                                                      H
                                                   
                                                   
                                                      
                                                         
                                                            v
                                                         
                                                         
                                                            1
                                                         
                                                      
                                                   
                                                
                                                <
                                                
                                                   
                                                      H
                                                   
                                                   
                                                      
                                                         
                                                            v
                                                         
                                                         
                                                            3
                                                         
                                                      
                                                   
                                                
                                                ,
                                             
                                          
                                       
                                    
                                 
                              
                              
                                 (6)
                                 
                                    
                                       
                                          r
                                       
                                       
                                          2
                                       
                                    
                                    =
                                    
                                       {
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         ‖
                                                         
                                                            
                                                               v
                                                            
                                                            
                                                               2
                                                            
                                                         
                                                         −
                                                         o
                                                         ‖
                                                      
                                                   
                                                   
                                                      
                                                         ‖
                                                         
                                                            
                                                               v
                                                            
                                                            
                                                               2
                                                            
                                                         
                                                         −
                                                         
                                                            
                                                               v
                                                            
                                                            
                                                               4
                                                            
                                                         
                                                         ‖
                                                      
                                                   
                                                
                                                ,
                                                
                                                   
                                                      H
                                                   
                                                   
                                                      
                                                         
                                                            v
                                                         
                                                         
                                                            2
                                                         
                                                      
                                                   
                                                
                                                >
                                                
                                                   
                                                      H
                                                   
                                                   
                                                      
                                                         
                                                            v
                                                         
                                                         
                                                            4
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                          
                                             
                                                
                                                   
                                                      
                                                         ‖
                                                         
                                                            
                                                               v
                                                            
                                                            
                                                               4
                                                            
                                                         
                                                         −
                                                         o
                                                         ‖
                                                      
                                                   
                                                   
                                                      
                                                         ‖
                                                         
                                                            
                                                               v
                                                            
                                                            
                                                               2
                                                            
                                                         
                                                         −
                                                         
                                                            
                                                               v
                                                            
                                                            
                                                               4
                                                            
                                                         
                                                         ‖
                                                      
                                                   
                                                
                                                ,
                                                
                                                   
                                                      H
                                                   
                                                   
                                                      
                                                         
                                                            v
                                                         
                                                         
                                                            2
                                                         
                                                      
                                                   
                                                
                                                <
                                                
                                                   
                                                      H
                                                   
                                                   
                                                      
                                                         
                                                            v
                                                         
                                                         
                                                            4
                                                         
                                                      
                                                   
                                                
                                                .
                                             
                                          
                                       
                                    
                                 
                              
                           
                        
                     

We describe the semi-fragile watermarking scheme for the topology integrity authentication in this section. The topology based watermark generation method is first introduced. Then, the watermark embedding procedures based on quantization index modulation paradigm are described. Finally, the watermark extraction and topology verification procedures are explained.

Watermarks are generated through topology encoding. Two watermarks, namely 
                           
                              
                                 w
                              
                              
                                 
                                    
                                       v
                                    
                                    
                                       i
                                    
                                 
                              
                              
                                 c
                              
                           
                         and 
                           
                              
                                 w
                              
                              
                                 
                                    
                                       v
                                    
                                    
                                       i
                                    
                                 
                              
                              
                                 p
                              
                           
                        , are generated for each node 
                           
                              
                                 v
                              
                              
                                 i
                              
                           
                        . They are designed to authenticate and verify joint piping components and joint pipes of 
                           
                              
                                 v
                              
                              
                                 i
                              
                           
                         respectively. Selected attributes of nodes, such as topological relation and handle values, are introduced in the topology coding for authentication and verification. Handle values of joint piping components of 
                           
                              
                                 v
                              
                              
                                 i
                              
                           
                         are encoded into 
                           
                              
                                 w
                              
                              
                                 
                                    
                                       v
                                    
                                    
                                       i
                                    
                                 
                              
                              
                                 c
                              
                           
                        , and handle values of pipes which the edges of 
                           
                              
                                 v
                              
                              
                                 i
                              
                           
                         corresponding to are encoded into 
                           
                              
                                 w
                              
                              
                                 
                                    
                                       v
                                    
                                    
                                       i
                                    
                                 
                              
                              
                                 p
                              
                           
                        .

To generate watermarks, a hash function 
                           h
                           
                              (
                              x
                              )
                           
                         and a logistic function 
                           l
                           
                              (
                              x
                              )
                           
                         are predefined as the keys for watermark generation. 
                           h
                           
                              (
                              x
                              )
                           
                         is a hash function that generates a float value which falls within the range (0,1) with the hexadecimal key 
                           x
                        . The preferred logistic function is written as follows: 
                           
                              (7)
                              
                                 l
                                 
                                    (
                                    x
                                    )
                                 
                                 =
                                 
                                    
                                       y
                                    
                                    
                                       n
                                       +
                                       1
                                    
                                 
                                 =
                                 a
                                 
                                    
                                       y
                                    
                                    
                                       n
                                    
                                 
                                 
                                    (
                                    1
                                    −
                                    
                                       
                                          y
                                       
                                       
                                          n
                                       
                                    
                                    )
                                 
                                 ,
                              
                           
                         where 
                           
                              
                                 y
                              
                              
                                 n
                              
                           
                         is a number between 0 and 1, and it is the current value of the mapping in time with an initial value 
                           
                              
                                 y
                              
                              
                                 0
                              
                           
                        , 
                           a
                         is the ‘function seed’  [30]. When the logistic equation is seeded with a value 
                           3.5699
                           ≤
                           a
                           ≤
                           4.0
                        , and iterated, chaotic behavior is witnessed in general. Different sequences will be generated with different initial values since the logistic function is extremely sensitive to initial conditions.

The watermarks generation method can be described as follows:

First, we assign a weight 
                           
                              
                                 W
                              
                              
                                 
                                    
                                       e
                                    
                                    
                                       j
                                    
                                 
                              
                           
                         to each directed edge 
                           
                              
                                 e
                              
                              
                                 j
                              
                           
                           
                              (
                              
                                 
                                    v
                                 
                                 
                                    m
                                 
                              
                              
                                 
                                    v
                                 
                                 
                                    n
                                 
                              
                              )
                           
                         by setting its value to be the initial node 
                           
                              
                                 v
                              
                              
                                 m
                              
                           
                        ’s handle value 
                           
                              
                                 H
                              
                              
                                 
                                    
                                       v
                                    
                                    
                                       m
                                    
                                 
                              
                           
                        
                        
                           
                              (8)
                              
                                 
                                    
                                       W
                                    
                                    
                                       
                                          
                                             e
                                          
                                          
                                             j
                                          
                                       
                                    
                                 
                                 =
                                 
                                    
                                       W
                                    
                                    
                                       
                                          
                                             v
                                          
                                          
                                             m
                                          
                                       
                                       
                                          
                                             v
                                          
                                          
                                             n
                                          
                                       
                                    
                                 
                                 =
                                 
                                    
                                       H
                                    
                                    
                                       
                                          
                                             v
                                          
                                          
                                             m
                                          
                                       
                                    
                                 
                                 .
                              
                           
                        
                     

Second, we compute the watermark 
                           
                              
                                 w
                              
                              
                                 
                                    
                                       v
                                    
                                    
                                       i
                                    
                                 
                              
                              
                                 c
                              
                           
                         according to the weights of its incident edges. Let 
                           
                              
                                 E
                              
                              
                                 −
                              
                           
                           
                              (
                              
                                 
                                    v
                                 
                                 
                                    i
                                 
                              
                              )
                           
                         denote the set of all the incident edges of 
                           
                              
                                 v
                              
                              
                                 i
                              
                           
                         in 
                           E
                        . Provided that all the edges 
                           
                              
                                 e
                              
                              
                                 j
                              
                           
                           
                              (
                              
                                 
                                    e
                                 
                                 
                                    j
                                 
                              
                              ∈
                              
                                 
                                    E
                                 
                                 
                                    −
                                 
                              
                              
                                 (
                                 
                                    
                                       v
                                    
                                    
                                       i
                                    
                                 
                                 )
                              
                              ,
                              
                              0
                              ≤
                              j
                              ≤
                              n
                              ,
                              
                              n
                              =
                              
                                 |
                                 
                                    
                                       E
                                    
                                    
                                       −
                                    
                                 
                                 
                                    (
                                    
                                       
                                          v
                                       
                                       
                                          i
                                       
                                    
                                    )
                                 
                                 |
                              
                              −
                              1
                              )
                           
                         are sorted in the descending order according to their weights. These sorted weights are then converted into the key 
                           
                              
                                 K
                              
                              
                                 
                                    
                                       v
                                    
                                    
                                       i
                                    
                                 
                              
                              
                                 c
                              
                           
                         expressed by 
                           
                              (9)
                              
                                 
                                    
                                       K
                                    
                                    
                                       
                                          
                                             v
                                          
                                          
                                             i
                                          
                                       
                                    
                                    
                                       c
                                    
                                 
                                 =
                                 
                                    Cat
                                 
                                 
                                    (
                                    
                                       
                                          W
                                       
                                       
                                          
                                             
                                                e
                                             
                                             
                                                1
                                             
                                          
                                       
                                    
                                    ,
                                    
                                       
                                          W
                                       
                                       
                                          
                                             
                                                e
                                             
                                             
                                                2
                                             
                                          
                                       
                                    
                                    ,
                                    …
                                    ,
                                    
                                       
                                          W
                                       
                                       
                                          
                                             
                                                e
                                             
                                             
                                                n
                                             
                                          
                                       
                                    
                                    )
                                 
                                 ,
                              
                           
                         where 
                           
                              
                                 W
                              
                              
                                 
                                    
                                       e
                                    
                                    
                                       1
                                    
                                 
                              
                           
                           >
                           
                              
                                 W
                              
                              
                                 
                                    
                                       e
                                    
                                    
                                       2
                                    
                                 
                              
                           
                           >
                           ⋯
                           >
                           
                              
                                 W
                              
                              
                                 
                                    
                                       e
                                    
                                    
                                       n
                                    
                                 
                              
                           
                        . Then, the watermark 
                           
                              
                                 w
                              
                              
                                 
                                    
                                       v
                                    
                                    
                                       i
                                    
                                 
                              
                              
                                 c
                              
                           
                         is generated by 
                           
                              (10)
                              
                                 
                                    
                                       w
                                    
                                    
                                       
                                          
                                             v
                                          
                                          
                                             i
                                          
                                       
                                    
                                    
                                       c
                                    
                                 
                                 =
                                 l
                                 
                                    (
                                    h
                                    
                                       (
                                       
                                          
                                             K
                                          
                                          
                                             
                                                
                                                   v
                                                
                                                
                                                   i
                                                
                                             
                                          
                                          
                                             c
                                          
                                       
                                       )
                                    
                                    )
                                 
                                 .
                              
                           
                        
                     

Finally, we compute the watermark 
                           
                              
                                 w
                              
                              
                                 
                                    
                                       v
                                    
                                    
                                       i
                                    
                                 
                              
                              
                                 p
                              
                           
                         according to handle values of pipes which the edges of 
                           
                              
                                 v
                              
                              
                                 i
                              
                           
                         corresponding to. Given that all the pipes 
                           
                              
                                 p
                              
                              
                                 j
                              
                           
                         are sorted in the descending order according to their handle values. Then, these sorted handle values are converted into the key 
                           
                              
                                 K
                              
                              
                                 
                                    
                                       v
                                    
                                    
                                       i
                                    
                                 
                              
                              
                                 p
                              
                           
                         by 
                           
                              (11)
                              
                                 
                                    
                                       K
                                    
                                    
                                       
                                          
                                             v
                                          
                                          
                                             i
                                          
                                       
                                    
                                    
                                       p
                                    
                                 
                                 =
                                 
                                    Cat
                                 
                                 
                                    (
                                    
                                       
                                          H
                                       
                                       
                                          
                                             
                                                p
                                             
                                             
                                                1
                                             
                                          
                                       
                                    
                                    ,
                                    
                                       
                                          H
                                       
                                       
                                          
                                             
                                                p
                                             
                                             
                                                2
                                             
                                          
                                       
                                    
                                    ,
                                    …
                                    ,
                                    
                                       
                                          H
                                       
                                       
                                          
                                             
                                                p
                                             
                                             
                                                m
                                             
                                          
                                       
                                    
                                    )
                                 
                                 ,
                              
                           
                         where 
                           
                              
                                 H
                              
                              
                                 
                                    
                                       p
                                    
                                    
                                       1
                                    
                                 
                              
                           
                           >
                           
                              
                                 H
                              
                              
                                 
                                    
                                       p
                                    
                                    
                                       2
                                    
                                 
                              
                           
                           >
                           ⋯
                           >
                           
                              
                                 H
                              
                              
                                 
                                    
                                       p
                                    
                                    
                                       m
                                    
                                 
                              
                           
                        . Then, the watermark 
                           
                              
                                 w
                              
                              
                                 
                                    
                                       v
                                    
                                    
                                       i
                                    
                                 
                              
                              
                                 p
                              
                           
                         is calculated by 
                           
                              (12)
                              
                                 
                                    
                                       w
                                    
                                    
                                       
                                          
                                             v
                                          
                                          
                                             i
                                          
                                       
                                    
                                    
                                       p
                                    
                                 
                                 =
                                 l
                                 
                                    (
                                    h
                                    
                                       (
                                       
                                          
                                             K
                                          
                                          
                                             
                                                
                                                   v
                                                
                                                
                                                   i
                                                
                                             
                                          
                                          
                                             p
                                          
                                       
                                       )
                                    
                                    )
                                 
                                 .
                              
                           
                        
                     

It should be pointed out 
                           
                              
                                 K
                              
                              
                                 
                                    
                                       v
                                    
                                    
                                       i
                                    
                                 
                              
                              
                                 c
                              
                           
                         is set to 0 if 
                           
                              
                                 v
                              
                              
                                 i
                              
                           
                         has no joint piping components. In the same way, 0 is assigned to 
                           
                              
                                 K
                              
                              
                                 
                                    
                                       v
                                    
                                    
                                       i
                                    
                                 
                              
                              
                                 p
                              
                           
                         in case there are no pipes between 
                           
                              
                                 v
                              
                              
                                 i
                              
                           
                         and its joint piping components. Consequently, the watermarks are set to 0 in view of these facts.


                        Fig. 10
                         shows a simple example that generates watermarks 
                           
                              
                                 w
                              
                              
                                 
                                    
                                       v
                                    
                                    
                                       1
                                    
                                 
                              
                              
                                 c
                              
                           
                         and 
                           
                              
                                 w
                              
                              
                                 
                                    
                                       v
                                    
                                    
                                       1
                                    
                                 
                              
                              
                                 p
                              
                           
                         for the node 
                           
                              
                                 v
                              
                              
                                 1
                              
                           
                        . The piping components 
                           
                              
                                 v
                              
                              
                                 1
                              
                           
                         and 
                           
                              
                                 v
                              
                              
                                 2
                              
                           
                         are connected through a pipe 
                           
                              
                                 p
                              
                              
                                 1
                              
                           
                         with 
                           
                              
                                 H
                              
                              
                                 
                                    
                                       p
                                    
                                    
                                       1
                                    
                                 
                              
                           
                           =
                           f
                           1
                        . Similarly the piping components 
                           
                              
                                 v
                              
                              
                                 1
                              
                           
                         and 
                           
                              
                                 v
                              
                              
                                 3
                              
                           
                         are connected through a pipe 
                           
                              
                                 p
                              
                              
                                 2
                              
                           
                         with 
                           
                              
                                 H
                              
                              
                                 
                                    
                                       p
                                    
                                    
                                       2
                                    
                                 
                              
                           
                           =
                           e
                           4
                        . 
                           
                              
                                 v
                              
                              
                                 1
                              
                           
                         and 
                           
                              
                                 v
                              
                              
                                 4
                              
                           
                         are connected with each other directly. The weight of each edge is first calculated. The set of incident edges 
                           
                              
                                 E
                              
                              
                                 −
                              
                           
                           
                              (
                              
                                 
                                    v
                                 
                                 
                                    1
                                 
                              
                              )
                           
                         ​is 
                           
                              {
                              
                                 
                                    v
                                 
                                 
                                    2
                                 
                              
                              
                                 
                                    v
                                 
                                 
                                    1
                                 
                              
                              ,
                              
                                 
                                    v
                                 
                                 
                                    3
                                 
                              
                              
                                 
                                    v
                                 
                                 
                                    1
                                 
                              
                              ,
                              
                                 
                                    v
                                 
                                 
                                    4
                                 
                              
                              
                                 
                                    v
                                 
                                 
                                    1
                                 
                              
                              }
                           
                        . These edges are arranged as 
                           
                              {
                              
                                 
                                    v
                                 
                                 
                                    3
                                 
                              
                              
                                 
                                    v
                                 
                                 
                                    1
                                 
                              
                              ,
                              
                                 
                                    v
                                 
                                 
                                    2
                                 
                              
                              
                                 
                                    v
                                 
                                 
                                    1
                                 
                              
                              ,
                              
                                 
                                    v
                                 
                                 
                                    4
                                 
                              
                              
                                 
                                    v
                                 
                                 
                                    1
                                 
                              
                              }
                           
                         in the descending order according to their weights. Finally, watermarks 
                           
                              
                                 w
                              
                              
                                 
                                    
                                       v
                                    
                                    
                                       1
                                    
                                 
                              
                              
                                 c
                              
                           
                         and 
                           
                              
                                 w
                              
                              
                                 
                                    
                                       v
                                    
                                    
                                       1
                                    
                                 
                              
                              
                                 p
                              
                           
                         are generated by 
                           
                              
                                 (13)
                                 
                                    
                                       
                                          w
                                       
                                       
                                          
                                             
                                                v
                                             
                                             
                                                1
                                             
                                          
                                       
                                       
                                          c
                                       
                                    
                                    =
                                    l
                                    
                                       (
                                       h
                                       
                                          (
                                          
                                             
                                                K
                                             
                                             
                                                
                                                   
                                                      v
                                                   
                                                   
                                                      1
                                                   
                                                
                                             
                                             
                                                c
                                             
                                          
                                          )
                                       
                                       )
                                    
                                    =
                                    l
                                    
                                       (
                                       h
                                       
                                          (
                                          e
                                          2
                                          f
                                          2
                                          d
                                          1
                                          a
                                          )
                                       
                                       )
                                    
                                    ,
                                 
                              
                              
                                 (14)
                                 
                                    
                                       
                                          w
                                       
                                       
                                          
                                             
                                                v
                                             
                                             
                                                1
                                             
                                          
                                       
                                       
                                          p
                                       
                                    
                                    =
                                    l
                                    
                                       (
                                       h
                                       
                                          (
                                          
                                             
                                                K
                                             
                                             
                                                
                                                   
                                                      v
                                                   
                                                   
                                                      1
                                                   
                                                
                                             
                                             
                                                p
                                             
                                          
                                          )
                                       
                                       )
                                    
                                    =
                                    l
                                    
                                       (
                                       h
                                       
                                          (
                                          f
                                          1
                                          e
                                          40
                                          )
                                       
                                       )
                                    
                                    .
                                 
                              
                           
                        
                     

In order to achieve robustness against global and local similarity transformations on components, especially stretching operation on pipes, we prefer to embed the generated topology sensitive watermarks into similarity transformation invariants of piping components rather than pipes.

To embed watermarks into geometric invariants, several well-known methods, such as LSB (Least Significant Bit) and QIM (Quantization Index Modulation), can be employed. In this paper, the QIM method is preferred in the proposed watermarking paradigm  [8,31–33]. The quantization step size 
                           Δ
                         is predefined as the key for watermark embedding and extraction.

Provided that 
                           r
                         is the length ratio. To embed the watermark 
                           w
                         by slightly changing 
                           r
                         with the quantization step 
                           Δ
                        , its corresponding integer quotient 
                           Q
                         and the remainder 
                           R
                         are calculated by 
                           
                              (15)
                              
                                 
                                    {
                                    
                                       
                                          
                                             Q
                                             =
                                             
                                                ⌊
                                                r
                                                /
                                                Δ
                                                ⌋
                                             
                                          
                                       
                                       
                                          
                                             R
                                             =
                                             r
                                             −
                                             Q
                                             ×
                                             Δ
                                             ,
                                          
                                       
                                    
                                 
                              
                           
                         where 
                           
                              ⌊
                              ⋅
                              ⌋
                           
                         represents the floor function. The watermark 
                           w
                         is then added into 
                           r
                         as follows: 
                           
                              (16)
                              
                                 
                                    
                                       r
                                    
                                    
                                       ′
                                    
                                 
                                 =
                                 r
                                 −
                                 R
                                 +
                                 w
                                 ×
                                 Δ
                                 ,
                              
                           
                         where 
                           
                              
                                 r
                              
                              
                                 ′
                              
                           
                         is the length ratio after embedding, 
                           0
                           ≤
                           w
                           <
                           1
                        . The error introduced by (16) will not exceed the quantization step 
                           Δ
                         so that the impact of embedding on the drawing content can be tuned with the quantization step 
                           Δ
                        .

For each node 
                           
                              
                                 v
                              
                              
                                 i
                              
                           
                        , its watermark 
                           
                              
                                 w
                              
                              
                                 
                                    
                                       v
                                    
                                    
                                       i
                                    
                                 
                              
                              
                                 c
                              
                           
                         is embedded into 
                           
                              
                                 r
                              
                              
                                 1
                              
                           
                         and 
                           
                              
                                 w
                              
                              
                                 
                                    
                                       v
                                    
                                    
                                       i
                                    
                                 
                              
                              
                                 p
                              
                           
                         is embedded into 
                           
                              
                                 r
                              
                              
                                 2
                              
                           
                        . Watermarks are embedded into the length ratios by slightly changing their values while keeping the quadrilaterals coplanar as illustrated in Fig. 9. 
                           
                              
                                 r
                              
                              
                                 1
                              
                           
                         and 
                           
                              
                                 r
                              
                              
                                 2
                              
                           
                         are changed into 
                           
                              
                                 r
                              
                              
                                 1
                              
                              
                                 ′
                              
                           
                         and 
                           
                              
                                 r
                              
                              
                                 2
                              
                              
                                 ′
                              
                           
                         after the watermarks embedding, respectively. They are modified by adjusting the coordinates of 
                           
                              
                                 v
                              
                              
                                 1
                              
                           
                         and 
                           
                              
                                 v
                              
                              
                                 4
                              
                           
                         along the direction of diagonals they reside on. The coordinate of 
                           o
                         keeps constant. Let 
                           
                              
                                 v
                              
                              
                                 1
                              
                              
                                 ′
                              
                           
                         and 
                           
                              
                                 v
                              
                              
                                 4
                              
                              
                                 ′
                              
                           
                         be the adjusted vertex of 
                           
                              
                                 v
                              
                              
                                 1
                              
                           
                         and 
                           
                              
                                 v
                              
                              
                                 4
                              
                           
                        , respectively. Then, 
                           
                              
                                 v
                              
                              
                                 1
                              
                              
                                 ′
                              
                           
                         and 
                           
                              
                                 v
                              
                              
                                 4
                              
                              
                                 ′
                              
                           
                         are calculated as follows: 
                           
                              (17)
                              
                                 
                                    {
                                    
                                       
                                          
                                             
                                                
                                                   v
                                                
                                                
                                                   1
                                                
                                                
                                                   ′
                                                
                                             
                                             =
                                             
                                                
                                                   o
                                                   −
                                                   
                                                      
                                                         r
                                                      
                                                      
                                                         1
                                                      
                                                      
                                                         ′
                                                      
                                                   
                                                   
                                                      
                                                         v
                                                      
                                                      
                                                         3
                                                      
                                                   
                                                
                                                
                                                   1
                                                   −
                                                   
                                                      
                                                         r
                                                      
                                                      
                                                         1
                                                      
                                                      
                                                         ′
                                                      
                                                   
                                                
                                             
                                          
                                       
                                       
                                          
                                             
                                                
                                                   v
                                                
                                                
                                                   4
                                                
                                                
                                                   ′
                                                
                                             
                                             =
                                             
                                                
                                                   o
                                                   −
                                                   
                                                      
                                                         r
                                                      
                                                      
                                                         2
                                                      
                                                      
                                                         ′
                                                      
                                                   
                                                   
                                                      
                                                         v
                                                      
                                                      
                                                         2
                                                      
                                                   
                                                
                                                
                                                   1
                                                   −
                                                   
                                                      
                                                         r
                                                      
                                                      
                                                         2
                                                      
                                                      
                                                         ′
                                                      
                                                   
                                                
                                             
                                             .
                                          
                                       
                                    
                                 
                              
                           
                        
                     

The watermark extraction procedures consist of following steps, which are similar to the embedding procedures.

Initially, we construct the topological graph from the watermarked piping isometric drawing. Then, for each node 
                           
                              
                                 v
                              
                              
                                 i
                              
                           
                        , we construct its similarity transformation invariants 
                           
                              
                                 r
                              
                              
                                 1
                              
                              
                                 ′
                              
                           
                         and 
                           
                              
                                 r
                              
                              
                                 2
                              
                              
                                 ′
                              
                           
                        . After that, according to the quantization step 
                           Δ
                        , we can extract the embedded watermarks 
                           
                              
                                 
                                    
                                       w
                                    
                                    
                                       ˆ
                                    
                                 
                              
                              
                                 
                                    
                                       v
                                    
                                    
                                       i
                                    
                                 
                              
                              
                                 c
                              
                           
                         and 
                           
                              
                                 
                                    
                                       w
                                    
                                    
                                       ˆ
                                    
                                 
                              
                              
                                 
                                    
                                       v
                                    
                                    
                                       i
                                    
                                 
                              
                              
                                 p
                              
                           
                         by 
                           
                              
                                 (18)
                                 
                                    
                                       
                                          
                                             
                                                w
                                             
                                             
                                                ˆ
                                             
                                          
                                       
                                       
                                          
                                             
                                                v
                                             
                                             
                                                i
                                             
                                          
                                       
                                       
                                          c
                                       
                                    
                                    =
                                    
                                       
                                          
                                             
                                                r
                                             
                                             
                                                1
                                             
                                             
                                                ′
                                             
                                          
                                          −
                                          
                                             ⌊
                                             
                                                
                                                   r
                                                
                                                
                                                   1
                                                
                                                
                                                   ′
                                                
                                             
                                             /
                                             Δ
                                             ⌋
                                          
                                          ×
                                          Δ
                                       
                                       
                                          Δ
                                       
                                    
                                    ,
                                 
                              
                              
                                 (19)
                                 
                                    
                                       
                                          
                                             
                                                w
                                             
                                             
                                                ˆ
                                             
                                          
                                       
                                       
                                          
                                             
                                                v
                                             
                                             
                                                i
                                             
                                          
                                       
                                       
                                          p
                                       
                                    
                                    =
                                    
                                       
                                          
                                             
                                                r
                                             
                                             
                                                2
                                             
                                             
                                                ′
                                             
                                          
                                          −
                                          
                                             ⌊
                                             
                                                
                                                   r
                                                
                                                
                                                   2
                                                
                                                
                                                   ′
                                                
                                             
                                             /
                                             Δ
                                             ⌋
                                          
                                          ×
                                          Δ
                                       
                                       
                                          Δ
                                       
                                    
                                    .
                                 
                              
                           
                         Finally, we generate 
                           
                              
                                 w
                              
                              
                                 
                                    
                                       v
                                    
                                    
                                       i
                                    
                                 
                              
                              
                                 c
                              
                           
                         and 
                           
                              
                                 w
                              
                              
                                 
                                    
                                       v
                                    
                                    
                                       i
                                    
                                 
                              
                              
                                 p
                              
                           
                         according to the watermark generation method for 
                           
                              
                                 v
                              
                              
                                 i
                              
                           
                        . The corresponding 
                           
                              
                                 w
                              
                              
                                 
                                    
                                       v
                                    
                                    
                                       i
                                    
                                 
                              
                              
                                 c
                              
                           
                         and 
                           
                              
                                 
                                    
                                       w
                                    
                                    
                                       ˆ
                                    
                                 
                              
                              
                                 
                                    
                                       v
                                    
                                    
                                       i
                                    
                                 
                              
                              
                                 c
                              
                           
                         should satisfy 
                           
                              |
                              
                                 
                                    w
                                 
                                 
                                    
                                       
                                          v
                                       
                                       
                                          i
                                       
                                    
                                 
                                 
                                    c
                                 
                              
                              −
                              
                                 
                                    
                                       
                                          w
                                       
                                       
                                          ˆ
                                       
                                    
                                 
                                 
                                    
                                       
                                          v
                                       
                                       
                                          i
                                       
                                    
                                 
                                 
                                    c
                                 
                              
                              |
                           
                           <
                           ϵ
                        , where 
                           ϵ
                         is a small positive value. Otherwise, it suggests that the topology relation between 
                           
                              
                                 v
                              
                              
                                 i
                              
                           
                         and its joint piping components has been changed. Likewise, if 
                           
                              |
                              
                                 
                                    w
                                 
                                 
                                    
                                       
                                          v
                                       
                                       
                                          i
                                       
                                    
                                 
                                 
                                    c
                                 
                              
                              −
                              
                                 
                                    
                                       
                                          w
                                       
                                       
                                          ˆ
                                       
                                    
                                 
                                 
                                    
                                       
                                          v
                                       
                                       
                                          i
                                       
                                    
                                 
                                 
                                    c
                                 
                              
                              |
                           
                           >
                           ϵ
                        , it means that the topology relation between 
                           
                              
                                 v
                              
                              
                                 i
                              
                           
                         and its joint pipes has been modified.

We evaluated the proposed authentication scheme on 23 different piping isometric drawings with various authorized and unauthorized operations. Fig. 11
                         shows six piping isometric drawings used in our experiments. The key characteristics, including the number of pipes, piping components and vertices of four of the test drawings are summarized in Table 1
                        . The precision of coordinates, called ‘model precision’, of test drawings is also listed. It should be pointed out that operations referred in this paper are object-level operations provided by design systems. These operations treat the graphical symbol of each component as a whole. This means that we do not apply similarity transformations to individual entities which constitute each graphical symbol since this kind of operation makes no sense in practice.

We assigned 0.001 to the parameters 
                           k
                         and 
                           Δ
                         according to the drawings’ precision. The logistic function shown in (7) is seeded with the value 
                           a
                           =
                           3.9
                         for 4000 iterations. The hash function 
                           h
                           
                              (
                              x
                              )
                           
                         is designed to generate a float value which falls within the range (0,1) with the hexadecimal key 
                           x
                         in this paper, and a simple function 
                           0.1
                           x
                         is employed in our experiments. Note that the keys 
                           
                              
                                 K
                              
                              
                                 
                                    
                                       v
                                    
                                    
                                       i
                                    
                                 
                              
                              
                                 c
                              
                           
                         and 
                           
                              
                                 K
                              
                              
                                 
                                    
                                       v
                                    
                                    
                                       i
                                    
                                 
                              
                              
                                 p
                              
                           
                         in (9) and (11) respectively are in hexadecimal format. Therefore, they should first be converted to decimal values when the hash function 
                           h
                           
                              (
                              x
                              )
                           
                         is applied in (10) and (12).

To measure the geometrical difference between the watermarked and original drawings, the root mean square error (RMSE) is employed in our experiments 
                           
                              (20)
                              
                                 
                                    RMSE
                                 
                                 =
                                 
                                    
                                       1
                                    
                                    
                                       N
                                    
                                 
                                 
                                    ‖
                                    v
                                    −
                                    
                                       
                                          v
                                       
                                       
                                          ′
                                       
                                    
                                    ‖
                                 
                                 ,
                              
                           
                         where 
                           v
                         and 
                           
                              
                                 v
                              
                              
                                 ′
                              
                           
                         are the corresponding vertices in the original drawing and the watermarked drawing respectively, and 
                           N
                         denotes the total number of vertices in the drawing.

The imperceptibility of the proposed scheme could be tuned by the quantization step size 
                           Δ
                         and the control parameter 
                           k
                         in (3). From (16) and (3), we see that the larger the predefined keys 
                           Δ
                         and 
                           k
                        , the larger the induced distortion. Therefore, we can control the maximum distortion from each node and the maximum average distortion by setting the key values according to the users precision requirement. The maximum distortion induced on a watermarked node, 
                           
                              
                                 v
                              
                              
                                 
                                    max
                                 
                              
                              
                                 d
                              
                           
                        , depends on 
                           Δ
                         and 
                           k
                        , and can be calculated by 
                           
                              (21)
                              
                                 
                                    
                                       v
                                    
                                    
                                       
                                          max
                                       
                                    
                                    
                                       d
                                    
                                 
                                 =
                                 k
                                 +
                                 Δ
                                 .
                              
                           
                        
                     

We perform a series of tests on a set of piping isometric drawings to observe the impact of 
                           Δ
                         and 
                           k
                        . Fig. 12
                         shows the experimental results of a piping isometric drawing which consists of 33 piping components and 21 pipes. From Fig. 12 we can see that, for a given 
                           k
                        , the RMSE increases when the quantization step size 
                           Δ
                         is increased, and for a fixed quantization step size 
                           Δ
                        , the RMSE increases when the control parameter 
                           k
                         is increased too. As a result, the recommended values of 
                           k
                         and 
                           Δ
                         are less than 0.001.

The robustness against both global and local similarity transformation attacks can be analyzed in terms of topology based watermarks and embedding carriers. First, watermarks for each node are generated according to the topological graph which is preserved under any similarity transformation. Therefore, they are independent of dimensions and locations of components. Second, two selected independent length ratios of three collinear vertices of convex coplanar quadrilaterals are utilized as watermark carriers. Convex coplanar quadrilaterals are constructed for graphical symbol of each piping component. These ratios are invariant under similarity transformations as discussed in Section  6.1. Given all that, the proposed scheme can archive the robustness against similarity transformation attacks on either the overall drawing or individual components.


                           Fig. 13
                            shows the experimental tests of the robustness against non-malicious similarity transformation attacks of the proposed method. In these tests, the parameters for various non-malicious similarity transformation attacks are set as follows: (a) Translating the whole drawing arbitrarily; (b) Scaling the whole drawing with a factor 2; (c) Rotating the whole drawing by 
                              45
                              
                              °
                           ; (d) Translating parts of the components labeled with red circles along the direction of joint pipes; (e) Scaling selected piping components with different factors; and (f) Rotating some of the components labeled with red circles by different degrees. The extracted watermarks are preserved under any similarity transformation involving translation, rotation, uniform scaling, and their combinations.

The proposed scheme is designed to be robust against stretching operation on pipes. Fig. 13(d) and Fig. 13(e) show some stretched pipes highlighted in green which are induced by translation and scaling operations on piping components. Our scheme is immune to this kind of attack through selecting geometric invariants of piping components as watermark carriers. These invariants could not be alerted by various operations on pipes. In addition, stretching operation is applied on pipes without modifying the topological relation. Thus, the topological graph, where pipes between piping components are represented by edges between nodes, as well as the generated watermarks, will not be affected. Consequently, our scheme can achieve robustness against stretching operation on pipes.

PMI (Product and manufacturing information) may include geometric dimensions and tolerances, 3D annotation (text) and dimensions, surface finish, and material specifications. The application of PMI aims to enhance and shorten the design cycle by enabling product teams to incorporate product and process information during the design phase, thereby facilitating better communications, fewer interruption errors, streamlined design processes and faster change management. It conveys non-geometric attributes in 3D CAD and Collaborative Product Development systems necessary for manufacturing product components or subsystems. Nowadays, PMI additions have been included in more and more CAD software.

The proposed scheme achieves the robustness against this kind of addition since our scheme is designed to be independent of PMI information. Firstly, watermarks are generated based on geometric components and their topological relation. Secondly, generated watermarks are embedded into geometric invariants of selected geometric components. Therefore, both watermarks and their carriers depend on geometric attributes of piping isometric drawings rather than non-geometric attributes of PMI.

In this subsection, we discuss the performance of our scheme on detecting and locating topological modifications including components addition, components deletion and logical topological relation modification on piping isometric drawings. These modifications, which will inevitably lead to the changing of topological relation among joint components, are common operations during the practical design process. The topology integrity of each piping component can be verified by comparing the extracted watermarks with the watermarks generated according to the watermarked drawing. The piping component will be labeled as tampered if the topology relation between it and its joint piping components or joint pipes is alerted.

The tamper detection and localization methods are detailed as follows.

This kind of attack is implemented through adding pipes or piping components and modifying the topological relation accordingly. There exist two situations when a new component is added as shown in Fig. 14
                           (b) and Fig. 14(c).

(a) One is that a pipe is added and it should be connected with at least one existing piping component according to the introduction in Section  2.1. Given that the referred existing piping component is 
                              v
                            in the constructed topological graph of the watermarked drawing. Then, two new directed edges at 
                              v
                            are added as illustrated in Fig. 14(b). The set of joint pipes of 
                              v
                            is changed because of the pipe addition. These attacks result in the modification of the key 
                              
                                 
                                    K
                                 
                                 
                                    v
                                 
                                 
                                    p
                                 
                              
                            of 
                              v
                           . Consequently, the generated watermark 
                              
                                 
                                    w
                                 
                                 
                                    v
                                 
                                 
                                    p
                                 
                              
                            will be different from the extracted watermark 
                              
                                 
                                    
                                       
                                          w
                                       
                                       
                                          ˆ
                                       
                                    
                                 
                                 
                                    v
                                 
                                 
                                    p
                                 
                              
                           . Therefore, the piping component 
                              v
                            is set to be suspicious which suggests that its joint pipes are alerted.

(b) The other is that a piping component is added and connected with an existing pipe or piping component. Therefore, a new node 
                              v
                            is added to represent the added piping component in the constructed topological graph, as illustrated in Fig. 14(c). During the watermark extraction stage, the extracted watermarks 
                              
                                 
                                    
                                       
                                          w
                                       
                                       
                                          ˆ
                                       
                                    
                                 
                                 
                                    v
                                 
                                 
                                    c
                                 
                              
                            and 
                              
                                 
                                    
                                       
                                          w
                                       
                                       
                                          ˆ
                                       
                                    
                                 
                                 
                                    v
                                 
                                 
                                    p
                                 
                              
                            are unpredictable since no watermarks have been embedded into the new piping component 
                              v
                           . Thus, the generated watermarks 
                              
                                 
                                    w
                                 
                                 
                                    v
                                 
                                 
                                    c
                                 
                              
                            and 
                              
                                 
                                    w
                                 
                                 
                                    v
                                 
                                 
                                    p
                                 
                              
                            will be different from 
                              
                                 
                                    
                                       
                                          w
                                       
                                       
                                          ˆ
                                       
                                    
                                 
                                 
                                    v
                                 
                                 
                                    c
                                 
                              
                            and 
                              
                                 
                                    
                                       
                                          w
                                       
                                       
                                          ˆ
                                       
                                    
                                 
                                 
                                    v
                                 
                                 
                                    p
                                 
                              
                            respectively. Therefore, the added piping component 
                              v
                            is labeled as tampered which indicates that its joint pipes and piping components are modified. In addition, the set of joint piping components of 
                              w
                            is alerted due to the addition of 
                              v
                           . This brings about the changing of the key 
                              
                                 
                                    K
                                 
                                 
                                    w
                                 
                                 
                                    c
                                 
                              
                            of 
                              w
                           . Consequently, 
                              w
                            is also set to be suspicious.

Deleting components is implemented through removing components and modifying the topological relation accordingly. There also exist two situations when deleting a component from a watermarked piping isometric drawing.

(a) One is that a pipe is first disconnected with existing piping components and then deleted from the drawing. Without loss of generality, we assume that the pipe between 
                              w
                            and 
                              v
                            is deleted as illustrated in Fig. 15
                           (a). This gives rise to modifications of the set of joint piping components and the set of joint pipes of both 
                              w
                            and 
                              v
                           . Taking the piping component 
                              v
                            as an example, both 
                              
                                 
                                    K
                                 
                                 
                                    v
                                 
                                 
                                    c
                                 
                              
                            and 
                              
                                 
                                    K
                                 
                                 
                                    v
                                 
                                 
                                    p
                                 
                              
                            of 
                              v
                            are changed because of the pipe deletion. Consequently, the generated watermarks 
                              
                                 
                                    w
                                 
                                 
                                    v
                                 
                                 
                                    c
                                 
                              
                            and 
                              
                                 
                                    w
                                 
                                 
                                    v
                                 
                                 
                                    p
                                 
                              
                            will be different from the extracted watermarks 
                              
                                 
                                    
                                       
                                          w
                                       
                                       
                                          ˆ
                                       
                                    
                                 
                                 
                                    v
                                 
                                 
                                    c
                                 
                              
                            and 
                              
                                 
                                    
                                       
                                          w
                                       
                                       
                                          ˆ
                                       
                                    
                                 
                                 
                                    v
                                 
                                 
                                    p
                                 
                              
                            respectively. Therefore, the piping component 
                              v
                            is labeled as a tampered component which means that its joint pipes and piping components are changed. The piping component 
                              w
                            is also set to be tampered for the same reason.

(b) The other is that a piping component is disconnected with existing components and then deleted from the drawing. Two situations arise here. 
                              
                                 •
                                 The first situation is that the deleted piping component 
                                       w
                                     is connected with a pipe 
                                       p
                                    . Given that the two joint piping components of 
                                       p
                                     are 
                                       w
                                     and 
                                       v
                                     as illustrated in Fig. 15(b). The set of joint piping components of 
                                       v
                                     is alerted when 
                                       w
                                     is deleted. Thus, the weight of the directed edge which represents the topological relation between 
                                       w
                                     and 
                                       v
                                     is alerted. This will lead to the modification of the key 
                                       
                                          
                                             K
                                          
                                          
                                             v
                                          
                                          
                                             c
                                          
                                       
                                     of 
                                       v
                                    . Consequently, it results in the difference between the watermark 
                                       
                                          
                                             w
                                          
                                          
                                             v
                                          
                                          
                                             c
                                          
                                       
                                     computed according to the new topological graph and the extracted watermark 
                                       
                                          
                                             
                                                
                                                   w
                                                
                                                
                                                   ˆ
                                                
                                             
                                          
                                          
                                             v
                                          
                                          
                                             c
                                          
                                       
                                     from 
                                       v
                                    . Therefore, the piping component 
                                       v
                                     is labeled as tampered which indicates that at least one of its joint piping components has been changed.

The second situation is that the deleted piping component 
                                       w
                                     is connected with a piping component 
                                       v
                                     directly as illustrated in Fig. 15(c). Thus, the set of joint piping components of 
                                       v
                                     is modified. This will result in the modification of the key 
                                       
                                          
                                             K
                                          
                                          
                                             v
                                          
                                          
                                             c
                                          
                                       
                                     of 
                                       v
                                    . Therefore, it will lead to the difference between the generated watermark 
                                       
                                          
                                             w
                                          
                                          
                                             v
                                          
                                          
                                             c
                                          
                                       
                                     based on the new topological graph and the extracted watermark 
                                       
                                          
                                             
                                                
                                                   w
                                                
                                                
                                                   ˆ
                                                
                                             
                                          
                                          
                                             v
                                          
                                          
                                             c
                                          
                                       
                                    . As a result, the piping component 
                                       v
                                     is labeled as a tampered component which means that its joint piping components are modified.

This kind of attack alters the topological relation of attacked components logically while keeping their geometrical positions constant. In general, there are two kinds of logical topological attacks. One is that of disconnecting two joint components logically. The other is that of disconnecting a component from its joint component and then connecting it with another component. All these attacks will change the set of joint piping components or the set of joint pipes of the attacked component. As discussed above, for a certain attacked piping component 
                              v
                           , these topological modifications will then lead to the alternation of its key 
                              
                                 
                                    K
                                 
                                 
                                    v
                                 
                                 
                                    c
                                 
                              
                            or 
                              
                                 
                                    K
                                 
                                 
                                    v
                                 
                                 
                                    p
                                 
                              
                           . Consequently, this will give rise to the difference between 
                              
                                 
                                    w
                                 
                                 
                                    v
                                 
                                 
                                    c
                                 
                              
                            and 
                              
                                 
                                    
                                       
                                          w
                                       
                                       
                                          ˆ
                                       
                                    
                                 
                                 
                                    v
                                 
                                 
                                    c
                                 
                              
                            or the difference between 
                              
                                 
                                    w
                                 
                                 
                                    v
                                 
                                 
                                    p
                                 
                              
                            and 
                              
                                 
                                    
                                       
                                          w
                                       
                                       
                                          ˆ
                                       
                                    
                                 
                                 
                                    v
                                 
                                 
                                    p
                                 
                              
                           . Therefore, those attacked components can be detected and located accurately.


                           Fig. 16
                            shows examples of various topological attacks on both piping components and pipes. The original drawing and its topological graph are shown in Fig. 16(a) and Fig. 16(c) respectively. We first disconnect 
                              
                                 
                                    v
                                 
                                 
                                    4
                                 
                              
                            from its joint pipes logically while keeping their geometrical positions unchanged. Then, a new piping component 
                              
                                 
                                    v
                                 
                                 
                                    21
                                 
                              
                            is added as the joint piping component of 
                              
                                 
                                    v
                                 
                                 
                                    6
                                 
                              
                            and a new pipe is added and connected with a tee 
                              
                                 
                                    v
                                 
                                 
                                    11
                                 
                              
                           . Finally, the pipe between 
                              
                                 
                                    v
                                 
                                 
                                    13
                                 
                              
                            and 
                              
                                 
                                    v
                                 
                                 
                                    14
                                 
                              
                            is deleted and the piping component 
                              
                                 
                                    v
                                 
                                 
                                    20
                                 
                              
                            is also deleted from the drawing. The tamper detection and localization results are illustrated in Fig. 16(b) and Fig. 16(d) visually. The piping components highlighted in red indicate that both their joint piping components and joint pipes are changed. The green piping components suggest that their joint piping components are alerted, and the blue piping component advises that its joint pipes are modified. Taking the piping component 
                              
                                 
                                    v
                                 
                                 
                                    14
                                 
                              
                            for example, the deletion of one of its joint pipes leads to the modification of its topological relation. Thus, its keys 
                              
                                 
                                    K
                                 
                                 
                                    
                                       
                                          v
                                       
                                       
                                          14
                                       
                                    
                                 
                                 
                                    c
                                 
                              
                            and 
                              
                                 
                                    K
                                 
                                 
                                    
                                       
                                          v
                                       
                                       
                                          14
                                       
                                    
                                 
                                 
                                    p
                                 
                              
                            computed based on the topological graph of the attacked drawing are then alerted. Consequently, generated watermarks are different from the embedded ones. Therefore, 
                              
                                 
                                    v
                                 
                                 
                                    14
                                 
                              
                            is set to be suspicious and highlighted in red.

@&#CONCLUSION@&#

In this paper, we study the problem of authenticating the topology integrity of piping isometric drawings, where the dimensions and locations of individual components can be revised while keeping their topological relation unchanged. The digital watermarking technique is introduced and a semi-fragile watermarking scheme has been proposed. The authentication power of the scheme is achieved by encoding the topological relation among joint components into watermarks based on the constructed topological graph, and these watermarks are then embedded into the constructed geometric invariants of each piping component. The proposed scheme is proved to be robust against various non-malicious attacks especially local similarity transformations and the stretching operation. It is believed that the proposed technique can be easily employed by designers and companies to share drawings with their collaborators and customers by authenticating and safeguarding the topology integrity of drawings derived from the model individually.

In future, we want to further improve the performance of the authentication scheme to get a better tamper localization accuracy. Currently, if an existing component is replaced by a new one of the same kind while retains its topological relation, our scheme will still label it as tampered. In addition, the proposed scheme may fail to locate the exact tampered components from the labeled suspicious ones in certain cases. It is better to narrow the scope of suspicious components as far as possible to improve the practicability of the scheme.

@&#ACKNOWLEDGMENTS@&#

The authors would like to thank the anonymous reviewers for their valuable comments and suggestions to improve the quality of the paper. They are also grateful to Beijing Zhongke Fulong Computer Technology Co., Ltd for the piping isometrics used in this paper. This work is supported by the National Natural Science Foundation of China (61300160, 61103201, 61170250) and Project of Jiangsu Agricultural Science and Technology Innovation Fund (CX(12)5087).

@&#REFERENCES@&#

