@&#MAIN-TITLE@&#Valid inequalities for the synchronization bus timetabling problem

@&#HIGHLIGHTS@&#


               
               
                  
                     
                        
                           
                           The SBTP favors passenger transfers and avoids congestion of buses at common stops.


                        
                        
                           
                           Four classes of valid inequalities for its MIP using combinatorial properties.


                        
                        
                           
                           The enhanced MIP yields high quality solutions using short computational times.


                        
                        
                           
                           Realistic instances are solved within few minutes with a 3 percent deviation from the optimum.


                        
                     
                  
               
            

@&#KEYPHRASES@&#

Integer programming

Transportation

Timetabling

Valid inequalities

Urban bus system

@&#ABSTRACT@&#


               
               
                  Bus transit network planning is a complex process that is divided into several phases such as: line planning, timetable generation, vehicle scheduling, and crew scheduling. In this work, we address the timetable generation which consists in scheduling the departure times for all trips of each bus line. We focus on the Synchronization Bus Timetabling Problem (SBTP) that favors passenger transfers and avoids congestion of buses at common stops. A Mixed Integer Program (MIP) was proposed in the literature for the SBTP but it fails to solve real bus network instances. We develop in this paper four classes of valid inequalities for this MIP using combinatorial properties of the SBTP on the number of synchronizations. Experimental results show that large instances are solved within few minutes with a relative deviation from the optimal solution that is usually less than 3 percent.
               
            

@&#INTRODUCTION@&#

Planning and operating a public transportation network in a relatively big city (3 millions people) is an enormous task if the aim is to reduce the costs without degrading the level of service for the users. The bus transit network planning problem is presented as a sequence of four main phases (Ceder, 2007; Ibarra-Rojas, Delgado, Giesen, & Muñoz, 2015a). The first one is the line planning phase that defines the routes, stops, and frequency for each bus line in a specific territory. Then, the timetable generation phase determines the departure times of all the trips of the lines to achieve a specific level of service. The third subproblem is the vehicle scheduling phase that assigns vehicles to trips associated to bus lines. Finally, the crew scheduling phase defines tasks assigned to drivers. The bus transit network planning problem is commonly tackled by sequential approaches. Therefore, obtaining high quality solutions in short time for each phase is an important issue since it is often necessary to iterate several times to find a suitable solution for the entire planning process.

In this paper, we focus on bus networks having the following characteristics. The passengers of a line have an estimate of their waiting time at each stop rather than knowing the whole timetable of the line. Therefore, regularly spaced departure times for the trips of each line are required. Moreover, since different lines frequently converge at specific stops of the network, it is necessary to reduce congestion to improve the level of service. In the sequel, a synchronization occurs when the timetable avoids that two buses arrive at a stop at the same time or when it permits well timed transfers for passengers, i.e. transfers that ensure both short waiting times and enough time to change from one line to another. Therefore, the Synchronization Bus Timetabling Problem (SBTP) consists in determining the departure time of every bus trip in order to maximize the synchronization of different bus lines of a network. Thus, the SBTP corresponds exactly to the timetable generation phase for networks that appear in different cities of Latin America, as for instance, the network of the city of Monterrey in Mexico which has more than 300 bus lines.


                     Ibarra-Rojas and Rios-Solis (2012) have proved that the SBTP is NP-hard. They have proposed a multi-start iterated local search algorithm and a MIP. We denote by SBTP MIP this formulation that will be described in Section 2. However, the SBTP MIP solved using a standard linear solver (CPLEX 12.6) has not succeeded in efficiently solving realistic instances within reasonable CPU times. Since the number of disruptions such as bus failures or crash accidents, is close to 10 percent of the vehicles used per day (in Monterrey), bus timetables may be recomputed several times a day. Consequently, heuristic methods are usually used to quickly produce timetables. Ibarra-Rojas, López-Irarragorri, and Rios-Solis (2015b) extend the heuristics presented by Ibarra-Rojas and Rios-Solis (2012) to solve the multiperiod case. However, heuristic methods do not ensure any guarantee on the solution quality.

Particular cases of the SBTP have been considered in the literature. Ceder and Tal (2001) and Ceder (2011) have introduced a simpler version of the SBTP where synchronizations are defined as simultaneous arrivals at common stops subject to bound constraints on the the separation time between consecutive trips of the same line. Constructive algorithms were developed for this case. An extension of Ceder’s studies is presented by Eranki (2004) where a synchronization is redefined as arrivals within a time window. Liu, Shen, Wang, and Yang (2007) have reformulated the timetabling problem presented by Ceder, Golany, and Tal (2001) and implemented a Tabu search to solve the problem.

Some closely related problems on transport networks have been studied using integer programming approaches. We can quote the scholar bus scheduling problem introduced by Fügenschuh (2009) where starting times of schools and starting times of scholar buses must be synchronized to minimize the number of vehicles to transport all students. The authors have developed different families of valid inequalities leading to a branch-and-cut algorithm. Quadrifoglio, Dessouky, and Ordóñez (2008) optimized a weighted objective function based on vehicle resources and level of service for a transport network. They define logic constraints to reduce the feasible space which allows to reduce up to 90 percent of the CPU time when these cuts are added at the beginning of a branch-and-bound algorithm. In railway systems, timetabling problems have been extensively studied using integer programming techniques. In particular, the periodic timetabling case has a special structure (not present in the SBTP) that favors the design of valid inequalities commonly implemented in branch-and-cut algorithms (Caimi, Fuchsberger, Laumanns, and Schüpbach, 2011; Giesemann, 2002; Liebchen, 2004, 2007; Liebchen and Möhring, 2002, 2007; Schröder and Solchenbach, 2006). Comprehensive reviews are provided by Guihaire and Hao (2008), Cacchiani and Toth (2012), and Ibarra-Rojas et al. (2015a).

In this paper, we present an exact approach to solve the SBTP using integer programming techniques and show that high quality solutions can be produced for real size instances within a few minutes. An inequality is said to be valid for a MIP if every solution of the MIP satisfies this inequality. Consequently, a valid inequality can be added to a MIP in order to obtain a stronger formulation (Wolsey, 1998) that will be easier to solve. Our main contributions are to define four families of valid inequalities that will be used for the SBTP MIP. The first two families of valid inequalities bound the number of possible synchronizations that can occur at a node for a specific trip. The two other families are obtained from the previous ones using a generic lifting procedure. The enhanced SBTP MIP is then solved with a standard linear solver to obtain optimal solutions for most of the realistic instances. Moreover, for all the instances, solutions with less than 3 percent of deviation from the optimum are found in less than five minutes.

A main insight of our proposed methodology that it can be used as a heuristic to obtain high quality solutions with short computation times. Indeed, the SBTP strengthen with our valid inequalities can be solved with a linear solver that has a stopping criterion of 3 percent of relative gap. This approach outperforms the multi-start iterated local search algorithm presented by Ibarra-Rojas et al. (2015b).

The rest of the paper is organized as follows. In Section 2, we briefly recall the SBTP MIP that we will enhance with our proposed valid inequalities that are defined in Section 3. Experimental results are presented in Section 4 where we show the impact of some combination of the valid inequalities families. Finally, conclusions and future research areas are addressed in Section 5.

In this section, we present the SBTP and its mixed integer program proposed by Ibarra-Rojas and Rios-Solis (2012). First, we will introduce the problem assumptions. Secondly, we will discuss the concept of synchronization. Finally, we will address the optimization problem and its mathematical formulation.

The given transit network is defined with a set I of transit lines and a set of nodes B which represents the stops (or zones) where synchronization of different lines is needed to allow well timed passenger transfers or diminish traffic congestion. Let T be the planning horizon defined in time units. We denote by fi
                         the frequency of line i ∈ I in the given planning period, that is to say the number of trips that have to be scheduled within T for line i. We assume that buses of the same line will run at regular speed and we denote by 
                           
                              
                                 t
                                 b
                                 i
                              
                              ,
                           
                         
                        i ∈ I, the travel time for a bus from an initial node, called depot, to a node b ∈ B.

In the context of transit systems, the headway refers to the separation time between consecutive trips of the same line (Ceder, 2007; Ceder & Tal, 2001). For example, if the first trip of a line departs at time unit 3 and the second trip of the same line departs at time 23, the headway between these two trips is of 20 time units. In our case, providing a regular service is important for transit operators and passengers thus, each trip of a line i of I will start every 
                           
                              
                                 T
                                 
                                    f
                                    i
                                 
                              
                           
                         time units with a flexibility of δi
                         time units. Consequently, 
                           
                              
                                 
                                    h
                                    i
                                 
                                 =
                                 
                                    T
                                    
                                       f
                                       i
                                    
                                 
                                 −
                                 
                                    δ
                                    i
                                 
                              
                           
                         (resp. 
                           
                              
                                 
                                    H
                                    i
                                 
                                 =
                                 
                                    T
                                    
                                       f
                                       i
                                    
                                 
                                 +
                                 
                                    δ
                                    i
                                 
                              
                           
                        ) is the minimum (resp. maximum) headway time for a line i ∈ I. Fig. 1
                         illustrates the departure times for a given line i of frequency 
                           
                              
                                 f
                                 i
                              
                              =
                              4
                           
                         with and without flexibility.

In a regular timetable with constant headways, well timed transfers would occur by chance while in a timetable with flexible headways, one can induce more well timed synchronizations.

Another important aspect of the transit system operation is to guarantee that the entire planning horizon is covered by trips. To achieve this, the first (resp. last) trip of line i must start before Hi
                         (resp. after 
                           
                              T
                              −
                              
                                 H
                                 i
                              
                           
                        ). Considering the previous definitions and assumptions, a timetable given by the departure times 
                           
                              X
                              p
                              i
                           
                         of each trip 
                           
                              p
                              ∈
                              {
                              1
                              ,
                              ⋯
                              ,
                              
                                 f
                                 i
                              
                              }
                           
                         of every line i ∈ I will satisfy the following: i) 
                           
                              
                                 X
                                 1
                                 i
                              
                              ≤
                              
                                 H
                                 i
                              
                           
                         for every i ∈ I; ii) 
                           
                              
                                 h
                                 i
                              
                              ≤
                              
                                 X
                                 
                                    p
                                    +
                                    1
                                 
                                 i
                              
                              −
                              
                                 X
                                 p
                                 i
                              
                              ≤
                              
                                 H
                                 i
                              
                           
                         for every i ∈ I and 
                           
                              p
                              ∈
                              {
                              1
                              ,
                              ⋯
                              ,
                              
                                 f
                                 i
                              
                              −
                              1
                              }
                           
                        ; and iii) 
                           
                              T
                              −
                              
                                 H
                                 i
                              
                              ≤
                              
                                 X
                                 
                                    f
                                    i
                                 
                                 i
                              
                              ≤
                              T
                           
                         for every i ∈ I.

We recall that our goal is to synchronize different transit lines in order to benefit passenger transfers and to reduce congestion of buses at common stops. Then, we consider two types of synchronization nodes. A transfer node is a stop or zone in the network where passengers may transfer from one line i to some line j. To allow well timed passenger transfers at node b, the difference between two bus arrivals at this node has to be lower than a specific value denoted Wb
                        . Moreover, a minimum waiting time wb
                         is defined for passengers who need to walk to board line j in order to avoid ”too short transfer”. A congestion node is a stop or a particular point in the network where different lines start a common route segment, and the congestion level at this node could be reduced if trips are properly separated. Consequently, to reduce congestion of buses at node b, the length of the time interval between two bus arrivals at node b has to be greater than a specific value denoted wb
                        . In this case, it is convenient to consider a maximum separation time Wb
                         between the bus arrivals at node b such that 
                           
                              
                                 W
                                 b
                              
                              −
                              
                                 w
                                 b
                              
                              <
                              
                                 h
                                 j
                              
                           
                        .

A synchronization of two trips at node b happens if the difference of their arrival times is in the so-called waiting time window [wb, Wb
                        ]. For each line i ∈ I, let us denote by I(i) the set of lines that share a synchronization node with line i. Notice that for i, j ∈ I, j ∈ I(i) does not imply i ∈ I(j). Indeed, it could be desirable in some situations to enforce the passenger transfers only from line i to line j. As an illustration, Fig. 2
                         shows synchronization events between lines i and j at the two types of nodes representing specific zones of the transit network in Monterrey, Mexico. The numbers by the side of node b represent the arrival times of a trip of lines i and j. A transfer zone can be represented by a transfer node b where passengers need to walk in order to go from one trip of line i to some trip of line j. In this case, 5 time units is the maximum desired passenger waiting time and 2 time units is the minimum waiting time to avoid too short transfer. Then, the waiting time window is given by 
                           
                              
                                 [
                                 
                                    w
                                    b
                                 
                                 ,
                                 
                                    W
                                    b
                                 
                                 ]
                              
                              =
                              
                                 [
                                 2
                                 ,
                                 7
                                 ]
                              
                              ,
                           
                         and arrival times 8:35 and 8:38 of trips of lines i and j, respectively, define a well timed transfer from i to j . Zones in the central business district of Monterrey’s transit network could be represented by a congestion node b where lines i and j converge and then share a segment of their routes. The minimum and maximum separation times to reduce congestion at this node b are 
                           
                              
                                 w
                                 b
                              
                              =
                              6
                           
                         and 
                           
                              
                                 W
                                 b
                              
                              =
                              12
                           
                         which are satisfied by the actual separation between trips of lines i and j arriving at 8:14 and 8:20, respectively.

We highlight that the set of synchronization nodes does not necessarily include all intersecting points for each pair of lines. Instead, synchronization nodes are stops or zones in the transit network where the synchronization of different lines has a high impact on the transit system operation. For example, transfer nodes could represent convergence points for trunk and feeder lines, while congestion nodes could model the beginning of common route segments of lines. By selecting the nodes regarding their average number of passengers, the demand over the network is then considered. This number, denoted by 
                           
                              
                                 N
                                 b
                                 
                                    i
                                    j
                                 
                              
                              ,
                           
                         represents the number of passengers that will benefit of the synchronization of lines i and j at node b.

On the basis of the above, the SBTP determines the departure times 
                           
                              X
                              p
                              i
                           
                         of each trip p ∈ {1, ..., fi
                        } of every line i ∈ I such that the headway time bounds are satisfied, 
                           
                              
                                 X
                                 1
                                 i
                              
                              ≤
                              
                                 H
                                 i
                              
                              ,
                           
                        
                        
                           
                              
                                 h
                                 i
                              
                              ≤
                              
                                 X
                                 
                                    p
                                    +
                                    1
                                 
                                 i
                              
                              −
                              
                                 X
                                 p
                                 i
                              
                              ≤
                              
                                 H
                                 i
                              
                           
                         for every i ∈ I, 
                           
                              T
                              −
                              
                                 H
                                 i
                              
                              ≤
                              
                                 X
                                 
                                    f
                                    i
                                 
                                 i
                              
                              ≤
                              T
                           
                        . Two trips p ∈ {1,…, fi
                        } and q ∈ {1,…, fj
                        } will then be synchronized at node b if 
                           
                              
                                 w
                                 b
                              
                              ≤
                              
                                 (
                                 
                                    X
                                    q
                                    j
                                 
                                 +
                                 
                                    t
                                    b
                                    j
                                 
                                 )
                              
                              −
                              
                                 (
                                 
                                    X
                                    p
                                    i
                                 
                                 +
                                 
                                    t
                                    b
                                    i
                                 
                                 )
                              
                              ≤
                              
                                 W
                                 b
                              
                           
                         is satisfied, for i ∈ I, j ∈ I(i). The objective is to maximize the weighted sum of the number of synchronized pairs of trips at node b, where the weights correspond to the number 
                           
                              N
                              b
                              
                                 i
                                 j
                              
                           
                         of passengers.

We consider in the following an instance of SBTP. For a given line i ∈ I, we will denote by (p, i), 
                           
                              p
                              ∈
                              {
                              1
                              ,
                              ⋯
                              ,
                              
                                 f
                                 i
                              
                              }
                              ,
                           
                         the p
                        th trip of line i and we associate to (p, i) the real variable 
                           
                              X
                              p
                              i
                           
                         that represents its departure time. For a pair of lines (i, j), j ∈ I(i), the set Bij
                         is the set of all the synchronization nodes shared by i and j. The binary decision variable 
                           
                              Y
                              
                                 p
                                 q
                                 b
                              
                              
                                 i
                                 j
                              
                           
                         is equal to 1, if and only if, trip (p, i) arrives first at node b and if trips (p, i) and (q, j) induce a synchronization at node b. In the sequel, we will denote by (X, Y) a solution of an SBTP instance.

Considering the previous parameters and decision variables, the SBTP MIP is given by

                           
                              
                                 
                                    max
                                    
                                       ∑
                                       
                                          i
                                          ∈
                                          I
                                       
                                    
                                    
                                       ∑
                                       
                                          j
                                          ∈
                                          I
                                          (
                                          i
                                          )
                                       
                                    
                                    
                                       ∑
                                       
                                          b
                                          ∈
                                          
                                             B
                                             
                                                i
                                                j
                                             
                                          
                                       
                                    
                                    
                                       N
                                       b
                                       
                                          i
                                          j
                                       
                                    
                                    
                                       ∑
                                       
                                          p
                                          =
                                          1
                                       
                                       
                                          f
                                          i
                                       
                                    
                                    
                                       ∑
                                       
                                          q
                                          =
                                          1
                                       
                                       
                                          f
                                          j
                                       
                                    
                                    
                                       Y
                                       
                                          p
                                          q
                                          b
                                       
                                       
                                          i
                                          j
                                       
                                    
                                 
                              
                           
                        
                        
                           
                              (1)
                              
                                 
                                    
                                       
                                          
                                             s.t.
                                             
                                             
                                                X
                                                1
                                                i
                                             
                                             ≤
                                             
                                                H
                                                i
                                             
                                             
                                             i
                                             ∈
                                             I
                                          
                                       
                                    
                                 
                              
                           
                        
                        
                           
                              (2)
                              
                                 
                                    
                                       
                                          
                                             T
                                             −
                                             
                                                H
                                                i
                                             
                                             ≤
                                             
                                                X
                                                
                                                   f
                                                   i
                                                
                                                i
                                             
                                             ≤
                                             T
                                             
                                             i
                                             ∈
                                             I
                                          
                                       
                                    
                                 
                              
                           
                        
                        
                           
                              (3)
                              
                                 
                                    
                                       
                                          
                                             
                                                h
                                                i
                                             
                                             ≤
                                             
                                                X
                                                
                                                   p
                                                   +
                                                   1
                                                
                                                i
                                             
                                             −
                                             
                                                X
                                                p
                                                i
                                             
                                             ≤
                                             
                                                H
                                                i
                                             
                                             
                                             i
                                             ∈
                                             I
                                             ,
                                             
                                             p
                                             =
                                             1
                                             ,
                                             ⋯
                                             ,
                                             
                                                f
                                                i
                                             
                                             −
                                             1
                                          
                                       
                                    
                                 
                              
                           
                        
                        
                           
                              (4)
                              
                                 
                                    
                                       
                                       
                                       
                                          
                                             
                                                (
                                                
                                                   X
                                                   q
                                                   j
                                                
                                                +
                                                
                                                   t
                                                   b
                                                   j
                                                
                                                )
                                             
                                             −
                                             
                                                (
                                                
                                                   X
                                                   p
                                                   i
                                                
                                                +
                                                
                                                   t
                                                   b
                                                   i
                                                
                                                )
                                             
                                             ≥
                                             
                                                w
                                                b
                                             
                                             −
                                             M
                                             
                                                (
                                                1
                                                −
                                                
                                                   Y
                                                   
                                                      p
                                                      q
                                                      b
                                                   
                                                   
                                                      i
                                                      j
                                                   
                                                
                                                )
                                             
                                             
                                             i
                                             ∈
                                             I
                                             ,
                                             
                                             j
                                             ∈
                                             I
                                             
                                                (
                                                i
                                                )
                                             
                                             ,
                                             
                                             b
                                             ∈
                                             
                                                B
                                                
                                                   i
                                                   j
                                                
                                             
                                             ,
                                          
                                       
                                    
                                    
                                       
                                       
                                       
                                          
                                             
                                             p
                                             =
                                             1
                                             ,
                                             ⋯
                                             ,
                                             
                                                f
                                                i
                                             
                                             ,
                                             
                                             q
                                             =
                                             1
                                             ,
                                             ⋯
                                             ,
                                             
                                                f
                                                j
                                             
                                          
                                       
                                    
                                 
                              
                           
                        
                        
                           
                              (5)
                              
                                 
                                    
                                       
                                       
                                       
                                          
                                             
                                                (
                                                
                                                   X
                                                   q
                                                   j
                                                
                                                +
                                                
                                                   t
                                                   b
                                                   j
                                                
                                                )
                                             
                                             −
                                             
                                                (
                                                
                                                   X
                                                   p
                                                   i
                                                
                                                +
                                                
                                                   t
                                                   b
                                                   i
                                                
                                                )
                                             
                                             ≤
                                             
                                                W
                                                b
                                             
                                             +
                                             M
                                             
                                                (
                                                1
                                                −
                                                
                                                   Y
                                                   
                                                      p
                                                      q
                                                      b
                                                   
                                                   
                                                      i
                                                      j
                                                   
                                                
                                                )
                                             
                                             
                                             i
                                             ∈
                                             I
                                             ,
                                             
                                             j
                                             ∈
                                             I
                                             
                                                (
                                                i
                                                )
                                             
                                             ,
                                             
                                             b
                                             ∈
                                             
                                                B
                                                
                                                   i
                                                   j
                                                
                                             
                                             ,
                                          
                                       
                                    
                                    
                                       
                                       
                                       
                                          
                                             
                                             p
                                             =
                                             1
                                             ,
                                             ⋯
                                             ,
                                             
                                                f
                                                i
                                             
                                             ,
                                             
                                             q
                                             =
                                             1
                                             ,
                                             ⋯
                                             ,
                                             
                                                f
                                                j
                                             
                                          
                                       
                                    
                                 
                              
                           
                        
                        
                           
                              (6)
                              
                                 
                                    
                                       
                                       
                                       
                                          
                                             
                                                X
                                                p
                                                i
                                             
                                             ∈
                                             R
                                             
                                             i
                                             ∈
                                             I
                                             ,
                                             p
                                             =
                                             1
                                             ,
                                             ⋯
                                             ,
                                             
                                                f
                                                i
                                             
                                          
                                       
                                    
                                    
                                       
                                       
                                       
                                          
                                             
                                             
                                                Y
                                                
                                                   p
                                                   q
                                                   b
                                                
                                                
                                                   i
                                                   j
                                                
                                             
                                             ∈
                                             
                                                {
                                                0
                                                ,
                                                1
                                                }
                                             
                                             
                                             i
                                             ∈
                                             I
                                             ,
                                             
                                             j
                                             ∈
                                             I
                                             
                                                (
                                                i
                                                )
                                             
                                             ,
                                             
                                             b
                                             ∈
                                             
                                                B
                                                
                                                   i
                                                   j
                                                
                                             
                                             ,
                                          
                                       
                                    
                                    
                                       
                                       
                                       
                                          
                                             
                                             p
                                             =
                                             1
                                             ,
                                             ⋯
                                             ,
                                             
                                                f
                                                i
                                             
                                             ,
                                             
                                             q
                                             =
                                             1
                                             ,
                                             ⋯
                                             ,
                                             
                                                f
                                                j
                                             
                                          
                                       
                                    
                                 
                              
                           
                        
                     

The objective function maximizes the total weighted number of synchronizations. Constraints (1) and (2) guarantee that the entire planning horizon is covered by the trips together with Constraints (3) which impose that consecutive trips of line i must happen with a minimum (resp. maximum) headway time hi
                         (resp. Hi
                        ). Remark that the arrival time of trip (p, i) at node b is 
                           
                              
                                 X
                                 p
                                 i
                              
                              +
                              
                                 t
                                 b
                                 i
                              
                           
                        . Hence Constraints (4) and (5) activate the synchronization variables 
                           
                              Y
                              
                                 p
                                 q
                                 b
                              
                              
                                 i
                                 j
                              
                           
                         if the difference between the arrival times of (p, i) and (q, j) at node b is within [wb, Wb
                        ] with (p, i) arriving first at node b.

In the following, we propose a way to define a tight value for constant M for computational purposes. Note that departure times 
                           
                              X
                              p
                              i
                           
                         are within a feasible time window given by

                           
                              
                                 
                                    
                                       
                                          
                                             
                                                [
                                                
                                                   
                                                      d
                                                      ̲
                                                   
                                                   p
                                                   i
                                                
                                                ,
                                                
                                                   
                                                      d
                                                      ¯
                                                   
                                                   p
                                                   i
                                                
                                                ]
                                             
                                             
                                             with
                                             
                                          
                                       
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         
                                                            d
                                                            ̲
                                                         
                                                         p
                                                         i
                                                      
                                                      =
                                                      max
                                                      
                                                         {
                                                         
                                                            (
                                                            p
                                                            −
                                                            1
                                                            )
                                                         
                                                         
                                                            h
                                                            i
                                                         
                                                         ,
                                                         T
                                                         −
                                                         
                                                            (
                                                            
                                                               f
                                                               i
                                                            
                                                            −
                                                            
                                                               (
                                                               p
                                                               −
                                                               1
                                                               )
                                                            
                                                            )
                                                         
                                                         
                                                            H
                                                            i
                                                         
                                                         }
                                                      
                                                   
                                                
                                             
                                             
                                                
                                                   
                                                      
                                                         
                                                            d
                                                            ¯
                                                         
                                                         p
                                                         i
                                                      
                                                      =
                                                      min
                                                      
                                                         {
                                                         p
                                                         
                                                            H
                                                            i
                                                         
                                                         ,
                                                         T
                                                         −
                                                         
                                                            (
                                                            
                                                               f
                                                               i
                                                            
                                                            −
                                                            p
                                                            )
                                                         
                                                         
                                                            h
                                                            i
                                                         
                                                         }
                                                      
                                                      .
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           
                        Therefore, the minimum difference of arrival times between trips (q, j) and (p, i) at node b is 
                           
                              
                                 
                                    d
                                    ¯
                                 
                                 p
                                 i
                              
                              +
                              
                                 t
                                 b
                                 i
                              
                              −
                              
                                 
                                    d
                                    ̲
                                 
                                 q
                                 j
                              
                              −
                              
                                 t
                                 b
                                 j
                              
                           
                        . Consequently, given a solution 
                           
                              (
                              
                                 X
                                 ˜
                              
                              ,
                              
                                 Y
                                 ˜
                              
                              )
                           
                         of the SBTP, we know that

                           
                              
                                 
                                    
                                       (
                                       
                                          
                                             X
                                             ˜
                                          
                                          
                                             q
                                             b
                                          
                                          j
                                       
                                       +
                                       
                                          t
                                          b
                                          j
                                       
                                       )
                                    
                                    −
                                    
                                       (
                                       
                                          
                                             X
                                             ˜
                                          
                                          
                                             p
                                             b
                                          
                                          i
                                       
                                       +
                                       
                                          t
                                          b
                                          i
                                       
                                       )
                                    
                                    ≥
                                    
                                       
                                          d
                                          ¯
                                       
                                       p
                                       i
                                    
                                    +
                                    
                                       t
                                       b
                                       i
                                    
                                    −
                                    
                                       
                                          d
                                          ̲
                                       
                                       q
                                       j
                                    
                                    −
                                    
                                       t
                                       b
                                       j
                                    
                                    .
                                 
                              
                           
                        Similarly, we can remark that the maximum difference of arrival times between trips (q, j) and (p, i) at node b satisfies the following inequality.

                           
                              
                                 
                                    
                                       (
                                       
                                          
                                             X
                                             ˜
                                          
                                          
                                             q
                                             b
                                          
                                          j
                                       
                                       +
                                       
                                          t
                                          b
                                          j
                                       
                                       )
                                    
                                    −
                                    
                                       (
                                       
                                          
                                             X
                                             ˜
                                          
                                          
                                             p
                                             b
                                          
                                          i
                                       
                                       +
                                       
                                          t
                                          b
                                          i
                                       
                                       )
                                    
                                    ≤
                                    
                                       
                                          d
                                          ¯
                                       
                                       q
                                       j
                                    
                                    +
                                    
                                       t
                                       b
                                       j
                                    
                                    −
                                    
                                       
                                          d
                                          ̲
                                       
                                       p
                                       i
                                    
                                    −
                                    
                                       t
                                       b
                                       j
                                    
                                    .
                                 
                              
                           
                        Then, we can replace M by 
                           
                              
                                 m
                                 
                                    p
                                    q
                                    b
                                 
                                 
                                    i
                                    j
                                 
                              
                              =
                              
                                 
                                    d
                                    ¯
                                 
                                 p
                                 i
                              
                              +
                              
                                 t
                                 b
                                 i
                              
                              −
                              
                                 
                                    d
                                    ̲
                                 
                                 q
                                 j
                              
                              −
                              
                                 t
                                 b
                                 j
                              
                           
                         and 
                           
                              
                                 M
                                 
                                    p
                                    q
                                    b
                                 
                                 
                                    i
                                    j
                                 
                              
                              =
                              
                                 
                                    d
                                    ¯
                                 
                                 q
                                 j
                              
                              +
                              
                                 t
                                 b
                                 j
                              
                              −
                              
                                 
                                    d
                                    ̲
                                 
                                 p
                                 i
                              
                              −
                              
                                 t
                                 b
                                 j
                              
                           
                         in Constraints (4) and (5) for indices (i, j, p, q, b) ∈ ξ, respectively.

The SBTP MIP cannot be used to solve realistic instances of the SBTP using a standard linear programming solver (see Ibarra-Rojas & Rios-Solis, 2012). The main contributions of this paper is to strengthen SBTP MIP by introducing valid inequalities that allow to efficiently solve the real size instances of the SBTP.

To obtain tighter formulations for the SBTP, we add valid inequalities to the SBTP MIP before its resolution by a linear programming solver. In fact, adding valid inequalities permits to cut fractional solutions of the linear relaxations of integer programs or to cut non-optimal feasible solutions (Nemhauser and Wolsey (1999); Wolsey (1998)). In the following, we introduce two families of valid inequalities for the synchronization bus timetabling problem obtained from the headway time parameters and the propagation of Constraints (1), (2), and (3).

We can take advantage of the headway time parameters to define a family of valid inequalities for each trip to be synchronized. Let us consider two lines i and j to be synchronized at a given node b such that the minimum headway time hj
                         of line j is greater than the length of the waiting time window of node b, i.e., 
                           
                              
                                 h
                                 j
                              
                              >
                              
                                 W
                                 b
                              
                              −
                              
                                 w
                                 b
                              
                           
                        . If a trip (p, i) synchronizes with another trip (q, j), the synchronization of (p, i) with trips 
                           
                              (
                              q
                              −
                              1
                              ,
                              j
                              )
                           
                         or 
                           
                              (
                              q
                              +
                              1
                              ,
                              j
                              )
                           
                         is impossible since there would not be enough time units to ensure solution feasibility. Generalizing the previous idea, we obtain the following result.

                           Theorem 1
                           
                              The inequalities 
                              
                                 (7)
                               
                              and 
                              
                                 (8)
                              
                              , called synchronization inequalities, are valid for the SBTP MIP.
                              
                                 
                                    (7)
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      ∑
                                                      
                                                         q
                                                         =
                                                         1
                                                      
                                                      
                                                         f
                                                         j
                                                      
                                                   
                                                   
                                                      Y
                                                      
                                                         p
                                                         q
                                                         b
                                                      
                                                      
                                                         i
                                                         j
                                                      
                                                   
                                                   ≤
                                                   1
                                                   +
                                                   
                                                      ⌊
                                                      
                                                         
                                                            
                                                               W
                                                               b
                                                            
                                                            −
                                                            
                                                               w
                                                               b
                                                            
                                                         
                                                         
                                                            h
                                                            j
                                                         
                                                      
                                                      ⌋
                                                   
                                                
                                             
                                             
                                                
                                                   i
                                                   ∈
                                                   I
                                                   ,
                                                   j
                                                   ∈
                                                   I
                                                   
                                                      (
                                                      i
                                                      )
                                                   
                                                   ,
                                                   b
                                                   ∈
                                                   
                                                      B
                                                      
                                                         i
                                                         j
                                                      
                                                   
                                                   ,
                                                   p
                                                   ∈
                                                   
                                                      {
                                                      1
                                                      ,
                                                      ⋯
                                                      ,
                                                      
                                                         f
                                                         i
                                                      
                                                      }
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                              
                              
                                 
                                    (8)
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      ∑
                                                      
                                                         p
                                                         =
                                                         1
                                                      
                                                      
                                                         f
                                                         i
                                                      
                                                   
                                                   
                                                      Y
                                                      
                                                         p
                                                         q
                                                         b
                                                      
                                                      
                                                         i
                                                         j
                                                      
                                                   
                                                   ≤
                                                   1
                                                   
                                                   +
                                                   
                                                   
                                                      ⌊
                                                      
                                                         
                                                            
                                                               W
                                                               b
                                                            
                                                            −
                                                            
                                                               w
                                                               b
                                                            
                                                         
                                                         
                                                            h
                                                            i
                                                         
                                                      
                                                      ⌋
                                                   
                                                
                                             
                                             
                                                
                                                   i
                                                   ∈
                                                   I
                                                   ,
                                                   j
                                                   ∈
                                                   I
                                                   
                                                      (
                                                      i
                                                      )
                                                   
                                                   ,
                                                   b
                                                   ∈
                                                   
                                                      B
                                                      
                                                         i
                                                         j
                                                      
                                                   
                                                   ,
                                                   q
                                                   ∈
                                                   
                                                      {
                                                      1
                                                      ,
                                                      ⋯
                                                      ,
                                                      
                                                         f
                                                         j
                                                      
                                                      }
                                                   
                                                   .
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           

We will prove that inequalities (7) are valid, the proof for (8) is analogous. Let us suppose that there exists a feasible solution 
                                 
                                    (
                                    
                                       X
                                       ˜
                                    
                                    ,
                                    
                                       Y
                                       ˜
                                    
                                    )
                                 
                               of the SBTP, a trip (p, i), and a line j ∈ J(i) such that, Constraint (7) is violated, i.e. there exist 
                                 
                                    r
                                    >
                                    1
                                    +
                                    ⌊
                                    
                                       
                                          
                                             W
                                             b
                                          
                                          −
                                          
                                             w
                                             b
                                          
                                       
                                       
                                          h
                                          j
                                       
                                    
                                    ⌋
                                 
                               trips 
                                 
                                    
                                       q
                                       1
                                    
                                    <
                                    
                                       q
                                       2
                                    
                                    <
                                    ⋯
                                    <
                                    
                                       q
                                       r
                                    
                                 
                               of line j that may synchronize with trip (p, i). We will show that it is impossible to schedule these synchronized trips because of the imposed minimal headway times between trips. The arrival times of these trips are within the feasible synchronization time window 
                                 
                                    [
                                    
                                       
                                          X
                                          ˜
                                       
                                       p
                                       i
                                    
                                    +
                                    
                                       t
                                       b
                                       i
                                    
                                    +
                                    
                                       w
                                       b
                                    
                                    ,
                                    
                                       
                                          X
                                          ˜
                                       
                                       p
                                       i
                                    
                                    +
                                    
                                       t
                                       b
                                       i
                                    
                                    +
                                    
                                       W
                                       b
                                    
                                    ]
                                 
                              . Therefore, the difference between the arrival times 
                                 
                                    
                                       
                                          X
                                          ˜
                                       
                                       
                                          q
                                          r
                                       
                                       j
                                    
                                    +
                                    
                                       t
                                       b
                                       i
                                    
                                 
                               and 
                                 
                                    
                                       
                                          X
                                          ˜
                                       
                                       
                                          q
                                          1
                                       
                                       j
                                    
                                    +
                                    
                                       t
                                       b
                                       i
                                    
                                 
                               of trips (q
                              1, j) and (qr, j) must be less than 
                                 
                                    
                                       W
                                       b
                                    
                                    −
                                    
                                       w
                                       b
                                    
                                    ,
                                 
                               consequently we obtain 
                                 
                                    
                                       
                                          X
                                          ˜
                                       
                                       
                                          q
                                          r
                                       
                                       j
                                    
                                    −
                                    
                                       
                                          X
                                          ˜
                                       
                                       
                                          q
                                          1
                                       
                                       j
                                    
                                    ≤
                                    
                                       W
                                       b
                                    
                                    −
                                    
                                       w
                                       b
                                    
                                 
                              . However, since solution 
                                 
                                    (
                                    
                                       X
                                       ˜
                                    
                                    ,
                                    
                                       Y
                                       ˜
                                    
                                    )
                                 
                               corresponds to a regularly spaced schedule, we have that 
                                 
                                    
                                       
                                          X
                                          ˜
                                       
                                       
                                          q
                                          
                                             l
                                             +
                                             1
                                          
                                       
                                       j
                                    
                                    −
                                    
                                       
                                          X
                                          ˜
                                       
                                       
                                          q
                                          l
                                       
                                       j
                                    
                                    ≥
                                    
                                       h
                                       j
                                    
                                 
                              . We then have

                                 
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         X
                                                         ˜
                                                      
                                                      
                                                         q
                                                         r
                                                      
                                                      j
                                                   
                                                   −
                                                   
                                                      
                                                         X
                                                         ˜
                                                      
                                                      
                                                         q
                                                         1
                                                      
                                                      j
                                                   
                                                
                                             
                                             
                                                ≥
                                             
                                             
                                                
                                                   
                                                      (
                                                      r
                                                      −
                                                      1
                                                      )
                                                   
                                                   
                                                      h
                                                      j
                                                   
                                                   ≥
                                                   
                                                      (
                                                      1
                                                      +
                                                      
                                                         ⌊
                                                         
                                                            
                                                               
                                                                  W
                                                                  b
                                                               
                                                               −
                                                               
                                                                  w
                                                                  b
                                                               
                                                            
                                                            
                                                               h
                                                               j
                                                            
                                                         
                                                         ⌋
                                                      
                                                      )
                                                   
                                                   
                                                      h
                                                      j
                                                   
                                                
                                             
                                          
                                          
                                             
                                             
                                                >
                                             
                                             
                                                
                                                   
                                                      (
                                                      1
                                                      +
                                                      
                                                         (
                                                         
                                                            
                                                               
                                                                  W
                                                                  b
                                                               
                                                               −
                                                               
                                                                  w
                                                                  b
                                                               
                                                            
                                                            
                                                               h
                                                               j
                                                            
                                                         
                                                         −
                                                         1
                                                         )
                                                      
                                                      )
                                                   
                                                   
                                                      h
                                                      j
                                                   
                                                   =
                                                   
                                                      W
                                                      b
                                                   
                                                   −
                                                   
                                                      w
                                                      b
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                              which is a contradiction.□

To give an insight about the result of this section, let us assume that two trips p and q of line i and j, respectively, are synchronized at a node b. Since a minimum headway time is considered, it is unlikely that trips p′ and q′ with p < p′ and q < q′ (or p′ < p and q′ < q) will then also be synchronized. Using this idea, we can devise the following class of inequalities.

                           
                              (9)
                              
                                 
                                    
                                       
                                          
                                             Y
                                             
                                                p
                                                q
                                                b
                                             
                                             
                                                i
                                                j
                                             
                                          
                                       
                                       
                                          +
                                       
                                       
                                          
                                             
                                                ∑
                                                
                                                   
                                                      q
                                                      ′
                                                   
                                                   =
                                                   q
                                                   +
                                                   1
                                                
                                                
                                                   f
                                                   j
                                                
                                             
                                             
                                                Y
                                                
                                                   p
                                                   
                                                      q
                                                      ′
                                                   
                                                   b
                                                
                                                
                                                   i
                                                   j
                                                
                                             
                                             +
                                             
                                                ∑
                                                
                                                   
                                                      p
                                                      ′
                                                   
                                                   =
                                                   p
                                                   +
                                                   1
                                                
                                                
                                                   f
                                                   i
                                                
                                             
                                             
                                                Y
                                                
                                                   
                                                      p
                                                      ′
                                                   
                                                   q
                                                   b
                                                
                                                
                                                   i
                                                   j
                                                
                                             
                                             ≤
                                             1
                                          
                                       
                                    
                                    
                                       
                                       
                                          +
                                       
                                       
                                          
                                             
                                                ⌊
                                                
                                                   
                                                      
                                                         W
                                                         b
                                                      
                                                      −
                                                      
                                                         w
                                                         b
                                                      
                                                   
                                                   
                                                      min
                                                      (
                                                      
                                                         h
                                                         i
                                                      
                                                      ,
                                                      
                                                         h
                                                         j
                                                      
                                                      )
                                                   
                                                
                                                ⌋
                                             
                                             
                                                
                                                   
                                                      
                                                         
                                                         i
                                                         ∈
                                                         I
                                                         ,
                                                         
                                                         j
                                                         ∈
                                                         I
                                                         
                                                            (
                                                            i
                                                            )
                                                         
                                                         ,
                                                         
                                                         b
                                                         ∈
                                                         
                                                            B
                                                            
                                                               i
                                                               j
                                                            
                                                         
                                                         ,
                                                      
                                                   
                                                
                                                
                                                   
                                                      
                                                         p
                                                         ∈
                                                         
                                                            {
                                                            1
                                                            ,
                                                            ⋯
                                                            ,
                                                            
                                                               f
                                                               i
                                                            
                                                            }
                                                         
                                                         ,
                                                         q
                                                         ∈
                                                         
                                                            {
                                                            1
                                                            ,
                                                            ⋯
                                                            ,
                                                            
                                                               f
                                                               j
                                                            
                                                            }
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           
                        
                        
                           
                              (10)
                              
                                 
                                    
                                       
                                          
                                             Y
                                             
                                                p
                                                q
                                                b
                                             
                                             
                                                i
                                                j
                                             
                                          
                                       
                                       
                                          +
                                       
                                       
                                          
                                             
                                                ∑
                                                
                                                   
                                                      q
                                                      ′
                                                   
                                                   =
                                                   1
                                                
                                                
                                                   q
                                                   −
                                                   1
                                                
                                             
                                             
                                                Y
                                                
                                                   p
                                                   
                                                      q
                                                      ′
                                                   
                                                   b
                                                
                                                
                                                   i
                                                   j
                                                
                                             
                                             +
                                             
                                                ∑
                                                
                                                   
                                                      p
                                                      ′
                                                   
                                                   =
                                                   1
                                                
                                                
                                                   p
                                                   −
                                                   1
                                                
                                             
                                             
                                                Y
                                                
                                                   
                                                      p
                                                      ′
                                                   
                                                   q
                                                   b
                                                
                                                
                                                   i
                                                   j
                                                
                                             
                                             ≤
                                             1
                                          
                                       
                                    
                                    
                                       
                                       
                                          +
                                       
                                       
                                          
                                             
                                                ⌊
                                                
                                                   
                                                      
                                                         W
                                                         b
                                                      
                                                      −
                                                      
                                                         w
                                                         b
                                                      
                                                   
                                                   
                                                      min
                                                      (
                                                      
                                                         h
                                                         i
                                                      
                                                      ,
                                                      
                                                         h
                                                         j
                                                      
                                                      )
                                                   
                                                
                                                ⌋
                                             
                                             
                                                
                                                   
                                                      
                                                         
                                                         i
                                                         ∈
                                                         I
                                                         ,
                                                         
                                                         j
                                                         ∈
                                                         I
                                                         
                                                            (
                                                            i
                                                            )
                                                         
                                                         ,
                                                         
                                                         b
                                                         ∈
                                                         
                                                            B
                                                            
                                                               i
                                                               j
                                                            
                                                         
                                                         ,
                                                      
                                                   
                                                
                                                
                                                   
                                                      
                                                         p
                                                         ∈
                                                         
                                                            {
                                                            1
                                                            ,
                                                            ⋯
                                                            ,
                                                            
                                                               f
                                                               i
                                                            
                                                            }
                                                         
                                                         ,
                                                         q
                                                         ∈
                                                         
                                                            {
                                                            1
                                                            ,
                                                            ⋯
                                                            ,
                                                            
                                                               f
                                                               j
                                                            
                                                            }
                                                         
                                                         .
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           
                        We will denote these inequalities as headway inequalities as they depend on the value of the desired minimum headway time between trips. We then have the following result.

                           Theorem 2
                           
                              Headway inequalities 
                              
                                 (9)
                               
                              and 
                              
                                 (10)
                               
                              are valid for the SBTP MIP.
                           

We will consider an inequality (9) corresponding to the two trips (p, i), (q, j) and a node b ∈ Bij
                               (the proof for inequalities (10) is analogous). Let 
                                 
                                    (
                                    
                                       X
                                       ˜
                                    
                                    ,
                                    
                                       Y
                                       ˜
                                    
                                    )
                                 
                               be a feasible solution of the SBTP. We consider the two quantities c and r defined as follows

                                 
                                    
                                       
                                          r
                                          =
                                          
                                             ∑
                                             
                                                
                                                   q
                                                   ′
                                                
                                                =
                                                q
                                                +
                                                1
                                             
                                             
                                                f
                                                j
                                             
                                          
                                          
                                             
                                                Y
                                                ˜
                                             
                                             
                                                p
                                                
                                                   q
                                                   ′
                                                
                                                b
                                             
                                             
                                                i
                                                j
                                             
                                          
                                          
                                          and
                                          
                                          c
                                          =
                                          
                                             ∑
                                             
                                                
                                                   p
                                                   ′
                                                
                                                =
                                                p
                                                +
                                                1
                                             
                                             
                                                f
                                                i
                                             
                                          
                                          
                                             
                                                Y
                                                ˜
                                             
                                             
                                                
                                                   p
                                                   ′
                                                
                                                q
                                                b
                                             
                                             
                                                i
                                                j
                                             
                                          
                                          .
                                       
                                    
                                 
                              If 
                                 
                                    r
                                    =
                                    0
                                 
                               then from inequality (8) we know that

                                 
                                    
                                       
                                          
                                             
                                                Y
                                                ˜
                                             
                                             
                                                p
                                                q
                                                b
                                             
                                             
                                                i
                                                j
                                             
                                          
                                          +
                                          c
                                          ≤
                                          
                                             ∑
                                             
                                                
                                                   p
                                                   ′
                                                
                                                =
                                                1
                                             
                                             
                                                f
                                                i
                                             
                                          
                                          
                                             
                                                Y
                                                ˜
                                             
                                             
                                                
                                                   p
                                                   ′
                                                
                                                q
                                                b
                                             
                                             
                                                i
                                                j
                                             
                                          
                                          ≤
                                          1
                                          +
                                          
                                             ⌊
                                             
                                                
                                                   
                                                      W
                                                      b
                                                   
                                                   −
                                                   
                                                      w
                                                      b
                                                   
                                                
                                                
                                                   h
                                                   i
                                                
                                             
                                             ⌋
                                          
                                          ≤
                                          1
                                          +
                                          
                                             ⌊
                                             
                                                
                                                   
                                                      W
                                                      b
                                                   
                                                   −
                                                   
                                                      w
                                                      b
                                                   
                                                
                                                
                                                   min
                                                   (
                                                   
                                                      h
                                                      i
                                                   
                                                   ,
                                                   
                                                      h
                                                      j
                                                   
                                                   )
                                                
                                             
                                             ⌋
                                          
                                          .
                                       
                                    
                                 
                              Similarly, if 
                                 
                                    c
                                    =
                                    0
                                    ,
                                 
                               from inequality (7), we obtain that

                                 
                                    
                                       
                                          
                                             
                                                Y
                                                ˜
                                             
                                             
                                                p
                                                q
                                                b
                                             
                                             
                                                i
                                                j
                                             
                                          
                                          +
                                          r
                                          ≤
                                          
                                             ∑
                                             
                                                
                                                   q
                                                   ′
                                                
                                                =
                                                1
                                             
                                             
                                                f
                                                j
                                             
                                          
                                          
                                             
                                                Y
                                                ˜
                                             
                                             
                                                p
                                                
                                                   q
                                                   ′
                                                
                                                b
                                             
                                             
                                                i
                                                j
                                             
                                          
                                          ≤
                                          1
                                          +
                                          
                                             ⌊
                                             
                                                
                                                   
                                                      W
                                                      b
                                                   
                                                   −
                                                   
                                                      w
                                                      b
                                                   
                                                
                                                
                                                   h
                                                   j
                                                
                                             
                                             ⌋
                                          
                                          ≤
                                          1
                                          +
                                          
                                             ⌊
                                             
                                                
                                                   
                                                      W
                                                      b
                                                   
                                                   −
                                                   
                                                      w
                                                      b
                                                   
                                                
                                                
                                                   min
                                                   (
                                                   
                                                      h
                                                      i
                                                   
                                                   ,
                                                   
                                                      h
                                                      j
                                                   
                                                   )
                                                
                                             
                                             ⌋
                                          
                                          .
                                       
                                    
                                 
                              
                           

Let us now suppose that both r ≥ 1 and c ≥ 1. Since r ≥ 1, trip (p, i) synchronizes with r trips among trips 
                                 
                                    q
                                    +
                                    1
                                    ,
                                    …
                                    ,
                                    
                                       f
                                       j
                                    
                                 
                               of line j. Let q′ be the first of these trips that is synchronized with (p, i). Consequently, arrival times of trips 
                                 
                                    
                                       q
                                       ′
                                    
                                    ,
                                    
                                       q
                                       ′
                                    
                                    +
                                    1
                                    ,
                                    …
                                    ,
                                    
                                       q
                                       ′
                                    
                                    +
                                    
                                       (
                                       r
                                       −
                                       1
                                       )
                                    
                                 
                               at node b are within the time window 
                                 
                                    [
                                    
                                       
                                          X
                                          ˜
                                       
                                       p
                                       i
                                    
                                    +
                                    
                                       t
                                       b
                                       i
                                    
                                    +
                                    
                                       w
                                       b
                                    
                                    ,
                                    
                                       
                                          X
                                          ˜
                                       
                                       p
                                       i
                                    
                                    +
                                    
                                       t
                                       b
                                       i
                                    
                                    +
                                    
                                       W
                                       b
                                    
                                    ]
                                 
                              . Since the minimal headway time between two trips of line j is hj
                              , the arrival time of trip (q′, j) at node b satisfies 
                                 
                                    
                                       
                                          X
                                          ˜
                                       
                                       
                                          q
                                          ′
                                       
                                       j
                                    
                                    +
                                    
                                       t
                                       b
                                       j
                                    
                                    ≤
                                    
                                       
                                          X
                                          ˜
                                       
                                       p
                                       i
                                    
                                    +
                                    
                                       t
                                       b
                                       i
                                    
                                    +
                                    
                                       W
                                       b
                                    
                                    −
                                    
                                       (
                                       r
                                       −
                                       1
                                       )
                                    
                                    
                                       h
                                       j
                                    
                                 
                              . Since 
                                 
                                    
                                       
                                          X
                                          ˜
                                       
                                       
                                          q
                                          +
                                          1
                                       
                                       j
                                    
                                    ≤
                                    
                                       
                                          X
                                          ˜
                                       
                                       
                                          q
                                          ′
                                       
                                       j
                                    
                                    ,
                                 
                               we finally obtain

                                 
                                    
                                       
                                          
                                             
                                                X
                                                ˜
                                             
                                             
                                                q
                                                +
                                                1
                                             
                                             j
                                          
                                          +
                                          
                                             t
                                             b
                                             j
                                          
                                          ≤
                                          
                                             
                                                X
                                                ˜
                                             
                                             p
                                             i
                                          
                                          +
                                          
                                             t
                                             b
                                             i
                                          
                                          +
                                          
                                             W
                                             b
                                          
                                          −
                                          
                                             (
                                             r
                                             −
                                             1
                                             )
                                          
                                          
                                             h
                                             j
                                          
                                          .
                                       
                                    
                                 
                              
                           

Similarly, since c ≥ 1 there are c trips among 
                                 
                                    p
                                    +
                                    1
                                    ,
                                    …
                                    ,
                                    
                                       f
                                       i
                                    
                                 
                               of line i that synchronizes with (q, j). Let p′ be the last of these trips that synchronized with (q, j), thus we know that 
                                 
                                    
                                       
                                          X
                                          ˜
                                       
                                       q
                                       j
                                    
                                    +
                                    
                                       t
                                       b
                                       j
                                    
                                    ≥
                                    
                                       
                                          X
                                          ˜
                                       
                                       
                                          p
                                          ′
                                       
                                       i
                                    
                                    +
                                    
                                       t
                                       b
                                       i
                                    
                                    +
                                    
                                       w
                                       b
                                    
                                 
                              . Moreover, since trips 
                                 
                                    
                                       p
                                       ′
                                    
                                    −
                                    
                                       (
                                       c
                                       −
                                       1
                                       )
                                    
                                    ,
                                    …
                                    ,
                                    
                                       p
                                       ′
                                    
                                 
                               are synchronized with (q, j) and because of the imposed minimum headway times of line i, we know that 
                                 
                                    
                                       
                                          X
                                          ˜
                                       
                                       q
                                       j
                                    
                                    +
                                    
                                       t
                                       b
                                       j
                                    
                                    ≥
                                    
                                       
                                          X
                                          ˜
                                       
                                       
                                          
                                             p
                                             ′
                                          
                                          −
                                          
                                             (
                                             c
                                             −
                                             1
                                             )
                                          
                                       
                                       i
                                    
                                    +
                                    
                                       t
                                       b
                                       i
                                    
                                    +
                                    
                                       w
                                       b
                                    
                                    +
                                    
                                       (
                                       c
                                       −
                                       1
                                       )
                                    
                                    
                                       h
                                       i
                                    
                                 
                              . Since 
                                 
                                    
                                       
                                          X
                                          ˜
                                       
                                       
                                          
                                             p
                                             ′
                                          
                                          −
                                          
                                             (
                                             c
                                             −
                                             1
                                             )
                                          
                                       
                                       i
                                    
                                    ≥
                                    
                                       
                                          X
                                          ˜
                                       
                                       
                                          p
                                          +
                                          1
                                       
                                       i
                                    
                                    ,
                                 
                               we obtain

                                 
                                    
                                       
                                          
                                             
                                                X
                                                ˜
                                             
                                             q
                                             j
                                          
                                          +
                                          
                                             t
                                             b
                                             j
                                          
                                          ≥
                                          
                                             
                                                X
                                                ˜
                                             
                                             
                                                p
                                                +
                                                1
                                             
                                             i
                                          
                                          +
                                          
                                             t
                                             b
                                             i
                                          
                                          +
                                          
                                             w
                                             b
                                          
                                          +
                                          
                                             (
                                             c
                                             −
                                             1
                                             )
                                          
                                          
                                             h
                                             i
                                          
                                          .
                                       
                                    
                                 
                              
                           

Because of the minimum headway times between trips of line j, we then get

                                 
                                    
                                       
                                          
                                             
                                                
                                                   h
                                                   j
                                                
                                             
                                             
                                                ≤
                                             
                                             
                                                
                                                   
                                                      (
                                                      
                                                         
                                                            X
                                                            ˜
                                                         
                                                         
                                                            q
                                                            +
                                                            1
                                                         
                                                         j
                                                      
                                                      +
                                                      
                                                         t
                                                         b
                                                         j
                                                      
                                                      )
                                                   
                                                   −
                                                   
                                                      (
                                                      
                                                         
                                                            X
                                                            ˜
                                                         
                                                         q
                                                         j
                                                      
                                                      +
                                                      
                                                         t
                                                         b
                                                         j
                                                      
                                                      )
                                                   
                                                
                                             
                                          
                                          
                                             
                                             
                                                ≤
                                             
                                             
                                                
                                                   
                                                      
                                                         X
                                                         ˜
                                                      
                                                      p
                                                      i
                                                   
                                                   −
                                                   
                                                      
                                                         X
                                                         ˜
                                                      
                                                      
                                                         p
                                                         +
                                                         1
                                                      
                                                      i
                                                   
                                                   +
                                                   
                                                      W
                                                      b
                                                   
                                                   −
                                                   
                                                      w
                                                      b
                                                   
                                                   −
                                                   
                                                      (
                                                      r
                                                      −
                                                      1
                                                      )
                                                   
                                                   
                                                      h
                                                      j
                                                   
                                                   −
                                                   
                                                      (
                                                      c
                                                      −
                                                      1
                                                      )
                                                   
                                                   
                                                      h
                                                      i
                                                   
                                                   .
                                                
                                             
                                          
                                       
                                    
                                 
                              And, because of the minimum headway time between trips (p, i) and 
                                 
                                    (
                                    p
                                    +
                                    1
                                    ,
                                    i
                                    )
                                    ,
                                 
                               we have 
                                 
                                    
                                       
                                          X
                                          ˜
                                       
                                       
                                          p
                                          +
                                          1
                                       
                                       i
                                    
                                    −
                                    
                                       
                                          X
                                          ˜
                                       
                                       p
                                       i
                                    
                                    ≥
                                    
                                       h
                                       i
                                    
                                 
                              . Then, we obtain

                                 
                                    
                                       
                                          
                                             h
                                             j
                                          
                                          ≤
                                          −
                                          
                                             h
                                             i
                                          
                                          +
                                          
                                             W
                                             b
                                          
                                          −
                                          
                                             w
                                             b
                                          
                                          −
                                          
                                             (
                                             r
                                             −
                                             1
                                             )
                                          
                                          
                                             h
                                             j
                                          
                                          −
                                          
                                             (
                                             c
                                             −
                                             1
                                             )
                                          
                                          
                                             h
                                             i
                                          
                                          ,
                                       
                                    
                                 
                              which then becomes 
                                 
                                    r
                                    
                                       h
                                       j
                                    
                                    +
                                    c
                                    
                                       h
                                       i
                                    
                                    ≤
                                    
                                       W
                                       b
                                    
                                    −
                                    
                                       w
                                       b
                                    
                                    .
                                 
                               W.l.o.g. we can suppose that hj
                               ≤ hi
                              . We then obtain

                                 
                                    
                                       
                                          r
                                          +
                                          c
                                          ≤
                                          r
                                          +
                                          c
                                          
                                             
                                                h
                                                i
                                             
                                             
                                                h
                                                j
                                             
                                          
                                          ≤
                                          
                                             
                                                
                                                   W
                                                   b
                                                
                                                −
                                                
                                                   w
                                                   b
                                                
                                             
                                             
                                                h
                                                j
                                             
                                          
                                          .
                                       
                                    
                                 
                              Thus, we get

                                 
                                    
                                       
                                          
                                             
                                                Y
                                                ˜
                                             
                                             
                                                p
                                                q
                                                b
                                             
                                             
                                                i
                                                j
                                             
                                          
                                          +
                                          r
                                          +
                                          c
                                          ≤
                                          1
                                          +
                                          
                                             
                                                
                                                   W
                                                   b
                                                
                                                −
                                                
                                                   w
                                                   b
                                                
                                             
                                             
                                                h
                                                j
                                             
                                          
                                          ,
                                       
                                    
                                 
                              which proves the validity of inequality (9).□

In this section, we present a generic lifting method that permits to compute new valid inequalities from previous ones.

Let us first introduce a useful notation. Let ξ be the set of all 5-tuples (i, j, p, q, b) with i ∈ I, j ∈ I(i), p ∈ {1,…, fi
                        }, q ∈ {1,…, fj
                        } and b ∈ Bj
                        . Notice that set ξ is in a one-to-one correspondence with the set of Y’s variables, that is to say, each 5-tuple (i, j, p, q, b) ∈ ξ corresponds to a potential synchronization between trips (p, i) and (q, j) at node b so that trip (p, i) arrives first at node b.

Let us consider the following inequality:

                           
                              (11)
                              
                                 
                                    
                                       ∑
                                       
                                          (
                                          i
                                          ,
                                          j
                                          ,
                                          p
                                          ,
                                          q
                                          ,
                                          b
                                          )
                                          ∈
                                          E
                                       
                                    
                                    
                                       Y
                                       
                                          p
                                          q
                                          b
                                       
                                       
                                          i
                                          j
                                       
                                    
                                    ≤
                                    γ
                                 
                              
                           
                        where E ⊂ ξ and γ is an upper bound over the number of synchronizations in E. The inequalities of type (11) are clearly valid. We note that the synchronization and headway inequalities belong to this class. For instance, given i ∈ I, j ∈ I(i), b ∈ Bij
                         and 
                           
                              p
                              ∈
                              {
                              1
                              ,
                              ⋯
                              ,
                              
                                 f
                                 i
                              
                              }
                              ,
                           
                         the corresponding synchronization inequality of type (7) is defined by the set 
                           
                              E
                              =
                              {
                              
                                 (
                                 i
                                 ,
                                 j
                                 ,
                                 p
                                 ,
                                 q
                                 ,
                                 b
                                 )
                              
                              
                              |
                              
                              q
                              ∈
                              
                                 {
                                 1
                                 ,
                                 ⋯
                                 ,
                                 
                                    f
                                    j
                                 
                                 }
                              
                              }
                           
                         and 
                           
                              γ
                              =
                              1
                              +
                              ⌊
                              
                                 
                                    
                                       W
                                       b
                                    
                                    −
                                    
                                       w
                                       b
                                    
                                 
                                 
                                    h
                                    j
                                 
                              
                              ⌋
                           
                        .

Given (i
                        0, j
                        0, p
                        0, q
                        0, b
                        0) ∈ ξ, we consider a set E′ of 5-tuples (i, j, p, q, b) subset of E so that trips (p, i) and (q, j) cannot be synchronized at node b if trips (p
                        0, i
                        0) and (q
                        0, j
                        0) are synchronized at node b
                        0 and trip (p
                        0, i
                        0) arrives first at node b
                        0, that is to say that, for a given solution 
                           
                              (
                              
                                 X
                                 ˜
                              
                              ,
                              
                                 Y
                                 ˜
                              
                              )
                           
                         of SBTP MIP, 
                           
                              
                                 
                                    Y
                                    ˜
                                 
                                 
                                    
                                       p
                                       0
                                    
                                    
                                       q
                                       0
                                    
                                    
                                       b
                                       0
                                    
                                 
                                 
                                    
                                       i
                                       0
                                    
                                    
                                       j
                                       0
                                    
                                 
                              
                              =
                              1
                           
                         implies 
                           
                              
                                 
                                    Y
                                    ˜
                                 
                                 
                                    p
                                    q
                                    b
                                 
                                 
                                    i
                                    j
                                 
                              
                              =
                              0
                           
                         for all (i, j, p, q, b) ∈ E′. Inequality (11) can be then lifted to create the following inequality

                           
                              (12)
                              
                                 
                                    
                                       ∑
                                       
                                          
                                             (
                                             i
                                             ,
                                             j
                                             ,
                                             p
                                             ,
                                             q
                                             ,
                                             b
                                             )
                                          
                                          ∈
                                          
                                             E
                                             ′
                                          
                                       
                                    
                                    
                                       Y
                                       
                                          p
                                          q
                                          b
                                       
                                       
                                          i
                                          j
                                       
                                    
                                    ≤
                                    γ
                                    
                                       (
                                       1
                                       −
                                       
                                          Y
                                          
                                             
                                                p
                                                0
                                             
                                             
                                                q
                                                0
                                             
                                             
                                                b
                                                0
                                             
                                          
                                          
                                             
                                                i
                                                0
                                             
                                             
                                                j
                                                0
                                             
                                          
                                       
                                       )
                                    
                                 
                              
                           
                        which is clearly valid.

In the following, we present a generic lifting procedure to obtain inequalities of type (12). This procedure will be applied to both synchronization and headway inequalities in order to obtain lifted synchronization inequalities and lifted headway inequalities. Remark that the set of variables Y of such a lifted inequality is related to different lines while the set of variables of a headway or a synchronization inequality is related to only two lines.

To compute the lifted inequalities given a 5-tuple (i, j, p, q, b), we will need to find a list of 5-tuples that can not be synchronized if (i, j, p, q, b) is synchronized. To achieve this, we recall that the time window 
                           
                              [
                              
                                 
                                    d
                                    ̲
                                 
                                 p
                                 i
                              
                              ,
                              
                                 
                                    d
                                    ¯
                                 
                                 p
                                 i
                              
                              ]
                           
                         constitutes a generic feasible departure time window. Then, assuming that two trips are synchronized, it is be possible to tighten the latter window getting a new feasible departure time window 
                           
                              
                                 D
                                 p
                                 i
                              
                              ⊂
                              
                                 [
                                 
                                    
                                       d
                                       ̲
                                    
                                    p
                                    i
                                 
                                 ,
                                 
                                    
                                       d
                                       ¯
                                    
                                    p
                                    i
                                 
                                 ]
                              
                           
                        . This can be done using logical inferences that are given in Ibarra-Rojas and Rios-Solis (2012). An example of how to tighten time windows is the following. Consider the feasible departure time windows [15, 20] and [18, 25] for trips (p, i) and (q, j), respectively. Assume we have the parameters values 
                           
                              
                                 t
                                 b
                                 i
                              
                              =
                              10
                              ,
                           
                        
                        
                           
                              
                                 t
                                 b
                                 j
                              
                              =
                              22
                              ,
                           
                         and 
                           
                              
                                 [
                                 
                                    w
                                    b
                                 
                                 ,
                                 
                                    W
                                    b
                                 
                                 ]
                              
                              =
                              
                                 [
                                 3
                                 ,
                                 8
                                 ]
                              
                           
                        . Then, the arrival of trip (q, j) at node b is within the interval 
                           
                              [
                              18
                              +
                              22
                              ,
                              25
                              +
                              22
                              ]
                              =
                              [
                              40
                              ,
                              47
                              ]
                           
                         and the arrival of trip (p, i) at node b is within 
                           
                              [
                              15
                              +
                              10
                              ,
                              20
                              +
                              10
                              ]
                              =
                              [
                              25
                              ,
                              30
                              ]
                           
                        . If it is possible to synchronize trip (p, i) with trip (q, j), then the arrival time of trip (q, j) at node b must be within 
                           
                              [
                              25
                              +
                              3
                              ,
                              30
                              +
                              8
                              ]
                              =
                              [
                              28
                              ,
                              38
                              ]
                           
                         which is impossible since 
                           
                              [
                              28
                              ,
                              38
                              ]
                              ∩
                              [
                              40
                              ,
                              47
                              ]
                              =
                              ∅
                           
                        .

Having a feasible departure time window 
                           
                              D
                              p
                              i
                           
                         for a given trip (p, i), tighter departure time windows 
                           
                              
                                 D
                                 
                                    p
                                    ′
                                 
                                 i
                              
                              ,
                           
                         for all trips p′ ≠ p, can be similarly inferred using the headway times between trips of line i.


                        Algorithm 1
                        , called Generic Lifting, shows the steps to generate lifted inequalities. The general idea to obtain these inequalities is to consider a 5-tuple (i
                        0, j
                        0, p
                        0, q
                        0, b
                        0) ∈ ξ and see what implications arise if the corresponding synchronization is set, that is to say when 
                           
                              
                                 Y
                                 
                                    
                                       p
                                       0
                                    
                                    
                                       q
                                       0
                                    
                                    
                                       b
                                       0
                                    
                                 
                                 
                                    
                                       i
                                       0
                                    
                                    
                                       j
                                       0
                                    
                                 
                              
                              =
                              1
                           
                        . Steps 2–4 implement the inference process described above to compute tight departure times windows, assuming that (i
                        0, j
                        0, p
                        0, q
                        0, b
                        0) is synchronized at node b. We then apply a specific procedure for each inequality 
                           
                              
                                 ∑
                                 
                                    (
                                    i
                                    ,
                                    j
                                    ,
                                    p
                                    ,
                                    q
                                    ,
                                    b
                                    )
                                    ∈
                                    E
                                 
                              
                              
                                 Y
                                 
                                    p
                                    q
                                    b
                                 
                                 
                                    i
                                    j
                                 
                              
                              ≤
                              γ
                           
                         of type (11): we determine a set E′ of 5-tuples (i, j, p, q, b) of E that cannot be synchronized and we then can create the corresponding lifted inequalities. Unfortunately, these last Steps 5–8 must be dedicated to each of the synchronization and headway inequalities in order to get sets E′ with known upper bounds.

In order to find which trips cannot be synchronized, a synchronization test can be easily devised for each class of synchronization and headway inequalities. Such a test determines if a trip (p, i) cannot be synchronized with a trip (q, j) due to the fact that (i
                        0, j
                        0, p
                        0, q
                        0, b
                        0) is synchronized.

For creating lifted synchronization inequalities of type (7), lines 5–8 of Generic Algorithm 1 have to be replaced by Algorithm 2
                        . This algorithm enumerates every synchronization inequality of type (7) which can be affected by the modification of lines i
                        0 and j
                        0 (Steps 2–4 of Generic Algorithm 1). Each potential trip q is then tested to know if (i, j, p, q, b) becomes impossible leading to a lifted synchronization inequality from the set E′ which represents the set of impossible synchronizations.

Using similar ideas, three other algorithms can also be derived to lift the synchronization inequalities of type (8) and the headway inequalities of type (9) and (10).

@&#EXPERIMENTAL RESULTS@&#

In this section, computational results are presented using the integer linear solver CPLEX 12.6 on a Mac mini with a 2.3 GigaHertz (Intel Core i7) processor and memory of 4 GigaByte 1600 MegaHertz. The computational effort to generate the valid inequalities for the SBTP MIP is negligible (less than one second) for the considered instances. We compare several combinations of the proposed valid inequalities within the SBTP MIP in order to solve efficiently SBTP instances.

We use the instance generation scheme proposed by Ibarra-Rojas and Rios-Solis (2012). All the instances have the following common characteristics: a planning period of 
                           
                              T
                              =
                              240
                           
                         minutes; the frequency fi
                         for each line i is randomly generated in [13,18]; the travel time 
                           
                              t
                              b
                              i
                           
                         from the depot to synchronization node b for each line i is randomly generated in [20,60]; the minimum (resp. maximum) waiting time for each synchronization node b is randomly generated in [3,5] (resp. [9,12]); finally, the number of different pairs of lines to synchronize at each node b is randomly generated between 1 and 7.

The derived instances are grouped into 9 types depending on the following parameters: the number |I| of lines, the number |B| of “important” synchronization nodes where different pair of lines should be synchronized, and the flexibility parameter δi
                        . This latter parameter is randomly generated so that the ratio between δi
                         and 
                           
                              T
                              
                                 f
                                 i
                              
                           
                         belongs to a flexibility interval denoted by [Fmin, Fmax
                        ]. As it is highlighted by Ibarra-Rojas and Rios-Solis (2012), for a linear solver, the larger Fmin
                         is, the more intractable is the related instance using the basic SBTP MIP.

The flexibility interval parameters value is based on real application settings. According to the planners of Monterrey’s transit network, it is reasonable to consider either [10,20] or [25,35] for [Fmin, Fmax
                        ]; and a number of lines 5 times the number of “important” synchronization nodes. We randomly generate 10 instances for each of the 9 instance types (a total of 90 instances) to analyze the algorithm performance. The name of the instance types and their parameters are summarized in Table 1
                        . Note that instances of type A9 have a very large number of synchronization nodes which is not a realistic situation but we use them to show the limits of our solution approach.

In this first set of instances, the number 
                           
                              N
                              b
                              
                                 i
                                 j
                              
                           
                         of passengers that will benefit of the synchronization of lines i and j at node b is considered constant for all lines and synchronization nodes, and will be then set to value 1.


                        Tables 2
                         and 3
                         summarize the experimental results obtained for different combinations of valid inequalities within a time limit of one hour (colored cells represents the best average results–in terms of efficiency–for each instance type). We tested all the different combinations but the 6 following different combinations have been kept in order to show the impact of our proposed valid inequalities. Notation (1–6) corresponds to the basic SBTP MIP and we specify the inequalities used in each combination. Notation lift indicates the case were the lifted inequalities are used. Notation lift
                        20 is similar to the latter case where only 20 percent of those inequalities are included corresponding to the ones whose set E′ is the largest.

For each of the 6 combinations, Tables 2 and 3 provide the following entries:

                           
                              
                                 
                                    
                                       
                                          
                                             #
                                             Nodes
                                          
                                       
                                       
                                          :
                                       
                                       
                                          
                                             The
                                             
                                             average
                                             
                                             number
                                             
                                             of
                                             
                                             nodes
                                             
                                             in
                                             
                                             the
                                             
                                             branching
                                          
                                       
                                    
                                    
                                       
                                       
                                       
                                          
                                             
                                             tree.
                                          
                                       
                                    
                                    
                                       
                                          Rel
                                       
                                       
                                          :
                                       
                                       
                                          
                                             The
                                             
                                             average
                                             
                                             value
                                             
                                             of
                                             
                                             the
                                             
                                             objective
                                             
                                             function
                                             
                                             at
                                          
                                       
                                    
                                    
                                       
                                       
                                       
                                          
                                             
                                             the
                                             
                                             root
                                             
                                             node.
                                          
                                       
                                    
                                    
                                       
                                          Gap
                                       
                                       
                                          :
                                       
                                       
                                          
                                             The
                                             
                                             average
                                             
                                             relative
                                             
                                             error
                                             
                                             between
                                             
                                             the
                                             
                                             best
                                          
                                       
                                    
                                    
                                       
                                       
                                       
                                          
                                             
                                             obtained
                                             
                                             value
                                             
                                             and
                                             
                                             the
                                             
                                             best
                                             
                                             obtained
                                             
                                             lower
                                          
                                       
                                    
                                    
                                       
                                       
                                       
                                          
                                             
                                             bound.
                                          
                                       
                                    
                                    
                                       
                                          CPU
                                       
                                       
                                          :
                                       
                                       
                                          
                                             The
                                             
                                             average
                                             
                                             computational
                                             
                                             time
                                             
                                             in
                                             
                                             seconds
                                             .
                                          
                                       
                                    
                                    
                                       
                                          
                                             #
                                             Opt
                                          
                                       
                                       
                                          :
                                       
                                       
                                          
                                             The
                                             
                                             number
                                             
                                             of
                                             
                                             instances
                                             
                                             solved
                                             
                                             to
                                             
                                             optimality
                                             .
                                          
                                       
                                    
                                 
                              
                           
                        
                     

In the first block of columns in Table 2, we can see that the original formulation of SBTP is intractable since we obtain large gaps in one hour of computation time. Notice that no feasible solution can be found within this time limit for instances A9. The second block of columns in Table 2 corresponds to the case where the synchronization inequalities (7–8) have been added to the original formulation. We can see that adding these inequalities to the original formulation leads to rather good solutions within reasonable CPU times, the gaps are indeed significantly reduced in comparison with the ones obtained for the original formulation and optimal solutions are found for most of the instances of types A1–A4. In particular, instances A1 are optimally solved within less than one minute in average. Instances A2 and A3 are almost all solved to optimality. Moreover, the average number of nodes in the tree search decreases significantly as well as the average value of the objective function at the root node. Even better results can be observed for the headway inequalities: the third block of columns in Table 2 shows the results of adding the headway inequalities (9–10) to the original formulation. Optimal (or near optimal) solutions for most of the instances are obtained by implementing headway inequalities. Moreover, the average relaxation for instances A2 and A8 improves compared with using only the synchronization inequalities. The latter two combinations of valid inequalities lead to solutions with average gap less than 8 percent for instances A9.

The first block of columns in Table 3 corresponds to the original formulation strengthened with both synchronization and headway inequalities. Indeed, the best average results are obtained through this formulation since a larger number of optimal solutions and smaller gaps or/and computational times are obtained for all instances types. Moreover, the number of explored nodes of the B&B tree is the smallest for most of the instances, while the average linear relaxation for all instances is the same as the one obtained by implementing the headway inequalities. Additionally, we report the results of adding the lifted headway inequalities to the latter case.

The second and third blocks of columns in Table 3 indicate that the lifted headway inequalities lead to worse average results compared with the first block of columns. We can notice that our solution approach using lifted inequalities is not able to obtain feasible solutions in less than one hour of computational time for instances A9. However, we could see that the average relaxation in the second block of columns for instances A4 is smaller compared with the one in the first block of columns. Even when average results of implementing lifted inequalities show a larger average computational time or average relative gap, there are some instances of types A1–A8 where using the lifted valid inequalities improves the performance of the CPLEX solver. This two latter remarks lead to prove the efficiency of our lifted inequalities: however, the algorithms proposed in this paper to produce these inequalities give rise to a very important number of inequalities that CPLEX is unable to handle within a few hours. A natural way to improve this work is to find a method to produce a smaller number of selected inequalities. The last block of columns in Table 3 presents a computational test with a reduced number of lifted inequalities. We choose the ones having a lot of non-zero coefficients. Unfortunately, this approach fails since the average obtained gap is not improved in comparison with formulation (1–6) + (7–10).

Implementing (7–10) and lifted headway inequalities lead to worse average results compared with (7–10). However, some instances are benefited by using them. Numerical results show that implementing all the lifted headway inequalities leads to an improvement of the quality of the initial linear relaxation for 10 of the 80 instances compared with (7–10). Larger instances A7 and A8 were the most benefited (in terms of linear relaxation) of using our proposed lifted headway inequalities. Moreover, around 16 percent of the instances are more efficiently solved with the lifted headway inequalities. In a future work, we aim to use useful inequalities within a Branch-and-Cut framework.

In this section, we analyze the efficiency of our solution approach. Table 4
                         provides a comparison between the best solution found using CPLEX to solve the SBTP MIP strengthened with cuts (7–10) and the Multi-start Iterated Local Search (MILS) proposed by Ibarra-Rojas et al. (2015b) for the same problem. Each line is the average value of the 10 instances of each type. We use a stopping criterion of 1 minute of computational time for both approaches. The gap of the MILS implementation is computed with the deviation of the feasible solution obtained by MILS and the best upper bound found by CPLEX 12.6. The #Opt column represents the number of times the corresponding approach yields the optimal solution.

We can notice that our proposed strengthened formulation leads to the best average gaps for all instance types. Moreover, we can see that by using our approach it is possible to find the optimal solution for 46 out of the 80 generated instances in only one minute while the MILS finds only 8 optimal solutions. We conclude that our solution approach even has a promising behavior as a heuristic procedure since it overcomes the metaheuristic results provided by Ibarra-Rojas et al. (2015b).

We drive a computational analysis to assess the efficiency of the solving method when maximizing the weighted sum of the number of synchronizations on the instances of type A8 since they are the largest instances for which we obtained high quality solutions in acceptable computational times. Each instance is solved using the strengthened formulation (7–10).

We recall that our strengthened formulation bounds the sum of synchronization variables for each pair of lines (i, j ∈ J(i)) and node b ∈ Bij
                         weighted by 
                           
                              N
                              b
                              
                                 i
                                 j
                              
                           
                         in the objective function. Parameter values 
                           
                              N
                              b
                              
                                 i
                                 j
                              
                           
                         are randomly generated between interval [50,200]. We consider two stopping criteria: (i) optimality or one hour of computational time; and (ii) 3 percent of relative gap.

We find out that using our solution approach leads to high quality solutions in short computational times when considering a weighted objective function. The average computational time required to solve instances A8 is of 492.087 seconds while solving the formulation with an unweighted objective function requires an average computational time of 741.15 seconds. Besides, the relative computational time required to obtain a solution with less than 3 percent of relative gap for instances A8 is of 98.81 seconds while the required computational time in the case of the unweighted objective function is of 55.67 seconds. It is expected that the SBTP formulation with a weighted objective function has less symmetries compared with the original one. This characteristic may lead to smaller computational times to obtain high quality solutions using commercial solvers. Thus, we could say that our proposed valid inequalities tackle the combinatorial nature of the SBTP independently of the cost or benefits that synchronization variables could imply.

In this section, we show that there is a potential benefit of having flexible headways compared with a regular service when we are concern with synchronizations between lines. We drive some additional experiments to measure the number of well timed synchronizations we obtained by allowing this flexibility. Such analysis could not be proposed in the previous work of Ibarra-Rojas and Rios-Solis (2012) for which increasing the headway flexibility leads to hard instances, which is not the case using the proposed SBTP MIP.

We compare the number of synchronizations obtained by solving the 80 generated instances A1–A8 with either regular service (that is 
                           
                              
                                 δ
                                 i
                              
                              =
                              0
                           
                         for each line i ∈ I), or flexible headways. The results are shown in Fig. 3 where horizontal axis represents the instances and the vertical axis represents the relative improvement (in terms of number of synchronizations) for flexible headways compared with a regular service. The numbers in parenthesis beside of the instance type represent the average relative improvement for that particular instance type.

We can notice that the average relative improvement is greater than 45 percent for each instance type. Large improvements (greater than 90 percent) are shown for three instances of type A2 (points in the oval) while an improvement of less than 20 percent was found for only one instance of type A1 (highlighted in a rectangle). The improvement for the remaining instances is between 30 percent and 80 percent. Thus, there is a real benefit of using flexible headways to increase the number of synchronizations.

@&#CONCLUSIONS@&#

We define an exact solution approach for the NP-hard synchronization bus timetabling problem. This problem determines regular spaced departure time for all the trips of each line to allow well timed passenger transfers and reduce congestion of buses belonging to different lines at common stops. The flexibility in the SBTP given by headway time bounds (instead of a fixed headway time) allows us to define different families of valid inequalities to tighten the SBTP MIP.

Our solution approach is to strengthen the SBTP MIP using our proposed valid inequalities and using an integer linear solver. Numerical results show that high quality solutions (optimal for most cases) can be found for large instances of SBTP in a short time. Moreover, there is a fast convergence of our approach to solutions with less than 3 percent of relative deviation from the optimal solution in seconds. These results are very interesting if we want an integrated approach with the vehicle scheduling since we have a stronger formulation that can be used in a sequential approach or in an integration with other subproblems of the entire transit network planning problem.

Although we obtain high quality solutions in a short time, there are interesting research lines such as determining the dimension of the valid inequalities proposed in this study. A natural improvement for this work is to develop a polyhedral study along with a branch-and-cut approach to handle unsolvable instances. The lifting procedures may be of particular interest in a branch-and-cut. Finally, the integration of SBTP with other subproblems of transit network planning such as vehicle and crew scheduling is a challenging research area.

@&#ACKNOWLEDGMENTS@&#

This research was partially supported by grant 101857 from the Mexican National Council for Science and Technology (CONACYT). O.J. Ibarra-Rojas wishes to acknowledge CONICYT/FONDECYT/3140358 and the Centro de Desarrollo Urbano Sustentable (CEDEUS), Conicyt/Fondap/15110020. We thank the anonymous referees for their valuable comments that permitted to improve the presentation of the paper.


                     Table 5 shows which combination of valid inequalities strengthened the most the original formulation for each one of the 80 instances (type of instances in the rows, instance number in the columns).

Supplementary material associated with this article can be found, in the online version, at 10.1016/j.ejor.2015.12.006.


                     
                        
                           Supplementary Data S1
                           
                              Supplementary Raw Research Data. This is open data under the CC BY license http://creativecommons.org/licenses/by/4.0/
                              
                           
                           
                        
                     
                  


                     
                        
                           Supplementary Data S2
                           
                              Supplementary Raw Research Data. This is open data under the CC BY license http://creativecommons.org/licenses/by/4.0/
                              
                           
                           
                        
                     
                  


                     
                        
                           Supplementary Data S3
                           
                              Supplementary Raw Research Data. This is open data under the CC BY license http://creativecommons.org/licenses/by/4.0/
                              
                           
                           
                        
                     
                  

@&#REFERENCES@&#

