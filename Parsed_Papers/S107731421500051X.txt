@&#MAIN-TITLE@&#Hierarchical temporal graphical model for head pose estimation and subsequent attribute classification in real-world videos

@&#HIGHLIGHTS@&#


               
               
                  
                     
                        
                           
                           A hierarchical temporal model is used to estimate head pose in real-world videos.


                        
                        
                           
                           Head pose classification in (un)constrained databases shows superior performance.


                        
                        
                           
                           Proposed model is used to classify facial traits in real-world videos.


                        
                        
                           
                           Trait classification with and without using the estimated pose angle is performed.


                        
                        
                           
                           Facial trait classification using the proposed model show superior performance.


                        
                     
                  
               
            

@&#KEYPHRASES@&#

Face

Attribute

Pose

Probabilistic

Real-world

Unconstrained

Video

Hierarchical

Graphical

Temporal

@&#ABSTRACT@&#


               
               
                  Recently, head pose estimation in real-world environments has been receiving attention in the computer vision community due to its applicability to a wide range of contexts. However, this task still remains as an open problem because of the challenges presented by real-world environments. The focus of most of the approaches to this problem has been on estimation from single images or video frames, without leveraging the temporal information available in the entire video sequence. Other approaches frame the problem in terms of classification into a set of very coarse pose bins. In this paper, we propose a hierarchical graphical model that probabilistically estimates continuous head pose angles from real-world videos, by leveraging the temporal pose information over frames. The proposed graphical model is a general framework, which is able to use any type of feature and can be adapted to any facial classification task. Furthermore, the framework outputs the entire pose distribution for a given video frame. This permits robust temporal probabilistic fusion of pose information over the video sequence, and also probabilistically embedding the head pose information into other inference tasks. Experiments on large, real-world video sequences reveal that our approach significantly outperforms alternative state-of-the-art pose estimation methods. The proposed framework is also evaluated on gender and facial hair estimation. By incorporating pose information into the proposed hierarchical temporal graphical mode, superior results are achieved for attribute classification tasks.
               
            

@&#INTRODUCTION@&#

The amount of real-world video sequences has increased substantially as the cost of the cameras has decreased in recent years, leading to a considerable increase in the range of possible real-world video applications, including video indexing, human tracking, face recognition and verification, social networking and human computer interaction. Despite the huge literature on optimizing and automating such applications, due to the challenges presented by real-world environments (see Fig. 1
                     ), it is still hard to develop these applications. Recently there has been a lot of effort in the computer vision community, to further improve these systems in the context of real-world scenarios [1–22]. Some of this effort is to make face recognition/verification, facial attribute classification and human computer interaction to benefit from head pose estimates as prior information in order to boost their performance [1,23–34]. For instance, for face verification/facial attribute classification tasks, facial fiducial points are used to estimate pose, so as to be able to map face images from the real-world environment to a common coordinate system [24,35,36,32].

Head pose estimation methods based on 2D images can be divided into several main groups, namely geometric, tracking, appearance template and manifold subspace embedding methods [38]. Geometric methods 
                     [39] use the facial landmark locations to estimate the head pose from their relative configuration. Tracking methods 
                     [40–42] use the relative movement between consecutive video frames to estimate the global head movement. Appearance template methods 
                     [43,44,28] use image-based comparison techniques to match a test image to a set of training images with corresponding pose labels. [28], for instance, estimates the 3D head pose from high quality depth images using random regression forests. It achieves this through regression between depth features and continuous head pose angles. However, this approach uses every image region for the head pose estimation, thus it is not robust to real-world facial occlusion, such as from coffee cups and facial hair, which can introduce additional spurious features to the face representation. Manifold, subspace embedding methods 
                     [45,44,46–51], on the other hand, use linear and nonlinear subspace techniques to project an image onto the head pose manifold, which is learned from a training set. When such techniques are used for video frames, they implicitly model a given video sequence temporally by mapping similar frames onto nearby locations in the manifold. The highest accuracies published in the head pose literature are provided by the manifold learning methods (see for example [51]). However, most of the aforementioned approaches are developed for constrained environments, and have several stages which are not compatible with real-world unconstrained environments (e.g. no extreme head pose or major occlusion is allowed). For instance, they often assume that the entire set of facial features typical for near frontal poses is always visible. Facial features are often manually labeled in the testing data, rather than automatically extracted. Most approaches are trained and tested on images which do not exhibit wide appearance variation. The testing databases mostly contain images with solid or constant background, limited range of facial expressions, no random illumination, and limited or no facial occlusion (e.g. CMU Multi-PIE [52], FERET [53] and CAS-PEAL [54]). Finally, the current tracking methods rely on video sequences with a known initial head pose, and typically, they must be reinitialized (at times, manually) whenever the tracking fails (due to a failure in the face detection or due to occlusion). However, many of these requirements and assumptions are not practical in the context of real-world videos.

Different methods have been proposed to solve the problem of head pose estimation in real-world environments, such as [27,30,33,23,55,29,32]. [27,30] treat the problem as a classification problem (assigning a face image to one of very coarsely defined pose bins), and address it in the context of single, low resolution video frames of crowded scenes under poor and/or limited (e.g. indoor) lighting. Approaches such as [23,29] use relatively high quality video frames/images and perform classification on finer pose bins. Some other approaches, on the other hand, define the pose estimation problem as a continuous pose angle estimation task [55,32,33]. Refs. [55,56] shows that when facial landmarks are located on the face, they can be successfully used to estimate head pose. However, such approaches have the vulnerability that it is difficult to extract such features when a major facial occlusion is present (see Fig. 2
                     ) or when the pose angle is more than 45°, leading to occlusion of facial landmark regions (e.g. eyes) in the image. Finally, most of the aforementioned approaches either focus on only a specific set of features (e.g. facial landmark points) to represent faces, or do not leverage the temporal pose information available between consecutive video frames.

The problem addressed in this paper is the automatic head pose (yaw angle) estimation in real-world videos that are affected by the joint occurrence of arbitrary face scales, extreme head poses, non-uniform illumination conditions, partial occlusions, motion blur, background clutter, wide variability in image quality, and subject variability (see Figs. 1 and 2). We propose a novel hierarchical, temporal graphical model, which uses a number of complementary robust local invariant facial features, and leverages the dependencies between consecutive video frames, in order to substantially improve head pose estimation in real world scenarios. Furthermore, at each frame, the system assesses the probability density function over the pose angles, ranging from −90° to +90° (Fig. 2). The proposed hierarchical and temporal graphical model (Figs. 4 and 3
                     ) uses spatial codebook representations inferred from different local features, which have a high degree of invariance to various transforms, such as changes in scale, viewpoint, rotation and translation. The local feature detectors and descriptors are chosen such that they extract complementary information from the tracked face image (see Fig. 2): (i) facial edge points inferred from eyebrows, mouth etc. (Geometric Blur features [57]) (ii) facial anatomical regions extracted from eyes, forehead, cheeks etc. (Boundary Preserving Local Region features [58]) (iii) densely sampled patch-based features over the whole face image (SIFT and CSIFT [59,60]), and (iv) facial landmarks [55,56]. Some of the reasons for employing multiple features include: (i) to ensure that if one type of feature is not detected from a face, the other(s) can compensate for it, in order to robustly estimate head pose, and (ii) to complement each other. To calculate the pose distribution for each feature type, the codebook statistics are employed. These statistics are used in a graphical model to estimate the single video frame pose probability distribution. Next, the framework temporally models these head pose probabilities over a video sequence. Finally, the method performs non-parametric density estimation to obtain continuous head pose probabilities.

The proposed hierarchical temporal graphical model is a general framework, which can use any type of feature and can be adapted to any face related inference task while providing the estimated pose distribution as a prior knowledge. To demonstrate this, we show how one can adapt the proposed graphical model for a different facial classification task: facial attribute (soft biometric trait) estimation. Facial attributes are the contextual information which describe a subject, such as gender, age, skin color, hair color, facial hair and eye color. The crucial difference between the pose estimation and attribute estimation task is that pose is a dynamic class which changes over a video sequence whereas facial attribute is a static variable which does not change throughout a video sequence. The framework is adapted for each domain and pose is added as a feature to the system. The hypothesis is that the addition of pose information will improve the classification results.

We provide qualitative and quantitative results of the two set of experiments performed on 18,000 video frames from the McGill Real-world Face Video Database [37] (see Fig. 1), which is a publicly available dataset. This database provides the original frame, detected, aligned and masked face image, and labels for different facial classes (gender, head pose (yaw) and facial hair) over real-world videos recorded from subjects (completely free in movement) in natural scenes. Each video is collected under different illumination and background conditions, and the subject can exhibit a full range of head poses (in yaw, pitch and roll) and arbitrary facial occlusions. A comparison of some of the leading publicly available face databases is provided in Table 1
                      in order to justify our choice. The first set of experiments aims to evaluate pose estimation using the proposed hierarchical temporal graphical model, and the second set of experiments assesses the adaptation of the proposed hierarchical temporal graphical model to the attribute classification task, which leverages the estimated pose distribution. Our results are compared to the leading alternative approaches [23,55,51,33,32] in the pose estimation and in facial attribute (trait) classification [24,55,70]. Previous work on facial trait, e.g. gender, estimation, includes [21] which first uses mutual information for feature selection, and then fuses the selected features to perform gender classification from “single face images”. For a recent survey of the field, please refer to [22]. We also evaluate the proposed pose estimation methodology on a constrained database, i.e. the CMU Multi-PIE face database [52], which contains face images from different subjects from 13 viewpoints, different facial expressions and illumination conditions. Although the proposed method is applicable to any facial trait, we test the proposed graphical model on facial classes that have recently received attention, and which are relatively challenging: gender, and the presence of facial hair. Gender is a global trait, to which informative features are spread over the face, whereas facial hair is a more local trait and only particular regions of the face give evidence. The experimental results show that the proposed graphical model outperforms the alternative approaches in both the head pose and facial attribute estimation tasks.

The rest of the paper is organized as follows: Section 2 introduces the proposed hierarchical temporal probabilistic model for the task of pose estimation. Section 3 shows how to adapt the proposed model for the attribute classification problem while taking into account the pose distribution. Section 4 explains some of the methodology and implementation details. Section 5 explains the experimental results, with the summary and discussion presented in Section 6.

We now describe the proposed hierarchical probabilistic model (Fig. 3). In Level 1 the framework models the relationship between the statistics learned from different local invariant features on the detected face, and their corresponding head pose distributions. In Level 2, each frame pose distribution is inferred based on each feature-based head pose estimates inferred at Level 1. Finally, at the highest level (Fig. 4
                     ), the model leverages the temporal information to estimate the most likely head pose configuration over the entire video sequence. The proposed graphical model is undirected. Eqs. (11)–(14) present the expression of the edge potentials (derived from joint distributions).

As the first step, the automatic face localization/tracking framework in [37] is utilized over each video sequence to obtain a set of located and tracked face image, 
                        
                           
                              
                                 X
                              
                              
                                 int
                              
                              
                                 t
                              
                           
                        
                     , 
                        
                           t
                           ∈
                           
                              
                                 
                                    1
                                    ,
                                    2
                                    ,
                                    …
                                    ,
                                    T
                                 
                              
                           
                        
                     , where T is the maximum number of frames with successfully tracked faces. Note that while the framework in [37] is employed as it is shown to be robust to challenges in the real-world, other methods can also be employed to track and locate faces in videos. The ultimate goal here is to estimate the set of pose probability density functions throughout the video, 
                        
                           {
                           
                              
                                 
                                    
                                       Y
                                    
                                    
                                       ∼
                                    
                                 
                              
                              
                                 1
                              
                           
                           ,
                           
                              
                                 
                                    
                                       Y
                                    
                                    
                                       ∼
                                    
                                 
                              
                              
                                 2
                              
                           
                           ,
                           …
                           ,
                           
                              
                                 
                                    
                                       Y
                                    
                                    
                                       ∼
                                    
                                 
                              
                              
                                 t
                              
                           
                           ,
                           …
                           ,
                           
                              
                                 
                                    
                                       Y
                                    
                                    
                                       ∼
                                    
                                 
                              
                              
                                 T
                              
                           
                           }
                        
                     , given the single frame based pose distributions 
                        
                           {
                           
                              
                                 Y
                              
                              
                                 1
                              
                           
                           ,
                           
                              
                                 Y
                              
                              
                                 2
                              
                           
                           ,
                           …
                           ,
                           
                              
                                 Y
                              
                              
                                 t
                              
                           
                           ,
                           …
                           ,
                           
                              
                                 Y
                              
                              
                                 T
                              
                           
                           }
                        
                     , where 
                        
                           
                              
                                 
                                    
                                       Y
                                    
                                    
                                       ∼
                                    
                                 
                              
                              
                                 t
                              
                           
                           =
                           {
                           
                              
                                 ϕ
                              
                              
                                 1
                              
                           
                           ,
                           
                              
                                 ϕ
                              
                              
                                 2
                              
                           
                           ,
                           …
                           ,
                           
                              
                                 ϕ
                              
                              
                                 M
                              
                           
                           }
                        
                      is the set of head pose angles for each video frame. Given the graphical model in Fig. 4, the pose posterior distribution 
                        
                           p
                           (
                           
                              
                                 
                                    
                                       Y
                                    
                                    
                                       ∼
                                    
                                 
                              
                              
                                 t
                              
                           
                           |
                           
                              
                                 Y
                              
                              
                                 t
                                 -
                                 1
                              
                           
                           ,
                           
                              
                                 Y
                              
                              
                                 t
                              
                           
                           ,
                           
                              
                                 Y
                              
                              
                                 t
                                 +
                                 1
                              
                           
                           )
                        
                      is estimated via:
                        
                           (1)
                           
                              p
                              (
                              
                                 
                                    
                                       
                                          Y
                                       
                                       
                                          ∼
                                       
                                    
                                 
                                 
                                    t
                                 
                              
                              |
                              
                                 
                                    Y
                                 
                                 
                                    t
                                    -
                                    1
                                 
                              
                              ,
                              
                                 
                                    Y
                                 
                                 
                                    t
                                 
                              
                              ,
                              
                                 
                                    Y
                                 
                                 
                                    t
                                    +
                                    1
                                 
                              
                              )
                              =
                              
                                 
                                    1
                                 
                                 
                                    Z
                                    (
                                    
                                       
                                          Y
                                       
                                       
                                          t
                                          -
                                          1
                                       
                                    
                                    ,
                                    
                                       
                                          Y
                                       
                                       
                                          t
                                       
                                    
                                    ,
                                    
                                       
                                          Y
                                       
                                       
                                          t
                                          +
                                          1
                                       
                                    
                                    )
                                 
                              
                              exp
                              
                                 
                                    
                                       -
                                       
                                          
                                             U
                                          
                                          
                                             1
                                          
                                       
                                    
                                 
                              
                              ,
                           
                        
                     where Z is the normalization function, which is constant with respect to 
                        
                           
                              
                                 
                                    
                                       Y
                                    
                                    
                                       ∼
                                    
                                 
                              
                              
                                 t
                              
                           
                        
                     . The energy function 
                        
                           
                              
                                 U
                              
                              
                                 1
                              
                           
                        
                      is defined as: 
                        
                           
                              
                                 U
                              
                              
                                 1
                              
                           
                           =
                           
                              
                                 γ
                              
                              
                                 1
                              
                           
                           ϱ
                           (
                           
                              
                                 
                                    
                                       Y
                                    
                                    
                                       ∼
                                    
                                 
                              
                              
                                 t
                              
                           
                           ,
                           
                              
                                 Y
                              
                              
                                 t
                                 -
                                 1
                              
                           
                           )
                           +
                           
                              
                                 γ
                              
                              
                                 2
                              
                           
                           ϱ
                           (
                           
                              
                                 
                                    
                                       Y
                                    
                                    
                                       ∼
                                    
                                 
                              
                              
                                 t
                              
                           
                           ,
                           
                              
                                 Y
                              
                              
                                 t
                              
                           
                           )
                           +
                           
                              
                                 γ
                              
                              
                                 3
                              
                           
                           ϱ
                           (
                           
                              
                                 
                                    
                                       Y
                                    
                                    
                                       ∼
                                    
                                 
                              
                              
                                 t
                              
                           
                           ,
                           
                              
                                 Y
                              
                              
                                 t
                                 +
                                 1
                              
                           
                           )
                        
                     , where the weights 
                        
                           {
                           
                              
                                 γ
                              
                              
                                 1
                              
                           
                           ,
                           
                              
                                 γ
                              
                              
                                 2
                              
                           
                           ,
                           
                              
                                 γ
                              
                              
                                 3
                              
                           
                           }
                        
                      are learned from the training data. The potential function 
                        
                           ϱ
                        
                      models the unary cliques defined between pose distributions estimated at frame 
                        
                           t
                           ,
                           t
                           -
                           1
                        
                      and 
                        
                           t
                           +
                           1
                        
                     , and the t-th frame temporal pose distribution 
                        
                           
                              
                                 
                                    
                                       Y
                                    
                                    
                                       ∼
                                    
                                 
                              
                              
                                 t
                              
                           
                        
                     . 
                        
                           ϱ
                        
                      is defined by the corresponding probability distribution functions: 
                        
                           ϱ
                           (
                           
                              
                                 
                                    
                                       Y
                                    
                                    
                                       ∼
                                    
                                 
                              
                              
                                 i
                              
                           
                           ,
                           
                              
                                 Y
                              
                              
                                 j
                              
                           
                           )
                           =
                           -
                           log
                           
                              
                                 
                                    p
                                    (
                                    
                                       
                                          
                                             
                                                Y
                                             
                                             
                                                ∼
                                             
                                          
                                       
                                       
                                          i
                                       
                                    
                                    |
                                    
                                       
                                          Y
                                       
                                       
                                          j
                                       
                                    
                                    )
                                    p
                                    (
                                    
                                       
                                          Y
                                       
                                       
                                          j
                                       
                                    
                                    )
                                 
                              
                           
                        
                     , where 
                        
                           i
                           =
                           t
                        
                      and 
                        
                           j
                           ∈
                           {
                           t
                           -
                           1
                           ,
                           t
                           ,
                           t
                           +
                           1
                           }
                        
                     . The estimation of the potential function requires the computation of the posterior distribution 
                        
                           p
                           (
                           
                              
                                 
                                    
                                       Y
                                    
                                    
                                       ∼
                                    
                                 
                              
                              
                                 i
                              
                           
                           |
                           
                              
                                 Y
                              
                              
                                 j
                              
                           
                           )
                        
                     . This be achieved with using any probabilistic classifier, such as Bayesian, Relevance Vector Machine (RVM) or Random Forests (RF) [71]. However, one must first estimate the random variable 
                        
                           
                              
                                 Y
                              
                              
                                 j
                                 ∈
                                 {
                                 t
                                 -
                                 1
                                 ,
                                 t
                                 ,
                                 t
                                 +
                                 1
                                 }
                              
                           
                        
                     , which is achieved at the Level 2 of the proposed hierarchical graphical model. At Level 2, 
                        
                           
                              
                                 Y
                              
                              
                                 t
                              
                           
                        
                      is inferred through the estimation of the posterior distribution 
                        
                           p
                           (
                           
                              
                                 Y
                              
                              
                                 t
                              
                           
                           |
                           
                              
                                 y
                              
                              
                                 patch
                              
                              
                                 t
                              
                           
                           ,
                           
                              
                                 y
                              
                              
                                 edge
                              
                              
                                 t
                              
                           
                           ,
                           
                              
                                 y
                              
                              
                                 region
                              
                              
                                 t
                              
                           
                           ,
                           
                              
                                 y
                              
                              
                                 landmark
                              
                              
                                 t
                              
                           
                           )
                        
                     , where 
                        
                           {
                           
                              
                                 y
                              
                              
                                 patch
                              
                              
                                 t
                              
                           
                           ,
                           
                              
                                 y
                              
                              
                                 edge
                              
                              
                                 t
                              
                           
                           ,
                           
                              
                                 y
                              
                              
                                 region
                              
                              
                                 t
                              
                           
                           ,
                           
                              
                                 y
                              
                              
                                 landmark
                              
                              
                                 t
                              
                           
                           }
                        
                      are the patch, edge, region based and facial landmark based pose distributions. This is done by the proposed fully connected graph in Level 2. The parameterization and learning of this graph are explained in the following subsections (see Fig. 3).

Before Levels 1 and 2 of the hierarchical model are explained in detail, the terminology used in the proposed model is first defined.


                        
                           
                              
                                 
                                    X
                                 
                                 
                                    int
                                 
                                 
                                    t
                                 
                              
                           
                        is the set of intensity values in RGB space at time t for the pixels in the image of the tracked face: 
                           
                              
                                 
                                    X
                                 
                                 
                                    int
                                 
                                 
                                    t
                                 
                              
                              =
                              
                                 
                                    
                                       
                                          
                                             x
                                          
                                          
                                             i
                                             ,
                                             j
                                          
                                          
                                             t
                                          
                                       
                                       |
                                       ∀
                                       i
                                       ∈
                                       
                                          
                                             
                                                1
                                                ,
                                                …
                                                ,
                                                R
                                             
                                          
                                       
                                       ,
                                       ∀
                                       j
                                       ∈
                                       
                                          
                                             
                                                1
                                                ,
                                                …
                                                ,
                                                C
                                             
                                          
                                       
                                    
                                 
                              
                           
                        , where the image has size 
                           
                              R
                              ×
                              C
                           
                         and 
                           
                              
                                 
                                    x
                                 
                                 
                                    i
                                    ,
                                    j
                                 
                                 
                                    t
                                 
                              
                           
                         is the intensity value of an individual pixel at location 
                           
                              (
                              i
                              ,
                              j
                              )
                           
                        . Given the challenges presented by real-world environments, local invariant features are used due to their high degree of robustness to various transforms, such as changes in scale, viewpoint, rotation and translation. Extensive analysis of a number of different local invariant features (e.g. [72,73]) shows that using both densely and sparsely detected features, and representing these features with complementary descriptors is beneficial for classification/detection tasks.

The collection of the different feature representations (see Fig. 2) inferred from the tracked face 
                           
                              
                                 
                                    X
                                 
                                 
                                    int
                                 
                                 
                                    t
                                 
                              
                           
                         is denoted by 
                           
                              
                                 
                                    X
                                 
                                 
                                    t
                                 
                              
                              =
                              
                                 
                                    
                                       
                                          
                                             X
                                          
                                          
                                             patch
                                          
                                          
                                             t
                                          
                                       
                                       ,
                                       
                                          
                                             X
                                          
                                          
                                             edge
                                          
                                          
                                             t
                                          
                                       
                                       ,
                                       
                                          
                                             X
                                          
                                          
                                             region
                                          
                                          
                                             t
                                          
                                       
                                       ,
                                       
                                          
                                             X
                                          
                                          
                                             landmark
                                          
                                          
                                             t
                                          
                                       
                                    
                                 
                              
                           
                        , where 
                           
                              
                                 
                                    X
                                 
                                 
                                    patch
                                 
                                 
                                    t
                                 
                              
                           
                         is the densely sampled patch representation, 
                           
                              
                                 
                                    X
                                 
                                 
                                    edge
                                 
                                 
                                    t
                                 
                              
                           
                         is the sparsely sampled edge representation, 
                           
                              
                                 
                                    X
                                 
                                 
                                    region
                                 
                                 
                                    t
                                 
                              
                           
                         is the dense region, and 
                           
                              
                                 
                                    X
                                 
                                 
                                    landmark
                                 
                                 
                                    t
                                 
                              
                           
                         is the facial landmark representation. Here, 
                           
                              
                                 
                                    X
                                 
                                 
                                    patch
                                 
                                 
                                    t
                                 
                              
                           
                         is the collection of image patches extracted from 
                           
                              
                                 
                                    X
                                 
                                 
                                    int
                                 
                                 
                                    t
                                 
                              
                           
                        :
                           
                              (2)
                              
                                 
                                    
                                       X
                                    
                                    
                                       patch
                                    
                                    
                                       t
                                    
                                 
                                 =
                                 
                                    
                                       
                                          
                                             
                                                x
                                             
                                             
                                                p
                                             
                                             
                                                t
                                             
                                          
                                          |
                                          ∀
                                          p
                                          ∈
                                          
                                             
                                                
                                                   1
                                                   ,
                                                   …
                                                   ,
                                                   P
                                                
                                             
                                          
                                       
                                    
                                 
                                 ,
                              
                           
                        where P is the total number of patches and 
                           
                              
                                 
                                    x
                                 
                                 
                                    p
                                 
                                 
                                    t
                                 
                              
                           
                         denotes a single patch with index p, which contains two pieces of information: (1) the set of pixels in the patch, 
                           
                              
                                 
                                    
                                       
                                          
                                             
                                                x
                                             
                                             
                                                i
                                                ,
                                                j
                                             
                                             
                                                t
                                             
                                          
                                       
                                    
                                 
                                 
                                    p
                                 
                              
                           
                        , and (2) the location of the patch center, 
                           
                              (
                              
                                 
                                    r
                                 
                                 
                                    p
                                 
                              
                              ,
                              
                                 
                                    c
                                 
                                 
                                    p
                                 
                              
                              )
                           
                        :
                           
                              (3)
                              
                                 
                                    
                                       x
                                    
                                    
                                       p
                                    
                                    
                                       t
                                    
                                 
                                 =
                                 
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         
                                                            
                                                               
                                                                  
                                                                     x
                                                                  
                                                                  
                                                                     i
                                                                     ,
                                                                     j
                                                                  
                                                                  
                                                                     t
                                                                  
                                                               
                                                            
                                                         
                                                      
                                                      
                                                         p
                                                      
                                                   
                                                   ,
                                                   
                                                      
                                                         r
                                                      
                                                      
                                                         p
                                                      
                                                   
                                                   ,
                                                   
                                                      
                                                         c
                                                      
                                                      
                                                         p
                                                      
                                                   
                                                
                                             
                                          
                                          |
                                          
                                             
                                                
                                                   
                                                      
                                                         
                                                            x
                                                         
                                                         
                                                            i
                                                            ,
                                                            j
                                                         
                                                         
                                                            t
                                                         
                                                      
                                                   
                                                
                                             
                                             
                                                p
                                             
                                          
                                          ⊂
                                          
                                             
                                                X
                                             
                                             
                                                int
                                             
                                             
                                                t
                                             
                                          
                                          ,
                                       
                                    
                                 
                                 
                                    
                                       
                                          
                                             
                                                r
                                             
                                             
                                                p
                                             
                                          
                                          ∈
                                          
                                             
                                                
                                                   1
                                                   ,
                                                   …
                                                   ,
                                                   R
                                                
                                             
                                          
                                          ,
                                          
                                             
                                                c
                                             
                                             
                                                p
                                             
                                          
                                          ∈
                                          
                                             
                                                
                                                   1
                                                   ,
                                                   …
                                                   ,
                                                   C
                                                
                                             
                                          
                                       
                                    
                                 
                                 .
                              
                           
                        
                     


                        
                           
                              
                                 
                                    X
                                 
                                 
                                    edge
                                 
                                 
                                    t
                                 
                              
                           
                         denotes the collection of distinct points lying on the edge map inferred from 
                           
                              
                                 
                                    X
                                 
                                 
                                    int
                                 
                                 
                                    t
                                 
                              
                           
                        :
                           
                              (4)
                              
                                 
                                    
                                       X
                                    
                                    
                                       edge
                                    
                                    
                                       t
                                    
                                 
                                 =
                                 
                                    
                                       
                                          
                                             
                                                x
                                             
                                             
                                                e
                                             
                                             
                                                t
                                             
                                          
                                          |
                                          ∀
                                          e
                                          ∈
                                          
                                             
                                                
                                                   1
                                                   ,
                                                   …
                                                   ,
                                                   E
                                                
                                             
                                          
                                       
                                    
                                 
                                 ,
                              
                           
                        where E is the total number of detected edge points, and 
                           
                              
                                 
                                    x
                                 
                                 
                                    e
                                 
                                 
                                    t
                                 
                              
                           
                         is a single edge point with edge index e, which contains two pieces of information: (1) the set of pixels 
                           
                              
                                 
                                    
                                       
                                          
                                             
                                                x
                                             
                                             
                                                i
                                                ,
                                                j
                                             
                                             
                                                t
                                             
                                          
                                       
                                    
                                 
                                 
                                    e
                                 
                              
                           
                         that describes the e-th distinct edge point, and (2) location of the distinct edge point 
                           
                              (
                              
                                 
                                    r
                                 
                                 
                                    e
                                 
                              
                              ,
                              
                                 
                                    c
                                 
                                 
                                    e
                                 
                              
                              )
                           
                        :
                           
                              (5)
                              
                                 
                                    
                                       x
                                    
                                    
                                       e
                                    
                                    
                                       t
                                    
                                 
                                 =
                                 
                                    
                                       
                                          (
                                          
                                             
                                                
                                                   
                                                      
                                                         
                                                            x
                                                         
                                                         
                                                            i
                                                            ,
                                                            j
                                                         
                                                         
                                                            t
                                                         
                                                      
                                                   
                                                
                                             
                                             
                                                e
                                             
                                          
                                          ,
                                          
                                             
                                                r
                                             
                                             
                                                e
                                             
                                          
                                          ,
                                          
                                             
                                                c
                                             
                                             
                                                e
                                             
                                          
                                          )
                                          |
                                          
                                             
                                                
                                                   
                                                      
                                                         
                                                            x
                                                         
                                                         
                                                            i
                                                            ,
                                                            j
                                                         
                                                         
                                                            t
                                                         
                                                      
                                                   
                                                
                                             
                                             
                                                e
                                             
                                          
                                          ⊂
                                          
                                             
                                                X
                                             
                                             
                                                int
                                             
                                             
                                                t
                                             
                                          
                                          ,
                                       
                                    
                                 
                                 
                                    
                                       
                                          
                                             
                                                r
                                             
                                             
                                                e
                                             
                                          
                                          ∈
                                          
                                             
                                                
                                                   1
                                                   ,
                                                   …
                                                   ,
                                                   R
                                                
                                             
                                          
                                          ,
                                          
                                             
                                                c
                                             
                                             
                                                e
                                             
                                          
                                          ∈
                                          
                                             
                                                
                                                   1
                                                   ,
                                                   …
                                                   ,
                                                   C
                                                
                                             
                                          
                                       
                                    
                                 
                                 .
                              
                           
                        
                     


                        
                           
                              
                                 
                                    X
                                 
                                 
                                    region
                                 
                                 
                                    t
                                 
                              
                           
                         denotes the collection of facial regions extracted from 
                           
                              
                                 
                                    X
                                 
                                 
                                    int
                                 
                                 
                                    t
                                 
                              
                           
                        :
                           
                              (6)
                              
                                 
                                    
                                       X
                                    
                                    
                                       region
                                    
                                    
                                       t
                                    
                                 
                                 =
                                 
                                    
                                       
                                          
                                             
                                                x
                                             
                                             
                                                r
                                             
                                             
                                                t
                                             
                                          
                                          |
                                          ∀
                                          r
                                          ∈
                                          
                                             
                                                
                                                   1
                                                   ,
                                                   …
                                                   ,
                                                   R
                                                
                                             
                                          
                                       
                                    
                                 
                                 ,
                              
                           
                        where 
                           
                              R
                           
                         is the total number of facial regions extracted from 
                           
                              
                                 
                                    X
                                 
                                 
                                    int
                                 
                                 
                                    t
                                 
                              
                           
                        , and 
                           
                              
                                 
                                    x
                                 
                                 
                                    r
                                 
                                 
                                    t
                                 
                              
                           
                         is the rth single face region, which includes three pieces of information: (1) its set of pixels 
                           
                              
                                 
                                    
                                       
                                          
                                             
                                                x
                                             
                                             
                                                i
                                                ,
                                                j
                                             
                                             
                                                t
                                             
                                          
                                       
                                    
                                 
                                 
                                    r
                                 
                              
                           
                        , (2) the location of the region center 
                           
                              (
                              
                                 
                                    r
                                 
                                 
                                    r
                                 
                              
                              ,
                              
                                 
                                    c
                                 
                                 
                                    r
                                 
                              
                              )
                           
                        , and (3) the region scale (size) 
                           
                              
                                 
                                    s
                                 
                                 
                                    r
                                 
                              
                           
                        :
                           
                              (7)
                              
                                 
                                    
                                       x
                                    
                                    
                                       r
                                    
                                    
                                       t
                                    
                                 
                                 =
                                 
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         
                                                            
                                                               
                                                                  
                                                                     x
                                                                  
                                                                  
                                                                     i
                                                                     ,
                                                                     j
                                                                  
                                                                  
                                                                     t
                                                                  
                                                               
                                                            
                                                         
                                                      
                                                      
                                                         r
                                                      
                                                   
                                                   ,
                                                   
                                                      
                                                         r
                                                      
                                                      
                                                         r
                                                      
                                                   
                                                   ,
                                                   
                                                      
                                                         c
                                                      
                                                      
                                                         r
                                                      
                                                   
                                                   ,
                                                   
                                                      
                                                         s
                                                      
                                                      
                                                         r
                                                      
                                                   
                                                
                                             
                                          
                                          |
                                          
                                             
                                                
                                                   
                                                      
                                                         
                                                            x
                                                         
                                                         
                                                            i
                                                            ,
                                                            j
                                                         
                                                         
                                                            t
                                                         
                                                      
                                                   
                                                
                                             
                                             
                                                r
                                             
                                          
                                          ⊂
                                          
                                             
                                                X
                                             
                                             
                                                int
                                             
                                             
                                                t
                                             
                                          
                                          ,
                                          
                                             
                                                r
                                             
                                             
                                                r
                                             
                                          
                                          ∈
                                          
                                             
                                                
                                                   1
                                                   ,
                                                   …
                                                   ,
                                                   R
                                                
                                             
                                          
                                          ,
                                          
                                             
                                                c
                                             
                                             
                                                r
                                             
                                          
                                          ∈
                                          
                                             
                                                
                                                   1
                                                   ,
                                                   …
                                                   ,
                                                   C
                                                
                                             
                                          
                                          ,
                                          
                                             
                                                s
                                             
                                             
                                                r
                                             
                                          
                                          ∈
                                          
                                             
                                                Z
                                             
                                             
                                                +
                                             
                                          
                                       
                                    
                                 
                                 .
                              
                           
                        
                     


                        
                           
                              
                                 
                                    X
                                 
                                 
                                    landmark
                                 
                                 
                                    t
                                 
                              
                           
                         denotes the collection of facial landmarks extracted from 
                           
                              
                                 
                                    X
                                 
                                 
                                    int
                                 
                                 
                                    t
                                 
                              
                           
                        :
                           
                              (8)
                              
                                 
                                    
                                       X
                                    
                                    
                                       landmark
                                    
                                    
                                       t
                                    
                                 
                                 =
                                 
                                    
                                       
                                          
                                             
                                                x
                                             
                                             
                                                fl
                                             
                                             
                                                t
                                             
                                          
                                          |
                                          ∀
                                          l
                                          ∈
                                          
                                             
                                                
                                                   1
                                                   ,
                                                   …
                                                   ,
                                                   L
                                                
                                             
                                          
                                       
                                    
                                 
                                 ,
                              
                           
                        where L is the total number of facial landmarks extracted from 
                           
                              
                                 
                                    X
                                 
                                 
                                    int
                                 
                                 
                                    t
                                 
                              
                           
                        , and 
                           
                              
                                 
                                    x
                                 
                                 
                                    fl
                                 
                                 
                                    t
                                 
                              
                           
                         is the 
                           
                              fl
                           
                        th single facial landmark, which contains the facial landmark location 
                           
                              (
                              
                                 
                                    r
                                 
                                 
                                    fl
                                 
                              
                              ,
                              
                                 
                                    c
                                 
                                 
                                    fl
                                 
                              
                              )
                           
                        .

To model each of these representations, one can use different features. Here, the features chosen are: (i) densely sampled “SIFT” [59] and “Color SIFT (CSIFT)” [60] features for modeling the face image patches, (ii) sparsely sampled “Geometric Blur (GB)” [57] features for modeling the distinct facial edge points, (iii) “Boundary Preserving Local Region (BPLR)” [58], and (iv) facial landmark [55,56] features for modeling the facial anatomical regions.

For the landmark features, we use the location information directly. For the remaining features, rather than using the pixel intensities directly for each feature type, the corresponding descriptor d is extracted from each feature point’s intensity representation, such as 
                           
                              
                                 
                                    
                                       
                                          
                                             
                                                x
                                             
                                             
                                                i
                                                ,
                                                j
                                             
                                             
                                                t
                                             
                                          
                                       
                                    
                                 
                                 
                                    p
                                 
                              
                              ,
                              
                                 
                                    
                                       
                                          
                                             
                                                x
                                             
                                             
                                                i
                                                ,
                                                j
                                             
                                             
                                                t
                                             
                                          
                                       
                                    
                                 
                                 
                                    e
                                 
                              
                           
                         or 
                           
                              
                                 
                                    
                                       
                                          
                                             
                                                x
                                             
                                             
                                                i
                                                ,
                                                j
                                             
                                             
                                                t
                                             
                                          
                                       
                                    
                                 
                                 
                                    r
                                 
                              
                           
                        . For the patch representation, SIFT and CSIFT descriptors are used, 
                           
                              
                                 
                                    d
                                 
                                 
                                    sift
                                    ,
                                    p
                                    =
                                    k
                                 
                                 
                                    t
                                 
                              
                           
                         and 
                           
                              
                                 
                                    d
                                 
                                 
                                    csift
                                    ,
                                    p
                                    =
                                    k
                                 
                                 
                                    t
                                 
                              
                           
                        . In the case of edge features, the GB descriptor 
                           
                              
                                 
                                    d
                                 
                                 
                                    GB
                                    ,
                                    e
                                    =
                                    l
                                 
                                 
                                    t
                                 
                              
                           
                         is chosen. Pyramids of Histograms of Oriented Gradients are used as the region descriptor, i.e. 
                           
                              
                                 
                                    d
                                 
                                 
                                    PHOG
                                    ,
                                    r
                                    =
                                    m
                                 
                                 
                                    t
                                 
                              
                           
                        . A visual vocabulary (codebook) is learned for each feature type, using the corresponding feature descriptors and an appropriate mapping function which takes the extracted feature’s location information into account. Next, each extracted feature is represented by a visual word (codeword), from which codeword statistics will be learned. Occurrence statistics, for example, model how likely it is to observe a codeword for a pose value of interest whereas co-occurrence statistics measure which codewords are likely to occur together for a given class value. These statistics will be later used in the potential functions. Note that in the rest of the formulation, instead of the pixel intensity values, the corresponding descriptors d are used in 
                           
                              
                                 
                                    x
                                 
                                 
                                    p
                                    =
                                    k
                                 
                                 
                                    t
                                 
                              
                              ,
                              
                                 
                                    x
                                 
                                 
                                    e
                                    =
                                    l
                                 
                                 
                                    t
                                 
                              
                           
                         and 
                           
                              
                                 
                                    x
                                 
                                 
                                    r
                                    =
                                    m
                                 
                                 
                                    t
                                 
                              
                           
                        .

We now define each of the facial feature types used in the proposed model:


                        
                           The Patch-based Representation:
                         The patch representation achieves a dense sampling of the given facial image. To model each image patch, SIFT and CSIFT vocabularies are used. This choice is motivated by the observed performance increase when CSIFT is combined with SIFT, as in [74]. To map the k-th image patch 
                           
                              
                                 
                                    x
                                 
                                 
                                    p
                                    =
                                    k
                                 
                                 
                                    t
                                 
                              
                           
                         to a visual word 
                           
                              
                                 
                                    f
                                 
                                 
                                    sift
                                    ,
                                    p
                                    =
                                    k
                                 
                                 
                                    t
                                 
                              
                           
                         learned using the SIFT and CSIFT descriptors, a mapping function g is used such that 
                           
                              g
                              :
                              
                                 
                                    x
                                 
                                 
                                    p
                                    =
                                    k
                                 
                                 
                                    t
                                 
                              
                              →
                              
                                 
                                    f
                                 
                                 
                                    sift
                                    ,
                                    p
                                    =
                                    k
                                 
                                 
                                    t
                                 
                              
                           
                         and 
                           
                              g
                              :
                              
                                 
                                    x
                                 
                                 
                                    p
                                    =
                                    k
                                 
                                 
                                    t
                                 
                              
                              →
                              
                                 
                                    f
                                 
                                 
                                    csift
                                    ,
                                    p
                                    =
                                    k
                                 
                                 
                                    t
                                 
                              
                           
                         (that is 
                           
                              
                                 
                                    X
                                 
                                 
                                    patch
                                 
                                 
                                    t
                                 
                              
                              →
                              
                                 
                                    F
                                 
                                 
                                    patch
                                 
                                 
                                    t
                                 
                              
                           
                        ). Rather than using the patch index p as the spatial information [37], here we use the patch location 
                           
                              (
                              
                                 
                                    r
                                 
                                 
                                    p
                                 
                              
                              ,
                              
                                 
                                    c
                                 
                                 
                                    p
                                 
                              
                              )
                           
                         in the coding and pooling phases to leverage the spatial information. By adding two more dimensions to the descriptor space, this permits modeling the spatial inter-patch relationship. Because faces are aligned in the preprocessing step, this mapping provides better modeling for the face vocabulary.


                        
                           The Edge-based Representation:
                         To detect the key facial edge points and to calculate the corresponding descriptor around each edge point, the Geometric Blur (GB) framework ([75,57]) is used. Geometric blur is shown to be effective when applied to sparse edge points. Thus, first the oriented edge filter responses are extracted from face images. Then, rejection sampling over the edge map is used to obtain sparse interest points along edges. Once these interest points are detected, GB descriptors are calculated around each point [57]. Unlike uniform Gaussian blur-based descriptors, GB models the amount of blur proportional to the distance from the corresponding point. Here the motivation is that the distortion due to the affine transformations should be modeled properly: the amount of blur varies linearly with distance from corresponding points. To map the l-th distinct edge point 
                           
                              
                                 
                                    x
                                 
                                 
                                    e
                                    =
                                    l
                                 
                                 
                                    t
                                 
                              
                           
                         to a visual word 
                           
                              
                                 
                                    f
                                 
                                 
                                    GB
                                    ,
                                    e
                                    =
                                    l
                                 
                                 
                                    t
                                 
                              
                           
                         learned using GB descriptors, we use the mapping function 
                           
                              g
                              :
                              
                                 
                                    x
                                 
                                 
                                    e
                                    =
                                    l
                                 
                                 
                                    t
                                 
                              
                              →
                              
                                 
                                    f
                                 
                                 
                                    GB
                                    ,
                                    e
                                    =
                                    l
                                 
                                 
                                    t
                                 
                              
                           
                         (that is 
                           
                              
                                 
                                    X
                                 
                                 
                                    edge
                                 
                                 
                                    t
                                 
                              
                              →
                              
                                 
                                    F
                                 
                                 
                                    edge
                                 
                                 
                                    t
                                 
                              
                           
                        ). Similar to the facial patch occurrence model, the location information 
                           
                              (
                              
                                 
                                    r
                                 
                                 
                                    e
                                 
                              
                              ,
                              
                                 
                                    c
                                 
                                 
                                    e
                                 
                              
                              )
                           
                         is used in the coding and pooling steps.


                        
                           The Region-based Representation:
                         Anatomical regions, such as the mouth, the eyes, the ears and the eyebrows, can provide some pose information. Local region detectors and descriptors are used to model such anatomical regions. To achieve this, boundary-preserving local regions (BPLRs) [58] 
                        
                           
                              
                                 
                                    x
                                 
                                 
                                    r
                                    =
                                    m
                                 
                                 
                                    t
                                 
                              
                           
                         are computed. BPLRs are densely sampled local regions obtained from a given face image, and they preserve the shape of the facial structure on which they are detected. The BPLR detection is achieved based on the following steps [58]. The algorithm first obtains multiple overlapping segmentations from a given face image, for which the corresponding distance transform maps are computed. Then, it divides each segment into regular grid cells, and samples an element feature in each cell. The cell position and scale information is determined by the maximal distance transform value in the cell. Then, it links all elements using a minimum spanning tree, which extends connections and integrates multiple segmentations. Finally, it outputs a set of overlapping regions which contains a group of linked elements within the tree, namely BPLRs. Once the BPLRs are extracted, Pyramids of Histograms of Oriented Gradients (PHOG) descriptors are computed over the gPb (globalized probability of boundary)-edge map for each detected BPLR. The mapping function 
                           
                              g
                              :
                              
                                 
                                    x
                                 
                                 
                                    r
                                    =
                                    m
                                 
                                 
                                    t
                                 
                              
                              →
                              
                                 
                                    f
                                 
                                 
                                    PHOG
                                    ,
                                    r
                                    =
                                    m
                                 
                                 
                                    t
                                 
                              
                           
                         not only uses the spatial information in the coding and pooling steps, but also the scale (size) information for each extracted BPLR.


                        
                           The Facial Landmark-based Representation:
                         The facial landmarks by Xiong and De la Torre [55,56] have been shown to successfully estimate head pose. Thus, if they are detected in a video frame, we incorporate the facial landmarks location information into our graphical model as another feature type.

As Eq. 1 shows, inferring the video based pose distribution 
                           
                              
                                 
                                    
                                       
                                          Y
                                       
                                       
                                          ∼
                                       
                                    
                                 
                                 
                                    t
                                 
                              
                           
                         requires the estimation of single frame-based pose distribution 
                           
                              
                                 
                                    Y
                                 
                                 
                                    t
                                 
                              
                           
                        . Level 2 provides the inferred 
                           
                              
                                 
                                    Y
                                 
                                 
                                    t
                                 
                              
                           
                        s to Level 3 through the estimation the posterior distribution 
                           
                              p
                              (
                              
                                 
                                    Y
                                 
                                 
                                    t
                                 
                              
                              |
                              
                                 
                                    y
                                 
                                 
                                    patch
                                 
                                 
                                    t
                                 
                              
                              ,
                              
                                 
                                    y
                                 
                                 
                                    edge
                                 
                                 
                                    t
                                 
                              
                              ,
                              
                                 
                                    y
                                 
                                 
                                    region
                                 
                                 
                                    t
                                 
                              
                              ,
                              
                                 
                                    y
                                 
                                 
                                    landmark
                                 
                                 
                                    t
                                 
                              
                              )
                           
                         for the face image in t-th video frame. 
                           
                              {
                              
                                 
                                    y
                                 
                                 
                                    patch
                                 
                                 
                                    t
                                 
                              
                              ,
                              
                                 
                                    y
                                 
                                 
                                    edge
                                 
                                 
                                    t
                                 
                              
                              ,
                              
                                 
                                    y
                                 
                                 
                                    region
                                 
                                 
                                    t
                                 
                              
                              ,
                              
                                 
                                    y
                                 
                                 
                                    landmark
                                 
                                 
                                    t
                                 
                              
                              }
                           
                         are the patch, edge, region based and facial landmark based pose distributions. This is done by learning different combinations of patch, edge, region and landmark classifier pose distributions. To infer the posterior probability 
                           
                              p
                              (
                              
                                 
                                    Y
                                 
                                 
                                    t
                                 
                              
                              |
                              
                                 
                                    y
                                 
                                 
                                    patch
                                 
                                 
                                    t
                                 
                              
                              ,
                              
                                 
                                    y
                                 
                                 
                                    edge
                                 
                                 
                                    t
                                 
                              
                              ,
                              
                                 
                                    y
                                 
                                 
                                    region
                                 
                                 
                                    t
                                 
                              
                              ,
                              
                                 
                                    y
                                 
                                 
                                    landmark
                                 
                                 
                                    t
                                 
                              
                              )
                           
                        , given the hierarchical model in Fig. 3, the following expression is derived:
                           
                              (9)
                              
                                 p
                                 (
                                 
                                    
                                       Y
                                    
                                    
                                       t
                                    
                                 
                                 |
                                 
                                    
                                       y
                                    
                                    
                                       patch
                                    
                                    
                                       t
                                    
                                 
                                 ,
                                 
                                    
                                       y
                                    
                                    
                                       edge
                                    
                                    
                                       t
                                    
                                 
                                 ,
                                 
                                    
                                       y
                                    
                                    
                                       region
                                    
                                    
                                       t
                                    
                                 
                                 ,
                                 
                                    
                                       y
                                    
                                    
                                       landmark
                                    
                                    
                                       t
                                    
                                 
                                 )
                                 =
                                 
                                    
                                       1
                                    
                                    
                                       Z
                                       (
                                       
                                          
                                             y
                                          
                                          
                                             patch
                                          
                                          
                                             t
                                          
                                       
                                       ,
                                       
                                          
                                             y
                                          
                                          
                                             edge
                                          
                                          
                                             t
                                          
                                       
                                       ,
                                       
                                          
                                             y
                                          
                                          
                                             region
                                          
                                          
                                             t
                                          
                                       
                                       ,
                                       
                                          
                                             y
                                          
                                          
                                             landmark
                                          
                                          
                                             t
                                          
                                       
                                       )
                                    
                                 
                                 exp
                                 
                                    
                                       
                                          -
                                          
                                             
                                                U
                                             
                                             
                                                2
                                             
                                          
                                       
                                    
                                 
                                 ,
                              
                           
                        whereas before 
                           
                              Z
                           
                         denotes the normalization function and the energy function 
                           
                              
                                 
                                    U
                                 
                                 
                                    2
                                 
                              
                           
                         is defined as:
                           
                              (10)
                              
                                 
                                    
                                       U
                                    
                                    
                                       2
                                    
                                 
                                 =
                                 
                                    
                                       β
                                    
                                    
                                       1
                                    
                                 
                                 
                                    
                                       ν
                                    
                                    
                                       1
                                    
                                 
                                 (
                                 
                                    
                                       Y
                                    
                                    
                                       t
                                    
                                 
                                 ,
                                 
                                    
                                       y
                                    
                                    
                                       patch
                                    
                                    
                                       t
                                    
                                 
                                 )
                                 +
                                 
                                    
                                       β
                                    
                                    
                                       2
                                    
                                 
                                 
                                    
                                       ν
                                    
                                    
                                       1
                                    
                                 
                                 (
                                 
                                    
                                       Y
                                    
                                    
                                       t
                                    
                                 
                                 ,
                                 
                                    
                                       y
                                    
                                    
                                       edge
                                    
                                    
                                       t
                                    
                                 
                                 )
                                 +
                                 
                                    
                                       β
                                    
                                    
                                       3
                                    
                                 
                                 
                                    
                                       ν
                                    
                                    
                                       1
                                    
                                 
                                 (
                                 
                                    
                                       Y
                                    
                                    
                                       t
                                    
                                 
                                 ,
                                 
                                    
                                       y
                                    
                                    
                                       region
                                    
                                    
                                       t
                                    
                                 
                                 )
                                 +
                                 
                                    
                                       β
                                    
                                    
                                       4
                                    
                                 
                                 
                                    
                                       ν
                                    
                                    
                                       1
                                    
                                 
                                 (
                                 
                                    
                                       Y
                                    
                                    
                                       t
                                    
                                 
                                 ,
                                 
                                    
                                       y
                                    
                                    
                                       landmark
                                    
                                    
                                       t
                                    
                                 
                                 )
                                 +
                                 
                                    
                                       β
                                    
                                    
                                       5
                                    
                                 
                                 
                                    
                                       ν
                                    
                                    
                                       2
                                    
                                 
                                 (
                                 
                                    
                                       Y
                                    
                                    
                                       t
                                    
                                 
                                 ,
                                 
                                    
                                       y
                                    
                                    
                                       patch
                                    
                                    
                                       t
                                    
                                 
                                 ,
                                 
                                    
                                       y
                                    
                                    
                                       edge
                                    
                                    
                                       t
                                    
                                 
                                 )
                                 +
                                 
                                    
                                       β
                                    
                                    
                                       6
                                    
                                 
                                 
                                    
                                       ν
                                    
                                    
                                       2
                                    
                                 
                                 (
                                 
                                    
                                       Y
                                    
                                    
                                       t
                                    
                                 
                                 ,
                                 
                                    
                                       y
                                    
                                    
                                       patch
                                    
                                    
                                       t
                                    
                                 
                                 ,
                                 
                                    
                                       y
                                    
                                    
                                       region
                                    
                                    
                                       t
                                    
                                 
                                 )
                                 +
                                 
                                    
                                       β
                                    
                                    
                                       7
                                    
                                 
                                 
                                    
                                       ν
                                    
                                    
                                       2
                                    
                                 
                                 (
                                 
                                    
                                       Y
                                    
                                    
                                       t
                                    
                                 
                                 ,
                                 
                                    
                                       y
                                    
                                    
                                       edge
                                    
                                    
                                       t
                                    
                                 
                                 ,
                                 
                                    
                                       y
                                    
                                    
                                       region
                                    
                                    
                                       t
                                    
                                 
                                 )
                                 +
                                 ⋯
                                 +
                                 
                                    
                                       β
                                    
                                    
                                       11
                                    
                                 
                                 
                                    
                                       ν
                                    
                                    
                                       3
                                    
                                 
                                 (
                                 
                                    
                                       Y
                                    
                                    
                                       t
                                    
                                 
                                 ,
                                 
                                    
                                       y
                                    
                                    
                                       patch
                                    
                                    
                                       t
                                    
                                 
                                 ,
                                 
                                    
                                       y
                                    
                                    
                                       edge
                                    
                                    
                                       t
                                    
                                 
                                 ,
                                 
                                    
                                       y
                                    
                                    
                                       region
                                    
                                    
                                       t
                                    
                                 
                                 )
                                 +
                                 ⋯
                                 +
                                 
                                    
                                       β
                                    
                                    
                                       15
                                    
                                 
                                 
                                    
                                       ν
                                    
                                    
                                       4
                                    
                                 
                                 (
                                 
                                    
                                       Y
                                    
                                    
                                       t
                                    
                                 
                                 ,
                                 
                                    
                                       y
                                    
                                    
                                       patch
                                    
                                    
                                       t
                                    
                                 
                                 ,
                                 
                                    
                                       y
                                    
                                    
                                       edge
                                    
                                    
                                       t
                                    
                                 
                                 ,
                                 
                                    
                                       y
                                    
                                    
                                       region
                                    
                                    
                                       t
                                    
                                 
                                 ,
                                 
                                    
                                       y
                                    
                                    
                                       landmark
                                    
                                    
                                       t
                                    
                                 
                                 )
                                 .
                              
                           
                        
                     


                        
                           
                              
                                 
                                    
                                       
                                          
                                             β
                                          
                                          
                                             1
                                          
                                       
                                       ,
                                       …
                                       ,
                                       
                                          
                                             β
                                          
                                          
                                             15
                                          
                                       
                                    
                                 
                              
                           
                         are the weights for each possible clique and potential function combinations (of the fully connected graph), which are learned using the optimization strategy in [76], namely the de-randomized evolution strategy with covariance matrix adaptation. The potential function 
                           
                              ν
                           
                         models the possible cliques of t-th frame pose distribution from three different feature representations, such as unary, pairwise, triplet and fourth order cliques. In the interests of maintaining clarity we do not show all 15 potential functions here, we show only a subset. 
                           
                              ν
                           
                         is defined by the corresponding probability distribution functions:
                           
                              (11)
                              
                                 
                                    
                                       ν
                                    
                                    
                                       1
                                    
                                 
                                 (
                                 
                                    
                                       Y
                                    
                                    
                                       t
                                    
                                 
                                 ,
                                 
                                    
                                       y
                                    
                                    
                                       patch
                                    
                                    
                                       t
                                    
                                 
                                 )
                                 =
                                 -
                                 log
                                 
                                    
                                       
                                          p
                                          (
                                          
                                             
                                                Y
                                             
                                             
                                                t
                                             
                                          
                                          |
                                          
                                             
                                                y
                                             
                                             
                                                patch
                                             
                                             
                                                t
                                             
                                          
                                          )
                                          p
                                          (
                                          
                                             
                                                y
                                             
                                             
                                                patch
                                             
                                             
                                                t
                                             
                                          
                                          )
                                       
                                    
                                 
                                 ,
                              
                           
                        
                        
                           
                              (12)
                              
                                 
                                    
                                       ν
                                    
                                    
                                       2
                                    
                                 
                                 (
                                 
                                    
                                       Y
                                    
                                    
                                       t
                                    
                                 
                                 ,
                                 
                                    
                                       y
                                    
                                    
                                       patch
                                    
                                    
                                       t
                                    
                                 
                                 ,
                                 
                                    
                                       y
                                    
                                    
                                       edge
                                    
                                    
                                       t
                                    
                                 
                                 )
                                 =
                                 -
                                 log
                                 
                                    
                                       
                                          p
                                          (
                                          
                                             
                                                Y
                                             
                                             
                                                t
                                             
                                          
                                          |
                                          
                                             
                                                y
                                             
                                             
                                                patch
                                             
                                             
                                                t
                                             
                                          
                                          ,
                                          
                                             
                                                y
                                             
                                             
                                                edge
                                             
                                             
                                                t
                                             
                                          
                                          )
                                          p
                                          (
                                          
                                             
                                                y
                                             
                                             
                                                patch
                                             
                                             
                                                t
                                             
                                          
                                          ,
                                          
                                             
                                                y
                                             
                                             
                                                edge
                                             
                                             
                                                t
                                             
                                          
                                          )
                                       
                                    
                                 
                                 ,
                              
                           
                        
                        
                           
                              (13)
                              
                                 
                                    
                                       ν
                                    
                                    
                                       3
                                    
                                 
                                 (
                                 
                                    
                                       Y
                                    
                                    
                                       t
                                    
                                 
                                 ,
                                 
                                    
                                       y
                                    
                                    
                                       patch
                                    
                                    
                                       t
                                    
                                 
                                 ,
                                 
                                    
                                       y
                                    
                                    
                                       edge
                                    
                                    
                                       t
                                    
                                 
                                 ,
                                 
                                    
                                       y
                                    
                                    
                                       region
                                    
                                    
                                       t
                                    
                                 
                                 )
                                 =
                                 -
                                 log
                                 
                                    
                                       
                                          p
                                          (
                                          
                                             
                                                Y
                                             
                                             
                                                t
                                             
                                          
                                          |
                                          
                                             
                                                y
                                             
                                             
                                                patch
                                             
                                             
                                                t
                                             
                                          
                                          ,
                                          
                                             
                                                y
                                             
                                             
                                                edge
                                             
                                             
                                                t
                                             
                                          
                                          ,
                                          
                                             
                                                y
                                             
                                             
                                                region
                                             
                                             
                                                t
                                             
                                          
                                          )
                                          p
                                          (
                                          
                                             
                                                y
                                             
                                             
                                                patch
                                             
                                             
                                                t
                                             
                                          
                                          ,
                                          
                                             
                                                y
                                             
                                             
                                                edge
                                             
                                             
                                                t
                                             
                                          
                                          ,
                                          
                                             
                                                y
                                             
                                             
                                                region
                                             
                                             
                                                t
                                             
                                          
                                          )
                                       
                                    
                                 
                                 ,
                              
                           
                        
                        
                           
                              (14)
                              
                                 
                                    
                                       ν
                                    
                                    
                                       4
                                    
                                 
                                 (
                                 
                                    
                                       Y
                                    
                                    
                                       t
                                    
                                 
                                 ,
                                 
                                    
                                       y
                                    
                                    
                                       patch
                                    
                                    
                                       t
                                    
                                 
                                 ,
                                 
                                    
                                       y
                                    
                                    
                                       edge
                                    
                                    
                                       t
                                    
                                 
                                 ,
                                 
                                    
                                       y
                                    
                                    
                                       region
                                    
                                    
                                       t
                                    
                                 
                                 ,
                                 
                                    
                                       y
                                    
                                    
                                       landmark
                                    
                                    
                                       t
                                    
                                 
                                 )
                                 =
                                 -
                                 log
                                 
                                    
                                       
                                          p
                                          (
                                          
                                             
                                                Y
                                             
                                             
                                                t
                                             
                                          
                                          |
                                          
                                             
                                                y
                                             
                                             
                                                patch
                                             
                                             
                                                t
                                             
                                          
                                          ,
                                          
                                             
                                                y
                                             
                                             
                                                edge
                                             
                                             
                                                t
                                             
                                          
                                          ,
                                          
                                             
                                                y
                                             
                                             
                                                region
                                             
                                             
                                                t
                                             
                                          
                                          ,
                                          
                                             
                                                y
                                             
                                             
                                                landmark
                                             
                                             
                                                t
                                             
                                          
                                          )
                                          p
                                          (
                                          
                                             
                                                y
                                             
                                             
                                                patch
                                             
                                             
                                                t
                                             
                                          
                                          ,
                                          
                                             
                                                y
                                             
                                             
                                                edge
                                             
                                             
                                                t
                                             
                                          
                                          ,
                                          
                                             
                                                y
                                             
                                             
                                                region
                                             
                                             
                                                t
                                             
                                          
                                          ,
                                          
                                             
                                                y
                                             
                                             
                                                landmark
                                             
                                             
                                                t
                                             
                                          
                                          )
                                       
                                    
                                 
                                 .
                              
                           
                        
                     


                        
                           
                              
                                 
                                    
                                       
                                          
                                             y
                                          
                                          
                                             patch
                                          
                                          
                                             t
                                          
                                       
                                       ,
                                       
                                          
                                             y
                                          
                                          
                                             edge
                                          
                                          
                                             t
                                          
                                       
                                       ,
                                       
                                          
                                             y
                                          
                                          
                                             region
                                          
                                          
                                             t
                                          
                                       
                                       ,
                                       
                                          
                                             y
                                          
                                          
                                             landmark
                                          
                                          
                                             t
                                          
                                       
                                    
                                 
                              
                           
                         are the pose distributions, which are inferred through Section 2.3. The estimation of the joint probability 
                           
                              p
                              (
                              
                                 
                                    Y
                                 
                                 
                                    t
                                 
                              
                              ,
                              
                                 
                                    y
                                 
                                 
                                    patch
                                 
                                 
                                    t
                                 
                              
                              )
                           
                         is achieved using the training database: 
                           
                              p
                              (
                              
                                 
                                    Y
                                 
                                 
                                    t
                                 
                              
                              ,
                              
                                 
                                    y
                                 
                                 
                                    patch
                                 
                                 
                                    t
                                 
                              
                              )
                              ∝
                              k
                              (
                              
                                 
                                    Y
                                 
                                 
                                    t
                                 
                              
                              ,
                              
                                 
                                    y
                                 
                                 
                                    patch
                                 
                                 
                                    t
                                 
                              
                              )
                              +
                              
                                 
                                    d
                                 
                                 
                                    t
                                 
                              
                           
                        , where 
                           
                              k
                              (
                              
                                 
                                    Y
                                 
                                 
                                    t
                                 
                              
                              ,
                              
                                 
                                    y
                                 
                                 
                                    patch
                                 
                                 
                                    t
                                 
                              
                              )
                           
                         is the count of the joint occurrence event 
                           
                              (
                              
                                 
                                    Y
                                 
                                 
                                    t
                                 
                              
                              ,
                              
                                 
                                    y
                                 
                                 
                                    patch
                                 
                                 
                                    t
                                 
                              
                              )
                           
                        , and 
                           
                              
                                 
                                    d
                                 
                                 
                                    t
                                 
                              
                           
                         is the Dirichlet regularization parameter required to compensate for the sparsity. Because a uniform prior is assumed, 
                           
                              
                                 
                                    d
                                 
                                 
                                    t
                                 
                              
                           
                         is constant for all t. Note that probabilities in other cliques are calculated in a similar fashion. The posterior probabilities, such as 
                           
                              p
                              (
                              
                                 
                                    Y
                                 
                                 
                                    t
                                 
                              
                              |
                              
                                 
                                    y
                                 
                                 
                                    patch
                                 
                                 
                                    t
                                 
                              
                              )
                              ,
                              p
                              (
                              
                                 
                                    Y
                                 
                                 
                                    t
                                 
                              
                              |
                              
                                 
                                    y
                                 
                                 
                                    patch
                                 
                                 
                                    t
                                 
                              
                              ,
                              
                                 
                                    y
                                 
                                 
                                    edge
                                 
                                 
                                    t
                                 
                              
                              )
                              ,
                              p
                              (
                              
                                 
                                    Y
                                 
                                 
                                    t
                                 
                              
                              |
                              
                                 
                                    y
                                 
                                 
                                    patch
                                 
                                 
                                    t
                                 
                              
                              ,
                              
                                 
                                    y
                                 
                                 
                                    edge
                                 
                                 
                                    t
                                 
                              
                              ,
                              
                                 
                                    y
                                 
                                 
                                    region
                                 
                                 
                                    t
                                 
                              
                              )
                           
                         and 
                           
                              p
                              (
                              
                                 
                                    Y
                                 
                                 
                                    t
                                 
                              
                              |
                              
                                 
                                    y
                                 
                                 
                                    patch
                                 
                                 
                                    t
                                 
                              
                              ,
                              
                                 
                                    y
                                 
                                 
                                    edge
                                 
                                 
                                    t
                                 
                              
                              ,
                              
                                 
                                    y
                                 
                                 
                                    region
                                 
                                 
                                    t
                                 
                              
                              ,
                              
                                 
                                    y
                                 
                                 
                                    landmark
                                 
                                 
                                    t
                                 
                              
                              )
                           
                         on the other hand, are calculated using Random Forests (RF) [71]. Once the Level 2 probabilities 
                           
                              
                                 
                                    
                                       
                                          
                                             Y
                                          
                                          
                                             1
                                          
                                       
                                       ,
                                       
                                          
                                             Y
                                          
                                          
                                             2
                                          
                                       
                                       ,
                                       ⋯
                                       ,
                                       
                                          
                                             Y
                                          
                                          
                                             t
                                          
                                       
                                       ,
                                       ⋯
                                       ,
                                       
                                          
                                             Y
                                          
                                          
                                             T
                                          
                                       
                                    
                                 
                              
                           
                         are estimated, 
                           
                              
                                 
                                    
                                       
                                          Y
                                       
                                       
                                          ∼
                                       
                                    
                                 
                                 
                                    t
                                 
                              
                           
                         can be calculated using Eq. 1. Note that 
                           
                              
                                 
                                    Y
                                 
                                 
                                    t
                                 
                              
                           
                         and 
                           
                              
                                 
                                    
                                       
                                          Y
                                       
                                       
                                          ∼
                                       
                                    
                                 
                                 
                                    t
                                 
                              
                           
                         are real-valued vectors representing the entire head pose distribution. Next, the entire pose density is estimated for 1° intervals in the range 
                           
                              [
                              -
                              90
                              °
                              ,
                              +
                              90
                              °
                              ]
                           
                         over 
                           
                              
                                 
                                    
                                       
                                          Y
                                       
                                       
                                          ∼
                                       
                                    
                                 
                                 
                                    t
                                 
                              
                           
                        . Gaussian kernel-based non-parametric model fitting is used since the initial pose densities do not follow any known parametric distribution.

To infer 
                           
                              
                                 
                                    
                                       
                                          
                                             y
                                          
                                          
                                             patch
                                          
                                          
                                             t
                                          
                                       
                                       ,
                                       
                                          
                                             y
                                          
                                          
                                             edge
                                          
                                          
                                             t
                                          
                                       
                                       ,
                                       
                                          
                                             y
                                          
                                          
                                             region
                                          
                                          
                                             t
                                          
                                       
                                       ,
                                       
                                          
                                             y
                                          
                                          
                                             landmark
                                          
                                          
                                             t
                                          
                                       
                                    
                                 
                              
                           
                        , we need to model the posterior distributions 
                           
                              p
                              (
                              
                                 
                                    y
                                 
                                 
                                    patch
                                 
                                 
                                    t
                                 
                              
                              |
                              
                                 
                                    X
                                 
                                 
                                    patch
                                 
                                 
                                    t
                                 
                              
                              )
                              ,
                              p
                              (
                              
                                 
                                    y
                                 
                                 
                                    edge
                                 
                                 
                                    t
                                 
                              
                              |
                              
                                 
                                    X
                                 
                                 
                                    edge
                                 
                                 
                                    t
                                 
                              
                              )
                              ,
                              p
                              (
                              
                                 
                                    y
                                 
                                 
                                    region
                                 
                                 
                                    t
                                 
                              
                              |
                              
                                 
                                    X
                                 
                                 
                                    region
                                 
                                 
                                    t
                                 
                              
                              )
                           
                         and 
                           
                              p
                              (
                              
                                 
                                    y
                                 
                                 
                                    landmark
                                 
                                 
                                    t
                                 
                              
                              |
                              
                                 
                                    X
                                 
                                 
                                    landmark
                                 
                                 
                                    t
                                 
                              
                              )
                           
                        . The posterior distribution for the patch-based features is given by:
                           
                              (15)
                              
                                 p
                                 (
                                 
                                    
                                       y
                                    
                                    
                                       patch
                                    
                                    
                                       t
                                    
                                 
                                 |
                                 
                                    
                                       X
                                    
                                    
                                       patch
                                    
                                    
                                       t
                                    
                                 
                                 )
                                 =
                                 
                                    
                                       1
                                    
                                    
                                       Z
                                       (
                                       
                                          
                                             X
                                          
                                          
                                             patch
                                          
                                          
                                             t
                                          
                                       
                                       )
                                    
                                 
                                 exp
                                 
                                    
                                       
                                          -
                                          
                                             
                                                U
                                             
                                             
                                                patch
                                             
                                          
                                       
                                    
                                 
                                 ,
                              
                           
                        where 
                           
                              Z
                           
                         is the normalization function and, given the proposed graphical model, the energy function U is defined as:
                           
                              (16)
                              
                                 
                                    
                                       U
                                    
                                    
                                       patch
                                    
                                 
                                 =
                                 
                                    
                                       λ
                                    
                                    
                                       1
                                    
                                 
                                 
                                    
                                       φ
                                    
                                    
                                       1
                                       ,
                                       sift
                                    
                                 
                                 (
                                 
                                    
                                       y
                                    
                                    
                                       patch
                                    
                                    
                                       t
                                    
                                 
                                 ,
                                 
                                    
                                       X
                                    
                                    
                                       patch
                                    
                                    
                                       t
                                    
                                 
                                 )
                                 +
                                 
                                    
                                       λ
                                    
                                    
                                       2
                                    
                                 
                                 
                                    
                                       φ
                                    
                                    
                                       1
                                       ,
                                       csift
                                    
                                 
                                 (
                                 
                                    
                                       y
                                    
                                    
                                       patch
                                    
                                    
                                       t
                                    
                                 
                                 ,
                                 
                                    
                                       X
                                    
                                    
                                       patch
                                    
                                    
                                       t
                                    
                                 
                                 )
                                 +
                                 
                                    
                                       λ
                                    
                                    
                                       3
                                    
                                 
                                 
                                    
                                       φ
                                    
                                    
                                       2
                                       ,
                                       sift
                                    
                                 
                                 (
                                 
                                    
                                       y
                                    
                                    
                                       patch
                                    
                                    
                                       t
                                    
                                 
                                 ,
                                 S
                                 (
                                 
                                    
                                       X
                                    
                                    
                                       patch
                                    
                                    
                                       t
                                    
                                 
                                 )
                                 )
                                 +
                                 
                                    
                                       λ
                                    
                                    
                                       4
                                    
                                 
                                 
                                    
                                       φ
                                    
                                    
                                       2
                                       ,
                                       csift
                                    
                                 
                                 (
                                 
                                    
                                       y
                                    
                                    
                                       patch
                                    
                                    
                                       t
                                    
                                 
                                 ,
                                 S
                                 (
                                 
                                    
                                       X
                                    
                                    
                                       patch
                                    
                                    
                                       t
                                    
                                 
                                 )
                                 )
                                 ,
                              
                           
                        where the potential 
                           
                              
                                 
                                    φ
                                 
                                 
                                    1
                                 
                              
                           
                         models the occurrence relationship between patch features (e.g., SIFT or CSIFT) and the t-th frame patch-based pose distribution 
                           
                              
                                 
                                    y
                                 
                                 
                                    patch
                                 
                                 
                                    t
                                 
                              
                           
                        . The pairwise potential 
                           
                              
                                 
                                    φ
                                 
                                 
                                    2
                                 
                              
                           
                        , on the other hand, models the co-occurrence relationship between pairs of patch features and 
                           
                              
                                 
                                    y
                                 
                                 
                                    patch
                                 
                                 
                                    t
                                 
                              
                           
                        . The weights 
                           
                              
                                 
                                    
                                       
                                          
                                             λ
                                          
                                          
                                             1
                                          
                                       
                                       ,
                                       
                                          
                                             λ
                                          
                                          
                                             2
                                          
                                       
                                       ,
                                       
                                          
                                             λ
                                          
                                          
                                             3
                                          
                                       
                                       ,
                                       
                                          
                                             λ
                                          
                                          
                                             4
                                          
                                       
                                    
                                 
                              
                           
                         are learned from the training data using 2-fold cross validation. Note that these weights are learned locally.

For edge-based features, the posterior distribution is defined as:
                           
                              (17)
                              
                                 p
                                 (
                                 
                                    
                                       y
                                    
                                    
                                       edge
                                    
                                    
                                       t
                                    
                                 
                                 |
                                 
                                    
                                       X
                                    
                                    
                                       edge
                                    
                                    
                                       t
                                    
                                 
                                 )
                                 =
                                 
                                    
                                       1
                                    
                                    
                                       Z
                                       (
                                       
                                          
                                             X
                                          
                                          
                                             edge
                                          
                                          
                                             t
                                          
                                       
                                       )
                                    
                                 
                                 exp
                                 
                                    
                                       
                                          -
                                          
                                             
                                                U
                                             
                                             
                                                edge
                                             
                                          
                                       
                                    
                                 
                                 ,
                              
                           
                        where 
                           
                              Z
                           
                         is the normalization function and the energy function 
                           
                              
                                 
                                    U
                                 
                                 
                                    edge
                                 
                              
                           
                         is defined as:
                           
                              (18)
                              
                                 
                                    
                                       U
                                    
                                    
                                       edge
                                    
                                 
                                 =
                                 ζ
                                 (
                                 
                                    
                                       y
                                    
                                    
                                       edge
                                    
                                    
                                       t
                                    
                                 
                                 ,
                                 
                                    
                                       X
                                    
                                    
                                       edge
                                    
                                    
                                       t
                                    
                                 
                                 )
                                 ,
                              
                           
                        where 
                           
                              ζ
                           
                         is the edge related potential function, which models the relationship between edge features and the t-th frame edge-based pose distribution

The region and landmark posterior distributions, i.e. 
                           
                              p
                              (
                              
                                 
                                    y
                                 
                                 
                                    region
                                 
                                 
                                    t
                                 
                              
                              |
                              
                                 
                                    X
                                 
                                 
                                    region
                                 
                                 
                                    t
                                 
                              
                              )
                           
                         and 
                           
                              p
                              (
                              
                                 
                                    y
                                 
                                 
                                    landmark
                                 
                                 
                                    t
                                 
                              
                              |
                              
                                 
                                    X
                                 
                                 
                                    landmark
                                 
                                 
                                    t
                                 
                              
                              )
                           
                        , are modeled via the potential functions of 
                           
                              
                                 
                                    Φ
                                 
                                 
                                    1
                                 
                              
                              (
                              
                                 
                                    Y
                                 
                                 
                                    region
                                 
                                 
                                    t
                                 
                              
                              ,
                              
                                 
                                    X
                                 
                                 
                                    region
                                 
                                 
                                    t
                                 
                              
                              )
                           
                         and 
                           
                              ω
                              (
                              
                                 
                                    Y
                                 
                                 
                                    landmark
                                 
                                 
                                    t
                                 
                              
                              ,
                              
                                 
                                    X
                                 
                                 
                                    landmark
                                 
                                 
                                    t
                                 
                              
                              )
                           
                        , in a similar fashion to the edge-based features.

The following expressions are used to model the occurrence potential function for SIFT and CSIFT based vocabulary (recall that using the codebook mapping 
                              
                                 g
                                 :
                                 
                                    
                                       X
                                    
                                    
                                       patch
                                    
                                    
                                       t
                                    
                                 
                                 →
                                 
                                    
                                       F
                                    
                                    
                                       patch
                                    
                                    
                                       t
                                    
                                 
                              
                            for SIFT and CSIFT separately):
                              
                                 (19)
                                 
                                    
                                       
                                          φ
                                       
                                       
                                          1
                                          ,
                                          sift
                                       
                                    
                                    (
                                    
                                       
                                          y
                                       
                                       
                                          patch
                                       
                                       
                                          t
                                       
                                    
                                    ,
                                    
                                       
                                          X
                                       
                                       
                                          patch
                                       
                                       
                                          t
                                       
                                    
                                    )
                                    =
                                    -
                                    log
                                    
                                       
                                          
                                             p
                                             (
                                             
                                                
                                                   y
                                                
                                                
                                                   patch
                                                
                                                
                                                   t
                                                
                                             
                                             |
                                             
                                                
                                                   F
                                                
                                                
                                                   patch
                                                
                                                
                                                   t
                                                
                                             
                                             )
                                             p
                                             (
                                             
                                                
                                                   F
                                                
                                                
                                                   patch
                                                
                                                
                                                   t
                                                
                                             
                                             )
                                          
                                       
                                    
                                    ,
                                 
                              
                           and
                              
                                 (20)
                                 
                                    
                                       
                                          φ
                                       
                                       
                                          1
                                          ,
                                          csift
                                       
                                    
                                    (
                                    
                                       
                                          y
                                       
                                       
                                          patch
                                       
                                       
                                          t
                                       
                                    
                                    ,
                                    
                                       
                                          X
                                       
                                       
                                          patch
                                       
                                       
                                          t
                                       
                                    
                                    )
                                    =
                                    -
                                    log
                                    
                                       
                                          
                                             p
                                             (
                                             
                                                
                                                   y
                                                
                                                
                                                   patch
                                                
                                                
                                                   t
                                                
                                             
                                             |
                                             
                                                
                                                   F
                                                
                                                
                                                   patch
                                                
                                                
                                                   t
                                                
                                             
                                             )
                                             p
                                             (
                                             
                                                
                                                   F
                                                
                                                
                                                   patch
                                                
                                                
                                                   t
                                                
                                             
                                             )
                                          
                                       
                                    
                                    ,
                                 
                              
                           where uniform priors are assumed. Any classifier can be used to model the posterior probabilities 
                              
                                 p
                                 (
                                 
                                    
                                       y
                                    
                                    
                                       patch
                                    
                                    
                                       t
                                    
                                 
                                 |
                                 
                                    
                                       F
                                    
                                    
                                       patch
                                    
                                    
                                       t
                                    
                                 
                                 )
                              
                            for SIFT and CSIFT. In this work, we choose to use a Random Forest (RF) [71] to perform inference. A RF is a discriminative classier that consists of an ensemble of decision tree classifiers, where the final classification is determined by summing the votes cast by each individual tree. Due to the random selection of a subset of training data and features, RF is less prone to overfitting than traditional single decision trees. Also the RF classifier is computationally efficient and provides probabilistic outputs.

Co-occurrence statistics of densely sampled patch-based visual words also provide discriminative information about the pose class. Thus, the local co-occurrence statistics are extracted from a neighborhood region 
                              
                                 N
                                 (
                                 
                                    
                                       x
                                    
                                    
                                       p
                                       =
                                       k
                                    
                                    
                                       t
                                    
                                 
                                 )
                              
                            defined around each image patch 
                              
                                 
                                    
                                       x
                                    
                                    
                                       p
                                       =
                                       k
                                    
                                    
                                       t
                                    
                                 
                              
                            in 
                              
                                 
                                    
                                       X
                                    
                                    
                                       patch
                                    
                                    
                                       t
                                    
                                 
                              
                           , namely 
                              
                                 S
                                 (
                                 
                                    
                                       X
                                    
                                    
                                       patch
                                    
                                    
                                       t
                                    
                                 
                                 )
                              
                            . Similar to the occurrence statistics, co-occurrence statistics are defined over the visual vocabulary space: 
                              
                                 S
                                 (
                                 
                                    
                                       F
                                    
                                    
                                       patch
                                    
                                    
                                       t
                                    
                                 
                                 )
                              
                           . The following expressions are proposed to model the “patch co-occurrence” potential function:
                              
                                 (21)
                                 
                                    
                                       
                                          φ
                                       
                                       
                                          2
                                          ,
                                          sift
                                       
                                    
                                    (
                                    
                                       
                                          y
                                       
                                       
                                          patch
                                       
                                       
                                          t
                                       
                                    
                                    ,
                                    S
                                    (
                                    
                                       
                                          X
                                       
                                       
                                          patch
                                       
                                       
                                          t
                                       
                                    
                                    )
                                    )
                                    =
                                    -
                                    log
                                    
                                       
                                          
                                             p
                                             (
                                             
                                                
                                                   y
                                                
                                                
                                                   patch
                                                
                                                
                                                   t
                                                
                                             
                                             |
                                             S
                                             (
                                             
                                                
                                                   F
                                                
                                                
                                                   patch
                                                
                                                
                                                   t
                                                
                                             
                                             )
                                             )
                                             p
                                             (
                                             S
                                             (
                                             
                                                
                                                   F
                                                
                                                
                                                   patch
                                                
                                                
                                                   t
                                                
                                             
                                             )
                                             )
                                          
                                       
                                    
                                    ,
                                 
                              
                           
                        

Note that 
                              
                                 
                                    
                                       φ
                                    
                                    
                                       2
                                       ,
                                       csift
                                    
                                 
                              
                            is calculated similarly.

The following expressions model the facial edge potential function using the mapping defined earlier, i.e. 
                              
                                 g
                                 :
                                 
                                    
                                       X
                                    
                                    
                                       edge
                                    
                                    
                                       t
                                    
                                 
                                 →
                                 
                                    
                                       F
                                    
                                    
                                       edge
                                    
                                    
                                       t
                                    
                                 
                              
                           :
                              
                                 (22)
                                 
                                    ζ
                                    
                                       
                                          
                                             
                                                
                                                   y
                                                
                                                
                                                   edge
                                                
                                                
                                                   t
                                                
                                             
                                             ,
                                             
                                                
                                                   X
                                                
                                                
                                                   edge
                                                
                                                
                                                   t
                                                
                                             
                                          
                                       
                                    
                                    =
                                    -
                                    log
                                    
                                       
                                          
                                             p
                                             
                                                
                                                   
                                                      
                                                         
                                                            y
                                                         
                                                         
                                                            edge
                                                         
                                                         
                                                            t
                                                         
                                                      
                                                      |
                                                      
                                                         
                                                            F
                                                         
                                                         
                                                            edge
                                                         
                                                         
                                                            t
                                                         
                                                      
                                                   
                                                
                                             
                                             p
                                             
                                                
                                                   
                                                      
                                                         
                                                            F
                                                         
                                                         
                                                            edge
                                                         
                                                         
                                                            t
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                    ,
                                 
                              
                           where 
                              
                                 p
                                 (
                                 
                                    
                                       F
                                    
                                    
                                       edge
                                    
                                    
                                       t
                                    
                                 
                                 )
                              
                            is assumed to be uniform, and the posterior probability 
                              
                                 p
                                 (
                                 
                                    
                                       y
                                    
                                    
                                       edge
                                    
                                    
                                       t
                                    
                                 
                                 |
                                 
                                    
                                       F
                                    
                                    
                                       edge
                                    
                                    
                                       t
                                    
                                 
                                 )
                              
                            is also estimated using a Random Forest classifier.

Modeling the potential functions 
                              
                                 
                                    
                                       Φ
                                    
                                    
                                       1
                                    
                                 
                                 
                                    
                                       
                                          
                                             
                                                y
                                             
                                             
                                                region
                                             
                                             
                                                t
                                             
                                          
                                          ,
                                          
                                             
                                                X
                                             
                                             
                                                region
                                             
                                             
                                                t
                                             
                                          
                                       
                                    
                                 
                              
                            and 
                              
                                 ω
                                 
                                    
                                       
                                          
                                             
                                                y
                                             
                                             
                                                landmark
                                             
                                             
                                                t
                                             
                                          
                                          ,
                                          
                                             
                                                X
                                             
                                             
                                                landmark
                                             
                                             
                                                t
                                             
                                          
                                       
                                    
                                 
                              
                            is achieved by using a similar method to estimate the edge-based potential functions. To estimate the posterior probabilities 
                              
                                 p
                                 (
                                 
                                    
                                       y
                                    
                                    
                                       region
                                    
                                    
                                       t
                                    
                                 
                                 |
                                 
                                    
                                       F
                                    
                                    
                                       region
                                    
                                    
                                       t
                                    
                                 
                                 )
                              
                            and 
                              
                                 p
                                 (
                                 
                                    
                                       y
                                    
                                    
                                       landmark
                                    
                                    
                                       t
                                    
                                 
                                 |
                                 
                                    
                                       F
                                    
                                    
                                       landmark
                                    
                                    
                                       t
                                    
                                 
                                 )
                              
                           , a Random Forest classifier is also used.

During the training, the model is provided with 
                              
                                 
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      Y
                                                   
                                                   
                                                      t
                                                   
                                                
                                             
                                             
                                                ∼
                                             
                                          
                                          ,
                                          
                                             
                                                Y
                                             
                                             
                                                t
                                             
                                          
                                          ,
                                          
                                             
                                                y
                                             
                                             
                                                edge
                                             
                                             
                                                t
                                             
                                          
                                          ,
                                          
                                             
                                                y
                                             
                                             
                                                patch
                                             
                                             
                                                t
                                             
                                          
                                          ,
                                          
                                             
                                                y
                                             
                                             
                                                region
                                             
                                             
                                                t
                                             
                                          
                                          ,
                                          
                                             
                                                y
                                             
                                             
                                                landmark
                                             
                                             
                                                t
                                             
                                          
                                       
                                    
                                 
                              
                           , the given head pose ground truth distribution. During training, the weights 
                              
                                 
                                    
                                       
                                          
                                             
                                                γ
                                             
                                             
                                                i
                                                ∈
                                                {
                                                1
                                                ,
                                                2
                                                ,
                                                3
                                                }
                                             
                                          
                                          ,
                                          
                                             
                                                λ
                                             
                                             
                                                i
                                                ∈
                                                {
                                                1
                                                ,
                                                …
                                                ,
                                                4
                                                }
                                             
                                          
                                          ,
                                          
                                             
                                                β
                                             
                                             
                                                i
                                                ∈
                                                {
                                                1
                                                ,
                                                …
                                                ,
                                                15
                                                }
                                             
                                          
                                       
                                    
                                 
                              
                           , and the conditional, joint and prior probabilities used to calculate the potential functions are learned. When a test video is given, first the occurrence and co-occurrence statistics are computed from different feature representations to be able to estimate 
                              
                                 
                                    
                                       
                                          
                                             
                                                y
                                             
                                             
                                                patch
                                             
                                             
                                                t
                                             
                                          
                                          ,
                                          
                                             
                                                y
                                             
                                             
                                                edge
                                             
                                             
                                                t
                                             
                                          
                                          ,
                                          
                                             
                                                y
                                             
                                             
                                                region
                                             
                                             
                                                t
                                             
                                          
                                          ,
                                          
                                             
                                                y
                                             
                                             
                                                landmark
                                             
                                             
                                                t
                                             
                                          
                                       
                                    
                                 
                              
                           . Since the weights are learned and the 
                              
                                 
                                    
                                       y
                                    
                                    
                                       t
                                    
                                 
                              
                            are already estimated, the head pose distribution for each video frame 
                              
                                 
                                    
                                       Y
                                    
                                    
                                       t
                                    
                                 
                              
                            can also be estimated. Then, for each possible value of 
                              
                                 
                                    
                                       
                                          
                                             Y
                                          
                                          
                                             t
                                          
                                       
                                    
                                    
                                       ∼
                                    
                                 
                              
                           , the pose distribution 
                              
                                 p
                                 (
                                 
                                    
                                       
                                          
                                             Y
                                          
                                          
                                             ∼
                                          
                                       
                                    
                                    
                                       t
                                    
                                 
                                 |
                                 
                                    
                                       Y
                                    
                                    
                                       t
                                       -
                                       1
                                    
                                 
                                 ,
                                 
                                    
                                       Y
                                    
                                    
                                       t
                                    
                                 
                                 ,
                                 
                                    
                                       Y
                                    
                                    
                                       t
                                       +
                                       1
                                    
                                 
                                 )
                              
                            is estimated.

In Section 2, we show how to estimate pose distribution 
                        
                           
                              
                                 
                                    
                                       Y
                                    
                                    
                                       ∼
                                    
                                 
                              
                              
                                 t
                              
                           
                        
                      for a video frame at time t via the proposed hierarchical temporal graphical model. Now, we are interested in adapting the proposed model to the facial attribute (trait) classification (e.g. gender, facial hair) task while leveraging the estimated pose distribution 
                        
                           
                              
                                 
                                    
                                       Y
                                    
                                    
                                       ∼
                                    
                                 
                              
                              
                                 t
                              
                           
                        
                     . Fig. 5
                      shows all the levels of the adapted graphical model. Levels 1, 2 and 3 are similar to the model explained in Section 2. Compared to the hierarchical model explained in Section 2, there are two additional levels: Level 4 and Level 5. Level 4 is defined as the fully connected graph between (i) the single frame based attribute distribution 
                        
                           
                              
                                 G
                              
                              
                                 t
                              
                           
                        
                      at the frame t, and (ii) the temporal pose distribution 
                        
                           
                              
                                 
                                    
                                       Y
                                    
                                    
                                       ∼
                                    
                                 
                              
                              
                                 t
                              
                           
                        
                      estimated by the proposed model in Section 2, the patch-based, edge-based, region-based and landmark-based facial attribute distributions, defined as 
                        
                           
                              
                                 g
                              
                              
                                 patch
                              
                              
                                 t
                              
                           
                           ,
                           
                              
                                 g
                              
                              
                                 edge
                              
                              
                                 t
                              
                           
                           ,
                           
                              
                                 g
                              
                              
                                 region
                              
                              
                                 t
                              
                           
                        
                     , and 
                        
                           
                              
                                 g
                              
                              
                                 landmark
                              
                              
                                 t
                              
                           
                        
                     . Level 4 probabilities are estimated in a similar fashion to Section 2.2. However, in this fully connected graph there are 31 weights and potential functions to learn from the training data. Level 5, on the other hand, models the temporal aspect of the facial trait. The goal here is to infer the most probable facial attribute value 
                        
                           
                              
                                 z
                              
                              
                                 ˆ
                              
                           
                        
                      given the attribute distributions estimated from the entire video sequence. To this end, we define a classifier which computes the posterior probability of the attribute (trait) class Z given the inferred attribute distributions from all frames 
                        
                           G
                           =
                           {
                           
                              
                                 G
                              
                              
                                 1
                              
                           
                           ,
                           
                              
                                 G
                              
                              
                                 2
                              
                           
                           ,
                           …
                           ,
                           
                              
                                 G
                              
                              
                                 t
                              
                           
                           ,
                           …
                           ,
                           
                              
                                 G
                              
                              
                                 T
                              
                           
                           }
                        
                     :
                        
                           (23)
                           
                              
                                 
                                    z
                                 
                                 
                                    ˆ
                                 
                              
                              =
                              
                                 
                                    
                                       max
                                    
                                    
                                       z
                                       ∈
                                       Z
                                    
                                 
                              
                              
                                 
                                    
                                       log
                                       
                                          
                                             p
                                             (
                                             z
                                             |
                                             {
                                             
                                                
                                                   G
                                                
                                                
                                                   1
                                                
                                             
                                             ,
                                             
                                                
                                                   G
                                                
                                                
                                                   2
                                                
                                             
                                             ,
                                             …
                                             ,
                                             
                                                
                                                   G
                                                
                                                
                                                   t
                                                
                                             
                                             ,
                                             …
                                             ,
                                             
                                                
                                                   G
                                                
                                                
                                                   T
                                                
                                             
                                             }
                                             )
                                          
                                          
                                             p
                                             (
                                             
                                                
                                                   z
                                                
                                                
                                                   ‾
                                                
                                             
                                             |
                                             {
                                             
                                                
                                                   G
                                                
                                                
                                                   1
                                                
                                             
                                             ,
                                             
                                                
                                                   G
                                                
                                                
                                                   2
                                                
                                             
                                             ,
                                             …
                                             ,
                                             
                                                
                                                   G
                                                
                                                
                                                   t
                                                
                                             
                                             ,
                                             …
                                             ,
                                             
                                                
                                                   G
                                                
                                                
                                                   T
                                                
                                             
                                             }
                                             )
                                          
                                       
                                    
                                 
                              
                              ,
                           
                        
                     where 
                        
                           
                              
                                 z
                              
                              
                                 ˆ
                              
                           
                        
                      is the binary classification decision defined over the classifier 
                        
                           p
                           (
                           z
                           |
                           G
                           )
                           ,
                           z
                        
                      and 
                        
                           
                              
                                 z
                              
                              
                                 ˆ
                              
                           
                        
                      are opposing attribute values (e.g., in the case of gender, 
                        
                           z
                           =
                           male
                        
                      and 
                        
                           
                              
                                 z
                              
                              
                                 ˆ
                              
                           
                           =
                           female
                        
                     ). Alternatively, using the conditional independence structure shown in the proposed graphical model (see Fig. 5), Eq. (23) can be written as
                        
                           (24)
                           
                              
                                 
                                    z
                                 
                                 
                                    ˆ
                                 
                              
                              =
                              
                                 
                                    
                                       max
                                    
                                    
                                       z
                                       ∈
                                       Z
                                    
                                 
                              
                              
                                 
                                    
                                       log
                                       
                                          
                                             p
                                             (
                                             
                                                
                                                   G
                                                
                                                
                                                   1
                                                
                                             
                                             |
                                             z
                                             )
                                             p
                                             (
                                             
                                                
                                                   G
                                                
                                                
                                                   2
                                                
                                             
                                             |
                                             z
                                             )
                                             ⋯
                                             p
                                             (
                                             
                                                
                                                   G
                                                
                                                
                                                   t
                                                
                                             
                                             |
                                             z
                                             )
                                             ⋯
                                             p
                                             (
                                             
                                                
                                                   G
                                                
                                                
                                                   T
                                                
                                             
                                             |
                                             z
                                             )
                                             p
                                             (
                                             z
                                             )
                                          
                                          
                                             p
                                             (
                                             
                                                
                                                   G
                                                
                                                
                                                   1
                                                
                                             
                                             |
                                             
                                                
                                                   z
                                                
                                                
                                                   ‾
                                                
                                             
                                             )
                                             p
                                             (
                                             
                                                
                                                   G
                                                
                                                
                                                   2
                                                
                                             
                                             |
                                             
                                                
                                                   z
                                                
                                                
                                                   ‾
                                                
                                             
                                             )
                                             ⋯
                                             p
                                             (
                                             
                                                
                                                   G
                                                
                                                
                                                   t
                                                
                                             
                                             |
                                             
                                                
                                                   z
                                                
                                                
                                                   ‾
                                                
                                             
                                             )
                                             ⋯
                                             p
                                             (
                                             
                                                
                                                   G
                                                
                                                
                                                   T
                                                
                                             
                                             |
                                             
                                                
                                                   z
                                                
                                                
                                                   ‾
                                                
                                             
                                             )
                                             p
                                             (
                                             
                                                
                                                   z
                                                
                                                
                                                   ‾
                                                
                                             
                                             )
                                          
                                       
                                    
                                 
                              
                              ,
                           
                        
                     where 
                        
                           p
                           (
                           z
                           )
                        
                      is the a priori probability on the class attribute value z. 
                        
                           p
                           (
                           
                              
                                 G
                              
                              
                                 t
                              
                           
                           |
                           z
                           )
                        
                      is the likelihood for the class attribute Z over the attribute distribution estimated at t-th frame in the video sequence. Eq. (24) states that the estimated facial attribute in each frame is conditionally independent given the video trait hypothesis z. The temporal modeling of individual frame-based class beliefs, in Eq. (24), is achieved via multiplication of the individual likelihood functions 
                        
                           p
                           (
                           
                              
                                 G
                              
                              
                                 t
                              
                           
                           |
                           z
                           )
                        
                     . For example, in gender classification, 
                        
                           p
                           (
                           
                              
                                 G
                              
                              
                                 t
                              
                           
                           |
                           z
                           )
                        
                      models the likelihood that the subject is male given the facial trait estimate at a single frame.

In the context of real-world videos, it is often the case that features change rapidly from frame to frame, not just due to occlusion and fast movement, but because the conditions are changing (e.g. changes in lighting, scale, orientation). To overcome this inconsistency in the presence of features over frames, our framework models frame-to-frame feature dependencies through information passed between the nodes at the highest level (level 5). We investigated different clique and local connectivity models in level 5, including a fully connected graphical model. It is observed that the fully connected model did not improve the results and was intractably expensive. Thus, we employed the simpler, but computationally efficient and effective temporal model explained in here.

The patch-based representation was obtained by setting the total number of patches P to 2304, i.e. 48×48 grid defined over 
                        
                           
                              
                                 X
                              
                              
                                 int
                              
                              
                                 t
                              
                           
                        
                     . Rejection sampling was done over the edge map to obtain 300 sparse interest points along edges. Each face image was represented using three types of normalized histograms in Level 1 of the proposed model: (1) densely sampled SIFT and C-SIFT based texture histogram using a codebook with size 2000 and 6000 respectively, (2) GB based shape (edge) histogram using a codebook with size 4000, and (3) BPLR based region histogram using a codebook with size 8000. Note that the codebook sizes were empirically decided using the training data as the ones which maximized the single frame based trait classification accuracy using the proposed approach. In the facial landmark based representation, 
                        
                           L
                           =
                           49
                        
                     .

The co-occurrence based patch features that were used in the potential functions 
                        
                           
                              
                                 φ
                              
                              
                                 2
                                 ,
                                 sift
                              
                           
                           (
                           
                              
                                 y
                              
                              
                                 patch
                              
                              
                                 t
                              
                           
                           ,
                           {
                           
                              
                                 x
                              
                              
                                 p
                                 =
                                 k
                              
                              
                                 t
                              
                           
                           ,
                           
                              
                                 x
                              
                              
                                 p
                                 =
                                 j
                              
                              
                                 t
                              
                           
                           }
                           )
                        
                      and 
                        
                           
                              
                                 φ
                              
                              
                                 2
                                 ,
                                 csift
                              
                           
                           (
                           
                              
                                 y
                              
                              
                                 patch
                              
                              
                                 t
                              
                           
                           ,
                           {
                           
                              
                                 x
                              
                              
                                 p
                                 =
                                 k
                              
                              
                                 t
                              
                           
                           ,
                           
                              
                                 x
                              
                              
                                 p
                                 =
                                 j
                              
                              
                                 t
                              
                           
                           }
                           )
                        
                      (see Section 2.3.1) had very high dimensionality, e.g. 
                        
                           4
                           ×
                           
                              
                                 10
                              
                              
                                 6
                              
                           
                        
                      for SIFT. As such, it was very hard to track and model each co-occurrence feature due to memory and sparsity issues. Thus, we decided to reduce the co-occurrence feature space dimension while maintaining the main characteristics of the features as much as possible. A Random Forest classifier was first used to select the top 1% of the occurrence features (codewords) based on the feature importance score [71]. Then, PCA was applied over the co-occurrence features of these selected occurrence codewords. During this process, K eigenvectors with the highest eigenvalues were chosen in a fashion that at least 99% of the original feature space information was preserved.

While estimating the optimal set of weights in Level 2 of the pose graphical model, and Level 2 and 3 of the attribute graphical model, different global search (and multiple start local search) algorithms were evaluated, such as simulated annealing, genetic algorithm and pattern search (direct search). Among all, the optimization strategy in [76], i.e. CMA-ES (de-randomized evolution strategy with covariance matrix adaptation), was found to provide the best and the most consistent estimation performance. The CMA-ES is an evolution strategy, which is a stochastic, derivative-free method, developed for numerical optimization tasks. CMA-ES performs well on difficult optimization problems, such as functions with discontinuities, noise, local optima or outliers. CMA-ES is based on a biological evolution strategy containing the mutation (variation) and generation (iteration) steps. Each iteration generates candidate solutions from the current individuals (a subset of candidate solutions from the previous iteration) using a stochastic approach. Some of these individuals are later selected as the parents of the next generation. This selection is defined based on the performance on the defined objective function. The iteration continues until a candidate solution is reached. During the iteration phase, the CMA-ES estimates a positive definite matrix, i.e. covariance matrix, without using gradient information. This allows CMA-ES to be feasible on multi-model, noisy or non-continuous problems. Another benefit of using CMA-ES is that it does not require any prior information, such as the distribution shape, a difficult task considering the dimensionality of the weight space, i.e. 15 and 31. For details of the CMA-ES algorithm, please see [76].

@&#EXPERIMENTAL RESULTS@&#

Our method was validated with experiments on real data. The experiments are performed over 10-fold cross validation on the McGill Real-world Face Video Database. For each experiment, a set of subjects is used for training and a second set of subjects is used for testing. In all experiments, there is no overlap between the subjects used in the two sets. The publicly available McGill Real-world Face Video Database [37] consists of 18,000 challenging real-world video frames from 60 different subjects. Wide variability in head pose is exhibited in individual video frames: 45.8% of the frames are beyond 0° of which 58.1% go beyond 45°, i.e. non-frontal (see Fig. 1). In this paper, the proposed approach estimates the head pose density function for each pose angle for each video frame, though we are still bound by the precision of the manual labeling of the database. That is, it is not possible to collect the “absolute head pose angle” label from fully uncontrolled real-world data. Thus, we use the robust 2-stage labeling strategy introduced in [37] to collect ground truth pose labels. These labels are pose distributions in the range [−90°, +90°] capturing the labelers’ belief on the pose angle. To evaluate the pose distribution (PDF) provided by the proposed framework, histogram distance between the pose ground truth (label) PDF and estimated pose PDF is used as the measure. Furthermore, this labeling scheme leads to 9 pose labels based on the MAP estimates of the pose distributions (see Fig. 1(b)). The MAP labels are used for the comparison of the proposed framework to the alternative approaches since they produce pose labels rather than distributions. Furthermore, the faces are tracked and localized through the tracking algorithm described in [37].

In the comparative experiments of the head pose and facial trait estimation tasks, we use the original implementation from the authors for all methods, except for [51]. We implemented the supervised manifold approach in MATLAB. To validate our implementation, we tested our implementation of the method on the same database as in [51], and compared the results to those reported in [51]. This led to an error of 0.16° in mean absolute deviation of the pose angle error, which is very close to the original performance of [51].

For the case of 10-fold cross validation the over the McGillFaces database, the average time of the training phase for the proposed graphical model is ∼14h when ran on a PC with 16GB of RAM and an Intel Core i7-3770 3.40GHz CPU. The testing of a video takes couple of seconds depending on the length of the video sequence. On average, a test frame takes 36ms to be processed. That being said, the current implementation is in MATLAB and the computational cost is expected to significantly reduce after optimization.

We now compare the pose estimation performance of the proposed model and the following leading alternative approaches: (i) the probabilistic patch-based framework in [33], (ii) the supervised manifold-based approach in [51], which uses raw pixel intensity values, (iii) the Bayesian framework in [32], which uses OCI [70] features to model the pose in real-world environments, (iv) Zhu and Ramanan’s unified model for face detection, pose estimation and landmark localization using a mixture of trees with a shared pool of parts [23], and (v) Xiong and De la Torre’s Supervised Descent Method which solves a non-linear least squares problem in the context of facial feature detection and tracking (IntraFace) [55,56]. Note that the original implementations provided by the authors of [23,55,33] are used in our experiments.


                        Fig. 6
                         shows sample qualitative results along with estimated pose distributions for some challenging cases, our MAP estimates and the pose ground truth labeling. It is observed that in the presence of bad face tracking and motion blur, the proposed model might fail due to the lack of reliable facial features.

In Table 2
                        , a quantitative comparison of these approaches is provided over all folds. The validation metrics consist of: (1) MAP-based head pose classification accuracy (results in terms of mean±std), and (2) the root mean square error (RMSE) based on angle error. The RMSE is defined between the estimated pose angle and the closest border of the ground truth bin. A ground truth bin is a pose range which is a set of pose angles centered at the ground truth pose MAP estimate obtained via using the labeling algorithm in [37]. For instance, the bin 0° represents pose range [−11.5°, +11.5°], where −11.5° and +11.5° are the bin borders. Thus, if the estimated pose is +13.5° and the ground truth bin is 0°, the RMSE is calculated between +13.5° and +11.5°. It is crucial to report RMSE for each algorithm since MAP-based evaluation takes only into account if an estimated pose angle falls into the correct bin or not. However, there might be some cases that an approach can have low MAP-based classification performance whereas it misses the correct pose bin by a very small angle, e.g. 1°. In both categories, the proposed framework significantly out-performs the alternative approaches. The p-value of 
                           
                              7.02
                              ×
                              e
                              -
                              05
                           
                         for the pose classification task is obtained when the proposed approach is compared to the next closest competitor, i.e. Zhu and Ramanan [23], which has 13.87% lower accuracy.

The approach introduced in [23] jointly performs face detection, discrete pose estimation and facial landmark (e.g. eyes, nose and mouth) localization. Multi-view face templates are built on a shared pool of parts, facial landmarks. Each template represents a different head pose with a mixture-of-trees model encoding the topological changes due to head pose. Furthermore, each template is a tree-structured elastic model handling deformation. Dynamic programming is used to estimate the most likely pose template for a given image. It is observed that this approach results in low pose estimation performance in cases with major occlusion, low lighting or profile head poses, e.g. ±90°. One reason for this is that while estimating the most likely pose template, all the facial landmarks are assumed to be visible. Moreover, the method has difficulties with facial landmark displacement in some contexts due to the lack of spatial constraints. [55,56] propose a sophisticated method for achieving robust facial feature (landmark) extraction, face alignment and head pose estimation. Xiong and De la Torre define sixty-six facial landmarks and SIFT features extracted from patches around landmarks. Unlike the approach proposed in this paper, [55,56] define the head pose estimation task as a regression problem, leading to continuous head pose estimation. The Supervised Descent Method (SDM) is used to solve a Non-linear Least Squares (NLS) problem in the context of facial landmark detection and tracking [55]. During training, SDM aims to minimize the mean of NLS functions through a sequence of descent directions. In the testing phase, the NLS objective is minimized by SDM through the learned descent directions. The approach in [55,56] not only detects facial landmarks, but also estimates head pose and facial attributes, e.g. gender and facial hair. The head pose performance of [55,56] drops in the presence of facial occlusion and low lighting conditions, or for images with profile poses. Some of the errors are due to the algorithm’s inability to distinguish facial parts and occluding objects, such as glasses and eyebrows.

To allow for a more comprehensive analysis, the confusion matrices (see Fig. 7)
                        ) and the plots showing the pose estimation performance for each head pose label (see Fig. 7(b) are provided for the proposed model, and for methods [23,55,56]. The confusion matrices for [23,55,56] reveal that the competing approaches perform relatively well for face images depicting a maximum of 45° head pose angle. [23] tends to label off-frontal images as frontal poses. This can be seen in the confusion matrix as the diagonal is pushed towards the matrix center for the {±90°,±67.5°, ±45°} bins. [55,56]’s confusion matrix, on the other hand, provides a more vertical shape, where it labels most of the images as 0°. It is not able to successfully label images with pose angles in the range of [−90°, −67.5°] or [+67.5°, +90°], leading to a discontinuity in the blue plot in Fig. 7(b). For images with near-frontal pose, [55,56] provides more diagonal shape. Compared to alternative approaches, the confusion matrix for the proposed approach, shows a more diagonal trend. The only problematic bins are ±67.5°: the proposed model tends to label images with −67.5° as −45°, and images with +67.5° as +45°.

It is observed in Fig. 7(b) that all the methods, including the proposed method, perform poorly for pose angles of −67.5° and +67.5° when results are shown in the form of bin labels. However, such an error may actually reflect a difficulty in the ground truth labeling, since for humans it is hard to label such continuous pose angles, and this is reflected in the probabilistic pose ground truth collection phase (see some failure cases in Fig. 6). That being said, as the images (10) and (11) in Fig. 8
                        (b) show, humans tend to have high entropy (flat distribution)
                           1
                           We say more on this in later when discussing Fig. 8.
                        
                        
                           1
                         in their pose ground truth labeling in the case of 
                           
                              +
                              67.5
                              °
                           
                        . The proposed method performs the best for the pose angle of 
                           
                              -
                              67.5
                              °
                           
                         whereas it tends to estimate the correct pose label (
                           
                              +
                              67.5
                              °
                           
                        ) as being either 
                           
                              +
                              45
                              °
                           
                         or 
                           
                              +
                              90
                              °
                           
                        . As such, this reduces the overall reported accuracy in terms of bin classification. Fig. 7(b) shows that all three approaches perform well for frontal images, which is expected. However, it should be noted that, for the 0° range (frontal), the proposed methods provides 95.43% pose classification accuracy whereas the closest competitive provides 87.40%. Furthermore, the proposed approach has a good pose estimation performance even for the images with full profile (90°) poses. The performance of [23,55] decreases dramatically as the head pose becomes off-frontal, i.e. 
                           
                              ⩾
                              22.5
                              °
                           
                        , whereas the proposed model provides relatively a flat accuracy distribution except for the decrease at ±67.55. The BPLR codebook representation is not learned properly for some pose bins, e.g. 
                           
                              -
                              22.5
                              °
                           
                        , as the BPLR codebook size is much larger than the number of samples available in these pose bins, leading to low pose classification accuracy. Such misclassifications are mainly due to the fact that the proposed model is not able to learn discriminative facial features for these pose bins.

In Table 3
                        , the mean and standard deviation (std) statistics for pose classification performance of the proposed method with the Random Forest classifier over all folds are reported. Among single feature types (i.e. patch, edge, facial landmark and region), the region representation provides the best performance whereas patch and edge representations provides similar performance. When region features are combined with patch, the mean accuracy increase slightly whereas the std decrease. Once the edge features are combined with region and patch features the mean accuracy increases even further and std decreases. The highest classification accuracies for mean and the lowest std are obtained when all the four features are used in the proposed framework. However, our approach is not dependent on the use of random forests, and it can in fact work with any other classification approach. To demonstrate this, we also evaluated the proposed graphical model using an SVM classifier on the McGillFaces database (see Table 3). The SVM classifier provides similar head pose classification performance for different feature combination, compared to the Random Forests classifier (see Table 3). Furthermore, the proposed method using the SVM classifier outperforms the competing approaches, i.e. [23,55]. The main drawback of using the SVM classifier with the proposed graphical model is its computational inefficiency as compared to the Random Forests, i.e. it requires ∼3 times more training time.

As further analysis, we examined the effect of temporal stage (Level 3) on the proposed graphical model. Analyzing the MAP based accuracies for each pose bin (label) before and after the use of Level 3 reveals that the maximum accuracy gain of 12.2% is obtained when the face has the pose of 
                           
                              -
                              67.5
                              °
                           
                         whereas the average accuracy gain over all pose labels is 9.17%. Furthermore, in Fig. 8(a), we show how the histogram distance between the pose ground truth PDF and estimated pose PDF changes when the temporal information is leveraged. We report results from different histogram divergence methods, such as Earth Mover’s Distance [77] and Jensen–Shannon divergence. It is observed that regardless of what distance method is chosen, the histogram distance decreases once the Level 3 is used in the graphical model. Fig. 8(b) depicts example tracked face images from video frames from different folds, which are challenging cases considering the arbitrary facial occlusion and large pitch and roll angles. The red curve is the non-temporal pose PDF 
                           
                              
                                 
                                    Y
                                 
                                 
                                    t
                                 
                              
                           
                        ; the green curve is the temporal pose PDF 
                           
                              
                                 
                                    
                                       
                                          Y
                                       
                                       
                                          ∼
                                       
                                    
                                 
                                 
                                    t
                                 
                              
                           
                        , and the blue curve is the ground truth pose PDF. In image (1), we see that the ground truth labeling is very confident around 0° and the temporal modeling gives the same PDF as the non-temporal modeling. In image (2), we observe that the non-temporal pose PDF has almost a flat distribution containing no information about the possible pose bin. Once the temporal stage is incorporated, the histogram distance between the estimated pose PDF and the ground truth PDF gets smaller whereas the MAP estimate, i.e. 
                           
                              -
                              45
                              °
                           
                        , is not in the correct ground truth bin which is centered around 
                           
                              -
                              22.5
                              °
                           
                        . In images (4,5,6,7,8,12) in Fig. 8(b), we see examples of how the temporal stage improves upon the non-temporal model. The images (10) and (11) have the pose labels (pose bin centers) of 
                           
                              +
                              67.5
                              °
                           
                        , which is the most problematic pose bin for the proposed approach. In (11), the human labeling is a flat distribution for the range of 
                           
                              [
                              +
                              46
                              °
                              ,
                              +
                              89
                              °
                              ]
                           
                        , and it is not sure about the exact pose angle. In both of these images, the temporal stage based PDF improves upon the non-temporal PDF. However, the MAP estimate from the proposed model does not fall into the correct pose bin 
                           
                              [
                              +
                              46
                              °
                              ,
                              +
                              89
                              °
                              ]
                           
                        .

We also evaluate the proposed methodology on the CMU Multi-PIE face database [52], which contains face images from different subjects with multiple (13) viewpoints, different facial expressions and illumination conditions. Although this database is fully controlled, we evaluate our algorithm on it as a ground truth sanity check. We perform a comparison of the proposed approach and the approach in [23] on 5200 Multi-PIE images consists of all 13 different pose (equally distributed), light and facial expression variations available in the database. The experimental results show that over 13 pose labels (angles), our graphical model and the method in [23] provide the head pose classification accuracy of 94.46% and 74.57%, respectively. In Table 4
                        , the mean statistics for pose classification performance for different feature combinations of the proposed method over the CMU Multi-PIE face image database [52]. It is observed that among single feature types, the region and patch representations provide similar performance, much higher than the accuracy obtained by using the method in [23]. Once region features are combined with patch features, the mean accuracy increases. When the edge features are combined with region and patch features, the mean accuracy increases slightly. The highest classification accuracy of 94.46% is obtained when all four features are used in the proposed framework.

To analyze the generalizability of the proposed head pose estimation method, we test the model trained on the McGillFaces database on a video sequence from the Game of Thrones series. As shown in Fig. 12, the proposed method provides more accurate head pose angles as compared to the methods in [23,55], despite the presence of low and non-uniform illumination conditions.

The evaluation of the proposed pose-based attribute estimation methodology is performed on two attributes: gender classification (i.e. male or female), and facial hair classification (i.e. presence or absence of facial hair). The accuracies reported in this section are based on a rate where the probabilities of misclassifying males and females are equal (i.e EER). First, we evaluate the effect of the use of pose distribution 
                           
                              
                                 
                                    
                                       
                                          Y
                                       
                                       
                                          ∼
                                       
                                    
                                 
                                 
                                    t
                                 
                              
                           
                         in Level 4 of the graphical model in Fig. 5. In this experiment, we use the proposed head pose estimation method to model 
                           
                              
                                 
                                    
                                       
                                          Y
                                       
                                       
                                          ∼
                                       
                                    
                                 
                                 
                                    t
                                 
                              
                           
                         in Level 4 of the attribute graphical model, since: (i) the proposed head pose model significantly outperforms all the alternative approaches regardless of which database is used, e.g. McGillFaces, Games of Thrones or CMU Multi-PIE, and (ii) alternative approaches, e.g. [23,55], are not suitable to model 
                           
                              
                                 
                                    
                                       
                                          Y
                                       
                                       
                                          ∼
                                       
                                    
                                 
                                 
                                    t
                                 
                              
                           
                         as they do not provide the entire pose PDF. Table 5
                         shows that use of the pose information increases the mean gender and hair classification accuracy by 2.35% and 1.39%, respectively. Considering the high standard deviation, one might think that this increase is not significant. However, it must be noted that the reason for such a high standard deviation is that for the case of temporal evaluation, we only evaluate one label per subject: if the proposed method has even only one false classification, this leads to an accuracy drop of 16.66% (in the case of 10-fold cross validation). Thus, to accomplish a more comprehensive analysis, we analyze the gain in the attribute classification accuracy after the use of pose in Level 4 for each pose bin. Using pose information in the proposed model increases the attribute classification performance, especially for the images with certain pose angles. For instance, in the case of facial hair classification, the total gain over different pose bins is 35.62%. More specifically, the use of the pose information provides an accuracy increase of 
                           
                              {
                              1.7
                              %
                              ,
                              2.32
                              %
                              ,
                              2.65
                              %
                              ,
                              1.53
                              %
                              ,
                              0.39
                              %
                              ,
                              7.14
                              %
                              ,
                              2.19
                              %
                              ,
                              16.66
                              %
                              ,
                              1.04
                              %
                              }
                           
                         given that the face in the image has the pose of 
                           
                              {
                              -
                              90
                              °
                              ,
                              -
                              67.5
                              °
                              ,
                              -
                              45
                              °
                              ,
                              -
                              22.5
                              °
                              ,
                              0
                              °
                              ,
                              +
                              22.5
                              °
                              ,
                              +
                              45
                              °
                              ,
                              +
                              67.5
                              °
                              ,
                              +
                              90
                              °
                              }
                           
                        , respectively.


                        Fig. 9
                         shows example qualitative results along with gender and facial hair MAP decisions estimated by the proposed hierarchical temporal model. As the sample video frames depicts, our framework achieves successful gender and facial hair classification despite the joint occurrence of arbitrary face scales, non-uniform illumination conditions, partial occlusions, motion blur, and background clutter.

In the case of gender classification, the proposed graphical model is compared to: (i) Toews and Arbel’s probabilistic and viewpoint-invariant object class invariant (OCI) model [70], (ii) Xiong and De la Torre’s IntraFace Model [55] and (iii) SVM applied on facial appearance features, pixel intensities values (e.g. [24,78]). In the facial hair classification, on the other hand, we compare the proposed graphical model to: (i) Xiong and De la Torre’s IntraFace Model [55] and (ii) SVM applied on facial appearance features, pixel intensities values (e.g. [24,78]). These alternative approaches are all non-probabilistic and they output static image-based (single frame) decisions. To extend their work to infer a decision based on a video sequence, one can use majority voting. In Tables 6 and 7
                        
                        , the single frame based and video-based performance comparisons can be found. To compute the single frame based accuracy for the proposed approach, Level 5 (the temporal stage) of the proposed graphical model is simply omitted (see Fig. 5).

For the task of gender classification, the original implementation of the OCI model [70] and the IntraFace framework [55,56] are utilized. As depicted in Table 6, the OCI model provides an average gender classification accuracy of 68.16% for single video frames over all the folds, and a video-based accuracy of 80% (see Table 6). Xiong and De la Torre’s Intraface [55,56], on the other hand, leads to low accuracy for single image based trait estimation experiments. This is mainly due to its inability to detect facial landmarks from images with occlusion, low lighting or off-frontal poses, i.e. more than 45°. Note that if the facial landmarks or trait features are not detected for a given single video frame, it is not possible to estimate gender or facial hair. After applying the majority voting over only the frames provision trait decisions, Refs. [55,56] provides the highest video-based accuracy of 87.92% among all approaches. Finally, the SVM based on facial pixel intensity values is evaluated. For each fold, an SVM classifier is trained using the libsvm [79], where the best SVM parameters for the RBF kernel, 
                           
                              {
                              C
                              ,
                              γ
                              }
                           
                        , are estimated through a grid search. As seen in Table 6, the average accuracy of 71.62% and 81.66% over all the folds are achieved for single frame and video based cases, respectively. The proposed approach, on the other hand, outperforms the alternative approaches both in single frame based and video based gender classification tasks. It provides an accuracy of 81.38% for single frames (Levels 1–4). However, it must be noted that the proposed approach has the highest std among all possible approaches, i.e. 9.90%. Once the temporal modeling of gender is incorporated into the proposed approach, the accuracy reaches 100%. The simple but effective temporal stage increases the accuracy by 18.62%.


                        Fig. 10
                         shows the qualitative results from the single frame based gender classification using the proposed method. As demonstrated by the sample video frames, the proposed framework achieves successful gender classification despite the joint occurrence of arbitrary face scales, non-uniform illumination, partial occlusions, motion blur, and background clutter. While the proposed model achieves 100% video-based gender classification accuracy, there are some misclassified single frames where the probabilistic framework is not confident of its decision. These misclassifications are mainly due to: (i) the large motion blur leading to poor feature extraction, and (ii) face localization and alignment problems created by the tracking phase leading to a small portion of the face to be correctly located. Thus, only a small number of features can be extracted. Note that all the single frame based misclassifications are corrected by the temporal stage of the proposed approach.

We also evaluate the proposed gender model, which was trained on the McGillFaces database [37], on a video sequence from Game of Thrones TV series [80]. This video sequence exhibits low and non-uniform illumination conditions. In Fig. 11
                         we show the qualitative results of the proposed approach for the single frame and video based gender classification tasks. It is observed that single frame misclassifications are corrected by the temporal stage of the proposed approach, leading to good gender classification performance. Note that out of all 11 subjects in the video, only one is misclassified. In this case, the very low illumination levels resulted in the absence of any facial features, and only a face silhouette remained (see the subject on top right of Fig. 11). This leads to a 90.90% gender (see 12
                        ) classification accuracy.

For the case of facial hair, among alternative approaches, SVM provides the best classification accuracy for single frames, i.e. 85.66%, whereas Intraface provides the best video based accuracy of 95.68% (see Table 7). The proposed approach outperforms the alternative approaches, such that accuracies of 90.08% and 98.33% are obtained for single frame based and video based experiments, respectively. Our analysis shows that among all folds only one fold does not have 100% accuracy due to the false classification of a single subject.

In this paper, we propose a hierarchical temporal graphical model to robustly estimate continuous head pose angle from real-world videos, i.e. with arbitrary facial expressions, arbitrary partial occlusions, arbitrary and non-uniform illumination conditions, motion blur and arbitrary background clutter. The proposed methodology provides a probability density function over the range 
                        
                           [
                           -
                           90
                           °
                           ,
                           +
                           90
                           °
                           ]
                        
                      of head poses for each video frame rather than just providing a single decision. Experiments performed on 18,000 real-world video frames show that the proposed approach significantly outperforms the alternative approaches. During training, the proposed framework learns models to maximally leverage features, both spatially and temporally. Furthermore, the framework outputs the entire pose distribution for a given video frame, which permits robust temporal, probabilistic fusion of pose information over the entire video sequence. This also permits probabilistically embedding the head pose information into other classification tasks. The proposed model is evaluated on both unconstrained (McGill Real-world Database) and constrained (CMU Multi-pie) databases. We also show how to apply the proposed framework on the gender and facial hair classification tasks while utilizing the previously estimated pose distribution as the prior information inside the graphical model. Our results depict that incorporating the proposed temporal attribute classification model in conjunction with the pose information leads to superior results compared to alternative approaches.

In the proposed graphical model, there are some design decisions to justify or further explore: (i) To model the posterior distributions in the potential functions of the our graphical model, one could use different probabilistic classifiers, such as Bayesian, RVM [81] and Random Forest [71]. We investigated these classifiers in preliminary work, and found that the Bayesian classifier and RVM had similar performance whereas the Random Forest classifier provides superior classification accuracy due to its good generalization power and its high speed. (ii) Different graphs and inference methods are investigated to model the pose distribution temporally in Level 3 (see Fig. 4), such as Belief Propagation. However, we observe that this leads to over-smoothing of the pose distributions. The fully connected version of Level 3 of the current proposed approach is also evaluated. This model is shown to give similar results to our current temporal model (see Level 3 in Fig. 4). Thus, we employ the proposed simple, but effective temporal model. (iii) It is also possible to embed the pose information inside the attribute estimation model using different formulations. One method could be to define the pose information as the given random variable in the attribute probability distribution, i.e. 
                        
                           p
                           (
                           attribute
                           |
                           pose
                           )
                        
                     . However, in our experience, this model leads to division of the training database, which is not beneficial for the frames with very far off-frontal head poses since the number of such frames in training is smaller compared to the one of frames with near frontal pose. Another method could be to use the pose information directly in Level 1 in Fig. 5 as a new set of features. The benefit of this method is that the relationship between patch, edge, landmark and region features and the pose information can be modeled at a very low level. However, we do not observe any significant benefit of using this method compared to the proposed simpler method in Fig. 5. Last, we also evaluated the method in which the pose probability of the MAP-estimate is used as a confidence measure in order to perform frame selection. Then over the selected frames, the proposed hierarchical temporal graphical model is employed to estimate the most probable attribute class. It is observed that one can achieve the same performance (100% for gender and 98.33% for facial hair) by only using the top 2% of the video frames from each subject. However, the selected frames consist of mostly near-frontal images. We expect such an approach might not work as well in the case of cameras that are placed in a perpendicular angle to the traffic flow, leading to mostly profile face images.

@&#REFERENCES@&#

