@&#MAIN-TITLE@&#A chord error conforming tool path B-spline fitting method for NC machining based on energy minimization and LSPIA

@&#HIGHLIGHTS@&#


               
               
                  
                     
                        
                           
                           The presented B-spline tool path fitting method is chord-error conforming.


                        
                        
                           
                           It is numerically stable and hence industrial-strength.


                        
                        
                           
                           The proposed ELSPIA algorithm incorporates stretching energy into LSPIA algorithm.


                        
                        
                           
                           Includes actual machining experiments to validate the worthiness.


                        
                     
                  
               
            

@&#KEYPHRASES@&#

CNC machining

G-code

B-Spline fitting

Progressive iterative approximation

Energy minimization

@&#ABSTRACT@&#


               
               
                  Piecewise linear (G01-based) tool paths generated by CAM systems lack 
                        
                           
                              G
                           
                           1
                        
                      and 
                        
                           
                              G
                           
                           2
                        
                      continuity. The discontinuity causes vibration and unnecessary hesitation during machining. To ensure efficient high-speed machining, a method to improve the continuity of the tool paths is required, such as B-spline fitting that approximates G01 paths with B-spline curves. Conventional B-spline fitting approaches cannot be directly used for tool path B-spline fitting, because they have shortages such as numerical instability, lack of chord error constraint, and lack of assurance of a usable result. Progressive and Iterative Approximation for Least Squares (LSPIA) is an efficient method for data fitting that solves the numerical instability problem. However, it does not consider chord errors and needs more work to ensure ironclad results for commercial applications. In this paper, we use LSPIA method incorporating Energy term (ELSPIA) to avoid the numerical instability, and lower chord errors by using stretching energy term. We implement several algorithm improvements, including (1) an improved technique for initial control point determination over Dominant Point Method, (2) an algorithm that updates foot point parameters as needed, (3) analysis of the degrees of freedom of control points to insert new control points only when needed, (4) chord error refinement using a similar ELSPIA method with the above enhancements. The proposed approach can generate a shape-preserving B-spline curve. Experiments with data analysis and machining tests are presented for verification of quality and efficiency. Comparisons with other known solutions are included to evaluate the worthiness of the proposed solution.
               
            

@&#INTRODUCTION@&#

G-code commands generated by CAM systems play an important role in CNC machining. Among them piecewise linear (G01-based) tool paths are widely used. The lack of 
                        
                           
                              G
                           
                           1
                        
                      and 
                        
                           
                              G
                           
                           2
                        
                      continuity of G01-based paths cause unwanted vibrations and slow-downs during machining. To ensure efficient high-speed machining, a method such as B-spline fitting to improve the continuity of tool path is required.

Tool path B-spline curve fitting is often required to fulfill more constraints than conventional B-spline curve fitting in shape and performance [1], such as approximation of the G01 points within a given tolerance, chord error constraint, shape preservation, 
                        
                        
                           
                              G
                           
                           2
                        
                      continuity, and minimal number of control points. In addition, computation must be fast and accurate even for large size tool paths to use the solution in actual NC machining.

The conventional B-spline fitting approaches are often solved by minimizing Least Square Fitting (LSF) error or energy functions within a given tolerance [2–8]. LSF involves solving a very large system of linear equations. It is not suitable for industrial solutions because of numerical instability and lack of assurance of a usable result.

Instead of solving linear equation, Progressive and Iterative Approximation (PIA) proposed by Qi et al. [9] and de Boor [10] is a new and effective method for data fitting that eliminates the numerical instability of solving inverse matrices. PIA constructs a series of fitting curves by adjusting control points iteratively[11–15]. Deng et al. [4] reported a method of Progressive and Iterative Approximation for Least Squares (LSPIA) with the ability to handle point set of large size with less control points than PIA. Nevertheless the LSPIA method cannot be directly used in industrial applications of NC machining due to the following reasons: first, LSPIA does not consider chord error requirement, second, the data points of empirical examples distributed evenly, but actual NC tool paths have more complex and unpredictable shapes and non-uniform data point distribution.

Parameter values of data points and knot vector are critical to the quality of fitting curve. Piegl and Tiller [5, 16] suggested using averaging technique (AVG) and knot placement technique (KTP). Razdan [17] and Li et al. [18] suggested using shape information to determine knot vectors. Park et al. [3] devised a new B-spline curve fitting method based on adaptive curve refinement using dominant points. Their knots were determined by averaging the parameter values of the dominant points.

Tool path B-spline fitting method is often used to improve the machining efficiency within the precision to achieve high-speed and high-precision CNC machining. Yang and Chen [19] proposed a new high precision fitting approach which used roughly fit and fine fit for NURBS generation, and Newton–Raphson method is used to solve the optimization problem, but the authors did not give a method to solve chord error refinement, and Newton–Raphson method cannot ensure a solution that satisfies the accuracy requirement. Syh-ShiuhYeh and Hsin-Chuan Su [20] developed a method for implementing an online non-uniform rational B-spline(NURBS) curve fitting process on CNC machines for improving the quality and efficiency of machining. He fitted the data points using optimal search method and used least square fitting method to solve the optimization problem without considering chord error and numerical instability. If the fitting process fails, he just used stored data points as the motion commands for ensuring the continuous motion of CNC machines. Zhang et al. [21] proposed a method of curve fitting for velocity planning on CNC machines based on quadratic B-splines. The fitting curve was obtained by interpolating feature points. Chasing method was used to compute control points. This method also has shortage of the numerical instability of solving inverse matrices.

The goal of this study is to design and implement an algorithm that is capable of satisfying all of the requirements. Conventional LSF method is not considered for industrial-strength applications because of numerical instability. LSPIA method cannot be directly used for tool path B-spline fitting because it does not consider chord error requirement. Moreover, both the conventional LSF method and LSPIA lack actual machining experiments to validate the usability.

A number of commercial CAD/CAM software systems can generate NURBS tool paths, such as NX, CATIA, Delcam, PowerMILL, SINUMERIK 840D compressor etc. The NX solution delivers favorable results but from data analysis we found that NX solution has some limitations. It cannot ensure 
                        
                           
                              G
                           
                           1
                        
                      continuity between two B-splines and determine the feature points of the tool paths automatically – the feature points are determined by a user-provided angle. Our previous work [1] can identify the feature points, which are called “Hard Break Points (HBP)”, automatically. The goal is to ensure 
                        
                           
                              G
                           
                           1
                        
                      continuity between two B-splines, and G01 and B-spline, except at HBP locations. HBP identify algorithm [1] is not the key discussion point in this paper but is the prerequisite of the tool path B-spline fitting.

Data points in this paper are generated by CAM software, and our fitting results are used for 3-axis actual machining after B-spline fitting. 
                     Fig. 1 is a systematic flowchart of the relationship between CAM, B-spline fitting, and CNC machining. Tool path B-spline fitting is an optimize step for tool paths generated by CAM software, and after tool path B-spline fitting, the tool paths have better continuity and smoother than the original G01. It can generate better machining surface and save internal storage.

In this study, we propose to use LSPIA method incorporating an energy term (ELSPIA) to improve the performance and lower the chord errors. We select initial control points which can demonstrate the feature of data points and are uniformly distributed. We design an iterative algorithm such that the foot point parameters are updated strategically; then we analyze the required degrees of freedom of control points to insert new control points effectively; furthermore we apply chord error refinement with ELSPIA method if the chord error requirement is not satisfied.

This paper is organized as follows. In Section 2, we state the requirements and high-level algorithm of tool path B-spline fitting. In Section 3, we introduce the algorithm of LSPIA. In Section 4, we explain our improvement of LSPIA in four aspects. Section 5 is the implementation of data fitting and chord error refinement with ELSPIA. Section 6 presents some numerical validation and Section 7 presents machining experiments. The last Section 8 concludes this paper. Moreover, Appendix supplements some detailed algorithm of this paper.

To obtain smooth, shape preserving, and tolerance banded cubic B-Spline tool paths, first the original data points need to be processed to remove noise points, determine HBPs, and identify long segments, then data points of tool path must be grouped by “breaks”, which should be identified by data analysis [1]. Thus the generated new point sequences are more suitable for further fitting.

The conventional B-spline fitting algorithm mainly fitted the data points with data error constraint. But in tool path B-spline fitting, not only data error constraint but also chord error constraint should be specified to minimize the division between fitting curve and polygon formed by the data points. Data errors can be optimized by minimizing the least square fitting error, but chord errors cannot be directly optimized due to the complex computation.

Firstly, let us review the concept of data point fitting. The readers are assumed to be familiar with the concepts of B-spline and optimization theory. A B-spline curve with degree 
                        
                        p
                     , knot vector 
                        U
                        =
                        {
                        
                           
                              u
                           
                           
                              0
                           
                        
                        ,
                        
                           
                              u
                           
                           
                              1
                           
                        
                        ,
                        …
                        ,
                        
                           
                              u
                           
                           
                              n
                              +
                              p
                              +
                              1
                           
                        
                        }
                      is defined as:
                        
                           (1)
                           
                              c
                              
                                 (
                                 t
                                 )
                              
                              =
                              
                                 ∑
                                 
                                    i
                                    =
                                    0
                                 
                                 n
                              
                              
                                 
                                    B
                                 
                                 
                                    i
                                 
                                 
                                    p
                                 
                              
                              
                                 (
                                 t
                                 )
                              
                              
                                 
                                    P
                                 
                                 
                                    i
                                 
                              
                           
                        
                     
                  


                     
                        {
                        
                           
                              
                                 B
                              
                              
                                 0
                              
                              
                                 p
                              
                           
                           
                              (
                              t
                              )
                           
                           ,
                           
                              
                                 B
                              
                              
                                 1
                              
                              
                                 p
                              
                           
                           
                              (
                              t
                              )
                           
                           ,
                           …
                           ,
                           
                              
                                 B
                              
                              
                                 n
                              
                              
                                 p
                              
                           
                           
                              (
                              t
                              )
                           
                        
                        }
                      are the normalized B-spline basic functions of degree 
                        p
                      defined on the knot vector
                        
                        U
                     . 
                        
                        
                           {
                           
                              
                                 
                                    P
                                 
                                 
                                    0
                                 
                              
                              ,
                              
                                 
                                    P
                                 
                                 
                                    1
                                 
                              
                              ,
                              …
                              ,
                              
                                 
                                    P
                                 
                                 
                                    n
                                 
                              
                           
                           }
                        
                        
                      are the control points.

In this paper, assume that 
                        
                           
                              {
                              
                                 
                                    Q
                                 
                                 
                                    j
                                 
                              
                              }
                           
                           
                              j
                              =
                              0
                           
                           
                              m
                           
                        
                      are ordered G01 data points, 
                        
                           
                              {
                              
                                 
                                    t
                                 
                                 
                                    j
                                 
                              
                              }
                           
                           
                              j
                              =
                              0
                              
                           
                           
                              m
                           
                        
                      are the parameter values of 
                        
                        
                           
                              {
                              
                                 
                                    Q
                                 
                                 
                                    j
                                 
                              
                              }
                           
                           
                              j
                              =
                              0
                           
                           
                              m
                           
                        
                     . Data error constraint is taken into consideration by minimizing the least square fitting error defined as:
                        
                           (2)
                           
                              
                                 E
                              
                              (
                              P
                              )
                              =
                              
                                 ∑
                                 
                                    j
                                    =
                                    0
                                 
                                 m
                              
                              
                                 
                                    (
                                    c
                                    (
                                    
                                       
                                          t
                                       
                                       
                                          j
                                       
                                    
                                    )
                                    −
                                    
                                       
                                          Q
                                       
                                       
                                          j
                                       
                                    
                                    )
                                 
                                 2
                              
                           
                        
                     
                  

Wherein,
                        
                        P
                        =
                        
                           
                              (
                              
                                 
                                    P
                                 
                                 
                                    0
                                 
                              
                              ,
                              
                                 
                                    P
                                 
                                 
                                    1
                                 
                              
                              ,
                              …
                              
                                 
                                    P
                                 
                                 
                                    n
                                 
                              
                              )
                           
                           T
                        
                     . The matrix form of Eq. (2) is:
                        
                           (3)
                           
                              E
                              (
                              P
                              )
                              =
                              
                                 
                                    (
                                    
                                       AP
                                       −
                                       Q
                                    
                                    )
                                 
                                 T
                              
                              (
                              AP
                              −
                              Q
                              )
                           
                        
                     
                  

Where
                        Q
                        =
                        
                           
                              (
                              
                                 
                                    
                                       Q
                                    
                                    
                                       0
                                    
                                 
                                 ,
                                 
                                    
                                       Q
                                    
                                    
                                       1
                                    
                                 
                                 ,
                                 …
                                 
                                    
                                       Q
                                    
                                    
                                       m
                                    
                                 
                              
                              )
                           
                           T
                        
                     , 
                        A
                        =
                        
                           [
                           
                              
                                 
                                    
                                       
                                          
                                             
                                                B
                                             
                                             
                                                0
                                             
                                             
                                                p
                                             
                                          
                                          
                                             (
                                             
                                                
                                                   
                                                      t
                                                   
                                                   
                                                      0
                                                   
                                                
                                             
                                             )
                                          
                                       
                                    
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         
                                                            B
                                                         
                                                         
                                                            1
                                                         
                                                         
                                                            p
                                                         
                                                      
                                                      
                                                         (
                                                         
                                                            
                                                               
                                                                  t
                                                               
                                                               
                                                                  0
                                                               
                                                            
                                                         
                                                         )
                                                      
                                                   
                                                
                                                
                                                   ⋯
                                                
                                                
                                                   
                                                      
                                                         
                                                            B
                                                         
                                                         
                                                            n
                                                         
                                                         
                                                            p
                                                         
                                                      
                                                      
                                                         (
                                                         
                                                            
                                                               
                                                                  t
                                                               
                                                               
                                                                  0
                                                               
                                                            
                                                         
                                                         )
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                                 
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         
                                                            B
                                                         
                                                         
                                                            0
                                                         
                                                         
                                                            p
                                                         
                                                      
                                                      
                                                         (
                                                         
                                                            
                                                               
                                                                  t
                                                               
                                                               
                                                                  1
                                                               
                                                            
                                                         
                                                         )
                                                      
                                                   
                                                
                                             
                                             
                                                
                                                   ⋮
                                                
                                             
                                             
                                                
                                                   
                                                      
                                                         
                                                            B
                                                         
                                                         
                                                            0
                                                         
                                                         
                                                            p
                                                         
                                                      
                                                      
                                                         (
                                                         
                                                            
                                                               
                                                                  t
                                                               
                                                               
                                                                  m
                                                               
                                                            
                                                         
                                                         )
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         
                                                            
                                                               
                                                                  
                                                                     
                                                                        B
                                                                     
                                                                     
                                                                        1
                                                                     
                                                                     
                                                                        p
                                                                     
                                                                  
                                                                  
                                                                     (
                                                                     
                                                                        
                                                                           
                                                                              t
                                                                           
                                                                           
                                                                              1
                                                                           
                                                                        
                                                                     
                                                                     )
                                                                  
                                                               
                                                            
                                                            
                                                               ⋯
                                                            
                                                            
                                                               
                                                                  
                                                                     
                                                                        B
                                                                     
                                                                     
                                                                        n
                                                                     
                                                                     
                                                                        p
                                                                     
                                                                  
                                                                  
                                                                     (
                                                                     
                                                                        
                                                                           
                                                                              t
                                                                           
                                                                           
                                                                              1
                                                                           
                                                                        
                                                                     
                                                                     )
                                                                  
                                                               
                                                            
                                                         
                                                      
                                                   
                                                
                                             
                                             
                                                
                                                   
                                                      
                                                         
                                                            
                                                               ⋮
                                                            
                                                            
                                                               
                                                                  
                                                                  ⋱
                                                               
                                                            
                                                            
                                                               
                                                                  
                                                                  ⋮
                                                               
                                                            
                                                         
                                                      
                                                   
                                                
                                             
                                             
                                                
                                                   
                                                      
                                                         
                                                            
                                                               
                                                                  
                                                                     
                                                                        B
                                                                     
                                                                     
                                                                        1
                                                                     
                                                                     
                                                                        p
                                                                     
                                                                  
                                                                  
                                                                     (
                                                                     
                                                                        
                                                                           
                                                                              t
                                                                           
                                                                           
                                                                              m
                                                                           
                                                                        
                                                                     
                                                                     )
                                                                  
                                                               
                                                            
                                                            
                                                               …
                                                            
                                                            
                                                               
                                                                  
                                                                     
                                                                        B
                                                                     
                                                                     
                                                                        n
                                                                     
                                                                     
                                                                        p
                                                                     
                                                                  
                                                                  
                                                                     (
                                                                     
                                                                        
                                                                           
                                                                              t
                                                                           
                                                                           
                                                                              m
                                                                           
                                                                        
                                                                     
                                                                     )
                                                                  
                                                               
                                                            
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           
                           ]
                        
                     
                  

In this study, the initial control points and initial knot vector are determined before the iterative steps of data point fitting. The data point fitting algorithm can be divided into three level cycles: major cycle, medium cycle and minor cycle. After these three cycles, a refinement process is used to reach the chord error requirement. There are many methods to solve the optimization of Eq. (3), but we use LSPIA method in the minor cycle considering performance and industrial application. We will introduce the LSPIA method in Section 3. If there is any data error that cannot satisfy fitting tolerance requirement after LSPIA iteration, we will start foot point parameter updating method in the medium cycle and control point insertion method in the major cycle. At last, chord error refinement method with ELSPIA is used if the chord errors cannot satisfy machining tolerance requirement. The flowchart of tool path B-spline fitting algorithm is shown in 
                     Fig. 2.

In this section, we will introduce the LSPIA iterative method and analyze why it cannot be directly used for tool path B-spline fitting.

Assume that 
                        
                           
                              {
                              
                                 
                                    P
                                 
                                 
                                    i
                                 
                                 
                                    0
                                 
                              
                              }
                           
                           
                              i
                              =
                              0
                           
                           
                              n
                           
                        
                      are the initial control points selected from the given data points 
                        
                           
                              {
                              
                                 
                                    Q
                                 
                                 
                                    j
                                 
                              
                              }
                           
                           
                              j
                              =
                              0
                           
                           
                              m
                           
                        
                     , 
                        U
                        =
                        
                           
                              {
                              
                                 
                                    u
                                 
                                 
                                    i
                                 
                              
                              }
                           
                           
                              i
                              =
                              0
                           
                           
                              n
                              +
                              p
                              +
                              1
                           
                        
                      are the knot vector. The first B-spline curve is:
                        
                           (4)
                           
                              
                                 
                                    c
                                 
                                 0
                              
                              
                                 (
                                 t
                                 )
                              
                              =
                              
                                 ∑
                                 
                                    i
                                    =
                                    0
                                 
                                 n
                              
                              
                                 
                                    B
                                 
                                 
                                    i
                                 
                                 
                                    p
                                 
                              
                              
                                 (
                                 t
                                 )
                              
                              
                                 
                                    P
                                 
                                 
                                    i
                                 
                                 
                                    0
                                 
                              
                           
                        
                     
                  

Let 
                        
                           
                              P
                           
                           k
                        
                        =
                        
                           
                              (
                              
                                 
                                    P
                                 
                                 
                                    0
                                 
                                 
                                    k
                                 
                              
                              ,
                              
                                 
                                    P
                                 
                                 
                                    1
                                 
                                 
                                    k
                                 
                              
                              ,
                              …
                              ,
                              
                                 
                                    P
                                 
                                 
                                    n
                                 
                                 
                                    k
                                 
                              
                              )
                           
                           T
                        
                      be the control point vector in the kth iteration, and 
                        
                           
                              Δ
                           
                           k
                        
                        =
                        
                           
                              (
                              
                                 
                                    Δ
                                 
                                 
                                    0
                                 
                                 
                                    k
                                 
                              
                              ,
                              
                                 
                                    Δ
                                 
                                 
                                    1
                                 
                                 
                                    k
                                 
                              
                              ,
                              …
                              ,
                              
                                 
                                    Δ
                                 
                                 
                                    n
                                 
                                 
                                    k
                                 
                              
                              )
                           
                           T
                        
                      be the adjusting vector of control points in the kth iteration. LSPIA uses steepest descent method [22] to minimize the fitting error defined by Eq. (3). First the gradient vector of 
                        E
                        
                           (
                           P
                           )
                        
                      in Eq. (3) is computed as:
                        
                           (5)
                           
                              ∇
                              E
                              (
                              P
                              )
                              =
                              2
                              
                              
                                 
                                    A
                                 
                                 T
                              
                              (
                              AP
                              −
                              Q
                              )
                           
                        
                     Then we can develop the kth iterative steps of LSPIA:
                        
                           (6)
                           
                              {
                              
                                 
                                    
                                       
                                          
                                             
                                                
                                                   Δ
                                                
                                                k
                                             
                                             =
                                             
                                             μ
                                             
                                                
                                                   A
                                                
                                                T
                                             
                                             (
                                             Q
                                             −
                                             A
                                             
                                                
                                                   P
                                                
                                                k
                                             
                                             )
                                          
                                       
                                    
                                    
                                       
                                          
                                             
                                                
                                                   P
                                                
                                                
                                                   k
                                                   +
                                                   1
                                                
                                             
                                             =
                                             
                                                
                                                   P
                                                
                                                k
                                             
                                             +
                                             
                                                
                                                   Δ
                                                
                                                
                                                   k
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           
                        
                     where
                        
                        μ
                      is the moving step, 
                        0
                        <
                        μ
                        <
                        
                           2
                           
                              
                                 
                                    λ
                                 
                                 
                                    0
                                 
                              
                           
                        
                     , 
                        
                           
                              λ
                           
                           
                              0
                           
                        
                      is the largest eigenvalue of matrix 
                        
                           
                              A
                           
                           T
                        
                        A
                     . The matrix 
                        
                           
                              A
                           
                           T
                        
                        A
                      is a positive definite and symmetric matrix, The (k+1)th curve 
                        
                        
                           
                              c
                           
                           
                              k
                              +
                              1
                           
                        
                        (
                        t
                        )
                      is:
                        
                           (7)
                           
                              
                                 
                                    c
                                 
                                 
                                    k
                                    +
                                    1
                                 
                              
                              
                                 (
                                 t
                                 )
                              
                              =
                              
                                 ∑
                                 
                                    i
                                    =
                                    0
                                 
                                 n
                              
                              
                                 
                                    B
                                 
                                 
                                    i
                                 
                                 
                                    p
                                 
                              
                              
                                 (
                                 t
                                 )
                              
                              
                                 
                                    P
                                 
                                 
                                    i
                                 
                                 
                                    k
                                    +
                                    1
                                 
                              
                           
                        
                     
                     
                        Remark 1.1
                        For the case of interpolating end points
                              
                                 
                                    Q
                                 
                                 
                                    0
                                 
                              
                           ,
                              
                                 
                                    Q
                                 
                                 
                                    m
                                 
                              
                           , we just let 
                              
                                 
                                    P
                                 
                                 
                                    0
                                 
                                 
                                    0
                                 
                              
                              =
                              
                                 
                                    Q
                                 
                                 
                                    0
                                 
                              
                              ,
                              
                                 
                                    P
                                 
                                 
                                    n
                                 
                                 
                                    0
                                 
                              
                              =
                              
                                 
                                    Q
                                 
                                 
                                    m
                                 
                              
                           and 
                              
                                 
                                    P
                                 
                                 
                                    0
                                 
                                 
                                    k
                                    +
                                    1
                                 
                              
                              =
                              
                                 
                                    P
                                 
                                 
                                    0
                                 
                                 
                                    k
                                 
                              
                              ,
                              
                                 
                                    P
                                 
                                 
                                    n
                                 
                                 
                                    k
                                    +
                                    1
                                 
                              
                              =
                              
                                 
                                    P
                                 
                                 
                                    n
                                    
                                 
                                 
                                    k
                                 
                              
                           in the iteration.

The flowchart of minor cycle is shown in 
                     Fig. 3. Compared with the conventional least square fitting method, LSPIA is an efficient and intuitive method for data fitting that eliminates the numerical instability of solving inverse matrices. However, in most cases the data error requirement cannot be satisfied just by the minor cycle. Data errors decrease obviously at first iteration steps but then they slow down after several steps, one of the reasons is that the foot points computed by data point parameters are not precise, and the other one is that the control points lack degree of freedom, meaning that there are not enough controls points. So we need to improve LSPIA method to make the fitting curve to satisfy data error and chord error requirement.

In this section, we improve LSPIA method in four aspects: (1) initial control points selection by LDCM method and knot vector determination by initial control points; (2) foot point parameters updating method; (3) control points insertion method using the degree of freedom of control points; (4) chord error refinement method using ELSPIA.

In this section, we propose an improved technique for initial control point determination over the Dominant Point Method(DOM) [3] to ensure uniform distribution of control points and convergence of feature locations. Park et al. [3] determined the dominant points by Local Curvature Maximum (LCM) points, but LCM points contain noise points. As shown in 
                        Fig. 4(a), there are 55 LCM points selected by 245 data points. Although the noise points can be excluded in a way, but the dominant points are gathered at the complex region and none at the flat region. To exclude the noise points, we adopt a Local Difference Curvature Maximum (LDCM) method to select feature points, noted as LDCM points. Assume that the curvature 
                           
                              
                                 k
                              
                              
                                 j
                              
                           
                         of 
                           
                              
                                 P
                              
                              
                                 j
                                 
                              
                           
                         has been computed by the method in Appendix A. s is a predefined neighborhood value. The difference curvature is defined as:
                           
                              (8)
                              
                                 
                                    
                                       σ
                                    
                                    
                                       j
                                    
                                 
                                 =
                                 
                                    
                                       k
                                    
                                    
                                       j
                                    
                                 
                                 −
                                 
                                    
                                       
                                          ∑
                                          
                                             i
                                             ≥
                                             j
                                             −
                                             s
                                             ,
                                             i
                                             ≤
                                             j
                                             +
                                             s
                                             ,
                                             i
                                             ≠
                                             j
                                          
                                       
                                       
                                          
                                             k
                                          
                                          
                                             i
                                          
                                       
                                    
                                    
                                       2
                                       s
                                    
                                 
                                 ,
                                 
                                 
                                 
                                 j
                                 =
                                 s
                                 ,
                                 …
                                 m
                                 −
                                 s
                                 ,
                              
                           
                        
                     

If 
                           
                              
                                 σ
                              
                              
                                 j
                              
                           
                           >
                           0
                           ,
                           
                           
                           
                              
                                 σ
                              
                              
                                 j
                              
                           
                           >
                           
                              
                                 σ
                              
                              
                                 j
                                 −
                                 1
                              
                           
                        , and
                           
                           
                              
                                 σ
                              
                              
                                 j
                              
                           
                           >
                           
                              
                                 σ
                              
                              
                                 j
                                 +
                                 1
                              
                           
                        , the point 
                           
                              
                                 P
                              
                              
                                 j
                                 
                              
                           
                        is considered as a LDCM point. As shown in Fig. 4(b), let 
                           s
                        =5, there are 33 LDCM points selected from 245 data points. To make the initial control points distribute uniformly, we need to add some control points in the region formed by two adjacent LDCM points that have more than 
                           2
                           s
                         data points. The initial control point set ensures that there are at most 
                           2
                           s
                         data points (a data point block) between two initial control points. The end points of each data point block are selected as initial control points to make the fitting curve interpolating the end points of data point blocks instead of all data points.

Assume that
                           
                           
                              
                                 {
                                 
                                    
                                       P
                                    
                                    
                                       i
                                    
                                    
                                       0
                                    
                                 
                                 }
                              
                              
                                 i
                                 =
                                 0
                              
                              
                                 n
                              
                           
                         are the initial control points selected from 
                           
                              
                                 {
                                 
                                    
                                       Q
                                    
                                    
                                       j
                                    
                                 
                                 }
                              
                              
                                 j
                                 =
                                 0
                              
                              
                                 m
                              
                           
                        , 
                           
                              
                                 {
                                 
                                    
                                       t
                                    
                                    
                                       j
                                    
                                 
                                 }
                              
                              
                                 j
                                 =
                                 0
                              
                              
                                 m
                              
                           
                         are the parameter values of 
                           
                              
                                 {
                                 
                                    
                                       Q
                                    
                                    
                                       j
                                    
                                 
                                 }
                              
                              
                                 j
                                 =
                                 0
                              
                              
                                 m
                              
                           
                        . Mostly the parameter values are computed by chord length or centripetal methods [2,5]. We use the AVG method of initial control points to compute the knot vectors:
                           
                              
                                 
                                    
                                       u
                                    
                                    
                                       p
                                       +
                                       j
                                    
                                 
                                 =
                                 
                                    1
                                    p
                                 
                                 
                                    ∑
                                    
                                       i
                                       =
                                       j
                                    
                                    
                                       j
                                       +
                                       p
                                       −
                                       1
                                    
                                 
                                 
                                    
                                       t
                                    
                                    
                                       f
                                       (
                                       i
                                       )
                                    
                                 
                                 ,
                                 
                                 
                                 j
                                 =
                                 1
                                 ,
                                 …
                                 n
                                 −
                                 p
                              
                           
                        where
                           
                           f
                           
                              (
                              i
                              )
                           
                           
                        is a function that returns the index of the point 
                           
                              
                                 Q
                              
                              
                                 j
                              
                           
                           
                        corresponding to initial control point
                           
                           
                              
                                 P
                              
                              
                                 i
                              
                              
                                 0
                              
                           
                        . In order to make the fitting curve interpolate the end points of data point blocks, the end knots should always have multiplicity of (p+1). The other knots need to have no multiplicity to obtain curve with
                           
                           
                              
                                 G
                              
                              2
                           
                        continuity.

In the iterative steps of LSPIA, the data point parameter 
                           
                              
                                 t
                              
                              
                                 j
                              
                           
                         is used as the foot point parameter of the data point 
                           
                              
                                 Q
                              
                              
                                 j
                              
                           
                        . The data error of 
                           
                              
                                 Q
                              
                              
                                 j
                              
                           
                         is measured by 
                           |
                           
                              c
                              (
                              
                                 
                                    t
                                 
                                 
                                    j
                                 
                              
                              )
                              −
                              
                                 
                                    Q
                                 
                                 
                                    j
                                 
                              
                           
                           |
                        . Actually, 
                           |
                           
                              c
                              (
                              
                                 
                                    t
                                 
                                 
                                    j
                                 
                              
                              )
                              −
                              
                                 
                                    Q
                                 
                                 
                                    j
                                 
                              
                           
                           |
                         is not the real deviation between data point 
                           
                              
                                 Q
                              
                              
                                 j
                              
                           
                         and B-spline curve
                           
                           c
                           
                              (
                              t
                              )
                           
                           .
                         As shown in 
                        Fig. 5, 
                           c
                           
                              (
                              
                                 
                                    
                                       t
                                    
                                    
                                       j
                                    
                                 
                              
                              )
                           
                         is a approximate foot point of 
                           
                              
                                 Q
                              
                              
                                 j
                              
                           
                        , and 
                           c
                           
                              (
                              
                                 
                                    
                                       
                                          t
                                          ¯
                                       
                                    
                                    
                                       j
                                    
                                 
                              
                              )
                           
                         is the projection point of 
                           
                              
                                 Q
                              
                              
                                 j
                              
                           
                         on the B-spline, 
                           
                              
                                 
                                    t
                                    ¯
                                 
                              
                              
                                 j
                              
                           
                         is the parameter of the projection point. In Section 3, the adjust vector of control point 
                           
                              
                                 P
                              
                              
                                 i
                              
                           
                         is defined as: 
                           
                              
                                 Δ
                              
                              
                                 i
                              
                           
                           =
                           μ
                           
                              ∑
                              
                                 j
                                 =
                                 0
                              
                              m
                           
                           
                              
                                 B
                              
                              
                                 i
                              
                              
                                 p
                              
                           
                           (
                           
                              
                                 t
                              
                              
                                 j
                              
                           
                           )
                           (
                           
                              
                                 Q
                              
                              
                                 j
                              
                           
                           −
                           c
                           (
                           
                              
                                 t
                              
                              
                                 j
                              
                           
                           )
                           )
                        , foot point parameters will also affect the fitting result of LSPIA because imprecise foot point parameters result in imprecise adjust vectors. Thus we refresh the foot point parameters to get better fitting result.

The foot point parameters updating method is to compute the projection point parameters of data points and use them as new foot point parameters. The projection point parameter 
                           
                              
                                 
                                    t
                                    ¯
                                 
                              
                              
                                 j
                              
                           
                         is computed by solving Eq. (9). The solution is obtained by using Newton iteration method.
                           
                              (9)
                              
                                 (
                                 
                                    
                                       Q
                                    
                                    
                                       j
                                    
                                 
                                 −
                                 c
                                 (
                                 t
                                 )
                                 )
                                 ⋅
                                 c
                                 ׳
                                 
                                    (
                                    t
                                    )
                                 
                                 =
                                 0
                              
                           
                        
                     

In the iterative steps of LSPIA, for every index 
                              i
                           , the control point 
                              
                                 
                                    P
                                 
                                 
                                    i
                                 
                              
                            is adjusted by the adjust vector 
                              
                                 
                                    Δ
                                 
                                 
                                    i
                                 
                              
                              =
                              μ
                              
                                 ∑
                                 
                                    j
                                    =
                                    0
                                 
                                 m
                              
                              
                                 
                                    B
                                 
                                 
                                    i
                                 
                                 
                                    p
                                 
                              
                              (
                              
                                 
                                    t
                                 
                                 
                                    j
                                 
                              
                              )
                              (
                              
                                 
                                    Q
                                 
                                 
                                    j
                                 
                              
                              −
                              c
                              (
                              
                                 
                                    t
                                 
                                 
                                    j
                                 
                              
                              )
                              )
                           , for every index 
                              j
                           , if 
                              
                              
                                 
                                    B
                                 
                                 
                                    i
                                 
                                 
                                    p
                                 
                              
                              (
                              
                                 
                                    t
                                 
                                 
                                    j
                                 
                              
                              )
                              >
                              0
                           ,
                              
                              
                                 
                                    Q
                                 
                                 
                                    j
                                 
                              
                            is considered as a related data point of 
                              
                                 
                                    P
                                 
                                 
                                    i
                                 
                              
                           . For control point 
                              
                                 
                                    P
                                 
                                 
                                    i
                                 
                              
                           , if its related data point offset vectors have consistent directions, then we can greatly decreased the related data errors by adjusting 
                              
                                 
                                    P
                                 
                                 
                                    i
                                 
                              
                            with 
                              
                                 
                                    Δ
                                 
                                 
                                    i
                                 
                              
                           . In this case 
                              
                                 
                                    P
                                 
                                 
                                    i
                                 
                              
                            is considered as having enough degree of freedom. Otherwise, we think 
                              
                                 
                                    P
                                 
                                 
                                    i
                                 
                              
                              
                            as lacking degree of freedom. Assuming that the related data points of control points 
                              
                                 
                                    P
                                 
                                 
                                    i
                                 
                              
                            are from 
                              
                                 
                                    Q
                                 
                                 
                                    s
                                 
                              
                              
                            to 
                              
                                 
                                    Q
                                 
                                 
                                    e
                                 
                              
                           , we measure the degree of freedom of 
                              
                                 
                                    P
                                 
                                 
                                    i
                                 
                              
                            by 
                              
                                 
                                    φ
                                 
                                 
                                    i
                                 
                              
                            which is defined in the following expression:
                              
                                 
                                    
                                       
                                          φ
                                       
                                       
                                          i
                                       
                                    
                                    =
                                    
                                       
                                          
                                             ∑
                                             
                                                j
                                                =
                                                s
                                             
                                             
                                                j
                                                =
                                                e
                                             
                                          
                                          
                                             |
                                             
                                                
                                                   
                                                      B
                                                   
                                                   
                                                      i
                                                   
                                                   
                                                      p
                                                   
                                                
                                                (
                                                
                                                   
                                                      t
                                                   
                                                   
                                                      j
                                                   
                                                
                                                )
                                                (
                                                
                                                   
                                                      Q
                                                   
                                                   
                                                      j
                                                   
                                                
                                                −
                                                c
                                                (
                                                
                                                   
                                                      t
                                                   
                                                   
                                                      j
                                                   
                                                
                                                )
                                                )
                                             
                                             |
                                          
                                       
                                       
                                          |
                                          
                                             
                                                
                                                   Δ
                                                
                                                
                                                   i
                                                
                                             
                                          
                                          |
                                       
                                    
                                 
                              
                           
                        

For control points 
                              
                                 
                                    P
                                 
                                 
                                    i
                                 
                              
                           , the greater the 
                              
                                 
                                    φ
                                 
                                 
                                    i
                                 
                              
                           , the more lacking of degree of freedom. To fulfill the data error requirement, we use data errors and degree of freedom of control points to find a knot interval to insert knot.

When a knot is inserted into the interval 
                              [
                              
                                 
                                    u
                                 
                                 
                                    i
                                 
                              
                              ,
                              
                                 
                                    u
                                 
                                 
                                    i
                                    +
                                    1
                                 
                              
                              ]
                           , the adjacent control points 
                              
                              
                                 
                                    P
                                 
                                 
                                    i
                                    −
                                    2
                                 
                              
                            and 
                              
                                 
                                    P
                                 
                                 
                                    i
                                    −
                                    1
                                 
                              
                            become new control points 
                              P
                              
                                 
                                    ׳
                                 
                                 
                                    i
                                    −
                                    2
                                 
                              
                           , 
                              P
                              
                                 
                                    ׳
                                 
                                 
                                    i
                                    −
                                    1
                                 
                              
                            and 
                              P
                              
                                 
                                    ׳
                                 
                                 
                                    i
                                 
                              
                           , the other control points remain unchanged. Therefore, we define the degree of freedom of the knot interval 
                              [
                              
                                 
                                    u
                                 
                                 
                                    i
                                 
                              
                              ,
                              
                              
                                 
                                    u
                                 
                                 
                                    i
                                    +
                                    1
                                 
                              
                              ]
                              
                            by the related data errors and the degree of freedom of 
                              
                              
                                 
                                    P
                                 
                                 
                                    i
                                    −
                                    2
                                 
                              
                            and 
                              
                                 
                                    P
                                 
                                 
                                    i
                                    −
                                    1
                                 
                              
                           .

For each interval 
                              [
                              
                                 
                                    u
                                 
                                 
                                    i
                                 
                              
                              ,
                              
                              
                                 
                                    u
                                 
                                 
                                    i
                                    +
                                    1
                                 
                              
                              ]
                           , if there has a data error that exceed fitting tolerance, we compute the degree of freedom of the knot interval 
                              [
                              
                                 
                                    u
                                 
                                 
                                    i
                                 
                              
                              ,
                              
                              
                                 
                                    u
                                 
                                 
                                    i
                                    +
                                    1
                                 
                              
                              ]
                           :
                              
                              
                                 
                                    γ
                                 
                                 
                                    i
                                 
                              
                              =
                              
                                 
                                    φ
                                 
                                 
                                    i
                                    −
                                    2
                                 
                              
                              +
                              
                                 
                                    φ
                                 
                                 
                                    i
                                    −
                                    1
                                 
                              
                           , else 
                              
                                 
                                    γ
                                 
                                 
                                    i
                                 
                              
                              =
                              0
                           . The knot interval with maximum 
                              
                                 
                                    γ
                                 
                                 
                                    i
                                 
                              
                              
                            is selected as the insert interval.

The optimization problem of finding the minimization of Eq. (3) only considers data error constraint, dose not consider chord error. In this section, the stretching energy term is used to decrease the chord error. The objective function Eq. (2) can be modified as:
                           
                              (10)
                              
                                 E
                                 
                                    (
                                    P
                                    )
                                 
                                 =
                                 
                                    ∑
                                    
                                       j
                                       =
                                       0
                                    
                                    m
                                 
                                 
                                    
                                       (
                                       
                                          c
                                          
                                             (
                                             
                                                
                                                   
                                                      t
                                                   
                                                   
                                                      j
                                                   
                                                
                                             
                                             )
                                          
                                          −
                                          
                                             
                                                Q
                                             
                                             
                                                j
                                             
                                          
                                       
                                       )
                                    
                                    2
                                 
                                 +
                                 ω
                                 
                                    ∫
                                    0
                                    1
                                 
                                 
                                    
                                       [
                                       
                                          
                                             
                                                d
                                                c
                                                
                                                   (
                                                   t
                                                   )
                                                
                                             
                                             
                                                d
                                                t
                                             
                                          
                                       
                                       ]
                                    
                                    2
                                 
                                 d
                                 t
                              
                           
                        
                     

The first term in Eq. (10) is the LSF error to constraint data error, and the second term is called stretching energy term to lower the chord error.
                           
                           ω
                           
                         is the weight of energy term. The matrix form of Eq. (10) is:
                           
                              (11)
                              
                                 E
                                 (
                                 P
                                 )
                                 =
                                 
                                    
                                       (
                                       
                                          AP
                                          −
                                          Q
                                       
                                       )
                                    
                                    T
                                 
                                 (
                                 AP
                                 −
                                 Q
                                 )
                                 +
                                 ω
                                 
                                    
                                       P
                                    
                                    T
                                 
                                 DP
                              
                           
                        where 
                           D
                           =
                           
                              
                                 D
                              
                              
                                 i
                                 j
                              
                           
                           =
                           
                           
                              ∫
                              0
                              1
                           
                           
                              
                                 B
                              
                              
                                 i
                              
                              
                                 ׳
                              
                           
                           (
                           t
                           )
                           
                              
                                 B
                              
                              
                                 j
                              
                              
                                 ׳
                              
                           
                           (
                           t
                           )
                           d
                           t
                        . The matrix 
                           D
                         can be computed by the numerical integration method presented in [21]. Similar to LSPIA, the steepest descent method can be used to minimize the objective function.

ELSPIA method can decrease the chord error, but the computation load is greater than LSPIA. So in actual algorithm implementation, we only use ELSPIA in the chord error refinement step. The minor cycle procedure still uses LSPIA method.

In the chord error refinement section, only several control points should be adjusted. Thus, a weight 
                           
                              
                                 ρ
                              
                              
                                 i
                              
                           
                         is given to each control point 
                           
                              
                                 P
                              
                              
                                 i
                                 
                              
                           
                         (if 
                           
                              
                                 P
                              
                              
                                 i
                              
                           
                        needs to be adjusted, 
                           
                              
                                 ρ
                              
                              
                                 i
                              
                           
                           =
                           1
                        , otherwise 
                           
                              
                                 ρ
                              
                              
                                 i
                              
                           
                           =
                           0
                           )
                        . We use the following method to solve the optimize problem. First the gradient vector of 
                           E
                           
                              (
                              P
                              )
                           
                         in Eq. (11) is computed as:
                           
                              (12)
                              
                                 ∇
                                 E
                                 (
                                 P
                                 )
                                 =
                                 2
                                 (
                                 
                                    
                                       A
                                    
                                    T
                                 
                                 (
                                 AP
                                 −
                                 Q
                                 )
                                 +
                                 ω
                                 DP
                                 )
                              
                           
                        
                     

Let 
                           
                              
                                 P
                              
                              k
                           
                           =
                           
                              
                                 (
                                 
                                    
                                       P
                                    
                                    
                                       0
                                    
                                    
                                       k
                                    
                                 
                                 ,
                                 
                                    
                                       P
                                    
                                    
                                       1
                                    
                                    
                                       k
                                    
                                 
                                 ,
                                 …
                                 ,
                                 
                                    
                                       P
                                    
                                    
                                       n
                                    
                                    
                                       k
                                    
                                 
                                 )
                              
                              T
                           
                         be the control point vector in the kth iteration, and 
                           
                              
                                 Δ
                              
                              k
                           
                           =
                           
                              
                                 (
                                 
                                    
                                       Δ
                                    
                                    
                                       0
                                    
                                    
                                       k
                                    
                                 
                                 ,
                                 
                                    
                                       Δ
                                    
                                    
                                       1
                                    
                                    
                                       k
                                    
                                 
                                 ,
                                 …
                                 ,
                                 
                                    
                                       Δ
                                    
                                    
                                       n
                                    
                                    
                                       k
                                    
                                 
                                 )
                              
                              T
                           
                         be the adjusting vector of control points in the kth iteration. 
                           H
                         is a diagonal matrix formed by the weights of control points.


                        
                           H
                        
                        
                           =
                           
                              [
                              
                                 
                                    
                                       
                                          
                                             
                                                
                                                   ρ
                                                
                                                
                                                   0
                                                
                                             
                                          
                                       
                                       
                                          
                                       
                                       
                                          
                                       
                                    
                                    
                                       
                                          
                                       
                                       
                                          ⋱
                                       
                                       
                                          
                                       
                                    
                                    
                                       
                                          
                                       
                                       
                                          
                                       
                                       
                                          
                                             
                                                
                                                   ρ
                                                
                                                
                                                   n
                                                
                                             
                                          
                                       
                                    
                                 
                              
                              ]
                           
                        
                     

Then we can improve the iterative steps of ELSPIA by using the matrix description:
                           
                              (13)
                              
                                 {
                                 
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      Δ
                                                   
                                                   k
                                                
                                                =
                                                
                                                μ
                                                (
                                                
                                                   
                                                      A
                                                   
                                                   T
                                                
                                                (
                                                Q
                                                −
                                                A
                                                
                                                   
                                                      P
                                                   
                                                   k
                                                
                                                )
                                                −
                                                ω
                                                D
                                                
                                                   
                                                      P
                                                   
                                                   k
                                                
                                                )
                                             
                                          
                                       
                                       
                                          
                                             
                                                
                                                   
                                                      P
                                                   
                                                   
                                                      k
                                                      +
                                                      1
                                                   
                                                
                                                =
                                                
                                                   
                                                      P
                                                   
                                                   k
                                                
                                                +
                                                H
                                                
                                                   
                                                      Δ
                                                   
                                                   
                                                      k
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           
                        
                     

where
                           
                           0
                           <
                           μ
                           <
                           
                              2
                              
                                 
                                    
                                       λ
                                    
                                    
                                       0
                                    
                                 
                              
                           
                        ,
                           
                           
                              
                                 λ
                              
                              
                                 0
                              
                           
                         is the largest eigenvalue of 
                           H
                        (
                           
                              
                                 A
                              
                              T
                           
                           A
                           +
                           ω
                           D
                           )
                        . The (k+1)th curve 
                           
                              
                                 c
                              
                              
                                 k
                                 +
                                 1
                              
                           
                           t
                         is:
                           
                              (14)
                              
                                 
                                    
                                       c
                                    
                                    
                                       k
                                       +
                                       1
                                    
                                 
                                 
                                    (
                                    t
                                    )
                                 
                                 =
                                 
                                    ∑
                                    
                                       i
                                       =
                                       0
                                    
                                    n
                                 
                                 
                                    
                                       B
                                    
                                    
                                       i
                                    
                                    
                                       p
                                    
                                 
                                 
                                    (
                                    t
                                    )
                                 
                                 
                                    
                                       P
                                    
                                    
                                       i
                                    
                                    
                                       k
                                       +
                                       1
                                    
                                 
                              
                           
                        
                        
                           Theorem 1.2
                           
                              The ELSPIA iterative method is convergent after several iterative steps.

For the proof of Theorem 1.2, please refer to the Appendix B.

In this paper, the fitted B-spline curve needs to satisfy two kinds of endpoint constraints. First, the B-spline curve must pass the endpoint of data points, and then the tool paths need to be 
                           
                              
                                 G
                              
                              1
                           
                         continuity at the endpoint between two adjacent B-splines or a B-spline and a segment. The endpoint tangent vectors are given before fitting.

In Section 4.1, we know that the end knots are always with multiplicity (p+1) in order to make the fitted curve interpolating the end points of data point blocks, and Remark 1.1 ensures the endpoint of control points do not move in the iterative steps of LSPIA.

To ensure 
                           
                              
                                 G
                              
                              1
                           
                         continuity at the endpoint of B-spline, given two unit tangent vectors
                           
                           
                              
                                 V
                              
                              
                                 1
                              
                           
                        and 
                           
                              
                                 V
                              
                              
                                 2
                              
                           
                        ,
                           
                           
                              
                                 l
                              
                              
                                 1
                              
                           
                        and 
                           
                              
                                 l
                              
                              
                                 2
                              
                           
                         are the length of endpoint tangent vectors of the B-spline. The fitted B-spline must satisfy the equations:
                           
                              
                                 
                                    
                                       c
                                    
                                    ׳
                                 
                                 (
                                 0
                                 )
                                 =
                                 
                                    
                                       l
                                    
                                    
                                       1
                                    
                                 
                                 
                                    
                                       V
                                    
                                    
                                       1
                                    
                                 
                                 ,
                                 
                                    
                                       
                                       
                                       c
                                    
                                    ׳
                                 
                                 (
                                 1
                                 )
                                 =
                                 
                                    
                                       l
                                    
                                    
                                       2
                                    
                                 
                                 
                                    
                                       V
                                    
                                    
                                       2
                                    
                                 
                              
                           
                        
                     

The endpoint tangent vectors of the B-spline with multiplicity (p+1) end knots are:
                           
                              
                                 c
                                 ׳
                                 (
                                 0
                                 )
                                 =
                                 p
                                 
                                    
                                       
                                          
                                             P
                                          
                                          
                                             1
                                          
                                       
                                       −
                                       
                                          
                                             P
                                          
                                          
                                             0
                                          
                                       
                                    
                                    
                                       
                                          
                                             u
                                          
                                          
                                             p
                                             +
                                             1
                                          
                                       
                                       −
                                       
                                          
                                             u
                                          
                                          
                                             1
                                          
                                       
                                    
                                 
                                 ,
                                 
                                 
                                 
                                    
                                       c
                                    
                                    ׳
                                 
                                 (
                                 1
                                 )
                                 =
                                 p
                                 
                                    
                                       
                                          
                                             P
                                          
                                          
                                             n
                                          
                                       
                                       −
                                       
                                          
                                             P
                                          
                                          
                                             n
                                             −
                                             1
                                          
                                       
                                    
                                    
                                       
                                          
                                             u
                                          
                                          
                                             p
                                             +
                                             n
                                          
                                       
                                       −
                                       
                                          
                                             u
                                          
                                          
                                             n
                                          
                                       
                                    
                                 
                              
                           
                        
                     

The length of the end tangent vectors is important to the quality of the B-spline at end portion. It may cause loop at the end of B-spline if the tangent length is too long, and the end two control points will be too close if the tangent length is too short. So we determine the length of end tangent vectors by the following approximate calculation:
                           
                              
                                 
                                    
                                       l
                                    
                                    
                                       1
                                    
                                 
                                 =
                                 
                                    
                                       
                                          
                                             Q
                                          
                                          
                                             1
                                          
                                       
                                       −
                                       
                                          
                                             Q
                                          
                                          
                                             0
                                          
                                       
                                    
                                    
                                       
                                          
                                             t
                                          
                                          
                                             1
                                          
                                       
                                       −
                                       
                                          
                                             t
                                          
                                          
                                             0
                                          
                                       
                                    
                                 
                                 ,
                                 
                                 
                                 
                                    
                                       l
                                    
                                    
                                       2
                                    
                                 
                                 =
                                 
                                    
                                       
                                          
                                             Q
                                          
                                          
                                             m
                                          
                                       
                                       −
                                       
                                          
                                             Q
                                          
                                          
                                             m
                                             −
                                             1
                                          
                                       
                                    
                                    
                                       
                                          
                                             t
                                          
                                          
                                             m
                                          
                                       
                                       −
                                       
                                          
                                             t
                                          
                                          
                                             m
                                             −
                                             1
                                          
                                       
                                    
                                 
                              
                           
                        
                     

To ensure 
                           
                              
                                 G
                              
                              1
                           
                         continuity, control points
                           
                              
                                 P
                              
                              
                                 0
                              
                           
                           ,
                           
                              
                                 P
                              
                              
                                 1
                              
                           
                           ,
                           
                              
                                 P
                              
                              
                                 n
                                 −
                                 1
                              
                           
                           ,
                           and
                           
                           
                              
                                 P
                              
                              
                                 n
                              
                           
                         are determined beforehand and will not move in the iterative steps of data points fitting.

The foot point parameters are firstly computed by the chord length parameters of data points, and then are updated by the parameters of projection points. In this study, first the parameters are updated right after the first B-spline is obtained, and then the parameters are updated every ten iterations of the minor cycle. The flowchart of the medium cycle is shown in 
                        Fig. 6.


                        
                        Fig. 7(a) and (b) plot the fitted curves of a data set before and after foot point parameters updating respectively. The machining tolerance is 0.03mm and the fitting tolerance is 0.015mm. During fitting, the minor cycle iterates 20 times without control points insertion. It can be seen that the fitted curve using foot point parameters updating method has better properties in shape-preserving and chord error.

In Section 4.3, we introduce the control point insertion method in the major cycle. The flowchart of the major cycle is shown in 
                        Fig. 8. After we select an interval that lacks degree of freedom and has at least two data point parameters inside, a knot can be inserted in this interval by selecting the middle point of the interval or the data point parameter with maximum data error in the interval. In our solution the middle point strategy is adopted. After control point insertion, both the data errors and chord errors can be decreased.

In tool path B-spline fitting, the most important and difficult problem is to satisfy the chord error requirement. To lower chord errors, the fitting tolerance in the data fitting steps can be set smaller than the machining tolerance. We check the chord errors by using the method introduced in Appendix. Chord error refinement aims to decrease the chord error that exceeds the allowed machining tolerance after fitting. The flowchart of chord error refinement is shown in 
                        Fig. 9. There is no need to adjust all control points in chord error refinement. So we need a strategy to determine which control points need to be selected to apply adjusting.

Chord error refinement is first to find a knot interval that contains at least one point where the chord error exceeds the machining tolerance, secondly insert a knot in the interval, determine weights of control points, and then use the ELSPIA method to compute the control points.

Assuming that the interval 
                           [
                           
                              
                                 u
                              
                              
                                 i
                                 ,
                              
                           
                           
                              
                                 u
                              
                              
                                 i
                                 +
                                 1
                              
                           
                           ]
                         contains at least one point where the chord error exceeds the machining tolerance, the adjusting control points are 
                           
                              
                                 P
                                 ׳
                              
                              
                                 i
                                 −
                                 2
                              
                           
                        , 
                           
                              
                                 P
                                 ׳
                              
                              
                                 i
                                 −
                                 1
                              
                           
                        , and 
                           
                              
                                 P
                                 ׳
                              
                              
                                 i
                              
                           
                         (new control points after knot insertion), the weights of 
                           
                              
                                 P
                                 ׳
                              
                              
                                 i
                                 −
                                 2
                              
                           
                        , 
                           
                              
                                 P
                                 ׳
                              
                              
                                 i
                                 −
                                 1
                              
                           
                        , and 
                           
                              
                                 P
                                 ׳
                              
                              
                                 i
                              
                           
                         need to be set to 1. The control points with weights equaling to 1 will be adjusted in the following chord error refinement process.

There are two weights in this section to be determined. The first is moving step 
                           μ
                        . An estimated 
                           
                           μ
                         can be determined by Gershgorin disc theorem [19]. For the details of the determination, please refer to the Appendix. The other is the weight of energy term. As we know, the adjusting vector of control points in the kth iteration is:
                           
                              
                                 
                                    
                                       Δ
                                    
                                    k
                                 
                                 =
                                 
                                 μ
                                 
                                    (
                                    
                                       
                                          
                                             A
                                          
                                          T
                                       
                                       
                                          (
                                          
                                             Q
                                             −
                                             A
                                             
                                                
                                                   P
                                                
                                                k
                                             
                                          
                                          )
                                       
                                       −
                                       ω
                                       D
                                       
                                          
                                             P
                                          
                                          k
                                       
                                    
                                    )
                                 
                                 =
                                 μ
                                 
                                    (
                                    
                                       
                                          
                                             A
                                          
                                          T
                                       
                                       Q
                                       −
                                       
                                          
                                             A
                                          
                                          T
                                       
                                       A
                                       
                                          
                                             P
                                          
                                          k
                                       
                                       −
                                       ω
                                       D
                                       
                                          
                                             P
                                          
                                          k
                                       
                                    
                                    )
                                 
                              
                           
                        
                     

To ensure that 
                           
                              
                                 A
                              
                              T
                           
                           A
                           
                              
                                 P
                              
                              k
                           
                         and
                           
                           D
                           
                              
                                 P
                              
                              k
                           
                         have the same order of magnitude, the weight 
                           ω
                         can be estimated by the matrixes 
                           
                              
                                 A
                              
                              T
                           
                           A
                         and
                           
                           D
                        .
                           
                              
                                 ω
                                 ≈
                                 
                                    
                                       t
                                       r
                                       a
                                       c
                                       e
                                       (
                                       
                                          
                                             A
                                          
                                          T
                                       
                                       A
                                       )
                                    
                                    
                                       t
                                       r
                                       a
                                       c
                                       e
                                       (
                                       D
                                       )
                                    
                                 
                              
                           
                        
                     

Using the same data points of Fig. 7, 
                        Table 1 compares the fitting result before and after chord error refinement. In the fitting, the machining tolerance is 0.03mm and fitting tolerance is 0.015mm. It can be seen that the fitted curve can satisfy the data error and chord error requirement after chord error refinement.

In our actual testing of various shapes of G-code, at least 99% of the fitted points satisfied the chord error refinement if given a reasonable machining tolerance, but if there were still some segments that exceeded the allowed machining tolerance, we had to cut off the exceeding spline into G01 segments to ensure the continuous motion of the CNC machining. The cutting sections were ensured to have 
                           
                              
                                 G
                              
                              1
                           
                         continuity between G01 and B-spline, but 
                           
                              
                                 G
                              
                              0
                           
                         continuity between G01 and G01. It was not a perfect strategy and B-spline blending method will be used in the future work.

A software framework is built to implement the tool path B-spline curve fitting algorithm. The tool paths in this study are generated by NX 9.0 with a given machining tolerance, and the data sets are cut off from the actual tool paths. Four data sets are fitted by cubic B-spline curves by using the proposed method. The data points and fitted curves are plotting in 
                        Fig. 10, and the fitting information is listing in 
                        Table 2. It can be seen that the number of control points is less than 50% of data point quantity, and the maximum data errors and maximum chord errors both satisfy the machining tolerance requirement.

The whole G-code can be fitted by our algorithm at the same time. 
                        Fig. 11 plots the G-codes before and after B-spline fitting. The G-code in Fig. 11(a) and (b) are the portion of the G-code at the lower right corner of Fig. 11(a) and (b), respectively. The G01 points are colored with light green and the B-splines are colored with yellow. Fig. 11(a) is the original G-code formed by G01, and Fig. 11(b) is the G-code formed by G01 and B-splines.

In Fig. 11(b), the dark green sections are long segments, which do not be fitted for they are feature of the parts. We can see that the G-code after fitting is smoother than the original G01 points. The original G01 code only has 
                           
                              
                                 G
                              
                              0
                           
                           
                         continuity, but the G-code after B-spline fitting have 
                           
                              
                                 G
                              
                              1
                           
                           
                         continuity between G01 and B-spline, and between two B-splines. Moreover, the cubic B-spline without multiply knots has 
                           
                              
                                 G
                              
                              2
                           
                           
                         continuity.


                        
                        Fig. 12 compares the fitting result of LSPIA and ELSPIA. In Fig. 12(a), the fitting curves of both LSPIA and ELSPIA are plotted, and the details are plotting in Fig. 12(b) and (c), respectively. It can be seen that the fitted curve of ELSPIA is closer to the polyline formed by data points, so the chord error of ELSPIA is smaller than LSPIA, which demonstrates that the stretching energy term works and stretches the fitting curve to decrease the chord error.

In this section, we compare our fitting results with the fitting results of CAM software NX. The fitted G-codes are plotted in 
                        
                        
                        Figs. 13–15 and the fitting information is listed in 
                        Table 3.


                        Figs. 13–15 demonstrates three workpieces’ toolpaths fitted by NX and our method. In our method, the HBPs and long segment are identified in the preprocessing and the long segments remain unchanged in the fitting process, but NX fits the G-code without considering long segment. We can find the difference in Figs. 14 and 15.


                        Table 3 lists the fitting information of the three workpiece in Figs. 13–15. It can be seen that the G-codes fitted by our method have less points of 
                           
                              
                                 G
                              
                              1
                           
                           
                         discontinuity and 
                           
                              
                                 G
                              
                              2
                           
                           
                         discontinuity than NX, which demonstrates that our method can improve the continuity of tool paths. There are still several 
                           
                              
                                 G
                              
                              
                                 1
                                 
                              
                           
                         discontinuity points because our method did not confine 
                           
                              
                                 G
                              
                              1
                           
                           
                         continuity in the HBPs location. The maximum chord errors of NX and our result listed in Table 3 can reach chord error requirement. The average chord errors of our method are smaller than NX׳s of the three examples, which can make a contribution to obtain better machining results, but it may be one of the reasons that we have more control points than NX.

In this section, the proposed scheme is implemented in a Drilling and milling machining center (HNC(Huazhong Numerical Control)-818A/MD CNC system) Tool TC500R made by Shenyang Machine, as shown in 
                        Fig. 16. The configuration information of TC500R is listing in 
                        Table 4
                     

In the machining, some machining parameters such as feed rate and spindle speed need to be set beforehand, we list the machining parameters of the “C-shape block”, “Bird׳s nest”, and “Variant curvature” in 
                        Table 5. The work-blank of the three adopted workpiece is cube with dimension of 40mm×40mm×40mm, and the material of the work-blank is 6061 aluminum alloy. The cutter used in the machining is a ball end mill made of cemented carbide.

The machining effects are shown in 
                        
                        
                        Figs. 17–19. Each workpiece is machined three times using: original G01, NURBS fitted by NX, and NURBS fitted by our method. To obtain more precise machining time measurement, we utilized the cycle time of the servo drive to compute the actual machining time excluding the air (non-cutting) time of the cutter. As shown in 
                        Table 6, there is not much difference among the actual machining time of the three workpiece. The result is not conclusive because only one commercial machine tool and CNC system is used for the tests but it reflects that there are rooms for improvements of both NX and our method.

To evaluate machining quality, we measured the surface roughness of the machining workpiece. The device we used is a Comprehensive Measurement System for Surface Profile TAYLOR HOBSON PGI830. As shown in 
                        Fig. 20. The measurement range of the device is 200mm in X-axis and 8mm in Z-axis, the measurement accuracy is with resolution 0.8nm/8mm. In the testing, the sample length is set to 2mm in the surface and 5mm in the plane. We take the index Ra to measure surface roughness. The testing locations are marked in 
                        Fig. 21.

We test every workpiece in three locations, as marked in Fig. 21. For each location, we test the roughness in two directions: follow and crossing, meaning it is following or crossing the cutting direction, respectively. We measure the roughness in two directions because both affect the surface quality, although tool path fitting focuses on only the quality of the follow direction. In order to remove the effects of errors, we test every location ten times and compute the mean value as the roughness of the location.

Summarizing the 9 groups of data in 
                        Table 7 regarding the crossing roughness, our method is better than G01 in 6 cases, and 1 case better than the NURBS of NX. As for the follow roughness, our method is better than G01 in 5 cases, and 6 cases better than the NURBS of NX. Overall, the differences are not significant enough to draw the conclusion.

@&#CONCLUSION@&#

This paper presents a new approach to approximate G01 paths with cubic B-spline curves. It can improve the continuity of tool paths and ensure efficient high-speed machining. We use a progressive and iterative approximation incorporating energy term to avoid the computational cost of solving linear equations and lower the chord error by using stretching energy term. We take three measures to satisfy the requirements for tool path fitting: ELSPIA, foot point parameters updating and control points’ refinement.

In the experiment, we compared our fitting results with the original G01 tool paths and the fitting results of NX. Our method has less points of 
                        
                           
                              G
                           
                           1
                        
                      and 
                        
                           
                              G
                           
                           2
                        
                      discontinuity and smaller average chord error than NX׳s, but our method generates more control points than NX. Roughness testing indicates that our method has better quality in some case, but worse quality than G01 or NX in some locations. Experiment reflects that the algorithm in this paper is robust and suitable for general industrial applications but still have some improvement space.

Machining time and surface roughness are the ultimate measuring stick of the worthiness of tool path fitting algorithms. Our results showed slight improvement over the G01 and NX NURBS tool paths, but the results are not statistically significant to be conclusive. More work is required to enhance/modify the fitting algorithm to further improve the path continuity and surface quality. We believe the algorithm presented in the paper is robust and ready for real-world applications. It also provides a good start for further improvement.

Currently we are working on an algorithm to address the crossing roughness in order to achieve the overall surface quality. In addition, we plan to extend the tool path B-spline fitting method to 5-axis machining. The crossing optimization of 5-axis machining is also under consideration.

@&#ACKNOWLEDGMENTS@&#

The authors gratefully acknowledge National Science and Technology Major Project of the Ministry of Science and Technology of China (2013ZX04007041). The authors would also like to thank the support from colleagues Haiqing Jiang, Zhengming Hu, Minmin Wang and Yanfen Huang.

In this paper, given the data points 
                        
                           
                              {
                              
                                 
                                    Q
                                 
                                 
                                    j
                                 
                              
                              }
                           
                           
                              j
                              =
                              0
                           
                           
                              m
                           
                        
                     , for every
                        
                        
                           
                              Q
                           
                           
                              j
                           
                        
                     , the discrete curvature 
                        
                           
                              k
                           
                           
                              j
                           
                        
                        
                     is computed by second difference quotients. The computational steps are:

Step1: compute the chord length:
                        
                        
                           
                              s
                           
                           
                              j
                           
                        
                        =
                        
                           ∑
                           
                              j
                              =
                              1
                           
                           m
                        
                        |
                        
                           
                              Q
                           
                           
                              j
                           
                        
                        −
                        
                           
                              Q
                           
                           
                              j
                              −
                              1
                           
                        
                        |
                     ;

Step2: compute the first difference quotients: 
                        T
                        
                           [
                           
                              
                                 
                                    s
                                 
                                 
                                    j
                                 
                              
                              ,
                              
                                 
                                    s
                                 
                                 
                                    j
                                    −
                                    1
                                 
                              
                           
                           ]
                        
                        =
                        
                           
                              
                                 
                                    Q
                                 
                                 
                                    j
                                 
                              
                              −
                              
                                 
                                    Q
                                 
                                 
                                    j
                                    −
                                    1
                                 
                              
                           
                           
                              
                                 
                                    s
                                 
                                 
                                    j
                                 
                              
                              −
                              
                                 
                                    s
                                 
                                 
                                    j
                                    −
                                    1
                                 
                              
                           
                        
                     ;

Step3: compute the second difference quotients: 
                        T
                        
                           [
                           
                              
                                 
                                    s
                                 
                                 
                                    j
                                    +
                                    1
                                 
                              
                              ,
                              
                                 
                                    s
                                 
                                 
                                    j
                                 
                              
                              ,
                              
                                 
                                    s
                                 
                                 
                                    j
                                    −
                                    1
                                 
                              
                           
                           ]
                        
                        =
                        
                           
                              T
                              
                                 [
                                 
                                    
                                       
                                          s
                                       
                                       
                                          j
                                          +
                                          1
                                       
                                    
                                    ,
                                    
                                       
                                          s
                                       
                                       
                                          j
                                       
                                    
                                 
                                 ]
                              
                              −
                              T
                              
                                 [
                                 
                                    
                                       
                                          s
                                       
                                       
                                          j
                                       
                                    
                                    ,
                                    
                                       
                                          s
                                       
                                       
                                          j
                                          −
                                          1
                                       
                                    
                                 
                                 ]
                              
                           
                           
                              
                                 
                                    s
                                 
                                 
                                    j
                                    +
                                    1
                                 
                              
                              −
                              
                                 
                                    s
                                 
                                 
                                    j
                                    −
                                    1
                                 
                              
                           
                        
                     ;

Step4: the discrete curvature is
                        
                        :
                        
                        
                           
                              k
                           
                           
                              j
                           
                        
                        =
                        2
                        T
                        
                           [
                           
                              
                                 
                                    s
                                 
                                 
                                    j
                                    +
                                    1
                                 
                              
                              ,
                              
                                 
                                    s
                                 
                                 
                                    j
                                 
                              
                              ,
                              
                                 
                                    s
                                 
                                 
                                    j
                                    −
                                    1
                                 
                              
                           
                           ]
                        
                     ;


                     
                        Proof
                        Letting
                              
                              I
                            be the n+1 rank identity matrix and
                              
                              V
                              =
                              
                                 
                                    A
                                 
                                 T
                              
                              A
                              +
                              ω
                              D
                           .
                              
                                 
                                    
                                       1
                                       2
                                    
                                    ∇
                                    E
                                    
                                       (
                                       
                                          
                                             
                                                P
                                             
                                             
                                                k
                                                +
                                                1
                                             
                                          
                                       
                                       )
                                    
                                    =
                                    V
                                    
                                       
                                          P
                                       
                                       
                                          k
                                          +
                                          1
                                       
                                    
                                    −
                                    
                                       
                                          A
                                       
                                       T
                                    
                                    Q
                                 
                              
                           
                           
                              
                                 
                                    =
                                    V
                                    (
                                    
                                       
                                          P
                                       
                                       
                                          k
                                          +
                                          1
                                       
                                    
                                    −
                                    
                                       
                                          V
                                       
                                       
                                          −
                                          1
                                       
                                    
                                    
                                       
                                          A
                                       
                                       T
                                    
                                    Q
                                    )
                                 
                              
                           
                           
                              
                                 
                                    =
                                    
                                    V
                                    [
                                    
                                       
                                          P
                                       
                                       k
                                    
                                    +
                                    μ
                                    H
                                    (
                                    
                                       
                                          A
                                       
                                       T
                                    
                                    Q
                                    −
                                    V
                                    
                                       
                                          P
                                       
                                       k
                                    
                                    )
                                    −
                                    
                                       
                                          V
                                       
                                       
                                          −
                                          1
                                       
                                    
                                    
                                       
                                          A
                                       
                                       T
                                    
                                    Q
                                    ]
                                 
                              
                           
                           
                              
                                 
                                    =
                                    V
                                    (
                                    I
                                    −
                                    μ
                                    HV
                                    )
                                    (
                                    
                                       
                                          P
                                       
                                       k
                                    
                                    −
                                    
                                       
                                          V
                                       
                                       
                                          −
                                          1
                                       
                                    
                                    
                                       
                                          A
                                       
                                       T
                                    
                                    Q
                                    )
                                 
                              
                           
                           
                              
                                 
                                    =
                                    ⋯
                                 
                              
                           
                           
                              
                                 
                                    =
                                    V
                                    (
                                    I
                                    −
                                    μ
                                    HV
                                    )
                                    (
                                    
                                       
                                          P
                                       
                                       0
                                    
                                    −
                                    
                                       
                                          V
                                       
                                       
                                          −
                                          1
                                       
                                    
                                    
                                       
                                          A
                                       
                                       T
                                    
                                    Q
                                    )
                                 
                              
                           
                        

Note that when
                              
                              0
                              <
                              μ
                              <
                              
                                 2
                                 
                                    
                                       
                                          λ
                                       
                                       
                                          0
                                       
                                    
                                 
                              
                           ,
                              
                              0
                              <
                              ρ
                              (
                              I
                              −
                              μ
                              HV
                              )
                              <
                              1
                           , where 
                              ρ
                              (
                              I
                              −
                              μ
                              HV
                              )
                            is the spectral radius of 
                              (
                              I
                              −
                              μ
                              HV
                              )
                           . Therefore,
                              
                                 
                                    
                                       
                                          lim
                                       
                                       
                                          k
                                          →
                                          ∞
                                       
                                    
                                    
                                       
                                          (
                                          
                                             I
                                             −
                                             μ
                                             HV
                                          
                                          )
                                       
                                       k
                                    
                                    =
                                    
                                       
                                          (
                                          0
                                          )
                                       
                                       
                                          n
                                          +
                                          1
                                       
                                    
                                 
                              
                           
                        

Where 
                              
                                 
                                    (
                                    0
                                    )
                                 
                                 
                                    n
                                    +
                                    1
                                 
                              
                           is an n+1 rank zero matrix. 
                              
                                 1
                                 2
                              
                              ∇
                              E
                              
                                 (
                                 
                                    
                                       
                                          P
                                       
                                       ∞
                                    
                                 
                                 )
                              
                              =
                              0
                           . So the ELSPIA method is convergent after several iterative steps.

For Eq. (13), the iterative sequence is convergent when
                        
                        0
                        <
                        μ
                        <
                        
                           2
                           
                              
                                 
                                    λ
                                 
                                 
                                    0
                                 
                              
                           
                        
                     . 
                        
                           
                              λ
                           
                           
                              0
                           
                        
                        
                     is the largest eigenvalue of 
                        H
                     (
                        
                           
                              A
                           
                           T
                        
                        A
                        +
                        ω
                        D
                        )
                     . We can give a practical best weight by estimating the eigenvalues of 
                        H
                     (
                        
                           
                              A
                           
                           T
                        
                        A
                        +
                        ω
                        D
                        )
                        
                     with Gershgorindisc theorem [19]. The practical best weight is: 
                        μ
                        =
                        
                           2
                           C
                        
                     , 
                        C
                        =
                        
                           
                              max
                           
                           
                              i
                           
                        
                        
                           {
                           
                              
                                 
                                    c
                                 
                                 
                                    i
                                 
                              
                           
                           }
                        
                        ,
                        (
                        i
                        =
                        0
                        ,
                        1
                        ,
                        …
                        n
                        )
                     ,
                        
                        
                           
                              c
                           
                           
                              i
                           
                        
                      is the sum of the absolute value of the ith row elements of
                        
                        H
                     (
                        
                           
                              A
                           
                           T
                        
                        A
                        +
                        ω
                        D
                        )
                     .

In this study, we check chord errors by segment processing. As shown in 
                     Fig. 22, we can find the corresponding curve segment 
                        c
                        
                           (
                           t
                           )
                        
                        (
                        
                        t
                        ∈
                        [
                        
                           
                              t
                           
                           
                              j
                           
                        
                        ,
                        
                           
                              t
                           
                           
                              j
                              +
                              1
                           
                        
                        ]
                        )
                      for segment 
                        
                           
                              Q
                           
                           
                              j
                           
                        
                        
                           
                              Q
                           
                           
                              j
                              +
                              1
                           
                        
                     , then the maximum distance is measured by the distance of common vertical segment. The purpose is to find a parameter 
                        
                           
                              t
                           
                           ⁎
                        
                     , s.t. 
                        
                        c
                        
                           (
                           
                              
                                 
                                    t
                                 
                                 ⁎
                              
                           
                           )
                        
                        
                           Q
                           ¯
                        
                        ⋅
                        
                           
                              c
                           
                           ׳
                        
                        
                           (
                           
                              
                                 
                                    t
                                 
                                 ⁎
                              
                           
                           )
                        
                        =
                        0
                        .
                        
                        
                           Q
                           ¯
                        
                      is the pedal from the point 
                        c
                        
                           (
                           
                              
                                 
                                    t
                                 
                                 ⁎
                              
                           
                           )
                        
                      to do vertical line for the segment 
                        
                           
                              Q
                           
                           
                              j
                           
                        
                        
                           
                              Q
                           
                           
                              j
                              +
                              1
                           
                        
                     .
                        
                        c
                        ׳
                        
                           (
                           
                              
                                 
                                    t
                                 
                                 ⁎
                              
                           
                           )
                        
                      is the tangent vector at the point 
                        c
                        
                           (
                           
                              
                                 
                                    t
                                 
                                 ⁎
                              
                           
                           )
                        
                     .

To solve the equation 
                        c
                        
                           (
                           t
                           )
                        
                        
                           Q
                           ¯
                        
                        ⋅
                        c
                        ׳
                        
                           (
                           t
                           )
                        
                        =
                        0
                     , replace 
                        t
                      with 
                        x
                      in order not to make confusion with data point parameters 
                        
                           
                              t
                           
                           
                              j
                           
                        
                     , we translate it into solving the minimize problem of the following function:
                        
                           
                              f
                              
                                 (
                                 x
                                 )
                              
                              =
                              
                                 
                                    Q
                                 
                                 
                                    j
                                 
                              
                              c
                              
                                 (
                                 x
                                 )
                              
                              ×
                              
                                 
                                    Q
                                 
                                 
                                    j
                                 
                              
                              
                                 
                                    Q
                                 
                                 
                                    j
                                    +
                                    1
                                 
                              
                              ×
                              
                                 
                                    Q
                                 
                                 
                                    j
                                 
                              
                              
                                 
                                    Q
                                 
                                 
                                    j
                                    +
                                    1
                                 
                              
                              ⋅
                              c
                              ׳
                              
                                 (
                                 x
                                 )
                              
                           
                        
                     
                  

We use the Newton iteration method to solve the problem, set an initial value 
                        
                           
                              x
                           
                           
                              0
                           
                        
                     , the iteration step is:
                        
                           
                              
                                 
                                    x
                                 
                                 
                                    i
                                    +
                                    1
                                 
                              
                              =
                              
                                 
                                    x
                                 
                                 
                                    i
                                 
                              
                              −
                              
                                 
                                    f
                                    
                                       (
                                       
                                          
                                             
                                                x
                                             
                                             
                                                i
                                             
                                          
                                       
                                       )
                                    
                                 
                                 
                                    
                                       
                                          f
                                       
                                       ׳
                                    
                                    
                                       (
                                       
                                          
                                             
                                                x
                                             
                                             
                                                i
                                             
                                          
                                       
                                       )
                                    
                                 
                              
                              =
                              
                                 
                                    x
                                 
                                 
                                    i
                                 
                              
                              −
                              
                                 
                                    
                                       
                                          Q
                                       
                                       
                                          j
                                       
                                    
                                    c
                                    
                                       (
                                       x
                                       )
                                    
                                    ×
                                    
                                       
                                          Q
                                       
                                       
                                          j
                                       
                                    
                                    
                                       
                                          Q
                                       
                                       
                                          j
                                          +
                                          1
                                       
                                    
                                    ×
                                    
                                       
                                          Q
                                       
                                       
                                          j
                                       
                                    
                                    
                                       
                                          Q
                                       
                                       
                                          j
                                          +
                                          1
                                       
                                    
                                    ⋅
                                    c
                                    ׳
                                    
                                       (
                                       x
                                       )
                                    
                                 
                                 
                                    
                                       
                                          Q
                                       
                                       
                                          j
                                       
                                    
                                    c
                                    
                                       (
                                       x
                                       )
                                    
                                    ×
                                    
                                       
                                          Q
                                       
                                       
                                          j
                                       
                                    
                                    
                                       
                                          Q
                                       
                                       
                                          j
                                          +
                                          1
                                       
                                    
                                    ×
                                    
                                       
                                          Q
                                       
                                       
                                          j
                                       
                                    
                                    
                                       
                                          Q
                                       
                                       
                                          j
                                          +
                                          1
                                       
                                    
                                    ⋅
                                    c
                                    ׳
                                    ׳
                                    
                                       (
                                       x
                                       )
                                    
                                    +
                                    c
                                    ׳
                                    
                                       (
                                       x
                                       )
                                    
                                    ×
                                    
                                       
                                          Q
                                       
                                       
                                          j
                                       
                                    
                                    
                                       
                                          Q
                                       
                                       
                                          j
                                          +
                                          1
                                       
                                    
                                    ×
                                    
                                       
                                          Q
                                       
                                       
                                          j
                                       
                                    
                                    
                                       
                                          Q
                                       
                                       
                                          j
                                          +
                                          1
                                       
                                    
                                    ⋅
                                    c
                                    ׳
                                    
                                       (
                                       x
                                       )
                                    
                                 
                              
                           
                        
                     
                  

@&#REFERENCES@&#

