@&#MAIN-TITLE@&#A continuous buffer allocation model using stochastic processes

@&#HIGHLIGHTS@&#


               
               
                  
                     
                        
                           
                           Rigorous derivation of a continuous model for the buffer allocation problem based on a discrete time recursion.


                        
                        
                           
                           An adjoint approach is used to efficiently compute sensitivity/gradient information for the presented model.


                        
                        
                           
                           Moderate increase of the computing times for optimization tasks with respect to the number of pieces and processors.


                        
                     
                  
               
            

@&#KEYPHRASES@&#

Production systems

Buffer allocation

Sampling

Nonlinear optimization,

@&#ABSTRACT@&#


               
               
                  The buffer allocation problem consists of a dynamical description of the underlying production process combined with stochastic processing times. The aim is to find optimal buffer sizes averaged over several samples. Starting from a time-discrete recursion we derive a time-continuous model supplemented with a stochastic process. The new model is used for simulation and optimization purposes as well. Numerical experiments show the efficiency of our approach compared to other optimization techniques.
               
            

@&#INTRODUCTION@&#

Production systems are organized in a way that the best possible output is reached and storage costs are minimized. However, this objective is usually influenced by external factors such as fluctuating demands, supply bottlenecks or individual product specifications. In most instances, the overall goal is to minimize the total buffer load, where the production dynamics is induced by processing order inequalities and restrictions on the system capacities. Typical applications we think of include the motor vehicle industry in the case of automotive parts as well as other kinds of processing industries.

Mathematical models provide a powerful tool to study and analyze production systems. Especially in the case of the buffer allocation problem, see Alfieri and Matta (2012),Burman (1995),Dallery and Gershwin (1992),Demir, Tunali, and Eliiyi (2014),Dolgui, Eremeev, Kovalyov, and Sigaev (2013),Gershwin (1987),Gershwin and Schor (2000),Gershwin and Tan (2009); 2010), Gürkan (2000),Helber, Schimmelpfeng, Stolletz, and Lagershausen (2011),Matta (2008), and Tan and Yeralan (1997) for an overview. One can basically distinguish between discrete and continuous models. Discrete models are characterized by discrete time periods and work pieces while continuous models instead rely on continuous time and approximate quantities, see e.g. Armbruster, Degond, and Ringhofer (2006),Degond and Ringhofer (2007),Göttlich, Herty, and Klar (2006),Göttlich, Herty, and Ringhofer (2010). In this paper, we focus on a model connecting these two perspectives from a numerical point of view.

In Section 2, a discrete time recursion formula is introduced which can be used for the tracking of individual work pieces through a production system, also called discrete event simulation (DES). The work pieces have particular processing times which are randomly distributed. Evaluation measures help to determine buffer loads and the current work in progress (WIP). The goal is to minimize the total buffer size in the production system. The resulting optimization problem can be exactly reformulated as a mixed integer linear program (MIP), and as illustrated in Matta (2008),Stolletz and Weiss (2013), and Weiss and Stolletz (2013), there is a strong need for adapted solution methods to tackle the underlying MIP—even for smaller test cases. Optimization techniques such as Benders decomposition must be applied to solve the models within an acceptable time frame. In further literature, the classical buffer allocation problem (cf. Demir et al., 2014 and the references therein) is based on a similar idea leading to a NP-hard combinatorial optimization problem. Without additional heuristics there is nearly no chance to deal with large-scale problems.

Another modeling approach, also implying a different optimization as indicated in Fig. 1
                     , will be our major concern. It is well known that discrete event models provide the most accurate description of the underlying dynamics for simulation purposes. However, it is a microscopic model, meaning that the computation times highly depend on the number of work pieces to be considered. An optimization problem based on such a model at first leads to simulation-based optimization procedures only and is usually extremely costly, see Göttlich et al. (2006). In order to derive a suitable optimization framework, one can introduce an associated mixed integer linear program. Although this program is still dependent on individual parts, the optimization can be done in a well-defined way using common Branch and Bound algorithms. At best, global optimality can be reached.

Within this article we are interested in models on a macroscopic scale, or more precisely, we rigorously derive a continuous model which avoids the dependence on single parts and discrete options for the buffer capacities. The benefit of such a continuous model is that it can be used for fast simulation and also optimization. For the optimization we apply nonlinear methods leading to qualitatively very good results close to the mixed integer solution.

The paper is organized as follows: First, based on the discrete time recursion described in Section 2, we formally derive a time-continuous model in Section 4 and also describe its numerical treatment (Section 5.1). Then, using nonlinear optimization techniques as in Göttlich, Kolb, and Kühn (2014),Kirchner, Herty, Göttlich, and Klar (2006),Kolb (2011), and Kolb and Lang (2012), we are able to solve the reformulated problem by a gradient method (cf. Section 5.2). The quality of the results is very promising as pointed out in Section 6.

In this section, we start with the description of a time discrete model called discrete event simulation that is suitable for evaluating queuing systems. Similar approaches can be found in Armbruster et al. (2006),Stolletz and Weiss (2013), and Weiss and Stolletz (2013).

We consider a queuing network with K consecutive processors, each of them with a queue of size Cm
                      (m ∈ {1, … , K}) in front, see Fig. 2
                     . The times T
                     
                        m, n
                      needed by processor m to process piece n (n ∈ {1, … , N}) follow a processor dependent random distribution and will be sampled accordingly. Note that for the evaluation and the comparison of all presented models (Sections 2–4), we always consider several samples of processing times T
                     
                        m, n
                      in the numerical results in Section 6, but the same samples will be used for all models. Transport times between different processors are neglected and so the work pieces are directly fed into the next production unit.

The main ingredient of a time recursion is the modeling of effects such as free flow, starving and blocking. Let τ
                     
                        m, n
                      be the arrival time of piece n at the queue of processor m. Assuming all pieces are processed as fast as possible, the arrival times of the considered production line read

                        
                           (1)
                           
                              
                                 
                                    τ
                                    
                                       m
                                       ,
                                       n
                                    
                                 
                                 =
                                 max
                                 
                                    {
                                    max
                                    
                                       {
                                       
                                          τ
                                          
                                             m
                                             ,
                                             n
                                             −
                                             1
                                          
                                       
                                       ,
                                       
                                          τ
                                          
                                             m
                                             −
                                             1
                                             ,
                                             n
                                          
                                       
                                       }
                                    
                                    +
                                    
                                       T
                                       
                                          m
                                          −
                                          1
                                          ,
                                          n
                                       
                                    
                                    ,
                                    
                                       τ
                                       
                                          m
                                          +
                                          1
                                          ,
                                          n
                                          −
                                          (
                                          
                                             C
                                             m
                                          
                                          +
                                          1
                                          )
                                       
                                    
                                    }
                                 
                                 .
                              
                           
                        
                     The first term,

                        
                           
                              
                                 max
                                 
                                    {
                                    
                                       τ
                                       
                                          m
                                          ,
                                          n
                                          −
                                          1
                                       
                                    
                                    ,
                                    
                                       τ
                                       
                                          m
                                          −
                                          1
                                          ,
                                          n
                                       
                                    
                                    }
                                 
                                 +
                                 
                                    T
                                    
                                       m
                                       −
                                       1
                                       ,
                                       n
                                    
                                 
                                 ,
                              
                           
                        
                     results from the fact that piece n cannot be started being processed at processor m − 1 before the preceding piece n − 1 has left processor m − 1 and therewith arrived at (the queue) of processor m at time τ
                     
                        m, n − 1 (free flow) and not earlier than the arrival time τ
                     
                        m − 1, n
                      of piece n at processor m − 1 (starving). The second term in (1) ensures that if there is enough space in the queue in front of processor m (at least piece n − (Cm
                      + 1) has been processed, yielding a free slot), the piece n can be processed directly, otherwise it will be stopped (blocking). For given initial conditions τ
                     1, n
                      (arrival times at the first processor), processing times T
                     
                        m, n
                      and queue sizes Cm
                     , a simulation/evaluation of the arrival times τ
                     
                        m, n
                      (m ∈ {2, … , K + 1}, n ∈ {1, … N}) can be done based on (1) (with τ
                     
                        m, n
                      = −∞ if n ≤ 0 or m > K + 1). Here, we typically assume τ
                     1, n
                      = 0 and C
                     1 = C
                     
                        K + 1 = ∞. Note that we also consider τ
                     
                        K + 1, n
                     , as the time when piece n leaves the last processor.

In a next step, cf. Armbruster et al. (2006) and Göttlich et al. (2006), evaluation measures are needed to identify the quantities flux and WIP. Mathematically, we introduce the concept of curves of cumulative counts using the Heaviside function H( · ). Then, with

                        
                           
                              
                                 H
                                 
                                    (
                                    x
                                    )
                                 
                                 =
                                 
                                    {
                                    
                                       
                                          
                                             1
                                          
                                          
                                             
                                                x
                                                ≥
                                                0
                                             
                                          
                                       
                                       
                                          
                                             0
                                          
                                          
                                             
                                                x
                                                <
                                                0
                                             
                                          
                                       
                                    
                                 
                              
                           
                        
                     we denote by

                        
                           
                              
                                 
                                    U
                                    m
                                 
                                 
                                    (
                                    t
                                    )
                                 
                                 =
                                 
                                    ∑
                                    
                                       n
                                       =
                                       1
                                    
                                    N
                                 
                                 H
                                 
                                    (
                                    t
                                    −
                                    
                                       τ
                                       
                                          m
                                          ,
                                          n
                                       
                                    
                                    )
                                 
                              
                           
                        
                     the number of pieces having arrived at (the queue of) processor m until time t. Further, we define the flux

                        
                           
                              
                                 
                                    F
                                    m
                                 
                                 
                                    (
                                    t
                                    )
                                 
                                 =
                                 
                                    d
                                    
                                       
                                       dt
                                    
                                 
                                 
                                    U
                                    m
                                 
                                 
                                    (
                                    t
                                    )
                                 
                                 =
                                 
                                    ∑
                                    
                                       n
                                       =
                                       1
                                    
                                    N
                                 
                                 δ
                                 
                                    (
                                    t
                                    −
                                    
                                       τ
                                       
                                          m
                                          ,
                                          n
                                       
                                    
                                    )
                                 
                                 ,
                              
                           
                        
                     where δ is the Dirac delta function (derivative of the Heaviside function in a distributional sense), and the WIP

                        
                           
                              
                                 
                                    W
                                    m
                                 
                                 
                                    (
                                    t
                                    )
                                 
                                 =
                                 
                                    U
                                    m
                                 
                                 
                                    (
                                    t
                                    )
                                 
                                 −
                                 
                                    U
                                    
                                       m
                                       +
                                       1
                                    
                                 
                                 
                                    (
                                    t
                                    )
                                 
                                 +
                                 
                                    W
                                    
                                       m
                                       ,
                                       0
                                    
                                 
                              
                           
                        
                     with initial conditions W
                     
                        m, 0. Obviously,

                        
                           (2)
                           
                              
                                 
                                    d
                                    
                                       
                                       dt
                                    
                                 
                                 
                                    W
                                    m
                                 
                                 
                                    (
                                    t
                                    )
                                 
                                 =
                                 
                                    F
                                    m
                                 
                                 
                                    (
                                    t
                                    )
                                 
                                 −
                                 
                                    F
                                    
                                       m
                                       +
                                       1
                                    
                                 
                                 
                                    (
                                    t
                                    )
                                 
                              
                           
                        
                     holds. Due to the limited queue size Cm
                      in front of processor m, the following constraint must be satisfied for the WIP:

                        
                           (3)
                           
                              
                                 0
                                 ≤
                                 
                                    W
                                    m
                                 
                                 
                                    (
                                    t
                                    )
                                 
                                 ≤
                                 
                                    C
                                    m
                                 
                                 +
                                 1
                                 .
                              
                           
                        
                     The WIP is limited by Cm
                      + 1 because Cm
                      pieces may be waiting in the queue and one can be currently processed.

The discrete model described in Section 2 can be modeled within a linear MIP (cf. Matta, 2008; Weiss and Stolletz, 2013). Transferred to our notation (regarding names of the variables and also indexing), the relevant constraints within the MIP formulation are

                        
                           (4)
                           
                              
                                 
                                    τ
                                    
                                       1
                                       ,
                                       n
                                    
                                 
                                 =
                                 0
                                 
                                 n
                                 ∈
                                 
                                    {
                                    1
                                    ,
                                    …
                                    
                                    ,
                                    N
                                    }
                                 
                                 ,
                              
                           
                        
                     
                     
                        
                           (5)
                           
                              
                                 
                                    τ
                                    
                                       m
                                       ,
                                       n
                                    
                                 
                                 ≥
                                 
                                    τ
                                    
                                       m
                                       ,
                                       n
                                       −
                                       1
                                    
                                 
                                 +
                                 
                                    T
                                    
                                       m
                                       −
                                       1
                                       ,
                                       n
                                    
                                 
                                 
                                 m
                                 ∈
                                 
                                    {
                                    2
                                    ,
                                    …
                                    
                                    ,
                                    K
                                    +
                                    1
                                    }
                                 
                                 ,
                                 
                                 n
                                 ∈
                                 
                                    {
                                    1
                                    ,
                                    …
                                    
                                    ,
                                    N
                                    }
                                 
                                 ,
                              
                           
                        
                     
                     
                        
                           (6)
                           
                              
                                 
                                    τ
                                    
                                       m
                                       ,
                                       n
                                    
                                 
                                 ≥
                                 
                                    τ
                                    
                                       m
                                       −
                                       1
                                       ,
                                       n
                                    
                                 
                                 +
                                 
                                    T
                                    
                                       m
                                       −
                                       1
                                       ,
                                       n
                                    
                                 
                                 
                                 m
                                 ∈
                                 
                                    {
                                    2
                                    ,
                                    …
                                    
                                    ,
                                    K
                                    +
                                    1
                                    }
                                 
                                 ,
                                 
                                 n
                                 ∈
                                 
                                    {
                                    1
                                    ,
                                    …
                                    
                                    ,
                                    N
                                    }
                                 
                                 ,
                              
                           
                        
                     
                     
                        
                           (7)
                           
                              
                                 
                                    
                                    
                                    
                                       
                                          
                                             τ
                                             
                                                m
                                                ,
                                                n
                                             
                                          
                                          ≥
                                          
                                             τ
                                             
                                                m
                                                +
                                                1
                                                ,
                                                n
                                                −
                                                (
                                                b
                                                +
                                                1
                                                )
                                             
                                          
                                          −
                                          M
                                          
                                             (
                                             1
                                             −
                                             
                                                y
                                                
                                                   m
                                                   ,
                                                   b
                                                
                                             
                                             )
                                          
                                          
                                          m
                                          ∈
                                          
                                             {
                                             2
                                             ,
                                             …
                                             
                                             ,
                                             K
                                             }
                                          
                                          ,
                                       
                                    
                                 
                                 
                                    
                                    
                                    
                                       
                                          n
                                          ∈
                                          {
                                          1
                                          ,
                                          …
                                          
                                          ,
                                          N
                                          }
                                          ,
                                          
                                          b
                                          ∈
                                          {
                                          0
                                          ,
                                          …
                                          
                                          ,
                                          B
                                          }
                                          ,
                                       
                                    
                                 
                              
                           
                        
                     
                     
                        
                           (8)
                           
                              
                                 
                                    y
                                    
                                       m
                                       ,
                                       b
                                    
                                 
                                 ∈
                                 
                                    {
                                    0
                                    ,
                                    1
                                    }
                                 
                                 ,
                                 
                                 
                                    ∑
                                    
                                       b
                                       =
                                       0
                                    
                                    B
                                 
                                 
                                    y
                                    
                                       m
                                       ,
                                       b
                                    
                                 
                                 =
                                 1
                                 ,
                                 
                                 
                                    C
                                    m
                                 
                                 =
                                 
                                    ∑
                                    
                                       b
                                       =
                                       0
                                    
                                    B
                                 
                                 b
                                 
                                 
                                    y
                                    
                                       m
                                       ,
                                       b
                                    
                                 
                                 
                                 m
                                 ∈
                                 
                                    {
                                    2
                                    ,
                                    …
                                    
                                    ,
                                    K
                                    }
                                 
                                 .
                              
                           
                        
                     
                     Eq. (4) states the initial conditions (all pieces are directly available at the first processor). The inequalities (5)–(7) refer to the three different cases in (1), where M is a sufficiently large Big-M term and B defines the maximum queue size. Note that for a given objective function (like maximization of the throughput under further constraints), at least one of these inequalities is typically fulfilled with equality in the optimal solution (for each pair of m and n), which means that the corresponding piece n is processed as fast as possible at the corresponding machine m. Finally, Eq. (8) defines the queue sizes Cm
                      based on the binary auxiliary variables y
                     
                        m, b
                     , which are necessary to formulate (7). In particular, for each machine m exactly one y
                     
                        m, b
                      equals 1 and implies Cm
                      = b.

A complete MIP formulation for the buffer allocation problem, here for minimizing the accumulated buffer size, would then read

                        
                           
                              
                                 
                                    
                                       min
                                    
                                    
                                       
                                          
                                             ∑
                                             
                                                m
                                                =
                                                2
                                             
                                             K
                                          
                                          
                                             C
                                             m
                                          
                                       
                                    
                                 
                                 
                                    
                                       s.t.
                                    
                                    
                                       
                                          (
                                          4
                                          )
                                          ,
                                          (
                                          5
                                          )
                                          ,
                                          (
                                          6
                                          )
                                          ,
                                          (
                                          7
                                          )
                                          ,
                                          (
                                          8
                                          )
                                          ,
                                          further
                                          
                                          constraints
                                       
                                    
                                 
                              
                           
                        
                     where further constraints could be to maintain a given minimum mean throughput as below (cf. (22)).

As one may imagine, the introduction of the binary auxiliary variables y
                     
                        m, b
                      to formulate the dependence on the queue size in (7) within an MIP framework constitutes the main part of the complexity of optimization tasks based on this model. One may expect rapidly increasing running times for increasing problem sizes (in particular when K increases) as observed in Weiss and Stolletz (2013). To avoid this effect, we consider a continuous model in the following section, which will allow for an easier dealing of the queue sizes and result in moderately increasing running times within a gradient-based optimization framework.

DES models as introduced in Section 2 have the advantage of being the most accurate models to describe the dynamics inside a system. However, as already noted in the last section, the computational costs within optimization frameworks may rapidly increase for such models. Therefore we intend to proceed with a different approach and use the DES model to rigorously derive a continuous model with real-valued fluxes and WIP, which approximate the DES model in a weak sense. Within this model the queue sizes Cm
                      may be chosen non-integer and the presented model will allow for gradient-based optimization techniques.

In the continuous model, we denote by fm
                     (t) the flux arriving at processor m at time t and by wm
                     (t) ∈ [0, Cm
                      + 1] the work in progress at processor m. According to (2) we have

                        
                           
                              
                                 
                                    d
                                    
                                       
                                       dt
                                    
                                 
                                 
                                    w
                                    m
                                 
                                 
                                    (
                                    t
                                    )
                                 
                                 =
                                 
                                    f
                                    m
                                 
                                 
                                    (
                                    t
                                    )
                                 
                                 −
                                 
                                    f
                                    
                                       m
                                       +
                                       1
                                    
                                 
                                 
                                    (
                                    t
                                    )
                                 
                                 .
                              
                           
                        
                     
                  

The main idea in the following is to approximate Fm
                     (t) by fm
                     (t) in an integral/weak sense. Thus, for consistency reasons, we claim

                        
                           
                              
                                 
                                    ∫
                                    
                                       
                                          τ
                                          
                                             m
                                             ,
                                             n
                                          
                                       
                                    
                                    
                                       τ
                                       
                                          m
                                          ,
                                          n
                                          +
                                          1
                                       
                                    
                                 
                                 
                                    f
                                    m
                                 
                                 
                                    (
                                    t
                                    )
                                 
                                 
                                 dt
                                 =
                                 1
                                 ,
                              
                           
                        
                     i.e. exactly one work piece is processed between the arrival times of two consecutive work pieces at the following processor. If there is no starving or blocking, and therefore τ
                     
                        m, n + 1 − τ
                     
                        m, n
                      = T
                     
                        m − 1, n + 1, a natural choice would be a uniform flux

                        
                           
                              
                                 
                                    f
                                    m
                                 
                                 
                                    (
                                    t
                                    )
                                 
                                 =
                                 
                                    1
                                    
                                       T
                                       
                                          m
                                          −
                                          1
                                          ,
                                          n
                                          +
                                          1
                                       
                                    
                                 
                              
                           
                        
                     for t ∈ (τ
                     
                        m, n
                     , τ
                     
                        m, n + 1). In the general case, we will use 1/T
                     
                        m − 1, n + 1 as the maximum possible processing rate of processor m − 1 at all times t ∈ (τ
                     
                        m, n
                     , τ
                     
                        m, n + 1). To stay consistent with the discrete model, in particular we want to somehow preserve the processing order of all pieces, we consider the following concept: For each processor m − 1, we introduce a virtual time 
                        
                           
                              
                                 t
                                 ˜
                              
                              
                                 m
                                 −
                                 1
                              
                           
                           =
                           
                              p
                              
                                 m
                                 −
                                 1
                              
                           
                           
                              (
                              t
                              )
                           
                           ,
                        
                      which measures how long processor m − 1 had to run at the currently maximum possible processing rate to achieve the past throughput until time t. In particular, we claim

                        
                           
                              
                                 
                                    p
                                    
                                       m
                                       −
                                       1
                                    
                                 
                                 
                                    (
                                    
                                       τ
                                       
                                          m
                                          ,
                                          n
                                       
                                    
                                    )
                                 
                                 =
                                 
                                    ∑
                                    
                                       k
                                       =
                                       1
                                    
                                    n
                                 
                                 
                                    T
                                    
                                       m
                                       −
                                       1
                                       ,
                                       k
                                    
                                 
                              
                           
                        
                     and

                        
                           
                              
                                 
                                    
                                       
                                          
                                             t
                                             ˜
                                          
                                          
                                             m
                                             −
                                             1
                                          
                                       
                                    
                                    
                                       =
                                    
                                    
                                       
                                          
                                             p
                                             
                                                m
                                                −
                                                1
                                             
                                          
                                          
                                             (
                                             t
                                             )
                                          
                                          ∈
                                          
                                             (
                                             
                                                ∑
                                                
                                                   k
                                                   =
                                                   1
                                                
                                                
                                                   n
                                                   −
                                                   1
                                                
                                             
                                             
                                                T
                                                
                                                   m
                                                   −
                                                   1
                                                   ,
                                                   k
                                                
                                             
                                             ,
                                             
                                                ∑
                                                
                                                   k
                                                   =
                                                   1
                                                
                                                n
                                             
                                             
                                                T
                                                
                                                   m
                                                   −
                                                   1
                                                   ,
                                                   k
                                                
                                             
                                             )
                                          
                                       
                                    
                                 
                                 
                                    
                                    
                                       ⇔
                                    
                                    
                                       
                                          t
                                          ∈
                                          (
                                          
                                             τ
                                             
                                                m
                                                ,
                                                n
                                                −
                                                1
                                             
                                          
                                          ,
                                          
                                             τ
                                             
                                                m
                                                ,
                                                n
                                             
                                          
                                          )
                                          .
                                       
                                    
                                 
                              
                           
                        
                     
                  

Depending on this virtual time, we define the (maximum) processing rates (see Fig. 3
                      for an example)

                        
                           (9)
                           
                              
                                 
                                    μ
                                    
                                       m
                                       −
                                       1
                                    
                                 
                                 
                                    (
                                    
                                       
                                          t
                                          ˜
                                       
                                       
                                          m
                                          −
                                          1
                                       
                                    
                                    )
                                 
                                 =
                                 
                                    1
                                    
                                       T
                                       
                                          m
                                          −
                                          1
                                          ,
                                          n
                                       
                                    
                                 
                                 
                                 ∀
                                 
                                    
                                       t
                                       ˜
                                    
                                    
                                       m
                                       −
                                       1
                                    
                                 
                                 ∈
                                 
                                    (
                                    
                                       ∑
                                       
                                          k
                                          =
                                          1
                                       
                                       
                                          n
                                          −
                                          1
                                       
                                    
                                    
                                       T
                                       
                                          m
                                          −
                                          1
                                          ,
                                          k
                                       
                                    
                                    ,
                                    
                                       ∑
                                       
                                          k
                                          =
                                          1
                                       
                                       n
                                    
                                    
                                       T
                                       
                                          m
                                          −
                                          1
                                          ,
                                          k
                                       
                                    
                                    )
                                 
                                 .
                              
                           
                        
                     
                  

Then, the definition of the virtual time 
                        
                           
                              t
                              ˜
                           
                           
                              m
                              −
                              1
                           
                        
                      yields/is given by

                        
                           (10)
                           
                              
                                 
                                    ∫
                                    
                                       
                                          p
                                          
                                             m
                                             −
                                             1
                                          
                                       
                                       
                                          (
                                          t
                                          )
                                       
                                    
                                    
                                       
                                          p
                                          
                                             m
                                             −
                                             1
                                          
                                       
                                       
                                          (
                                          t
                                          +
                                          Δ
                                          t
                                          )
                                       
                                    
                                 
                                 
                                    μ
                                    
                                       m
                                       −
                                       1
                                    
                                 
                                 
                                    (
                                    
                                       
                                          t
                                          ˜
                                       
                                       
                                          m
                                          −
                                          1
                                       
                                    
                                    )
                                 
                                 d
                                 
                                    
                                       t
                                       ˜
                                    
                                    
                                       m
                                       −
                                       1
                                    
                                 
                                 =
                                 
                                    ∫
                                    t
                                    
                                       t
                                       +
                                       Δ
                                       t
                                    
                                 
                                 
                                    f
                                    m
                                 
                                 
                                    (
                                    s
                                    )
                                 
                                 
                                 ds
                              
                           
                        
                     for arbitrary Δt.

Since we claimed fm
                     (t) ≤ μ
                     
                        m − 1(p
                     
                        m − 1(t)) above, one may show from (10) that

                        
                           
                              
                                 
                                    p
                                    
                                       m
                                       −
                                       1
                                    
                                 
                                 
                                    (
                                    t
                                    +
                                    Δ
                                    t
                                    )
                                 
                                 −
                                 
                                    p
                                    
                                       m
                                       −
                                       1
                                    
                                 
                                 
                                    (
                                    t
                                    )
                                 
                                 ≤
                                 
                                    (
                                    t
                                    +
                                    Δ
                                    t
                                    )
                                 
                                 −
                                 t
                                 =
                                 Δ
                                 t
                              
                           
                        
                     and we therewith get the following upper bound for the flux fm
                     (t):

                        
                           (11)
                           
                              
                                 
                                    
                                       
                                          
                                             ∫
                                             t
                                             
                                                t
                                                +
                                                Δ
                                                t
                                             
                                          
                                          
                                             f
                                             m
                                          
                                          
                                             (
                                             s
                                             )
                                          
                                          
                                          ds
                                       
                                    
                                    
                                       
                                          =
                                          
                                             (
                                             10
                                             )
                                          
                                       
                                    
                                    
                                       
                                          
                                             ∫
                                             
                                                
                                                   p
                                                   
                                                      m
                                                      −
                                                      1
                                                   
                                                
                                                
                                                   (
                                                   t
                                                   )
                                                
                                             
                                             
                                                
                                                   p
                                                   
                                                      m
                                                      −
                                                      1
                                                   
                                                
                                                
                                                   (
                                                   t
                                                   +
                                                   Δ
                                                   t
                                                   )
                                                
                                             
                                          
                                          
                                             μ
                                             
                                                m
                                                −
                                                1
                                             
                                          
                                          
                                             (
                                             
                                                
                                                   t
                                                   ˜
                                                
                                                
                                                   m
                                                   −
                                                   1
                                                
                                             
                                             )
                                          
                                          
                                          d
                                          
                                             
                                                t
                                                ˜
                                             
                                             
                                                m
                                                −
                                                1
                                             
                                          
                                       
                                    
                                 
                                 
                                    
                                    
                                       ≤
                                    
                                    
                                       
                                          
                                             ∫
                                             
                                                
                                                   p
                                                   
                                                      m
                                                      −
                                                      1
                                                   
                                                
                                                
                                                   (
                                                   t
                                                   )
                                                
                                             
                                             
                                                
                                                   p
                                                   
                                                      m
                                                      −
                                                      1
                                                   
                                                
                                                
                                                   (
                                                   t
                                                   )
                                                
                                                +
                                                Δ
                                                t
                                             
                                          
                                          
                                             μ
                                             
                                                m
                                                −
                                                1
                                             
                                          
                                          
                                             (
                                             
                                                
                                                   t
                                                   ˜
                                                
                                                
                                                   m
                                                   −
                                                   1
                                                
                                             
                                             )
                                          
                                          d
                                          
                                             
                                                t
                                                ˜
                                             
                                             
                                                m
                                                −
                                                1
                                             
                                          
                                          .
                                       
                                    
                                 
                              
                           
                        
                     
                  

For later use, we define

                        
                           (12)
                           
                              
                                 
                                    μ
                                    
                                       
                                          m
                                          −
                                          1
                                       
                                       ,
                                       max
                                    
                                 
                                 
                                    (
                                    t
                                    ,
                                    Δ
                                    t
                                    )
                                 
                                 =
                                 
                                    1
                                    
                                       Δ
                                       t
                                    
                                 
                                 
                                    ∫
                                    
                                       
                                          p
                                          
                                             m
                                             −
                                             1
                                          
                                       
                                       
                                          (
                                          t
                                          )
                                       
                                    
                                    
                                       
                                          p
                                          
                                             m
                                             −
                                             1
                                          
                                       
                                       
                                          (
                                          t
                                          )
                                       
                                       +
                                       Δ
                                       t
                                    
                                 
                                 
                                    μ
                                    
                                       m
                                       −
                                       1
                                    
                                 
                                 
                                    (
                                    
                                       
                                          t
                                          ˜
                                       
                                       
                                          m
                                          −
                                          1
                                       
                                    
                                    )
                                 
                                 d
                                 
                                    
                                       t
                                       ˜
                                    
                                    
                                       m
                                       −
                                       1
                                    
                                 
                                 .
                              
                           
                        
                     
                  

Next, we consider the influence of constraint (3) on our model. The upper bound in (3) at time t + Δt yields

                        
                           
                              
                                 
                                    
                                       
                                          
                                             W
                                             m
                                          
                                          
                                             (
                                             t
                                             +
                                             Δ
                                             t
                                             )
                                          
                                       
                                    
                                    
                                       =
                                    
                                    
                                       
                                          
                                             W
                                             m
                                          
                                          
                                             (
                                             t
                                             )
                                          
                                          +
                                          
                                             ∫
                                             
                                                t
                                             
                                             
                                                t
                                                +
                                                Δ
                                                t
                                             
                                          
                                          
                                             d
                                             
                                                
                                                ds
                                             
                                          
                                          
                                             W
                                             m
                                          
                                          
                                             (
                                             s
                                             )
                                          
                                          
                                          ds
                                       
                                    
                                 
                                 
                                    
                                    
                                       =
                                    
                                    
                                       
                                          
                                             W
                                             m
                                          
                                          
                                             (
                                             t
                                             )
                                          
                                          +
                                          
                                             ∫
                                             
                                                t
                                             
                                             
                                                t
                                                +
                                                Δ
                                                t
                                             
                                          
                                          
                                             (
                                             
                                                F
                                                m
                                             
                                             
                                                (
                                                s
                                                )
                                             
                                             −
                                             
                                                F
                                                
                                                   m
                                                   +
                                                   1
                                                
                                             
                                             
                                                (
                                                s
                                                )
                                             
                                             )
                                          
                                          
                                          ds
                                          ≤
                                          
                                             C
                                             m
                                          
                                          +
                                          1
                                          .
                                       
                                    
                                 
                              
                           
                        
                     Dividing by Δt and rearranging terms gives

                        
                           (13)
                           
                              
                                 
                                    1
                                    
                                       Δ
                                       t
                                    
                                 
                                 
                                    ∫
                                    
                                       t
                                    
                                    
                                       t
                                       +
                                       Δ
                                       t
                                    
                                 
                                 
                                    F
                                    m
                                 
                                 
                                    (
                                    s
                                    )
                                 
                                 
                                 ds
                                 ≤
                                 
                                    
                                       
                                          C
                                          m
                                       
                                       +
                                       1
                                       −
                                       
                                          W
                                          m
                                       
                                       
                                          (
                                          t
                                          )
                                       
                                    
                                    
                                       Δ
                                       t
                                    
                                 
                                 +
                                 
                                    1
                                    
                                       Δ
                                       t
                                    
                                 
                                 
                                    ∫
                                    
                                       t
                                    
                                    
                                       t
                                       +
                                       Δ
                                       t
                                    
                                 
                                 
                                    F
                                    
                                       m
                                       +
                                       1
                                    
                                 
                                 
                                    (
                                    s
                                    )
                                 
                                 
                                 ds
                                 .
                              
                           
                        
                     
                  

Analogously, we consider the lower bound in (3) at time t + Δt for m − 1:

                        
                           
                              
                                 
                                    
                                       
                                          0
                                          ≤
                                          
                                             W
                                             
                                                m
                                                −
                                                1
                                             
                                          
                                          
                                             (
                                             t
                                             +
                                             Δ
                                             t
                                             )
                                          
                                       
                                    
                                    
                                       =
                                    
                                    
                                       
                                          
                                             W
                                             
                                                m
                                                −
                                                1
                                             
                                          
                                          
                                             (
                                             t
                                             )
                                          
                                          +
                                          
                                             ∫
                                             
                                                t
                                             
                                             
                                                t
                                                +
                                                Δ
                                                t
                                             
                                          
                                          
                                             d
                                             
                                                
                                                ds
                                             
                                          
                                          
                                             W
                                             
                                                m
                                                −
                                                1
                                             
                                          
                                          
                                             (
                                             s
                                             )
                                          
                                          
                                          ds
                                       
                                    
                                 
                                 
                                    
                                    
                                       =
                                    
                                    
                                       
                                          
                                             W
                                             
                                                m
                                                −
                                                1
                                             
                                          
                                          
                                             (
                                             t
                                             )
                                          
                                          +
                                          
                                             ∫
                                             
                                                t
                                             
                                             
                                                t
                                                +
                                                Δ
                                                t
                                             
                                          
                                          
                                             (
                                             
                                                F
                                                
                                                   m
                                                   −
                                                   1
                                                
                                             
                                             
                                                (
                                                s
                                                )
                                             
                                             −
                                             
                                                F
                                                m
                                             
                                             
                                                (
                                                s
                                                )
                                             
                                             )
                                          
                                          
                                          ds
                                          .
                                       
                                    
                                 
                              
                           
                        
                     Dividing by Δt and rearranging terms yields

                        
                           (14)
                           
                              
                                 
                                    1
                                    
                                       Δ
                                       t
                                    
                                 
                                 
                                    ∫
                                    
                                       t
                                    
                                    
                                       t
                                       +
                                       Δ
                                       t
                                    
                                 
                                 
                                    F
                                    m
                                 
                                 
                                    (
                                    s
                                    )
                                 
                                 
                                 ds
                                 ≤
                                 
                                    
                                       
                                          W
                                          
                                             m
                                             −
                                             1
                                          
                                       
                                       
                                          (
                                          t
                                          )
                                       
                                    
                                    
                                       Δ
                                       t
                                    
                                 
                                 +
                                 
                                    1
                                    
                                       Δ
                                       t
                                    
                                 
                                 
                                    ∫
                                    
                                       t
                                    
                                    
                                       t
                                       +
                                       Δ
                                       t
                                    
                                 
                                 
                                    F
                                    
                                       m
                                       −
                                       1
                                    
                                 
                                 
                                    (
                                    s
                                    )
                                 
                                 
                                 ds
                                 .
                              
                           
                        
                     Replacing the variables F, W of the discrete model by f, w and defining

                        
                           
                              
                                 
                                    γ
                                    m
                                 
                                 
                                    (
                                    t
                                    ,
                                    Δ
                                    t
                                    )
                                 
                                 =
                                 
                                    1
                                    
                                       Δ
                                       t
                                    
                                 
                                 
                                    ∫
                                    
                                       t
                                    
                                    
                                       t
                                       +
                                       Δ
                                       t
                                    
                                 
                                 
                                    f
                                    m
                                 
                                 
                                    (
                                    s
                                    )
                                 
                                 
                                 ds
                                 ,
                              
                           
                        
                     inequalities (13) and (14) read

                        
                           
                              
                                 
                                    
                                    
                                    
                                       
                                          
                                             γ
                                             m
                                          
                                          
                                             (
                                             t
                                             ,
                                             Δ
                                             t
                                             )
                                          
                                          ≤
                                          min
                                          
                                             {
                                             
                                                
                                                   
                                                      w
                                                      
                                                         m
                                                         −
                                                         1
                                                      
                                                   
                                                   
                                                      (
                                                      t
                                                      )
                                                   
                                                
                                                
                                                   Δ
                                                   t
                                                
                                             
                                             +
                                             
                                                γ
                                                
                                                   m
                                                   −
                                                   1
                                                
                                             
                                             
                                                (
                                                t
                                                ,
                                                Δ
                                                t
                                                )
                                             
                                             ,
                                          
                                       
                                    
                                 
                                 
                                    
                                    
                                    
                                       
                                          
                                          
                                          
                                          
                                          
                                             
                                                
                                                   
                                                      C
                                                      m
                                                   
                                                   +
                                                   1
                                                   −
                                                   
                                                      w
                                                      m
                                                   
                                                   
                                                      (
                                                      t
                                                      )
                                                   
                                                
                                                
                                                   Δ
                                                   t
                                                
                                             
                                             +
                                             
                                                γ
                                                
                                                   m
                                                   +
                                                   1
                                                
                                             
                                             
                                                (
                                                t
                                                ,
                                                Δ
                                                t
                                                )
                                             
                                             }
                                          
                                          .
                                       
                                    
                                 
                              
                           
                        
                     
                  

Considering the maximum processing rate μ
                     
                        m − 1, max (t, Δt) at the preceding processor, we finally have (with (11))

                        
                           (15)
                           
                              
                                 
                                    
                                       
                                          
                                             γ
                                             m
                                          
                                          
                                             (
                                             t
                                             ,
                                             Δ
                                             t
                                             )
                                          
                                       
                                    
                                    
                                       =
                                    
                                    
                                       
                                          min
                                          
                                             {
                                             
                                                μ
                                                
                                                   m
                                                   −
                                                   1
                                                   ,
                                                   max
                                                
                                             
                                             
                                                (
                                                t
                                                ,
                                                Δ
                                                t
                                                )
                                             
                                             ,
                                             
                                                
                                                   
                                                      w
                                                      
                                                         m
                                                         −
                                                         1
                                                      
                                                   
                                                   
                                                      (
                                                      t
                                                      )
                                                   
                                                
                                                
                                                   Δ
                                                   t
                                                
                                             
                                             +
                                             
                                                γ
                                                
                                                   m
                                                   −
                                                   1
                                                
                                             
                                             
                                                (
                                                t
                                                ,
                                                Δ
                                                t
                                                )
                                             
                                             ,
                                          
                                       
                                    
                                 
                                 
                                    
                                    
                                    
                                       
                                          
                                          
                                          
                                          
                                             
                                             
                                                
                                                   
                                                      C
                                                      m
                                                   
                                                   +
                                                   1
                                                   −
                                                   
                                                      w
                                                      m
                                                   
                                                   
                                                      (
                                                      t
                                                      )
                                                   
                                                
                                                
                                                   Δ
                                                   t
                                                
                                             
                                             +
                                             
                                                γ
                                                
                                                   m
                                                   +
                                                   1
                                                
                                             
                                             
                                                (
                                                t
                                                ,
                                                Δ
                                                t
                                                )
                                             
                                             }
                                          
                                       
                                    
                                 
                              
                           
                        
                     when assuming that all pieces are processed as fast as possible (and the presented constraints are fulfilled).

Accordingly, we get the following update formula for the continuous WIP:

                        
                           (16)
                           
                              
                                 
                                    
                                       
                                          
                                             w
                                             m
                                          
                                          
                                             (
                                             t
                                             +
                                             Δ
                                             t
                                             )
                                          
                                       
                                    
                                    
                                       =
                                    
                                    
                                       
                                          
                                             w
                                             m
                                          
                                          
                                             (
                                             t
                                             )
                                          
                                          +
                                          
                                             ∫
                                             
                                                t
                                             
                                             
                                                t
                                                +
                                                Δ
                                                t
                                             
                                          
                                          
                                             d
                                             
                                                
                                                ds
                                             
                                          
                                          
                                             w
                                             m
                                          
                                          
                                             (
                                             s
                                             )
                                          
                                          
                                          ds
                                       
                                    
                                 
                                 
                                    
                                    
                                       =
                                    
                                    
                                       
                                          
                                             w
                                             m
                                          
                                          
                                             (
                                             t
                                             )
                                          
                                          +
                                          
                                             ∫
                                             
                                                t
                                             
                                             
                                                t
                                                +
                                                Δ
                                                t
                                             
                                          
                                          
                                             (
                                             
                                                f
                                                m
                                             
                                             
                                                (
                                                s
                                                )
                                             
                                             −
                                             
                                                f
                                                
                                                   m
                                                   +
                                                   1
                                                
                                             
                                             
                                                (
                                                s
                                                )
                                             
                                             )
                                          
                                          
                                          ds
                                       
                                    
                                 
                                 
                                    
                                    
                                       =
                                    
                                    
                                       
                                          
                                             w
                                             m
                                          
                                          
                                             (
                                             t
                                             )
                                          
                                          +
                                          Δ
                                          t
                                          
                                             (
                                             
                                                γ
                                                m
                                             
                                             
                                                (
                                                t
                                                ,
                                                Δ
                                                t
                                                )
                                             
                                             −
                                             
                                                γ
                                                
                                                   m
                                                   +
                                                   1
                                                
                                             
                                             
                                                (
                                                t
                                                ,
                                                Δ
                                                t
                                                )
                                             
                                             )
                                          
                                          .
                                       
                                    
                                 
                              
                           
                        
                     
                     
                        Remark 1
                        For comparison of the discrete model (1) with the time-continuous one (15), we rearrange the first term in (1):

                              
                                 (17)
                                 
                                    
                                       
                                          τ
                                          
                                             m
                                             ,
                                             n
                                          
                                       
                                       =
                                       max
                                       
                                          {
                                          
                                             τ
                                             
                                                m
                                                ,
                                                n
                                                −
                                                1
                                             
                                          
                                          +
                                          
                                             T
                                             
                                                m
                                                −
                                                1
                                                ,
                                                n
                                             
                                          
                                          ,
                                          
                                          
                                             τ
                                             
                                                m
                                                −
                                                1
                                                ,
                                                n
                                             
                                          
                                          +
                                          
                                             T
                                             
                                                m
                                                −
                                                1
                                                ,
                                                n
                                             
                                          
                                          ,
                                          
                                          
                                             τ
                                             
                                                m
                                                +
                                                1
                                                ,
                                                n
                                                −
                                                (
                                                
                                                   C
                                                   m
                                                
                                                +
                                                1
                                                )
                                             
                                          
                                          }
                                       
                                       .
                                    
                                 
                              
                           In (15) and in (17), the first term corresponds to the case where there is no starving or blocking: Processor m − 1 works with the currently maximum processing rate in the continuous model, and piece n is directly processed after piece n − 1 and delivered to the next processor in the discrete model. Due to the second term in (15) and in (17), starving may occur, and the third term is responsible for blocking.

In this section, we describe the later applied numerical schemes for simulation and optimization purposes based on the continuous model presented in Section 4. Especially for optimization purposes we will not directly use (15) for the computation of the flux values γm
                     , because this leads to an implicit system of equations. Instead of that, we will leave out the γ terms within the minima on the right-hand side. This way, we end up with a computationally inexpensive explicit scheme approximating the solution of (15). Having in mind the discrete model, this modification has another motivation: Due to the γ terms on the right-hand side of (15), flux through a processor may be instantaneously processed by subsequent processors, while in the discrete model, each piece is sequentially processed at all processors, with a minimum delay of the single processing times. By omitting the γ terms in the numerical scheme, we artificially add some kind of delay in the processing, namely the applied step size Δt. Later in the numerical results (in Section 6.1), we will also compare the solutions of the continuous model with and without the γ terms on the right-hand side of (15) and refer to them as continuous model with/without instantaneous processing.

We seek for an (approximate) solution to the continuous model described in Section 4, that is, we are interested in the state of the queuing network at certain points in time for a given initial state and processing times T
                        
                           m, n
                        . Within the continuous model, the state at some time t is described by the current work in progress wm
                        (t) (for m ∈ {2, … , K}) and the virtual times 
                           
                              
                                 
                                    t
                                    ˜
                                 
                                 m
                              
                              =
                              
                                 p
                                 m
                              
                              
                                 (
                                 t
                                 )
                              
                           
                         (for m ∈ {1, … , K}). We consider the discrete times tk
                         = kΔt and accordingly the states

                           
                              
                                 
                                    
                                       w
                                       m
                                       k
                                    
                                    ≈
                                    
                                       w
                                       m
                                    
                                    
                                       (
                                       
                                          t
                                          k
                                       
                                       )
                                    
                                    ,
                                    
                                    
                                       
                                          t
                                          ˜
                                       
                                       m
                                       k
                                    
                                    ≈
                                    
                                       p
                                       m
                                    
                                    
                                       (
                                       
                                          t
                                          k
                                       
                                       )
                                    
                                    ,
                                 
                              
                           
                        where we assume the initial conditions 
                           
                              w
                              m
                              0
                           
                         and 
                           
                              
                                 t
                                 ˜
                              
                              m
                              0
                           
                         to be given. Starting from this initial state, the aim of the numerical scheme is to (iteratively) compute the following states 
                           
                              w
                              m
                              k
                           
                         and 
                           
                              
                                 t
                                 ˜
                              
                              m
                              k
                           
                         for all k ∈ {1, … , Nt}. The basic steps of this procedure are given in Algorithm 1
                        .

In each iteration of the main loop of Algorithm 1, we first compute the average flux values 
                           
                              γ
                              m
                              
                                 k
                                 −
                                 0.5
                              
                           
                         for the currently next interval [t
                        
                           k − 1, tk
                        ]. Based on these flux values and the old states 
                           
                              
                                 w
                                 m
                                 
                                    k
                                    −
                                    1
                                 
                              
                              ,
                           
                        
                        
                           
                              
                                 t
                                 ˜
                              
                              m
                              
                                 k
                                 −
                                 1
                              
                           
                         at time t
                        
                           k − 1, the new states 
                           
                              w
                              m
                              k
                           
                         and 
                           
                              
                                 t
                                 ˜
                              
                              m
                              k
                           
                         at time tk
                         are computed in the second step. In principal, depending on the applied discretization of the model equations presented in Section 4, both steps may involve the solution of a system of nonlinear equations, which we typically solve via Newton’s method within our software. Here, one might also directly use (15) for a fixed point iteration, which has also been done for the numerical results in Section 6.1. But as we will see below, a purely explicit scheme approximating the solution of (15) is possible. In the following, we explain the details of both steps in the main loop of Algorithm 1.


                        Computation of the average flux values: For given processing times T
                        
                           m, n
                        , we directly have 
                           
                              
                                 μ
                                 m
                              
                              
                                 (
                                 
                                    
                                       t
                                       ˜
                                    
                                    m
                                 
                                 )
                              
                           
                         via (9). Thus, we may compute the maximum (average) flux within the interval [t
                        
                           k − 1, tk
                        ] according to (12),

                           
                              (18)
                              
                                 
                                    
                                       μ
                                       
                                          m
                                          ,
                                          max
                                       
                                       
                                          k
                                          −
                                          0.5
                                       
                                    
                                    =
                                    
                                       1
                                       
                                          Δ
                                          t
                                       
                                    
                                    
                                       ∫
                                       
                                          
                                             
                                                t
                                                ˜
                                             
                                             m
                                             
                                                k
                                                −
                                                1
                                             
                                          
                                       
                                       
                                          
                                             
                                                t
                                                ˜
                                             
                                             m
                                             
                                                k
                                                −
                                                1
                                             
                                          
                                          +
                                          Δ
                                          t
                                       
                                    
                                    
                                       μ
                                       m
                                    
                                    
                                       (
                                       s
                                       )
                                    
                                    
                                    ds
                                    
                                    ∀
                                    m
                                    ∈
                                    
                                       {
                                       1
                                       ,
                                       …
                                       ,
                                       K
                                       }
                                    
                                    ,
                                 
                              
                           
                        where Δt = tk
                         − t
                        
                           k − 1. Since 
                           
                              
                                 t
                                 ˜
                              
                              m
                              
                                 k
                                 −
                                 1
                              
                           
                         is known (from the initial conditions or the previous iteration) and the functions μm
                         given by (9) are piecewise constant, these integrals can be exactly evaluated.

Next, we compute the desired average flux values

                           
                              (19)
                              
                                 
                                    
                                       
                                          
                                             γ
                                             2
                                             
                                                k
                                                −
                                                0.5
                                             
                                          
                                       
                                       
                                          =
                                       
                                       
                                          
                                             min
                                             
                                                {
                                                
                                                   μ
                                                   
                                                      1
                                                      ,
                                                      max
                                                   
                                                   
                                                      k
                                                      −
                                                      0.5
                                                   
                                                
                                                ,
                                                
                                                
                                                   
                                                      
                                                         C
                                                         2
                                                      
                                                      +
                                                      1
                                                      −
                                                      
                                                         w
                                                         2
                                                         
                                                            k
                                                            −
                                                            1
                                                         
                                                      
                                                   
                                                   
                                                      Δ
                                                      t
                                                   
                                                
                                                }
                                             
                                             ,
                                          
                                       
                                    
                                    
                                       
                                          
                                             γ
                                             m
                                             
                                                k
                                                −
                                                0.5
                                             
                                          
                                       
                                       
                                          =
                                       
                                       
                                          
                                             min
                                             
                                                {
                                                
                                                   μ
                                                   
                                                      m
                                                      −
                                                      1
                                                      ,
                                                      max
                                                   
                                                   
                                                      k
                                                      −
                                                      0.5
                                                   
                                                
                                                ,
                                                
                                                
                                                   
                                                      w
                                                      
                                                         m
                                                         −
                                                         1
                                                      
                                                      
                                                         k
                                                         −
                                                         1
                                                      
                                                   
                                                   
                                                      Δ
                                                      t
                                                   
                                                
                                                ,
                                                
                                                
                                                   
                                                      
                                                         C
                                                         m
                                                      
                                                      +
                                                      1
                                                      −
                                                      
                                                         w
                                                         m
                                                         
                                                            k
                                                            −
                                                            1
                                                         
                                                      
                                                   
                                                   
                                                      Δ
                                                      t
                                                   
                                                
                                                }
                                             
                                          
                                       
                                    
                                    
                                       
                                       
                                       
                                          
                                             
                                             
                                             
                                             
                                             
                                             
                                             
                                             
                                             
                                             ∀
                                             m
                                             ∈
                                             {
                                             3
                                             ,
                                             ⋯
                                             ,
                                             K
                                             }
                                             ,
                                          
                                       
                                    
                                    
                                       
                                          
                                             γ
                                             
                                                K
                                                +
                                                1
                                             
                                             
                                                k
                                                −
                                                0.5
                                             
                                          
                                       
                                       
                                          =
                                       
                                       
                                          
                                             min
                                             
                                                {
                                                
                                                   μ
                                                   
                                                      K
                                                      ,
                                                      max
                                                   
                                                   
                                                      k
                                                      −
                                                      0.5
                                                   
                                                
                                                ,
                                                
                                                
                                                   
                                                      w
                                                      
                                                         K
                                                      
                                                      
                                                         k
                                                         −
                                                         1
                                                      
                                                   
                                                   
                                                      Δ
                                                      t
                                                   
                                                
                                                }
                                             
                                             .
                                          
                                       
                                    
                                 
                              
                           
                        Here, we assumed that there is no starving at the first processor (τ
                        1, n
                         = 0 and C
                        1 = ∞) and C
                        
                           K + 1 = ∞. Comparing with (15) and as already noted above, we skipped the γ terms within the minima on the right-hand side. The main reason for this modification is that we end up with a computationally inexpensive explicit scheme this way, which approximates the solution of (15). Moreover, we avoid singular Jacobian matrices, which may occur when solving (a smoothed version of) the original formulation with Newton’s method. A comparison of using the continuous model with or without the γ terms on the right-hand side of (15), corresponding to instantaneous processing, is done in the numerical results in Section 6.1.


                        Computation of the new states: Having computed the average flux values within the time interval [t
                        
                           k − 1, tk
                        ], the change of the work in progress reads (according to (16))

                           
                              (20)
                              
                                 
                                    
                                       w
                                       m
                                       k
                                    
                                    =
                                    
                                       w
                                       m
                                       
                                          k
                                          −
                                          1
                                       
                                    
                                    +
                                    Δ
                                    t
                                    
                                    
                                       (
                                       
                                          γ
                                          m
                                          
                                             k
                                             −
                                             0.5
                                          
                                       
                                       −
                                       
                                          γ
                                          
                                             m
                                             +
                                             1
                                          
                                          
                                             k
                                             −
                                             0.5
                                          
                                       
                                       )
                                    
                                    
                                    ∀
                                    m
                                    ∈
                                    
                                       {
                                       2
                                       ,
                                       …
                                       
                                       ,
                                       K
                                       }
                                    
                                    .
                                 
                              
                           
                        
                     

Additionally, we have to compute the new virtual times 
                           
                              
                                 t
                                 ˜
                              
                              m
                              k
                           
                        . From (10) we get

                           
                              (21)
                              
                                 
                                    
                                       ∫
                                       
                                          
                                             
                                                t
                                                ˜
                                             
                                             
                                                m
                                                −
                                                1
                                             
                                             
                                                k
                                                −
                                                1
                                             
                                          
                                       
                                       
                                          
                                             t
                                             ˜
                                          
                                          
                                             m
                                             −
                                             1
                                          
                                          k
                                       
                                    
                                    
                                       μ
                                       
                                          m
                                          −
                                          1
                                       
                                    
                                    
                                       (
                                       s
                                       )
                                    
                                    
                                    
                                    ds
                                    =
                                    Δ
                                    t
                                    
                                    
                                       γ
                                       m
                                       
                                          k
                                          −
                                          0.5
                                       
                                    
                                    .
                                 
                              
                           
                        Again, since the functions μ
                        
                           m − 1 are piecewise constant, Eq. (21) can be exactly solved for 
                           
                              
                                 t
                                 ˜
                              
                              
                                 m
                                 −
                                 1
                              
                              k
                           
                         (for m ∈ {2, … , K + 1}). This completes the description of the applied numerical scheme to solve simulation tasks based on the continuous model.

As already announced in the Introduction, we will now formulate the buffer allocation problem based on the presented continuous model (in Section 5.2.1). Since we want to apply gradient-based optimization techniques to solve the resulting problem, Appendix A is concerned with the (efficient) computation of the necessary gradient information by an adjoint approach.

The optimization task we are interested in is the minimization of the buffer sizes,

                              
                                 
                                    
                                       min
                                       
                                          ∑
                                          
                                             m
                                             =
                                             2
                                          
                                          K
                                       
                                       
                                          C
                                          m
                                       
                                       ,
                                    
                                 
                              
                           while maintaining a given minimum mean throughput 
                              
                                 F
                                 ˜
                              
                            of the queuing network. In the discrete model, or accordingly in the MIP approach of Section 3, this constraint reads

                              
                                 (22)
                                 
                                    
                                       
                                          
                                             N
                                             −
                                             
                                                N
                                                0
                                             
                                          
                                          
                                             
                                                τ
                                                
                                                   K
                                                   +
                                                   1
                                                   ,
                                                   N
                                                
                                             
                                             −
                                             
                                                τ
                                                
                                                   K
                                                   +
                                                   1
                                                   ,
                                                   
                                                      N
                                                      0
                                                   
                                                
                                             
                                          
                                       
                                       ≥
                                       
                                          F
                                          ˜
                                       
                                    
                                 
                              
                           with N
                           0 > 0 pieces as warm-up phase for the entire system. To check (22) for a choice of 
                              
                                 
                                    C
                                    m
                                 
                                 ∈
                                 N
                                 ,
                              
                            we simply have to evaluate the arrival times τ
                           
                              m, n
                            according to (1).

In the continuous model, we may choose 
                              
                                 
                                    C
                                    m
                                 
                                 ∈
                                 
                                    R
                                    
                                       ≥
                                       0
                                    
                                 
                              
                            and evaluate the discretized model equations introduced in Section 5.1. Here, we claim as constraint for the mean throughput

                              
                                 (23)
                                 
                                    
                                       
                                          1
                                          
                                             
                                                t
                                                Nt
                                             
                                             −
                                             
                                                t
                                                w
                                             
                                          
                                       
                                       
                                          ∫
                                          
                                             
                                                t
                                                w
                                             
                                          
                                          
                                             t
                                             Nt
                                          
                                       
                                       
                                          f
                                          
                                             K
                                             +
                                             1
                                          
                                       
                                       
                                          (
                                          t
                                          )
                                       
                                       
                                       dt
                                       ≥
                                       
                                          F
                                          ˜
                                       
                                    
                                 
                              
                           with tw
                            > t
                           0 as a warm-up time. To evaluate (23), f
                           
                              K + 1(t) is approximated by 
                              
                                 γ
                                 
                                    K
                                    +
                                    1
                                 
                                 
                                    k
                                    −
                                    0.5
                                 
                              
                            for t ∈ (t
                           
                              k − 1, tk
                           ).

The entire optimization task for the continuous model reads

                              
                                 (24)
                                 
                                    
                                       
                                          
                                             min
                                          
                                          
                                             
                                                
                                                   ∑
                                                   
                                                      m
                                                      =
                                                      2
                                                   
                                                   K
                                                
                                                
                                                   C
                                                   m
                                                
                                             
                                          
                                       
                                       
                                          
                                             s.t.
                                          
                                          
                                             
                                                
                                                   C
                                                   m
                                                
                                                ∈
                                                
                                                   R
                                                   
                                                      ≥
                                                      0
                                                   
                                                
                                             
                                          
                                       
                                       
                                          
                                          
                                             
                                                model
                                                
                                                equations:
                                                (
                                                18
                                                )
                                                ,
                                                (
                                                19
                                                )
                                                ,
                                                (
                                                20
                                                )
                                                ,
                                                (
                                                21
                                                )
                                             
                                          
                                       
                                       
                                          
                                          
                                             
                                                mean
                                                
                                                throughput:
                                                (
                                                23
                                                )
                                             
                                          
                                       
                                    
                                 
                              
                           and we would like to apply gradient-based optimization techniques for the solution of (24). For this, some terms in the discretized model equations (18)–(21) have to be smoothened (in particular the minimum functions in (19)). Then, a quite efficient way to compute the necessary gradient information for the solution of (24) is to apply an adjoint approach, which will be in Appendix A.

@&#RESULTS@&#

To demonstrate the usability and benefits of the introduced continuous model, we consider several simulation and optimization scenarios and evaluate the results of the continuous model(s) in comparison with the discrete/MIP model. In the first example (Section 6.1), we use fixed deterministic processing times to give a first impression of the differences between the presented models. Here, we will compare the discrete model with the continuous model with and without instantaneous processing, i.e. with/without considering the γ terms on the right-hand side of the flux defining Eq. (15). Without the γ terms, the resulting scheme exactly corresponds to the (explicit) scheme described in Section 5.1, which will also be used in the further numerical results. The examples in Sections 6.2 and 6.3 with random processing times are adapted from Stolletz and Weiss (2013) and Weiss and Stolletz (2013). For each scenario we will consider several samples of processing times T
                     
                        m, n
                     , but the same samples are used for all models.

As initial conditions for the queuing networks in all considered scenarios, we assume that the queues are empty,

                        
                           
                              
                                 
                                    w
                                    m
                                    0
                                 
                                 =
                                 0
                                 
                                 ∀
                                 m
                                 ∈
                                 
                                    {
                                    2
                                    ,
                                    …
                                    ,
                                    K
                                    }
                                 
                                 ,
                              
                           
                        
                     and the processors have not worked so far (virtual time equals zero),

                        
                           
                              
                                 
                                    
                                       t
                                       ˜
                                    
                                    m
                                    0
                                 
                                 =
                                 0
                                 
                                 ∀
                                 m
                                 ∈
                                 
                                    {
                                    1
                                    ,
                                    …
                                    ,
                                    K
                                    }
                                 
                                 .
                              
                           
                        
                     
                  

We consider a production line consisting of K = 4 processors with fixed processing rates

                           
                              
                                 
                                    
                                       μ
                                       1
                                    
                                    =
                                    7
                                    ,
                                    
                                    
                                       μ
                                       2
                                    
                                    =
                                    7
                                    ,
                                    
                                    
                                       μ
                                       3
                                    
                                    =
                                    6
                                    ,
                                    
                                    
                                       μ
                                       4
                                    
                                    =
                                    7
                                    ,
                                 
                              
                           
                        and therefore deterministic processing times

                           
                              
                                 
                                    
                                       T
                                       
                                          m
                                          ,
                                          n
                                       
                                    
                                    =
                                    
                                       1
                                       
                                          μ
                                          m
                                       
                                    
                                    .
                                 
                              
                           
                        For the buffer sizes we apply Cm
                         = 5. As final time we use tNt
                         = 15 and we choose Nt ∈ {15μ
                        3, 30μ
                        3, 150μ
                        3} for the continuous model with and without instantaneous processing.

The results of this deterministic simulation scenario are plotted in Fig. 4
                        . Note that we plotted the discontinuous WIP and output corresponding to the discrete model by sampling with an adequate time grid, and the WIP and output corresponding to the continuous model with instantaneous processing (dashed lines) do not differ for the applied choices of Nt. Obviously, Δt plays a minor role for this model. Further, one may observe that the solution of the continuous model without instantaneous processing converges toward the solution of the continuous model with instantaneous processing for Δt → 0. Nevertheless, due to the “delay” Δt in the continuous model without instantaneous processing, the corresponding solutions are often closer to the solution of the discrete model. Regarding the output of the production line, there basically is a shift between the solutions of the discrete and the continuous model, depending on Δt determining the lead (or deficit for larger Δt). As a consequence, the difference in the mean throughput of the considered models will vanish for large time horizons.

As we mentioned at the beginning of Section 2, the processing times T
                        
                           m, n
                         are supposed to follow a processor dependent random distribution. Here, we apply the exponential distribution,

                           
                              
                                 
                                    
                                       T
                                       
                                          m
                                          ,
                                          n
                                       
                                    
                                    ∼
                                    Exp
                                    
                                       (
                                       1
                                       /
                                       
                                          μ
                                          m
                                       
                                       )
                                    
                                 
                              
                           
                        with mean processing rate μm
                         of processor m. Note that generalized exponential distributions might be also possible, see Dallery (1994). For the presented numerical results, we consider the mean processing rates μm
                         = 7.0 for m ∈ {1, … , K − 1} and μK
                         = 6.0 (bottleneck at the last station). The quantity we are mainly interested in is the mean throughput, where the goal mean throughput in this and also the following section is 
                           
                              
                                 F
                                 ˜
                              
                              =
                              5.776
                           
                        . For the computation of the mean throughput in the discrete model we use (22) with N
                        0 = 2000 pieces for the warm-up phase as in Weiss and Stolletz (2013). For the continuous model we apply (23) with warm-up time

                           
                              
                                 
                                    
                                       t
                                       w
                                    
                                    =
                                    333.34
                                    ≈
                                    
                                       
                                          N
                                          0
                                       
                                       
                                          μ
                                          K
                                       
                                    
                                    .
                                 
                              
                           
                        
                     

For a first comparison of the discrete and the continuous model with random processing times, we consider a production line with K = 3 processors and try out several configurations of buffer sizes with respect to the resulting mean throughput. For each configuration, we evaluate 10 instances (different samplings of the processing times T
                        
                           m, n
                        ) with N = 104 pieces and another 10 instances each with N = 105 and N = 106. As final time for the evaluation of the continuous model, we use tNt
                         = 0.14N. For the temporal discretization, we apply 
                           
                              Δ
                              t
                              =
                              
                                 
                                    t
                                    Nt
                                 
                                 N
                              
                              =
                              0.14
                           
                         and also Δt = 0.07 for all examples.

An overview over the simulation results is given in Fig. 5
                         and also Table 1
                         (for Δt = 0.14). In Fig. 5, for each N and Δt and all applied configurations, the minimum, average and maximum mean throughput over all instances are plotted for the discrete and the continuous model as well as the total number of buffers. First of all, one may observe that the overall spread becomes smaller for larger N for both models. Further, what cannot be seen directly in Fig. 5 but from Table 1 is that the difference between the two models with respect to the mean throughput significantly decreases from N = 104 to N = 106. Comparing the two different discretizations Δt = 0.14 and Δt = 0.07 for the continuous model, one can see that for the smaller delay (Δt = 0.07) the evaluated mean throughput of the continuous model is typically above the mean throughput of the discrete model, while it is the other way around for Δt = 0.14.

We now consider several optimization scenarios, which we solve for the continuous model by applying the adjoint calculus presented in Appendix A and the SQP solver DONLP2 Spellucci (1998a); 1998b); 2009). The computed optimal solutions will then be evaluated based on the discrete model in the following way:

Let 
                           
                              u
                              =
                              
                                 (
                                 
                                    C
                                    2
                                 
                                 ,
                                 …
                                 
                                 ,
                                 
                                    C
                                    K
                                 
                                 )
                              
                              ∈
                              
                                 
                                    R
                                 
                                 
                                    ≥
                                    0
                                 
                                 
                                    K
                                    −
                                    1
                                 
                              
                           
                         be the optimal solution found for the continuous model. To evaluate the discrete model, in particular we want to compute the mean throughput, we need an integer solution 
                           
                              
                                 
                                    N
                                 
                                 
                                    K
                                    −
                                    1
                                 
                              
                              ∋
                              
                                 u
                                 ˜
                              
                              ≈
                              u
                           
                        . Therefore, we round the components of u in such a way that

                           
                              (25)
                              
                                 
                                    
                                       ∑
                                       
                                          m
                                          =
                                          1
                                       
                                       
                                          K
                                          −
                                          1
                                       
                                    
                                    
                                       
                                          u
                                          ˜
                                       
                                       m
                                    
                                    =
                                    round
                                    
                                       (
                                       
                                          ∑
                                          
                                             m
                                             =
                                             1
                                          
                                          
                                             K
                                             −
                                             1
                                          
                                       
                                       
                                          u
                                          m
                                       
                                       )
                                    
                                    .
                                 
                              
                           
                        This is achieved by first sorting the components of u according to their non-integer parts and then do a round down for a certain number of components (with a smaller non-integer part) and a round up for the rest so that finally (25) holds. Note that 
                           
                              
                                 ∑
                                 
                                    m
                                    =
                                    1
                                 
                                 
                                    K
                                    −
                                    1
                                 
                              
                              
                                 u
                                 m
                              
                           
                         is the value of the objective function of u.

As above, we consider 10 instances (samplings of the processing times T
                        
                           m, n
                        ) for each setting, where this time K ∈ {3, 5, 7, 9}, N ∈ {104, 105} (accordingly tNt
                         = 1400 or tNt
                         = 14000) and Δt = 0.14. An overview over the results of the optimization procedure is given in Table 2
                        , where we show the minimum, average and maximum over all instances with respect to the computing time (in seconds), the optimal value of the objective function and the mean throughput (m.t.p.) for the rounded optimal solution evaluated with the discrete model.

As one can see from Table 2, the spread with respect to the optimal value of the objective function and the mean throughput for the rounded solution decreases for larger N. Moreover, the difference to the goal mean throughput 
                           
                              
                                 F
                                 ˜
                              
                              =
                              5.776
                           
                         is of the same size as the difference between the discrete and the continuous model for the simulation results in Section 6.2. Another important aspect is the behavior of the computing time with respect to N and in particular K. The performance data contained in Table 2 is therefore additionally illustrated in Fig. 6
                        , where the solid lines correspond to the average computing times for the entire optimization procedure for N = 104 and N = 105 and the dashed lines indicate the minima and maxima over all instances. Since the computing time for single simulations linearly grows with N (more precisely with the number of time steps in the discretization), a factor of 10 could be expected between the computing times for N = 104 and N = 105. This suits quite well for the minimum computing times and the factor is even less for the average and also the maximum times. Concerning the dependence with respect to the number of processors K, the growth of the computing times seems to be roughly linear. This is a crucial advantage of the presented technique applied to the continuous model compared to mixed integer linear programming approaches based on the discrete model (as described in Section 3), where the rate of increase seems to be much worse than linear (cf. Stolletz and Weiss, 2013; Weiss and Stolletz, 2013), even though the absolute computing times could already be reduced tremendously in the cited references.

In this work, we have introduced a continuous model for the buffer allocation problem. Compared to the already existing models in the literature, the continuous model provides remarkable simulation and optimization results.

Regarding deterministic processing times and the mean throughput of the entire production line, the difference between the discrete and continuous models vanishes for increasing time horizons/number of considered pieces. This observation still seems to hold for random processing times. Here, it is an interesting aspect that for the continuous model (without instantaneous processing) small enough time step sizes Δt usually lead to overestimations of the mean throughput compared to the discrete model, while large enough step sizes lead to underestimations. Concerning optimization tasks, the computing times for the continuous model behave extremely promising. The running times with respect to the considered number of pieces grow (at most) linearly, and further, also the running times with respect to the number of processors roughly grow linearly for the continuous approach.

Based on these promising first results, future work may include the combination of the presented approach with existing solvers, the extension to buffer allocation problems on general network topologies as well as different probability distributions for the processing times.

@&#ACKNOWLEDGMENT@&#

The author S. Göttlich was supported by the BMBF Project KinOpt.

To describe the adjoint approach we apply to compute gradient information, we consider the optimization task (24) in the following abstract form:

                        
                           
                              
                                 
                                    
                                       min
                                    
                                    
                                       
                                          J
                                          (
                                          u
                                          ,
                                          y
                                          )
                                       
                                    
                                 
                                 
                                    
                                       s.t.
                                    
                                    
                                       
                                          u
                                          ∈
                                          
                                             
                                                R
                                             
                                             
                                                ≥
                                                0
                                             
                                             Nu
                                          
                                          ,
                                          
                                          y
                                          ∈
                                          
                                             
                                                R
                                             
                                             Ny
                                          
                                       
                                    
                                 
                                 
                                    
                                    
                                       
                                          model
                                          
                                          equations:
                                          
                                          E
                                          (
                                          u
                                          ,
                                          y
                                          )
                                          =
                                          0
                                       
                                    
                                 
                                 
                                    
                                    
                                       
                                          constraints:
                                          
                                          g
                                          (
                                          u
                                          ,
                                          y
                                          )
                                          ≥
                                          0
                                       
                                    
                                 
                              
                           
                        
                     The vector u contains all control variables (here the buffer sizes Cm
                     ) and y contains the state variables of all time steps. Assuming that for given control variables u the model equations E(u, y) have a unique solution, one may consider y = y(u) and the so-called reduced problem

                        
                           (A.1)
                           
                              
                                 
                                    
                                       min
                                    
                                    
                                       
                                          J
                                          (
                                          u
                                          ,
                                          y
                                          (
                                          u
                                          )
                                          )
                                       
                                    
                                 
                                 
                                    
                                       s.t.
                                    
                                    
                                       
                                          u
                                          ∈
                                          
                                             
                                                R
                                             
                                             
                                                ≥
                                                0
                                             
                                             Nu
                                          
                                       
                                    
                                 
                                 
                                    
                                    
                                       
                                          constraints:
                                          
                                          g
                                          (
                                          u
                                          ,
                                          y
                                          (
                                          u
                                          )
                                          )
                                          ≥
                                          0
                                       
                                    
                                 
                              
                           
                        
                     where y(u) is implicitly given via E(u, y(u)) = 0. To solve (A.1) with gradient-based optimization techniques, one needs the total derivatives of the objective function J(u, y(u)) and the constraint(s) g(u, y(u)) with respect to u. In the following, we consider the computation of these derivatives only for the objective function since the procedure is identical for the constraints.

First of all, the chain rule yields

                        
                           (A.2)
                           
                              
                                 
                                    d
                                    
                                       d
                                       u
                                    
                                 
                                 J
                                 
                                    (
                                    u
                                    ,
                                    y
                                    
                                       (
                                       u
                                       )
                                    
                                    )
                                 
                                 =
                                 
                                    ∂
                                    
                                       ∂
                                       u
                                    
                                 
                                 J
                                 
                                    (
                                    u
                                    ,
                                    y
                                    
                                       (
                                       u
                                       )
                                    
                                    )
                                 
                                 +
                                 
                                    ∂
                                    
                                       ∂
                                       y
                                    
                                 
                                 J
                                 
                                    (
                                    u
                                    ,
                                    y
                                    
                                       (
                                       u
                                       )
                                    
                                    )
                                 
                                 
                                    d
                                    
                                       d
                                       u
                                    
                                 
                                 y
                                 
                                    (
                                    u
                                    )
                                 
                                 .
                              
                           
                        
                     While the partial derivatives of J with respect to u and y can be directly computed, the derivatives of the states y with respect to the control u are only implicitly given. Deriving the model equations E(u, y(u)) = 0 yields

                        
                           
                              
                                 0
                                 =
                                 
                                    d
                                    
                                       d
                                       u
                                    
                                 
                                 E
                                 
                                    (
                                    u
                                    ,
                                    y
                                    
                                       (
                                       u
                                       )
                                    
                                    )
                                 
                                 =
                                 
                                    ∂
                                    
                                       ∂
                                       u
                                    
                                 
                                 E
                                 
                                    (
                                    u
                                    ,
                                    y
                                    
                                       (
                                       u
                                       )
                                    
                                    )
                                 
                                 +
                                 
                                    ∂
                                    
                                       ∂
                                       y
                                    
                                 
                                 E
                                 
                                    (
                                    u
                                    ,
                                    y
                                    
                                       (
                                       u
                                       )
                                    
                                    )
                                 
                                 
                                    d
                                    
                                       d
                                       u
                                    
                                 
                                 y
                                 
                                    (
                                    u
                                    )
                                 
                              
                           
                        
                     and therewith (formally)

                        
                           (A.3)
                           
                              
                                 
                                    d
                                    
                                       d
                                       u
                                    
                                 
                                 y
                                 
                                    (
                                    u
                                    )
                                 
                                 =
                                 −
                                 
                                    
                                       (
                                       
                                          ∂
                                          
                                             ∂
                                             y
                                          
                                       
                                       E
                                       
                                          (
                                          u
                                          ,
                                          y
                                          
                                             (
                                             u
                                             )
                                          
                                          )
                                       
                                       )
                                    
                                    
                                       −
                                       1
                                    
                                 
                                 
                                    ∂
                                    
                                       ∂
                                       u
                                    
                                 
                                 E
                                 
                                    (
                                    u
                                    ,
                                    y
                                    
                                       (
                                       u
                                       )
                                    
                                    )
                                 
                                 .
                              
                           
                        
                     Even though the partial derivatives on the right-hand side of (A.3) can be directly computed, one would have to solve Nu systems of linear equations here. Instead of that, we insert (A.3) into (A.2) and get

                        
                           
                              
                                 
                                    
                                       
                                          
                                             d
                                             
                                                d
                                                u
                                             
                                          
                                          J
                                          
                                             (
                                             u
                                             ,
                                             y
                                             
                                                (
                                                u
                                                )
                                             
                                             )
                                          
                                       
                                    
                                    
                                       =
                                    
                                    
                                       
                                          
                                             ∂
                                             
                                                ∂
                                                u
                                             
                                          
                                          J
                                          
                                             (
                                             u
                                             ,
                                             y
                                             
                                                (
                                                u
                                                )
                                             
                                             )
                                          
                                          
                                             
                                                
                                                   −
                                                   
                                                      ∂
                                                      
                                                         ∂
                                                         y
                                                      
                                                   
                                                   J
                                                   
                                                      (
                                                      u
                                                      ,
                                                      y
                                                      
                                                         (
                                                         u
                                                         )
                                                      
                                                      )
                                                   
                                                   
                                                      
                                                         (
                                                         
                                                            ∂
                                                            
                                                               ∂
                                                               y
                                                            
                                                         
                                                         E
                                                         
                                                            (
                                                            u
                                                            ,
                                                            y
                                                            
                                                               (
                                                               u
                                                               )
                                                            
                                                            )
                                                         
                                                         )
                                                      
                                                      
                                                         −
                                                         1
                                                      
                                                   
                                                
                                                ︸
                                             
                                             
                                                =
                                                
                                                   ξ
                                                   T
                                                
                                             
                                          
                                       
                                    
                                 
                                 
                                    
                                    
                                    
                                       
                                          ×
                                          
                                             ∂
                                             
                                                ∂
                                                u
                                             
                                          
                                          E
                                          
                                             (
                                             u
                                             ,
                                             y
                                             
                                                (
                                                u
                                                )
                                             
                                             )
                                          
                                          .
                                       
                                    
                                 
                              
                           
                        
                     With the so-called adjoint state ξ as the solution of the adjoint equation

                        
                           (A.4)
                           
                              
                                 
                                    
                                       (
                                       
                                          ∂
                                          
                                             ∂
                                             y
                                          
                                       
                                       E
                                       
                                          (
                                          u
                                          ,
                                          y
                                          
                                             (
                                             u
                                             )
                                          
                                          )
                                       
                                       )
                                    
                                    T
                                 
                                 ξ
                                 =
                                 −
                                 
                                    
                                       (
                                       
                                          ∂
                                          
                                             ∂
                                             y
                                          
                                       
                                       J
                                       
                                          (
                                          u
                                          ,
                                          y
                                          
                                             (
                                             u
                                             )
                                          
                                          )
                                       
                                       )
                                    
                                    T
                                 
                                 ,
                              
                           
                        
                     we finally have

                        
                           (A.5)
                           
                              
                                 
                                    d
                                    
                                       d
                                       u
                                    
                                 
                                 J
                                 
                                    (
                                    u
                                    ,
                                    y
                                    
                                       (
                                       u
                                       )
                                    
                                    )
                                 
                                 =
                                 
                                    ∂
                                    
                                       ∂
                                       u
                                    
                                 
                                 J
                                 
                                    (
                                    u
                                    ,
                                    y
                                    
                                       (
                                       u
                                       )
                                    
                                    )
                                 
                                 +
                                 
                                    ξ
                                    T
                                 
                                 
                                    ∂
                                    
                                       ∂
                                       u
                                    
                                 
                                 E
                                 
                                    (
                                    u
                                    ,
                                    y
                                    
                                       (
                                       u
                                       )
                                    
                                    )
                                 
                                 .
                              
                           
                        
                     It is the fact that (A.4) is a single linear system and has a special structure, which can be easily exploited (see for instance Kolb, 2011; Kolb and Lang, 2012), which makes the computation of derivatives via an adjoint approach efficient. Note that for given control variables u one has to solve the model equations to get y(u), before one may compute the gradient information via (A.4) and (A.5).

@&#REFERENCES@&#

