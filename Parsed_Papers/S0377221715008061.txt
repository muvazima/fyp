@&#MAIN-TITLE@&#On-time delivery probabilistic models for the vehicle routing problem with stochastic demands and time windows

@&#HIGHLIGHTS@&#


               
               
                  
                     
                        
                           
                           Vehicle routing problem with stochastic demands and time windows is investigated.


                        
                        
                           
                           Three probabilistic models are proposed to address on-time delivery from different perspectives.


                        
                        
                           
                           Preventive restocking policy is shown to be applicable in the proposed models.


                        
                        
                           
                           A numerical example illustrates the effect of the preventive restocking policy.


                        
                     
                  
               
            

@&#KEYPHRASES@&#

Logistics

Stochastic vehicle routing

On-time delivery

Stochastic programming

Dynamic programming

@&#ABSTRACT@&#


               
               
                  Increasing attention is given to on-time delivery of goods in the distribution and logistics industry. Due to uncertainties in customer demands, on-time deliveries cannot be ensured frequently. The vehicle capacity may be exceeded along the planned delivery route, and then the vehicle has to return to the depot for reloading of the goods. In this paper, such on-time delivery issues are formulated as a vehicle routing problem with stochastic demands and time windows. Three probabilistic models are proposed to address on-time delivery from different perspectives. The first one aims to search delivery routes with minimum expected total cost. The second one is to maximize the sum of the on-time delivery probabilities to customers. The third one seeks to minimize the expected total cost, while ensuring a given on-time delivery probability to each customer. Having noted that solutions of the proposed models are affected by the recourse policy deployed in cases of route failures, a preventive restocking policy is examined and compared with a detour-to-depot recourse policy. A numerical example indicates that the preventive restocking policy can help obtain better solutions to the proposed models and its effectiveness depends on the solution structure. It is also shown that the third model can be used to determine the minimum number of vehicles required to satisfy customers’ on-time delivery requirements.
               
            

@&#INTRODUCTION@&#

The vehicle routing problem (VRP), introduced by Dantzig and Ramser (1959), involves planning a set of minimum-cost delivery routes for the vehicles of a logistics company. Each vehicle must depart from the depot, serve a set of geographically spread customers having known demands, and finally return to the depot. Each customer can only be visited once by one single vehicle. The total demand of the customers on each delivery route cannot exceed the vehicle capacity. Due to its broad distribution and logistics applications, the VRP together with a number of VRP variants has been intensively studied in the literature (Beraldi, Bruni, Laganà, & Musmanno, 2015; Dayarian et al., 2015; Golden, Raghavan, & Wasil, 2008; Leung, Zheng, Zhang, & Zhou, 2010, 2013; Toth & Vigo, 2002).

The vehicle routing problem with time windows (VRPTW) is one VRP variant in which each customer requires to be served within a given time window. In the case of hard time windows, late arrival vehicles are not allowed (Savelsbergh, 1992; Solomon, 1987). In the case of soft time windows, customers accept the service of late arrival vehicles, but nonetheless tardiness penalties are incurred (Chiang & Russell, 2004; Taillard, Badeau, Gendreau, Guertin, & Potvin, 1997). In both cases, early arrival vehicles must wait until the customer's earliest acceptable service time (i.e. the lower bound of the time window) begins.

The vehicle routing problem with stochastic demands and time windows (VRPSD-TW) extends the VRPTW by considering uncertainties in customer demands. In this problem, customer demands are only known with probability distributions when planning the delivery routes. A customer's actual demand could be revealed only when the vehicle arrives at the customer's location. A route failure is defined as occurring when the vehicle arrives at one customer location but the actual revealed demand of that customer exceeds the remaining vehicle capacity. In cases of such route failures, certain types of recourse actions must be taken. For example, the vehicle may return to the depot to reload before resuming the delivery service. Due to the additional travel times consumed by recourse actions, time windows of the remaining customers along the planned delivery route may be violated. On-time delivery to these customers thus cannot be ensured, which is a critical issue in the VRPSD-TW.

In the literature, only a few researchers have studied the VRPSD-TW. Chang (2005) proposed a two-stage stochastic programming with recourse model (referred to as a recourse model) for the VRPSD-TW. In the first stage, a set of a priori delivery routes is planned. The actual customer demands are then revealed in the second stage. A detour-to-depot recourse policy was deployed in cases of route failures. The objective is to plan a set of a priori delivery routes that minimizes carrier's expected total cost, which is comprised of the deterministic cost of the first-stage solution, the expected cost of recourse actions in the second stage and the expected penalty cost for time-window violations. Lei, Laporte, and Guo (2011) also formulated a recourse model for the VRPSD-TW to minimize carrier's expected total cost.

The above VRPSD-TW models mainly stemmed from the carrier's point of view and focused on reducing carrier's expected total cost. By this approach, the probability of late delivery to some customers may be quite high, because time windows could be violated due to the additional travel times consumed by recourse actions. In practice, however, on-time delivery is a key delivery service performance measure (Forslund & Jonsson, 2010; Karim, Samaranayake, Smith, & Halgamuge, 2010). On-time delivery directly influences inventory levels and customer service levels, and contributes to maintaining a competitive advantage in supply chain operations (Nakandala, Samaranayake, & Lau, 2013). Conversely, a high probability of late delivery would lead to customer dissatisfaction and consequently, reduced market share. Therefore, it is necessary to investigate on-time delivery in the study of the VRPSD-TW.

This paper extends the previous work in the following two aspects. Firstly, on-time delivery is addressed by formulating the VRPSD-TW from the different perspectives of the carrier and customers. Three probabilistic models are proposed for the VRPSD-TW. The first one is a recourse model formulated from the carrier perspective to minimize the carrier's expected total cost (penalties for late deliveries included), given that a fixed-size fleet of vehicles is available. The second model aims to maximize the sum of the on-time delivery probabilities to customers. It stems from the customer's point of view and addresses the question of “how well is the on-time delivery performance of the carrier with a fixed-size fleet of vehicles?” The third one is a new stochastic programming model which embeds probabilistic customer service level constraints within a traditional recourse model. It aims to minimize the carrier's expected total cost, while ensuring a given on-time delivery probability to each customer.

Secondly, the applicability of the preventive restocking (PR) policy on the three proposed models is examined. In the previous VRPSD-TW studies, the detour-to-depot (DTD) recourse policy was deployed in cases of route failures. Under this recourse policy, the vehicle returns to the depot to reload only when it runs out of stock. Inspired by Yang, Mathur, and Ballou (2000), a PR policy is developed for each of the three proposed models in this paper, under which the vehicle may return to the depot to reload before a stock-out occurs. The PR policy can help achieve better delivery solutions than those obtained by using the DTD recourse policy. It is also shown that the PR policy has a simple threshold-type structure and is easy to implement.

The remainder of this paper is organized as follows. Section 2 briefly reviews the vehicle routing problem with stochastic demands (VRPSD), which is closely related to the VRPSD-TW. Section 3 presents the three models proposed for the VRPSD-TW. Section 4 examines the PR policy for each of the three proposed models. Section 5 reports the results of an illustrative example. Conclusions are drawn and presented in Section 6.

@&#LITERATURE REVIEW@&#

The vehicle routing problem with stochastic demands arises if customer demands are not known with certainty when planning the delivery routes. This problem has been well studied in the literature (see Dror, Laporte, & Trudeau, 1989 and Gendreau, Laporte, & Séguin, 1996 for an introduction).

One common solution approach in VRPSD studies is a priori optimization (Bertsimas, Jaillet, & Odoni, 1990). By using this approach, the VRPSD can be modeled as a two-stage stochastic programming with recourse model (Goodson, Ohlmann, & Thomas, 2012; Haugland, Ho, & Laporte, 2007; Laporte, Louveaux, & Van hamme, 2002). In the first stage, an a priori set of delivery routes is planned. In the second stage, certain recourse actions can be taken as the actual customer demands are revealed, but the vehicle must follow the same customer visiting sequence as planned in the first stage. The objective of a recourse model is to design an a priori set of delivery routes which minimizes the deterministic cost of the first-stage solution plus the expected cost of recourse actions taken in the second stage. Delivery solutions obtained by a priori optimization are easy to implement in practice. Drivers can maintain high performances following fixed delivery routes and customers can receive regular services from the same driver (Erera, Savelsbergh, & Uyar, 2009).

Another solution approach in studying the VRPSD is the chance-constrained programming. Stewart and Golden (1983) presented a chance-constrained programming model for the VRPSD which minimizes the deterministic cost (or a priori cost) of the planned delivery routes, while ensuring that the probability of route failure is smaller than a given threshold. A similar model can be found in Dror et al. (1989). One deficiency of these chance-constrained programming models is that the locations of route failures are ignored (Dror et al., 1989). Two delivery routes with the same a priori cost and the same probability of route failure can have quite different costs of recourse actions, which are affected by the locations of route failures.

Some researchers have studied the VRPSD through a re-optimization approach (Dror, 1993; Dror et al., 1989; Novoa & Storer, 2009; Secomandi, 2001; Secomandi & Margot, 2009). In this approach, the vehicle does not have to follow a given customer visiting sequence as in a priori optimization. Conversely, each time the vehicle arrives at one customer location and observes the actual demand of that customer, it decides whether or not to return to the depot to reload and which customer to visit next, based on its remaining capacity and the set of unserved customers. While this approach may result in better delivery solutions with lower costs than a priori optimization, it is much more computationally expensive and it may also increase management costs (Novoa & Storer, 2009).

Different recourse policies have been used in VRPSD studies, including the detour-to-depot recourse policy (Chang, 2005; Lei et al., 2011) and the preventive restocking policy (Minis & Tatarakis, 2011; Pandelis, Kyriakidis, & Dimitrakos, 2012; Tatarakis & Minis, 2009; Yang et al., 2000). Ak and Erera (2007) proposed a paired-vehicle recourse policy for the VRPSD. In this recourse policy, some a priori delivery routes are paired so as to share the vehicle capacity. In each route pair, if a route failure occurs on one route, the remaining unserved customers are added to the end of the other route. The paired-vehicle recourse policy may not be suitable for the VRPSD-TW since it may lead to large time-window violations.

Let 
                        
                           G
                           =
                           (
                           
                              V
                              0
                           
                           ,
                           A
                           )
                        
                      be a complete undirected graph, where 
                        
                           
                              V
                              0
                           
                           =
                           
                              {
                              0
                              ,
                              …
                              ,
                              n
                              }
                           
                        
                      is the vertex set and 
                        
                           A
                           =
                           {
                           
                              (
                              i
                              ,
                              j
                              )
                           
                           :
                           i
                           ,
                           j
                           ∈
                           
                              V
                              0
                           
                           ,
                           i
                           ≠
                           j
                           }
                        
                      is the arc set. Vertex 0 represents the depot where several identical vehicles with capacity Q are located. The customer set is denoted as 
                        
                           V
                           =
                           
                              V
                              0
                           
                           
                              ∖
                              
                                 {
                                 0
                                 }
                              
                              =
                              
                                 {
                                 1
                                 ,
                                 …
                                 ,
                                 n
                                 }
                              
                           
                        
                     . Each customer i ∈ V is associated with a time window [ai, bi
                     ]. It is expected that i’s demand can be fully served within [ai, bi
                     ]. If the vehicle arrives at i’s location before ai
                     , it has to wait until ai
                     ; if the time when i’s demand is fully served is later than bi
                     , a penalty proportional to the lateness must be paid. A symmetric distance matrix 
                        
                           C
                           =
                           {
                           c
                           
                              (
                              i
                              ,
                              j
                              )
                           
                           :
                           i
                           ,
                           j
                           ∈
                           
                              V
                              0
                           
                           }
                        
                      is defined on A and it satisfies the triangular inequality. It is assumed that vehicles travel at unit speed and the travel time tij
                      between two nodes i and j thus equals the distance traveled c(i, j). In practice, the travel distance can be calculated by the shortest path algorithm in the road network (Li, Chen, Wang, & Lam, 2015). Additional notation is listed as follows:

                        
                           
                              
                              
                              
                                 
                                    
                                       
                                          M
                                       
                                    
                                    large enough number
                                 
                                 
                                    
                                       
                                          f
                                       
                                    
                                    fixed cost of employing one vehicle
                                 
                                 
                                    
                                       
                                          m
                                       
                                    
                                    number of vehicles used, which could be a given constant or a decision variable
                                 
                                 
                                    
                                       
                                          K
                                       
                                    
                                    set of vehicles used, 
                                          
                                             K
                                             =
                                             {
                                             1
                                             ,
                                             2
                                             ,
                                             …
                                             ,
                                             m
                                             }
                                          
                                       
                                    
                                 
                                 
                                    
                                       
                                          
                                             x
                                             
                                                i
                                                j
                                                k
                                             
                                          
                                       
                                    
                                    binary decision variable associated with each arc 
                                          
                                             (
                                             i
                                             ,
                                             j
                                             )
                                             ∈
                                             A
                                          
                                       . It is equal to 1 if and only if arc 
                                          
                                             (
                                             i
                                             ,
                                             j
                                             )
                                          
                                        is traversed by vehicle 
                                          k
                                        and 0 otherwise, 
                                          
                                             k
                                             ∈
                                             K
                                          
                                       
                                    
                                 
                                 
                                    
                                       
                                          
                                             R
                                             k
                                          
                                       
                                    
                                    delivery route 
                                          k
                                        defined as 
                                          
                                             
                                                R
                                                k
                                             
                                             =
                                             
                                                {
                                                
                                                   r
                                                   0
                                                
                                                =
                                                0
                                                ,
                                                
                                                   r
                                                   1
                                                
                                                ,
                                                …
                                                ,
                                                
                                                   r
                                                   j
                                                
                                                ,
                                                
                                                   r
                                                   
                                                      j
                                                      +
                                                      1
                                                   
                                                
                                                ,
                                                …
                                                ,
                                                
                                                   r
                                                   
                                                      n
                                                      k
                                                   
                                                
                                                ,
                                                
                                                   r
                                                   
                                                      
                                                         n
                                                         k
                                                      
                                                      +
                                                      1
                                                   
                                                
                                                =
                                                0
                                                }
                                             
                                          
                                       , where 
                                          
                                             n
                                             k
                                          
                                        is the number of customers assigned to vehicle 
                                          k
                                       , 
                                          
                                             
                                                r
                                                j
                                             
                                             ∈
                                             
                                                V
                                                0
                                             
                                          
                                       , 
                                          
                                             0
                                             ≤
                                             j
                                             ≤
                                             
                                                n
                                                k
                                             
                                             +
                                             1
                                          
                                       , 
                                          
                                             k
                                             ∈
                                             K
                                          
                                       
                                    
                                 
                                 
                                    
                                       
                                          
                                             d
                                             
                                                0
                                                k
                                             
                                          
                                       
                                    
                                    departure time of vehicle 
                                          k
                                        from the depot, 
                                          
                                             k
                                             ∈
                                             K
                                          
                                       
                                    
                                 
                                 
                                    
                                       
                                          
                                             A
                                             
                                                
                                                   r
                                                   j
                                                
                                                k
                                             
                                          
                                       
                                    
                                    arrival time of vehicle 
                                          k
                                        at vertex 
                                          
                                             r
                                             j
                                          
                                       ’s location, given that vehicle 
                                          k
                                        departs from the depot at time 
                                          
                                             d
                                             
                                                0
                                                k
                                             
                                          
                                       , 
                                          
                                             
                                                r
                                                j
                                             
                                             ∈
                                             
                                                R
                                                k
                                             
                                          
                                       , 
                                          
                                             1
                                             ≤
                                             j
                                             ≤
                                             
                                                n
                                                k
                                             
                                             +
                                             1
                                          
                                       , 
                                          
                                             k
                                             ∈
                                             K
                                          
                                       
                                    
                                 
                                 
                                    
                                       
                                          
                                             W
                                             
                                                
                                                   r
                                                   j
                                                
                                                k
                                             
                                          
                                       
                                    
                                    earliness (or wait time) of vehicle 
                                          k
                                        at customer 
                                          
                                             r
                                             j
                                          
                                       ’s location, 
                                          
                                             
                                                r
                                                j
                                             
                                             ∈
                                             
                                                R
                                                k
                                             
                                          
                                       , 
                                          
                                             1
                                             ≤
                                             j
                                             ≤
                                             
                                                n
                                                k
                                             
                                          
                                       , 
                                          
                                             k
                                             ∈
                                             K
                                          
                                       
                                    
                                 
                                 
                                    
                                       
                                          
                                             S
                                             
                                                
                                                   r
                                                   j
                                                
                                                k
                                             
                                          
                                       
                                    
                                    the time when customer 
                                          
                                             r
                                             j
                                          
                                       ’s demand is fully served by vehicle 
                                          k
                                       , 
                                          
                                             
                                                r
                                                j
                                             
                                             ∈
                                             
                                                R
                                                k
                                             
                                          
                                       , 
                                          
                                             1
                                             ≤
                                             j
                                             ≤
                                             
                                                n
                                                k
                                             
                                          
                                       , 
                                          
                                             k
                                             ∈
                                             K
                                          
                                       
                                    
                                 
                                 
                                    
                                       
                                          
                                             P
                                             
                                                
                                                   r
                                                   j
                                                
                                                k
                                             
                                          
                                       
                                    
                                    tardiness of delivery to customer 
                                          
                                             r
                                             j
                                          
                                       , 
                                          
                                             
                                                r
                                                j
                                             
                                             ∈
                                             
                                                R
                                                k
                                             
                                          
                                       , 
                                          
                                             1
                                             ≤
                                             j
                                             ≤
                                             
                                                n
                                                k
                                             
                                          
                                       , 
                                          
                                             k
                                             ∈
                                             K
                                          
                                       
                                    
                                 
                                 
                                    
                                       
                                          
                                             λ
                                             
                                                1
                                                i
                                             
                                          
                                       
                                    
                                    penalty coefficient for earliness at customer 
                                          i
                                       ’s location, 
                                          
                                             i
                                             ∈
                                             V
                                          
                                       
                                    
                                 
                                 
                                    
                                       
                                          
                                             λ
                                             
                                                2
                                                i
                                             
                                          
                                       
                                    
                                    penalty coefficient for late delivery to customer 
                                          i
                                       , 
                                          
                                             i
                                             ∈
                                             V
                                          
                                       
                                    
                                 
                                 
                                    
                                       
                                          
                                             α
                                             i
                                          
                                       
                                    
                                    required on-time delivery probability to customer 
                                          i
                                       , 
                                          
                                             i
                                             ∈
                                             V
                                          
                                       
                                    
                                 
                                 
                                    
                                       
                                          
                                             D
                                             i
                                          
                                       
                                    
                                    discrete random variable that describes customer 
                                          i
                                       ’s demand, 
                                          
                                             i
                                             ∈
                                             V
                                          
                                       
                                    
                                 
                                 
                                    
                                       
                                          
                                             p
                                             
                                                i
                                                ,
                                                r
                                             
                                          
                                       
                                    
                                    probability of customer 
                                          i
                                        having 
                                          r
                                        units of demand, 
                                          
                                             
                                                p
                                                
                                                   i
                                                   ,
                                                   r
                                                
                                             
                                             =
                                             P
                                             (
                                             
                                                D
                                                i
                                             
                                             =
                                             r
                                             )
                                          
                                       , 
                                          
                                             r
                                             =
                                             1
                                             ,
                                             2
                                             ,
                                             …
                                             ,
                                             R
                                          
                                       , 
                                          
                                             R
                                             <
                                             Q
                                          
                                       , 
                                          
                                             i
                                             ∈
                                             V
                                          
                                       
                                    
                                 
                                 
                                    
                                       
                                          
                                             E
                                             (
                                             
                                                L
                                                k
                                             
                                             )
                                          
                                       
                                    
                                    expected cost of the recourse actions taken along delivery route 
                                          
                                             R
                                             k
                                          
                                       , 
                                          
                                             k
                                             ∈
                                             K
                                          
                                       
                                    
                                 
                              
                           
                        
                     
                  

Several assumptions are made in this paper as follows: (1) customer demands are the only stochastic elements, and other elements such as travel times and customer locations are deterministic; (2) customer demands can be split and the maximum possible demand of each customer is smaller than the vehicle capacity; (3) soft time windows are considered; (4) a customer's actual demand is only revealed when the vehicle arrives at that customer's location and the customer's earliest acceptable service time (i.e. the lower bound of the time window) begins; (5) λ
                     1i
                      is smaller than or equal to 1, implying that the unit wait time cost is no greater than the unit travel time cost; and 6. service times at customer locations are neglected for clarity.

From the carrier's perspective, a two-stage stochastic programming with recourse model (RM) is built for the VRPSD-TW and shown in Eqs. (1)–(6). In RM, m is a given constant representing the number of vehicles assigned to serve the customers. The objective of RM is to plan a set of m a priori delivery routes which minimizes the carrier's expected total cost.


                     RM
                     
                        
                           (1)
                           
                              
                                 Min
                                 
                                 
                                    ∑
                                    
                                       (
                                       i
                                       ,
                                       j
                                       )
                                       ∈
                                       A
                                    
                                 
                                 
                                    
                                       ∑
                                       
                                          k
                                          ∈
                                          K
                                       
                                    
                                    
                                       
                                          t
                                          
                                             i
                                             j
                                          
                                       
                                       
                                          x
                                          
                                             i
                                             j
                                             k
                                          
                                       
                                    
                                 
                                 +
                                 
                                    ∑
                                    
                                       k
                                       ∈
                                       K
                                    
                                 
                                 
                                    
                                       E
                                       (
                                    
                                    
                                       L
                                       k
                                    
                                    )
                                 
                                 +
                                 
                                    ∑
                                    
                                       k
                                       ∈
                                       K
                                    
                                 
                                 
                                    
                                       ∑
                                       
                                          j
                                          =
                                          1
                                       
                                       
                                          n
                                          k
                                       
                                    
                                    
                                       [
                                       
                                          
                                             λ
                                             
                                                1
                                                
                                                   r
                                                   j
                                                
                                             
                                          
                                          
                                             E
                                             (
                                          
                                          
                                             W
                                             
                                                
                                                   r
                                                   j
                                                
                                                k
                                             
                                          
                                          )
                                          +
                                          
                                             λ
                                             
                                                2
                                                
                                                   r
                                                   j
                                                
                                             
                                          
                                          
                                             E
                                             (
                                          
                                          
                                             P
                                             
                                                
                                                   r
                                                   j
                                                
                                                k
                                             
                                          
                                          
                                             )
                                          
                                       
                                       ]
                                    
                                 
                              
                           
                        
                     
                     
                        
                           (2)
                           
                              
                                 s
                                 
                                    .
                                    t
                                 
                                 .
                                 
                                 
                                    ∑
                                    
                                       j
                                       ∈
                                       
                                          V
                                          0
                                       
                                    
                                 
                                 
                                    
                                       ∑
                                       
                                          k
                                          ∈
                                          K
                                       
                                    
                                    
                                       x
                                       
                                          i
                                          j
                                          k
                                       
                                    
                                 
                                 =
                                 1
                                 ,
                                 
                                 ∀
                                 i
                                 ∈
                                 V
                              
                           
                        
                     
                     
                        
                           (3)
                           
                              
                                 
                                    ∑
                                    
                                       j
                                       ∈
                                       V
                                    
                                 
                                 
                                    x
                                    
                                       0
                                       j
                                       k
                                    
                                 
                                 =
                                 1
                                 ,
                                 
                                 ∀
                                 k
                                 ∈
                                 K
                              
                           
                        
                     
                     
                        
                           (4)
                           
                              
                                 
                                    ∑
                                    
                                       i
                                       ∈
                                       V
                                    
                                 
                                 
                                    x
                                    
                                       i
                                       0
                                       k
                                    
                                 
                                 =
                                 1
                                 ,
                                 
                                 ∀
                                 k
                                 ∈
                                 K
                              
                           
                        
                     
                     
                        
                           (5)
                           
                              
                                 
                                    ∑
                                    
                                       i
                                       ∈
                                       
                                          V
                                          0
                                       
                                    
                                 
                                 
                                    x
                                    
                                       i
                                       j
                                       k
                                    
                                 
                                 −
                                 
                                    ∑
                                    
                                       i
                                       ∈
                                       
                                          V
                                          0
                                       
                                    
                                 
                                 
                                    x
                                    
                                       j
                                       i
                                       k
                                    
                                 
                                 =
                                 0
                                 ,
                                 
                                 ∀
                                 j
                                 ∈
                                 V
                                 ,
                                 k
                                 ∈
                                 K
                              
                           
                        
                     
                     
                        
                           (6)
                           
                              
                                 
                                    x
                                    
                                       i
                                       j
                                       k
                                    
                                 
                                 =
                                 
                                    {
                                    0
                                    ,
                                    1
                                    }
                                 
                                 ,
                                 
                                 ∀
                                 i
                                 ,
                                 j
                                 ∈
                                 
                                    V
                                    0
                                 
                                 ,
                                 k
                                 ∈
                                 K
                              
                           
                        
                     
                  

Objective function, Eq. (1), is composed of: (1) the deterministic cost of the first-stage solution (first summation term) and (2) the expected cost in the second stage including the expected cost of recourse actions (second summation term) and the expected penalty cost for time-window violations (third summation term). 
                        
                           W
                           
                              
                                 r
                                 j
                              
                              k
                           
                        
                      and 
                        
                           P
                           
                              
                                 r
                                 j
                              
                              k
                           
                        
                      in Eq. (1) are defined in Eqs. (7) and (8), respectively. The expected cost in the second stage depends on the recourse policy (discussed in Section 4) deployed in cases of route failures.

                        
                           (7)
                           
                              
                                 
                                    W
                                    
                                       
                                          r
                                          j
                                       
                                       k
                                    
                                 
                                 =
                                 max
                                 {
                                 
                                    a
                                    
                                       r
                                       j
                                    
                                 
                                 −
                                 
                                    A
                                    
                                       
                                          r
                                          j
                                       
                                       k
                                    
                                 
                                 
                                    ,
                                    0
                                    }
                                    ,
                                    
                                 
                                 
                                    r
                                    j
                                 
                                 ∈
                                 
                                    R
                                    k
                                 
                                 ,
                                 1
                                 ≤
                                 j
                                 ≤
                                 
                                    n
                                    k
                                 
                                 ,
                                 k
                                 ∈
                                 K
                              
                           
                        
                     
                     
                        
                           (8)
                           
                              
                                 
                                    P
                                    
                                       
                                          r
                                          j
                                       
                                       k
                                    
                                 
                                 =
                                 max
                                 {
                                 
                                    S
                                    
                                       
                                          r
                                          j
                                       
                                       k
                                    
                                 
                                 −
                                 
                                    b
                                    
                                       r
                                       j
                                    
                                 
                                 
                                    ,
                                    0
                                    }
                                    ,
                                    
                                 
                                 
                                    r
                                    j
                                 
                                 ∈
                                 
                                    R
                                    k
                                 
                                 ,
                                 1
                                 ≤
                                 j
                                 ≤
                                 
                                    n
                                    k
                                 
                                 ,
                                 k
                                 ∈
                                 K
                              
                           
                        
                     
                  


                     Eqs. (2)–(6) are the constraints imposed for the first-stage solution of RM. Eq. (2) restricts that each customer is visited exactly once by one vehicle. Eqs. (3) and (4) ensure that each vehicle starts and ends its delivery route at the depot. Eq. (5) ensures that each vehicle departs from a customer location after it visits that customer. Eq. (6) defines the domain of decision variables. Similar models to RM can be found in Chang (2005) and Lei et al. (2011).

From the customers’ perspective of receiving reliable delivery services, a new probabilistic model (PM) is proposed for the VRPSD-TW to plan a set of m a priori delivery routes which maximizes the sum of the on-time delivery probabilities to customers. The number of vehicles used m is assumed to be a given constant. PM addresses the question of “how well is the on-time delivery performance of the carrier with a fixed-size fleet of vehicles?”


                     PM
                     
                        
                           (9)
                           
                              
                                 Max
                                 
                                 
                                    ∑
                                    
                                       k
                                       ∈
                                       K
                                    
                                 
                                 
                                    
                                       ∑
                                       
                                          j
                                          =
                                          1
                                       
                                       
                                          n
                                          k
                                       
                                    
                                    
                                       P
                                       {
                                       
                                          S
                                          
                                             
                                                r
                                                j
                                             
                                             k
                                          
                                       
                                       ≤
                                       
                                          b
                                          
                                             r
                                             j
                                          
                                       
                                       }
                                    
                                 
                              
                           
                        
                     s.t. constraints Eqs. (2)–(6).

Objective function Eq. (9) of PM is the sum of the on-time delivery probabilities to customers. Costs such as the cost of recourse actions and the penalty cost for time-window violations are ignored in PM. A similar model to PM can be found in Kenyon and Morton (2003), in which the probability of completing the delivery service by a given deadline is maximized in the context of stochastic travel times.

To consider both the carrier and customer interests, a new stochastic programming model (RMPC) which embeds probabilistic customer service level constraints within a traditional recourse model is proposed for the VRPSD-TW. In RMPC, m is assumed to be a decision variable and the fixed vehicle employment cost is included in the carrier's expected total cost.


                     RMPC
                     
                        
                           (10)
                           
                              
                                 
                                    
                                    
                                    
                                       
                                          Min
                                          
                                          M
                                          f
                                          ·
                                          m
                                          +
                                          
                                             ∑
                                             
                                                (
                                                i
                                                ,
                                                j
                                                )
                                                ∈
                                                A
                                             
                                          
                                          
                                             
                                                ∑
                                                
                                                   k
                                                   ∈
                                                   K
                                                
                                             
                                             
                                                
                                                   t
                                                   
                                                      i
                                                      j
                                                   
                                                
                                                
                                                   x
                                                   
                                                      i
                                                      j
                                                      k
                                                   
                                                
                                             
                                          
                                          +
                                          
                                             ∑
                                             
                                                k
                                                ∈
                                                K
                                             
                                          
                                          
                                             
                                                E
                                                (
                                             
                                             
                                                L
                                                k
                                             
                                             )
                                          
                                       
                                    
                                 
                                 
                                    
                                    
                                    
                                       
                                          +
                                          
                                             ∑
                                             
                                                k
                                                ∈
                                                K
                                             
                                          
                                          
                                             
                                                ∑
                                                
                                                   j
                                                   =
                                                   1
                                                
                                                
                                                   n
                                                   k
                                                
                                             
                                             
                                                [
                                                
                                                   
                                                      λ
                                                      
                                                         1
                                                         
                                                            r
                                                            j
                                                         
                                                      
                                                   
                                                   
                                                      E
                                                      (
                                                   
                                                   
                                                      W
                                                      
                                                         
                                                            r
                                                            j
                                                         
                                                         k
                                                      
                                                   
                                                   )
                                                   +
                                                   
                                                      λ
                                                      
                                                         2
                                                         
                                                            r
                                                            j
                                                         
                                                      
                                                   
                                                   
                                                      E
                                                      (
                                                   
                                                   
                                                      P
                                                      
                                                         
                                                            r
                                                            j
                                                         
                                                         k
                                                      
                                                   
                                                   
                                                      )
                                                   
                                                
                                                ]
                                             
                                          
                                       
                                    
                                 
                              
                           
                        
                     
                     
                        
                           (11)
                           
                              
                                 s
                                 
                                    .
                                    t
                                 
                                 .
                                 
                                 P
                                 
                                    {
                                    
                                       S
                                       
                                          
                                             r
                                             j
                                          
                                          k
                                       
                                    
                                    ≤
                                    
                                       b
                                       
                                          r
                                          j
                                       
                                    
                                    }
                                 
                                 ≥
                                 
                                    α
                                    
                                       r
                                       j
                                    
                                 
                                 ,
                                 
                                 ∀
                                 
                                    r
                                    j
                                 
                                 ∈
                                 
                                    R
                                    k
                                 
                                 ,
                                 1
                                 ≤
                                 j
                                 ≤
                                 
                                    n
                                    k
                                 
                                 ,
                                 k
                                 ∈
                                 K
                              
                           
                        
                     and constraints Eqs. (2)–(6).


                     f · m in Eq. (10) is the fixed vehicle employment cost. Eq. (11) restricts that the on-time delivery probability to each customer is at least a given value and is referred to as a probabilistic customer service level constraint. Similar models to RMPC can be found in Beraldi and Bruni (2009) and Zhang, Lam, and Chen (2013).


                     RMPC has a hierarchical optimization objective. The fixed vehicle employment cost is multiplied by a large enough number M in Eq. (10). The primary objective is to minimize the number of vehicles required to satisfy the probabilistic customer service level constraint Eq. (11). Given a minimized number of vehicles used, the secondary objective is to minimize the sum of the deterministic cost of the first-stage solution, the expected cost of recourse actions and the expected penalty cost for time-window violations.

In the VRPSD-TW, a stock-out may occur in the following two cases: (1) a vehicle arrives at a customer location but the revealed customer demand exceeds the remaining vehicle capacity; (2) upon service completion at a customer, the remaining vehicle capacity becomes zero. Under the DTD recourse policy, the vehicle returns to the depot to reload only if either of the two types of stock-outs occurs. After reloading at the depot, in the first stock-out case, the vehicle resumes service at the customer location where the stock-out occurred; in the second stock-out case, it proceeds directly to the next customer along the planned delivery route.

Under the PR policy, a vehicle may return to the depot to reload before a stock-out occurs. After serving one customer, the vehicle decides whether or not to return to the depot to reload based on the amount of its remaining capacity. If this amount is smaller than a pre-set quantity, then the vehicle returns to the depot to reload; otherwise it proceeds directly to the next customer along the planned delivery route. In the first stock-out case stated above, the vehicle takes the same action as in the DTD recourse policy. In this section, the applicability of the PR policy is examined on each of the three models proposed in Section 3.

Let τ be one of the planned delivery routes in a particular solution of RM. It is defined as 
                           
                              τ
                              =
                              (
                              0
                              ,
                              1
                              ,
                              2
                              ,
                              …
                              ,
                              j
                              ,
                              j
                              +
                              1
                              ,
                              …
                              ,
                              n
                              ,
                              0
                              )
                           
                        , where 0 denotes the depot and j the customer. Under the DTD recourse policy, let f
                        1, D, j
                        (q, dj
                        ) be the expected cost from j onward along τ, given that, after service completion at j, the vehicle has a remaining capacity q and it departs from j at time dj. f
                        1, D, j
                        (q, dj
                        ) is computed in the following recursive form:

                           
                              (12)
                              
                                 
                                    
                                       f
                                       
                                          1
                                          ,
                                          D
                                          ,
                                          j
                                       
                                    
                                    (
                                    q
                                    ,
                                    
                                       d
                                       j
                                    
                                    
                                       )
                                       =
                                    
                                    
                                       {
                                       
                                          
                                             
                                                
                                                   
                                                      H
                                                      
                                                         1
                                                         ,
                                                         D
                                                         ,
                                                         j
                                                      
                                                   
                                                   (
                                                   q
                                                   ,
                                                   
                                                      d
                                                      j
                                                   
                                                   )
                                                   ,
                                                   
                                                   if
                                                   
                                                   q
                                                   >
                                                   0
                                                
                                             
                                          
                                          
                                             
                                                
                                                   
                                                      
                                                         
                                                            H
                                                            ′
                                                         
                                                      
                                                      
                                                         1
                                                         ,
                                                         D
                                                         ,
                                                         j
                                                      
                                                   
                                                   (
                                                   q
                                                   ,
                                                   
                                                      d
                                                      j
                                                   
                                                   )
                                                   ,
                                                   
                                                   if
                                                   
                                                   q
                                                   =
                                                   0
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           
                        with the boundary condition 
                           
                              
                                 f
                                 
                                    1
                                    ,
                                    D
                                    ,
                                    n
                                 
                              
                              
                                 (
                                 q
                                 ,
                                 
                                    d
                                    j
                                 
                                 )
                              
                              =
                              
                                 t
                                 
                                    n
                                    ,
                                    0
                                 
                              
                           
                        . In Eq. (12), H
                        1, D, j
                        (q, dj
                        ) denotes the expected cost of proceeding directly to 
                           
                              j
                              +
                              1
                           
                         upon service completion at j under the DTD recourse policy. It is given as:

                           
                              (13)
                              
                                 
                                    
                                       
                                       
                                       
                                          
                                             
                                                H
                                                
                                                   1
                                                   ,
                                                   D
                                                   ,
                                                   j
                                                
                                             
                                             
                                                (
                                                q
                                                ,
                                                
                                                   d
                                                   j
                                                
                                                )
                                             
                                             =
                                             
                                                t
                                                
                                                   j
                                                   ,
                                                   j
                                                   +
                                                   1
                                                
                                             
                                             +
                                             
                                                λ
                                                
                                                   1
                                                   ,
                                                   j
                                                   +
                                                   1
                                                
                                             
                                             
                                                w
                                                
                                                   j
                                                   +
                                                   1
                                                
                                             
                                             
                                                (
                                                
                                                   d
                                                   j
                                                
                                                )
                                             
                                          
                                       
                                    
                                    
                                       
                                       
                                       
                                          
                                             +
                                             
                                                ∑
                                                
                                                   r
                                                   ≤
                                                   q
                                                
                                             
                                             
                                                
                                                   [
                                                   
                                                      
                                                         λ
                                                         
                                                            2
                                                            ,
                                                            j
                                                            +
                                                            1
                                                         
                                                      
                                                      
                                                         l
                                                         
                                                            j
                                                            +
                                                            1
                                                         
                                                      
                                                      
                                                         (
                                                         
                                                            d
                                                            j
                                                         
                                                         )
                                                      
                                                      +
                                                      
                                                         f
                                                         
                                                            1
                                                            ,
                                                            D
                                                            ,
                                                            j
                                                            +
                                                            1
                                                         
                                                      
                                                      
                                                         (
                                                         q
                                                         −
                                                         r
                                                         ,
                                                         
                                                            d
                                                            j
                                                         
                                                         +
                                                         
                                                            t
                                                            
                                                               j
                                                               ,
                                                               j
                                                               +
                                                               1
                                                            
                                                         
                                                         +
                                                         
                                                            w
                                                            
                                                               j
                                                               +
                                                               1
                                                            
                                                         
                                                         
                                                            (
                                                            
                                                               d
                                                               j
                                                            
                                                            )
                                                         
                                                         )
                                                      
                                                   
                                                   ]
                                                
                                                
                                                   p
                                                   
                                                      j
                                                      +
                                                      1
                                                      ,
                                                      r
                                                   
                                                
                                             
                                          
                                       
                                    
                                    
                                       
                                       
                                       
                                          
                                             +
                                             
                                                ∑
                                                
                                                   r
                                                   >
                                                   q
                                                
                                             
                                             
                                                [
                                                2
                                             
                                             
                                                t
                                                
                                                   j
                                                   +
                                                   1
                                                   ,
                                                   0
                                                
                                             
                                             +
                                             
                                                λ
                                                
                                                   2
                                                   ,
                                                   j
                                                   +
                                                   1
                                                
                                             
                                             
                                                
                                                   
                                                      l
                                                      ′
                                                   
                                                
                                                
                                                   j
                                                   +
                                                   1
                                                
                                             
                                             
                                                (
                                                
                                                   d
                                                   j
                                                
                                                )
                                             
                                             +
                                             
                                                f
                                                
                                                   1
                                                   ,
                                                   D
                                                   ,
                                                   j
                                                   +
                                                   1
                                                
                                             
                                          
                                       
                                    
                                    
                                       
                                       
                                       
                                          
                                             ×
                                             
                                                (
                                                q
                                                +
                                                Q
                                                −
                                                r
                                                ,
                                                
                                                   d
                                                   j
                                                
                                                +
                                                
                                                   t
                                                   
                                                      j
                                                      ,
                                                      j
                                                      +
                                                      1
                                                   
                                                
                                                +
                                                
                                                   w
                                                   
                                                      j
                                                      +
                                                      1
                                                   
                                                
                                                
                                                   (
                                                   
                                                      d
                                                      j
                                                   
                                                   )
                                                
                                                +
                                                2
                                                
                                                   t
                                                   
                                                      j
                                                      +
                                                      1
                                                      ,
                                                      0
                                                   
                                                
                                                )
                                             
                                             
                                                ]
                                             
                                             
                                                p
                                                
                                                   j
                                                   +
                                                   1
                                                   ,
                                                   r
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           
                        
                     


                        
                           
                              
                                 H
                                 
                                    1
                                    ,
                                    D
                                    ,
                                    j
                                 
                                 ′
                              
                              (
                              q
                              ,
                              
                                 d
                                 j
                              
                              )
                           
                         represents the expected cost of returning to the depot to reload and then proceeding to customer 
                           
                              j
                              +
                              1
                           
                         under the DTD recourse policy. It is given as:

                           
                              (14)
                              
                                 
                                    
                                       
                                       
                                       
                                          
                                             
                                                H
                                                
                                                   1
                                                   ,
                                                   D
                                                   ,
                                                   j
                                                
                                                ′
                                             
                                             
                                                (
                                                q
                                                ,
                                                
                                                   d
                                                   j
                                                
                                                )
                                             
                                             =
                                             
                                                t
                                                
                                                   j
                                                   ,
                                                   0
                                                
                                             
                                             +
                                             
                                                t
                                                
                                                   0
                                                   ,
                                                   j
                                                   +
                                                   1
                                                
                                             
                                             +
                                             
                                                λ
                                                
                                                   1
                                                   ,
                                                   j
                                                   +
                                                   1
                                                
                                             
                                             
                                                w
                                                
                                                   j
                                                   +
                                                   1
                                                
                                                ′
                                             
                                             
                                                (
                                                
                                                   d
                                                   j
                                                
                                                )
                                             
                                             +
                                             
                                                λ
                                                
                                                   2
                                                   ,
                                                   j
                                                   +
                                                   1
                                                
                                             
                                             
                                                l
                                                
                                                   j
                                                   +
                                                   1
                                                
                                                
                                                   ′
                                                   ′
                                                
                                             
                                             
                                                (
                                                
                                                   d
                                                   j
                                                
                                                )
                                             
                                          
                                       
                                    
                                    
                                       
                                       
                                       
                                          
                                             
                                                ∑
                                                r
                                             
                                             
                                                f
                                                
                                                   1
                                                   ,
                                                   D
                                                   ,
                                                   j
                                                   +
                                                   1
                                                
                                             
                                             
                                                (
                                                Q
                                                −
                                                r
                                                ,
                                                
                                                   d
                                                   j
                                                
                                                +
                                                
                                                   t
                                                   
                                                      j
                                                      ,
                                                      0
                                                   
                                                
                                                +
                                                
                                                   t
                                                   
                                                      0
                                                      ,
                                                      j
                                                      +
                                                      1
                                                   
                                                
                                                +
                                                
                                                   w
                                                   
                                                      j
                                                      +
                                                      1
                                                   
                                                   ′
                                                
                                                
                                                   (
                                                   
                                                      d
                                                      j
                                                   
                                                   )
                                                
                                                )
                                             
                                             
                                                p
                                                
                                                   j
                                                   +
                                                   1
                                                   ,
                                                   r
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           
                        
                     

Some of the variables in Eqs. (13) and (14) are defined in Eqs. (15)–(19), where 
                           
                              
                                 [
                                 a
                                 −
                                 b
                                 ]
                              
                              +
                           
                         is equal to 
                           
                              (
                              a
                              −
                              b
                              )
                           
                         if a is larger than b, and 0 otherwise. The expected total cost of τ, under the DTD recourse policy, equals to f
                        1, D, 0(Q, d
                        0), provided that the vehicle departs from the depot at time d
                        0 with a full capacity Q.

                           
                              (15)
                              
                                 
                                    
                                       w
                                       
                                          j
                                          +
                                          1
                                       
                                    
                                    
                                       (
                                       
                                          d
                                          j
                                       
                                       )
                                    
                                    =
                                    
                                       
                                          [
                                          
                                             a
                                             
                                                j
                                                +
                                                1
                                             
                                          
                                          −
                                          
                                             (
                                             
                                                d
                                                j
                                             
                                             +
                                             
                                                t
                                                
                                                   j
                                                   ,
                                                   j
                                                   +
                                                   1
                                                
                                             
                                             )
                                          
                                          ]
                                       
                                       +
                                    
                                 
                              
                           
                        
                        
                           
                              (16)
                              
                                 
                                    
                                       w
                                       
                                          j
                                          +
                                          1
                                       
                                       ′
                                    
                                    
                                       (
                                       
                                          d
                                          j
                                       
                                       )
                                    
                                    =
                                    
                                       
                                          [
                                          
                                             a
                                             
                                                j
                                                +
                                                1
                                             
                                          
                                          −
                                          
                                             (
                                             
                                                d
                                                j
                                             
                                             +
                                             
                                                t
                                                
                                                   j
                                                   ,
                                                   0
                                                
                                             
                                             +
                                             
                                                t
                                                
                                                   0
                                                   ,
                                                   j
                                                   +
                                                   1
                                                
                                             
                                             )
                                          
                                          ]
                                       
                                       +
                                    
                                 
                              
                           
                        
                        
                           
                              (17)
                              
                                 
                                    
                                       l
                                       
                                          j
                                          +
                                          1
                                       
                                    
                                    
                                       (
                                       
                                          d
                                          j
                                       
                                       )
                                    
                                    =
                                    
                                       
                                          [
                                          
                                             (
                                             
                                                d
                                                j
                                             
                                             +
                                             
                                                t
                                                
                                                   j
                                                   ,
                                                   j
                                                   +
                                                   1
                                                
                                             
                                             )
                                          
                                          −
                                          
                                             b
                                             
                                                j
                                                +
                                                1
                                             
                                          
                                          ]
                                       
                                       +
                                    
                                 
                              
                           
                        
                        
                           
                              (18)
                              
                                 
                                    
                                       l
                                       
                                          j
                                          +
                                          1
                                       
                                       ′
                                    
                                    
                                       (
                                       
                                          d
                                          j
                                       
                                       )
                                    
                                    =
                                    
                                       
                                          [
                                          
                                             (
                                             
                                                d
                                                j
                                             
                                             +
                                             
                                                t
                                                
                                                   j
                                                   ,
                                                   j
                                                   +
                                                   1
                                                
                                             
                                             +
                                             
                                                w
                                                
                                                   j
                                                   +
                                                   1
                                                
                                             
                                             
                                                (
                                                
                                                   d
                                                   j
                                                
                                                )
                                             
                                             +
                                             2
                                             
                                                t
                                                
                                                   j
                                                   +
                                                   1
                                                   ,
                                                   0
                                                
                                             
                                             )
                                          
                                          −
                                          
                                             b
                                             
                                                j
                                                +
                                                1
                                             
                                          
                                          ]
                                       
                                       +
                                    
                                 
                              
                           
                        
                        
                           
                              (19)
                              
                                 
                                    
                                       l
                                       
                                          j
                                          +
                                          1
                                       
                                       
                                          ′
                                          ′
                                       
                                    
                                    
                                       (
                                       
                                          d
                                          j
                                       
                                       )
                                    
                                    =
                                    
                                       
                                          [
                                          
                                             (
                                             
                                                d
                                                j
                                             
                                             +
                                             
                                                t
                                                
                                                   j
                                                   ,
                                                   0
                                                
                                             
                                             +
                                             
                                                t
                                                
                                                   0
                                                   ,
                                                   j
                                                   +
                                                   1
                                                
                                             
                                             )
                                          
                                          −
                                          
                                             b
                                             
                                                j
                                                +
                                                1
                                             
                                          
                                          ]
                                       
                                       +
                                    
                                 
                              
                           
                        
                     

Similarly, under the PR policy, let f
                        1, P, j
                        (q, dj
                        ) be the expected cost from j onward along τ, given that, after serving j, the vehicle has a remaining capacity q and it departs from j at time dj. f
                        1, P, j
                        (q, dj
                        ) satisfies the dynamic programming recursion:

                           
                              (20)
                              
                                 
                                    
                                       f
                                       
                                          1
                                          ,
                                          P
                                          ,
                                          j
                                       
                                    
                                    
                                       (
                                       q
                                       ,
                                       
                                          d
                                          j
                                       
                                       )
                                    
                                    =
                                    Min
                                    
                                       {
                                       
                                          
                                             H
                                             
                                                1
                                                ,
                                                P
                                                ,
                                                j
                                             
                                          
                                          
                                             (
                                             q
                                             ,
                                             
                                                d
                                                j
                                             
                                             )
                                          
                                          ,
                                          
                                             
                                                
                                                   H
                                                   ′
                                                
                                             
                                             
                                                1
                                                ,
                                                P
                                                ,
                                                j
                                             
                                          
                                          
                                             (
                                             q
                                             ,
                                             
                                                d
                                                j
                                             
                                             )
                                          
                                       
                                       }
                                    
                                 
                              
                           
                        with the boundary condition 
                           
                              
                                 f
                                 
                                    1
                                    ,
                                    P
                                    ,
                                    n
                                 
                              
                              
                                 (
                                 q
                                 ,
                                 
                                    d
                                    j
                                 
                                 )
                              
                              =
                              
                                 t
                                 
                                    n
                                    ,
                                    0
                                 
                              
                           
                        . In Eq. (20), H
                        1, P, j
                        (q, dj
                        ) denotes the expected cost of proceeding directly to 
                           
                              j
                              +
                              1
                           
                         upon service completion at j under the PR policy:

                           
                              (21)
                              
                                 
                                    
                                       
                                       
                                       
                                          
                                             
                                                H
                                                
                                                   1
                                                   ,
                                                   P
                                                   ,
                                                   j
                                                
                                             
                                             
                                                (
                                                q
                                                ,
                                                
                                                   d
                                                   j
                                                
                                                )
                                             
                                             =
                                             
                                                t
                                                
                                                   j
                                                   ,
                                                   j
                                                   +
                                                   1
                                                
                                             
                                             +
                                             
                                                λ
                                                
                                                   1
                                                   ,
                                                   j
                                                   +
                                                   1
                                                
                                             
                                             
                                                w
                                                
                                                   j
                                                   +
                                                   1
                                                
                                             
                                             
                                                (
                                                
                                                   d
                                                   j
                                                
                                                )
                                             
                                          
                                       
                                    
                                    
                                       
                                       
                                       
                                          
                                             +
                                             
                                                ∑
                                                
                                                   r
                                                   ≤
                                                   q
                                                
                                             
                                             
                                                
                                                   [
                                                   
                                                      
                                                         λ
                                                         
                                                            2
                                                            ,
                                                            j
                                                            +
                                                            1
                                                         
                                                      
                                                      
                                                         l
                                                         
                                                            j
                                                            +
                                                            1
                                                         
                                                      
                                                      
                                                         (
                                                         
                                                            d
                                                            j
                                                         
                                                         )
                                                      
                                                      +
                                                      
                                                         f
                                                         
                                                            1
                                                            ,
                                                            P
                                                            ,
                                                            j
                                                            +
                                                            1
                                                         
                                                      
                                                      
                                                         (
                                                         q
                                                         −
                                                         r
                                                         ,
                                                         
                                                            d
                                                            j
                                                         
                                                         +
                                                         
                                                            t
                                                            
                                                               j
                                                               ,
                                                               j
                                                               +
                                                               1
                                                            
                                                         
                                                         +
                                                         
                                                            w
                                                            
                                                               j
                                                               +
                                                               1
                                                            
                                                         
                                                         
                                                            (
                                                            
                                                               d
                                                               j
                                                            
                                                            )
                                                         
                                                         )
                                                      
                                                   
                                                   ]
                                                
                                                
                                                   p
                                                   
                                                      j
                                                      +
                                                      1
                                                      ,
                                                      r
                                                   
                                                
                                             
                                          
                                       
                                    
                                    
                                       
                                       
                                       
                                          
                                             +
                                             
                                                ∑
                                                
                                                   r
                                                   >
                                                   q
                                                
                                             
                                             
                                                [
                                                2
                                             
                                             
                                                t
                                                
                                                   j
                                                   +
                                                   1
                                                   ,
                                                   0
                                                
                                             
                                             +
                                             
                                                λ
                                                
                                                   2
                                                   ,
                                                   j
                                                   +
                                                   1
                                                
                                             
                                             
                                                
                                                   
                                                      l
                                                      ′
                                                   
                                                
                                                
                                                   j
                                                   +
                                                   1
                                                
                                             
                                             
                                                (
                                                
                                                   d
                                                   j
                                                
                                                )
                                             
                                             +
                                             
                                                f
                                                
                                                   1
                                                   ,
                                                   P
                                                   ,
                                                   j
                                                   +
                                                   1
                                                
                                             
                                          
                                       
                                    
                                    
                                       
                                       
                                       
                                          
                                             
                                                (
                                                q
                                                +
                                                Q
                                                −
                                                r
                                                ,
                                                
                                                   d
                                                   j
                                                
                                                +
                                                
                                                   t
                                                   
                                                      j
                                                      ,
                                                      j
                                                      +
                                                      1
                                                   
                                                
                                                +
                                                
                                                   w
                                                   
                                                      j
                                                      +
                                                      1
                                                   
                                                
                                                
                                                   (
                                                   
                                                      d
                                                      j
                                                   
                                                   )
                                                
                                                +
                                                2
                                                
                                                   t
                                                   
                                                      j
                                                      +
                                                      1
                                                      ,
                                                      0
                                                   
                                                
                                                )
                                             
                                             
                                                ]
                                             
                                             
                                                p
                                                
                                                   j
                                                   +
                                                   1
                                                   ,
                                                   r
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           
                        
                     


                        
                           
                              
                                 H
                                 
                                    1
                                    ,
                                    P
                                    ,
                                    j
                                 
                                 ′
                              
                              (
                              q
                              ,
                              
                                 d
                                 j
                              
                              )
                           
                         represents the expected cost of returning to the depot to reload and then proceeding to 
                           
                              j
                              +
                              1
                           
                         under the PR policy:

                           
                              (22)
                              
                                 
                                    
                                       
                                       
                                       
                                          
                                             
                                                
                                                   
                                                      H
                                                      ′
                                                   
                                                
                                                
                                                   1
                                                   ,
                                                   P
                                                   ,
                                                   j
                                                
                                             
                                             
                                                (
                                                q
                                                ,
                                                
                                                   d
                                                   j
                                                
                                                )
                                             
                                             =
                                             
                                                t
                                                
                                                   j
                                                   ,
                                                   0
                                                
                                             
                                             +
                                             
                                                t
                                                
                                                   0
                                                   ,
                                                   j
                                                   +
                                                   1
                                                
                                             
                                             +
                                             
                                                λ
                                                
                                                   1
                                                   ,
                                                   j
                                                   +
                                                   1
                                                
                                             
                                             
                                                
                                                   
                                                      w
                                                      ′
                                                   
                                                
                                                
                                                   j
                                                   +
                                                   1
                                                
                                             
                                             
                                                (
                                                
                                                   d
                                                   j
                                                
                                                )
                                             
                                             +
                                             
                                                λ
                                                
                                                   2
                                                   ,
                                                   j
                                                   +
                                                   1
                                                
                                             
                                             
                                                
                                                   
                                                      l
                                                      
                                                         ′
                                                         ′
                                                      
                                                   
                                                
                                                
                                                   j
                                                   +
                                                   1
                                                
                                             
                                             
                                                (
                                                
                                                   d
                                                   j
                                                
                                                )
                                             
                                          
                                       
                                    
                                    
                                       
                                       
                                       
                                          
                                             +
                                             
                                                ∑
                                                r
                                             
                                             
                                                
                                                   f
                                                   
                                                      1
                                                      ,
                                                      P
                                                      ,
                                                      j
                                                      +
                                                      1
                                                   
                                                
                                                
                                                   (
                                                   Q
                                                   −
                                                   r
                                                   ,
                                                   
                                                      d
                                                      j
                                                   
                                                   +
                                                   
                                                      t
                                                      
                                                         j
                                                         ,
                                                         0
                                                      
                                                   
                                                   +
                                                   
                                                      t
                                                      
                                                         0
                                                         ,
                                                         j
                                                         +
                                                         1
                                                      
                                                   
                                                   +
                                                   
                                                      
                                                         
                                                            w
                                                            ′
                                                         
                                                      
                                                      
                                                         j
                                                         +
                                                         1
                                                      
                                                   
                                                   
                                                      (
                                                      
                                                         d
                                                         j
                                                      
                                                      )
                                                   
                                                   )
                                                
                                                
                                                   p
                                                   
                                                      j
                                                      +
                                                      1
                                                      ,
                                                      r
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           
                        
                     

The expected total cost of τ under the PR policy then equals f
                        1, P, 0(Q, d
                        0), provided that the vehicle departs from the depot at time d
                        0 with a full capacity Q.

Several properties of the PR policy for RM are given below. The proofs of these properties are provided in Appendix A.


                        
                           Lemma 1
                           
                              
                                 
                                    x
                                    +
                                    
                                       f
                                       
                                          1
                                          ,
                                          P
                                          ,
                                          j
                                       
                                    
                                    (
                                    q
                                    ,
                                    x
                                    
                                       )
                                       =
                                       Min
                                    
                                    
                                       {
                                       
                                          x
                                          +
                                          
                                             H
                                             
                                                1
                                                ,
                                                P
                                                ,
                                                j
                                             
                                          
                                          (
                                          q
                                          ,
                                          x
                                          
                                             )
                                             ,
                                          
                                          x
                                          +
                                          
                                             
                                                
                                                   H
                                                   ′
                                                
                                             
                                             
                                                1
                                                ,
                                                P
                                                ,
                                                j
                                             
                                          
                                          (
                                          q
                                          ,
                                          x
                                          )
                                       
                                       }
                                    
                                 
                               
                              is monotonically non-decreasing with respect to x.
                           


                        
                           Lemma 2
                           
                              
                                 
                                    
                                       f
                                       
                                          1
                                          ,
                                          P
                                          ,
                                          j
                                       
                                    
                                    (
                                    Q
                                    ,
                                    
                                       d
                                       j
                                    
                                    
                                       )
                                       =
                                    
                                    
                                       H
                                       
                                          1
                                          ,
                                          P
                                          ,
                                          j
                                       
                                    
                                    (
                                    Q
                                    ,
                                    
                                       d
                                       j
                                    
                                    )
                                 
                              
                           


                        
                           Lemma 3
                           
                              
                                 
                                    2
                                    
                                       t
                                       
                                          j
                                          
                                             ,
                                             0
                                          
                                       
                                    
                                    +
                                    
                                       f
                                       
                                          1
                                          ,
                                          P
                                          ,
                                          j
                                       
                                    
                                    (
                                    Q
                                    ,
                                    
                                       d
                                       j
                                    
                                    
                                       +
                                       2
                                    
                                    
                                       t
                                       
                                          j
                                          
                                             ,
                                             0
                                          
                                       
                                    
                                    )
                                    ≥
                                    
                                       f
                                       
                                          1
                                          ,
                                          P
                                          ,
                                          j
                                       
                                    
                                    (
                                    q
                                    ,
                                    
                                       d
                                       j
                                    
                                    )
                                 
                              
                           


                        
                           Theorem 1
                           
                              To minimize the expected total cost of a planned delivery route, for each customer j along the planned delivery route and a departure time dj from customer j, there exists a quantity hj, such that the optimal decision, after service completion at customer j, is to proceed directly to customer
                              
                                 
                                    j
                                    +
                                    1
                                 
                               
                              if q > hj, or return to the depot to reload if q ≤ hj.
                           


                        Theorem 1 indicates that the PR policy for RM has a threshold-type structure. To find the quantity hj
                        , given the departure time dj
                        , 
                           
                              
                                 H
                                 
                                    1
                                    ,
                                    P
                                    ,
                                    j
                                 
                                 ′
                              
                              (
                              q
                              ,
                              
                                 d
                                 j
                              
                              )
                           
                         can be computed first. Then H
                        1, P, j
                        (q, dj
                        ) is computed in descending order of q until it exceeds 
                           
                              
                                 H
                                 
                                    1
                                    ,
                                    P
                                    ,
                                    j
                                 
                                 ′
                              
                              (
                              q
                              ,
                              
                                 d
                                 j
                              
                              )
                           
                        . hj
                         equals the smallest value of q for which 
                           
                              
                                 H
                                 
                                    1
                                    ,
                                    P
                                    ,
                                    j
                                 
                              
                              (
                              q
                              ,
                              
                                 d
                                 j
                              
                              )
                              >
                              
                                 H
                                 
                                    1
                                    ,
                                    P
                                    ,
                                    j
                                 
                                 ′
                              
                              (
                              q
                              ,
                              
                                 d
                                 j
                              
                              )
                           
                        .

The objective function Eq. (9) of PM is the sum of the on-time delivery probabilities to customers. Consider a planned delivery route 
                           
                              τ
                              =
                              (
                              0
                              ,
                              1
                              ,
                              2
                              ,
                              …
                              ,
                              j
                              ,
                              
                              j
                              +
                              1
                              ,
                              …
                              ,
                              
                              n
                              ,
                              
                              0
                              )
                           
                         in a particular solution of PM. Let f
                        2, D, j
                        (q, dj
                        ) be the sum of the on-time delivery probabilities from j onward along τ under the DTD recourse policy, given that the vehicle has a remaining capacity q after serving j and departs from j at time dj. f
                        2, D, j
                        (q, dj
                        ) is computed in the recursive form in Eq. (23). The sum of the on-time delivery probabilities to all the customers along τ under the DTD recourse policy then equals f
                        2, D, 0(Q, d
                        0), provided that the vehicle departs from the depot at time d
                        0 with a full capacity Q.

                           
                              (23)
                              
                                 
                                    
                                       f
                                       
                                          2
                                          ,
                                          D
                                          ,
                                          j
                                       
                                    
                                    (
                                    q
                                    ,
                                    
                                       d
                                       j
                                    
                                    
                                       )
                                       =
                                    
                                    
                                       {
                                       
                                          
                                             
                                                
                                                   
                                                      H
                                                      
                                                         2
                                                         ,
                                                         D
                                                         ,
                                                         j
                                                      
                                                   
                                                   (
                                                   q
                                                   ,
                                                   
                                                      d
                                                      j
                                                   
                                                   )
                                                   ,
                                                   
                                                   if
                                                   
                                                   q
                                                   >
                                                   0
                                                
                                             
                                          
                                          
                                             
                                                
                                                   
                                                      
                                                         
                                                            H
                                                            ′
                                                         
                                                      
                                                      
                                                         2
                                                         ,
                                                         D
                                                         ,
                                                         j
                                                      
                                                   
                                                   (
                                                   q
                                                   ,
                                                   
                                                      d
                                                      j
                                                   
                                                   )
                                                   ,
                                                   
                                                   if
                                                   
                                                   q
                                                   =
                                                   0
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           
                        with the boundary condition 
                           
                              
                                 f
                                 
                                    2
                                    ,
                                    D
                                    ,
                                    n
                                 
                              
                              
                                 (
                                 q
                                 ,
                                 
                                    d
                                    j
                                 
                                 )
                              
                              =
                              0
                           
                        .

In Eq. (23), H
                        2, D, j
                        (q, dj
                        ) denotes the sum of the on-time delivery probabilities from j onward along τ when the vehicle has a positive remaining capacity after serving j and proceeds directly to 
                           
                              j
                              +
                              1
                           
                         under the DTD recourse policy:

                           
                              (24)
                              
                                 
                                    
                                       
                                       
                                       
                                          
                                             
                                                H
                                                
                                                   2
                                                   ,
                                                   D
                                                   ,
                                                   j
                                                
                                             
                                             (
                                             q
                                             ,
                                             
                                                d
                                                j
                                             
                                             
                                                )
                                                =
                                             
                                             
                                                ∑
                                                
                                                   r
                                                   ≤
                                                   q
                                                
                                             
                                             [
                                             
                                                
                                                   (
                                                   
                                                      b
                                                      
                                                         j
                                                         +
                                                         1
                                                      
                                                   
                                                   −
                                                   (
                                                   
                                                      d
                                                      j
                                                   
                                                   +
                                                   
                                                      t
                                                      
                                                         j
                                                         ,
                                                         j
                                                         +
                                                         1
                                                      
                                                   
                                                   
                                                      )
                                                      )
                                                   
                                                
                                                +
                                             
                                          
                                       
                                    
                                    
                                       
                                       
                                       
                                          
                                             +
                                             
                                                f
                                                
                                                   2
                                                   ,
                                                   D
                                                   ,
                                                   j
                                                   +
                                                   1
                                                
                                             
                                             (
                                             q
                                             −
                                             r
                                             ,
                                             
                                                d
                                                j
                                             
                                             +
                                             
                                                t
                                                
                                                   j
                                                   ,
                                                   j
                                                   +
                                                   1
                                                
                                             
                                             +
                                             
                                                w
                                                
                                                   j
                                                   +
                                                   1
                                                
                                             
                                             (
                                             
                                                d
                                                j
                                             
                                             
                                                )
                                                )
                                             
                                             ]
                                             
                                                p
                                                
                                                   j
                                                   +
                                                   1
                                                   ,
                                                   r
                                                
                                             
                                          
                                       
                                    
                                    
                                       
                                       
                                       
                                          
                                             +
                                             
                                                ∑
                                                
                                                   r
                                                   >
                                                   q
                                                
                                             
                                             [
                                             
                                                
                                                   (
                                                   
                                                      b
                                                      
                                                         j
                                                         +
                                                         1
                                                      
                                                   
                                                   −
                                                   (
                                                   
                                                      d
                                                      j
                                                   
                                                   +
                                                   
                                                      t
                                                      
                                                         j
                                                         ,
                                                         j
                                                         +
                                                         1
                                                      
                                                   
                                                   +
                                                   
                                                      w
                                                      
                                                         j
                                                         +
                                                         1
                                                      
                                                   
                                                   (
                                                   
                                                      d
                                                      j
                                                   
                                                   
                                                      )
                                                      +
                                                      2
                                                   
                                                   
                                                      t
                                                      
                                                         j
                                                         +
                                                         1
                                                         ,
                                                         0
                                                      
                                                   
                                                   
                                                      )
                                                      )
                                                   
                                                
                                                +
                                             
                                          
                                       
                                    
                                    
                                       
                                       
                                       
                                          
                                             +
                                             
                                                f
                                                
                                                   2
                                                   ,
                                                   D
                                                   ,
                                                   j
                                                   +
                                                   1
                                                
                                             
                                             (
                                             q
                                             +
                                             Q
                                             −
                                             r
                                             ,
                                             
                                                d
                                                j
                                             
                                             +
                                             
                                                t
                                                
                                                   j
                                                   ,
                                                   j
                                                   +
                                                   1
                                                
                                             
                                             +
                                             
                                                w
                                                
                                                   j
                                                   +
                                                   1
                                                
                                             
                                             (
                                             
                                                d
                                                j
                                             
                                             
                                                )
                                                +
                                                2
                                             
                                             
                                                t
                                                
                                                   j
                                                   +
                                                   1
                                                   ,
                                                   0
                                                
                                             
                                             )
                                             ]
                                             
                                                p
                                                
                                                   j
                                                   +
                                                   1
                                                   ,
                                                   r
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           
                        where 
                           
                              
                                 (
                                 a
                                 −
                                 b
                                 )
                              
                              +
                           
                         is equal to 1 if a is larger than b, and 0 otherwise. 
                           
                              
                                 H
                                 
                                    2
                                    ,
                                    D
                                    ,
                                    j
                                 
                                 ′
                              
                              (
                              q
                              ,
                              
                                 d
                                 j
                              
                              )
                           
                         represents the sum of the on-time delivery probabilities from j onward along τ when the vehicle is out-of-stock after serving j and returns to the depot to reload before visiting 
                           
                              j
                              +
                              1
                           
                         under the DTD recourse policy:

                           
                              (25)
                              
                                 
                                    
                                       
                                       
                                       
                                          
                                             
                                                H
                                                
                                                   2
                                                   ,
                                                   D
                                                   ,
                                                   j
                                                
                                                ′
                                             
                                             
                                                (
                                                q
                                                ,
                                                
                                                   d
                                                   j
                                                
                                                )
                                             
                                             =
                                             
                                                
                                                   (
                                                   
                                                      b
                                                      
                                                         j
                                                         +
                                                         1
                                                      
                                                   
                                                   −
                                                   
                                                      (
                                                      
                                                         d
                                                         j
                                                      
                                                      +
                                                      
                                                         t
                                                         
                                                            j
                                                            ,
                                                            0
                                                         
                                                      
                                                      +
                                                      
                                                         t
                                                         
                                                            0
                                                            ,
                                                            j
                                                            +
                                                            1
                                                         
                                                      
                                                      )
                                                   
                                                   )
                                                
                                                +
                                             
                                          
                                       
                                    
                                    
                                       
                                       
                                       
                                          
                                             +
                                             
                                                ∑
                                                r
                                             
                                             
                                                
                                                   f
                                                   
                                                      2
                                                      ,
                                                      D
                                                      ,
                                                      j
                                                      +
                                                      1
                                                   
                                                
                                                (
                                                Q
                                                −
                                                r
                                                ,
                                                
                                                   d
                                                   j
                                                
                                                +
                                                
                                                   t
                                                   
                                                      j
                                                      
                                                         ,
                                                         0
                                                      
                                                   
                                                
                                                +
                                                
                                                   t
                                                   
                                                      
                                                         0
                                                         ,
                                                      
                                                      j
                                                      +
                                                      1
                                                   
                                                
                                                +
                                                
                                                   
                                                      
                                                         w
                                                         ′
                                                      
                                                   
                                                   
                                                      j
                                                      +
                                                      1
                                                   
                                                
                                                (
                                                
                                                   d
                                                   j
                                                
                                                
                                                   )
                                                   )
                                                
                                                
                                                   p
                                                   
                                                      j
                                                      +
                                                      1
                                                      ,
                                                      r
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           
                        
                     

Under the PR policy, let f
                        2, P, j
                        (q, dj
                        ) be the sum of the on-time delivery probabilities from j onward along τ, given that the vehicle has a remaining capacity q after serving j and departs from j at time dj. f
                        2, P, j
                        (q, dj
                        ) satisfies the dynamic programming recursion:

                           
                              (26)
                              
                                 
                                    
                                       f
                                       
                                          2
                                          ,
                                          P
                                          ,
                                          j
                                       
                                    
                                    
                                       (
                                       q
                                       ,
                                       
                                          d
                                          j
                                       
                                       )
                                    
                                    =
                                    Max
                                    
                                       {
                                       
                                          
                                             H
                                             
                                                2
                                                ,
                                                P
                                                ,
                                                j
                                             
                                          
                                          
                                             (
                                             q
                                             ,
                                             
                                                d
                                                j
                                             
                                             )
                                          
                                          ,
                                          
                                             
                                                
                                                   H
                                                   ′
                                                
                                             
                                             
                                                2
                                                ,
                                                P
                                                ,
                                                j
                                             
                                          
                                          
                                             (
                                             q
                                             ,
                                             
                                                d
                                                j
                                             
                                             )
                                          
                                       
                                       }
                                    
                                 
                              
                           
                        with the boundary condition 
                           
                              
                                 f
                                 
                                    2
                                    ,
                                    P
                                    ,
                                    n
                                 
                              
                              
                                 (
                                 q
                                 ,
                                 
                                    d
                                    j
                                 
                                 )
                              
                              =
                              0
                           
                        . In Eq. (26), H
                        2, P, j
                        (q, dj
                        ) denotes the sum of the on-time delivery probabilities from j onward along τ if the vehicle proceeds directly to 
                           
                              j
                              +
                              1
                           
                         after serving j under the PR policy:

                           
                              (27)
                              
                                 
                                    
                                       
                                       
                                       
                                          
                                             
                                                H
                                                
                                                   2
                                                   ,
                                                   P
                                                   ,
                                                   j
                                                
                                             
                                             (
                                             q
                                             ,
                                             
                                                d
                                                j
                                             
                                             
                                                )
                                                =
                                             
                                             
                                                ∑
                                                
                                                   r
                                                   ≤
                                                   q
                                                
                                             
                                             [
                                             
                                                
                                                   (
                                                   
                                                      b
                                                      
                                                         j
                                                         +
                                                         1
                                                      
                                                   
                                                   −
                                                   (
                                                   
                                                      d
                                                      j
                                                   
                                                   +
                                                   
                                                      t
                                                      
                                                         j
                                                         ,
                                                         j
                                                         +
                                                         1
                                                      
                                                   
                                                   
                                                      )
                                                      )
                                                   
                                                
                                                +
                                             
                                          
                                       
                                    
                                    
                                       
                                       
                                       
                                          
                                             +
                                             
                                                f
                                                
                                                   2
                                                   ,
                                                   P
                                                   ,
                                                   j
                                                   +
                                                   1
                                                
                                             
                                             (
                                             q
                                             −
                                             r
                                             ,
                                             
                                                d
                                                j
                                             
                                             +
                                             
                                                t
                                                
                                                   j
                                                   ,
                                                   j
                                                   +
                                                   1
                                                
                                             
                                             +
                                             
                                                w
                                                
                                                   j
                                                   +
                                                   1
                                                
                                             
                                             (
                                             
                                                d
                                                j
                                             
                                             
                                                )
                                                )
                                             
                                             ]
                                             
                                                p
                                                
                                                   j
                                                   +
                                                   1
                                                   ,
                                                   r
                                                
                                             
                                          
                                       
                                    
                                    
                                       
                                       
                                       
                                          
                                             +
                                             
                                                ∑
                                                
                                                   r
                                                   >
                                                   q
                                                
                                             
                                             [
                                             
                                                
                                                   (
                                                   
                                                      b
                                                      
                                                         j
                                                         +
                                                         1
                                                      
                                                   
                                                   −
                                                   (
                                                   
                                                      d
                                                      j
                                                   
                                                   +
                                                   
                                                      t
                                                      
                                                         j
                                                         ,
                                                         j
                                                         +
                                                         1
                                                      
                                                   
                                                   +
                                                   
                                                      w
                                                      
                                                         j
                                                         +
                                                         1
                                                      
                                                   
                                                   (
                                                   
                                                      d
                                                      j
                                                   
                                                   
                                                      )
                                                      +
                                                      2
                                                   
                                                   
                                                      t
                                                      
                                                         j
                                                         +
                                                         1
                                                         ,
                                                         0
                                                      
                                                   
                                                   
                                                      )
                                                      )
                                                   
                                                
                                                +
                                             
                                          
                                       
                                    
                                    
                                       
                                       
                                       
                                          
                                             +
                                             
                                                f
                                                
                                                   2
                                                   ,
                                                   P
                                                   ,
                                                   j
                                                   +
                                                   1
                                                
                                             
                                             (
                                             q
                                             +
                                             Q
                                             −
                                             r
                                             ,
                                             
                                                d
                                                j
                                             
                                             +
                                             
                                                t
                                                
                                                   j
                                                   ,
                                                   j
                                                   +
                                                   1
                                                
                                             
                                             +
                                             
                                                w
                                                
                                                   j
                                                   +
                                                   1
                                                
                                             
                                             (
                                             
                                                d
                                                j
                                             
                                             
                                                )
                                                +
                                                2
                                             
                                             
                                                t
                                                
                                                   j
                                                   +
                                                   1
                                                   ,
                                                   0
                                                
                                             
                                             )
                                             ]
                                             
                                                p
                                                
                                                   j
                                                   +
                                                   1
                                                   ,
                                                   r
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           
                        
                     


                        
                           
                              
                                 H
                                 
                                    2
                                    ,
                                    P
                                    ,
                                    j
                                 
                                 ′
                              
                              (
                              q
                              ,
                              
                                 d
                                 j
                              
                              )
                           
                         represents the sum of the on-time delivery probabilities from j onward along τ if the vehicle returns to the depot to reload before visiting 
                           
                              j
                              +
                              1
                           
                         under the PR policy:

                           
                              (28)
                              
                                 
                                    
                                       
                                       
                                       
                                          
                                             
                                                H
                                                
                                                   2
                                                   ,
                                                   P
                                                   ,
                                                   j
                                                
                                                ′
                                             
                                             
                                                (
                                                q
                                                ,
                                                
                                                   d
                                                   j
                                                
                                                )
                                             
                                             =
                                             
                                                
                                                   (
                                                   
                                                      b
                                                      
                                                         j
                                                         +
                                                         1
                                                      
                                                   
                                                   −
                                                   
                                                      (
                                                      
                                                         d
                                                         j
                                                      
                                                      +
                                                      
                                                         t
                                                         
                                                            j
                                                            ,
                                                            0
                                                         
                                                      
                                                      +
                                                      
                                                         t
                                                         
                                                            0
                                                            ,
                                                            j
                                                            +
                                                            1
                                                         
                                                      
                                                      )
                                                   
                                                   )
                                                
                                                +
                                             
                                          
                                       
                                    
                                    
                                       
                                       
                                       
                                          
                                             +
                                             
                                                ∑
                                                r
                                             
                                             
                                                
                                                   f
                                                   
                                                      2
                                                      ,
                                                      P
                                                      ,
                                                      j
                                                      +
                                                      1
                                                   
                                                
                                                
                                                   (
                                                   Q
                                                   −
                                                   r
                                                   ,
                                                   
                                                      d
                                                      j
                                                   
                                                   +
                                                   
                                                      t
                                                      
                                                         j
                                                         ,
                                                         0
                                                      
                                                   
                                                   +
                                                   
                                                      t
                                                      
                                                         0
                                                         ,
                                                         j
                                                         +
                                                         1
                                                      
                                                   
                                                   +
                                                   
                                                      
                                                         
                                                            w
                                                            ′
                                                         
                                                      
                                                      
                                                         j
                                                         +
                                                         1
                                                      
                                                   
                                                   
                                                      (
                                                      
                                                         d
                                                         j
                                                      
                                                      )
                                                   
                                                   )
                                                
                                                
                                                   p
                                                   
                                                      j
                                                      +
                                                      1
                                                      ,
                                                      r
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           
                        
                     

The sum of the on-time delivery probabilities to all the customers along τ under the PR policy then equals f
                        2, P, 0(Q, d
                        0), provided that the vehicle departs from the depot at time d
                        0 with a full capacity Q. Several properties of the PR policy for PM are given below. The proofs of these properties are analogous to those in Section 4.1 and are omitted here.


                        
                           Lemma 4
                           
                              
                                 
                                    
                                       f
                                       
                                          2
                                          ,
                                          P
                                          ,
                                          j
                                       
                                    
                                    
                                       (
                                       q
                                       ,
                                       x
                                       )
                                    
                                    =
                                    Max
                                    
                                       {
                                       
                                          
                                             H
                                             
                                                2
                                                ,
                                                P
                                                ,
                                                j
                                             
                                          
                                          
                                             (
                                             q
                                             ,
                                             x
                                             )
                                          
                                          ,
                                          
                                             
                                                
                                                   H
                                                   ′
                                                
                                             
                                             
                                                2
                                                ,
                                                P
                                                ,
                                                j
                                             
                                          
                                          
                                             (
                                             q
                                             ,
                                             x
                                             )
                                          
                                       
                                       }
                                    
                                 
                               
                              is monotonically non-increasing with respect to x.
                           


                        
                           Lemma 5
                           
                              
                                 
                                    
                                       f
                                       
                                          2
                                          ,
                                          P
                                          ,
                                          j
                                       
                                    
                                    (
                                    Q
                                    ,
                                    
                                       d
                                       j
                                    
                                    
                                       )
                                       
                                       =
                                       
                                    
                                    
                                       H
                                       
                                          2
                                          ,
                                          P
                                          ,
                                          j
                                       
                                    
                                    (
                                    Q
                                    ,
                                    
                                       d
                                       j
                                    
                                    )
                                 
                               and 
                                 
                                    
                                       f
                                       
                                          2
                                          ,
                                          P
                                          ,
                                          j
                                       
                                    
                                    (
                                    0
                                    ,
                                    
                                       d
                                       j
                                    
                                    
                                       )
                                       
                                       =
                                       
                                    
                                    
                                       H
                                       
                                          2
                                          ,
                                          P
                                          ,
                                          j
                                       
                                       ′
                                    
                                    (
                                    0
                                    ,
                                    
                                       d
                                       j
                                    
                                    )
                                 
                              .


                        
                           Lemma 6
                           
                              
                                 
                                    
                                       f
                                       
                                          2
                                          ,
                                          P
                                          ,
                                          j
                                       
                                    
                                    (
                                    q
                                    ,
                                    
                                       d
                                       j
                                    
                                    )
                                    ≥
                                    
                                       f
                                       
                                          2
                                          ,
                                          P
                                          ,
                                          j
                                       
                                    
                                    (
                                    Q
                                    ,
                                    
                                       d
                                       j
                                    
                                    
                                       +
                                       2
                                    
                                    
                                       t
                                       
                                          j
                                          +
                                          1
                                          
                                             ,
                                             0
                                          
                                       
                                    
                                    )
                                 
                              
                           


                        
                           Theorem 2
                           
                              To maximize the sum of the on-time delivery probabilities to all the customer along a planned delivery route, for each customer j along the planned delivery route and a departure time dj from j, there exists a quantity hj, such that the optimal decision, after service completion at j, is to proceed directly to
                              
                                 
                                    j
                                    +
                                    1
                                 
                               
                              if q > hj, or return to the depot to reload if q ≤ hj.
                           

To achieve the hierarchical objective of RMPC, the PR policy proposed for RMPC is described as follows: for a planned delivery route 
                           
                              τ
                              =
                              (
                              0
                              ,
                              1
                              ,
                              2
                              ,
                              …
                              ,
                              j
                              ,
                              
                              j
                              +
                              1
                              ,
                              
                              ,
                              
                              n
                              ,
                              
                              0
                              )
                           
                        , firstly apply the PR policy for RM (Section 4.1) to minimize the expected total cost of τ; if the resulting on-time delivery probabilities to customers cannot meet customers’ on-time delivery requirements, then apply the PR policy for PM (Section 4.2) to maximize the on-time delivery probability to each customer on τ.

In this section, a small example network (Fig. 1
                     ) with a single depot and four customers was adopted to illustrate the performance of the proposed models for the VRPSD-TW and the effect of the PR policy. In Fig. 1, D denotes the depot and Ci
                      represents the customer, 
                        
                           i
                           =
                           1
                           ,
                           2
                           ,
                           3
                           ,
                           4
                        
                     . Numbers within square brackets in Fig. 1 denote the time windows specified by customers, whereas numbers beside the links represent the distances between nodes in the network. It was assumed that only one vehicle is available at the depot for serving the four customers and the vehicle capacity Q is 15 units. Vehicle departure time from D was set to 8:00 AM.

Customer demands were assumed to follow homogeneous discrete distributions and four different customer demand distributions were tested (Table 1
                     
                     ). The first customer demand distribution is a discrete uniform distribution and denoted as UD in Table 1; the second one is a symmetric discrete triangular distribution and denoted as SD in Table 1; the last two are positively skewed (PSD in Table 1) and negatively skewed (NSD in Table 1) discrete triangular distributions, respectively.

In this section, RM was solved to obtain a delivery route with minimum expected total cost. The earliness penalty coefficient λ
                        1i
                         in RM was set equal to 0.5 and the tardiness penalty coefficient λ
                        2i
                         was set equal to 2, 
                           
                              i
                              =
                              1
                              ,
                              2
                              ,
                              3
                              ,
                              4
                           
                        . All possible solutions of RM using only one vehicle are listed in Table B.1 in Appendix B. The expected total costs of these solutions under the PR policy for RM (Section 4.1) are displayed in Table 2, as well as the percent improvement in expected total cost generated by the PR policy over the detour-to-depot recourse policy.

The results in Table 2 indicate that, by applying the PR policy for RM, obvious improvement in expected total cost can be achieved over the DTD recourse policy for most of the possible solutions of RM. For the optimal solution s13 (D-C
                        2-C
                        3-C
                        4-C
                        1-D) of RM under all four different customer demand distributions, the percent improvement in expected total cost generated by the PR policy ranges from 12.70 percent to 19.05 percent.

The results in Table 2 also indicate that the expected total cost of a possible solution of RM under the PR policy depends on the customer demand distribution. As distribution UD has a higher standard deviation than distribution SD, the expected total cost of a possible solution of RM is generally higher under distribution UD than that under distribution SD. Since distribution NSD has a higher expected value than distribution PSD, the expected total cost of a possible solution of RM is generally higher under distribution NSD.

It is noted that, under a particular customer demand distribution, the percent improvement in expected total cost generated by the PR policy varies among different possible solutions of RM. For example, under distribution UD, the maximum percent improvement is 24.01 percent (s17, D-C
                        2-C
                        1-C
                        4-C
                        3-D), while the minimum percent improvement is only 3.69 percent (s21, D-C
                        1-C
                        2-C
                        3-C
                        4-D). This variation is due to the difference between the PR policies for different possible solutions as discussed below, with solutions s17 and s21 under distribution UD taken as examples.

Under the PR policy, when the vehicle departs from the depot with a full capacity Q, according to Lemma 2 in Section 4.1, for both solutions s17 and s21, the optimal decision is to proceed directly to the first customer (C
                        2 in s17 and C
                        1 in s21). After service completion at the first customer, it is found that the optimal decision is also the same for solutions s17 and s21, i.e. to return to the depot to reload if the remaining vehicle capacity q ≤ 7 and to proceed directly to the second customer (C
                        1 in s17 and C
                        2 in s21) if q > 7.

After service completion at the second customer, for both solutions s17 and s21, three possible values exist for the vehicle departure time d
                        2 from the second customer. The probability distributions of q at different possible values of d
                        2 are shown in Fig. 2.
                        
                     


                        Fig. 2 shows that the probability distributions of q at a certain departure time are the same for solutions s17 and s21. This is because homogeneous customer demand distributions were assumed and the optimal decisions are the same for solutions s17 and s21 in previous two stages of decision-making. For each d
                        2 in Fig. 2, the minimum expected cost from the second customer onward f
                        1, P, 2(q, d
                        2) along the planned delivery route is depicted in Fig. 3.
                        
                     


                        Fig. 3(a) indicates that f
                        1, P, 2(q, d
                        2) is equal to 
                           
                              
                                 H
                                 
                                    1
                                    ,
                                    P
                                    ,
                                    2
                                 
                                 ′
                              
                              (
                              q
                              ,
                              
                                 d
                                 2
                              
                              )
                           
                         when q ≤ 11 under all three possible values of d
                        2, i.e. the optimal decision is to return to the depot to reload if q ≤ 11 after serving the second customer. The threshold value h
                        2 thus equals 11 (regardless of d
                        2) under the PR policy for solution s17. Additionally, it can be seen from Fig. 2(a) that the probability of q ≤ 11 is 0.85. This means that the vehicle is very likely to return to the depot to reload after serving the second customer under the PR policy for solution s17.

On the other hand, Fig. 3(b) indicates that, under the PR policy for solution s21, the vehicle returns to the depot to reload only in the case when d
                        2 is 10:40 AM and q ≤ 2. This case occurs with probability 0.12 under the PR policy for solution s21 according to Fig. 2(b). This implies that in most cases the vehicle will proceed directly to the third customer after serving the second customer under the PR policy for solution s21.

To further investigate the reason for the difference between the PR policies for s17 and s21, the solution structures of s17 and s21 are displayed in Fig. 4.
                        
                     

In Fig. 4, two types of decisions that the vehicle can make after it visits the second customer are depicted: type 1 is to proceed directly to the third customer and type 2 is to return to the depot to reload before continuing to the third customer. For type 1 decision, if the vehicle capacity is exceeded at the third customer, the vehicle must travel back to the depot to reload. It can be seen from Fig. 4 that the difference between the costs of these two types of decisions is much larger for solution s17 than that for solution s21. For s17, this difference is 90 (70 + 50 + 50 − 30 − 50), while for s21, it is only 20 (30 + 40 + 40 − 50 − 40). Therefore, under the PR policy, the vehicle is more likely to make the type 2 decision in s17, while this decision may not be so beneficial and attractive for s21. This shows that the solution structure may affect the PR policy for a particular solution of RM.

In Section 5.1, the objective is to find a delivery route with minimum expected total cost, whereas the on-time delivery probabilities to the customers are ignored. In this section, PM was solved to search a delivery route which maximizes the sum of the on-time delivery probabilities to the four customers in Fig. 1. The possible solutions of PM using one vehicle are the same as those of RM listed in Table B.1 in Appendix B. The objective function values (i.e. the sum of on-time delivery probabilities to all customers) of these solutions of PM under the PR policy (Section 4.2) are displayed in Table 3
                        , as well as the percent improvement in objective function value generated by the PR policy over the DTD recourse policy.


                        Table 3 shows that the average percent improvement generated by the PR policy is less than 8 percent under all four customer demand distributions and is less than 2 percent under distribution PSD. Additionally, the percent improvement varies among some of the possible solutions of PM. For example, under distribution UD, the maximum percent improvement is 24.58 percent (s10, D-C
                        3-C
                        2-C
                        1-C
                        4-D), while no improvement is achieved for solutions s17–s24. This variation is discussed below, with solutions s10 and s19 (D-C
                        1-C
                        3-C
                        2-C
                        4-D) taken as examples. For s10, the sum of the on-time delivery probabilities from the second customer onward f
                        2, P, 2(q, d
                        2) is depicted in Fig. 5.
                        
                     


                        Fig. 5 shows that, when d
                        2 is 09:30AM, f
                        2, P, 2(q, d
                        2) equals 
                           
                              
                                 H
                                 
                                    2
                                    ,
                                    P
                                    ,
                                    2
                                 
                                 ′
                              
                              (
                              q
                              ,
                              
                                 d
                                 2
                              
                              )
                           
                         for all possible values of q. The optimal decision after the visit to the second customer is then to return to the depot to reload when d
                        2 is 09:30 AM, regardless of the value of q. Moreover, the probability that d
                        2 is 09:30 AM equals 0.85 as shown in Fig. 6
                        . The vehicle thus has a probability of 0.85 to return to the depot to reload after serving the second customer under the PR policy. This distinctly differs from the DTD recourse policy under which, after visiting the second customer, the vehicle returns to the depot to reload only when 
                           
                              q
                              =
                              0
                           
                        .

Note that in Fig. 5, since the departure time 11:10 AM is too late to meet the time windows of the remaining customers, the decision of whether or not to return to the depot at time 11:10 AM does not impact the objective function value of solution s10. More specifically, both H
                        2, P, 2(q, d
                        2) and 
                           
                              
                                 H
                                 
                                    2
                                    ,
                                    P
                                    ,
                                    2
                                 
                                 ′
                              
                              (
                              q
                              ,
                              
                                 d
                                 2
                              
                              )
                           
                         are equal to zero when d
                        2 is 11:10 AM. f
                        2, P, 2(q, d
                        2) is thus also equal to zero when d
                        2 is 11:10 AM.


                        Fig. 7
                         illustrates why the vehicle is likely to return to the depot to reload when d
                        2 is 09:30 AM under the PR policy for solution s10.

In Fig. 7, if the vehicle makes type 2 decision after leaving C
                        2 at 09:30 AM, it can still meet the time window of C
                        1. Type 2 decision is preferable to type 1 decision here because it can lower the probability of the vehicle capacity being exceeded at C
                        1 and thus increase the on-time delivery probability to C
                        1. Moreover, type 2 decision at C
                        2 does not impact the on-time delivery probability to C
                        4. The time window of C
                        4 cannot be met since the earliest possible departure time from C
                        1 is 10:00 AM and the earliest possible arrival time at C
                        4 is 11:10 AM.

Finally, solution s19 is taken as an example to examine why no improvement in objective function value is achieved by the PR policy for some of the possible solutions of PM (e.g. solutions s17–s24). The planned delivery route in solution s19 is shown in Fig. 8.
                        
                     


                        Fig. 8 shows that the first customer (C
                        1) along the planned delivery route in solution s19 has the latest time window among all four customers. As the vehicle has to wait until 10:00 AM at C
                        1, the earliest possible departure time from C
                        1 is 10:00 AM. This departure time is too late to meet the time windows of the remaining customers, regardless of the type of decision that the vehicle makes after leaving C
                        1. The PR policy is thus ineffective in this situation. Similar solution structures to that of s19 can be found in solutions such as s17, s18 and s20–s24.

In Table 3, s13 is the optimal solution to PM under the PR policy and customer demand distribution PSD. The on-time delivery probability to customer C
                        1 in s13 is 0.4 under the PR policy and distribution PSD. If C
                        1 requires an on-time delivery probability higher than 0.4, then s13 becomes infeasible.

In this section, RMPC was solved to determine the minimum number of vehicles required to satisfy the on-time delivery requirements of the four customers in Fig. 1. The required on-time delivery probability αi
                         for each customer Ci
                         was set equal to 0.8, 
                           
                              i
                              =
                              1
                              ,
                              2
                              ,
                              3
                              ,
                              4
                           
                        . The fixed cost f of employing one vehicle was set to 1000. Q was set to 15. λ
                        1i
                         was set to 0.5 and λ
                        2i
                         to 2, 
                           
                              i
                              =
                              1
                              ,
                              2
                              ,
                              3
                              ,
                              4
                           
                        . The possible solutions of RMPC using one vehicle are the same as those of RM listed in Table B.1 in Appendix B and possible solutions using two or three vehicles are listed in Table B.2 in Appendix B. The expected total costs (including fixed vehicle employment cost) of the feasible solutions of RMPC under different customer demand distributions and recourse policies are shown in Table 4.
                        
                     


                        Table 4 shows that in all four customer demand distribution cases, at least two vehicles are used to meet the customers’ on-time delivery requirements. Under distribution NSD and the DTD recourse policy, at least three vehicles must be used. It is also found in Table 4 that the number of feasible solutions may increase by applying the PR policy. For instance, under distribution UD, solutions s33 and s35 are feasible under the PR policy, while they are infeasible under the DTD recourse policy. Under distribution NSD, the use of the PR policy reduces the number of vehicles used in the feasible solutions of RMPC.

@&#CONCLUSIONS@&#

In this paper, the VRPSD-TW has been investigated with taking account of the on-time delivery issue and different recourse policies. Three probabilistic models have been proposed for the VRPSD-TW to address on-time delivery from different perspectives. RM and PM were formulated from the perspectives of the carrier and the customers, respectively. RMPC was proposed to minimize delivery cost, while satisfying customers’ on-time delivery requirements.

The PR policy has been shown to be applicable in the three models proposed for the VRPSD-TW. Under the traditional DTD recourse policy, the vehicle returns to the depot to reload only when it runs out of stock. However, under the PR policy, the vehicle can return to the depot to reload after visiting one customer, if its remaining capacity is less than a threshold value. The threshold values can be determined based on the customer demand distributions and the customer visiting sequence. This threshold structure makes the PR policy easy to implement.

To demonstrate the applicability of the proposed models and the RP policy, an illustrative example was conducted. The results of the illustrative example showed that the PR policy can help reduce the cost of the possible solutions of RM compared with the traditional DTD recourse policy, but it has a smaller impact on the possible solutions of PM. For both RM and PM, the effectiveness of the PR policy varies across different possible solutions and is affected by the solution structure. For RMPC, more vehicles may be required to meet customers’ on-time delivery requirements and the use of the PR policy may increase the number of feasible solutions and reduce the number of vehicles required.

The introduction of customer demand uncertainties and the PR policy poses severe computational challenges for solving the proposed models in larger problem instances. Recently, several exact or heuristic algorithms (Baldacci, Mingozzi, & Roberti, 2011; Beraldi et al., 2015; Gauvin, Desaulniers, & Gendreau, 2014; Goodson et al., 2012; Zhang et al., 2013) have been developed in the literature to solve problems that are closely related to the VRPSD-TW. How to extend these efficient solution algorithms for the proposed VRPSD-TW models is warranted for further study. In this study, a simple example was adopted to illustrate the essential ideas of this paper. Further studies are required to examine the performance of the proposed models and the effect of the PR policy in larger problem instances.

@&#ACKNOWLEDGMENTS@&#

The work described in this paper was supported by research grants from the Research Grants Council of the Hong Kong Special Administrative Region, China (Project No. PolyU 5181/13E), the Research Institute of Sustainable Urban Development of the Hong Kong Polytechnic University (1-ZVEW), and the National Natural Science Foundation of China (41571149 and 71471013). The first author was sponsored by a postgraduate stipend of the Hong Kong Polytechnic University when the work described in this paper was done. Thanks are due to three anonymous reviewers for their valuable comments that improved both the content and presentation of the paper.

Supplementary material associated with this article can be found, in the online version, at doi:10.1016/j.ejor.2015.08.050.


                     
                        
                           Image, application 1
                           
                        
                     
                  

@&#REFERENCES@&#

