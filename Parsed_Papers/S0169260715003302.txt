@&#MAIN-TITLE@&#Analysis and visualization of intracardiac electrograms in diagnosis and research: Concept and application of KaPAVIE

@&#HIGHLIGHTS@&#


               
               
                  
                     
                        
                           
                           Need for novel algorithms in diagnosis and treatment of cardiac arrhythmias.


                        
                        
                           
                           Combined development using MATLAB and C++ VTK library.


                        
                        
                           
                           Allows for rapid implementation of new algorithms.


                        
                        
                           
                           Interactive visualization of cardiac anatomy, measured data and analysis results.


                        
                        
                           
                           Promotes interdisciplinary research and discussion.


                        
                     
                  
               
            

@&#KEYPHRASES@&#

Intracardiac electrogram

Electroanatomical mapping

Visualization

Atrial fibrillation

Medical imaging

Diagnostic software

@&#ABSTRACT@&#


               
               
                  Background and objective
                  Progress in biomedical engineering has improved the hardware available for diagnosis and treatment of cardiac arrhythmias. But although huge amounts of intracardiac electrograms (EGMs) can be acquired during electrophysiological examinations, there is still a lack of software aiding diagnosis. The development of novel algorithms for the automated analysis of EGMs has proven difficult, due to the highly interdisciplinary nature of this task and hampered data access in clinical systems. Thus we developed a software platform, which allows rapid implementation of new algorithms, verification of their functionality and suitable visualization for discussion in the clinical environment.
               
               
                  Methods
                  A software for visualization was developed in Qt5 and C++ utilizing the class library of VTK. The algorithms for signal analysis were implemented in MATLAB. Clinical data for analysis was exported from electroanatomical mapping systems.
               
               
                  Results
                  The visualization software KaPAVIE (Karlsruhe Platform for Analysis and Visualization of Intracardiac Electrograms) was implemented and tested on several clinical datasets. Both common and novel algorithms were implemented which address important clinical questions in diagnosis of different arrhythmias. It proved useful in discussions with clinicians due to its interactive and user-friendly design. Time after export from the clinical mapping system to visualization is below 5min.
               
               
                  Conclusion
                  KaPAVIE
                        2
                     
                     
                        2
                        See http://www.ibt.kit.edu/hardundsoftware.php.
                      is a powerful platform for the development of novel algorithms in the clinical environment. Simultaneous and interactive visualization of measured EGM data and the results of analysis will aid diagnosis and help understanding the underlying mechanisms of complex arrhythmias like atrial fibrillation.
               
            

@&#INTRODUCTION@&#

Cardiovascular diseases are the most frequent cause of death in western societies. One focus of current medical research concentrates on atrial fibrillation (AFib), since it is both very common and the mechanisms behind it are only poorly understood [1]. Also complex tachycardias like atrial flutter pose a major problem to cardiologists [2,3]. Besides pharmacological treatment, catheter ablation emerges as an effective and potentially curative therapy for these arrhythmias. During electrophysiological (EP) studies, intracardiac electrograms are recorded from various multipolar catheters providing the basis for diagnosis and guiding the ablation. Using state-of-the-art systems, catheters with up to 64 poles each can be tracked in the heart and used for data acquisition, adding up to thousands of measurements within minutes [4]. Early work indicated the potential of approaches analyzing this kind of data [5], but only in recent years it received significant attention [6]. To understand the mechanisms behind AFib and deal with the amount of acquired data, novel algorithms are required which relate both the excitation pattern (rotor, foci, breakthrough) and the electrogram morphology [6–12]. These, however, cannot be installed and tested on the commercial systems due to safety reasons. Thus there is need to develop a platform which allows engineers and physicians to work together in implementing new algorithms and techniques to analyze the data. The subsequent visualization should promote a productive communication between clinicians and engineers. The engineers’ desire is to develop algorithms that produce relevant information. The results should be presented in a 3D visualization. Diagnostic relevance, however, needs to be discussed with the clinicians. Therefore, a tool is needed that provides a platform to link both the clinical and the technical perspective.

Projects addressing this issue comprise for example a software performing ripple-mapping [11] as novel diagnostic technique, and an open-source C++ based software platform by Cantwell et al., which offers algorithms like voltage and conduction velocity analysis in a modular design [13]. Since data analysis in research institutions is often done using MATLAB, it was our aim to develop a platform which combines both the visualization capabilities of the VTK (Visualization Toolkit) C++ class library and the intuitive algorithm development and debugging using MATLAB.

During EP studies, clinical data are often recorded using 3D mapping systems. These track catheters which are advanced into the atria and record their electrical information, along with the surface electrocardiogram (ECG). The acquired data also comprise the cardiac anatomy, given as triangulated surface meshes. In multi-channel simultaneous mapping, the position of all catheters and their electrodes is continuously recorded, along with the electrogram (EGM) acquired from each electrode. Recordings from different sites of the atrial wall can be acquired during sequential mapping, in which synchronization can be performed using a reference channel with stable location. This data is collected in form of maps, which can be used for analysis to either understand the cardiac excitation pattern (Local Activation Time (LAT) maps [2]) or the fractionation of the signals (CFE-maps [14]).

One system used in the cooperating clinical institutions is the EnSite Velocity mapping system (St. Jude, MN, USA), which acquires electrical information at a sampling rate of 2034.5Hz and tracks locations of electrodes with about 100Hz. All data from the EP study can be exported as XML and CSV files, respectively, using the built-in export functionality of the system and then be stored on DVD. Different types of preprocessing can be performed after import to MATLAB, depending on data quality and requirements of the subsequent analysis. It is also possible to utilize annotations carried out by the clinical mapping system. Power line or high frequency noise can be removed using corresponding filters in frequency domain [15], while special algorithms are required to reduce ventricular depolarization artifacts [16,17]. See Supplemental material for a typical processing pipeline.

One system used in the cooperating clinical institutions is the EnSite Velocity mapping system (St. Jude, MN, USA), which acquires electrical information at a sampling rate of 2034.5Hz and tracks locations of electrodes with about 100Hz. All data from the EP study can be exported as XML and CSV files, respectively, using the built-in export functionality of the system and then be stored on DVD. Different types of preprocessing can be performed after import to MATLAB, depending on data quality and requirements of the subsequent analysis. It is also possible to utilize annotations carried out by the clinical mapping system. Power line or high frequency noise can be removed using corresponding filters in frequency domain [15], while special algorithms are required to reduce ventricular depolarization artifacts [16,17]. See Supplemental material for a typical processing pipeline.

As a first step in data analysis, the coverage of the atrial surface by measurements is determined (Fig. 1
                        ). Electrode locations in space are projected on the atrial surface, areas around these projections are colored in green on the surface mesh, and areas more distant but still close are marked in yellow. Thus the total amount of covered area can be computed and visualized, indicating extent and density of the mapping. Areas labeled in red indicate that no corresponding measurement was acquired.

The amplitudes of EGMs span orders of magnitudes and are important parameters to characterize atrial tissue (Fig. 2
                        ). Studies have shown a good agreement between certain low signal amplitudes and the presence of fibrosis or scarring in the tissue [18], making it a diagnostically relevant parameter. Amplitude was determined as peak-to-peak value of the filtered EGM voltage value. While single deflections with huge amplitudes indicate the passing of a single wave front on healthy tissue, fractionated signals often show reduced amplitudes indicating areas of slow conduction [19], probably due to activation of smaller disparate regions. Also during ablation, the reduction in amplitude is a well-known parameter to evaluate the formation of lesions [20].

The local activation time (LAT) defines the point in time, at which the electrical excitation wave front passes the measuring catheter (see Fig. 2). It is a very important parameter to understand the underlying excitation pattern for example in a flutter circuit [2,3]. The intrinsic deflection in bipolar electrograms is a well-known indicator for the LAT [10,21]. In fractionated signals, assignment of LAT is not clear. Improvements in LAT determination include a combined analysis of uni- and bipolar signals, with bipolar signals defining the activation complex and unipolar signals assigning the passing excitation wave front [22]. In our workflow, an energy-based approach is applied, which can also be used if no unipolar data is available. Teager's non-linear energy operator is computed to provide a measure indicating the instantaneous energy E(t) of the EGM. Since it considers both amplitude and frequency of the signal, E(t) is maximal at steep slopes between high amplitude deflections. The time of maximum E(t) indicates the LAT, as simulations previously showed coincidence of both values [23,24].

Although LAT is widely used, it is merely a static image of one single cycle of flutter or one passing wave in fibrillation, and thus not usable for the visualization of dynamic processes. Other approaches have been proposed which aim at a time dependent visualization based on assigned LAT, phase values [6] or the visualization of measured voltage directly [11]. To improve the visualization of cardiac activity, an energy-based approach was implemented to visualize the time dynamic content of EGMs [7]. Therefore the energy-related quantity E(t) was computed for each EGM, normalized for the area under curve within one atrial cycle and mapped to the anatomy as a movie.

Targeting complex fractionated electrograms (CFAE) has been proposed as an alternative ablation strategy for atrial fibrillation [25]. However, procedure outcomes vary strongly in different centers, which might be due to a lack of quantitative standardization and the subsequent experience-based selection of CFAE for ablation. In order to reproduce and automate expert assessment, the application of classifiers was proposed. These combine multiple signal features from time and frequency domain, like the duration of active segments, number of inflection points, wavelet-based measures or morphological similarity [26,28]. In previous work, a fuzzy decision tree was implemented in MATLAB, trained and benchmarked using annotated CFAE signals. The categorical annotation in four classes hereby reflected different patterns of fractionation based on clinical multi-center experience [27,28].

The development of an optimal software needs a close cooperation between physicians and engineers. For both, the visualization of raw data as well as intermediate steps during the developing phase is crucial to optimize the algorithms. On top of this, the software should be able to handle different situations during the EP study. These are mainly the different catheter types and the necessity for manual adjustments due to individual particularities of the EP lab and the patient.

Two decisive issues considering the acceptance of this software are the rapid completion of processing and the ability to comfortably visualize the raw measured clinical data. Physicians need to have access to the raw EGM signals if the automatic analysis recommends a certain region for closer surveillance. To examine relations between intracardiac EGMs and the surface ECG as well as the intracardiac reference, these signals should be displayed synchronously. A 3D visualization of the atrial anatomy together with the positions of the measurement points helps to localize events. Furthermore, the EGMs should be scalable since the signals may cover two orders of magnitude. Color maps and value ranges need to be adjustable in correspondence to the clinical routine and data type. An indicator should link the currently displayed time stamp of the 3D animation and the EGM plot so that the user can follow the situation at its best.

With respect to signal processing, both the location of electrodes and their electrical information needed to be evaluated. Spatial analysis focused on the position of measurement electrodes, their stability over time and the amount of atrial surface covered by multiple measurements. The goal of EGM signal analysis was to extract diagnostically relevant features from the intracardiac EGMs. As outlined in Section 2, these comprised common parameters like signal amplitude and LAT, and novel measures such as morphological stability of subsequent excitation complexes or measures for the activity in the signal.

Signal processing and analysis was done via MATLAB (MATLAB version R2014b) [29], which is a high-performance technical computing environment and scripting language. Therefore it allows debugging of each step of analysis, and the available tools for visualization enable an intermediate look into the results during processing. MATLAB offers a large variety of well-proved algorithms and a huge research community for discussion. It also allows an easy way to incorporate algorithms implemented in prior or future work.

MATLAB scripts consisted of five sequential processing steps: Import of electroanatomical mapping data, rearranging the data for processing, filtering, processing itself and subsequent storage for visualization (see Supplemental material for details). Based on this workflow, several scripts were developed for specialized processing schemes (see Section 4.2). These scripts can be executed either independently from KaPAVIE or called directly from within the program. Other researchers are welcome to implement own processing schemes and algorithms, the functions to export MATLAB files for KaPAVIE import can be provided. Already developed MATLAB code was optimized so that the data for visualization can now be reliably generated within minutes.

MATLAB scripts consisted of five sequential processing steps: Import of electroanatomical mapping data, rearranging the data for processing, filtering, processing itself and subsequent storage for visualization (see Supplemental material for details). Based on this workflow, several scripts were developed for specialized processing schemes (see Section 4.2). These scripts can be executed either independently from KaPAVIE or called directly from within the program. Other researchers are welcome to implement own processing schemes and algorithms, the functions to export MATLAB files for KaPAVIE import can be provided. Already developed MATLAB code was optimized so that the data for visualization can now be reliably generated within minutes.

The exported files comprised three VTP files including atrial geometry, surface maps and EGM information. Geometrical data was saved as a polygonal mesh. The binary format was used to store electrogram data in a memory efficient way. An additional XML file was generated containing general information like version number and opacity as elements, or data specific settings for analysis results as elements with attributes like colormaps, value ranges and names.

To enable a collaborative algorithm development, the graphical user interface (GUI) was designed to facilitate the communication between clinicians and engineers [30]. Implementation was done using the Qt C++ UI framework (Qt version 5.3.0) [31]. Qt is open-source, enables cross-platform development, and allows for easy integration of fast responsive GUIs.

A combination of existing packages and self-implemented features was used to develop the GUI application and to fulfill the capabilities required by the cardiologists. The 3D graphic visualization of the cardiac anatomy is provided by an existing Qt-plugin distributed with the utilized VTK framework. The 2D plotting widget for the EGMs is an open source project, QCustomPlot [32], licensed under GPL.

By utilizing the VTK C++ framework (VTK version 6.1.0) [33], the visualization of the 3D geometry and the EGM sensor points were implemented as a VTK visualization pipeline (Fig. 3
                        ). The results are displayed in the VTK-Qt rendering widget.

Processed files can be imported via the VTK visualization pipeline. In detail, the VTK import process reads and combines the data to a VTK data object, which then is associated with a VTK mapper. The mapper is an interface to connect geometrical data to graphical primitives, which are then integrated to a rendering scene by a VTK actor. An actor controls several properties for visualization like coloring and rendering methods. The rendering scene is managed by a VTK renderer, which can hold several actors and is associated with certain interaction styles such as selecting actors, or translating and rotating of the camera perspective.

Spherical polygons were used to represent the measurement points. The corresponding EGM was added to the plotting window upon selection. The ability to select such spherical primitives was not a provided option of VTK. Therefore a custom interaction object was implemented, which connects mouse click events with a coloring and enlarging event of the spherical primitive along with the adding of the corresponding signal to the plot widget.

To ensure cross-platform compatibility and in order to promote usability for engineers and physicians, one of the main aspects considered during development was to support as many platforms as possible. Open source frameworks like Qt and VTK enable the compatibility to all common operating systems (Window, Mac, Linux).

With respect to transportability and requirements, the software does not need any manual configurations or changes of system settings in order to function properly. It can easily be executed in a common way directly in the installation directory. On Macintosh OS X the software was bundled into a single application (*.app) package and can thereby easily be transferred between different systems. For goal number one of the project, namely visualization of analysis results, no additional software is required on the utilized platform. If the complete analysis workflow is performed, a preinstalled MATLAB version is required on the system due to license limitations. Other research groups are welcome to use the current version of the software for free. Please contact the authors.

The GUI application KaPAVIE (Karlsruhe Platform for Analysis and Visualization of Intracardiac Electrograms) was designed so that the user can choose to either analyze new clinical data or just visualize already processed datasets. In the first case, the desired MATLAB analysis routine can be selected directly in KaPAVIE, analysis is started, and the results are saved and displayed (see Supplemental processing pipeline). In the latter case, files containing processed data can be selected for review purposes, discussion or publication.

The GUI application KaPAVIE (Karlsruhe Platform for Analysis and Visualization of Intracardiac Electrograms) was designed so that the user can choose to either analyze new clinical data or just visualize already processed datasets. In the first case, the desired MATLAB analysis routine can be selected directly in KaPAVIE, analysis is started, and the results are saved and displayed (see Supplemental processing pipeline). In the latter case, files containing processed data can be selected for review purposes, discussion or publication.

The results of signal processing for each measurement are visualized on the 3D atrial geometry in KaPAVIE. This allows the clinician to directly correlate analysis and anatomy. The user can select the desired map (LAT, atrial coverage, amplitude…), allowing to compare the diagnostic value of each approach and initial clinical annotations.

In order to relate analysis outcome and raw EGM data, arbitrary measurement locations can be selected and their EGMs plotted. Simultaneous visualization of selected EGM, reference EGM channel and surface ECG allows cardiologists to relate all data commonly used in diagnostic systems, considering also common settings for time axis visualization speed. EGM amplitudes can be normalized for qualitative analysis, displayed with their original magnitude or arbitrarily scaled by the user for a close-up look. A scale bar with the quantitative amplitude can be displayed in any mode.

To easily relate multiple EGMs and their recording positions, the same color is assigned to each graph and its electrode's representation. Uniform coloring can be turned on when merely focusing on EGM morphology.

Besides static maps, also propagation movies can be played in synchrony with the respective EGM. Properties like start and end time, loops and speed can be set and the resulting videos can be exported directly. This gives the user a variety of options to analyze the spatiotemporal relations hidden in EP data.

The software platform KaPAVIE was successfully applied in the clinical environment of two institutions. Data from ablation procedures of atrial flutter and atrial fibrillation were analyzed retrospectively, with all patients providing informed consent.

An example of clinical data loaded in the KaPAVIE GUI can be seen in Fig. 4
                           . A processing pipeline developed for atrial flutter data was applied to compute atrial coverage, amplitude, LAT and excitation movies as described in Sections 2.2–2.5. The interpretation of this case was complicated by previous ablation therapies including isolation of the pulmonary veins and additional ablation lines. The clinical LAT map demonstrated an excitation wave front from the left anterolateral mitral annulus toward the anterior wall to the septum (see Fig. 4A). Of note, the wave front was initially exciting only the lower part of the anterior wall. Two turning points can be located, a first anteroseptal and a second around the mitral valve. For a closer interpretation of these areas the original raw electrogram and additional information can be displayed and taken into account. This closer look revealed a low voltage area with double potentials on the anterior wall demonstrating a conduction block mainly related to the previous ablation line (see Fig. 4B). Comparison with the surface ECG allowed excluding the presence of ventricular far-field components. Therefore the only possible mechanism of this arrhythmia was a counterclockwise atrial flutter around the mitral valve (see Supplemental videos S1 and S2 for details and the dynamic representation as excitation movie).

An example of clinical data loaded in the KaPAVIE GUI can be seen in Fig. 4. A processing pipeline developed for atrial flutter data was applied to compute atrial coverage, amplitude, LAT and excitation movies as described in Sections 2.2–2.5. The interpretation of this case was complicated by previous ablation therapies including isolation of the pulmonary veins and additional ablation lines. The clinical LAT map demonstrated an excitation wave front from the left anterolateral mitral annulus toward the anterior wall to the septum (see Fig. 4A). Of note, the wave front was initially exciting only the lower part of the anterior wall. Two turning points can be located, a first anteroseptal and a second around the mitral valve. For a closer interpretation of these areas the original raw electrogram and additional information can be displayed and taken into account. This closer look revealed a low voltage area with double potentials on the anterior wall demonstrating a conduction block mainly related to the previous ablation line (see Fig. 4B). Comparison with the surface ECG allowed excluding the presence of ventricular far-field components. Therefore the only possible mechanism of this arrhythmia was a counterclockwise atrial flutter around the mitral valve (see Supplemental videos S1 and S2 for details and the dynamic representation as excitation movie).

The application of the platform for automatic signal classification can be seen in Fig. 5
                           . A novel algorithm was used to distinguish different types of signals based on the result of a fuzzy decision tree [28]. Signal processing and feature extraction were performed using previously developed MATLAB algorithms, which were incorporated in the toolset of available functions of the software platform (see Section 2.6). All EGMs were recorded in the left atrium, analyzed, and surrounding atrial regions colored accordingly. Signals located in blue and green regions exhibit little fractionation, whereas signals from yellow and red areas are expected to be increasingly fractionated. Representative EGMs were selected for visualization on the left hand side, starting with those from organized areas at the top. The increasing amount of fractionation and irregularity in the signals from top to bottom demonstrates an alternative interpretation of the intracardiac recordings during atrial fibrillation. This is an example of how novel algorithms can indicate potentially diagnostically relevant and previously hidden information directly in relation to the atrial anatomy.

@&#DISCUSSION@&#

Export and subsequent import of clinical data is currently implemented for the EnSite Velocity™ clinical mapping system. Time of processing is within minutes, depending on the type of analysis to be performed. The software is able to process an arbitrary number of channels, but the maximal number of recording channels of the 3D mapping system limits usage. During the development stage of new algorithms, MATLAB allows rapid implementation of new ideas, and results of analysis can be prepared and directly imported for discussion with the physicians. Processing can be performed using both standard settings and interactive user input. The KaPAVIE software is fast enough to provide important information to the physician without prolonging the procedure. This availability within minutes is a requirement often recommended for the development and applicability of novel algorithms [9,13].

Feedback from clinicians’ side was positive since usability was straightforward. Visualization of analysis results on the 3D atrial anatomy helped to comprehend the available data and focus attention. Simultaneous display of analysis results and original measurement data allows relating novel algorithms with the well-known aspects from electrophysiology.

The restriction to EnSite mapping data is a current limitation in application, which can be overcome when algorithms are available to import data from other mapping systems. To ease usage and interpretation, additional features like the display of propagation vectors, indication of simultaneously mapped positions, the ability to visualize time dependent electrode positions and tools like a signal probe were suggested for future versions.

Development of KaPAVIE was encouraged by a lack of available software to perform the required tasks. Although it is very well-known for algorithm development, direct visualization of 3D geometries in MATLAB with corresponding electrograms is slow and does not provide many options. Paraview is very frequently used in visualization but has problems in plotting electrogram data in a user-friendly way. Our approach was to develop a software utilizing the VTK class library. It allows calling MATLAB analysis routines directly and display the result after computation has finished.

Similar work was done by Linton et al. They developed a user-specific software to visualize the result of a specific novel technique called ripple-mapping [11]. However, the software is dedicated to this technique. Recent work from Cantwell et al. [13] introduced a module-based software, which allows the inclusion of in-house algorithms written in C++. The existing algorithms include but are not limited to voltage mapping, LAT assignment, fractionation measures and highly interesting concepts like conduction velocity mapping [10,24]. We decided to use MATLAB for algorithm development, since most engineers nowadays are familiar with this software, and development, optimization and verification is straightforward. This approach is also followed by other groups [9,34]. A significant interest in software-based diagnosis of atrial tachycardias has been stimulated by Narayan et al., who developed a software system to visualize cardiac excitation in panoramic mapping [6]. This, however, is a patent protected proprietary software solution, which only shows 2D data and neglects both the 3D nature of the anatomy and the underlying measurement data. Recent work by Karim et al. demonstrated unfolding the atrial surface from 3D to 2D, which allows for immediate grasping of all information from each side of the atrial chamber [35]. This is a promising concept which may very well be combined with the presented visualization platform. Long-term goal of all forecited work is an improved comprehension and treatment of cardiac arrhythmias [36]. In addition a contribution to better modeling of human physiology can be expected [37].

@&#CONCLUSIONS@&#

In this contribution, we presented the concept and application of the new software platform KaPAVIE for the analysis and visualization of intracardiac electroanatomical mapping data. It will enhance the collaboration between engineers and physicians, which is always difficult in interdisciplinary fields of research.

The current version of the software is freely available and will enable engineers to develop algorithms in the common and widely spread MATLAB environment, which is often used in both academia and research. The VTK C++ class library was incorporated due to its powerful visualization abilities, which is a very important aspect for mutual understanding.

The resulting software demonstrated the flexibility to successfully handle a variety of different scenarios occurring during clinical EP studies, comprising the import of electroanatomical mapping data, its analysis and visualization. Standard settings common in clinical practice make the application as user friendly as possible. Algorithms for biosignal analysis can be designed in collaborative workflow that incorporates the ideas emerging from clinical practice and fosters discussions between engineers and physicians. Simultaneous visualization of measured raw data and analysis results on the 3D anatomy allows physicians to improve comprehension by means of automatic signal processing and will promote diagnosis. KaPAVIE will allow the development and immediate application of novel algorithms, which hopefully will help to understand the mechanisms behind and facilitate treatment of complex cardiac arrhythmias.

The authors do not report competing interests.

@&#ACKNOWLEDGEMENTS@&#

The work of Tobias Oesterlein is funded by the German Research Foundation (DO637/14-1). The work of Jochen Schmid is funded by the German Research Foundation (DO637/17-1).

Supplementary data associated with this article can be found, in the online version, at http://dx.doi.org/10.1016/j.cmpb.2015.12.007.


                     
                        
                           
                        
                     
                     
                        
                           
                        
                     
                     
                        
                           
                        
                     
                  

@&#REFERENCES@&#

