@&#MAIN-TITLE@&#Scheduling pumpoff operations in onshore oilfields under electric-power constraints

@&#HIGHLIGHTS@&#


               
               
                  
                     
                        
                           
                           Models for scheduling pumpoff control operations in onshore oil fields.


                        
                        
                           
                           Cyclic behavior and system-wide power consumption are accounted for by the models.


                        
                        
                           
                           The models are based on scheduling conditions and column-based strategies.


                        
                        
                           
                           Computational analysis show that column-based models are more efficient and flexible.


                        
                        
                           
                           Models for reconfiguring operations are also proposed and analyzed.


                        
                     
                  
               
            

@&#KEYPHRASES@&#

OR in energy

Integer programming

Onshore oilfields

Sucker-rod pumping

Pumpoff scheduling

@&#ABSTRACT@&#


               
               
                  In onshore oilfields, several sucker-rod pumps are deployed over a large geographic area to lift oil from the bottom of production wells. Powered by electric rotary machines, the rod pumps operate according to cyclic control policies that alternate between on and off pumping periods which are designed to drive maximum production. This cyclic behavior gives rise to the problem of scheduling pumpoff operations in order to minimize the system power peak and thereby smoothen the power-consumption profile. To this end, this paper develops MILP formulations for the coordination of control policies and their reconfiguration during operations. Following a column-based approach or using integer variables to model the power-consumption profile, the resulting MILP formulations are put to the test in a host of synthetic, but representative oilfields.
               
            

@&#INTRODUCTION@&#

The development of an oilfield is a complex undertaking that extends for several years, evolving from the discovery of the reservoir to the planning of production facilities, well drilling, and production. Typical oilfields can cover large geographic areas with dozens of production and water-injection wells—the injection of water is applied to maintain the internal pressure of the reservoir. As the oilfield matures, artificial lifting techniques are required to bring the oil from the bottom of the wells to the surface where the multiphase flow of water, oil, and gas is separated and processed (Camponogara & Nakashima, 2006; Codas & Camponogara, 2012). The artificial-lifting technique adopted in an oilfield depends on a number of factors, such as the depth of the reservoir, the viscosity of the oil, and its location, whether being onshore or offshore.

In onshore fields, sucker-rod pumping is a widely applied technique for its relative low investment and maintenance cost, inherit flexibility, and variable production rate (Lake, 2007; Ordoñez, 2008; Ordoñez, Codas, & Moreno, 2009). A rod-pump system consists of a rotary machine connected to a plunger that runs inside the production tubing. In combination with the coordination of the opening and closing of valves, the alternating up-and-down movement of the plunger lifts a certain amount of oil to the surface (Thomas, 2001). When the oilfield matures, rod pumps operate according to pumpoff control policies that split the control cycle in on and off pumping periods. Such policies are implemented to allow the reservoir to replenish the fluids around the perforation zone of the well, preventing the plunger from hitting the well bottom with an empty chamber and thereby avoiding equipment damage.

Onshore oilfields are typically operated with several rod pumping units that draw electric energy from a power line and possibly share flowlines that connect wells to a processing station. In particular, the operation of oilfields located in remote areas to the north and northeast of Brazil are severely constrained by the limited electric-power supplied by the utility company (Ribeiro, 2012). These limitations give rise to the problem of scheduling pumpoff operations in order to minimize the system power peak. Besides stressing the power grid, an uneven system power-consumption profile induces oscillations in the flowlines which are transferred to the separation station. Related problems are found in the operation of offshore oilfields which instead consider the scheduling of electric submersible pumps (ESPs), such as in the Peregrino oilfield located off the coast of Brazil (Solbraekke, 2014).

Aiming at improving production operations of onshore oilfields, this work formalizes the problem of scheduling pumpoff operations so as to minimize the system power peak and to induce a smooth power-consumption profile. MILP formulations are developed for the scheduling problem following two principles, one based on integer variables and the other on column variables that define a feasible pumping profile over time. Akin to the scheduling of pumpoff operations, related problems in which binary variables play a major role are found in practice and the technical literature. A relevant problem is the scheduling of electric-power generating units to meet the forecast load and spinning reserve, while adhering to generator and transmission constraints, a class of problems collectively known as unit commitment (Bertsimas, Litvinov, Sun, Zhao, & Zheng, 2013; Hobbs, Rothkopf, O’Neill, & Hung-po Chao, 2001).

The paper is organized as follows. Section 2 presents the basic operation of rod pumps and introduces the problem of scheduling pumpoff operations. Section 3 introduces the concept of hyperperiod and formally defines the problem. Section 4 develops three Mixed-Integer Linear Programming (MILP) formulations for the scheduling problem. Section 5 presents the problem of adjusting pumpoff control policies in response to equipment failure and deviation from the nominal operation. Section 6 reports on results from computational analyses aimed at assessing the performance of the scheduling and rescheduling models. Finally, Section 7 offers a summary and suggests directions for future research.

Sucker-rod pumping is one the first artificial-lifting strategies to have been deployed in oilfields. Having a relative low investment and maintenance cost, rod pumping has found widespread application in mature onshore oilfields for its inherit flexibility and variable production rate (Bhatkar & Anwar, 2013; Ordoñez, 2008; Torres, Schnitman, & de Souza, 2013). The technique converts the energy of an electric- or combustion-powered rotary machine into the movement of a plunger that runs inside the well tubing. In combination with the coordinated opening and closing of the standing and traveling valves, the alternating up-and-down movement of the plunger lifts an amount of oil from the bottom of the production tubing up to the surface (Thomas, 2001). The main elements of a rod pumping production system are illustrated in Fig. 1.

The artificial lift with rod pumping consists of a cycle with two distinct phases: the upstroke and downstroke as illustrated in Fig. 2
                     . During the upstroke phase, the piston is elevated to the top part of the working barrel. At this moment, the traveling valve is closed due to the weight exerted by the oil in the production tubing, thereby reducing the pressure within the working barrel. The difference between this pressure and the pressure of the annulus at the perforations forces the standing valve to open, allowing oil from the reservoir to flow inside the working barrel. During the downstroke phase, the piston plunges down to the bottom of the well, exerting pressure on the standing valve which is forced to close. As a result, the piston compresses the oil inside the working barrel, forcing the traveling valve to open which in turn allows the oil to flow into the production tubing.

In reservoirs that have reached an advanced stage of maturity, the internal pressure at the well perforations is not sufficiently high to sustain the oil inflow into the working barrel for the continuous operation of the rod pump. The low pressure of the reservoir reduces production significantly and can damage the pumping unit if the piston hits an empty well bottom, an incident known as fluid-pound (Ordoñez, 2008).

A widely adopted solution to allow production under such levels of depletion consists in operating the rod pumps intermittently. The rotary machine is turned off for a predefined time interval until the fluids in the annulus reach an adequate level for production. At this point, the engine is turned on and production is sustained until the oil level in the annulus drops below the minimum for operation. This control strategy is known as pumpoff.

The pumpoff control strategy is defined by two parameters, t
                        on and t
                        off, which define the time the rotary machine is running and the time it is turned off, respectively. The pumpoff operation induces a repeating cycle of length 
                           
                              
                                 t
                                 c
                              
                              
                              =
                              
                              
                                 t
                                 on
                              
                              
                              +
                              
                              
                                 t
                                 off
                              
                              ,
                           
                         which alternates between pumping and not pumping intervals. Techniques are found in the literature to define the pumpoff control strategy (Westerman, 1977), but this is not the focus of this work. Here, the parameters defining pumpoff control are assumed known for each well. The focus is on the coordination of the control signals so as to induce a smooth profile of electric-power consumption for the entire oilfield.

Let 
                           
                              W
                              
                              =
                              
                              {
                              1
                              ,
                              …
                              ,
                              W
                              }
                           
                         be indices of the rod pumps operating in a given oilfield. Table 1
                         gives the parameters for each rod pump w of an illustrative oilfield, namely the pumping time 
                           
                              
                                 t
                                 w
                                 on
                              
                              ,
                           
                         the off pumping time 
                           
                              
                                 t
                                 w
                                 off
                              
                              ,
                           
                         the cycle time 
                           
                              
                                 t
                                 w
                                 c
                              
                              ,
                           
                         and the power Pw
                         drawn during pumping.

Time is divided in a set 
                           
                              T
                              
                              =
                              
                              {
                              0
                              ,
                              1
                              ,
                              …
                              ,
                              T
                              −
                              1
                              }
                           
                         of intervals. The control signal of each pump is held constant during the interval 
                           
                              [
                              t
                              ,
                              t
                              +
                              1
                              )
                              Δ
                              t
                           
                         for all 
                           
                              t
                              ∈
                              T
                           
                         where Δt is the interval length. Let ϕw
                        (t) ∈ {0, 1} denote the pumpoff control signal for a pump w according to a given policy, meaning that 
                           
                              
                                 ϕ
                                 w
                              
                              
                                 (
                                 t
                                 )
                              
                              
                              =
                              
                              1
                           
                         if the pump is working during the time window 
                           
                              [
                              t
                              ,
                              t
                              +
                              1
                              )
                              Δ
                              t
                           
                         and 
                           
                              
                                 ϕ
                                 w
                              
                              
                                 (
                                 t
                                 )
                              
                              
                              =
                              
                              0
                           
                         otherwise. Fig. 3 depicts the electric-power 
                           
                              
                                 P
                                 w
                              
                              
                                 (
                                 t
                                 )
                              
                              
                              =
                              
                              
                                 P
                                 w
                              
                              
                                 ϕ
                                 w
                              
                              
                                 (
                                 t
                                 )
                              
                           
                         drawn by each pump w. In the illustrative oilfield, unit 
                           
                              w
                              
                              =
                              
                              3
                           
                         will be pumping during the time window [0, 2), not producing during the window [2,5), and so forth in a cyclic manner.

Let P(t) denote the total power drawn by the pumping units during time interval t, namely 
                           
                              P
                              
                                 (
                                 t
                                 )
                              
                              =
                              
                                 ∑
                                 
                                    w
                                    ∈
                                    W
                                 
                              
                              
                                 P
                                 w
                              
                              
                                 (
                                 t
                                 )
                              
                              =
                              
                                 ∑
                                 
                                    w
                                    ∈
                                    W
                                 
                              
                              
                                 P
                                 w
                              
                              
                                 ϕ
                                 w
                              
                              
                                 (
                                 t
                                 )
                              
                           
                        . Fig. 4
                         depicts the total power drawn by the pumping units of the illustrative oilfield over a period of 30 minutes. This simple experiment brings about a complex behavior of the aggregated power-consumption profile, a behavior which is not easily related to the unit signals depicted in Fig. 3. Last but not least, the experiments show that the total power drawn is quite irregular without coordination of the control signals, with points of low consumption and peaks when several pumps are running simultaneously. Besides stressing the power grid, this uneven power profile incurs fluctuations in the flow lines which are transferred to the separation station. This undesirable behavior gives rise to the problem of scheduling the pumpoff operations by delaying the start time of each rod pump.

This work develops optimization-based strategies to optimally schedule the pumpoff operations with the goal of minimizing the power peaks. Besides preventing power-grid overload, such an objective reduces fluid oscillations in the separation station and the stress on the flow gathering system.

The coordination of pumpoff operations can be achieved by delaying the operation start time of each rod pump which, after this delay, will behave according to the cyclic regime given by the off and on pumping intervals. This coordination strategy does not affect the steady-state regime of the pumps which is established by the production engineers. In what follows, fundamental concepts are introduced and the problem of scheduling pumpoff operations is formalized.

The hyperperiod of a set of periodic tasks is the smallest time window necessary to capture the complete behavior of the system. This means that the system behavior becomes cyclic, repeating itself in each hyperperiod until the occurrence of an event that affects the tasks. Fig. 5
                         illustrates the hyperperiod of the rod pumps of the illustrative oilfield whose control policies are defined in Table 1: the vertical line at 30 minutes defines the transition from the first to the second hyperperiod. The hyperperiod corresponds to the Least Common Multiple (LCM) of the cycle times. Thus, the hyperperiod is 30 minutes for the rod pumps with cycles of length 2, 3, 5 and 10 minutes.

The scheduling of pumpoff operations is achieved by imposing an initial delay on the operation start time of each production unit. The delay of pump w is denoted by δw
                        , which is the time the pump will wait to start pumping according to its control cycle. The delay is implemented only at time 0, then cyclic behavior is reproduced onward.

However, the delay δw
                         should not exceed a given threshold for consistency and technical reasons. First, the cyclic behavior of a pump w in steady state will not be induced in the first cycles if the delay exceeds the limit, causing the system power-consumption profile during the first hyperperiod to differ from the succeeding hyperperiods (see Fig. 5). Second, any undue delay in production will translate into oilfield underproduction and incur a loss in revenues. Third, the decision space of the scheduling problem increases with the size of the domain for δw
                        , which invariably renders the resulting optimization problem harder to solve.

To illustrate the influence of the maximum delay, consider pump 3 of the illustrative oilfield given in Table 1. Fig. 6 presents the control signal ϕ
                        3(t) induced by an initial delay 
                           
                              
                                 δ
                                 3
                              
                              
                              =
                              
                              3
                           
                        . Notice that pump 3 has a cyclic behavior that repeats itself during the entire prediction horizon. On the other hand, Fig. 7 shows the behavior of the same pump when the delay is 
                           
                              
                                 δ
                                 3
                              
                              
                              =
                              
                              4
                           
                        . With a delay in excess of 3 units, the behavior during the first cycle does not match the cyclic behavior in steady-state conditions, unlike what was observed for a delay 
                           
                              
                                 δ
                                 3
                              
                              
                              =
                              
                              3
                           
                        .

The cyclic behavior of a pump w is ensured by the following condition:

                           
                              (1)
                              
                                 
                                    
                                       ϕ
                                       w
                                    
                                    
                                       (
                                       t
                                       )
                                    
                                    =
                                    
                                       ϕ
                                       w
                                    
                                    
                                       (
                                       t
                                       −
                                       
                                          t
                                          w
                                          c
                                       
                                       )
                                    
                                    ,
                                    
                                    ∀
                                    t
                                    ∈
                                    T
                                    ,
                                    
                                    t
                                    ≥
                                    
                                       t
                                       w
                                       c
                                    
                                    .
                                 
                              
                           
                        This condition states that the control signals in the first cycle univocally define the control signals of the following cycles. Further, the initial delay must not exceed a suitable threshold for the hyperperiod to remain representative of cyclic behavior, as illustrated
                         in Figs. 6 and 7. The bound on delay for a rod pump w must be:

                           
                              (2)
                              
                                 
                                    
                                       δ
                                       w
                                    
                                    ≤
                                    
                                       t
                                       w
                                       c
                                    
                                    −
                                    
                                       t
                                       w
                                       on
                                    
                                    =
                                    
                                       t
                                       w
                                       off
                                    
                                    =
                                    
                                       δ
                                       w
                                       max
                                    
                                    .
                                 
                              
                           
                        
                     

The mathematical model for scheduling pumpoff operations will have the control signal ϕw
                        (t) and delay δw
                         as the decision variables. Certain conditions on these variables are necessary to ensure a valid schedule:

                           
                              1.
                              the control signal must add up to the activation time 
                                    
                                       t
                                       w
                                       on
                                    
                                  during each cycle;

the control signal that activates pumping must be continuous.

Notice that if these conditions are met during the first cycle, then their validity for future cycles is implied by Eq. (1). In mathematical notation, the conditions 1 and 2 become

                           
                              (3a)
                              
                                 
                                    
                                       
                                          
                                             
                                                ∑
                                                
                                                   k
                                                   =
                                                   0
                                                
                                                
                                                   
                                                      t
                                                      w
                                                      c
                                                   
                                                   −
                                                   1
                                                
                                             
                                             
                                                
                                                   ϕ
                                                   w
                                                
                                                
                                                   (
                                                   k
                                                   )
                                                
                                             
                                          
                                       
                                       
                                          
                                             =
                                             
                                                t
                                                w
                                                on
                                             
                                          
                                       
                                    
                                 
                              
                           
                        
                        
                           
                              (3b)
                              
                                 
                                    
                                       
                                          
                                             
                                                ∑
                                                
                                                   k
                                                   =
                                                   
                                                      δ
                                                      w
                                                   
                                                
                                                
                                                   
                                                      δ
                                                      w
                                                   
                                                   +
                                                   
                                                      t
                                                      w
                                                      on
                                                   
                                                   −
                                                   1
                                                
                                             
                                             
                                                
                                                   ϕ
                                                   w
                                                
                                                
                                                   (
                                                   k
                                                   )
                                                
                                             
                                          
                                       
                                       
                                          
                                             =
                                             
                                                t
                                                w
                                                on
                                             
                                          
                                       
                                    
                                 
                              
                           
                        
                     

A mathematical formulation must fulfill the conditions established by Eqs. (2), (3a) and (3b) in order to define a valid schedule. In what follows the scheduling problem will be stated in a general form and later formalized in three distinct, but equivalent mathematical programming models. Before that, let us formalize the concept of hyperperiod.

Let 
                           
                              ϕ
                              
                                 (
                                 t
                                 )
                              
                              
                              =
                              
                              (
                              
                                 ϕ
                                 w
                              
                              
                                 (
                                 t
                                 )
                              
                              :
                              w
                              ∈
                              W
                              )
                           
                         be a vector with the control signals of all rod pumps operating in the oilfield. Further, let T
                        HP be the least common multiple of the pump cycles 
                           
                              
                                 t
                                 1
                                 c
                              
                              ,
                              …
                              ,
                              
                                 t
                                 W
                                 c
                              
                           
                        . The following theorem establishes the cyclic behavior of the system control signal 
                           ϕ
                        (t) with a cycle of length equal to the hyperperiod.

                           Theorem 1
                           
                              
                                 
                                    ϕ
                                    
                                       (
                                       t
                                       +
                                       
                                          T
                                          HP
                                       
                                       )
                                    
                                    
                                    =
                                    
                                    ϕ
                                    
                                       (
                                       t
                                       )
                                    
                                 
                               
                              for all t ≥ 0.
                           

Notice that it suffices to show that each elementary function ϕw
                              (t) will be cyclic with respect to the hyperperiod. For each pump w, it follows from the definition of ϕw
                              (t) and Eq. (1) that:

                                 
                                    (4)
                                    
                                       
                                          
                                             ϕ
                                             w
                                          
                                          
                                             (
                                             t
                                             )
                                          
                                          =
                                          
                                             ϕ
                                             w
                                          
                                          
                                             (
                                             t
                                             +
                                             
                                                
                                                   T
                                                   HP
                                                
                                                
                                                   t
                                                   w
                                                   c
                                                
                                             
                                             
                                                t
                                                w
                                                c
                                             
                                             )
                                          
                                          ,
                                          
                                          t
                                          =
                                          0
                                          ,
                                          1
                                          ,
                                          2
                                          ,
                                          …
                                       
                                    
                                 
                              because T
                              HP is a multiple of the pump cycle 
                                 
                                    t
                                    w
                                    c
                                 
                              . Lumping together for all 
                                 
                                    w
                                    ∈
                                    W
                                 
                               in a vector 
                                 
                                    ϕ
                                    
                                       (
                                       t
                                       )
                                    
                                    
                                    =
                                    
                                    
                                       (
                                       
                                          ϕ
                                          1
                                       
                                       ,
                                       
                                       
                                          ϕ
                                          2
                                       
                                       ,
                                       …
                                       ,
                                       
                                          ϕ
                                          W
                                       
                                       )
                                    
                                    
                                       (
                                       t
                                       )
                                    
                                    ,
                                 
                               yields:

                                 
                                    (5)
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      {
                                                      
                                                         
                                                            
                                                               
                                                                  
                                                                     ϕ
                                                                     1
                                                                  
                                                                  
                                                                     (
                                                                     t
                                                                     )
                                                                  
                                                                  =
                                                                  
                                                                     ϕ
                                                                     1
                                                                  
                                                                  
                                                                     (
                                                                     t
                                                                     +
                                                                     
                                                                        
                                                                           T
                                                                           HP
                                                                        
                                                                        
                                                                           t
                                                                           1
                                                                           c
                                                                        
                                                                     
                                                                     
                                                                        t
                                                                        1
                                                                        c
                                                                     
                                                                     )
                                                                  
                                                               
                                                            
                                                         
                                                         
                                                            
                                                               
                                                                  
                                                                     ϕ
                                                                     2
                                                                  
                                                                  
                                                                     (
                                                                     t
                                                                     )
                                                                  
                                                                  =
                                                                  
                                                                     ϕ
                                                                     2
                                                                  
                                                                  
                                                                     (
                                                                     t
                                                                     +
                                                                     
                                                                        
                                                                           T
                                                                           HP
                                                                        
                                                                        
                                                                           t
                                                                           2
                                                                           c
                                                                        
                                                                     
                                                                     
                                                                        t
                                                                        2
                                                                        c
                                                                     
                                                                     )
                                                                  
                                                               
                                                            
                                                         
                                                         
                                                            
                                                               
                                                                  ⋮
                                                                  
                                                                  =
                                                                  
                                                                  ⋮
                                                               
                                                            
                                                         
                                                         
                                                            
                                                               
                                                                  
                                                                     ϕ
                                                                     W
                                                                  
                                                                  
                                                                     (
                                                                     t
                                                                     )
                                                                  
                                                                  =
                                                                  
                                                                     ϕ
                                                                     W
                                                                  
                                                                  
                                                                     (
                                                                     t
                                                                     +
                                                                     
                                                                        
                                                                           T
                                                                           HP
                                                                        
                                                                        
                                                                           t
                                                                           W
                                                                           c
                                                                        
                                                                     
                                                                     
                                                                        t
                                                                        W
                                                                        c
                                                                     
                                                                     )
                                                                  
                                                               
                                                            
                                                         
                                                      
                                                   
                                                   ⇒
                                                   
                                                      {
                                                      
                                                         
                                                            
                                                               
                                                                  
                                                                     ϕ
                                                                     1
                                                                  
                                                                  
                                                                     (
                                                                     t
                                                                     )
                                                                  
                                                                  =
                                                                  
                                                                     ϕ
                                                                     1
                                                                  
                                                                  
                                                                     (
                                                                     t
                                                                     +
                                                                     
                                                                        T
                                                                        HP
                                                                     
                                                                     )
                                                                  
                                                               
                                                            
                                                         
                                                         
                                                            
                                                               
                                                                  
                                                                     ϕ
                                                                     2
                                                                  
                                                                  
                                                                     (
                                                                     t
                                                                     )
                                                                  
                                                                  =
                                                                  
                                                                     ϕ
                                                                     2
                                                                  
                                                                  
                                                                     (
                                                                     t
                                                                     +
                                                                     
                                                                        T
                                                                        HP
                                                                     
                                                                     )
                                                                  
                                                               
                                                            
                                                         
                                                         
                                                            
                                                               
                                                                  ⋮
                                                                  
                                                                  
                                                                  =
                                                                  
                                                                  ⋮
                                                               
                                                            
                                                         
                                                         
                                                            
                                                               
                                                                  
                                                                     ϕ
                                                                     W
                                                                  
                                                                  
                                                                     (
                                                                     t
                                                                     )
                                                                  
                                                                  =
                                                                  
                                                                     ϕ
                                                                     W
                                                                  
                                                                  
                                                                     (
                                                                     t
                                                                     +
                                                                     
                                                                        T
                                                                        HP
                                                                     
                                                                     )
                                                                  
                                                               
                                                            
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                          
                                             
                                                
                                                   
                                                   ⇒
                                                   ϕ
                                                   
                                                      (
                                                      t
                                                      )
                                                   
                                                   
                                                   =
                                                   
                                                   ϕ
                                                   
                                                      (
                                                      t
                                                      +
                                                      
                                                         T
                                                         HP
                                                      
                                                      )
                                                   
                                                   ,
                                                   t
                                                   
                                                   =
                                                   
                                                   0
                                                   ,
                                                   1
                                                   ,
                                                   2
                                                   ,
                                                   …
                                                   .
                                                   
                                                   □
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           

The scheduling problem consists in delaying the pumping operations in order to minimize the maximum electric-power peak, while ensuring the schedulability conditions (3). Formally, the problem is stated in mathematical programming as:

                           
                              (6a)
                              
                                 
                                    
                                       
                                          
                                             P
                                             :
                                             
                                                min
                                                
                                                   
                                                      ϕ
                                                      w
                                                   
                                                   
                                                      (
                                                      t
                                                      )
                                                   
                                                   ,
                                                   
                                                      δ
                                                      w
                                                   
                                                
                                             
                                          
                                       
                                       
                                          
                                             P
                                             max
                                          
                                       
                                    
                                 
                              
                           
                        
                        
                           
                              (6b)
                              
                                 
                                    
                                       
                                          
                                             s.t.
                                             :
                                          
                                       
                                       
                                          
                                             
                                                ∑
                                                
                                                   w
                                                   ∈
                                                   W
                                                
                                             
                                             
                                                P
                                                w
                                             
                                             
                                                ϕ
                                                w
                                             
                                             
                                                (
                                                t
                                                )
                                             
                                             ≤
                                             
                                                P
                                                max
                                             
                                             ,
                                             
                                             t
                                             ∈
                                             T
                                          
                                       
                                    
                                 
                              
                           
                        
                        
                           
                              (6c)
                              
                                 
                                    
                                       
                                       
                                          
                                             For
                                             
                                             all
                                             
                                             w
                                             ∈
                                             W
                                             :
                                          
                                       
                                    
                                    
                                       
                                       
                                          
                                             
                                                ϕ
                                                w
                                             
                                             
                                                (
                                                t
                                                )
                                             
                                             =
                                             
                                                ϕ
                                                w
                                             
                                             
                                                (
                                                t
                                                −
                                                
                                                   t
                                                   w
                                                   c
                                                
                                                )
                                             
                                             ,
                                             
                                             t
                                             ∈
                                             T
                                             ,
                                             
                                             t
                                             ≥
                                             
                                                t
                                                w
                                                c
                                             
                                          
                                       
                                    
                                 
                              
                           
                        
                        
                           
                              (6d)
                              
                                 
                                    
                                       
                                       
                                          
                                             
                                                ∑
                                                
                                                   t
                                                   =
                                                   0
                                                
                                                
                                                   
                                                      t
                                                      w
                                                      c
                                                   
                                                   −
                                                   1
                                                
                                             
                                             
                                                
                                                   ϕ
                                                   w
                                                
                                                
                                                   (
                                                   t
                                                   )
                                                
                                             
                                             =
                                             
                                                t
                                                w
                                                on
                                             
                                          
                                       
                                    
                                 
                              
                           
                        
                        
                           
                              (6e)
                              
                                 
                                    
                                       
                                       
                                          
                                             
                                                ∑
                                                
                                                   t
                                                   =
                                                   
                                                      δ
                                                      w
                                                   
                                                
                                                
                                                   
                                                      δ
                                                      w
                                                   
                                                   +
                                                   
                                                      t
                                                      w
                                                      on
                                                   
                                                   −
                                                   1
                                                
                                             
                                             
                                                
                                                   ϕ
                                                   w
                                                
                                                
                                                   (
                                                   t
                                                   )
                                                
                                             
                                             =
                                             
                                                t
                                                w
                                                on
                                             
                                          
                                       
                                    
                                 
                              
                           
                        
                        
                           
                              (6f)
                              
                                 
                                    
                                       
                                       
                                          
                                             
                                                δ
                                                w
                                             
                                             ≤
                                             
                                                δ
                                                w
                                                max
                                             
                                          
                                       
                                    
                                 
                              
                           
                        
                        
                           
                              (6g)
                              
                                 
                                    
                                       
                                       
                                          
                                             
                                                δ
                                                w
                                             
                                             ∈
                                             
                                                Z
                                                +
                                             
                                          
                                       
                                    
                                 
                              
                           
                        
                        
                           
                              (6h)
                              
                                 
                                    
                                       
                                       
                                          
                                             
                                                ϕ
                                                w
                                             
                                             
                                                (
                                                t
                                                )
                                             
                                             ∈
                                             
                                                {
                                                0
                                                ,
                                                1
                                                }
                                             
                                             ,
                                             
                                             t
                                             ∈
                                             T
                                          
                                       
                                    
                                 
                              
                           
                        which has a decision space with 
                           
                              (
                              W
                              +
                              W
                              T
                              )
                           
                         variables, W integer and WT binary, and approximately 
                           
                              (
                              T
                              +
                              W
                              T
                              +
                              3
                              W
                              )
                           
                         constraints.

This formulation serves the purpose of putting together the conditions and variables that define the scheduling problem. Because constraint (6e) is only defined for a discrete value of δw
                        , the relaxation of the integer variables does not render a well-defined relaxation (Wolsey, 1998). Thus 
                           P
                         is a conceptual formulation that does not allow the direct application of mathematical optimization algorithms. For instance, a spatial branch-and-bound relies on the iterative solution of relaxations that fix a subset of the discrete variables.

Constraint (6e) must be reformulated in a suitable form to allow the application of mathematical optimization algorithms. Two possibilities are the reformulation of (6e) as:

                           
                              •
                              a system of nonlinear differentiable functions; or

a system of linear inequalities, invariably using additional integer variables.

The first strategy is typically more compact and scales well with respect to problem size, however global optimization may be challenging and only a local optimum might be reached. Although the second strategy can introduce a large number of integer variables, mathematical optimization algorithms for MILP are more robust and can reach the global optimum. For this reason, this work will develop two models for linearizing constraint (6e).

This section develops MILP formulations for scheduling pumpoff operations.

This formulation introduces auxiliary variables and constraints to express the condition established by Eq. (3b) in a linear form. This condition ensures that the pumping operation is continuous within each cycle.

Specifically, the variable 
                           
                              
                                 y
                                 w
                              
                              
                                 (
                                 t
                                 )
                              
                              ∈
                              
                                 {
                                 0
                                 ,
                                 1
                                 }
                              
                              ,
                              
                              t
                              ∈
                              
                                 {
                                 0
                                 ,
                                 …
                                 ,
                                 
                                    δ
                                    w
                                    max
                                 
                                 −
                                 1
                                 }
                              
                              ,
                           
                         is defined for the periods of the first cycle during which the pumping operation can be delayed. When 
                           
                              
                                 y
                                 w
                              
                              
                                 (
                                 t
                                 )
                              
                              
                              =
                              
                              1
                           
                         the control signal ϕw
                        (t) univocally takes on value 0, thus the rod pump may be working only if 
                           
                              
                                 y
                                 w
                              
                              
                                 (
                                 t
                                 )
                              
                              
                              =
                              
                              0
                           
                        . Besides, if 
                           
                              
                                 y
                                 w
                              
                              
                                 (
                                 t
                                 )
                              
                              
                              =
                              
                              0
                           
                         then 
                           
                              
                                 y
                                 w
                              
                              
                                 (
                                 t
                                 +
                                 1
                                 )
                              
                              
                              =
                              
                              0
                           
                         whenever defined. Finally, the sum of the variables yw
                        (t) must correspond to the delay δw
                         for consistency reasons. This means that the signal yw
                        (t) will take on value 1 only for the initial periods during which the pump is inactive.

On the other hand, the variable 
                           
                              
                                 z
                                 w
                              
                              
                                 (
                                 t
                                 )
                              
                              ∈
                              
                                 {
                                 0
                                 ,
                                 1
                                 }
                              
                              ,
                              
                              t
                              
                              =
                              
                              
                                 t
                                 w
                                 on
                              
                              ,
                              …
                              ,
                              
                                 t
                                 w
                                 c
                              
                              
                              −
                              
                              1
                              ,
                           
                         is defined for the end periods of the first cycle, starting at 
                           
                              t
                              w
                              on
                           
                         until 
                           
                              
                                 t
                                 w
                                 c
                              
                              
                              −
                              
                              1
                           
                        . When 
                           
                              
                                 z
                                 w
                              
                              
                                 (
                                 t
                                 )
                              
                              
                              =
                              
                              1
                           
                         the control signal ϕw
                        (t) will be forced to take on value 0, however ϕw
                        (t) may assume any value otherwise. Also, once 
                           
                              
                                 z
                                 w
                              
                              
                                 (
                                 t
                                 )
                              
                              
                              =
                              
                              1
                           
                         all of the succeeding 
                           
                              
                                 z
                                 w
                              
                              
                                 (
                                 
                                    t
                                    ′
                                 
                                 )
                              
                              
                              =
                              
                              1
                           
                         for t′ > t, which ensures that zw
                        (t) will assume value 1 for the final periods of the cycle during which pump w is not running.

The resulting formulation consists of an MILP program:

                           
                              (7a)
                              
                                 
                                    
                                       
                                          
                                             
                                                P
                                                vb
                                             
                                             :
                                             
                                                min
                                                
                                                   θ
                                                   vb
                                                
                                             
                                             
                                             
                                                P
                                                max
                                             
                                          
                                       
                                    
                                 
                              
                           
                        
                        
                           
                              (7b)
                              
                                 
                                    
                                       
                                          
                                             
                                                s
                                                .
                                                t
                                                .
                                             
                                             :
                                          
                                       
                                       
                                          
                                             
                                                ∑
                                                
                                                   w
                                                   ∈
                                                   W
                                                
                                             
                                             
                                                
                                                   ϕ
                                                   w
                                                
                                                
                                                   (
                                                   t
                                                   )
                                                
                                                
                                                   P
                                                   w
                                                
                                             
                                             ≤
                                             
                                                P
                                                max
                                             
                                             ,
                                             t
                                             ∈
                                             T
                                          
                                       
                                    
                                 
                              
                           
                        
                        
                           
                              (7c)
                              
                                 
                                    
                                       
                                       
                                          
                                             For
                                             
                                             all
                                             
                                             w
                                             ∈
                                             W
                                             :
                                          
                                       
                                    
                                    
                                       
                                       
                                          
                                             
                                                ϕ
                                                w
                                             
                                             
                                                (
                                                t
                                                )
                                             
                                             =
                                             
                                                ϕ
                                                w
                                             
                                             
                                                (
                                                t
                                                −
                                                
                                                   t
                                                   w
                                                   c
                                                
                                                )
                                             
                                             ,
                                             t
                                             ∈
                                             T
                                             ,
                                             
                                             t
                                             ≥
                                             
                                                t
                                                w
                                                c
                                             
                                          
                                       
                                    
                                 
                              
                           
                        
                        
                           
                              (7d)
                              
                                 
                                    
                                       
                                       
                                          
                                             
                                                ∑
                                                
                                                   t
                                                   =
                                                   0
                                                
                                                
                                                   
                                                      t
                                                      w
                                                      c
                                                   
                                                   −
                                                   1
                                                
                                             
                                             
                                                
                                                   ϕ
                                                   w
                                                
                                                
                                                   (
                                                   t
                                                   )
                                                
                                             
                                             =
                                             
                                                t
                                                w
                                                on
                                             
                                          
                                       
                                    
                                 
                              
                           
                        
                        
                           
                              (7e)
                              
                                 
                                    
                                       
                                       
                                          
                                             {
                                             
                                                
                                                   
                                                      
                                                         
                                                            y
                                                            w
                                                         
                                                         
                                                            (
                                                            t
                                                            )
                                                         
                                                         ≥
                                                         
                                                            y
                                                            w
                                                         
                                                         
                                                            (
                                                            t
                                                            +
                                                            1
                                                            )
                                                         
                                                         ,
                                                         t
                                                         =
                                                         0
                                                         ,
                                                         …
                                                         ,
                                                         
                                                            δ
                                                            w
                                                            max
                                                         
                                                         −
                                                         2
                                                      
                                                   
                                                
                                                
                                                   
                                                      
                                                         
                                                            ϕ
                                                            w
                                                         
                                                         
                                                            (
                                                            t
                                                            )
                                                         
                                                         ≤
                                                         1
                                                         −
                                                         
                                                            y
                                                            w
                                                         
                                                         
                                                            (
                                                            t
                                                            )
                                                         
                                                         ,
                                                         t
                                                         =
                                                         0
                                                         ,
                                                         …
                                                         ,
                                                         
                                                            δ
                                                            w
                                                            max
                                                         
                                                         −
                                                         1
                                                      
                                                   
                                                
                                                
                                                   
                                                      
                                                         
                                                            ∑
                                                            
                                                               t
                                                               =
                                                               0
                                                            
                                                            
                                                               
                                                                  δ
                                                                  w
                                                                  max
                                                               
                                                               −
                                                               1
                                                            
                                                         
                                                         
                                                            
                                                               y
                                                               w
                                                            
                                                            
                                                               (
                                                               t
                                                               )
                                                            
                                                         
                                                         =
                                                         
                                                            δ
                                                            w
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           
                        
                        
                           
                              (7f)
                              
                                 
                                    
                                       
                                       
                                          
                                             {
                                             
                                                
                                                   
                                                      
                                                         
                                                            z
                                                            w
                                                         
                                                         
                                                            (
                                                            t
                                                            )
                                                         
                                                         ≤
                                                         
                                                            z
                                                            w
                                                         
                                                         
                                                            (
                                                            t
                                                            +
                                                            1
                                                            )
                                                         
                                                         ,
                                                         t
                                                         =
                                                         
                                                            t
                                                            w
                                                            on
                                                         
                                                         ,
                                                         …
                                                         ,
                                                         
                                                            t
                                                            w
                                                            c
                                                         
                                                         −
                                                         2
                                                      
                                                   
                                                
                                                
                                                   
                                                      
                                                         
                                                            ϕ
                                                            w
                                                         
                                                         
                                                            (
                                                            t
                                                            )
                                                         
                                                         ≤
                                                         1
                                                         −
                                                         
                                                            z
                                                            w
                                                         
                                                         
                                                            (
                                                            t
                                                            )
                                                         
                                                         ,
                                                         t
                                                         =
                                                         
                                                            t
                                                            w
                                                            on
                                                         
                                                         ,
                                                         …
                                                         ,
                                                         
                                                            t
                                                            w
                                                            c
                                                         
                                                         −
                                                         1
                                                      
                                                   
                                                
                                                
                                                   
                                                      
                                                         
                                                            ∑
                                                            
                                                               t
                                                               =
                                                               
                                                                  t
                                                                  w
                                                                  on
                                                               
                                                            
                                                            
                                                               
                                                                  t
                                                                  w
                                                                  c
                                                               
                                                               −
                                                               1
                                                            
                                                         
                                                         
                                                            
                                                               z
                                                               w
                                                            
                                                            
                                                               (
                                                               t
                                                               )
                                                            
                                                         
                                                         =
                                                         
                                                            δ
                                                            w
                                                            max
                                                         
                                                         −
                                                         
                                                            δ
                                                            w
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           
                        
                        
                           
                              (7g)
                              
                                 
                                    
                                       
                                       
                                          
                                             
                                                y
                                                w
                                             
                                             
                                                (
                                                t
                                                )
                                             
                                             ∈
                                             
                                                {
                                                0
                                                ,
                                                1
                                                }
                                             
                                             ,
                                             t
                                             =
                                             0
                                             ,
                                             …
                                             ,
                                             
                                                δ
                                                w
                                                max
                                             
                                             −
                                             1
                                          
                                       
                                    
                                 
                              
                           
                        
                        
                           
                              (7h)
                              
                                 
                                    
                                       
                                       
                                          
                                             
                                                z
                                                w
                                             
                                             
                                                (
                                                t
                                                )
                                             
                                             ∈
                                             
                                                {
                                                0
                                                ,
                                                1
                                                }
                                             
                                             ,
                                             t
                                             =
                                             
                                                t
                                                w
                                                on
                                             
                                             ,
                                             …
                                             ,
                                             
                                                t
                                                w
                                                c
                                             
                                             −
                                             1
                                          
                                       
                                    
                                 
                              
                           
                        
                        
                           
                              (7i)
                              
                                 
                                    
                                       
                                       
                                          
                                             
                                                δ
                                                w
                                             
                                             ≥
                                             0
                                          
                                       
                                    
                                 
                              
                           
                        
                        
                           
                              (7j)
                              
                                 
                                    
                                       
                                       
                                          
                                             
                                                ϕ
                                                w
                                             
                                             
                                                (
                                                t
                                                )
                                             
                                             ∈
                                             
                                                {
                                                0
                                                ,
                                                1
                                                }
                                             
                                             ,
                                             t
                                             =
                                             0
                                             ,
                                             …
                                             ,
                                             T
                                             −
                                             1
                                          
                                       
                                    
                                 
                              
                           
                        where 
                           
                              
                                 θ
                                 vb
                              
                              
                              =
                              
                              
                                 (
                                 
                                    P
                                    max
                                 
                                 ,
                                 y
                                 ,
                                 z
                                 ,
                                 δ
                                 ,
                                 ϕ
                                 )
                              
                           
                         is a vector with the decision variables, with 
                           
                              y
                              
                              =
                              
                              (
                              
                                 y
                                 w
                              
                              
                                 (
                                 t
                                 )
                              
                              :
                              w
                              ∈
                              W
                              ,
                              t
                              
                              =
                              
                              0
                              ,
                              …
                              ,
                              
                                 δ
                                 w
                                 max
                              
                              −
                              1
                              )
                              ,
                           
                        
                        
                           
                              z
                              
                              =
                              
                              (
                              
                                 z
                                 w
                              
                              
                                 (
                                 t
                                 )
                              
                              :
                              w
                              ∈
                              W
                              ,
                              t
                              
                              =
                              
                              
                                 t
                                 w
                                 on
                              
                              ,
                              …
                              ,
                              
                                 t
                                 w
                                 c
                              
                              −
                              1
                              )
                              ,
                           
                        
                        
                           
                              δ
                              
                              =
                              
                              (
                              
                                 δ
                                 w
                              
                              :
                              w
                              ∈
                              W
                              )
                              ,
                           
                         and 
                           
                              ϕ
                              
                              =
                              
                              (
                              
                                 ϕ
                                 w
                              
                              
                                 (
                                 t
                                 )
                              
                              :
                              w
                              ∈
                              W
                              ,
                              t
                              ∈
                              T
                              )
                           
                        .

The number of variables is bounded by 
                           
                              W
                              (
                              
                                 δ
                                 max
                              
                              +
                              
                                 t
                                 
                                    off
                                 
                                 max
                              
                              +
                              1
                              +
                              T
                              )
                              +
                              1
                              ,
                           
                         out of which at most 
                           
                              W
                              (
                              
                                 δ
                                 max
                              
                              +
                              
                                 t
                                 
                                    off
                                 
                                 max
                              
                              +
                              T
                              )
                           
                         are binary and the remaining continuous, where 
                           
                              
                                 δ
                                 max
                              
                              
                              =
                              
                              max
                              
                                 {
                                 
                                    δ
                                    w
                                    max
                                 
                                 :
                                 w
                                 ∈
                                 W
                                 }
                              
                           
                         and 
                           
                              
                                 t
                                 
                                    off
                                 
                                 max
                              
                              
                              =
                              
                              max
                              
                                 {
                                 
                                    t
                                    w
                                    off
                                 
                                 :
                                 w
                                 ∈
                                 W
                                 }
                              
                           
                        . The number of constraints is bounded by 
                           
                              T
                              +
                              W
                              (
                              T
                              +
                              3
                              +
                              2
                              
                                 δ
                                 max
                              
                              +
                              2
                              
                                 t
                                 
                                    off
                                 
                                 max
                              
                              )
                           
                        .

The objective (7a) seeks to minimize the maximum power peak P
                        max  defined in Eq. (7b).

Constraint (7c) imposes the cyclic behavior of each pump w, which should repeat the pattern of the first cycle. Constraint (7d) ensures that pump w will be running for 
                           
                              t
                              w
                              on
                           
                         units of time, which implies in not operating for 
                           
                              
                                 t
                                 w
                                 off
                              
                              
                              =
                              
                              
                                 t
                                 w
                                 c
                              
                              
                              −
                              
                              
                                 t
                                 w
                                 on
                              
                           
                         units of time.

Constraint set (7e) ensures that the control signal ϕw
                        (t) assumes value 0 during δw
                         units of time at the beginning of the first cycle. Likewise, constraint set (7f) makes sure that ϕw
                        (t) assume value 0 during 
                           
                              
                                 δ
                                 w
                                 max
                              
                              
                              −
                              
                              
                                 δ
                                 w
                              
                           
                         units at the end of the first cycle. Together with constraint (7d), these constraints ensure that pump w will be running for 
                           
                              t
                              
                                 w
                              
                              on
                           
                         units of time consecutively during the first cycle, since the pump will not run for 
                           
                              
                                 (
                                 
                                    δ
                                    w
                                    max
                                 
                                 −
                                 
                                    δ
                                    w
                                 
                                 )
                              
                              +
                              
                                 δ
                                 w
                              
                              
                              =
                              
                              
                                 δ
                                 w
                                 max
                              
                              
                              =
                              
                              
                                 t
                                 
                                    w
                                 
                                 off
                              
                           
                         units of time at the beginning and at the end of the first cycle.

Notice that the bound 
                           
                              
                                 δ
                                 w
                              
                              
                              ≤
                              
                              
                                 δ
                                 w
                                 max
                              
                           
                         is induced by the last constraint of (7e). Further, this constraint and the integer nature of yw
                        (t) ensure the integrality of δw
                        .

The arguments above lead to the following proposition.

                           Proposition 1
                           
                              The variable-based formulation
                              
                                 
                                    P
                                    vb
                                 
                               
                              is an MILP program which is equivalent to problem
                              
                                 P
                              
                              .
                           

The column-based approach represents all of the feasible profiles of a given pump, referred to as “columns,” which are then associated to binary variables. This alternative formulation can be viewed as a variation of the set covering problem. Since the full behavior of a pump w is defined by its control signal during the first cycle, it suffices to introduce a column for each possible value of the delay δw
                        . Also, the space of decision variables can be reduced to a logarithmic factor of the number of columns by using a logarithmic encoding.

For the scheduling problem, the columns are easily generated off-line by simple enumeration: it consists in defining the profile of pump w for each value 
                              
                                 
                                    δ
                                    w
                                 
                                 ∈
                                 
                                    {
                                    0
                                    ,
                                    …
                                    ,
                                    
                                       δ
                                       w
                                       max
                                    
                                    }
                                 
                              
                           . In more complex problems, column generation is carried out on demand, possibly involving the solution of a constraint satisfaction problem or an MILP problem to generate an improving column. For instance, a column is generated by solving a knapsack problem in the cutting stock problem (Gilmore & Gomory, 1961). For a pump 
                              
                                 w
                                 ∈
                                 W
                                 ,
                              
                            the profile induced by delay δw
                            is represented by a vector 
                              
                                 
                                    x
                                    
                                       w
                                       ,
                                       
                                          δ
                                          w
                                       
                                    
                                 
                                 ∈
                                 
                                    
                                       {
                                       0
                                       ,
                                       1
                                       }
                                    
                                    
                                       t
                                       w
                                       c
                                    
                                 
                              
                            such that its entries are defined as follows:

                              
                                 •
                                 
                                    
                                       
                                          
                                             x
                                             t
                                             
                                                w
                                                ,
                                                
                                                   δ
                                                   w
                                                
                                             
                                          
                                          =
                                          0
                                       
                                     for 
                                       
                                          t
                                          =
                                          0
                                          ,
                                          1
                                          ,
                                          …
                                          ,
                                          
                                             δ
                                             w
                                          
                                          −
                                          1
                                          ,
                                       
                                    
                                 


                                    
                                       
                                          
                                             x
                                             t
                                             
                                                w
                                                ,
                                                
                                                   δ
                                                   w
                                                
                                             
                                          
                                          =
                                          1
                                       
                                     for 
                                       
                                          t
                                          =
                                          
                                             δ
                                             w
                                          
                                          ,
                                          
                                             δ
                                             w
                                          
                                          +
                                          1
                                          ,
                                          …
                                          ,
                                          
                                             δ
                                             w
                                          
                                          +
                                          
                                             t
                                             w
                                             on
                                          
                                          −
                                          1
                                          ,
                                       
                                     and


                                    
                                       
                                          
                                             x
                                             t
                                             
                                                w
                                                ,
                                                
                                                   δ
                                                   w
                                                
                                             
                                          
                                          =
                                          0
                                       
                                     for 
                                       
                                          t
                                          =
                                          
                                             δ
                                             w
                                          
                                          +
                                          
                                             t
                                             w
                                             on
                                          
                                          ,
                                          …
                                          ,
                                          
                                             t
                                             w
                                             c
                                          
                                          −
                                          1
                                          ,
                                       
                                    
                                 

which defines the state of pump w over the first cycle, and consequently the future behavior. For pump 
                              
                                 w
                                 
                                 =
                                 
                                 3
                              
                            of the illustrative example, in which 
                              
                                 
                                    t
                                    
                                       w
                                    
                                    on
                                 
                                 
                                 =
                                 
                                 2
                              
                            and 
                              
                                 
                                    t
                                    
                                       w
                                    
                                    off
                                 
                                 
                                 =
                                 
                                 3
                                 ,
                              
                            the profile induced by 
                              
                                 
                                    δ
                                    w
                                 
                                 
                                 =
                                 
                                 2
                              
                            is 
                              
                                 
                                    x
                                    
                                       3
                                       ,
                                       2
                                    
                                 
                                 
                                 =
                                 
                                 
                                    
                                       [
                                       
                                          0
                                          
                                          0
                                          
                                          1
                                          
                                          1
                                          
                                          0
                                       
                                       ]
                                    
                                    ′
                                 
                              
                            where 0 indicates off pumping and 1 on pumping. Having introduced the above notation, the column-based formulation of the scheduling problem is given by:

                              
                                 (8a)
                                 
                                    
                                       
                                          
                                             
                                                
                                                   P
                                                   cb
                                                
                                                :
                                                
                                                   min
                                                   
                                                      θ
                                                      cb
                                                   
                                                
                                                
                                                
                                                   P
                                                   max
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           
                           
                              
                                 (8b)
                                 
                                    
                                       
                                          
                                             
                                                s
                                                .
                                                t
                                                .
                                                :
                                             
                                          
                                          
                                             
                                                
                                                   ∑
                                                   
                                                      w
                                                      ∈
                                                      W
                                                   
                                                
                                                
                                                   
                                                      P
                                                      w
                                                   
                                                   
                                                      ϕ
                                                      w
                                                   
                                                   
                                                      (
                                                      t
                                                      )
                                                   
                                                
                                                ≤
                                                
                                                   P
                                                   max
                                                
                                                ,
                                                t
                                                ∈
                                                T
                                             
                                          
                                       
                                    
                                 
                              
                           
                           
                              
                                 (8c)
                                 
                                    
                                       
                                          
                                          
                                             
                                                For
                                                
                                                all
                                                
                                                w
                                                ∈
                                                W
                                                :
                                             
                                          
                                       
                                       
                                          
                                          
                                             
                                                
                                                   x
                                                   w
                                                
                                                =
                                                
                                                   ∑
                                                   
                                                      δ
                                                      ∈
                                                      
                                                         D
                                                         w
                                                      
                                                   
                                                
                                                
                                                   x
                                                   
                                                      w
                                                      ,
                                                      δ
                                                   
                                                
                                                
                                                   b
                                                   
                                                      w
                                                      ,
                                                      δ
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           
                           
                              
                                 (8d)
                                 
                                    
                                       
                                          
                                          
                                             
                                                
                                                   ∑
                                                   
                                                      δ
                                                      ∈
                                                      
                                                         D
                                                         w
                                                      
                                                   
                                                
                                                
                                                   b
                                                   
                                                      w
                                                      ,
                                                      δ
                                                   
                                                
                                                =
                                                1
                                             
                                          
                                       
                                    
                                 
                              
                           
                           
                              
                                 (8e)
                                 
                                    
                                       
                                          
                                          
                                             
                                                
                                                   ϕ
                                                   w
                                                
                                                
                                                   (
                                                   t
                                                   )
                                                
                                                =
                                                
                                                   x
                                                   t
                                                   w
                                                
                                                ,
                                                t
                                                =
                                                0
                                                ,
                                                …
                                                ,
                                                
                                                   t
                                                   w
                                                   c
                                                
                                                −
                                                1
                                             
                                          
                                       
                                    
                                 
                              
                           
                           
                              
                                 (8f)
                                 
                                    
                                       
                                          
                                          
                                             
                                                
                                                   ϕ
                                                   w
                                                
                                                
                                                   (
                                                   t
                                                   )
                                                
                                                =
                                                
                                                   ϕ
                                                   w
                                                
                                                
                                                   (
                                                   t
                                                   −
                                                   
                                                      t
                                                      w
                                                      c
                                                   
                                                   )
                                                
                                                ,
                                                t
                                                ∈
                                                T
                                                ,
                                                
                                                t
                                                ≥
                                                
                                                   t
                                                   w
                                                   c
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           
                           
                              
                                 (8g)
                                 
                                    
                                       
                                          
                                          
                                             
                                                
                                                   δ
                                                   w
                                                
                                                =
                                                
                                                   ∑
                                                   
                                                      δ
                                                      ∈
                                                      
                                                         D
                                                         w
                                                      
                                                   
                                                
                                                
                                                   b
                                                   
                                                      w
                                                      ,
                                                      δ
                                                   
                                                
                                                δ
                                             
                                          
                                       
                                    
                                 
                              
                           
                           
                              
                                 (8h)
                                 
                                    
                                       
                                          
                                          
                                             
                                                
                                                   b
                                                   
                                                      w
                                                      ,
                                                      δ
                                                   
                                                
                                                ∈
                                                
                                                   {
                                                   0
                                                   ,
                                                   1
                                                   }
                                                
                                                ,
                                                δ
                                                ∈
                                                
                                                   D
                                                   w
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           where 
                              
                                 
                                    D
                                    w
                                 
                                 
                                 =
                                 
                                 
                                    {
                                    0
                                    ,
                                    …
                                    ,
                                    
                                       δ
                                       w
                                       max
                                    
                                    }
                                 
                              
                            and 
                              
                                 
                                    θ
                                    cb
                                 
                                 
                                 =
                                 
                                 
                                    (
                                    
                                       P
                                       max
                                    
                                    ,
                                    x
                                    ,
                                    ϕ
                                    ,
                                    δ
                                    ,
                                    b
                                    )
                                 
                              
                            is the vector of decision variables, with 
                              
                                 x
                                 
                                 =
                                 
                                 (
                                 
                                    x
                                    w
                                 
                                 :
                                 w
                                 ∈
                                 W
                                 )
                                 ,
                              
                           
                           
                              
                                 b
                                 
                                 =
                                 
                                 (
                                 
                                    b
                                    
                                       w
                                       ,
                                       δ
                                    
                                 
                                 :
                                 w
                                 ∈
                                 W
                                 ,
                                 δ
                                 ∈
                                 
                                    D
                                    w
                                 
                                 )
                                 ,
                              
                            and 
                              ϕ
                            and 
                              δ
                            defined as before. The binary variable b
                           
                              w, δ
                            takes on value 1 if the profile given by x
                           
                              w, δ
                            is chosen for the operation of pump w, otherwise it assumes value 0.

The number of variables is bounded by 
                              
                                 W
                                 (
                                 
                                    t
                                    
                                       c
                                    
                                    max
                                 
                                 +
                                 T
                                 +
                                 1
                                 +
                                 
                                    δ
                                    max
                                 
                                 )
                                 
                                 +
                                 
                                 1
                                 ,
                              
                            out of which at most Wδ
                           max  are integer, where 
                              
                                 
                                    t
                                    
                                       c
                                    
                                    max
                                 
                                 
                                 =
                                 
                                 max
                                 
                                    {
                                    
                                       t
                                       
                                          w
                                       
                                       c
                                    
                                    :
                                    w
                                    ∈
                                    W
                                    }
                                 
                              
                           . The number of constraints is bounded by 
                              
                                 T
                                 +
                                 W
                                 (
                                 
                                    t
                                    
                                       c
                                    
                                    max
                                 
                                 +
                                 T
                                 +
                                 2
                                 )
                              
                           .

By construction, the profiles x
                           
                              w, δ
                            define the cyclic behavior of pump w for each feasible delay δ. This leads to the following proposition.

                              Proposition 2
                              
                                 The column-based formulation
                                 
                                    
                                       P
                                       cb
                                    
                                  
                                 is an MILP program that is equivalent to problem
                                 
                                    P
                                 
                                 .
                              

A reduction on the number of binary variables is achievable by representing b
                           
                              w, δ
                            with a logarithmic code, akin to the logarithmic models for piecewise-linear function approximation (Silva & Camponogara, 2014; Vielma, Ahmed, & Nemhauser, 2010). For a pump w, the codification is induced by the binary variables λ
                           
                              w, l
                            ∈ {0, 1}, 
                              
                                 l
                                 ∈
                                 
                                    L
                                    w
                                 
                                 
                                 =
                                 
                                 
                                    {
                                    0
                                    ,
                                    …
                                    ,
                                    
                                       L
                                       w
                                    
                                    −
                                    1
                                    }
                                 
                              
                            where 
                              
                                 
                                    L
                                    w
                                 
                                 
                                 =
                                 
                                 
                                    ⌈
                                    
                                       log
                                       2
                                    
                                    
                                       (
                                       
                                          δ
                                          w
                                          max
                                       
                                       +
                                       1
                                       )
                                    
                                    ⌉
                                 
                              
                           . The binary variable λ
                           
                              w, l
                            can be viewed as the branch decision in a decision tree with l being the depth: 
                              
                                 
                                    λ
                                    
                                       w
                                       ,
                                       l
                                    
                                 
                                 
                                 =
                                 
                                 0
                              
                            indicates branching to the left, whereas 
                              
                                 
                                    λ
                                    
                                       w
                                       ,
                                       l
                                    
                                 
                                 
                                 =
                                 
                                 1
                              
                            indicates branching to the right.

For the sake of illustration, consider a pump w with 
                              
                                 
                                    δ
                                    w
                                    max
                                 
                                 
                                 =
                                 
                                 3
                              
                            which implies 
                              
                                 
                                    L
                                    w
                                 
                                 
                                 =
                                 
                                 2
                              
                            and 
                              
                                 
                                    L
                                    w
                                 
                                 
                                 =
                                 
                                 
                                    {
                                    0
                                    ,
                                    1
                                    }
                                 
                              
                           . A coding for the profiles of this pump is given below:


                           
                              
                                 
                                    
                                    
                                    
                                       
                                          
                                             
                                                
                                                   (
                                                   
                                                      λ
                                                      
                                                         w
                                                         ,
                                                         1
                                                      
                                                   
                                                   ,
                                                   
                                                      λ
                                                      
                                                         w
                                                         ,
                                                         0
                                                      
                                                   
                                                   )
                                                
                                             
                                          
                                          Profile
                                       
                                    
                                    
                                       
                                          
                                             
                                                
                                                   (
                                                   0
                                                   ,
                                                   0
                                                   )
                                                
                                             
                                          
                                          
                                             
                                                
                                                   x
                                                   
                                                      w
                                                      ,
                                                      0
                                                   
                                                
                                             
                                          
                                       
                                       
                                          
                                             
                                                
                                                   (
                                                   1
                                                   ,
                                                   0
                                                   )
                                                
                                             
                                          
                                          
                                             
                                                
                                                   x
                                                   
                                                      w
                                                      ,
                                                      1
                                                   
                                                
                                             
                                          
                                       
                                       
                                          
                                             
                                                
                                                   (
                                                   0
                                                   ,
                                                   1
                                                   )
                                                
                                             
                                          
                                          
                                             
                                                
                                                   x
                                                   
                                                      w
                                                      ,
                                                      2
                                                   
                                                
                                             
                                          
                                       
                                       
                                          
                                             
                                                
                                                   (
                                                   1
                                                   ,
                                                   1
                                                   )
                                                
                                             
                                          
                                          
                                             
                                                
                                                   x
                                                   
                                                      w
                                                      ,
                                                      3
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           
                        

Given a pump w, let 
                              
                                 
                                    D
                                    w
                                    
                                       1
                                       ,
                                       l
                                    
                                 
                                 ⊆
                                 
                                    D
                                    w
                                 
                              
                            be indices of the profiles for which the coding 
                              
                                 
                                    λ
                                    w
                                 
                                 
                                 =
                                 
                                 
                                    (
                                    
                                       λ
                                       
                                          w
                                          ,
                                          
                                             L
                                             w
                                          
                                          −
                                          1
                                       
                                    
                                    ,
                                    …
                                    ,
                                    
                                       λ
                                       
                                          w
                                          ,
                                          0
                                       
                                    
                                    )
                                 
                              
                            has value 1 at position l, whereas 
                              
                                 D
                                 w
                                 
                                    0
                                    ,
                                    l
                                 
                              
                            is the subset of those with 0 at position l. Notice that 
                              
                                 
                                    D
                                    w
                                    
                                       0
                                       ,
                                       l
                                    
                                 
                                 ∪
                                 
                                    D
                                    w
                                    
                                       1
                                       ,
                                       l
                                    
                                 
                                 
                                 =
                                 
                                 
                                    D
                                    w
                                 
                              
                           . In the example given above, 
                              
                                 
                                    D
                                    w
                                    
                                       0
                                       ,
                                       1
                                    
                                 
                                 
                                 =
                                 
                                 
                                    {
                                    0
                                    ,
                                    
                                    2
                                    }
                                 
                              
                            and 
                              
                                 
                                    D
                                    w
                                    
                                       1
                                       ,
                                       1
                                    
                                 
                                 
                                 =
                                 
                                 
                                    {
                                    1
                                    ,
                                    
                                    3
                                    }
                                 
                              
                           .

Based on the above notation, the column-based formulation can be reformulated in the following equivalent form:

                              
                                 (9a)
                                 
                                    
                                       
                                          
                                             
                                                
                                                   P
                                                   
                                                      cb
                                                   
                                                   log
                                                
                                                :
                                                
                                                   min
                                                   
                                                      θ
                                                      
                                                         cb
                                                      
                                                      log
                                                   
                                                
                                                
                                                
                                                   P
                                                   max
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           
                           
                              
                                 (9b)
                                 
                                    
                                       
                                          
                                             
                                                s
                                                .
                                                t
                                                .
                                                :
                                             
                                          
                                          
                                             
                                                
                                                   ∑
                                                   
                                                      w
                                                      ∈
                                                      W
                                                   
                                                
                                                
                                                   
                                                      P
                                                      w
                                                   
                                                   
                                                      ϕ
                                                      w
                                                   
                                                   
                                                      (
                                                      t
                                                      )
                                                   
                                                
                                                ≤
                                                
                                                   P
                                                   max
                                                
                                                ,
                                                t
                                                ∈
                                                T
                                             
                                          
                                       
                                    
                                 
                              
                           
                           
                              
                                 (9c)
                                 
                                    
                                       
                                          
                                          
                                             
                                                For
                                                
                                                all
                                                
                                                w
                                                ∈
                                                W
                                                :
                                             
                                          
                                       
                                       
                                          
                                          
                                             
                                                
                                                   x
                                                   w
                                                
                                                =
                                                
                                                   ∑
                                                   
                                                      δ
                                                      ∈
                                                      
                                                         D
                                                         w
                                                      
                                                   
                                                
                                                
                                                   x
                                                   
                                                      w
                                                      ,
                                                      δ
                                                   
                                                
                                                
                                                   b
                                                   
                                                      w
                                                      ,
                                                      δ
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           
                           
                              
                                 (9d)
                                 
                                    
                                       
                                          
                                          
                                             
                                                
                                                   ∑
                                                   
                                                      δ
                                                      ∈
                                                      
                                                         D
                                                         w
                                                         
                                                            1
                                                            ,
                                                            l
                                                         
                                                      
                                                   
                                                
                                                
                                                   b
                                                   
                                                      w
                                                      ,
                                                      δ
                                                   
                                                
                                                ≤
                                                
                                                   λ
                                                   
                                                      w
                                                      ,
                                                      l
                                                   
                                                
                                                ,
                                                l
                                                ∈
                                                
                                                   L
                                                   w
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           
                           
                              
                                 (9e)
                                 
                                    
                                       
                                          
                                          
                                             
                                                
                                                   ∑
                                                   
                                                      δ
                                                      ∈
                                                      
                                                         D
                                                         w
                                                         
                                                            0
                                                            ,
                                                            l
                                                         
                                                      
                                                   
                                                
                                                
                                                   b
                                                   
                                                      w
                                                      ,
                                                      δ
                                                   
                                                
                                                ≤
                                                
                                                   (
                                                   1
                                                   −
                                                   
                                                      λ
                                                      
                                                         w
                                                         ,
                                                         l
                                                      
                                                   
                                                   )
                                                
                                                ,
                                                l
                                                ∈
                                                
                                                   L
                                                   w
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           
                           
                              
                                 (9f)
                                 
                                    
                                       
                                          
                                          
                                             
                                                
                                                   ∑
                                                   
                                                      δ
                                                      ∈
                                                      
                                                         D
                                                         w
                                                      
                                                   
                                                
                                                
                                                   b
                                                   
                                                      w
                                                      ,
                                                      δ
                                                   
                                                
                                                =
                                                1
                                             
                                          
                                       
                                    
                                 
                              
                           
                           
                              
                                 (9g)
                                 
                                    
                                       
                                          
                                          
                                             
                                                
                                                   ϕ
                                                   w
                                                
                                                
                                                   (
                                                   t
                                                   )
                                                
                                                =
                                                
                                                   x
                                                   t
                                                   w
                                                
                                                ,
                                                t
                                                =
                                                0
                                                ,
                                                …
                                                ,
                                                
                                                   t
                                                   w
                                                   c
                                                
                                                −
                                                1
                                             
                                          
                                       
                                    
                                 
                              
                           
                           
                              
                                 (9h)
                                 
                                    
                                       
                                          
                                          
                                             
                                                
                                                   ϕ
                                                   w
                                                
                                                
                                                   (
                                                   t
                                                   )
                                                
                                                =
                                                
                                                   ϕ
                                                   w
                                                
                                                
                                                   (
                                                   t
                                                   −
                                                   
                                                      t
                                                      w
                                                      c
                                                   
                                                   )
                                                
                                                ,
                                                t
                                                ∈
                                                T
                                                ,
                                                
                                                t
                                                ≥
                                                
                                                   t
                                                   
                                                      w
                                                   
                                                   c
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           
                           
                              
                                 (9i)
                                 
                                    
                                       
                                          
                                          
                                             
                                                
                                                   δ
                                                   w
                                                
                                                =
                                                
                                                   ∑
                                                   
                                                      δ
                                                      ∈
                                                      
                                                         D
                                                         w
                                                      
                                                   
                                                
                                                
                                                   b
                                                   
                                                      w
                                                      ,
                                                      δ
                                                   
                                                
                                                δ
                                             
                                          
                                       
                                    
                                 
                              
                           
                           
                              
                                 (9j)
                                 
                                    
                                       
                                          
                                          
                                             
                                                0
                                                ≤
                                                
                                                   b
                                                   
                                                      w
                                                      ,
                                                      δ
                                                   
                                                
                                                ≤
                                                1
                                                ,
                                                δ
                                                ∈
                                                
                                                   D
                                                   w
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           
                           
                              
                                 (9k)
                                 
                                    
                                       
                                          
                                          
                                             
                                                
                                                   λ
                                                   
                                                      w
                                                      ,
                                                      l
                                                   
                                                
                                                ∈
                                                
                                                   {
                                                   0
                                                   ,
                                                   1
                                                   }
                                                
                                                ,
                                                l
                                                ∈
                                                
                                                   L
                                                   w
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           where 
                              
                                 
                                    θ
                                    
                                       cb
                                    
                                    log
                                 
                                 =
                                 
                                    (
                                    
                                       P
                                       max
                                    
                                    ,
                                    x
                                    ,
                                    ϕ
                                    ,
                                    δ
                                    ,
                                    b
                                    ,
                                    λ
                                    )
                                 
                              
                            is the vector of decision variables, with 
                              
                                 λ
                                 =
                                 (
                                 
                                    λ
                                    
                                       w
                                       ,
                                       l
                                    
                                 
                                 :
                                 w
                                 ∈
                                 W
                                 ,
                                 l
                                 ∈
                                 
                                    L
                                    w
                                 
                                 )
                              
                            and the other vectors defined as before.

The number of variables is bounded by 
                              
                                 W
                                 (
                                 
                                    t
                                    
                                       c
                                    
                                    max
                                 
                                 +
                                 T
                                 +
                                 2
                                 +
                                 
                                    δ
                                    max
                                 
                                 +
                                 
                                    ⌈
                                    
                                       log
                                       2
                                    
                                    
                                       (
                                       
                                          δ
                                          max
                                       
                                       +
                                       1
                                       )
                                    
                                    ⌉
                                 
                                 )
                                 +
                                 1
                                 ,
                              
                            out of which at most 
                              
                                 W
                                 ⌈
                                 
                                    log
                                    2
                                 
                                 
                                    (
                                    
                                       δ
                                       max
                                    
                                    +
                                    1
                                    )
                                 
                                 ⌉
                              
                            are binary. The number of constraints is bounded by 
                              
                                 T
                                 +
                                 W
                                 (
                                 
                                    t
                                    
                                       c
                                    
                                    max
                                 
                                 +
                                 2
                                 
                                    ⌈
                                    
                                       log
                                       2
                                    
                                    
                                       (
                                       
                                          δ
                                          max
                                       
                                       +
                                       1
                                       )
                                    
                                    ⌉
                                 
                                 +
                                 3
                                 +
                                 T
                                 )
                              
                           .

Notice that 
                              
                                 P
                                 
                                    cb
                                 
                                 log
                              
                            is equivalent to 
                              
                                 
                                    P
                                    cb
                                 
                                 ,
                              
                            but instead requires a logarithmic number of binary variables.

The baseline scheduling problem 
                        P
                      considers the initial operation of the oilfield, in which all rod pumps are ready to start operating. Depending on the oilfield configuration, particularly the distribution of the cycle time of the pumps, the resulting hyperperiod may be excessively long for optimization and reliable predictions. For instance, a rod pump may deviate from its predefined cyclic behavior or fail, invariably invalidating the predictions. These operational situations give rise to a variation of the baseline problem which concerns the rescheduling of the pumpoff operations. The objective should minimize control-policy readjustment of the operating pumps, while keeping the power peak within bounds.

Let τ be the time of reconfiguration for the oilfield. Depending on the system state, a pump may or may not be operating at reconfiguration time. The pumps are divided in two subsets: 
                        
                           
                              W
                              on
                           
                           
                              
                              =
                              
                              {
                              w
                              ∈
                              W
                              :
                              w
                           
                        
                      is pumping at the time of reconfiguration} and 
                        
                           
                              W
                              off
                           
                           
                              
                              =
                              
                              {
                              w
                              ∈
                              W
                              :
                              w
                           
                        
                      is not pumping at reconfiguration}. Fig. 8
                      illustrates these conditions for pump 
                        
                           w
                           
                           =
                           
                           3
                        
                      of the illustrative example, for which 
                        
                           
                              t
                              
                                 3
                              
                              on
                           
                           
                           =
                           
                           2
                           ,
                        
                     
                     
                        
                           
                              t
                              
                                 3
                              
                              off
                           
                           
                           =
                           
                           3
                           ,
                        
                      and 
                        
                           
                              t
                              
                                 3
                              
                              c
                           
                           
                           =
                           
                           5
                        
                     . At the reconfiguration time 
                        
                           τ
                           
                           =
                           
                           10
                           ,
                        
                      pump 3 is off pumping for the control profile at the top, but pumping at the lower profile.

The rescheduling problem is derived from the baseline problem 
                        P
                      given in Eq. (6) and defined over a prediction horizon 
                        
                           
                              T
                              ^
                           
                           
                           =
                           
                           
                              {
                              τ
                              ,
                              τ
                              +
                              1
                              ,
                              …
                              ,
                              τ
                              +
                              T
                              −
                              1
                              }
                           
                        
                     .

For a pump 
                        
                           w
                           ∈
                           
                              W
                              off
                           
                           ,
                        
                      let 
                        
                           δ
                           w
                           last
                        
                      be the number of time units that the pump has not being running during the latest working cycle. Notice that 
                        
                           
                              δ
                              3
                              last
                           
                           
                           =
                           
                           1
                        
                      for the control profile given in the upper plot of Fig. 8. To ensure a proper off pumping interval, the constraint 
                        
                           
                              δ
                              w
                           
                           ≥
                           
                              t
                              w
                              off
                           
                           
                           −
                           
                           
                              δ
                              w
                              last
                           
                        
                      must be introduced in the formulation.

On the other hand, for a pump 
                        
                           w
                           ∈
                           
                              W
                              on
                           
                           ,
                        
                      let 
                        
                           t
                           
                              3
                           
                           last
                        
                      be the latest number of time units during which this pump has been running consecutively, before the reconfiguration time τ. For the lower profile in Fig. 8, 
                        
                           
                              t
                              
                                 3
                              
                              last
                           
                           
                           =
                           
                           1
                        
                     . The decision now is about the extension of the pumping operation from time τ onward, so that the operating time remains below 
                        
                           t
                           
                              3
                           
                           on
                        
                     . Let 
                        
                           
                              δ
                              ^
                           
                           w
                        
                      denote the length of the extension, such that 
                        
                           0
                           ≤
                           
                              
                                 δ
                                 ^
                              
                              w
                           
                           ≤
                           
                              t
                              
                                 w
                              
                              on
                           
                           −
                           
                              t
                              w
                              last
                           
                        
                     . In the illustrative example 
                        
                           
                              
                                 δ
                                 ^
                              
                              3
                           
                           ≤
                           
                              t
                              
                                 3
                              
                              on
                           
                           −
                           
                              t
                              
                                 3
                              
                              last
                           
                           
                           =
                           
                           1
                        
                     .

The general formulation for rescheduling takes as input the maximum power peak 
                        
                           P
                           w
                           max
                        
                      and minimizes the number of control adjustments. Formally, the rescheduling problem is stated as:

                        
                           (10a)
                           
                              
                                 
                                    
                                       
                                          
                                             P
                                             ^
                                          
                                          
                                             (
                                             
                                                P
                                                max
                                             
                                             )
                                          
                                          :
                                          
                                             min
                                             
                                                θ
                                                ^
                                             
                                          
                                       
                                    
                                    
                                       
                                          
                                             ∑
                                             
                                                w
                                                ∈
                                                W
                                             
                                          
                                          
                                             x
                                             w
                                          
                                       
                                    
                                 
                              
                           
                        
                     
                     
                        
                           (10b)
                           
                              
                                 
                                    
                                       
                                          s.t.
                                          :
                                       
                                    
                                    
                                       
                                          
                                             ∑
                                             
                                                w
                                                ∈
                                                W
                                             
                                          
                                          
                                             P
                                             w
                                          
                                          
                                             ϕ
                                             w
                                          
                                          
                                             (
                                             t
                                             )
                                          
                                          ≤
                                          
                                             P
                                             max
                                          
                                          ,
                                          
                                          t
                                          ∈
                                          
                                             T
                                             ^
                                          
                                       
                                    
                                 
                              
                           
                        
                     
                     
                        
                           (10c)
                           
                              
                                 
                                    
                                    
                                       
                                          {
                                          
                                             
                                                
                                                   
                                                      
                                                         ϕ
                                                         w
                                                      
                                                      
                                                         (
                                                         t
                                                         )
                                                      
                                                      =
                                                      
                                                         ϕ
                                                         w
                                                      
                                                      
                                                         (
                                                         t
                                                         −
                                                         
                                                            t
                                                            w
                                                            c
                                                         
                                                         )
                                                      
                                                      ,
                                                      
                                                      t
                                                      ∈
                                                      
                                                         T
                                                         ^
                                                      
                                                      ,
                                                      
                                                      t
                                                      ≥
                                                      τ
                                                      +
                                                      
                                                         t
                                                         w
                                                         c
                                                      
                                                      ,
                                                   
                                                
                                             
                                             
                                                
                                                   
                                                      
                                                         ∑
                                                         
                                                            t
                                                            =
                                                            τ
                                                         
                                                         
                                                            τ
                                                            +
                                                            
                                                               t
                                                               w
                                                               c
                                                            
                                                            −
                                                            1
                                                         
                                                      
                                                      
                                                         
                                                            ϕ
                                                            w
                                                         
                                                         
                                                            (
                                                            t
                                                            )
                                                         
                                                      
                                                      =
                                                      
                                                         t
                                                         w
                                                         on
                                                      
                                                      ,
                                                   
                                                
                                             
                                             
                                                
                                                   
                                                      
                                                         ϕ
                                                         w
                                                      
                                                      
                                                         (
                                                         t
                                                         )
                                                      
                                                      ∈
                                                      
                                                         {
                                                         0
                                                         ,
                                                         1
                                                         }
                                                      
                                                      ,
                                                      
                                                      t
                                                      ∈
                                                      
                                                         T
                                                         ^
                                                      
                                                      ,
                                                      w
                                                      ∈
                                                      W
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           
                        
                     
                     
                        
                           (10d)
                           
                              
                                 
                                    
                                    
                                       
                                          {
                                          
                                             
                                                
                                                   
                                                      
                                                         ∑
                                                         
                                                            t
                                                            =
                                                            τ
                                                            +
                                                            
                                                               δ
                                                               w
                                                            
                                                         
                                                         
                                                            τ
                                                            +
                                                            
                                                               δ
                                                               w
                                                            
                                                            +
                                                            
                                                               t
                                                               w
                                                               on
                                                            
                                                            −
                                                            1
                                                         
                                                      
                                                      
                                                         
                                                            ϕ
                                                            w
                                                         
                                                         
                                                            (
                                                            t
                                                            )
                                                         
                                                      
                                                      =
                                                      
                                                         t
                                                         w
                                                         on
                                                      
                                                      ,
                                                   
                                                
                                             
                                             
                                                
                                                   
                                                      
                                                         δ
                                                         w
                                                      
                                                      ≥
                                                      
                                                         δ
                                                         w
                                                         max
                                                      
                                                      −
                                                      
                                                         δ
                                                         w
                                                         last
                                                      
                                                      ,
                                                   
                                                
                                             
                                             
                                                
                                                   
                                                      
                                                         δ
                                                         w
                                                      
                                                      ≤
                                                      
                                                         δ
                                                         w
                                                         max
                                                      
                                                      −
                                                      
                                                         δ
                                                         w
                                                         last
                                                      
                                                      
                                                         (
                                                         1
                                                         −
                                                         
                                                            x
                                                            w
                                                         
                                                         )
                                                      
                                                      ,
                                                   
                                                
                                             
                                             
                                                
                                                   
                                                      
                                                         δ
                                                         w
                                                      
                                                      ∈
                                                      
                                                         Z
                                                         +
                                                      
                                                      ,
                                                      
                                                      
                                                         x
                                                         w
                                                      
                                                      ∈
                                                      
                                                         {
                                                         0
                                                         ,
                                                         1
                                                         }
                                                      
                                                      ,
                                                      w
                                                      ∈
                                                      
                                                         W
                                                         off
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           
                        
                     
                     
                        
                           (10e)
                           
                              
                                 
                                    
                                    
                                       
                                          {
                                          
                                             
                                                
                                                   
                                                      
                                                         ∑
                                                         
                                                            t
                                                            =
                                                            τ
                                                            +
                                                            
                                                               
                                                                  δ
                                                                  ^
                                                               
                                                               w
                                                            
                                                         
                                                         
                                                            τ
                                                            +
                                                            
                                                               
                                                                  δ
                                                                  ^
                                                               
                                                               w
                                                            
                                                            +
                                                            
                                                               t
                                                               w
                                                               off
                                                            
                                                            −
                                                            1
                                                         
                                                      
                                                      
                                                         
                                                            ϕ
                                                            w
                                                         
                                                         
                                                            (
                                                            t
                                                            )
                                                         
                                                      
                                                      =
                                                      0
                                                      ,
                                                   
                                                
                                             
                                             
                                                
                                                   
                                                      
                                                         
                                                            δ
                                                            ^
                                                         
                                                         w
                                                      
                                                      ≤
                                                      
                                                         t
                                                         
                                                            w
                                                         
                                                         on
                                                      
                                                      −
                                                      
                                                         t
                                                         w
                                                         last
                                                      
                                                      ,
                                                   
                                                
                                             
                                             
                                                
                                                   
                                                      
                                                         
                                                            δ
                                                            ^
                                                         
                                                         w
                                                      
                                                      ≥
                                                      
                                                         (
                                                         
                                                            t
                                                            
                                                               w
                                                            
                                                            on
                                                         
                                                         −
                                                         
                                                            t
                                                            w
                                                            last
                                                         
                                                         )
                                                      
                                                      
                                                         (
                                                         1
                                                         −
                                                         
                                                            x
                                                            w
                                                         
                                                         )
                                                      
                                                      ,
                                                   
                                                
                                             
                                             
                                                
                                                   
                                                      
                                                         
                                                            δ
                                                            ^
                                                         
                                                         w
                                                      
                                                      ∈
                                                      
                                                         Z
                                                         +
                                                      
                                                      ,
                                                      
                                                      
                                                         x
                                                         w
                                                      
                                                      ∈
                                                      
                                                         {
                                                         0
                                                         ,
                                                         1
                                                         }
                                                      
                                                      ,
                                                      w
                                                      ∈
                                                      
                                                         W
                                                         on
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           
                        
                     where xw
                      takes on value 1 if the control policy of rod pump w will be readjusted at time τ, otherwise it assumes value 0, and 
                        
                           
                              θ
                              ^
                           
                           
                           =
                           
                           
                              (
                              ϕ
                              ,
                              δ
                              ,
                              
                                 δ
                                 ^
                              
                              ,
                              x
                              )
                           
                        
                      is the vector of decision variables, with 
                        
                           δ
                           
                           =
                           
                           (
                           
                              δ
                              w
                           
                           :
                           w
                           ∈
                           
                              W
                              off
                           
                           )
                           ,
                        
                     
                     
                        
                           
                              δ
                              ^
                           
                           
                           =
                           
                           
                              (
                              
                                 
                                    δ
                                    ^
                                 
                                 w
                              
                              :
                              w
                              ∈
                              
                                 W
                                 on
                              
                              )
                           
                           ,
                        
                      and 
                        
                           x
                           
                           =
                           
                           (
                           
                              x
                              w
                           
                           :
                           w
                           ∈
                           W
                           )
                        
                     . Notice that the objective accounts for the number of readjustments of pumpoff control policies.

Formulation 
                        
                           P
                           ^
                        
                      has 
                        
                           W
                           (
                           T
                           +
                           2
                           )
                        
                      integer variables and the number of constraints is bounded by 
                        
                           T
                           +
                           W
                           (
                           T
                           +
                           4
                           )
                        
                     .

This MILP formulation uses the same structure and auxiliary variables of 
                           
                              P
                              vb
                           
                         for a well 
                           
                              w
                              ∈
                              
                                 W
                                 on
                              
                           
                        . Because these wells cannot start or continue pumping at time τ, the new formulation essentially introduces a bound for minimum delay to ensure the proper off pumping interval.

On the other hand, for a well 
                           
                              w
                              ∈
                              
                                 W
                                 on
                              
                           
                         which has finished pumping or is still pumping at the moment of reconfiguration, new auxiliary variables with other semantics are needed. The variable 
                           
                              
                                 
                                    y
                                    ^
                                 
                                 w
                              
                              
                                 (
                                 t
                                 )
                              
                              ∈
                              
                                 {
                                 0
                                 ,
                                 1
                                 }
                              
                              ,
                              
                              t
                              
                              =
                              
                              τ
                              ,
                              …
                              ,
                              τ
                              +
                              
                                 t
                                 
                                    w
                                 
                                 on
                              
                              −
                              
                                 t
                                 
                                    w
                                 
                                 last
                              
                              −
                              1
                              ,
                           
                         is defined for the initial periods during which pump w can continue pumping, completing or not an interval 
                           
                              t
                              
                                 w
                              
                              on
                           
                        . The constraints will ensure that once 
                           
                              
                                 
                                    y
                                    ^
                                 
                                 w
                              
                              
                                 (
                                 t
                                 )
                              
                              
                              =
                              
                              0
                              ,
                           
                         then all the following variables are also 0. Further, 
                           
                              
                                 ϕ
                                 w
                              
                              
                                 (
                                 t
                                 )
                              
                              
                              =
                              
                              1
                           
                         when 
                           
                              
                                 
                                    y
                                    ^
                                 
                                 w
                              
                              
                                 (
                                 t
                                 )
                              
                              
                              =
                              
                              1
                              ,
                           
                         otherwise ϕw
                        (t) becomes unconstrained.

Similarly, the variables 
                           
                              
                                 
                                    z
                                    ^
                                 
                                 w
                              
                              
                                 (
                                 t
                                 )
                              
                              ∈
                              
                                 {
                                 0
                                 ,
                                 1
                                 }
                              
                              ,
                              
                              t
                              =
                              τ
                              +
                              
                                 t
                                 
                                    w
                                 
                                 on
                              
                              −
                              1
                              ,
                              …
                              ,
                              τ
                              +
                              
                                 t
                                 
                                    w
                                 
                                 c
                              
                              −
                              1
                           
                         define the periods at the end of the cycle during which the pump is running. The constraints are such that if 
                           
                              
                                 
                                    z
                                    ^
                                 
                                 w
                              
                              
                                 (
                                 t
                                 )
                              
                              =
                              1
                              ,
                           
                         then 
                           
                              
                                 
                                    z
                                    ^
                                 
                                 w
                              
                              
                                 (
                                 t
                                 +
                                 1
                                 )
                              
                              =
                              1
                           
                         and thereby all of the following variables.

The resulting MILP formulation is given by:

                           
                              (11a)
                              
                                 
                                    
                                       
                                          
                                             
                                                
                                                   P
                                                   ^
                                                
                                                vb
                                             
                                             
                                                (
                                                
                                                   P
                                                   max
                                                
                                                )
                                             
                                             :
                                             
                                                min
                                                
                                                   
                                                      θ
                                                      ^
                                                   
                                                   vb
                                                
                                             
                                          
                                       
                                       
                                          
                                             
                                                ∑
                                                
                                                   w
                                                   ∈
                                                   W
                                                
                                             
                                             
                                                x
                                                w
                                             
                                          
                                       
                                    
                                 
                              
                           
                        while being subject to:

                           
                              (11b)
                              
                                 
                                    
                                       
                                       
                                          
                                             
                                                ∑
                                                
                                                   w
                                                   ∈
                                                   W
                                                
                                             
                                             
                                                
                                                   ϕ
                                                   w
                                                
                                                
                                                   (
                                                   t
                                                   )
                                                
                                                
                                                   P
                                                   w
                                                
                                             
                                             ≤
                                             
                                                P
                                                max
                                             
                                             ,
                                             t
                                             ∈
                                             
                                                T
                                                ^
                                             
                                          
                                       
                                    
                                 
                              
                           
                        
                        
                           
                              (11c)
                              
                                 
                                    
                                       
                                       
                                          
                                             For
                                             
                                             all
                                             
                                             w
                                             ∈
                                             W
                                             :
                                          
                                       
                                    
                                    
                                       
                                       
                                          
                                             {
                                             
                                                
                                                   
                                                      
                                                         
                                                            ϕ
                                                            w
                                                         
                                                         
                                                            (
                                                            t
                                                            )
                                                         
                                                         =
                                                         
                                                            ϕ
                                                            w
                                                         
                                                         
                                                            (
                                                            t
                                                            −
                                                            
                                                               t
                                                               w
                                                               c
                                                            
                                                            )
                                                         
                                                         ,
                                                         t
                                                         ∈
                                                         
                                                            T
                                                            ^
                                                         
                                                         ,
                                                         
                                                         t
                                                         ≥
                                                         τ
                                                         +
                                                         
                                                            t
                                                            w
                                                            c
                                                         
                                                      
                                                   
                                                
                                                
                                                   
                                                      
                                                         
                                                            ∑
                                                            
                                                               t
                                                               =
                                                               τ
                                                            
                                                            
                                                               τ
                                                               +
                                                               
                                                                  t
                                                                  w
                                                                  c
                                                               
                                                               −
                                                               1
                                                            
                                                         
                                                         
                                                            
                                                               ϕ
                                                               w
                                                            
                                                            
                                                               (
                                                               t
                                                               )
                                                            
                                                         
                                                         =
                                                         
                                                            t
                                                            w
                                                            on
                                                         
                                                      
                                                   
                                                
                                                
                                                   
                                                      
                                                         
                                                            ϕ
                                                            w
                                                         
                                                         
                                                            (
                                                            t
                                                            )
                                                         
                                                         ∈
                                                         
                                                            {
                                                            0
                                                            ,
                                                            1
                                                            }
                                                         
                                                         ,
                                                         t
                                                         ∈
                                                         
                                                            T
                                                            ^
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           
                        
                        
                           
                              (11d)
                              
                                 
                                    
                                       
                                       
                                          
                                             For
                                             
                                             all
                                             
                                             w
                                             ∈
                                             
                                                W
                                                off
                                             
                                             :
                                          
                                       
                                    
                                    
                                       
                                       
                                          
                                             {
                                             
                                                
                                                   
                                                      
                                                         
                                                            y
                                                            w
                                                         
                                                         
                                                            (
                                                            t
                                                            )
                                                         
                                                         ≥
                                                         
                                                            y
                                                            w
                                                         
                                                         
                                                            (
                                                            t
                                                            +
                                                            1
                                                            )
                                                         
                                                         ,
                                                         t
                                                         =
                                                         τ
                                                         ,
                                                         …
                                                         ,
                                                         
                                                            (
                                                            τ
                                                            +
                                                            
                                                               δ
                                                               w
                                                               max
                                                            
                                                            −
                                                            2
                                                            )
                                                         
                                                      
                                                   
                                                
                                                
                                                   
                                                      
                                                         
                                                            ϕ
                                                            w
                                                         
                                                         
                                                            (
                                                            t
                                                            )
                                                         
                                                         ≤
                                                         1
                                                         −
                                                         
                                                            y
                                                            w
                                                         
                                                         
                                                            (
                                                            t
                                                            )
                                                         
                                                         ,
                                                         t
                                                         =
                                                         τ
                                                         ,
                                                         …
                                                         ,
                                                         
                                                            (
                                                            τ
                                                            +
                                                            
                                                               δ
                                                               w
                                                               max
                                                            
                                                            −
                                                            1
                                                            )
                                                         
                                                      
                                                   
                                                
                                                
                                                   
                                                      
                                                         
                                                            ∑
                                                            
                                                               t
                                                               =
                                                               τ
                                                            
                                                            
                                                               τ
                                                               +
                                                               
                                                                  δ
                                                                  w
                                                                  max
                                                               
                                                               −
                                                               1
                                                            
                                                         
                                                         
                                                            
                                                               y
                                                               w
                                                            
                                                            
                                                               (
                                                               t
                                                               )
                                                            
                                                         
                                                         =
                                                         
                                                            δ
                                                            w
                                                         
                                                      
                                                   
                                                
                                                
                                                   
                                                      
                                                         
                                                            δ
                                                            w
                                                         
                                                         ≥
                                                         
                                                            δ
                                                            w
                                                            max
                                                         
                                                         −
                                                         
                                                            δ
                                                            w
                                                            last
                                                         
                                                      
                                                   
                                                
                                                
                                                   
                                                      
                                                         
                                                            δ
                                                            w
                                                         
                                                         ≤
                                                         
                                                            δ
                                                            w
                                                            max
                                                         
                                                         −
                                                         
                                                            δ
                                                            w
                                                            last
                                                         
                                                         
                                                            (
                                                            1
                                                            −
                                                            
                                                               x
                                                               w
                                                            
                                                            )
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           
                        
                        
                           
                              (11e)
                              
                                 
                                    
                                       
                                       
                                          
                                             {
                                             
                                                
                                                   
                                                      
                                                         
                                                            z
                                                            w
                                                         
                                                         
                                                            (
                                                            t
                                                            )
                                                         
                                                         ≤
                                                         
                                                            z
                                                            w
                                                         
                                                         
                                                            (
                                                            t
                                                            +
                                                            1
                                                            )
                                                         
                                                         ,
                                                         t
                                                         =
                                                         
                                                            (
                                                            τ
                                                            +
                                                            
                                                               t
                                                               w
                                                               on
                                                            
                                                            )
                                                         
                                                         ,
                                                         …
                                                         ,
                                                         
                                                            (
                                                            τ
                                                            +
                                                            
                                                               t
                                                               w
                                                               c
                                                            
                                                            −
                                                            2
                                                            )
                                                         
                                                      
                                                   
                                                
                                                
                                                   
                                                      
                                                         
                                                            ϕ
                                                            w
                                                         
                                                         
                                                            (
                                                            t
                                                            )
                                                         
                                                         ≤
                                                         1
                                                         −
                                                         
                                                            z
                                                            w
                                                         
                                                         
                                                            (
                                                            t
                                                            )
                                                         
                                                         ,
                                                         t
                                                         =
                                                         
                                                            (
                                                            τ
                                                            +
                                                            
                                                               t
                                                               w
                                                               on
                                                            
                                                            )
                                                         
                                                         ,
                                                         …
                                                         ,
                                                         
                                                            (
                                                            τ
                                                            +
                                                            
                                                               t
                                                               w
                                                               c
                                                            
                                                            −
                                                            1
                                                            )
                                                         
                                                      
                                                   
                                                
                                                
                                                   
                                                      
                                                         
                                                            ∑
                                                            
                                                               t
                                                               =
                                                               τ
                                                               +
                                                               
                                                                  t
                                                                  w
                                                                  on
                                                               
                                                            
                                                            
                                                               τ
                                                               +
                                                               
                                                                  t
                                                                  w
                                                                  c
                                                               
                                                               −
                                                               1
                                                            
                                                         
                                                         
                                                            
                                                               z
                                                               w
                                                            
                                                            
                                                               (
                                                               t
                                                               )
                                                            
                                                         
                                                         =
                                                         
                                                            δ
                                                            w
                                                            max
                                                         
                                                         −
                                                         
                                                            δ
                                                            w
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           
                        
                        
                           
                              (11f)
                              
                                 
                                    
                                       
                                       
                                          
                                             {
                                             
                                                
                                                   
                                                      
                                                         
                                                            y
                                                            w
                                                         
                                                         
                                                            (
                                                            t
                                                            )
                                                         
                                                         ∈
                                                         
                                                            {
                                                            0
                                                            ,
                                                            1
                                                            }
                                                         
                                                         ,
                                                         t
                                                         =
                                                         τ
                                                         ,
                                                         …
                                                         ,
                                                         
                                                            (
                                                            τ
                                                            +
                                                            
                                                               δ
                                                               w
                                                               max
                                                            
                                                            −
                                                            1
                                                            )
                                                         
                                                      
                                                   
                                                
                                                
                                                   
                                                      
                                                         
                                                            z
                                                            w
                                                         
                                                         
                                                            (
                                                            t
                                                            )
                                                         
                                                         ∈
                                                         
                                                            {
                                                            0
                                                            ,
                                                            1
                                                            }
                                                         
                                                         ,
                                                         t
                                                         =
                                                         
                                                            (
                                                            τ
                                                            +
                                                            
                                                               t
                                                               w
                                                               on
                                                            
                                                            )
                                                         
                                                         ,
                                                         …
                                                         ,
                                                         
                                                            (
                                                            τ
                                                            +
                                                            
                                                               t
                                                               w
                                                               c
                                                            
                                                            −
                                                            1
                                                            )
                                                         
                                                      
                                                   
                                                
                                                
                                                   
                                                      
                                                         
                                                            x
                                                            w
                                                         
                                                         ∈
                                                         
                                                            {
                                                            0
                                                            ,
                                                            1
                                                            }
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           
                        
                        
                           
                              (11g)
                              
                                 
                                    
                                       
                                       
                                          
                                             For
                                             
                                             all
                                             
                                             w
                                             ∈
                                             
                                                W
                                                on
                                             
                                             :
                                          
                                       
                                    
                                    
                                       
                                       
                                          
                                             {
                                             
                                                
                                                   
                                                      
                                                         
                                                            
                                                               y
                                                               ^
                                                            
                                                            w
                                                         
                                                         
                                                            (
                                                            t
                                                            )
                                                         
                                                         ≥
                                                         
                                                            
                                                               y
                                                               ^
                                                            
                                                            w
                                                         
                                                         
                                                            (
                                                            t
                                                            +
                                                            1
                                                            )
                                                         
                                                         ,
                                                         t
                                                         =
                                                         τ
                                                         ,
                                                         …
                                                         ,
                                                         
                                                            (
                                                            τ
                                                            +
                                                            
                                                               t
                                                               
                                                                  w
                                                               
                                                               on
                                                            
                                                            −
                                                            
                                                               t
                                                               
                                                                  w
                                                               
                                                               last
                                                            
                                                            −
                                                            2
                                                            )
                                                         
                                                      
                                                   
                                                
                                                
                                                   
                                                      
                                                         
                                                            ϕ
                                                            w
                                                         
                                                         
                                                            (
                                                            t
                                                            )
                                                         
                                                         ≥
                                                         
                                                            
                                                               y
                                                               ^
                                                            
                                                            w
                                                         
                                                         
                                                            (
                                                            t
                                                            )
                                                         
                                                         ,
                                                         t
                                                         =
                                                         τ
                                                         ,
                                                         …
                                                         ,
                                                         
                                                            (
                                                            τ
                                                            +
                                                            
                                                               t
                                                               
                                                                  w
                                                               
                                                               on
                                                            
                                                            −
                                                            
                                                               t
                                                               
                                                                  w
                                                               
                                                               last
                                                            
                                                            −
                                                            1
                                                            )
                                                         
                                                      
                                                   
                                                
                                                
                                                   
                                                      
                                                         
                                                            ∑
                                                            
                                                               t
                                                               =
                                                               τ
                                                            
                                                            
                                                               τ
                                                               +
                                                               
                                                                  t
                                                                  
                                                                     w
                                                                  
                                                                  on
                                                               
                                                               −
                                                               
                                                                  t
                                                                  
                                                                     w
                                                                  
                                                                  last
                                                               
                                                               −
                                                               1
                                                            
                                                         
                                                         
                                                            
                                                               
                                                                  y
                                                                  ^
                                                               
                                                               w
                                                            
                                                            
                                                               (
                                                               t
                                                               )
                                                            
                                                         
                                                         =
                                                         
                                                            
                                                               δ
                                                               ^
                                                            
                                                            w
                                                         
                                                      
                                                   
                                                
                                                
                                                   
                                                      
                                                         
                                                            
                                                               δ
                                                               ^
                                                            
                                                            w
                                                         
                                                         ≤
                                                         
                                                            t
                                                            
                                                               w
                                                            
                                                            on
                                                         
                                                         −
                                                         
                                                            t
                                                            
                                                               w
                                                            
                                                            last
                                                         
                                                      
                                                   
                                                
                                                
                                                   
                                                      
                                                         
                                                            
                                                               δ
                                                               ^
                                                            
                                                            w
                                                         
                                                         ≥
                                                         
                                                            (
                                                            
                                                               t
                                                               
                                                                  w
                                                               
                                                               on
                                                            
                                                            −
                                                            
                                                               t
                                                               
                                                                  w
                                                               
                                                               last
                                                            
                                                            )
                                                         
                                                         
                                                            (
                                                            1
                                                            −
                                                            
                                                               x
                                                               w
                                                            
                                                            )
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           
                        
                        
                           
                              (11h)
                              
                                 
                                    
                                       
                                       
                                          
                                             {
                                             
                                                
                                                   
                                                      
                                                         
                                                            
                                                               z
                                                               ^
                                                            
                                                            w
                                                         
                                                         
                                                            (
                                                            t
                                                            )
                                                         
                                                         ≤
                                                         
                                                            
                                                               z
                                                               ^
                                                            
                                                            w
                                                         
                                                         
                                                            (
                                                            t
                                                            +
                                                            1
                                                            )
                                                         
                                                         ,
                                                         t
                                                         =
                                                         
                                                            (
                                                            τ
                                                            +
                                                            
                                                               t
                                                               
                                                                  w
                                                               
                                                               off
                                                            
                                                            )
                                                         
                                                         ,
                                                         …
                                                         ,
                                                         
                                                            (
                                                            τ
                                                            +
                                                            
                                                               t
                                                               w
                                                               c
                                                            
                                                            −
                                                            2
                                                            )
                                                         
                                                      
                                                   
                                                
                                                
                                                   
                                                      
                                                         
                                                            ϕ
                                                            w
                                                         
                                                         
                                                            (
                                                            t
                                                            )
                                                         
                                                         ≥
                                                         
                                                            
                                                               z
                                                               ^
                                                            
                                                            w
                                                         
                                                         
                                                            (
                                                            t
                                                            )
                                                         
                                                         ,
                                                         t
                                                         =
                                                         
                                                            (
                                                            τ
                                                            +
                                                            
                                                               t
                                                               
                                                                  w
                                                               
                                                               off
                                                            
                                                            )
                                                         
                                                         ,
                                                         …
                                                         ,
                                                         
                                                            (
                                                            τ
                                                            +
                                                            
                                                               t
                                                               
                                                                  w
                                                               
                                                               c
                                                            
                                                            −
                                                            1
                                                            )
                                                         
                                                      
                                                   
                                                
                                                
                                                   
                                                      
                                                         
                                                            ∑
                                                            
                                                               t
                                                               =
                                                               (
                                                               τ
                                                               +
                                                               
                                                                  t
                                                                  
                                                                     w
                                                                  
                                                                  off
                                                               
                                                               )
                                                            
                                                            
                                                               τ
                                                               +
                                                               
                                                                  t
                                                                  
                                                                     w
                                                                  
                                                                  c
                                                               
                                                               −
                                                               1
                                                            
                                                         
                                                         
                                                            
                                                               z
                                                               w
                                                            
                                                            
                                                               (
                                                               t
                                                               )
                                                            
                                                         
                                                         =
                                                         
                                                            t
                                                            w
                                                            on
                                                         
                                                         −
                                                         
                                                            
                                                               δ
                                                               ^
                                                            
                                                            w
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           
                        
                        
                           
                              (11i)
                              
                                 
                                    
                                       
                                       
                                          
                                             {
                                             
                                                
                                                   
                                                      
                                                         
                                                            
                                                               y
                                                               ^
                                                            
                                                            w
                                                         
                                                         
                                                            (
                                                            t
                                                            )
                                                         
                                                         ∈
                                                         
                                                            {
                                                            0
                                                            ,
                                                            1
                                                            }
                                                         
                                                         ,
                                                         t
                                                         =
                                                         τ
                                                         ,
                                                         …
                                                         ,
                                                         
                                                            (
                                                            τ
                                                            +
                                                            
                                                               t
                                                               
                                                                  w
                                                               
                                                               on
                                                            
                                                            −
                                                            
                                                               t
                                                               
                                                                  w
                                                               
                                                               last
                                                            
                                                            −
                                                            1
                                                            )
                                                         
                                                      
                                                   
                                                
                                                
                                                   
                                                      
                                                         
                                                            
                                                               z
                                                               ^
                                                            
                                                            w
                                                         
                                                         
                                                            (
                                                            t
                                                            )
                                                         
                                                         ∈
                                                         
                                                            {
                                                            0
                                                            ,
                                                            1
                                                            }
                                                         
                                                         ,
                                                         t
                                                         =
                                                         
                                                            (
                                                            τ
                                                            +
                                                            
                                                               t
                                                               
                                                                  w
                                                               
                                                               off
                                                            
                                                            )
                                                         
                                                         ,
                                                         …
                                                         ,
                                                         
                                                            (
                                                            τ
                                                            +
                                                            
                                                               t
                                                               w
                                                               c
                                                            
                                                            −
                                                            1
                                                            )
                                                         
                                                      
                                                   
                                                
                                                
                                                   
                                                      
                                                         
                                                            x
                                                            w
                                                         
                                                         ∈
                                                         
                                                            {
                                                            0
                                                            ,
                                                            1
                                                            }
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           
                        where 
                           
                              
                                 
                                    θ
                                    ^
                                 
                                 vb
                              
                              
                              =
                              
                              
                                 (
                                 ϕ
                                 ,
                                 y
                                 ,
                                 z
                                 ,
                                 δ
                                 ,
                                 
                                    y
                                    ^
                                 
                                 ,
                                 
                                    z
                                    ^
                                 
                                 ,
                                 
                                    δ
                                    ^
                                 
                                 ,
                                 x
                                 )
                              
                           
                         is the vector of decision variables with

                           
                              •
                              
                                 
                                    
                                       y
                                       =
                                       (
                                       
                                          y
                                          w
                                       
                                       
                                          (
                                          t
                                          )
                                       
                                       :
                                       w
                                       ∈
                                       
                                          W
                                          off
                                       
                                       ,
                                       t
                                       =
                                       τ
                                       ,
                                       …
                                       ,
                                       
                                          (
                                          τ
                                          +
                                          
                                             δ
                                             w
                                             max
                                          
                                          −
                                          1
                                          )
                                       
                                       )
                                       ,
                                    
                                 
                              


                                 
                                    
                                       z
                                       =
                                       (
                                       
                                          z
                                          w
                                       
                                       :
                                       w
                                       ∈
                                       
                                          W
                                          off
                                       
                                       ,
                                       t
                                       =
                                       
                                          (
                                          τ
                                          +
                                          
                                             t
                                             
                                                w
                                             
                                             off
                                          
                                          )
                                       
                                       ,
                                       …
                                       ,
                                       
                                          (
                                          τ
                                          +
                                          
                                             t
                                             w
                                             c
                                          
                                          −
                                          1
                                          )
                                       
                                       )
                                       ,
                                    
                                 
                              


                                 
                                    
                                       
                                          y
                                          ^
                                       
                                       =
                                       
                                          (
                                          
                                             
                                                y
                                                ^
                                             
                                             w
                                          
                                          
                                             (
                                             t
                                             )
                                          
                                          :
                                          w
                                          ∈
                                          
                                             W
                                             on
                                          
                                          ,
                                          t
                                          =
                                          τ
                                          ,
                                          …
                                          ,
                                          
                                             (
                                             τ
                                             +
                                             
                                                t
                                                
                                                   w
                                                
                                                on
                                             
                                             −
                                             
                                                t
                                                
                                                   w
                                                
                                                last
                                             
                                             −
                                             1
                                             )
                                          
                                          )
                                       
                                       ,
                                    
                                 
                              


                                 
                                    
                                       
                                          z
                                          ^
                                       
                                       =
                                       
                                          (
                                          
                                             
                                                z
                                                ^
                                             
                                             w
                                          
                                          
                                             (
                                             t
                                             )
                                          
                                          :
                                          w
                                          ∈
                                          
                                             W
                                             on
                                          
                                          ,
                                          t
                                          =
                                          
                                             (
                                             τ
                                             +
                                             
                                                t
                                                
                                                   w
                                                
                                                off
                                             
                                             )
                                          
                                          ,
                                          …
                                          ,
                                          
                                             (
                                             τ
                                             +
                                             
                                                t
                                                w
                                                c
                                             
                                             −
                                             1
                                             )
                                          
                                          )
                                       
                                       ,
                                    
                                 
                              


                                 
                                    δ
                                 , 
                                    
                                       
                                          δ
                                          ^
                                       
                                       ,
                                    
                                  and x defined as before.

The number of variables is bounded by 
                           
                              (
                              W
                              T
                              +
                              |
                              
                                 W
                                 off
                              
                              |
                              
                                 (
                                 
                                    δ
                                    max
                                 
                                 +
                                 
                                    t
                                    
                                       on
                                    
                                    max
                                 
                                 )
                              
                              +
                              2
                              W
                              +
                              2
                              |
                              
                                 W
                                 on
                              
                              |
                              
                                 t
                                 
                                    on
                                 
                                 max
                              
                              )
                              ,
                           
                         with only W being continuous while the others are integer variables. The number of constraints is bounded by 
                           
                              
                                 T
                                 +
                                 W
                                 
                                    (
                                    T
                                    +
                                    1
                                    )
                                 
                                 +
                                 |
                              
                              
                                 W
                                 off
                              
                              
                                 |
                              
                              
                                 (
                                 2
                                 
                                    δ
                                    max
                                 
                                 +
                                 4
                                 +
                                 2
                                 
                                    t
                                    
                                       off
                                    
                                    max
                                 
                                 )
                              
                              +
                              
                                 |
                                 
                                    W
                                    on
                                 
                                 |
                              
                              
                                 (
                                 4
                                 
                                    t
                                    
                                       on
                                    
                                    max
                                 
                                 +
                                 4
                                 )
                              
                           
                        .

The variable-based formulation 
                           
                              
                                 
                                    P
                                    ^
                                 
                                 vb
                              
                              
                                 (
                                 
                                    P
                                    max
                                 
                                 )
                              
                           
                         is an MILP program.

The rescheduling problem is derived directly from the column-based formulation 
                           
                              P
                              cb
                           
                        . For a pump 
                           
                              w
                              ∈
                              
                                 W
                                 off
                              
                              ,
                           
                         the model is essentially identical to 
                           
                              P
                              cb
                           
                         except that the profiles with 
                           
                              
                                 δ
                                 w
                              
                              <
                              
                                 δ
                                 w
                                 max
                              
                              −
                              
                                 δ
                                 w
                                 last
                              
                           
                         are disconsidered. The feasible profiles of pump 
                           
                              w
                              
                              =
                              
                              3
                           
                         in Fig. 8 are [0 0 1 1 0]′ with 
                           
                              
                                 δ
                                 w
                              
                              
                              =
                              
                              2
                           
                         and [0 0 0 1 1]′ with 
                           
                              
                                 δ
                                 w
                              
                              
                              =
                              
                              3
                           
                        .

For a pump 
                           
                              w
                              ∈
                              
                                 W
                                 on
                              
                              ,
                           
                         the pumping profiles should be constructed so as to allow a pumping extension 
                           
                              
                                 
                                    δ
                                    ^
                                 
                                 w
                              
                              ∈
                              
                                 {
                                 0
                                 ,
                                 …
                                 ,
                                 
                                    t
                                    w
                                    on
                                 
                                 −
                                 
                                    t
                                    w
                                    last
                                 
                                 }
                              
                           
                        . The feasible profiles for pump 
                           
                              w
                              
                              =
                              
                              3
                           
                         in Fig. 8 are [1 0 0 0 1]′ with 
                           
                              
                                 
                                    δ
                                    ^
                                 
                                 w
                              
                              
                              =
                              
                              1
                           
                         and [0 0 0 1 1] with 
                           
                              
                                 
                                    δ
                                    ^
                                 
                                 w
                              
                              
                              =
                              
                              0
                           
                        .

The column-based MILP formulation of the rescheduling problem is given by:

                           
                              (12a)
                              
                                 
                                    
                                       
                                          
                                             
                                                
                                                   P
                                                   ^
                                                
                                                cb
                                             
                                             
                                                (
                                                
                                                   P
                                                   max
                                                
                                                )
                                             
                                             :
                                             
                                                min
                                                
                                                   
                                                      θ
                                                      ^
                                                   
                                                   cb
                                                
                                             
                                          
                                       
                                       
                                          
                                             
                                                ∑
                                                
                                                   w
                                                   ∈
                                                   
                                                      W
                                                      off
                                                   
                                                
                                             
                                             
                                                ∑
                                                
                                                   δ
                                                   ∈
                                                   
                                                      D
                                                      w
                                                   
                                                
                                             
                                             
                                                c
                                                
                                                   w
                                                   ,
                                                   δ
                                                
                                             
                                             
                                                b
                                                
                                                   w
                                                   ,
                                                   δ
                                                
                                             
                                             +
                                             
                                                ∑
                                                
                                                   w
                                                   ∈
                                                   
                                                      W
                                                      on
                                                   
                                                
                                             
                                             
                                                ∑
                                                
                                                   
                                                      δ
                                                      ^
                                                   
                                                   ∈
                                                   
                                                      
                                                         D
                                                         ^
                                                      
                                                      w
                                                   
                                                
                                             
                                             
                                                c
                                                
                                                   w
                                                   ,
                                                   
                                                      δ
                                                      ^
                                                   
                                                
                                             
                                             
                                                b
                                                
                                                   w
                                                   ,
                                                   
                                                      δ
                                                      ^
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           
                        while being subject to:

                           
                              (12b)
                              
                                 
                                    
                                       
                                       
                                          
                                             
                                                ∑
                                                
                                                   w
                                                   ∈
                                                   W
                                                
                                             
                                             
                                                
                                                   P
                                                   w
                                                
                                                
                                                   ϕ
                                                   w
                                                
                                                
                                                   (
                                                   t
                                                   )
                                                
                                             
                                             ≤
                                             
                                                P
                                                max
                                             
                                             ,
                                             t
                                             ∈
                                             
                                                T
                                                ^
                                             
                                          
                                       
                                    
                                 
                              
                           
                        
                        
                           
                              (12c)
                              
                                 
                                    
                                       
                                       
                                          
                                             
                                                ϕ
                                                w
                                             
                                             
                                                (
                                                t
                                                )
                                             
                                             =
                                             
                                                ϕ
                                                w
                                             
                                             
                                                (
                                                t
                                                −
                                                
                                                   t
                                                   w
                                                   c
                                                
                                                )
                                             
                                             ,
                                             t
                                             ∈
                                             
                                                T
                                                ^
                                             
                                             ,
                                             
                                             t
                                             ≥
                                             
                                                (
                                                τ
                                                +
                                                
                                                   t
                                                   w
                                                   c
                                                
                                                )
                                             
                                             ,
                                             
                                             w
                                             ∈
                                             W
                                          
                                       
                                    
                                 
                              
                           
                        
                        
                           
                              (12d)
                              
                                 
                                    
                                       
                                       
                                          
                                             
                                                ϕ
                                                w
                                             
                                             
                                                (
                                                t
                                                )
                                             
                                             =
                                             
                                                x
                                                t
                                                w
                                             
                                             ,
                                             t
                                             =
                                             τ
                                             ,
                                             …
                                             ,
                                             
                                                (
                                                τ
                                                +
                                                
                                                   t
                                                   w
                                                   c
                                                
                                                −
                                                1
                                                )
                                             
                                             ,
                                             
                                             w
                                             ∈
                                             W
                                          
                                       
                                    
                                 
                              
                           
                        
                        
                           
                              (12e)
                              
                                 
                                    
                                       
                                       
                                          
                                             For
                                             
                                             all
                                             
                                             w
                                             ∈
                                             
                                                W
                                                off
                                             
                                             :
                                          
                                       
                                    
                                    
                                       
                                       
                                          
                                             {
                                             
                                                
                                                   
                                                      
                                                         
                                                            x
                                                            w
                                                         
                                                         =
                                                         
                                                            ∑
                                                            
                                                               δ
                                                               ∈
                                                               
                                                                  D
                                                                  w
                                                               
                                                            
                                                         
                                                         
                                                            x
                                                            
                                                               w
                                                               ,
                                                               δ
                                                            
                                                         
                                                         
                                                            b
                                                            
                                                               w
                                                               ,
                                                               δ
                                                            
                                                         
                                                      
                                                   
                                                
                                                
                                                   
                                                      
                                                         
                                                            ∑
                                                            
                                                               δ
                                                               ∈
                                                               
                                                                  D
                                                                  w
                                                               
                                                            
                                                         
                                                         
                                                            b
                                                            
                                                               w
                                                               ,
                                                               δ
                                                            
                                                         
                                                         =
                                                         1
                                                      
                                                   
                                                
                                                
                                                   
                                                      
                                                         
                                                            δ
                                                            w
                                                         
                                                         =
                                                         
                                                            ∑
                                                            
                                                               δ
                                                               ∈
                                                               
                                                                  D
                                                                  w
                                                               
                                                            
                                                         
                                                         
                                                            b
                                                            
                                                               w
                                                               ,
                                                               δ
                                                            
                                                         
                                                         δ
                                                      
                                                   
                                                
                                                
                                                   
                                                      
                                                         
                                                            b
                                                            
                                                               w
                                                               ,
                                                               δ
                                                            
                                                         
                                                         ∈
                                                         
                                                            {
                                                            0
                                                            ,
                                                            1
                                                            }
                                                         
                                                         ,
                                                         δ
                                                         ∈
                                                         
                                                            D
                                                            w
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           
                        
                        
                           
                              (12f)
                              
                                 
                                    
                                       
                                       
                                          
                                             For
                                             
                                             all
                                             
                                             w
                                             ∈
                                             
                                                W
                                                on
                                             
                                             :
                                          
                                       
                                    
                                    
                                       
                                       
                                          
                                             {
                                             
                                                
                                                   
                                                      
                                                         
                                                            x
                                                            w
                                                         
                                                         =
                                                         
                                                            ∑
                                                            
                                                               
                                                                  δ
                                                                  ^
                                                               
                                                               ∈
                                                               
                                                                  
                                                                     D
                                                                     ^
                                                                  
                                                                  w
                                                               
                                                            
                                                         
                                                         
                                                            x
                                                            
                                                               w
                                                               ,
                                                               
                                                                  δ
                                                                  ^
                                                               
                                                            
                                                         
                                                         
                                                         
                                                            b
                                                            
                                                               w
                                                               ,
                                                               
                                                                  δ
                                                                  ^
                                                               
                                                            
                                                         
                                                      
                                                   
                                                
                                                
                                                   
                                                      
                                                         
                                                            ∑
                                                            
                                                               
                                                                  δ
                                                                  ^
                                                               
                                                               ∈
                                                               
                                                                  
                                                                     D
                                                                     ^
                                                                  
                                                                  w
                                                               
                                                            
                                                         
                                                         
                                                            b
                                                            
                                                               w
                                                               ,
                                                               
                                                                  δ
                                                                  ^
                                                               
                                                            
                                                         
                                                         =
                                                         1
                                                      
                                                   
                                                
                                                
                                                   
                                                      
                                                         
                                                            
                                                               δ
                                                               ^
                                                            
                                                            w
                                                         
                                                         =
                                                         
                                                            ∑
                                                            
                                                               
                                                                  δ
                                                                  ^
                                                               
                                                               ∈
                                                               
                                                                  
                                                                     D
                                                                     ^
                                                                  
                                                                  w
                                                               
                                                            
                                                         
                                                         
                                                            b
                                                            
                                                               w
                                                               ,
                                                               
                                                                  δ
                                                                  ^
                                                               
                                                            
                                                         
                                                         
                                                            δ
                                                            ^
                                                         
                                                      
                                                   
                                                
                                                
                                                   
                                                      
                                                         
                                                            b
                                                            
                                                               w
                                                               ,
                                                               
                                                                  δ
                                                                  ^
                                                               
                                                            
                                                         
                                                         ∈
                                                         
                                                            {
                                                            0
                                                            ,
                                                            1
                                                            }
                                                         
                                                         ,
                                                         
                                                            δ
                                                            ^
                                                         
                                                         ∈
                                                         
                                                            
                                                               D
                                                               ^
                                                            
                                                            w
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           
                        where:

                           
                              •
                              
                                 
                                    
                                       
                                          D
                                          w
                                       
                                       =
                                       
                                          {
                                          
                                             δ
                                             
                                                w
                                             
                                             max
                                          
                                          −
                                          
                                             δ
                                             
                                                w
                                             
                                             last
                                          
                                          ,
                                          …
                                          ,
                                          
                                             δ
                                             w
                                             max
                                          
                                          }
                                       
                                    
                                 ;


                                 
                                    
                                       
                                          c
                                          
                                             w
                                             ,
                                             δ
                                          
                                       
                                       =
                                       0
                                    
                                  if 
                                    
                                       δ
                                       =
                                       
                                          δ
                                          
                                             w
                                          
                                          max
                                       
                                       −
                                       
                                          δ
                                          
                                             w
                                          
                                          last
                                       
                                    
                                  but otherwise 
                                    
                                       
                                          c
                                          
                                             w
                                             ,
                                             δ
                                          
                                       
                                       =
                                       1
                                    
                                  for 
                                    
                                       w
                                       ∈
                                       
                                          W
                                          off
                                       
                                    
                                 ;


                                 
                                    
                                       
                                          
                                             D
                                             ^
                                          
                                          w
                                       
                                       =
                                       
                                          {
                                          0
                                          ,
                                          …
                                          ,
                                          
                                             t
                                             
                                                w
                                             
                                             on
                                          
                                          −
                                          
                                             t
                                             
                                                w
                                             
                                             last
                                          
                                          }
                                       
                                    
                                 ;


                                 
                                    
                                       
                                          c
                                          
                                             w
                                             ,
                                             
                                                δ
                                                ^
                                             
                                          
                                       
                                       =
                                       0
                                    
                                  if 
                                    
                                       
                                          δ
                                          ^
                                       
                                       =
                                       
                                          t
                                          
                                             w
                                          
                                          on
                                       
                                       −
                                       
                                          t
                                          
                                             w
                                          
                                          last
                                       
                                    
                                  or else 
                                    
                                       
                                          c
                                          
                                             w
                                             ,
                                             
                                                δ
                                                ^
                                             
                                          
                                       
                                       =
                                       1
                                    
                                  for 
                                    
                                       w
                                       ∈
                                       
                                          W
                                          on
                                       
                                    
                                 ;


                                 
                                    
                                       
                                          
                                             θ
                                             ^
                                          
                                          cb
                                       
                                       =
                                       
                                          (
                                          ϕ
                                          ,
                                          x
                                          ,
                                          δ
                                          ,
                                          b
                                          ,
                                          
                                             δ
                                             ^
                                          
                                          ,
                                          
                                             b
                                             ^
                                          
                                          )
                                       
                                    
                                  is the vector of decision variables;


                                 
                                    ϕ, δ
                                 , and 
                                    
                                       δ
                                       ^
                                    
                                  are defined as above;


                                 
                                    
                                       x
                                       =
                                       (
                                       
                                          x
                                          t
                                          w
                                       
                                       :
                                       w
                                       ∈
                                       W
                                       ,
                                       t
                                       =
                                       0
                                       ,
                                       …
                                       ,
                                       
                                          t
                                          w
                                          c
                                       
                                       )
                                    
                                 ;


                                 
                                    
                                       b
                                       =
                                       (
                                       
                                          b
                                          
                                             w
                                             ,
                                             δ
                                          
                                       
                                       :
                                       w
                                       ∈
                                       
                                          W
                                          off
                                       
                                       ,
                                       δ
                                       ∈
                                       
                                          D
                                          w
                                       
                                       )
                                    
                                 ; and


                                 
                                    
                                       
                                          b
                                          ^
                                       
                                       =
                                       
                                          (
                                          
                                             b
                                             
                                                w
                                                ,
                                                
                                                   δ
                                                   ^
                                                
                                             
                                          
                                          :
                                          w
                                          ∈
                                          
                                             
                                                W
                                                ^
                                             
                                             on
                                          
                                          ,
                                          
                                             δ
                                             ^
                                          
                                          ∈
                                          
                                             
                                                D
                                                ^
                                             
                                             w
                                          
                                          )
                                       
                                    
                                 .

Clearly, the column-based formulation 
                           
                              
                                 
                                    P
                                    ^
                                 
                                 cb
                              
                              
                                 (
                                 
                                    P
                                    max
                                 
                                 )
                              
                           
                         for scheduling reconfiguration is an MILP problem. The number of variables in this formulation is bounded by 
                           
                              W
                              
                                 (
                                 T
                                 +
                                 1
                                 )
                              
                              +
                              W
                              
                                 t
                                 
                                    c
                                 
                                 max
                              
                              
                                 +
                                 |
                              
                              
                                 W
                                 off
                              
                              
                                 |
                              
                              
                                 δ
                                 max
                              
                              +
                              
                                 |
                                 
                                    W
                                    on
                                 
                                 |
                              
                              
                                 t
                                 
                                    on
                                 
                                 max
                              
                              ,
                           
                         with 
                           
                              
                                 |
                              
                              
                                 W
                                 off
                              
                              
                                 |
                              
                              
                                 δ
                                 max
                              
                              +
                              
                                 |
                                 
                                    W
                                    on
                                 
                                 |
                              
                              
                                 t
                                 
                                    on
                                 
                                 max
                              
                           
                         variables being integer. The number of constraints is bounded by 
                           
                              T
                              +
                              W
                              T
                              +
                              4
                              W
                              +
                              W
                              
                                 t
                                 
                                    c
                                 
                                 max
                              
                           
                        .

A logarithmic version of the column-based formulation can be derived by implementing the variable encoding described previously. The resulting logarithmic formulation would be equivalent to 
                           
                              
                                 
                                    P
                                    ^
                                 
                                 cb
                              
                              
                                 (
                                 
                                    P
                                    max
                                 
                                 )
                              
                              ,
                           
                         but instead would need a logarithmic number of binary variables.

The computational analysis aims to evaluate and compare the formulations for scheduling and reconfiguring pumpoff operations. A host of instances was generated in a pseudo-random manner by sampling uniformly from parameter ranges that are typical of onshore oilfields (Lake, 2007; Ribeiro, 2012; Tyler, 1994). More specifically, the oil fields consist of 20, 30, 40 and 50 rod pumps with a maximum cycle time of 10, 15 and 20 minutes. Time is measured in minutes with cycle times divided between t
                     on and t
                     off at random. The length of the prediction horizon was set to be a week, which corresponds to 
                        
                           T
                           
                           =
                           
                           10080
                        
                      minutes.

The formulations for scheduling and reconfiguration were expressed in AMPL (Fourer, Gay, & Kernighan, 2002) and then solved with IBM ILOG CPLEX version 12.4.01, CPLEX for short. The computational experiments were performed in a workstation with a 8-core Intel Xeon CPU E5-2665 @ 2.40GHz, the Linux operating system, and 40 gigabytes of RAM. Solving time was limited to 12 hours of CPU.


                     Table 2 presents the computational results obtained by solving the problem instances using the variable-based, column-based, and the logarithmic column-based formulation. The table gives the minimum power peak for each instance and the CPU time (in seconds) required to solve a given instance with each formulation. The value given in column P
                     max  is the minimum peak (the optimum objective) for all instances, except for the oilfield with 50 pumps and cycle times of at most 20 minutes. The entries of the table labeled with a “⋆” are those that the solver ran out of memory, whereas for the ones labeled with a “†” the solver reached the time limit. With the variable-based formulation, the relative difference between the obtained solution and the dual bound (GAP)
                        1
                     
                     
                        1
                        GAP is defined as 
                              
                                 |
                                 BestInteger
                                 −
                                 DualBound
                                 |
                                 /
                                 |
                                 BestInteger
                                 |
                                 .
                              
                           
                        
                      was 0.73 percent in the instance with 40 pumps and cycle length of 20 minutes. For the instance with 50 pumps and cycle of 20 minutes, the variable-based, column-based, and logarithmic column-based formulations achieved a GAP of 2.32, 1.54, and 1.48 percent, respectively. Table 2 also provides the number of variables and constraints for each problem instance and formulation.

The similar performance of the column-based formulations can be attributed to the similar structure and close number of variables and constraints. The number of binary variables of the baseline column-based formulation is 
                        
                           
                              ∑
                              
                                 w
                                 ∈
                                 W
                              
                           
                           
                              δ
                              w
                              max
                           
                        
                      whereas the logarithmic version has 
                        
                           
                              ∑
                              
                                 w
                                 ∈
                                 W
                              
                           
                           
                              ⌈
                              
                                 log
                                 2
                              
                              
                                 (
                                 
                                    δ
                                    w
                                    max
                                 
                                 +
                                 1
                                 )
                              
                              ⌉
                           
                           ,
                        
                      which may explain the observed computational results. A performance gain of the logarithmic column-based formulation could possibly be induced with an increase in the maximum delay 
                        
                           
                              δ
                              w
                              max
                           
                           ,
                        
                      which tends to increase with the length of cycle time.

On the other hand, the optimum was often obtained faster with the column-based formulations than the variable-based formulation. For the instances in which the optimum was not found, the column-based formulations did not run out of memory and reached a solution with GAP smaller than the variable-based formulation. This behavior may be attributed to a simpler structure of the column-based formulation according to which the pumping profile is fully defined by a single variable, b
                     
                        w, δ
                     , whereas the variable-based formulation has more degrees of freedom induced by the variables yw
                     (t) and zw
                     (t), which must satisfy more complex constraints to generate a feasible pumping profile.

For the instances considered, the results show that the column-based formulations achieved comparable performance in terms of CPU time. The variable-based formulation was somewhat less efficient than the column-based formulations, yielding solutions of inferior quality for the large instances. Notice that the variable-based formulation took less time on average, but this is because the solver was halted in two instances well before the time limit due to memory exhaustion. This performance indicates that the column-based formulations are more efficient with respect to memory use.

The formulations 
                        
                           
                              P
                              ^
                           
                           
                              (
                              
                                 P
                                 max
                              
                              )
                           
                        
                      for rescheduling pumpoff operations were also put to the test. The rescheduling instances were obtained from the instances considered above by requesting a reconfiguration at the end of a seven-day period. The minimum peak power P
                     max  that induces a feasible reschedule was calculated by a simple binary search. Because the baseline and logarithmic column-based formulations attained comparable performance in the scheduling problem, the reconfiguration analysis considered only the variable-based and the baseline column-based formulations. Table 3 presents the computational performance that the solver achieved in these formulations. For each instance, the table reports the maximum power peak P
                     max , the minimum number of rod pumps that will have their control policies adjusted, and the CPU time required to solve the respective instance. The number of variables and constraints for each formulation and instance are reported in the table. These results show that the problem of rescheduling pumpoff operations can be solved far more efficiently than the problem that sets the initial control policies.

As a reservoir matures and its internal pressure declines, artificial-lifting techniques are required to elevate the fluids from the bottom of the wells up to the surface for separation and processing. Among the artificial-lifting techniques, sucker-rod pumping is a widely applied technique in onshore oilfields for its relative low cost of installation and operation. The rod pumps operate according to a cyclic control policy that splits the control cycle in on and off pumping intervals.

The coordination of rod pumps gives rise to the problem of scheduling their control operations to minimize the system electric-power peak. A limit on the power peak is imposed by the power-utility company mainly because the power supply is restricted in remote areas, but also to reduce oscillations. To this end, this paper formalized the problem of scheduling pumpoff operations and proposed MILP formulations. The first formulation uses binary variables to induce rod-pump cyclic behavior, whereas the second follows a column-based strategy. A logarithmic version of the column-based formulation was obtained by using a logarithmic encoding of the binary variables. The computational experiments revealed that the column-based formulations are more efficient.

The paper also developed MILP formulations for the reconfiguration of pumpoff operations in order to keep the power peak within bounds, while minimizing control-policy readjustments. The computational analysis showed that the reconfiguration problem can be solved far more efficiently than the scheduling problem. Further, variable-based and column-based formulations achieved comparable performance in the considered instances.

A chief advantage of column-based formulations is that complex and time-varying power-consumption profiles can be modeled in a straightforward manner. Further, a column-generation approach may be devised to bring profiles on demand (Barnhart, Johnson, Nemhauser, Savelsbergh, & Vance, 1998; Dantzig & Wolfe, 1960), rather than introducing all of the columns at once. Finally, the models presented heretofore could be extended to address the scheduling of electric submersible pumps, which is a favorite technique for artificial lifting in heavy oil reservoirs located off the coast (Solbraekke, 2014). These are topics for future research and development.

@&#ACKNOWLEDGMENTS@&#

The problem of scheduling pumpoff operations emerged from the discussions during the Fourth Technical Meeting of Well Automation organized by Eng. Paulo José Pinto Ribeiro, held in Natal, Brazil, in December 2012. The authors thank the anonymous reviewers for their contributions.

@&#REFERENCES@&#

