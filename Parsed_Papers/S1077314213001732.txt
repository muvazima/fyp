@&#MAIN-TITLE@&#Bayesian perspective for the registration of multiple 3D views

@&#HIGHLIGHTS@&#


               
               
                  
                     
                        
                           
                           Use of a Bayesian framework allows tolerance to incorrect pairwise registrations.


                        
                        
                           
                           Correspondence weights vary depending on their reliability, until a specific criteria is achieved.


                        
                        
                           
                           Results show that an important improvement is achieved in objects with degraded correspondences.


                        
                        
                           
                           Also in cases without degraded correspondences, the proposed method improves the accuracy in comparison to other methods.


                        
                     
                  
               
            

@&#KEYPHRASES@&#

3D registration

Pairwise correspondences

Expectation Maximization algorithm

@&#ABSTRACT@&#


               
               
                  The registration of multiple 3D structures in order to obtain a full-side representation of a scene is a long-time studied subject. Even if the multiple pairwise registrations are almost correct, usually the concatenation of them along a cycle produces a non-satisfactory result at the end of the process due to the accumulation of the small errors. Obviously, the situation can still be worse if, in addition, we have incorrect pairwise correspondences between the views. In this paper, we embed the problem of global multiple views registration into a Bayesian framework, by means of an Expectation–Maximization (EM) algorithm, where pairwise correspondences are treated as missing data and, therefore, inferred through a maximum a posteriori (MAP) process. The presented formulation simultaneously considers uncertainty on pairwise correspondences and noise, allowing a final result which outperforms, in terms of accuracy and robustness, other state-of-the-art algorithms. Experimental results show a reliability analysis of the presented algorithm with respect to the percentage of a priori incorrect correspondences and their consequent effect on the global registration estimation. This analysis compares current state-of-the-art global registration methods with our formulation revealing that the introduction of a Bayesian formulation allows reaching configurations with a lower minimum of the global cost function.
               
            

@&#INTRODUCTION@&#

Current technology allows to obtain 3D representations of real objects or scenarios by using different methods. From usual methods like stereoscopy to complex devices like LADAR or time-of-flight cameras, the possibilities are growing continuously. However, acquisition techniques usually have problems with occluded surfaces or the limited field of view, so it is usually necessary to combine different views of the same object or scenario in order to obtain a full representation. Using this process another problem then arises: the registration of these individual 3D views which will enable, at the end of the process, to a whole 3D reconstruction of the desired object or scene.

First step for this objective is the so-called pairwise registration, where the 3D representations are registered pair to pair. Depending if the two structures have overlap, pairwise registration methods will give as a result a transformation which registers the first 3D view to the second one.

Multiview registration is the second step of this process, and is usually a more complex situation. Assuming that pairwise registrations are correct, their concatenation along a cycle will probably result in a non-satisfactory multiview registration because of the accumulation of the different pairwise errors. An example of this effect can be seen in Fig. 1
                     .

In addition, there could exist another situation which produces more problems. Even if two structures register perfectly in the pairwise registration process, their transformation could be incorrect in a global environment. This could happen specially if we are working with objects with symmetries, planes or repetitive patterns. In these cases, most of the current multiview registration algorithms will fail because they are not ready to deal with this kind of error.

The main contribution of this paper, in opposition to other state-of-the-art papers, is the possibility of detecting these incorrect registrations between different views and therefore minimize their impact in the global registration process. This feature is achieved thanks to the use of different weights which encode the reliability we have in the correspondences between the views.

The structure of the document is as follows: a review of different registration algorithms is presented in Section 2, followed by an introduction to the main problematic of multiview registration in Section 3. The proposed algorithm is explained in detail in Section 4, and the obtained experimental results are shown in Section 5. Finally, conclusions and possible future improvements are explained at the end of the paper in Section 6.

As previously stated the first step in order to achieve the registration of multiple 3D representations is the computation of the pairwise registrations. The most usual method consists in the establishment of correspondences between points of the two views, which can be found by using descriptors like the Spin-Images of Johnson and Hebert [1] or covariance descriptors like the one presented by Fehr et al. in [2]. The combination of correspondences between the two views determines an approximated transformation between them, having a minimum of 3 point correspondences in order to obtain it. This step is known as coarse pairwise registration. After this approximation, the transformation is refined by the so-called fine pairwise registration methods, which minimize the distance between all the points of both point clouds. The most representative examples of fine coarse registration methods are the Iterative Closest Point [3] presented by Besl and McKay in 1992 and the registration algorithm developed by Chen and Medioni [4]. At the end of this pairwise registration execution we will obtain a rigid transformation, composed by a rotation matrix and a translation vector, which registers the first view to the second one.

With respect to the multiview registration algorithms, they can be basically divided into two families: sequential registration methods and simultaneous registration methods.

The first ones consist in the sequential pairwise registration of additional views to an aggregated view which is continuously growing. This aggregated view is also denominated metaview in some literature, as stated in Matabosch et al. [5]. This method was initially proposed in the aforesaid paper of Chen and Medioni [4] and afterwards improved in the works presented by Pulli [6] and Nuchter et al. [7]. This kind of multiview registration methods have the advantage that they do not need to previously obtain all the views implicated in the registration process, so they do not suffer problems of memory in their execution and can also be useful for applications where the 3D structures are acquired at the same time as the registration is produced, achieving a performance which could be considered near to real-time. However, their main problem is the non-possibility of modifying the already registered views, producing a final result which is usually not as ideal as desired.

On the other side, simultaneous registration methods make use of all the information of pairwise registrations at the same time. A good example of this kind of method is the work presented by Eggert et al. [8], where the authors present an iterative algorithm which simultaneously updates the transformations of all the views by using the information of position and normal of the correspondence points. In Silva et al. [9] the multiview registration is achieved thanks to the use of genetic algorithms and a metric defined by the authors called Surface Interpenetration Measure, which indicates the level of confidence on a registration according to the multiple crossings of the surfaces between themselves (i.e. the interpenetration between themselves).

Inside the category of simultaneous registration methods a high number of papers base their algorithm on the use of a registration graph which encodes the different pairwise relations between the 3D views. Each node on a registration graph represents an specific view of the object, while each edge encodes the rigid transformation (rotation and translation) between two views. As can be seen in the registration graph of Fig. 2
                     , each node is connected, at least, with the previous and the following node of the sequence of views and, in addition, with a variable number of additional nodes. The establishment of these additional edges to non-contiguous nodes may depend on the result of the automatic pairwise registration between the views (if the registration quality is lower than a pre-defined threshold, this registration is discarded) or also on the preferences of the user.

In order to obtain the multiview registration some properties of the registration graph are usually applied, like the property that rotations and translations along a loop of the registration graph should be null. This is the basis for the work presented by Sharp et al. [10], where, for the different basic cycles of the registration graph, the error in rotation and translation is distributed along all the edges. Also the concept of graphs minimization is used in Shih et al. [11] where, using concepts of Lie algebra and circuit theory, the authors develop an algorithm which achieves good results in standard databases, also with the advantage of having a low computational cost.

Other papers do not mention explicitly the concept of graph but use it intrinsically, using the same properties and ideas. A good example are the two papers presented by Krishnan et al. [12,13] which are based on the notion that, concatenating translations and rotations along a path, the same 3D view should be obtained independently on the direction we use to arrive to it. One particularity of this method is that it directly works with the correspondences itself and not with the rigid transformations obtained from the pairwise registration methods, so the algorithm uses all the data without losing any information. This fact causes an apparent complexity of the formulation, but using some concepts of Lie algebra and manifolds the authors achieve a compact representation of the problem. These two papers of Krishnan et al. are used as the basis of our algorithm due to the interesting conceptualization of the problem and the good results obtained after their implementation.

Independently of the election of using a sequential registration method or a simultaneous registration method, one of the main lacks of the aforesaid papers and the majority of other state-of-the-art publications is that they do not take into account the possibility of having absolutely bad registrations or bad correspondences. One of the few papers that deal with this possibility is the work presented by Hubert and Hebert in 2003 [14], where using the joint distribution probabilities the incorrect correspondences are eliminated and, in consequence, the graph can be separated into different splitted sub-graphs which can afterwards be studied individually. As developed in the following sections of the present paper, our algorithm will also serve for the detection of incorrect correspondences between the views, allowing to minimize the impact of this incorrect information into the global registration process.

The most usual problem related with the multiview registration process is the minimization of the global error which is produced due to the small errors in every pairwise registration. These errors could be produced by different factors, like a noisy acquisition process, differences in the 3D structure of two overlapping views due to the different date of acquisition, or, in most of the cases, by an inaccurate selection of correspondences. Having a look at the example already shown in the left side of Fig. 1 it can be easily seen that the result using only the information from the pairwise registration is not enough in order to obtain a good result.

There is another possible problem in the multiview registration process which is in fact more problematic and difficult to solve: the possibility of having not only small errors on the registrations but also absolutely incorrect registrations. Consider the example shown in Fig. 3
                     , where different views of a horn are shown. Pairwise registration between different views can be correctly established in most of the cases, but there are some ones which could cause problems. Imagine the pairwise registration of view number 3 or 4 against view number 15. Although the object has been rotated around its longitudinal axis (the color of the balls inside the horn demonstrate this rotation) a pairwise registration algorithm could estimate a registration which, after applying it with the other pairwise registrations, produce a result similar to the one shown in Fig. 4
                     . Similar problems can also be produced if there exist objects with symmetries, planes or repetitive patterns. This is also a common problem in the registration of a model against an scene, where the same object can have multiple instances as studied in [15].

In order to solve these two types of problems, and especially the second one, we need to combine both local and global information, or in other words, the information from the pairwise registrations and from the whole multiview result. The proposed novel algorithm in order to solve these issues is presented in the following in Section 4.

In this section our developed method for the 3D registration of multiple views is explained, which will be called Bayesian-Based Multiview Registration (BBMR) method in the following. As previously stated, this method is based on the previous work presented by Krishnan et al. in [13]. In our work we apply an additional layer over this method, adding an uncertainty which is solved thanks to the use of the Expectation Maximization algorithm.

As an introduction to the problem, we first describe the notation used for the different elements and in a second subsection the proposed Bayesian framework and its resolution using the Expectation Maximization algorithm is presented.

According to the notation used in [13], let us consider a set of n points W
                        ={w
                        1,…,
                        w
                        
                           n
                        } in a world reference frame. These points can be seen from N different views V
                        1,…,
                        V
                        
                           N
                        , where 
                           
                              
                                 
                                    V
                                 
                                 
                                    i
                                 
                              
                              =
                              {
                              
                                 
                                    v
                                 
                                 
                                    i
                                 
                                 
                                    1
                                 
                              
                              ,
                              …
                              ,
                              
                                 
                                    v
                                 
                                 
                                    i
                                 
                                 
                                    
                                       
                                          n
                                       
                                       
                                          i
                                       
                                    
                                 
                              
                              }
                           
                        . Each view V
                        
                           i
                         can only see a limited number of the total n points, so it is supposed that each n
                        
                           i
                         must be lower or equal to n. In addition, the notation of V
                        
                           ij
                         is used to describe the set of points from V
                        
                           i
                         which can be seen also from V
                        
                           j
                        , so in consequence n
                        
                           ij
                         defines the number of points from V
                        
                           i
                         which can be seen from V
                        
                           j
                         and therefore n
                        
                           ij
                        
                        =
                        n
                        
                           ji
                        .

Each view V
                        
                           i
                         connects with the world reference frame by means of relative rotation and translation matrices (R
                        
                           i
                        ,
                        t
                        
                           i
                        ), such that:
                           
                              (1)
                              
                                 
                                    
                                       
                                       
                                          
                                             
                                                
                                                   w
                                                
                                                
                                                   k
                                                
                                             
                                             =
                                             
                                                
                                                   R
                                                
                                                
                                                   i
                                                
                                             
                                             
                                                
                                                   v
                                                
                                                
                                                   ij
                                                
                                                
                                                   k
                                                
                                             
                                             +
                                             
                                                
                                                   t
                                                
                                                
                                                   i
                                                
                                             
                                          
                                       
                                    
                                    
                                       
                                       
                                          
                                             
                                                
                                                   w
                                                
                                                
                                                   k
                                                
                                             
                                             =
                                             
                                                
                                                   R
                                                
                                                
                                                   j
                                                
                                             
                                             
                                                
                                                   v
                                                
                                                
                                                   ji
                                                
                                                
                                                   k
                                                
                                             
                                             +
                                             
                                                
                                                   t
                                                
                                                
                                                   j
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           
                        
                     

In a noise free context there would be an equivalence 
                           
                              
                                 
                                    R
                                 
                                 
                                    i
                                 
                              
                              
                                 
                                    v
                                 
                                 
                                    ij
                                 
                                 
                                    k
                                 
                              
                              +
                              
                                 
                                    t
                                 
                                 
                                    i
                                 
                              
                              =
                              
                                 
                                    R
                                 
                                 
                                    j
                                 
                              
                              
                                 
                                    v
                                 
                                 
                                    ji
                                 
                                 
                                    k
                                 
                              
                              +
                              
                                 
                                    t
                                 
                                 
                                    j
                                 
                              
                           
                         between both sets of points, but in a more realistic case and considering the presence of noise, the minimization error function used to estimate the parameters (R
                        
                           i
                        ,
                        t
                        
                           i
                        ) and (R
                        
                           j
                        ,
                        t
                        
                           j
                        ) takes the following form:
                           
                              (2)
                              
                                 ε
                                 =
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          k
                                          =
                                          1
                                       
                                       
                                          
                                             
                                                n
                                             
                                             
                                                ij
                                             
                                          
                                       
                                    
                                 
                                 
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         
                                                            R
                                                         
                                                         
                                                            i
                                                         
                                                      
                                                      
                                                         
                                                            v
                                                         
                                                         
                                                            ij
                                                         
                                                         
                                                            k
                                                         
                                                      
                                                      +
                                                      
                                                         
                                                            t
                                                         
                                                         
                                                            i
                                                         
                                                      
                                                   
                                                
                                             
                                             -
                                             
                                                
                                                   
                                                      
                                                         
                                                            R
                                                         
                                                         
                                                            j
                                                         
                                                      
                                                      
                                                         
                                                            v
                                                         
                                                         
                                                            ji
                                                         
                                                         
                                                            k
                                                         
                                                      
                                                      +
                                                      
                                                         
                                                            t
                                                         
                                                         
                                                            j
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                    
                                       2
                                    
                                 
                              
                           
                        
                     

Applying this expression to all the correspondences between the views:
                           
                              (3)
                              
                                 ε
                                 =
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          i
                                          =
                                          1
                                       
                                       
                                          N
                                       
                                    
                                 
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          j
                                          =
                                          i
                                          +
                                          1
                                       
                                       
                                          N
                                       
                                    
                                 
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          k
                                          =
                                          1
                                       
                                       
                                          
                                             
                                                n
                                             
                                             
                                                ij
                                             
                                          
                                       
                                    
                                 
                                 
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         
                                                            R
                                                         
                                                         
                                                            i
                                                         
                                                      
                                                      
                                                         
                                                            v
                                                         
                                                         
                                                            ij
                                                         
                                                         
                                                            k
                                                         
                                                      
                                                      +
                                                      
                                                         
                                                            t
                                                         
                                                         
                                                            i
                                                         
                                                      
                                                   
                                                
                                             
                                             -
                                             
                                                
                                                   
                                                      
                                                         
                                                            R
                                                         
                                                         
                                                            j
                                                         
                                                      
                                                      
                                                         
                                                            v
                                                         
                                                         
                                                            ji
                                                         
                                                         
                                                            k
                                                         
                                                      
                                                      +
                                                      
                                                         
                                                            t
                                                         
                                                         
                                                            j
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                    
                                       2
                                    
                                 
                              
                           
                        
                     

As you can see in [13], Eq. (3) corresponds to the registration error cost function of the Krishnan method. From this point on, we introduce the novel parts of our method, starting by the uncertainty on the points correspondences.

In order to evaluate the possible incorrect correspondences, let us assume that there is no prior knowledge between points from two different views, and therefore, the model in Eq. (3) should be generalized in the following way:
                           
                              (4)
                              
                                 ε
                                 =
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          i
                                          =
                                          1
                                       
                                       
                                          N
                                       
                                    
                                 
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          j
                                          =
                                          i
                                          +
                                          1
                                       
                                       
                                          N
                                       
                                    
                                 
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          k
                                          =
                                          1
                                       
                                       
                                          
                                             
                                                n
                                             
                                             
                                                ij
                                             
                                          
                                       
                                    
                                 
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          
                                             
                                                k
                                             
                                             
                                                ′
                                             
                                          
                                          =
                                          1
                                       
                                       
                                          
                                             
                                                n
                                             
                                             
                                                ji
                                             
                                          
                                       
                                    
                                 
                                 
                                    
                                       ω
                                    
                                    
                                       ij
                                    
                                    
                                       
                                          
                                             kk
                                          
                                          
                                             ′
                                          
                                       
                                    
                                 
                                 
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         
                                                            R
                                                         
                                                         
                                                            i
                                                         
                                                      
                                                      
                                                         
                                                            v
                                                         
                                                         
                                                            ij
                                                         
                                                         
                                                            k
                                                         
                                                      
                                                      +
                                                      
                                                         
                                                            t
                                                         
                                                         
                                                            i
                                                         
                                                      
                                                   
                                                
                                             
                                             -
                                             
                                                
                                                   
                                                      
                                                         
                                                            R
                                                         
                                                         
                                                            j
                                                         
                                                      
                                                      
                                                         
                                                            v
                                                         
                                                         
                                                            ji
                                                         
                                                         
                                                            
                                                               
                                                                  k
                                                               
                                                               
                                                                  ′
                                                               
                                                            
                                                         
                                                      
                                                      +
                                                      
                                                         
                                                            t
                                                         
                                                         
                                                            j
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                    
                                       2
                                    
                                 
                              
                           
                        where 
                           
                              
                                 
                                    ω
                                 
                                 
                                    ij
                                 
                                 
                                    
                                       
                                          kk
                                       
                                       
                                          ′
                                       
                                    
                                 
                              
                           
                         is an element of the weight matrix that indicates the degree of confidence for a correspondence of points 
                           
                              
                                 
                                    v
                                 
                                 
                                    ij
                                 
                                 
                                    k
                                 
                              
                           
                         and 
                           
                              
                                 
                                    v
                                 
                                 
                                    ji
                                 
                                 
                                    
                                       
                                          k
                                       
                                       
                                          ′
                                       
                                    
                                 
                              
                           
                        .

As a simplification of the expression, we can define a new index 
                           
                              
                                 
                                    k
                                 
                                 
                                    ˆ
                                 
                              
                           
                         as a re-ordered version of the double indexing k and k′. Applying this indexing change, Eq. (4) would be expressed as:
                           
                              (5)
                              
                                 ε
                                 =
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          i
                                          =
                                          1
                                       
                                       
                                          N
                                       
                                    
                                 
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          j
                                          =
                                          i
                                          +
                                          1
                                       
                                       
                                          N
                                       
                                    
                                 
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          
                                             
                                                k
                                             
                                             
                                                ˆ
                                             
                                          
                                          =
                                          1
                                       
                                       
                                          
                                             
                                                m
                                             
                                             
                                                ij
                                             
                                          
                                       
                                    
                                 
                                 
                                    
                                       ω
                                    
                                    
                                       ij
                                    
                                    
                                       
                                          
                                             k
                                          
                                          
                                             ˆ
                                          
                                       
                                    
                                 
                                 
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         
                                                            R
                                                         
                                                         
                                                            i
                                                         
                                                      
                                                      
                                                         
                                                            v
                                                         
                                                         
                                                            ij
                                                         
                                                         
                                                            
                                                               
                                                                  k
                                                               
                                                               
                                                                  ˆ
                                                               
                                                            
                                                         
                                                      
                                                      +
                                                      
                                                         
                                                            t
                                                         
                                                         
                                                            i
                                                         
                                                      
                                                   
                                                
                                             
                                             -
                                             
                                                
                                                   
                                                      
                                                         
                                                            R
                                                         
                                                         
                                                            j
                                                         
                                                      
                                                      
                                                         
                                                            v
                                                         
                                                         
                                                            ji
                                                         
                                                         
                                                            
                                                               
                                                                  k
                                                               
                                                               
                                                                  ˆ
                                                               
                                                            
                                                         
                                                      
                                                      +
                                                      
                                                         
                                                            t
                                                         
                                                         
                                                            j
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                    
                                       2
                                    
                                 
                              
                           
                        where 
                           
                              
                                 
                                    m
                                 
                                 
                                    ij
                                 
                              
                              ≡
                              
                                 
                                    n
                                 
                                 
                                    ij
                                 
                              
                              ×
                              
                                 
                                    n
                                 
                                 
                                    ji
                                 
                              
                              =
                              
                                 
                                    n
                                 
                                 
                                    ij
                                 
                                 
                                    2
                                 
                              
                           
                        
                     

Let us represent a point correspondence between two specific views V
                        
                           i
                         and V
                        
                           j
                         as 
                           
                              
                                 
                                    x
                                 
                                 
                                    ij
                                 
                                 
                                    
                                       
                                          k
                                       
                                       
                                          ˆ
                                       
                                    
                                 
                              
                              =
                              
                                 
                                    
                                       
                                          
                                             v
                                          
                                          
                                             ij
                                          
                                          
                                             k
                                          
                                       
                                       ,
                                       
                                          
                                             v
                                          
                                          
                                             ji
                                          
                                          
                                             
                                                
                                                   k
                                                
                                                
                                                   ′
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           
                        , and let θ
                        
                           ij
                        
                        =(R
                        
                           i
                        ,
                        t
                        
                           i
                        ,
                        R
                        
                           j
                        ,
                        t
                        
                           j
                        ) represent the model parameters of these two views which should be estimated. The objective is to maximize the joint likelihood distribution 
                           
                              P
                              (
                              
                                 
                                    X
                                 
                                 
                                    ij
                                 
                              
                              |
                              
                                 
                                    θ
                                 
                                 
                                    ij
                                 
                              
                              )
                           
                         of the observed data 
                           
                              
                                 
                                    X
                                 
                                 
                                    ij
                                 
                              
                              =
                              
                                 
                                    
                                       
                                          
                                             x
                                          
                                          
                                             ij
                                          
                                          
                                             1
                                          
                                       
                                       ,
                                       …
                                       ,
                                       
                                          
                                             x
                                          
                                          
                                             ij
                                          
                                          
                                             
                                                
                                                   m
                                                
                                                
                                                   ij
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           
                        .

The optimization of 
                           
                              P
                              
                                 
                                    
                                       
                                          
                                             x
                                          
                                          
                                             ij
                                          
                                          
                                             1
                                          
                                       
                                       ,
                                       …
                                       ,
                                       
                                          
                                             x
                                          
                                          
                                             ij
                                          
                                          
                                             
                                                
                                                   m
                                                
                                                
                                                   ij
                                                
                                             
                                          
                                       
                                       |
                                       
                                          
                                             θ
                                          
                                          
                                             ij
                                          
                                       
                                    
                                 
                              
                           
                         can be a difficult task if pairwise relations are unknown. In order to solve this problem, we introduce a set of binary latent variables 
                           
                              
                                 
                                    Z
                                 
                                 
                                    ij
                                 
                              
                              =
                              
                                 
                                    
                                       
                                          
                                             z
                                          
                                          
                                             ij
                                          
                                          
                                             1
                                          
                                       
                                       ,
                                       …
                                       ,
                                       
                                          
                                             z
                                          
                                          
                                             ij
                                          
                                          
                                             
                                                
                                                   m
                                                
                                                
                                                   ij
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           
                        , which can be considered as indicator variables of the correspondence between a pair of points 
                           
                              
                                 
                                    x
                                 
                                 
                                    ij
                                 
                                 
                                    
                                       
                                          k
                                       
                                       
                                          ˆ
                                       
                                    
                                 
                              
                              =
                              (
                              
                                 
                                    v
                                 
                                 
                                    ij
                                 
                                 
                                    k
                                 
                              
                              ,
                              
                                 
                                    v
                                 
                                 
                                    ji
                                 
                                 
                                    
                                       
                                          k
                                       
                                       
                                          ′
                                       
                                    
                                 
                              
                              )
                           
                        . In an ideal case, where the correspondences were “a priori” known, 
                           
                              
                                 
                                    z
                                 
                                 
                                    ij
                                 
                                 
                                    
                                       
                                          k
                                       
                                       
                                          ˆ
                                       
                                    
                                 
                              
                           
                         should be 1 only for those valid 
                           
                              
                                 
                                    x
                                 
                                 
                                    ij
                                 
                                 
                                    
                                       
                                          k
                                       
                                       
                                          ˆ
                                       
                                    
                                 
                              
                           
                         correspondences and 0 for the rest of pairs of points between the sets V
                        
                           i
                         and V
                        
                           j
                        . However, the variables Z
                        
                           ij
                         are hidden or, in other words, cannot be directly observed. If their value was known, then {X
                        
                           ij
                        ,
                        Z
                        
                           ij
                        } would be considered as the complete data set, and therefore, this estimation problem could be easily solved.

Assuming conditional independence on the observations 
                           
                              
                                 
                                    X
                                 
                                 
                                    ij
                                 
                              
                              =
                              
                                 
                                    
                                       
                                          
                                             x
                                          
                                          
                                             ij
                                          
                                          
                                             1
                                          
                                       
                                       ,
                                       …
                                       ,
                                       
                                          
                                             x
                                          
                                          
                                             ij
                                          
                                          
                                             
                                                
                                                   m
                                                
                                                
                                                   ij
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           
                         and the latent variables 
                           
                              
                                 
                                    Z
                                 
                                 
                                    ij
                                 
                              
                              =
                              
                                 
                                    
                                       
                                          
                                             z
                                          
                                          
                                             ij
                                          
                                          
                                             1
                                          
                                       
                                       ,
                                       …
                                       ,
                                       
                                          
                                             z
                                          
                                          
                                             ij
                                          
                                          
                                             
                                                
                                                   m
                                                
                                                
                                                   ij
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           
                        , the joint distribution of the complete data set factorizes as follows:
                           
                              (6)
                              
                                 P
                                 (
                                 
                                    
                                       X
                                    
                                    
                                       ij
                                    
                                 
                                 ,
                                 
                                    
                                       Z
                                    
                                    
                                       ij
                                    
                                 
                                 |
                                 
                                    
                                       θ
                                    
                                    
                                       ij
                                    
                                 
                                 )
                                 =
                                 
                                    
                                       
                                          ∏
                                       
                                       
                                          
                                             
                                                k
                                             
                                             
                                                ˆ
                                             
                                          
                                          =
                                          1
                                       
                                       
                                          
                                             
                                                m
                                             
                                             
                                                ij
                                             
                                          
                                       
                                    
                                 
                                 P
                                 
                                    
                                       
                                          
                                             
                                                x
                                             
                                             
                                                ij
                                             
                                             
                                                
                                                   
                                                      k
                                                   
                                                   
                                                      ˆ
                                                   
                                                
                                             
                                          
                                          ,
                                          
                                             
                                                z
                                             
                                             
                                                ij
                                             
                                             
                                                
                                                   
                                                      k
                                                   
                                                   
                                                      ˆ
                                                   
                                                
                                             
                                          
                                          |
                                          
                                             
                                                θ
                                             
                                             
                                                ij
                                             
                                          
                                       
                                    
                                 
                              
                           
                        which according to the binary nature of the latent variables Z takes the following form:
                           
                              (7)
                              
                                 P
                                 (
                                 
                                    
                                       X
                                    
                                    
                                       ij
                                    
                                 
                                 ,
                                 
                                    
                                       Z
                                    
                                    
                                       ij
                                    
                                 
                                 |
                                 
                                    
                                       θ
                                    
                                    
                                       ij
                                    
                                 
                                 )
                                 =
                                 
                                    
                                       
                                          ∏
                                       
                                       
                                          
                                             
                                                k
                                             
                                             
                                                ˆ
                                             
                                          
                                          =
                                          1
                                       
                                       
                                          
                                             
                                                m
                                             
                                             
                                                ij
                                             
                                          
                                       
                                    
                                 
                                 P
                                 
                                    
                                       
                                          
                                             
                                                
                                                   x
                                                
                                                
                                                   ij
                                                
                                                
                                                   
                                                      
                                                         k
                                                      
                                                      
                                                         ˆ
                                                      
                                                   
                                                
                                             
                                             |
                                             
                                                
                                                   θ
                                                
                                                
                                                   ij
                                                
                                             
                                          
                                       
                                    
                                    
                                       
                                          
                                             z
                                          
                                          
                                             ij
                                          
                                          
                                             
                                                
                                                   k
                                                
                                                
                                                   ˆ
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           
                        
                     

Applying the logarithm we obtain the joint log-likelihood of the data set as follows:
                           
                              (8)
                              
                                 log
                                 [
                                 P
                                 (
                                 
                                    
                                       X
                                    
                                    
                                       ij
                                    
                                 
                                 ,
                                 
                                    
                                       Z
                                    
                                    
                                       ij
                                    
                                 
                                 |
                                 
                                    
                                       θ
                                    
                                    
                                       ij
                                    
                                 
                                 )
                                 ]
                                 =
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          
                                             
                                                k
                                             
                                             
                                                ˆ
                                             
                                          
                                          =
                                          1
                                       
                                       
                                          
                                             
                                                m
                                             
                                             
                                                ij
                                             
                                          
                                       
                                    
                                 
                                 
                                    
                                       z
                                    
                                    
                                       ij
                                    
                                    
                                       
                                          
                                             k
                                          
                                          
                                             ˆ
                                          
                                       
                                    
                                 
                                 log
                                 
                                    
                                       
                                          P
                                          (
                                          
                                             
                                                x
                                             
                                             
                                                ij
                                             
                                             
                                                
                                                   
                                                      k
                                                   
                                                   
                                                      ˆ
                                                   
                                                
                                             
                                          
                                          |
                                          
                                             
                                                θ
                                             
                                             
                                                ij
                                             
                                          
                                          )
                                       
                                    
                                 
                              
                           
                        where if Z
                        
                           ij
                         is known a priori, only the terms indicating correspondence between pairs of points, i.e. 
                           
                              
                                 
                                    z
                                 
                                 
                                    ij
                                 
                                 
                                    
                                       
                                          k
                                       
                                       
                                          ˆ
                                       
                                    
                                 
                              
                              =
                              1
                           
                         would contribute to the summation of this log-likelihood function. In addition, if we consider Eq. (5) as the result of a negative logarithm of a Gaussian distribution, we can see a convergence of the probabilistic formulation in Eq. (8) and the previous least squares error problem:
                           
                              (9)
                              
                                 log
                                 [
                                 P
                                 
                                    
                                       
                                          
                                             
                                                x
                                             
                                             
                                                ij
                                             
                                             
                                                
                                                   
                                                      k
                                                   
                                                   
                                                      ˆ
                                                   
                                                
                                             
                                          
                                          =
                                          
                                             
                                                
                                                   
                                                      
                                                         v
                                                      
                                                      
                                                         ij
                                                      
                                                      
                                                         k
                                                      
                                                   
                                                   ,
                                                   
                                                      
                                                         v
                                                      
                                                      
                                                         ji
                                                      
                                                      
                                                         
                                                            
                                                               k
                                                            
                                                            
                                                               ′
                                                            
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                          |
                                          
                                             
                                                θ
                                             
                                             
                                                ij
                                             
                                          
                                       
                                    
                                 
                                 ]
                                 ∝
                                 -
                                 
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         
                                                            R
                                                         
                                                         
                                                            i
                                                         
                                                      
                                                      
                                                         
                                                            v
                                                         
                                                         
                                                            ij
                                                         
                                                         
                                                            k
                                                         
                                                      
                                                      +
                                                      
                                                         
                                                            t
                                                         
                                                         
                                                            i
                                                         
                                                      
                                                   
                                                
                                             
                                             -
                                             
                                                
                                                   
                                                      
                                                         
                                                            R
                                                         
                                                         
                                                            j
                                                         
                                                      
                                                      
                                                         
                                                            v
                                                         
                                                         
                                                            ji
                                                         
                                                         
                                                            
                                                               
                                                                  k
                                                               
                                                               
                                                                  ′
                                                               
                                                            
                                                         
                                                      
                                                      +
                                                      
                                                         
                                                            t
                                                         
                                                         
                                                            j
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                    
                                       2
                                    
                                 
                              
                           
                        and therefore
                           
                              (10)
                              
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          
                                             
                                                k
                                             
                                             
                                                ˆ
                                             
                                          
                                          =
                                          1
                                       
                                       
                                          
                                             
                                                m
                                             
                                             
                                                ij
                                             
                                          
                                       
                                    
                                 
                                 
                                    
                                       z
                                    
                                    
                                       ij
                                    
                                    
                                       
                                          
                                             k
                                          
                                          
                                             ˆ
                                          
                                       
                                    
                                 
                                 log
                                 
                                    
                                       
                                          P
                                          (
                                          
                                             
                                                x
                                             
                                             
                                                ij
                                             
                                             
                                                
                                                   
                                                      k
                                                   
                                                   
                                                      ˆ
                                                   
                                                
                                             
                                          
                                          =
                                          
                                             
                                                
                                                   
                                                      
                                                         v
                                                      
                                                      
                                                         ij
                                                      
                                                      
                                                         k
                                                      
                                                   
                                                   ,
                                                   
                                                      
                                                         v
                                                      
                                                      
                                                         ji
                                                      
                                                      
                                                         
                                                            
                                                               k
                                                            
                                                            
                                                               ′
                                                            
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                          |
                                          
                                             
                                                θ
                                             
                                             
                                                ij
                                             
                                          
                                          )
                                       
                                    
                                 
                                 ∝
                                 -
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          i
                                          =
                                          1
                                       
                                       
                                          N
                                       
                                    
                                 
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          j
                                          =
                                          i
                                          +
                                          1
                                       
                                       
                                          N
                                       
                                    
                                 
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          
                                             
                                                k
                                             
                                             
                                                ˆ
                                             
                                          
                                          =
                                          1
                                       
                                       
                                          
                                             
                                                m
                                             
                                             
                                                ij
                                             
                                          
                                       
                                    
                                 
                                 
                                    
                                       ω
                                    
                                    
                                       ij
                                    
                                    
                                       
                                          
                                             k
                                          
                                          
                                             ˆ
                                          
                                       
                                    
                                 
                                 
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         
                                                            R
                                                         
                                                         
                                                            i
                                                         
                                                      
                                                      
                                                         
                                                            v
                                                         
                                                         
                                                            ij
                                                         
                                                         
                                                            k
                                                         
                                                      
                                                      +
                                                      
                                                         
                                                            t
                                                         
                                                         
                                                            i
                                                         
                                                      
                                                   
                                                
                                             
                                             -
                                             
                                                
                                                   
                                                      
                                                         
                                                            R
                                                         
                                                         
                                                            j
                                                         
                                                      
                                                      
                                                         
                                                            v
                                                         
                                                         
                                                            ji
                                                         
                                                         
                                                            
                                                               
                                                                  k
                                                               
                                                               
                                                                  ′
                                                               
                                                            
                                                         
                                                      
                                                      +
                                                      
                                                         
                                                            t
                                                         
                                                         
                                                            j
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                    
                                       2
                                    
                                 
                              
                           
                        
                     

The context of observations X
                        
                           ij
                         and the simultaneous inference of latent variables Z
                        
                           ij
                         and estimation of model parameters θ
                        
                           ij
                         can be tackled by means of the Expectation–Maximization (EM) algorithm. The EM algorithm was initially presented in 1977 by Dempster et al. in [16] and its possibilities are discussed in detail in [17]. It has been previously used in the field of registration, as can be seen in the work presented by Cross and Hancock [18] or, more specifically in the 3D surface registration field, in the works of Granger and Pennec [19] and Horaud et al. [20].

Basically, the EM algorithm is a fixed-point fashion procedure that operates in two steps, which are repeated alternately until convergence:
                           
                              
                                 Expectation
                              

Given an intermediate iteration step l with an instance of the model parameters θ
                                 
                                    l
                                 , compute the posterior probability for latent variables z
                                 
                                    i
                                 .


                                 Maximization
                              

Given the posterior probability 
                                    
                                       P
                                       (
                                       Z
                                       |
                                       X
                                       ,
                                       
                                       
                                          
                                             θ
                                          
                                          
                                             l
                                          
                                       
                                       )
                                    
                                 , compute the expected value of the joint log-likelihood of the complete data set {X,
                                 Z} and find the parameters θ
                                 
                                    l+1 that maximize it. As pointed out in Appendix A:
                                    
                                       (11)
                                       
                                          
                                             
                                                θ
                                             
                                             
                                                l
                                                +
                                                1
                                             
                                          
                                          =
                                          arg
                                          
                                             
                                                
                                                   max
                                                
                                                
                                                   θ
                                                
                                             
                                          
                                          
                                             
                                                
                                                   
                                                      
                                                         
                                                            ∑
                                                         
                                                         
                                                            
                                                               
                                                                  k
                                                               
                                                               
                                                                  ˆ
                                                               
                                                            
                                                            =
                                                            1
                                                         
                                                         
                                                            
                                                               
                                                                  m
                                                               
                                                               
                                                                  ij
                                                               
                                                            
                                                         
                                                      
                                                   
                                                   P
                                                   (
                                                   
                                                      
                                                         z
                                                      
                                                      
                                                         
                                                            
                                                               k
                                                            
                                                            
                                                               ˆ
                                                            
                                                         
                                                      
                                                   
                                                   |
                                                   
                                                      
                                                         x
                                                      
                                                      
                                                         
                                                            
                                                               k
                                                            
                                                            
                                                               ˆ
                                                            
                                                         
                                                      
                                                   
                                                   ,
                                                   
                                                      
                                                         θ
                                                      
                                                      
                                                         l
                                                      
                                                   
                                                   )
                                                   log
                                                   [
                                                   P
                                                   (
                                                   
                                                      
                                                         x
                                                      
                                                      
                                                         
                                                            
                                                               k
                                                            
                                                            
                                                               ˆ
                                                            
                                                         
                                                      
                                                   
                                                   |
                                                   θ
                                                   )
                                                   ]
                                                
                                             
                                          
                                       
                                    
                                 
                              

Following the equivalence in Eq. (9) the maximization process could be expressed as follows:
                                    
                                       (12)
                                       
                                          
                                             
                                                θ
                                             
                                             
                                                l
                                                +
                                                1
                                             
                                          
                                          =
                                          arg
                                          
                                             
                                                
                                                   max
                                                
                                                
                                                   θ
                                                
                                             
                                          
                                          
                                             
                                                
                                                   -
                                                   
                                                      
                                                         
                                                            ∑
                                                         
                                                         
                                                            
                                                               
                                                                  k
                                                               
                                                               
                                                                  ˆ
                                                               
                                                            
                                                            =
                                                            1
                                                         
                                                         
                                                            
                                                               
                                                                  m
                                                               
                                                               
                                                                  ij
                                                               
                                                            
                                                         
                                                      
                                                   
                                                   P
                                                   
                                                      
                                                         
                                                            
                                                               
                                                                  z
                                                               
                                                               
                                                                  
                                                                     
                                                                        k
                                                                     
                                                                     
                                                                        ˆ
                                                                     
                                                                  
                                                               
                                                            
                                                            |
                                                            
                                                               
                                                                  v
                                                               
                                                               
                                                                  ij
                                                               
                                                               
                                                                  k
                                                               
                                                            
                                                            ,
                                                            
                                                               
                                                                  v
                                                               
                                                               
                                                                  ji
                                                               
                                                               
                                                                  
                                                                     
                                                                        k
                                                                     
                                                                     
                                                                        ′
                                                                     
                                                                  
                                                               
                                                            
                                                            ,
                                                            
                                                               
                                                                  θ
                                                               
                                                               
                                                                  l
                                                               
                                                            
                                                         
                                                      
                                                   
                                                   
                                                      
                                                         
                                                            
                                                               
                                                                  
                                                                     
                                                                        
                                                                           
                                                                              R
                                                                           
                                                                           
                                                                              i
                                                                           
                                                                        
                                                                        
                                                                           
                                                                              v
                                                                           
                                                                           
                                                                              ij
                                                                           
                                                                           
                                                                              k
                                                                           
                                                                        
                                                                        +
                                                                        
                                                                           
                                                                              t
                                                                           
                                                                           
                                                                              i
                                                                           
                                                                        
                                                                     
                                                                  
                                                               
                                                               -
                                                               
                                                                  
                                                                     
                                                                        
                                                                           
                                                                              R
                                                                           
                                                                           
                                                                              j
                                                                           
                                                                        
                                                                        
                                                                           
                                                                              v
                                                                           
                                                                           
                                                                              ji
                                                                           
                                                                           
                                                                              
                                                                                 
                                                                                    k
                                                                                 
                                                                                 
                                                                                    ′
                                                                                 
                                                                              
                                                                           
                                                                        
                                                                        +
                                                                        
                                                                           
                                                                              t
                                                                           
                                                                           
                                                                              j
                                                                           
                                                                        
                                                                     
                                                                  
                                                               
                                                            
                                                         
                                                      
                                                      
                                                         2
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                 where 
                                    
                                       
                                          
                                             θ
                                          
                                          
                                             l
                                          
                                       
                                       =
                                       
                                          
                                             
                                                
                                                   
                                                      R
                                                   
                                                   
                                                      i
                                                   
                                                   
                                                      l
                                                   
                                                
                                                ,
                                                
                                                   
                                                      R
                                                   
                                                   
                                                      j
                                                   
                                                   
                                                      l
                                                   
                                                
                                                ,
                                                
                                                   
                                                      t
                                                   
                                                   
                                                      i
                                                   
                                                   
                                                      l
                                                   
                                                
                                                ,
                                                
                                                   
                                                      t
                                                   
                                                   
                                                      j
                                                   
                                                   
                                                      l
                                                   
                                                
                                             
                                          
                                       
                                    
                                 .

In this sense, we can see demonstrated that the estimation of the posterior probabilities and the optimization of the model parameters according to the weights provided by these posterior probabilities has the property of converging to a local maximum. Moreover, Eq. (12) shows that this formulation is equivalent to robust statistics weighted techniques, where the posteriors 
                           
                              P
                              
                                 
                                    
                                       
                                          
                                             z
                                          
                                          
                                             
                                                
                                                   k
                                                
                                                
                                                   ˆ
                                                
                                             
                                          
                                       
                                       |
                                       
                                          
                                             v
                                          
                                          
                                             ij
                                          
                                          
                                             k
                                          
                                       
                                       ,
                                       
                                          
                                             v
                                          
                                          
                                             ji
                                          
                                          
                                             
                                                
                                                   k
                                                
                                                
                                                   ′
                                                
                                             
                                          
                                       
                                       ,
                                       
                                          
                                             θ
                                          
                                          
                                             l
                                          
                                       
                                    
                                 
                              
                           
                         take care of the contribution of each observation 
                           
                              
                                 
                                    
                                       
                                          
                                             v
                                          
                                          
                                             ij
                                          
                                          
                                             k
                                          
                                       
                                       ,
                                       
                                          
                                             v
                                          
                                          
                                             ji
                                          
                                          
                                             
                                                
                                                   k
                                                
                                                
                                                   ′
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           
                         with respect to the estimated model θ
                        
                           l
                        . In the following, these two iterated steps are developed for the specific case of the multiview registration explained in this paper. For a more detailed description of the original EM algorithm itself please refer to Appendix A.

In the Expectation step the objective is to compute the sufficient statistics for the latent variables posterior distributions 
                              
                                 P
                                 (
                                 
                                    
                                       Z
                                    
                                    
                                       ij
                                    
                                 
                                 |
                                 
                                    
                                       X
                                    
                                    
                                       ij
                                    
                                 
                                 ,
                                 
                                    
                                       θ
                                    
                                    
                                       ij
                                    
                                 
                                 )
                              
                           , in order to infer Z
                           
                              ij
                            from the observations X
                           
                              ij
                            and the parameters of the model θ
                           
                              ij
                           . Inference occurs when computing the values for 
                              
                                 
                                    
                                       z
                                    
                                    
                                       ij
                                    
                                    
                                       
                                          
                                             k
                                          
                                          
                                             ˆ
                                          
                                       
                                    
                                 
                              
                            that maximize the a posteriori probability of a given data point 
                              
                                 
                                    
                                       x
                                    
                                    
                                       ij
                                    
                                    
                                       
                                          
                                             k
                                          
                                          
                                             ˆ
                                          
                                       
                                    
                                 
                              
                            and a specific instance for the model’s parameters θ
                           
                              ij
                           .

In particular, when inspecting the joint distribution in Eq. (7) and taking into account the Bayes’ theorem, we can see that the form of the posterior probability 
                              
                                 P
                                 
                                    
                                       
                                          
                                             
                                                z
                                             
                                             
                                                ij
                                             
                                             
                                                
                                                   
                                                      k
                                                   
                                                   
                                                      ˆ
                                                   
                                                
                                             
                                          
                                          =
                                          1
                                          |
                                          
                                             
                                                x
                                             
                                             
                                                ij
                                             
                                             
                                                
                                                   
                                                      k
                                                   
                                                   
                                                      ˆ
                                                   
                                                
                                             
                                          
                                          ,
                                          
                                             
                                                θ
                                             
                                             
                                                ij
                                             
                                          
                                       
                                    
                                 
                              
                            is proportional to 
                              
                                 P
                                 
                                    
                                       
                                          
                                             
                                                
                                                   x
                                                
                                                
                                                   ij
                                                
                                                
                                                   
                                                      
                                                         k
                                                      
                                                      
                                                         ˆ
                                                      
                                                   
                                                
                                             
                                             |
                                             
                                                
                                                   θ
                                                
                                                
                                                   ij
                                                
                                             
                                          
                                       
                                    
                                    
                                       
                                          
                                             z
                                          
                                          
                                             ij
                                          
                                          
                                             
                                                
                                                   k
                                                
                                                
                                                   ˆ
                                                
                                             
                                          
                                       
                                       =
                                       1
                                    
                                 
                              
                           . If we consider the following approximation:
                              
                                 (13)
                                 
                                    P
                                    
                                       
                                          
                                             
                                                
                                                   z
                                                
                                                
                                                   ij
                                                
                                                
                                                   
                                                      
                                                         k
                                                      
                                                      
                                                         ˆ
                                                      
                                                   
                                                
                                             
                                             =
                                             1
                                             |
                                             
                                                
                                                   x
                                                
                                                
                                                   ij
                                                
                                                
                                                   
                                                      
                                                         k
                                                      
                                                      
                                                         ˆ
                                                      
                                                   
                                                
                                             
                                             ,
                                             
                                                
                                                   θ
                                                
                                                
                                                   ij
                                                
                                             
                                          
                                       
                                    
                                    ∝
                                    P
                                    
                                       
                                          
                                             
                                                
                                                   x
                                                
                                                
                                                   ij
                                                
                                                
                                                   
                                                      
                                                         k
                                                      
                                                      
                                                         ˆ
                                                      
                                                   
                                                
                                             
                                             |
                                             
                                                
                                                   θ
                                                
                                                
                                                   ij
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           then Eq. (12) would penalize all those pairs of points 
                              
                                 
                                    
                                       
                                          
                                             
                                                v
                                             
                                             
                                                ij
                                             
                                             
                                                k
                                             
                                          
                                          ,
                                          
                                             
                                                v
                                             
                                             
                                                ji
                                             
                                             
                                                
                                                   
                                                      k
                                                   
                                                   
                                                      ′
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                              
                            with biggest error, while it would consider with higher priority the pairs with lower error in the next estimation iteration of θ. Given this behavior and the empirical observations showing an exponential decay of the posterior probability (these observations will be shown in the experimental results in Section 5), we can model it as a negative exponential distribution:
                              
                                 (14)
                                 
                                    P
                                    
                                       
                                          
                                             
                                                
                                                   z
                                                
                                                
                                                   ij
                                                
                                                
                                                   
                                                      
                                                         k
                                                      
                                                      
                                                         ˆ
                                                      
                                                   
                                                
                                             
                                             =
                                             1
                                             |
                                             
                                                
                                                   v
                                                
                                                
                                                   ij
                                                
                                                
                                                   k
                                                
                                             
                                             ,
                                             
                                                
                                                   v
                                                
                                                
                                                   ji
                                                
                                                
                                                   
                                                      
                                                         k
                                                      
                                                      
                                                         ′
                                                      
                                                   
                                                
                                             
                                             ,
                                             
                                                
                                                   θ
                                                
                                                
                                                   ij
                                                
                                             
                                          
                                       
                                    
                                    ∝
                                    exp
                                    
                                       
                                          
                                             -
                                             α
                                             ε
                                             
                                                
                                                   
                                                      
                                                         
                                                            v
                                                         
                                                         
                                                            ij
                                                         
                                                         
                                                            k
                                                         
                                                      
                                                      ,
                                                      
                                                         
                                                            v
                                                         
                                                         
                                                            ji
                                                         
                                                         
                                                            
                                                               
                                                                  k
                                                               
                                                               
                                                                  ′
                                                               
                                                            
                                                         
                                                      
                                                      |
                                                      
                                                         
                                                            θ
                                                         
                                                         
                                                            ij
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           where α corresponds to the sufficient statistics of the exponential distribution. In an ideal case without uncertainties in the correspondences and therefore without weight values this value would be estimated as:
                              
                                 (15)
                                 
                                    α
                                    =
                                    
                                       
                                          
                                             
                                                ∑
                                             
                                             
                                                i
                                             
                                          
                                          
                                             
                                                ∑
                                             
                                             
                                                j
                                             
                                          
                                          1
                                       
                                       
                                          
                                             
                                                ∑
                                             
                                             
                                                i
                                             
                                          
                                          
                                             
                                                ∑
                                             
                                             
                                                j
                                             
                                          
                                          ε
                                          
                                             
                                                
                                                   
                                                      
                                                         v
                                                      
                                                      
                                                         ij
                                                      
                                                      
                                                         k
                                                      
                                                   
                                                   ,
                                                   
                                                      
                                                         v
                                                      
                                                      
                                                         ji
                                                      
                                                      
                                                         
                                                            
                                                               k
                                                            
                                                            
                                                               ′
                                                            
                                                         
                                                      
                                                   
                                                   |
                                                   
                                                      
                                                         θ
                                                      
                                                      
                                                         l
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           
                        

In our case we want to give more importance to the correspondences with higher weight values 
                              
                                 
                                    
                                       ω
                                    
                                    
                                       ij
                                    
                                    
                                       
                                          
                                             k
                                          
                                          
                                             ˆ
                                          
                                       
                                    
                                 
                              
                           , so this equation would be adapted as:
                              
                                 (16)
                                 
                                    α
                                    =
                                    
                                       
                                          
                                             
                                                ∑
                                             
                                             
                                                i
                                             
                                          
                                          
                                             
                                                ∑
                                             
                                             
                                                j
                                             
                                          
                                          E
                                          
                                             
                                                
                                                   
                                                      
                                                         ω
                                                      
                                                      
                                                         ij
                                                      
                                                      
                                                         
                                                            
                                                               k
                                                            
                                                            
                                                               ˆ
                                                            
                                                         
                                                      
                                                   
                                                   
                                                      
                                                         
                                                            P
                                                            
                                                               
                                                                  
                                                                     
                                                                        
                                                                           ω
                                                                        
                                                                        
                                                                           ij
                                                                        
                                                                        
                                                                           
                                                                              
                                                                                 k
                                                                              
                                                                              
                                                                                 ˆ
                                                                              
                                                                           
                                                                        
                                                                     
                                                                  
                                                               
                                                            
                                                            
                                                               
                                                                  v
                                                               
                                                               
                                                                  ij
                                                               
                                                               
                                                                  k
                                                               
                                                            
                                                            ,
                                                            
                                                               
                                                                  v
                                                               
                                                               
                                                                  ji
                                                               
                                                               
                                                                  
                                                                     
                                                                        k
                                                                     
                                                                     
                                                                        ′
                                                                     
                                                                  
                                                               
                                                            
                                                            ,
                                                            
                                                               
                                                                  θ
                                                               
                                                               
                                                                  l
                                                               
                                                            
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                       
                                       
                                          
                                             
                                                ∑
                                             
                                             
                                                i
                                             
                                          
                                          
                                             
                                                ∑
                                             
                                             
                                                j
                                             
                                          
                                          E
                                          
                                             
                                                
                                                   
                                                      
                                                         ω
                                                      
                                                      
                                                         ij
                                                      
                                                      
                                                         
                                                            
                                                               k
                                                            
                                                            
                                                               ˆ
                                                            
                                                         
                                                      
                                                   
                                                   
                                                      
                                                         
                                                            P
                                                            
                                                               
                                                                  
                                                                     
                                                                        
                                                                           ω
                                                                        
                                                                        
                                                                           ij
                                                                        
                                                                        
                                                                           
                                                                              
                                                                                 k
                                                                              
                                                                              
                                                                                 ˆ
                                                                              
                                                                           
                                                                        
                                                                     
                                                                  
                                                               
                                                            
                                                            
                                                               
                                                                  v
                                                               
                                                               
                                                                  ij
                                                               
                                                               
                                                                  k
                                                               
                                                            
                                                            ,
                                                            
                                                               
                                                                  v
                                                               
                                                               
                                                                  ji
                                                               
                                                               
                                                                  
                                                                     
                                                                        k
                                                                     
                                                                     
                                                                        ′
                                                                     
                                                                  
                                                               
                                                            
                                                            ,
                                                            
                                                               
                                                                  θ
                                                               
                                                               
                                                                  l
                                                               
                                                            
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                          ε
                                          
                                             
                                                
                                                   
                                                      
                                                         v
                                                      
                                                      
                                                         ij
                                                      
                                                      
                                                         k
                                                      
                                                   
                                                   ,
                                                   
                                                      
                                                         v
                                                      
                                                      
                                                         ji
                                                      
                                                      
                                                         
                                                            
                                                               k
                                                            
                                                            
                                                               ′
                                                            
                                                         
                                                      
                                                   
                                                   |
                                                   
                                                      
                                                         θ
                                                      
                                                      
                                                         l
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           where 
                              
                                 E
                                 
                                    
                                       
                                          
                                             
                                                ω
                                             
                                             
                                                ij
                                             
                                             
                                                
                                                   
                                                      k
                                                   
                                                   
                                                      ˆ
                                                   
                                                
                                             
                                          
                                          
                                             
                                                
                                                   P
                                                   
                                                      
                                                         
                                                            
                                                               
                                                                  ω
                                                               
                                                               
                                                                  ij
                                                               
                                                               
                                                                  
                                                                     
                                                                        k
                                                                     
                                                                     
                                                                        ˆ
                                                                     
                                                                  
                                                               
                                                            
                                                         
                                                      
                                                   
                                                   
                                                      
                                                         v
                                                      
                                                      
                                                         ij
                                                      
                                                      
                                                         k
                                                      
                                                   
                                                   ,
                                                   
                                                      
                                                         v
                                                      
                                                      
                                                         ji
                                                      
                                                      
                                                         
                                                            
                                                               k
                                                            
                                                            
                                                               ′
                                                            
                                                         
                                                      
                                                   
                                                   ,
                                                   
                                                      
                                                         θ
                                                      
                                                      
                                                         l
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                              
                            is the posterior expectation of the unobserved 
                              
                                 
                                    
                                       ω
                                    
                                    
                                       ij
                                    
                                    
                                       
                                          
                                             k
                                          
                                          
                                             ˆ
                                          
                                       
                                    
                                 
                              
                            indicator variables, which have been inferred from the model θ
                           
                              l
                            and the observed data 
                              
                                 
                                    
                                       
                                          
                                             
                                                v
                                             
                                             
                                                ij
                                             
                                             
                                                k
                                             
                                          
                                          ,
                                          
                                             
                                                v
                                             
                                             
                                                ji
                                             
                                             
                                                
                                                   
                                                      k
                                                   
                                                   
                                                      ′
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           :
                              
                                 (17)
                                 
                                    E
                                    
                                       
                                          
                                             
                                                
                                                   ω
                                                
                                                
                                                   ij
                                                
                                                
                                                   
                                                      
                                                         k
                                                      
                                                      
                                                         ˆ
                                                      
                                                   
                                                
                                             
                                             
                                                
                                                   
                                                      P
                                                      
                                                         
                                                            
                                                               
                                                                  
                                                                     ω
                                                                  
                                                                  
                                                                     ij
                                                                  
                                                                  
                                                                     
                                                                        
                                                                           k
                                                                        
                                                                        
                                                                           ˆ
                                                                        
                                                                     
                                                                  
                                                               
                                                            
                                                         
                                                      
                                                      
                                                         
                                                            v
                                                         
                                                         
                                                            ij
                                                         
                                                         
                                                            k
                                                         
                                                      
                                                      ,
                                                      
                                                         
                                                            v
                                                         
                                                         
                                                            ji
                                                         
                                                         
                                                            
                                                               
                                                                  k
                                                               
                                                               
                                                                  ′
                                                               
                                                            
                                                         
                                                      
                                                      ,
                                                      
                                                         
                                                            θ
                                                         
                                                         
                                                            l
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                    =
                                    
                                       
                                          
                                             ∑
                                          
                                          
                                             
                                                
                                                   ω
                                                
                                                
                                                   ij
                                                
                                                
                                                   
                                                      
                                                         k
                                                      
                                                      
                                                         ˆ
                                                      
                                                   
                                                
                                             
                                             =
                                             0
                                          
                                          
                                             1
                                          
                                       
                                    
                                    
                                       
                                          ω
                                       
                                       
                                          ij
                                       
                                       
                                          
                                             
                                                k
                                             
                                             
                                                ˆ
                                             
                                          
                                       
                                    
                                    P
                                    
                                       
                                          
                                             
                                                
                                                   ω
                                                
                                                
                                                   ij
                                                
                                                
                                                   
                                                      
                                                         k
                                                      
                                                      
                                                         ˆ
                                                      
                                                   
                                                
                                             
                                             |
                                             
                                                
                                                   v
                                                
                                                
                                                   ij
                                                
                                                
                                                   k
                                                
                                             
                                             ,
                                             
                                                
                                                   v
                                                
                                                
                                                   ji
                                                
                                                
                                                   
                                                      
                                                         k
                                                      
                                                      
                                                         ′
                                                      
                                                   
                                                
                                             
                                             ,
                                             
                                                
                                                   θ
                                                
                                                
                                                   l
                                                
                                             
                                          
                                       
                                    
                                    =
                                    P
                                    
                                       
                                          
                                             
                                                
                                                   ω
                                                
                                                
                                                   ij
                                                
                                                
                                                   
                                                      
                                                         k
                                                      
                                                      
                                                         ˆ
                                                      
                                                   
                                                
                                             
                                             =
                                             1
                                             |
                                             
                                                
                                                   v
                                                
                                                
                                                   ij
                                                
                                                
                                                   k
                                                
                                             
                                             ,
                                             
                                                
                                                   v
                                                
                                                
                                                   ji
                                                
                                                
                                                   
                                                      
                                                         k
                                                      
                                                      
                                                         ′
                                                      
                                                   
                                                
                                             
                                             ,
                                             
                                                
                                                   θ
                                                
                                                
                                                   l
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           
                        

According to the Maximization step, let us consider the cost function to be optimized:
                              
                                 (18)
                                 
                                    E
                                    (
                                    θ
                                    )
                                    =
                                    -
                                    
                                       
                                          
                                             ∑
                                          
                                          
                                             i
                                             =
                                             1
                                          
                                          
                                             N
                                          
                                       
                                    
                                    
                                       
                                          
                                             ∑
                                          
                                          
                                             j
                                             =
                                             i
                                             +
                                             1
                                          
                                          
                                             N
                                          
                                       
                                    
                                    
                                       
                                          
                                             ∑
                                          
                                          
                                             
                                                
                                                   k
                                                
                                                
                                                   ˆ
                                                
                                             
                                             =
                                             1
                                          
                                          
                                             
                                                
                                                   m
                                                
                                                
                                                   ij
                                                
                                             
                                          
                                       
                                    
                                    E
                                    
                                       
                                          
                                             ε
                                             
                                                
                                                   
                                                      
                                                         
                                                            v
                                                         
                                                         
                                                            ij
                                                         
                                                         
                                                            k
                                                         
                                                      
                                                      ,
                                                      
                                                         
                                                            v
                                                         
                                                         
                                                            ji
                                                         
                                                         
                                                            
                                                               
                                                                  k
                                                               
                                                               
                                                                  ′
                                                               
                                                            
                                                         
                                                      
                                                      |
                                                      
                                                         
                                                            θ
                                                         
                                                         
                                                            ij
                                                         
                                                      
                                                   
                                                
                                             
                                             
                                                
                                                   
                                                      P
                                                      
                                                         
                                                            
                                                               
                                                                  
                                                                     ω
                                                                  
                                                                  
                                                                     ij
                                                                  
                                                                  
                                                                     
                                                                        
                                                                           k
                                                                        
                                                                        
                                                                           ˆ
                                                                        
                                                                     
                                                                  
                                                               
                                                               =
                                                               1
                                                            
                                                         
                                                      
                                                      
                                                         
                                                            v
                                                         
                                                         
                                                            ij
                                                         
                                                         
                                                            k
                                                         
                                                      
                                                      ,
                                                      
                                                         
                                                            v
                                                         
                                                         
                                                            ji
                                                         
                                                         
                                                            
                                                               
                                                                  k
                                                               
                                                               
                                                                  ′
                                                               
                                                            
                                                         
                                                      
                                                      ,
                                                      
                                                         
                                                            θ
                                                         
                                                         
                                                            l
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           which corresponds to the posterior expectation of
                              
                                 (19)
                                 
                                    ε
                                    =
                                    
                                       
                                          
                                             ∑
                                          
                                          
                                             i
                                             =
                                             1
                                          
                                          
                                             N
                                          
                                       
                                    
                                    
                                       
                                          
                                             ∑
                                          
                                          
                                             j
                                             =
                                             i
                                             +
                                             1
                                          
                                          
                                             N
                                          
                                       
                                    
                                    
                                       
                                          
                                             ∑
                                          
                                          
                                             
                                                
                                                   k
                                                
                                                
                                                   ˆ
                                                
                                             
                                             =
                                             1
                                          
                                          
                                             
                                                
                                                   m
                                                
                                                
                                                   ij
                                                
                                             
                                          
                                       
                                    
                                    
                                       
                                          ω
                                       
                                       
                                          ij
                                       
                                       
                                          
                                             
                                                k
                                             
                                             
                                                ˆ
                                             
                                          
                                       
                                    
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         
                                                            
                                                               R
                                                            
                                                            
                                                               i
                                                            
                                                         
                                                         
                                                            
                                                               v
                                                            
                                                            
                                                               ij
                                                            
                                                            
                                                               k
                                                            
                                                         
                                                         +
                                                         
                                                            
                                                               t
                                                            
                                                            
                                                               i
                                                            
                                                         
                                                      
                                                   
                                                
                                                -
                                                
                                                   
                                                      
                                                         
                                                            
                                                               R
                                                            
                                                            
                                                               j
                                                            
                                                         
                                                         
                                                            
                                                               v
                                                            
                                                            
                                                               ji
                                                            
                                                            
                                                               
                                                                  
                                                                     k
                                                                  
                                                                  
                                                                     ′
                                                                  
                                                               
                                                            
                                                         
                                                         +
                                                         
                                                            
                                                               t
                                                            
                                                            
                                                               j
                                                            
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                       
                                       
                                          2
                                       
                                    
                                    =
                                    
                                       
                                          
                                             ∑
                                          
                                          
                                             i
                                             =
                                             1
                                          
                                          
                                             N
                                          
                                       
                                    
                                    
                                       
                                          
                                             ∑
                                          
                                          
                                             j
                                             =
                                             i
                                             +
                                             1
                                          
                                          
                                             N
                                          
                                       
                                    
                                    
                                       
                                          
                                             ∑
                                          
                                          
                                             
                                                
                                                   k
                                                
                                                
                                                   ˆ
                                                
                                             
                                             =
                                             1
                                          
                                          
                                             
                                                
                                                   m
                                                
                                                
                                                   ij
                                                
                                             
                                          
                                       
                                    
                                    
                                       
                                          ω
                                       
                                       
                                          ij
                                       
                                       
                                          
                                             
                                                k
                                             
                                             
                                                ˆ
                                             
                                          
                                       
                                    
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         
                                                            
                                                               R
                                                            
                                                            
                                                               i
                                                            
                                                         
                                                         
                                                            
                                                               v
                                                            
                                                            
                                                               ij
                                                            
                                                            
                                                               k
                                                            
                                                         
                                                         -
                                                         
                                                            
                                                               R
                                                            
                                                            
                                                               j
                                                            
                                                         
                                                         
                                                            
                                                               v
                                                            
                                                            
                                                               ji
                                                            
                                                            
                                                               
                                                                  
                                                                     k
                                                                  
                                                                  
                                                                     ′
                                                                  
                                                               
                                                            
                                                         
                                                      
                                                   
                                                
                                                
                                                   2
                                                
                                             
                                             +
                                             2
                                             
                                                
                                                   (
                                                   
                                                      
                                                         t
                                                      
                                                      
                                                         i
                                                      
                                                   
                                                   -
                                                   
                                                      
                                                         t
                                                      
                                                      
                                                         j
                                                      
                                                   
                                                   )
                                                
                                                
                                                   T
                                                
                                             
                                             
                                                
                                                   
                                                      
                                                         
                                                            R
                                                         
                                                         
                                                            i
                                                         
                                                      
                                                      
                                                         
                                                            v
                                                         
                                                         
                                                            ij
                                                         
                                                         
                                                            k
                                                         
                                                      
                                                      -
                                                      
                                                         
                                                            R
                                                         
                                                         
                                                            j
                                                         
                                                      
                                                      
                                                         
                                                            v
                                                         
                                                         
                                                            ji
                                                         
                                                         
                                                            
                                                               
                                                                  k
                                                               
                                                               
                                                                  ′
                                                               
                                                            
                                                         
                                                      
                                                   
                                                
                                             
                                             +
                                             |
                                             
                                                
                                                   t
                                                
                                                
                                                   i
                                                
                                             
                                             -
                                             
                                                
                                                   t
                                                
                                                
                                                   j
                                                
                                             
                                             
                                                
                                                   |
                                                
                                                
                                                   2
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           
                        

At this point we can return again to the notation used in [13], so let us define:
                              
                                 
                                    
                                       
                                          
                                          
                                             
                                                R
                                                ≡
                                                [
                                                
                                                   
                                                      R
                                                   
                                                   
                                                      1
                                                   
                                                
                                                |
                                                
                                                   
                                                      R
                                                   
                                                   
                                                      2
                                                   
                                                
                                                |
                                                …
                                                |
                                                
                                                   
                                                      R
                                                   
                                                   
                                                      N
                                                   
                                                
                                                ]
                                                ∈
                                                
                                                   
                                                      R
                                                   
                                                   
                                                      3
                                                      ×
                                                      3
                                                      N
                                                   
                                                
                                             
                                          
                                       
                                       
                                          
                                          
                                             
                                                T
                                                ≡
                                                [
                                                
                                                   
                                                      T
                                                   
                                                   
                                                      1
                                                   
                                                
                                                |
                                                
                                                   
                                                      T
                                                   
                                                   
                                                      2
                                                   
                                                
                                                |
                                                …
                                                |
                                                
                                                   
                                                      T
                                                   
                                                   
                                                      N
                                                   
                                                
                                                ]
                                                ∈
                                                
                                                   
                                                      R
                                                   
                                                   
                                                      3
                                                      ×
                                                      N
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           and let e
                           
                              i
                            be the ith column of a N
                           ×
                           N identity matrix, and e
                           
                              ij
                           
                           =
                           e
                           
                              i
                           
                           −
                           e
                           
                              j
                           .

Also let us define:
                              
                                 
                                    
                                       
                                          c
                                       
                                       
                                          ij
                                       
                                       
                                          
                                             
                                                k
                                             
                                             
                                                ˆ
                                             
                                          
                                       
                                    
                                    ≡
                                    (
                                    
                                       
                                          e
                                       
                                       
                                          i
                                       
                                    
                                    ⊗
                                    
                                       
                                          I
                                       
                                       
                                          3
                                       
                                    
                                    )
                                    
                                       
                                          v
                                       
                                       
                                          ij
                                       
                                       
                                          k
                                       
                                    
                                    -
                                    (
                                    
                                       
                                          e
                                       
                                       
                                          j
                                       
                                    
                                    ⊗
                                    
                                       
                                          I
                                       
                                       
                                          3
                                       
                                    
                                    )
                                    
                                       
                                          v
                                       
                                       
                                          ji
                                       
                                       
                                          
                                             
                                                k
                                             
                                             
                                                ′
                                             
                                          
                                       
                                    
                                 
                              
                           where ⊗ indicates the Kronecker product 
                           [21].

The cost function can now be re-written as follows:
                              
                                 (20)
                                 
                                    ε
                                    =
                                    
                                       
                                          
                                             ∑
                                          
                                          
                                             i
                                             =
                                             1
                                          
                                          
                                             N
                                          
                                       
                                    
                                    
                                       
                                          
                                             ∑
                                          
                                          
                                             j
                                             =
                                             i
                                             +
                                             1
                                          
                                          
                                             N
                                          
                                       
                                    
                                    
                                       
                                          
                                             ∑
                                          
                                          
                                             
                                                
                                                   k
                                                
                                                
                                                   ˆ
                                                
                                             
                                             =
                                             1
                                          
                                          
                                             
                                                
                                                   m
                                                
                                                
                                                   ij
                                                
                                             
                                          
                                       
                                    
                                    
                                       
                                          ω
                                       
                                       
                                          ij
                                       
                                       
                                          
                                             
                                                k
                                             
                                             
                                                ˆ
                                             
                                          
                                       
                                    
                                    {
                                    
                                       
                                          
                                             
                                                c
                                             
                                             
                                                ij
                                             
                                             
                                                
                                                   
                                                      k
                                                   
                                                   
                                                      ˆ
                                                   
                                                
                                             
                                          
                                       
                                       
                                          T
                                       
                                    
                                    
                                       
                                          R
                                       
                                       
                                          T
                                       
                                    
                                    R
                                    
                                       
                                          c
                                       
                                       
                                          ij
                                       
                                       
                                          
                                             
                                                k
                                             
                                             
                                                ˆ
                                             
                                          
                                       
                                    
                                    +
                                    2
                                    
                                       
                                          e
                                       
                                       
                                          ij
                                       
                                       
                                          T
                                       
                                    
                                    
                                       
                                          T
                                       
                                       
                                          T
                                       
                                    
                                    R
                                    
                                       
                                          c
                                       
                                       
                                          ij
                                       
                                       
                                          
                                             
                                                k
                                             
                                             
                                                ˆ
                                             
                                          
                                       
                                    
                                    +
                                    
                                       
                                          e
                                       
                                       
                                          ij
                                       
                                       
                                          T
                                       
                                    
                                    
                                       
                                          T
                                       
                                       
                                          T
                                       
                                    
                                    T
                                    
                                       
                                          e
                                       
                                       
                                          ij
                                       
                                    
                                    }
                                 
                              
                           
                        

Applying the property that u
                           ·
                           v
                           =
                           tr(uv
                           
                              T
                           ) we obtain
                              
                                 (21)
                                 
                                    ε
                                    =
                                    tr
                                    
                                       
                                          
                                             R
                                             
                                                
                                                   
                                                      
                                                         
                                                            
                                                               ∑
                                                            
                                                            
                                                               i
                                                               =
                                                               1
                                                            
                                                            
                                                               N
                                                            
                                                         
                                                      
                                                      
                                                         
                                                            
                                                               ∑
                                                            
                                                            
                                                               j
                                                               =
                                                               i
                                                               +
                                                               1
                                                            
                                                            
                                                               N
                                                            
                                                         
                                                      
                                                      
                                                         
                                                            
                                                               ∑
                                                            
                                                            
                                                               
                                                                  
                                                                     k
                                                                  
                                                                  
                                                                     ˆ
                                                                  
                                                               
                                                               =
                                                               1
                                                            
                                                            
                                                               
                                                                  
                                                                     m
                                                                  
                                                                  
                                                                     ij
                                                                  
                                                               
                                                            
                                                         
                                                      
                                                      
                                                         
                                                            ω
                                                         
                                                         
                                                            ij
                                                         
                                                         
                                                            
                                                               
                                                                  k
                                                               
                                                               
                                                                  ˆ
                                                               
                                                            
                                                         
                                                      
                                                      
                                                         
                                                            c
                                                         
                                                         
                                                            ij
                                                         
                                                         
                                                            
                                                               
                                                                  k
                                                               
                                                               
                                                                  ˆ
                                                               
                                                            
                                                         
                                                      
                                                      
                                                         
                                                            
                                                               
                                                                  c
                                                               
                                                               
                                                                  ij
                                                               
                                                               
                                                                  
                                                                     
                                                                        k
                                                                     
                                                                     
                                                                        ˆ
                                                                     
                                                                  
                                                               
                                                            
                                                         
                                                         
                                                            T
                                                         
                                                      
                                                   
                                                
                                             
                                             
                                                
                                                   R
                                                
                                                
                                                   T
                                                
                                             
                                             +
                                             2
                                             T
                                             
                                                
                                                   e
                                                
                                                
                                                   ij
                                                
                                             
                                             
                                                
                                                   
                                                      
                                                         
                                                            
                                                               ∑
                                                            
                                                            
                                                               i
                                                               =
                                                               1
                                                            
                                                            
                                                               N
                                                            
                                                         
                                                      
                                                      
                                                         
                                                            
                                                               ∑
                                                            
                                                            
                                                               j
                                                               =
                                                               i
                                                               +
                                                               1
                                                            
                                                            
                                                               N
                                                            
                                                         
                                                      
                                                      
                                                         
                                                            
                                                               ∑
                                                            
                                                            
                                                               
                                                                  
                                                                     k
                                                                  
                                                                  
                                                                     ˆ
                                                                  
                                                               
                                                               =
                                                               1
                                                            
                                                            
                                                               
                                                                  
                                                                     m
                                                                  
                                                                  
                                                                     ij
                                                                  
                                                               
                                                            
                                                         
                                                      
                                                      
                                                         
                                                            ω
                                                         
                                                         
                                                            ij
                                                         
                                                         
                                                            
                                                               
                                                                  k
                                                               
                                                               
                                                                  ˆ
                                                               
                                                            
                                                         
                                                      
                                                      
                                                         
                                                            
                                                               
                                                                  c
                                                               
                                                               
                                                                  ij
                                                               
                                                               
                                                                  
                                                                     
                                                                        k
                                                                     
                                                                     
                                                                        ˆ
                                                                     
                                                                  
                                                               
                                                            
                                                         
                                                         
                                                            T
                                                         
                                                      
                                                   
                                                
                                             
                                             
                                                
                                                   R
                                                
                                                
                                                   T
                                                
                                             
                                             +
                                             T
                                             
                                                
                                                   
                                                      
                                                         
                                                            
                                                               ∑
                                                            
                                                            
                                                               i
                                                               =
                                                               1
                                                            
                                                            
                                                               N
                                                            
                                                         
                                                      
                                                      
                                                         
                                                            
                                                               ∑
                                                            
                                                            
                                                               j
                                                               =
                                                               i
                                                               +
                                                               1
                                                            
                                                            
                                                               N
                                                            
                                                         
                                                      
                                                      
                                                         
                                                            
                                                               ∑
                                                            
                                                            
                                                               
                                                                  
                                                                     k
                                                                  
                                                                  
                                                                     ˆ
                                                                  
                                                               
                                                               =
                                                               1
                                                            
                                                            
                                                               
                                                                  
                                                                     m
                                                                  
                                                                  
                                                                     ij
                                                                  
                                                               
                                                            
                                                         
                                                      
                                                      
                                                         
                                                            ω
                                                         
                                                         
                                                            ij
                                                         
                                                         
                                                            
                                                               
                                                                  k
                                                               
                                                               
                                                                  ˆ
                                                               
                                                            
                                                         
                                                      
                                                      
                                                         
                                                            
                                                               
                                                                  c
                                                               
                                                               
                                                                  ij
                                                               
                                                               
                                                                  
                                                                     
                                                                        k
                                                                     
                                                                     
                                                                        ˆ
                                                                     
                                                                  
                                                               
                                                            
                                                         
                                                         
                                                            T
                                                         
                                                      
                                                   
                                                
                                             
                                             
                                                
                                                   e
                                                
                                                
                                                   ij
                                                
                                             
                                             
                                                
                                                   e
                                                
                                                
                                                   ij
                                                
                                                
                                                   T
                                                
                                             
                                             
                                                
                                                   T
                                                
                                                
                                                   T
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           
                        

If we define
                              
                                 
                                    
                                       
                                          
                                          
                                             
                                                A
                                                ≡
                                                
                                                   
                                                      
                                                         
                                                            
                                                               
                                                                  ∑
                                                               
                                                               
                                                                  i
                                                                  =
                                                                  1
                                                               
                                                               
                                                                  N
                                                               
                                                            
                                                         
                                                         
                                                            
                                                               
                                                                  ∑
                                                               
                                                               
                                                                  j
                                                                  =
                                                                  i
                                                                  +
                                                                  1
                                                               
                                                               
                                                                  N
                                                               
                                                            
                                                         
                                                         
                                                            
                                                               
                                                                  ∑
                                                               
                                                               
                                                                  
                                                                     
                                                                        k
                                                                     
                                                                     
                                                                        ˆ
                                                                     
                                                                  
                                                                  =
                                                                  1
                                                               
                                                               
                                                                  
                                                                     
                                                                        m
                                                                     
                                                                     
                                                                        ij
                                                                     
                                                                  
                                                               
                                                            
                                                         
                                                         
                                                            
                                                               ω
                                                            
                                                            
                                                               ij
                                                            
                                                            
                                                               
                                                                  
                                                                     k
                                                                  
                                                                  
                                                                     ˆ
                                                                  
                                                               
                                                            
                                                         
                                                         
                                                            
                                                               c
                                                            
                                                            
                                                               ij
                                                            
                                                            
                                                               
                                                                  
                                                                     k
                                                                  
                                                                  
                                                                     ˆ
                                                                  
                                                               
                                                            
                                                         
                                                         
                                                            
                                                               
                                                                  
                                                                     c
                                                                  
                                                                  
                                                                     ij
                                                                  
                                                                  
                                                                     
                                                                        
                                                                           k
                                                                        
                                                                        
                                                                           ˆ
                                                                        
                                                                     
                                                                  
                                                               
                                                            
                                                            
                                                               T
                                                            
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                       
                                       
                                          
                                          
                                             
                                                B
                                                ≡
                                                
                                                   
                                                      e
                                                   
                                                   
                                                      ij
                                                   
                                                
                                                
                                                   
                                                      
                                                         
                                                            
                                                               
                                                                  ∑
                                                               
                                                               
                                                                  i
                                                                  =
                                                                  1
                                                               
                                                               
                                                                  N
                                                               
                                                            
                                                         
                                                         
                                                            
                                                               
                                                                  ∑
                                                               
                                                               
                                                                  j
                                                                  =
                                                                  i
                                                                  +
                                                                  1
                                                               
                                                               
                                                                  N
                                                               
                                                            
                                                         
                                                         
                                                            
                                                               
                                                                  ∑
                                                               
                                                               
                                                                  
                                                                     
                                                                        k
                                                                     
                                                                     
                                                                        ˆ
                                                                     
                                                                  
                                                                  =
                                                                  1
                                                               
                                                               
                                                                  
                                                                     
                                                                        m
                                                                     
                                                                     
                                                                        ij
                                                                     
                                                                  
                                                               
                                                            
                                                         
                                                         
                                                            
                                                               ω
                                                            
                                                            
                                                               ij
                                                            
                                                            
                                                               
                                                                  
                                                                     k
                                                                  
                                                                  
                                                                     ˆ
                                                                  
                                                               
                                                            
                                                         
                                                         
                                                            
                                                               
                                                                  
                                                                     c
                                                                  
                                                                  
                                                                     ij
                                                                  
                                                                  
                                                                     
                                                                        
                                                                           k
                                                                        
                                                                        
                                                                           ˆ
                                                                        
                                                                     
                                                                  
                                                               
                                                            
                                                            
                                                               T
                                                            
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                       
                                       
                                          
                                          
                                             
                                                C
                                                ≡
                                                
                                                   
                                                      
                                                         
                                                            
                                                               
                                                                  ∑
                                                               
                                                               
                                                                  i
                                                                  =
                                                                  1
                                                               
                                                               
                                                                  N
                                                               
                                                            
                                                         
                                                         
                                                            
                                                               
                                                                  ∑
                                                               
                                                               
                                                                  j
                                                                  =
                                                                  i
                                                                  +
                                                                  1
                                                               
                                                               
                                                                  N
                                                               
                                                            
                                                         
                                                         
                                                            
                                                               
                                                                  ∑
                                                               
                                                               
                                                                  
                                                                     
                                                                        k
                                                                     
                                                                     
                                                                        ˆ
                                                                     
                                                                  
                                                                  =
                                                                  1
                                                               
                                                               
                                                                  
                                                                     
                                                                        m
                                                                     
                                                                     
                                                                        ij
                                                                     
                                                                  
                                                               
                                                            
                                                         
                                                         
                                                            
                                                               ω
                                                            
                                                            
                                                               ij
                                                            
                                                            
                                                               
                                                                  
                                                                     k
                                                                  
                                                                  
                                                                     ˆ
                                                                  
                                                               
                                                            
                                                         
                                                      
                                                   
                                                
                                                
                                                   
                                                      e
                                                   
                                                   
                                                      ij
                                                   
                                                
                                                
                                                   
                                                      e
                                                   
                                                   
                                                      ij
                                                   
                                                   
                                                      T
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           then, the error function can be represented as follows:
                              
                                 (22)
                                 
                                    ε
                                    =
                                    tr
                                    
                                       
                                          
                                             [
                                             R
                                             |
                                             T
                                             ]
                                             
                                                
                                                   
                                                      
                                                         
                                                            
                                                               A
                                                            
                                                            
                                                               B
                                                            
                                                         
                                                         
                                                            
                                                               
                                                                  
                                                                     B
                                                                  
                                                                  
                                                                     T
                                                                  
                                                               
                                                            
                                                            
                                                               C
                                                            
                                                         
                                                      
                                                   
                                                
                                             
                                             
                                                
                                                   
                                                      
                                                         
                                                            
                                                               
                                                                  
                                                                     R
                                                                  
                                                                  
                                                                     T
                                                                  
                                                               
                                                            
                                                         
                                                         
                                                            
                                                               
                                                                  
                                                                     T
                                                                  
                                                                  
                                                                     T
                                                                  
                                                               
                                                            
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           
                        

The obtained Eq. (22) corresponds to the same error function presented by Krishnan in [13], but in this case the components 
                              
                                 A
                                 ,
                                 B
                              
                            and 
                              
                                 C
                              
                            integrate inside them the uncertainty of the weight coefficients 
                              
                                 
                                    
                                       ω
                                    
                                    
                                       ij
                                    
                                    
                                       
                                          
                                             k
                                          
                                          
                                             ˆ
                                          
                                       
                                    
                                 
                              
                           .

Also following the idea of [13], the total registration error function can be written only in terms of rotations 
                              
                                 R
                              
                           , since the optimal set of translations can be computed in terms of 
                              
                                 R
                              
                            as:
                              
                                 (23)
                                 
                                    T
                                    (
                                    R
                                    )
                                    =
                                    -
                                    
                                       
                                          RBC
                                       
                                       
                                          †
                                       
                                    
                                 
                              
                           where 
                              
                                 
                                    
                                       C
                                    
                                    
                                       †
                                    
                                 
                              
                            is the pseudo-inverse of 
                              
                                 C
                              
                           . In this case the Eq. (22) transforms into:
                              
                                 (24)
                                 
                                    ε
                                    =
                                    tr
                                    (
                                    
                                       
                                          RMR
                                       
                                       
                                          T
                                       
                                    
                                    )
                                 
                              
                           where 
                              
                                 M
                                 ≡
                                 A
                                 -
                                 
                                    
                                       BC
                                    
                                    
                                       †
                                    
                                 
                                 
                                    
                                       B
                                    
                                    
                                       T
                                    
                                 
                              
                            is the Schur complement of the matrix 
                              
                                 
                                    
                                       
                                          
                                             
                                                
                                                   A
                                                
                                                
                                                   B
                                                
                                             
                                             
                                                
                                                   
                                                      
                                                         B
                                                      
                                                      
                                                         T
                                                      
                                                   
                                                
                                                
                                                   C
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           .

According to the EM algorithm formulation, the Maximization step will be the posterior expectation of Eq. (24):
                              
                                 (25)
                                 
                                    E
                                    (
                                    θ
                                    )
                                    =
                                    -
                                    
                                       
                                          
                                             ∑
                                          
                                          
                                             i
                                             =
                                             1
                                          
                                          
                                             N
                                          
                                       
                                    
                                    
                                       
                                          
                                             ∑
                                          
                                          
                                             j
                                             =
                                             i
                                             +
                                             1
                                          
                                          
                                             N
                                          
                                       
                                    
                                    
                                       
                                          
                                             ∑
                                          
                                          
                                             
                                                
                                                   k
                                                
                                                
                                                   ˆ
                                                
                                             
                                             =
                                             1
                                          
                                          
                                             
                                                
                                                   m
                                                
                                                
                                                   ij
                                                
                                             
                                          
                                       
                                    
                                    E
                                    
                                       
                                          
                                             ε
                                             
                                                
                                                   
                                                      
                                                         
                                                            v
                                                         
                                                         
                                                            ij
                                                         
                                                         
                                                            k
                                                         
                                                      
                                                      ,
                                                      
                                                         
                                                            v
                                                         
                                                         
                                                            ji
                                                         
                                                         
                                                            
                                                               
                                                                  k
                                                               
                                                               
                                                                  ′
                                                               
                                                            
                                                         
                                                      
                                                      |
                                                      θ
                                                   
                                                
                                             
                                             
                                                
                                                   
                                                      P
                                                      
                                                         
                                                            
                                                               
                                                                  
                                                                     ω
                                                                  
                                                                  
                                                                     ij
                                                                  
                                                                  
                                                                     
                                                                        
                                                                           k
                                                                        
                                                                        
                                                                           ˆ
                                                                        
                                                                     
                                                                  
                                                               
                                                               =
                                                               1
                                                            
                                                         
                                                      
                                                      
                                                         
                                                            v
                                                         
                                                         
                                                            ij
                                                         
                                                         
                                                            k
                                                         
                                                      
                                                      ,
                                                      
                                                         
                                                            v
                                                         
                                                         
                                                            ji
                                                         
                                                         
                                                            k
                                                         
                                                      
                                                      ,
                                                      
                                                         
                                                            θ
                                                         
                                                         
                                                            l
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                    =
                                    tr
                                    
                                       
                                          
                                             R
                                             E
                                             
                                                
                                                   
                                                      M
                                                      
                                                         
                                                            
                                                               P
                                                               
                                                                  
                                                                     
                                                                        
                                                                           
                                                                              ω
                                                                           
                                                                           
                                                                              ij
                                                                           
                                                                           
                                                                              
                                                                                 
                                                                                    k
                                                                                 
                                                                                 
                                                                                    ˆ
                                                                                 
                                                                              
                                                                           
                                                                        
                                                                        =
                                                                        1
                                                                     
                                                                  
                                                               
                                                               
                                                                  
                                                                     v
                                                                  
                                                                  
                                                                     ij
                                                                  
                                                                  
                                                                     k
                                                                  
                                                               
                                                               ,
                                                               
                                                                  
                                                                     v
                                                                  
                                                                  
                                                                     ji
                                                                  
                                                                  
                                                                     
                                                                        
                                                                           k
                                                                        
                                                                        
                                                                           ′
                                                                        
                                                                     
                                                                  
                                                               
                                                               ,
                                                               
                                                                  
                                                                     θ
                                                                  
                                                                  
                                                                     l
                                                                  
                                                               
                                                            
                                                         
                                                      
                                                   
                                                
                                             
                                             
                                                
                                                   R
                                                
                                                
                                                   T
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           
                        

Note that, since the connection weights 
                              
                                 
                                    
                                       ω
                                    
                                    
                                       ij
                                    
                                    
                                       
                                          
                                             k
                                          
                                          
                                             ˆ
                                          
                                       
                                    
                                 
                              
                            are not directly observable, the elements of 
                              
                                 E
                                 
                                    
                                       
                                          M
                                          |
                                          P
                                          
                                             
                                                
                                                   
                                                      
                                                         ω
                                                      
                                                      
                                                         ij
                                                      
                                                      
                                                         
                                                            
                                                               k
                                                            
                                                            
                                                               ˆ
                                                            
                                                         
                                                      
                                                   
                                                   =
                                                   1
                                                   |
                                                   
                                                      
                                                         v
                                                      
                                                      
                                                         ij
                                                      
                                                      
                                                         k
                                                      
                                                   
                                                   ,
                                                   
                                                      
                                                         v
                                                      
                                                      
                                                         ji
                                                      
                                                      
                                                         
                                                            
                                                               k
                                                            
                                                            
                                                               ′
                                                            
                                                         
                                                      
                                                   
                                                   ,
                                                   
                                                      
                                                         θ
                                                      
                                                      
                                                         l
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                              
                            matrix must be estimated in each iteration process of the optimization algorithm, i.e.:
                              
                                 (26)
                                 
                                    E
                                    [
                                    A
                                    ]
                                    =
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      ∑
                                                   
                                                   
                                                      i
                                                      =
                                                      1
                                                   
                                                   
                                                      N
                                                   
                                                
                                             
                                             
                                                
                                                   
                                                      ∑
                                                   
                                                   
                                                      j
                                                      =
                                                      i
                                                      +
                                                      1
                                                   
                                                   
                                                      N
                                                   
                                                
                                             
                                             
                                                
                                                   
                                                      ∑
                                                   
                                                   
                                                      
                                                         
                                                            k
                                                         
                                                         
                                                            ˆ
                                                         
                                                      
                                                      =
                                                      1
                                                   
                                                   
                                                      
                                                         
                                                            m
                                                         
                                                         
                                                            ij
                                                         
                                                      
                                                   
                                                
                                             
                                             P
                                             
                                                
                                                   
                                                      
                                                         
                                                            ω
                                                         
                                                         
                                                            ij
                                                         
                                                         
                                                            
                                                               
                                                                  k
                                                               
                                                               
                                                                  ˆ
                                                               
                                                            
                                                         
                                                      
                                                      |
                                                      
                                                         
                                                            v
                                                         
                                                         
                                                            ij
                                                         
                                                         
                                                            k
                                                         
                                                      
                                                      ,
                                                      
                                                         
                                                            v
                                                         
                                                         
                                                            ji
                                                         
                                                         
                                                            
                                                               
                                                                  k
                                                               
                                                               
                                                                  ′
                                                               
                                                            
                                                         
                                                      
                                                      ,
                                                      
                                                         
                                                            θ
                                                         
                                                         
                                                            l
                                                         
                                                      
                                                   
                                                
                                             
                                             
                                                
                                                   c
                                                
                                                
                                                   ij
                                                
                                                
                                                   
                                                      
                                                         k
                                                      
                                                      
                                                         ˆ
                                                      
                                                   
                                                
                                             
                                             
                                                
                                                   
                                                      
                                                         c
                                                      
                                                      
                                                         ij
                                                      
                                                      
                                                         
                                                            
                                                               k
                                                            
                                                            
                                                               ˆ
                                                            
                                                         
                                                      
                                                   
                                                
                                                
                                                   T
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           
                           
                              
                                 (27)
                                 
                                    E
                                    [
                                    B
                                    ]
                                    =
                                    
                                       
                                          e
                                       
                                       
                                          ab
                                       
                                    
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      ∑
                                                   
                                                   
                                                      i
                                                      =
                                                      1
                                                   
                                                   
                                                      N
                                                   
                                                
                                             
                                             
                                                
                                                   
                                                      ∑
                                                   
                                                   
                                                      j
                                                      =
                                                      i
                                                      +
                                                      1
                                                   
                                                   
                                                      N
                                                   
                                                
                                             
                                             
                                                
                                                   
                                                      ∑
                                                   
                                                   
                                                      
                                                         
                                                            k
                                                         
                                                         
                                                            ˆ
                                                         
                                                      
                                                      =
                                                      1
                                                   
                                                   
                                                      
                                                         
                                                            m
                                                         
                                                         
                                                            ij
                                                         
                                                      
                                                   
                                                
                                             
                                             P
                                             
                                                
                                                   
                                                      
                                                         
                                                            ω
                                                         
                                                         
                                                            ij
                                                         
                                                         
                                                            
                                                               
                                                                  k
                                                               
                                                               
                                                                  ˆ
                                                               
                                                            
                                                         
                                                      
                                                      |
                                                      
                                                         
                                                            v
                                                         
                                                         
                                                            ij
                                                         
                                                         
                                                            k
                                                         
                                                      
                                                      ,
                                                      
                                                         
                                                            v
                                                         
                                                         
                                                            ji
                                                         
                                                         
                                                            
                                                               
                                                                  k
                                                               
                                                               
                                                                  ′
                                                               
                                                            
                                                         
                                                      
                                                      ,
                                                      
                                                         
                                                            θ
                                                         
                                                         
                                                            l
                                                         
                                                      
                                                   
                                                
                                             
                                             
                                                
                                                   
                                                      
                                                         c
                                                      
                                                      
                                                         ij
                                                      
                                                      
                                                         
                                                            
                                                               k
                                                            
                                                            
                                                               ˆ
                                                            
                                                         
                                                      
                                                   
                                                
                                                
                                                   T
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           
                           
                              
                                 (28)
                                 
                                    E
                                    [
                                    C
                                    ]
                                    =
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      ∑
                                                   
                                                   
                                                      i
                                                      =
                                                      1
                                                   
                                                   
                                                      N
                                                   
                                                
                                             
                                             
                                                
                                                   
                                                      ∑
                                                   
                                                   
                                                      j
                                                      =
                                                      i
                                                      +
                                                      1
                                                   
                                                   
                                                      N
                                                   
                                                
                                             
                                             
                                                
                                                   
                                                      ∑
                                                   
                                                   
                                                      
                                                         
                                                            k
                                                         
                                                         
                                                            ˆ
                                                         
                                                      
                                                      =
                                                      1
                                                   
                                                   
                                                      
                                                         
                                                            m
                                                         
                                                         
                                                            ij
                                                         
                                                      
                                                   
                                                
                                             
                                             P
                                             
                                                
                                                   
                                                      
                                                         
                                                            ω
                                                         
                                                         
                                                            ij
                                                         
                                                         
                                                            
                                                               
                                                                  k
                                                               
                                                               
                                                                  ˆ
                                                               
                                                            
                                                         
                                                      
                                                      |
                                                      
                                                         
                                                            v
                                                         
                                                         
                                                            ij
                                                         
                                                         
                                                            k
                                                         
                                                      
                                                      ,
                                                      
                                                         
                                                            v
                                                         
                                                         
                                                            ji
                                                         
                                                         
                                                            
                                                               
                                                                  k
                                                               
                                                               
                                                                  ′
                                                               
                                                            
                                                         
                                                      
                                                      ,
                                                      
                                                         
                                                            θ
                                                         
                                                         
                                                            l
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                    
                                       
                                          e
                                       
                                       
                                          ij
                                       
                                    
                                    
                                       
                                          e
                                       
                                       
                                          ij
                                       
                                       
                                          T
                                       
                                    
                                 
                              
                           where 
                              
                                 P
                                 
                                    
                                       
                                          
                                             
                                                ω
                                             
                                             
                                                ij
                                             
                                             
                                                
                                                   
                                                      k
                                                   
                                                   
                                                      ˆ
                                                   
                                                
                                             
                                          
                                          =
                                          1
                                          |
                                          
                                             
                                                v
                                             
                                             
                                                ij
                                             
                                             
                                                k
                                             
                                          
                                          ,
                                          
                                             
                                                v
                                             
                                             
                                                ji
                                             
                                             
                                                
                                                   
                                                      k
                                                   
                                                   
                                                      ′
                                                   
                                                
                                             
                                          
                                          ,
                                          
                                             
                                                θ
                                             
                                             
                                                l
                                             
                                          
                                       
                                    
                                 
                                 ∝
                                 exp
                                 
                                    
                                       
                                          -
                                          α
                                          ε
                                          
                                             
                                                
                                                   
                                                      
                                                         v
                                                      
                                                      
                                                         ij
                                                      
                                                      
                                                         k
                                                      
                                                   
                                                   ,
                                                   
                                                      
                                                         v
                                                      
                                                      
                                                         ji
                                                      
                                                      
                                                         
                                                            
                                                               k
                                                            
                                                            
                                                               ′
                                                            
                                                         
                                                      
                                                   
                                                   |
                                                   
                                                      
                                                         θ
                                                      
                                                      
                                                         l
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                              
                            and α is obtained from the Expectation step in Eq. (16).

As a summary of the whole process, in order to implement the proposed method the schema shown in Algorithm 1 should be followed
                           Algorithm 1
                           Summary of the proposed method 
                                 
                                    
                                       
                                       
                                          
                                             
                                                Initialization
                                             
                                          
                                          
                                             
                                                
                                                   
                                                      •
                                                      Obtain an initial estimate for 
                                                            
                                                               
                                                                  
                                                                     θ
                                                                  
                                                                  
                                                                     0
                                                                  
                                                               
                                                               =
                                                               
                                                                  
                                                                     
                                                                        
                                                                           
                                                                              R
                                                                           
                                                                           
                                                                              1
                                                                           
                                                                           
                                                                              0
                                                                           
                                                                        
                                                                        ,
                                                                        …
                                                                        ,
                                                                        
                                                                           
                                                                              R
                                                                           
                                                                           
                                                                              N
                                                                           
                                                                           
                                                                              0
                                                                           
                                                                        
                                                                        ,
                                                                        
                                                                           
                                                                              t
                                                                           
                                                                           
                                                                              1
                                                                           
                                                                           
                                                                              0
                                                                           
                                                                        
                                                                        ,
                                                                        …
                                                                        ,
                                                                        
                                                                           
                                                                              t
                                                                           
                                                                           
                                                                              N
                                                                           
                                                                           
                                                                              0
                                                                           
                                                                        
                                                                     
                                                                  
                                                               
                                                            
                                                          using the original Krishnan method, which corresponds to an ideal case without correspondences uncertainty
                                                   
                                                   
                                                      •
                                                      Initialize the correspondences uncertainty matrix 
                                                            
                                                               
                                                                  
                                                                     ω
                                                                  
                                                                  
                                                                     ij
                                                                  
                                                                  
                                                                     
                                                                        
                                                                           k
                                                                        
                                                                        
                                                                           ˆ
                                                                        
                                                                     
                                                                  
                                                               
                                                            
                                                          to 1 for all the correspondences
                                                   
                                                
                                             
                                          
                                          
                                             
                                                while
                                                
                                                   
                                                      
                                                         
                                                            
                                                               ε
                                                               
                                                                  
                                                                     
                                                                        
                                                                           
                                                                              v
                                                                           
                                                                           
                                                                              ij
                                                                           
                                                                           
                                                                              k
                                                                           
                                                                        
                                                                        ,
                                                                        
                                                                           
                                                                              v
                                                                           
                                                                           
                                                                              ji
                                                                           
                                                                           
                                                                              
                                                                                 
                                                                                    k
                                                                                 
                                                                                 
                                                                                    ′
                                                                                 
                                                                              
                                                                           
                                                                        
                                                                        |
                                                                        
                                                                           
                                                                              θ
                                                                           
                                                                           
                                                                              l
                                                                              +
                                                                              1
                                                                           
                                                                        
                                                                     
                                                                  
                                                               
                                                               -
                                                               ε
                                                               
                                                                  
                                                                     
                                                                        
                                                                           
                                                                              v
                                                                           
                                                                           
                                                                              ij
                                                                           
                                                                           
                                                                              k
                                                                           
                                                                        
                                                                        ,
                                                                        
                                                                           
                                                                              v
                                                                           
                                                                           
                                                                              ji
                                                                           
                                                                           
                                                                              
                                                                                 
                                                                                    k
                                                                                 
                                                                                 
                                                                                    ′
                                                                                 
                                                                              
                                                                           
                                                                        
                                                                        |
                                                                        
                                                                           
                                                                              θ
                                                                           
                                                                           
                                                                              l
                                                                           
                                                                        
                                                                     
                                                                  
                                                               
                                                            
                                                         
                                                      
                                                      >
                                                      ξ
                                                   
                                                
                                                do
                                          
                                          
                                             
                                                 
                                                Expectation
                                             
                                          
                                          
                                             
                                                
                                                   
                                                      •
                                                      Find the sufficient statistics of the exponential distribution shown in Eq. (14):
                                                            
                                                               
                                                                  α
                                                                  =
                                                                  
                                                                     
                                                                        
                                                                           
                                                                              ∑
                                                                           
                                                                           
                                                                              i
                                                                              =
                                                                              1
                                                                           
                                                                           
                                                                              N
                                                                           
                                                                        
                                                                        
                                                                           
                                                                              ∑
                                                                           
                                                                           
                                                                              j
                                                                              =
                                                                              i
                                                                              +
                                                                              1
                                                                           
                                                                           
                                                                              N
                                                                           
                                                                        
                                                                        E
                                                                        
                                                                           
                                                                              
                                                                                 
                                                                                    
                                                                                       ω
                                                                                    
                                                                                    
                                                                                       ij
                                                                                    
                                                                                    
                                                                                       
                                                                                          
                                                                                             k
                                                                                          
                                                                                          
                                                                                             ˆ
                                                                                          
                                                                                       
                                                                                    
                                                                                 
                                                                                 
                                                                                    
                                                                                       
                                                                                          P
                                                                                          
                                                                                             
                                                                                                
                                                                                                   
                                                                                                      
                                                                                                         ω
                                                                                                      
                                                                                                      
                                                                                                         ij
                                                                                                      
                                                                                                      
                                                                                                         
                                                                                                            
                                                                                                               k
                                                                                                            
                                                                                                            
                                                                                                               ˆ
                                                                                                            
                                                                                                         
                                                                                                      
                                                                                                   
                                                                                                
                                                                                             
                                                                                          
                                                                                          
                                                                                             
                                                                                                v
                                                                                             
                                                                                             
                                                                                                ij
                                                                                             
                                                                                             
                                                                                                k
                                                                                             
                                                                                          
                                                                                          ,
                                                                                          
                                                                                             
                                                                                                v
                                                                                             
                                                                                             
                                                                                                ji
                                                                                             
                                                                                             
                                                                                                
                                                                                                   
                                                                                                      k
                                                                                                   
                                                                                                   
                                                                                                      ′
                                                                                                   
                                                                                                
                                                                                             
                                                                                          
                                                                                          ,
                                                                                          
                                                                                             
                                                                                                θ
                                                                                             
                                                                                             
                                                                                                l
                                                                                             
                                                                                          
                                                                                       
                                                                                    
                                                                                 
                                                                              
                                                                           
                                                                        
                                                                     
                                                                     
                                                                        
                                                                           
                                                                              ∑
                                                                           
                                                                           
                                                                              i
                                                                              =
                                                                              1
                                                                           
                                                                           
                                                                              N
                                                                           
                                                                        
                                                                        
                                                                           
                                                                              ∑
                                                                           
                                                                           
                                                                              j
                                                                              =
                                                                              i
                                                                              +
                                                                              1
                                                                           
                                                                           
                                                                              N
                                                                           
                                                                        
                                                                        E
                                                                        
                                                                           
                                                                              
                                                                                 
                                                                                    
                                                                                       ω
                                                                                    
                                                                                    
                                                                                       ij
                                                                                    
                                                                                    
                                                                                       
                                                                                          
                                                                                             k
                                                                                          
                                                                                          
                                                                                             ˆ
                                                                                          
                                                                                       
                                                                                    
                                                                                 
                                                                                 |
                                                                                 P
                                                                                 
                                                                                    
                                                                                       
                                                                                          
                                                                                             
                                                                                                ω
                                                                                             
                                                                                             
                                                                                                ij
                                                                                             
                                                                                             
                                                                                                
                                                                                                   
                                                                                                      k
                                                                                                   
                                                                                                   
                                                                                                      ˆ
                                                                                                   
                                                                                                
                                                                                             
                                                                                          
                                                                                          |
                                                                                          
                                                                                             
                                                                                                v
                                                                                             
                                                                                             
                                                                                                ij
                                                                                             
                                                                                             
                                                                                                k
                                                                                             
                                                                                          
                                                                                          ,
                                                                                          
                                                                                             
                                                                                                v
                                                                                             
                                                                                             
                                                                                                ji
                                                                                             
                                                                                             
                                                                                                
                                                                                                   
                                                                                                      k
                                                                                                   
                                                                                                   
                                                                                                      ′
                                                                                                   
                                                                                                
                                                                                             
                                                                                          
                                                                                          ,
                                                                                          
                                                                                             
                                                                                                θ
                                                                                             
                                                                                             
                                                                                                l
                                                                                             
                                                                                          
                                                                                       
                                                                                    
                                                                                 
                                                                              
                                                                           
                                                                        
                                                                        ε
                                                                        
                                                                           
                                                                              
                                                                                 
                                                                                    
                                                                                       v
                                                                                    
                                                                                    
                                                                                       ij
                                                                                    
                                                                                    
                                                                                       k
                                                                                    
                                                                                 
                                                                                 ,
                                                                                 
                                                                                    
                                                                                       v
                                                                                    
                                                                                    
                                                                                       ji
                                                                                    
                                                                                    
                                                                                       
                                                                                          
                                                                                             k
                                                                                          
                                                                                          
                                                                                             ′
                                                                                          
                                                                                       
                                                                                    
                                                                                 
                                                                                 |
                                                                                 
                                                                                    
                                                                                       θ
                                                                                    
                                                                                    
                                                                                       l
                                                                                    
                                                                                 
                                                                              
                                                                           
                                                                        
                                                                     
                                                                  
                                                               
                                                            
                                                         
                                                      
                                                   
                                                   
                                                      •
                                                      For each pairwise correspondence used in the registration process, infer the new uncertainty factor
                                                            
                                                               
                                                                  
                                                                     
                                                                        ω
                                                                     
                                                                     
                                                                        new
                                                                     
                                                                  
                                                                  =
                                                                  
                                                                     
                                                                        ω
                                                                     
                                                                     
                                                                        old
                                                                     
                                                                  
                                                                  
                                                                     
                                                                        α
                                                                        exp
                                                                        
                                                                           
                                                                              
                                                                                 -
                                                                                 α
                                                                                 ε
                                                                                 
                                                                                    
                                                                                       
                                                                                          
                                                                                             
                                                                                                v
                                                                                             
                                                                                             
                                                                                                ij
                                                                                             
                                                                                             
                                                                                                k
                                                                                             
                                                                                          
                                                                                          ,
                                                                                          
                                                                                             
                                                                                                v
                                                                                             
                                                                                             
                                                                                                ji
                                                                                             
                                                                                             
                                                                                                
                                                                                                   
                                                                                                      k
                                                                                                   
                                                                                                   
                                                                                                      ′
                                                                                                   
                                                                                                
                                                                                             
                                                                                          
                                                                                          |
                                                                                          
                                                                                             
                                                                                                θ
                                                                                             
                                                                                             
                                                                                                ij
                                                                                             
                                                                                          
                                                                                       
                                                                                    
                                                                                 
                                                                              
                                                                           
                                                                        
                                                                     
                                                                     
                                                                        
                                                                           
                                                                              ∑
                                                                           
                                                                           
                                                                              i
                                                                              =
                                                                              1
                                                                           
                                                                           
                                                                              N
                                                                           
                                                                        
                                                                        
                                                                           
                                                                              ∑
                                                                           
                                                                           
                                                                              j
                                                                              =
                                                                              i
                                                                              +
                                                                              1
                                                                           
                                                                           
                                                                              N
                                                                           
                                                                        
                                                                        α
                                                                        ε
                                                                        
                                                                           
                                                                              
                                                                                 
                                                                                    
                                                                                       v
                                                                                    
                                                                                    
                                                                                       ij
                                                                                    
                                                                                    
                                                                                       k
                                                                                    
                                                                                 
                                                                                 ,
                                                                                 
                                                                                    
                                                                                       v
                                                                                    
                                                                                    
                                                                                       ji
                                                                                    
                                                                                    
                                                                                       
                                                                                          
                                                                                             k
                                                                                          
                                                                                          
                                                                                             ′
                                                                                          
                                                                                       
                                                                                    
                                                                                 
                                                                                 |
                                                                                 
                                                                                    
                                                                                       θ
                                                                                    
                                                                                    
                                                                                       ij
                                                                                    
                                                                                 
                                                                              
                                                                           
                                                                        
                                                                     
                                                                  
                                                                  ,
                                                               
                                                            
                                                         
                                                      
                                                      where for simplicity, ω
                                                         
                                                            new
                                                          indicates 
                                                            
                                                               
                                                                  
                                                                     [
                                                                     
                                                                        
                                                                           ω
                                                                        
                                                                        
                                                                           ij
                                                                        
                                                                        
                                                                           
                                                                              
                                                                                 k
                                                                              
                                                                              
                                                                                 ˆ
                                                                              
                                                                           
                                                                        
                                                                     
                                                                     ]
                                                                  
                                                                  
                                                                     l
                                                                     +
                                                                     1
                                                                  
                                                               
                                                            
                                                          and ω
                                                         
                                                            old
                                                          indicates 
                                                            
                                                               
                                                                  
                                                                     [
                                                                     
                                                                        
                                                                           ω
                                                                        
                                                                        
                                                                           ij
                                                                        
                                                                        
                                                                           
                                                                              
                                                                                 k
                                                                              
                                                                              
                                                                                 ˆ
                                                                              
                                                                           
                                                                        
                                                                     
                                                                     ]
                                                                  
                                                                  
                                                                     l
                                                                  
                                                               
                                                            
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                          
                                             
                                                 
                                                Maximization
                                             
                                          
                                          
                                             
                                                
                                                   
                                                      •
                                                      Calculate the matrices 
                                                            
                                                               A
                                                               ,
                                                               B
                                                            
                                                          and 
                                                            
                                                               C
                                                            
                                                         :
                                                            
                                                               
                                                                  
                                                                     
                                                                        
                                                                        
                                                                           
                                                                              A
                                                                              ≡
                                                                              
                                                                                 
                                                                                    
                                                                                       
                                                                                          
                                                                                             
                                                                                                ∑
                                                                                             
                                                                                             
                                                                                                i
                                                                                                =
                                                                                                1
                                                                                             
                                                                                             
                                                                                                N
                                                                                             
                                                                                          
                                                                                       
                                                                                       
                                                                                          
                                                                                             
                                                                                                ∑
                                                                                             
                                                                                             
                                                                                                j
                                                                                                =
                                                                                                i
                                                                                                +
                                                                                                1
                                                                                             
                                                                                             
                                                                                                N
                                                                                             
                                                                                          
                                                                                       
                                                                                       
                                                                                          
                                                                                             
                                                                                                ∑
                                                                                             
                                                                                             
                                                                                                
                                                                                                   
                                                                                                      k
                                                                                                   
                                                                                                   
                                                                                                      ˆ
                                                                                                   
                                                                                                
                                                                                                =
                                                                                                1
                                                                                             
                                                                                             
                                                                                                
                                                                                                   
                                                                                                      m
                                                                                                   
                                                                                                   
                                                                                                      ij
                                                                                                   
                                                                                                
                                                                                             
                                                                                          
                                                                                       
                                                                                       
                                                                                          
                                                                                             ω
                                                                                          
                                                                                          
                                                                                             ij
                                                                                          
                                                                                          
                                                                                             
                                                                                                
                                                                                                   k
                                                                                                
                                                                                                
                                                                                                   ˆ
                                                                                                
                                                                                             
                                                                                          
                                                                                       
                                                                                       
                                                                                          
                                                                                             c
                                                                                          
                                                                                          
                                                                                             ij
                                                                                          
                                                                                          
                                                                                             
                                                                                                
                                                                                                   k
                                                                                                
                                                                                                
                                                                                                   ˆ
                                                                                                
                                                                                             
                                                                                          
                                                                                       
                                                                                       
                                                                                          
                                                                                             
                                                                                                
                                                                                                   c
                                                                                                
                                                                                                
                                                                                                   ij
                                                                                                
                                                                                                
                                                                                                   
                                                                                                      
                                                                                                         k
                                                                                                      
                                                                                                      
                                                                                                         ˆ
                                                                                                      
                                                                                                   
                                                                                                
                                                                                             
                                                                                          
                                                                                          
                                                                                             T
                                                                                          
                                                                                       
                                                                                    
                                                                                 
                                                                              
                                                                           
                                                                        
                                                                     
                                                                     
                                                                        
                                                                        
                                                                           
                                                                              B
                                                                              ≡
                                                                              
                                                                                 
                                                                                    e
                                                                                 
                                                                                 
                                                                                    ij
                                                                                 
                                                                              
                                                                              
                                                                                 
                                                                                    
                                                                                       
                                                                                          
                                                                                             
                                                                                                ∑
                                                                                             
                                                                                             
                                                                                                i
                                                                                                =
                                                                                                1
                                                                                             
                                                                                             
                                                                                                N
                                                                                             
                                                                                          
                                                                                       
                                                                                       
                                                                                          
                                                                                             
                                                                                                ∑
                                                                                             
                                                                                             
                                                                                                j
                                                                                                =
                                                                                                i
                                                                                                +
                                                                                                1
                                                                                             
                                                                                             
                                                                                                N
                                                                                             
                                                                                          
                                                                                       
                                                                                       
                                                                                          
                                                                                             
                                                                                                ∑
                                                                                             
                                                                                             
                                                                                                
                                                                                                   
                                                                                                      k
                                                                                                   
                                                                                                   
                                                                                                      ˆ
                                                                                                   
                                                                                                
                                                                                                =
                                                                                                1
                                                                                             
                                                                                             
                                                                                                
                                                                                                   
                                                                                                      m
                                                                                                   
                                                                                                   
                                                                                                      ij
                                                                                                   
                                                                                                
                                                                                             
                                                                                          
                                                                                       
                                                                                       
                                                                                          
                                                                                             ω
                                                                                          
                                                                                          
                                                                                             ij
                                                                                          
                                                                                          
                                                                                             
                                                                                                
                                                                                                   k
                                                                                                
                                                                                                
                                                                                                   ˆ
                                                                                                
                                                                                             
                                                                                          
                                                                                       
                                                                                       
                                                                                          
                                                                                             
                                                                                                
                                                                                                   c
                                                                                                
                                                                                                
                                                                                                   ij
                                                                                                
                                                                                                
                                                                                                   
                                                                                                      
                                                                                                         k
                                                                                                      
                                                                                                      
                                                                                                         ˆ
                                                                                                      
                                                                                                   
                                                                                                
                                                                                             
                                                                                          
                                                                                          
                                                                                             T
                                                                                          
                                                                                       
                                                                                    
                                                                                 
                                                                              
                                                                           
                                                                        
                                                                     
                                                                     
                                                                        
                                                                        
                                                                           
                                                                              C
                                                                              ≡
                                                                              
                                                                                 
                                                                                    
                                                                                       
                                                                                          
                                                                                             
                                                                                                ∑
                                                                                             
                                                                                             
                                                                                                i
                                                                                                =
                                                                                                1
                                                                                             
                                                                                             
                                                                                                N
                                                                                             
                                                                                          
                                                                                       
                                                                                       
                                                                                          
                                                                                             
                                                                                                ∑
                                                                                             
                                                                                             
                                                                                                j
                                                                                                =
                                                                                                i
                                                                                                +
                                                                                                1
                                                                                             
                                                                                             
                                                                                                N
                                                                                             
                                                                                          
                                                                                       
                                                                                       
                                                                                          
                                                                                             
                                                                                                ∑
                                                                                             
                                                                                             
                                                                                                
                                                                                                   
                                                                                                      k
                                                                                                   
                                                                                                   
                                                                                                      ˆ
                                                                                                   
                                                                                                
                                                                                                =
                                                                                                1
                                                                                             
                                                                                             
                                                                                                
                                                                                                   
                                                                                                      m
                                                                                                   
                                                                                                   
                                                                                                      ij
                                                                                                   
                                                                                                
                                                                                             
                                                                                          
                                                                                       
                                                                                       
                                                                                          
                                                                                             ω
                                                                                          
                                                                                          
                                                                                             ij
                                                                                          
                                                                                          
                                                                                             
                                                                                                
                                                                                                   k
                                                                                                
                                                                                                
                                                                                                   ˆ
                                                                                                
                                                                                             
                                                                                          
                                                                                       
                                                                                    
                                                                                 
                                                                              
                                                                              
                                                                                 
                                                                                    e
                                                                                 
                                                                                 
                                                                                    ij
                                                                                 
                                                                              
                                                                              
                                                                                 
                                                                                    e
                                                                                 
                                                                                 
                                                                                    ij
                                                                                 
                                                                                 
                                                                                    T
                                                                                 
                                                                              
                                                                           
                                                                        
                                                                     
                                                                  
                                                               
                                                            
                                                         
                                                      
                                                   
                                                   
                                                      •
                                                      Estimate 
                                                            
                                                               
                                                                  
                                                                     θ
                                                                  
                                                                  
                                                                     l
                                                                     +
                                                                     1
                                                                  
                                                               
                                                               =
                                                               
                                                                  
                                                                     
                                                                        
                                                                           
                                                                              R
                                                                           
                                                                           
                                                                              1
                                                                           
                                                                           
                                                                              l
                                                                              +
                                                                              1
                                                                           
                                                                        
                                                                        ,
                                                                        …
                                                                        ,
                                                                        
                                                                           
                                                                              R
                                                                           
                                                                           
                                                                              N
                                                                           
                                                                           
                                                                              l
                                                                              +
                                                                              1
                                                                           
                                                                        
                                                                        ,
                                                                        
                                                                           
                                                                              t
                                                                           
                                                                           
                                                                              1
                                                                           
                                                                           
                                                                              l
                                                                              +
                                                                              1
                                                                           
                                                                        
                                                                        ,
                                                                        …
                                                                        ,
                                                                        
                                                                           
                                                                              t
                                                                           
                                                                           
                                                                              N
                                                                           
                                                                           
                                                                              l
                                                                              +
                                                                              1
                                                                           
                                                                        
                                                                     
                                                                  
                                                               
                                                            
                                                          by minimizing Eq. (14)with the posterior expectation
                                                   
                                                
                                             
                                          
                                          
                                             
                                                end
                                             
                                          
                                       
                                    
                                 
                              
                           

@&#EXPERIMENTAL RESULTS@&#

In this paper we focus on two main issues: the uncertainty on pairwise correspondences and the combination of global and local information in the registration process of multiple views.

Our technique needs, as a starting point, setting up correspondences between pairs of points belonging to two different overlapping views. These pairwise correspondences may contain some errors due to the fact that they are established by using only the information from the corresponding pair of views, which in practice means using only the local information.

These pairwise point correspondences are taken as input data for our global registration method. The proposed algorithm aims to overcome the uncertainty introduced by the local set up of correspondences between pairs of views, evaluating the contribution of each correspondence into the global registration result. The goal is to find an optimal configuration, in global terms, of Euclidean transformations based on the contribution of each pairwise correspondence. To this end, we introduce a weight factor to each pairwise correspondence so the algorithm can determine which of them have a higher contribution in the parameters estimation.

The experiments have been designed in order to study (a) the weighted contribution of each pairwise correspondence into the global estimation process and (b) their evolution along the consecutive iterations of our probabilistic method. Both analysis assume that there has been introduced a level of uncertainty in terms of mistaken pairwise correspondences (due to errors in the annotation process). We aim to evaluate the performance of our Bayesian formulation when dealing with this type of uncertainties.

To this end we propose three approaches:
                        
                           1.
                           First, we study in deep the “horn case” presented in Figs. 3 and 4, where certain pairwise correspondence points have been wrongly set up due to poor local information and symmetries between pairs of views. The goal is to show how the introduction of weighting factors minimize the contribution of those correspondences which are not coherent with the rest according to the global registration result. In this first experiment, we show how an initial result that assumes equal weights for all pairwise correspondences (obtained by using Krishnan’s technique) leads to a wrong configuration, but it can be afterwards corrected by iterating our Expectation–Maximization process.

A second experiment is presented with the aim of evaluating the robustness of the presented Bayesian formulation in terms of manually introducing wrong correspondences in pairs of overlapping views. If we assume that some of the correspondences can be incorrect (for instance, due to human factors), our goal is to study how they can affect to the final registration. In particular, we aim to study the relation between the percentage of incorrect correspondences and the algorithm performance, using manually corrupted data as input parameters.

We create a synthetic 3D object with all the necessary a priori known information, in order to be employed as ground truth. Assuming that all correspondences are correct and that the only source of error is due to noise, we can compare in terms of accuracy Krishnan’s method and our method by studying how close both estimations are to the ground truth.

The first two experiments have been tested with 3D objects from the Ohio State University (MSU/WSU) Range Image Database [22], used also in the state-of-the-art papers [10,11]. The pairwise correspondences between the views have been carried out manually, assuming little errors between the correspondences.

In cases where we want to register 3D objects with symmetries, planes or repetitive patterns it is quite probable to obtain incorrect pairwise correspondences. Due to the limited field of view, the pairwise registration between two views should seem correct in a local environment but, in a global environment and considering the rest of the views, this pairwise information can be seen as clearly incorrect. We can see an example of this situation in the case explained in Fig. 4 (the horn case), where a simple incorrect pairwise registration can ruin the whole 3D object.

Our method is applied to this specific horn case. In Fig. 5
                         we can see the evolution of the registration along the different iterations of the algorithm presented in this paper. The first iteration result shown in the Figure consists in the execution of the algorithm before applying the use of weights for the correspondences, so in fact it corresponds to the result of the Krishnan’s algorithm itself. The result using Krishnan’s method is not satisfactory at all, but is quite near to the desired result because of the fact that there exist only two or three incorrect correspondences among the total number of 196 correspondences. Using our BBMR method the different parts of the model can be registered correctly and approximately at iteration 5 we can achieve a good registration, and finally at iteration 6 the algorithm converges according to the condition specified in Algorithm 1.

Also in Fig. 5 the evolution of the error is presented, where 
                           
                              ε
                              
                                 
                                    
                                       
                                          
                                             v
                                          
                                          
                                             ij
                                          
                                          
                                             k
                                          
                                       
                                       ,
                                       
                                          
                                             v
                                          
                                          
                                             ji
                                          
                                          
                                             k
                                          
                                       
                                       |
                                       
                                          
                                             θ
                                          
                                          
                                             l
                                          
                                       
                                    
                                 
                              
                           
                         is evaluated for the 196 different correspondences of the model and displayed in a histogram. As can be seen in the Figure, at iteration 1 the majority of correspondences have their two components near each other, but there exist also some correspondences with a higher distance. Along the different iterations of our BBMR method the weight of these correspondences with higher distance are reduced, preventing their bad influence in the registration process. Looking at the form of the histograms displayed in these iterations (especially in the first and the second one), we can see that the election of a negative exponential distribution in order to model Eq. (14) was a good approximation.

The experimental result shown in Section 5.1 was a specific case which helped us in the understanding of the algorithm evolution. But, what would happen with the algorithm performance in a higher range of situations? The objective in this second experiment is to evaluate the robustness of our method for different quantities of incorrect correspondences, which are intentionally created. For this purpose we create a Matlab script which assigns random correspondences according to a specific percentage. Taking into account the total amount of correspondences of an object, increasing percentage from 5% to 50% of them are corrupted, preserving the first component of the correspondence but changing the second component to a random point of the 3D surface. This new second component should be distanced to the original second component by, at least, a distance equal to a fifth of the distance between the two most distanced points of the 3D surface, otherwise another point is randomly sought. Our BBMR method is then applied 100 times per corruption percentage, and the final result is evaluated in order to check the correct consistency of the obtained 3D surface.

The evaluation of the correctness is carried out by means of calculating the distance of all the 3D points to an already registered 3D object, which has been obtained from a previous registration process using the Krishnan’s method and without any degraded correspondence (this previously registered 3D object will be taken as ground truth in this experiment). If only one point has a distance value higher to a pre-defined threshold, the whole registration process is discarded. In our experiment this threshold is assigned to a twentieth of the distance between the two most distanced points of the 3D surface.

Three different objects have been used for the experiments, called bunny, horn and bottle. A preview of them and their main characteristics can be seen in Fig. 6
                        .

Results obtained after the simulations can be seen in Fig. 7
                        , where the vertical axis indicates the number of experiments which have been correctly registered among the 100 simulations for each degradation percentage. Both the results of our method and the results of Krishnan’s method are displayed. Krishnan’s method is used as a base for our BBMR method but, as expected, is not designed to deal with incorrect correspondences and therefore its results are not satisfactory.

The first observation after looking at Fig. 7 is that algorithm performance can vary depending on the complexity of the 3D object. Having a look at the characteristics of the 3D objects in the table shown in Fig. 6 it can be easily seen that the three objects have a similar relation between the total number of points and the number of views but, on the other side, the object bottle has a higher number of correspondences in relation to the number of views or the total number of points. Even if a higher number of these correspondences are degraded, the algorithm can achieve a good registration thanks to the additional redundancy of the object bottle in comparison with the other two objects (speaking in the relative term according to the complexity of the object).

Independently of the complexity of the object, looking at the reference lines displayed on Fig. 7 it can be observed that our algorithm achieves a 90% of success registrations for cases where there exist approximately 10% or 15% of incorrect correspondences between the 3D views. In addition, around half of the experiments achieve a good registration for degradation percentages between 30% and 35%, i.e. in cases where approximately one out of three correspondences were incorrect. Finally, the algorithm performance is almost null for cases with 50% of degradation percentage and beyond.

In addition to the results displayed in Fig. 7, it must also be noted that, specially for the experiments with degradation errors below 40%, the incorrect registrations results obtained are usually composed of a high amount of views correctly registered with just one or two views incorrectly aligned, giving a final result which is obviously incorrect but in any case highly better than the result using the original Krishnan’s method. An example of this event can be seen on Fig. 8
                        . In cases similar to the one displayed in the Figure a possible procedure could be the removal of the misaligned view from the global multiview registration. As an indicator of the possible results obtained by using this procedure, in Fig. 9
                         we present the performance of our BBMR method giving the possibility of subtracting one or two misaligned views, achieving a final result where a high percentage of the initial views are correctly aligned.

The previous experiments were related to the robustness of the presented method in order to deal with incorrect correspondences. This is the main property of our method, but there exists also the possibility of improving the registration in cases where the correspondences are just affected by small deviations produced by the noise, inaccurate manual selection of points or other factors. The iterated processes and the use of weight factors help to improve the final result of the multiview registration with respect to the Krishnan’s method, giving more relevance to the most correct correspondences and less relevance to the least ones.

In order to evaluate with precision the accuracy improvement a synthetic 3D model has been created. This synthetic model is taken as ground truth for this experiment. Different views of the model, its measures and the associated registration graph of views can be seen in Fig. 10
                        . The model is composed by 6 faces (identified by colors R–G–B–C–M–Y) and 8 vertices. The different faces are considered the views of the model, and every face is pairwise registered against its 4 face neighbors by manual correspondence selection, assuming little errors.

Two different experiments are carried out with the synthetic model described: (1) vertex precision and (2) normal vector precision.

The objective of the experiment is to evaluate the accuracy improvement with respect to the Krishnan’s method in the different intersections of the synthetic model. According to the structure of the model (see Fig. 10), each vertex has the intersection of three different faces (for example, vertex number 3 has, as can be seen in Fig. 11
                           , the intersection of the faces R, M and C), so in total the object syntheticModel has 24 intersections.

Our registration method is applied to the synthetic model, and the results obtained are compared with the ones obtained by using the Krishnan’s method. Specifically, the distances between the vertices of the 24 correspondences are observed, and the results are shown in Fig. 12
                           .

Results show that our method improves the registration in 20 intersections, but the remaining 4 intersections are getting worse. However, the increment of distance in these 4 intersections with respect to the Krishnan’s method is quite small, and is produced by the rigid condition of the synthetic model. Small rotations of an specific rigid face could produce a high improvement in some of its intersections, but on the other side one or two intersections could be negatively affected (from the total number of 8 intersections for each face). In order to obtain a more reliable result we can compute the average of the distances, where we can see that Krishnan’s method obtains a mean value of 1.47mm. and our method obtains a mean value of 0.81mm., so a reduction of 44.89% from the initial distance is achieved using our BBMR method.

In addition to the vertex precision explained in the previous experiments other characteristics of the synthetic model can be studied after the registration. According to the design of the synthetic model in Fig. 10, and as can be seen with more detail in Fig. 13
                           , it must be accomplished that:
                              
                                 •
                                 The normal vector of R with respect to the normal vector of G form an angle of 90°.

The normal vector of R with respect to the normal vector of B form an angle of 180°.

The normal vector of R with respect to the normal vector of M form an angle of 90°.

The normal vector of R with respect to the normal vector of C form an angle of 126.87°.

The normal vector of R with respect to the normal vector of Y form an angle of 126.87°.

The results after the simulations are displayed in Fig. 14
                           , where the iteration 1 and 18 are shown. Despite that the visual evaluation does not reflect a big difference, the exact measurement shown in the text reflects a better approximation to the ideal values at iteration 18. At iteration 1, which corresponds to the Krishnan’s method, the mean of angular error value is 2.2786°. At iteration 18, last iteration before the algorithm converges, the mean of angular error value is 0.25955°. The evolution of this mean of angular error is shown in Fig. 15
                           , where it can be seen that the error is decreasing continuously like a negative exponential function.

@&#CONCLUSIONS AND FUTURE WORK@&#

This paper presents our Bayesian-Based Multiview Registration (BBMR) method for the registration of multiple 3D scans. The main property of our BBMR method consists in the property of being tolerant to a certain number of incorrect correspondences which could be caused by different factors like an incorrect manual selection, symmetries on the scanned 3D object or repetitive patterns. This tolerance is achieved thanks to the use of an additional layer placed over an existing multiview registration method, by using weight values which are applied to the point correspondences depending on their reliability. The value of these weights is estimated iteratively by means of a Bayesian framework, and the global registration problem is solved thanks to the Expectation Maximization method.

Results obtained show that the presented algorithm is able to register correctly approximately half of the 3D scenes with an incorrect pairwise correspondence tax between 30% and 35%. This result outperforms other existing registration methods, allowing a higher flexibility in the establishment of pairwise correspondences either by manual or automatic selection. In addition, in cases with a low degradation percentage, our BBMR method achieves also a better registration compared to the Krishnan algorithm, used as base method for our study. As a drawback the algorithm takes a relative high time, as it is basically composed of multiple iterations of this Krishnan algorithm.

Possible studies to develop in the near future include the possibility of defining a distance metric in order to evaluate the compactivity or consistency of the registration result after each iteration of the BBMR method. In the experimental results section of this paper we partly solved this situation by comparing the resulting final registration against a pre-registered object, but in a more general situation it is not expected to have access to this reference object. Of course, this distance metric should be defined “from an external point of view” and independent of the beforehand obtained pairwise correspondences, because it could be the case that these pairwise correspondence could be incorrect. Methods like the ones explained by Huber and Hebert in [23] regarding the space violation with respect to the visibility or the Surface Interpenetration Measure presented by Silva et al. in [9] could be used and combined for this purpose.

@&#ACKNOWLEDGMENT@&#

This work was partially funded by the research project TIN2012-39203.

Consider the joint distribution 
                        
                           P
                           (
                           X
                           ,
                           Z
                           |
                           θ
                           )
                        
                      over the complete data set in our pursue of maximizing 
                        
                           P
                           (
                           X
                           |
                           θ
                           )
                        
                     , since:
                        
                           (A.1)
                           
                              P
                              (
                              X
                              |
                              θ
                              )
                              =
                              
                                 
                                    
                                       ∑
                                    
                                    
                                       Z
                                    
                                 
                              
                              P
                              (
                              X
                              ,
                              Z
                              |
                              θ
                              )
                           
                        
                     which is equivalent to maximize the log-likelihood:
                        
                           (A.2)
                           
                              L
                              (
                              X
                              |
                              θ
                              )
                              =
                              log
                              [
                              P
                              (
                              X
                              |
                              θ
                              )
                              ]
                              =
                              log
                              
                                 
                                    
                                       
                                          
                                             
                                                ∑
                                             
                                             
                                                Z
                                             
                                          
                                       
                                       P
                                       (
                                       X
                                       ,
                                       Z
                                       |
                                       θ
                                       )
                                    
                                 
                              
                           
                        
                     where a set of arbitrary distributions Q(Z) can be introduced without losing generality:
                        
                           (A.3)
                           
                              L
                              (
                              X
                              |
                              θ
                              )
                              =
                              log
                              
                                 
                                    
                                       
                                          
                                             
                                                ∑
                                             
                                             
                                                Z
                                             
                                          
                                       
                                       Q
                                       (
                                       Z
                                       )
                                       
                                          
                                             P
                                             (
                                             X
                                             ,
                                             Z
                                             |
                                             θ
                                             )
                                          
                                          
                                             Q
                                             (
                                             Z
                                             )
                                          
                                       
                                    
                                 
                              
                           
                        
                     
                  

By means of Jensen’s inequality [24,25], a lower bound to this log-likelihood can be computed
                        
                           (A.4)
                           
                              L
                              (
                              X
                              |
                              θ
                              )
                              =
                              log
                              
                                 
                                    
                                       
                                          
                                             
                                                ∑
                                             
                                             
                                                Z
                                             
                                          
                                       
                                       Q
                                       (
                                       Z
                                       )
                                       
                                          
                                             P
                                             (
                                             X
                                             ,
                                             Z
                                             |
                                             θ
                                             )
                                          
                                          
                                             Q
                                             (
                                             Z
                                             )
                                          
                                       
                                    
                                 
                              
                              ⩾
                              
                                 
                                    
                                       ∑
                                    
                                    
                                       Z
                                    
                                 
                              
                              Q
                              (
                              Z
                              )
                              log
                              
                                 
                                    
                                       
                                          
                                             P
                                             (
                                             X
                                             ,
                                             Z
                                             |
                                             θ
                                             )
                                          
                                          
                                             Q
                                             (
                                             Z
                                             )
                                          
                                       
                                    
                                 
                              
                              ≡
                              F
                              (
                              Q
                              ,
                              θ
                              )
                           
                        
                     
                  

This lower bound is known as free energy term 
                     [26] and it corresponds to the sum of the Kullback–Leibler divergence [27] of the approximating Q-functions and the true posterior and the marginal log-likelihood:
                        
                           (A.5)
                           
                              F
                              (
                              Q
                              ,
                              θ
                              )
                              ≡
                              
                                 
                                    
                                       ∑
                                    
                                    
                                       Z
                                    
                                 
                              
                              Q
                              (
                              Z
                              )
                              log
                              
                                 
                                    
                                       
                                          
                                             P
                                             (
                                             X
                                             ,
                                             Z
                                             |
                                             θ
                                             )
                                          
                                          
                                             Q
                                             (
                                             Z
                                             )
                                          
                                       
                                    
                                 
                              
                              =
                              
                                 
                                    
                                       ∑
                                    
                                    
                                       Z
                                    
                                 
                              
                              Q
                              (
                              Z
                              )
                              log
                              
                                 
                                    
                                       
                                          
                                             P
                                             (
                                             Z
                                             |
                                             X
                                             ,
                                             θ
                                             )
                                             P
                                             (
                                             X
                                             |
                                             θ
                                             )
                                          
                                          
                                             Q
                                             (
                                             Z
                                             )
                                          
                                       
                                    
                                 
                              
                              =
                              
                                 
                                    
                                       ∑
                                    
                                    
                                       Z
                                    
                                 
                              
                              Q
                              (
                              Z
                              )
                              log
                              [
                              P
                              (
                              X
                              |
                              θ
                              )
                              ]
                              +
                              
                                 
                                    
                                       ∑
                                    
                                    
                                       Z
                                    
                                 
                              
                              Q
                              (
                              Z
                              )
                              log
                              
                                 
                                    
                                       
                                          
                                             P
                                             (
                                             Z
                                             |
                                             X
                                             ,
                                             θ
                                             )
                                          
                                          
                                             Q
                                             (
                                             Z
                                             )
                                          
                                       
                                    
                                 
                              
                              =
                              L
                              (
                              X
                              |
                              θ
                              )
                              -
                              KL
                              (
                              Q
                              ‖
                              P
                              (
                              Z
                              |
                              X
                              ,
                              θ
                              )
                              )
                           
                        
                     
                  

The non-decreasing updating of a lower bound such as F(Q,
                     θ) of a log-likelihood function (satisfying the condition above) implies getting closer to the maximum value at each step. Since such a maximum value is finite, there will be a time in the procedure when the free energy F(Q,
                     θ) reaches that value. Maximizing F(Q,
                     θ) has to be performed in two steps: (i) first, with respect to the approximating Q-functions and (ii) with respect to the model’s parameters θ.

In this case, the Expectation–Maximization consist of two optimization steps: one implies finding the “nearest” (in terms of the Kullback–Leibler divergence) Q-distribution to the a posteriori probabilities for the latent variables, and another that involves maximizing with respect to the model’s parameters:
                        
                           •
                           
                              Expectation: Assume an intermediate stage with θ
                              
                                 l
                               (lth iteration). Now, the statement “Compute the sufficient statistics for the latent variables posterior distributions 
                              
                                 
                                    P
                                    (
                                    Z
                                    |
                                    X
                                    ,
                                    
                                    θ
                                    )
                                 
                              ” can be translated into:
                                 
                                    (A.6)
                                    
                                       Q
                                       (
                                       Z
                                       )
                                       =
                                       arg
                                       
                                          
                                             
                                                max
                                             
                                             
                                                
                                                   
                                                      Q
                                                   
                                                   
                                                      ′
                                                   
                                                
                                                (
                                                Z
                                                )
                                             
                                          
                                       
                                       [
                                       F
                                       (
                                       
                                          
                                             Q
                                          
                                          
                                             ′
                                          
                                       
                                       (
                                       Z
                                       )
                                       ,
                                       
                                          
                                             θ
                                          
                                          
                                             l
                                          
                                       
                                       )
                                       ]
                                    
                                 
                              that can be found by taking functional derivatives on F(Q,
                              θ), and whose solution is:
                                 
                                    (A.7)
                                    
                                       Q
                                       
                                          
                                             (
                                             Z
                                             )
                                          
                                          
                                             l
                                             +
                                             1
                                          
                                       
                                       =
                                       P
                                       (
                                       Z
                                       |
                                       X
                                       ,
                                       
                                          
                                             θ
                                          
                                          
                                             l
                                          
                                       
                                       )
                                    
                                 
                              which is determined by its sufficient statistics, i.e., the expected moments.


                              Maximization: Given the new value Q
                              
                                 l+1, the function to be maximized with respect to the model’s parameters θ is F(Q
                              
                                 l+1,
                              θ):
                                 
                                    (A.8)
                                    
                                       
                                          
                                             θ
                                          
                                          
                                             l
                                             +
                                             1
                                          
                                       
                                       =
                                       arg
                                       
                                          
                                             
                                                max
                                             
                                             
                                                θ
                                             
                                          
                                       
                                       [
                                       F
                                       (
                                       
                                          
                                             Q
                                          
                                          
                                             l
                                             +
                                             1
                                          
                                       
                                       ,
                                       θ
                                       )
                                       ]
                                    
                                 
                              
                           

Thus, after substituting the computed values for Q
                              
                                 l+1 into F(Q
                              
                                 l+1,
                              θ), the quantity to be maximized is:
                                 
                                    (A.9)
                                    
                                       
                                          
                                             θ
                                          
                                          
                                             l
                                             +
                                             1
                                          
                                       
                                       =
                                       arg
                                       
                                          
                                             
                                                max
                                             
                                             
                                                θ
                                             
                                          
                                       
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         ∑
                                                      
                                                      
                                                         Z
                                                      
                                                   
                                                
                                                Q
                                                
                                                   
                                                      (
                                                      Z
                                                      )
                                                   
                                                   
                                                      l
                                                      +
                                                      1
                                                   
                                                
                                                log
                                                
                                                   
                                                      
                                                         
                                                            
                                                               P
                                                               (
                                                               X
                                                               ,
                                                               Z
                                                               |
                                                               θ
                                                               )
                                                            
                                                            
                                                               Q
                                                               
                                                                  
                                                                     (
                                                                     Z
                                                                     )
                                                                  
                                                                  
                                                                     l
                                                                     +
                                                                     1
                                                                  
                                                               
                                                            
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                              which, in practice, means:
                                 
                                    (A.10)
                                    
                                       
                                          
                                             θ
                                          
                                          
                                             l
                                             +
                                             1
                                          
                                       
                                       =
                                       arg
                                       
                                          
                                             
                                                max
                                             
                                             
                                                θ
                                             
                                          
                                       
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         ∑
                                                      
                                                      
                                                         Z
                                                      
                                                   
                                                
                                                Q
                                                
                                                   
                                                      (
                                                      Z
                                                      )
                                                   
                                                   
                                                      l
                                                      +
                                                      1
                                                   
                                                
                                                log
                                                [
                                                P
                                                (
                                                X
                                                ,
                                                Z
                                                |
                                                θ
                                                )
                                                ]
                                             
                                          
                                       
                                    
                                 
                              and thus, according to Eq. (A.7):
                                 
                                    (A.11)
                                    
                                       
                                          
                                             θ
                                          
                                          
                                             l
                                             +
                                             1
                                          
                                       
                                       =
                                       arg
                                       
                                          
                                             
                                                max
                                             
                                             
                                                θ
                                             
                                          
                                       
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         ∑
                                                      
                                                      
                                                         Z
                                                      
                                                   
                                                
                                                P
                                                (
                                                Z
                                                |
                                                X
                                                ,
                                                
                                                   
                                                      θ
                                                   
                                                   
                                                      l
                                                   
                                                
                                                )
                                                log
                                                [
                                                P
                                                (
                                                X
                                                ,
                                                Z
                                                |
                                                θ
                                                )
                                                ]
                                             
                                          
                                       
                                    
                                 
                              
                           

@&#REFERENCES@&#

