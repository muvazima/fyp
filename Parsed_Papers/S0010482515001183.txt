@&#MAIN-TITLE@&#Design and implementation of a multiband digital filter using FPGA to extract the ECG signal in the presence of different interference signals

@&#HIGHLIGHTS@&#


               
               
                  
                     
                        
                           
                           In this research, the ECG signal simulator, and the multiband digital filter is successfully designed.


                        
                        
                           
                           The designed filter has a linear phase response, so this reduces the filtered signal distortions and makes the diagnosis operation close to the real case.


                        
                        
                           
                           The practical experiments ensure that the possibility of using this type of filters in the ECG devices.


                        
                     
                  
               
            

@&#KEYPHRASES@&#

ECG

DDFS

FPGA

digital-Multiband filter

@&#ABSTRACT@&#


               
               
                  In this paper, we propose a practical way to synthesize and filter an ECG signal in the presence of four types of interference signals: (1) those arising from power networks with a fundamental frequency of 50Hz, (2) those arising from respiration, having a frequency range from 0.05 to 0.5Hz, (3) muscle signals with a frequency of 25Hz, and (4) white noise present within the ECG signal band. This was done by implementing a multiband digital filter (seven bands) of type FIR Multiband Least Squares using a digital programmable device (Cyclone II EP2C70F896C6 FPGA, Altera), which was placed on an education and development board (DE2-70, Terasic). This filter was designed using the VHDL language in the Quartus II 9.1 design environment. The proposed method depends on Direct Digital Frequency Synthesizers (DDFS) designed to synthesize the ECG signal and various interference signals. So that the synthetic ECG specifications would be closer to actual ECG signals after filtering, we designed in a single multiband digital filter instead of using three separate digital filters LPF, HPF, BSF. Thus all interference signals were removed with a single digital filter. The multiband digital filter results were studied using a digital oscilloscope to characterize input and output signals in the presence of differing sinusoidal interference signals and white noise.
               
            

@&#INTRODUCTION@&#


                     
                        
                           –
                           In all ECG devices, several digital FIR filters are used to select the ECG signal in the presence of different interference signals, the most important types of these filters are:

Low pass filter (LPF) to remove the undesired high frequency noise signal.

High pass filter (HPF) to remove the undesired low frequency noise signal.

Band stop filter (BSF) to remove the noise signal for power line frequencies of 50, 60Hz.

BSF to remove the noise signal for muscles with frequencies of 25, 35, 45Hz.

In Ref. [1], Mbachu presents a method of designing LPF, HPF, BSF with Kaiser window where these three filters are serially connected to process the signal within the range (from 0 to 100Hz), and with order of 200 for every filter and with interference signals attenuation of 13dB.

In Ref. [2], Verma presents a digital Notch filter design using Hamming window to remove the effect of power line interference (PLI) with frequency of 50Hz and attenuation of 13.4dB is obtained. Also, presents an adaptive filter design to remove the effect of PLI and attenuation of 34.2dB is obtained.

In Ref. [3], Madhukar Narsale et al. present a digital Notch filter design with frequency of 50Hz and with band width of 45 to 55Hz by using FPGA with sampling frequency of 500Hz, and attenuation of 13dB.

In Ref. [4], Sharma and Dalal present a digital FIR filter with order of 450 and different windows to remove the effect of PLI and attenuation of 18dB is obtained.

The serial using of these filters for high order affects on the structure of ECG signal so that the diagnosis operation may be different from the real case of the patient.

The proposed filter achieves the ECG signal filtering under different interference signals effects, these signals differ in frequency with ECG signal band width within range (from 0 to 150Hz), with a filter order of 1500 and attenuation factor of 40dB for various interference signals. Also, the filter has a linear phase response, this reduces the filtered signal distortions and makes the diagnosis operation close to the real case.

In this research, the following tools and software are used:
                           
                              –
                              Digital programmable device (Cyclone II EP2C70F896C6 FPGA, Altera), which was placed on an education and development board (DE2-70, Terasic). [5].

DDFS which are considered as a high accuracy technique in frequency synthesizing domain and they were designed on digital programmable device.

Digital FIR filters of high accuracy specifications in filtering, stability and linear phase response.

VHDL programming language with Quartus II 9.1 design environment.

MATLAB11 programming environment for digital filter designing and filter coefficients computing.

GDS-1052U digital oscilloscope with Free Wave program to take the results.

PC computer for designing and injecting the design in the chip.

The block diagram of the practical design shown in 
                        Fig. 1a and b shows the used practical platform using a digital programmable device (Cyclone II EP2C70F896C6 FPGA, Altera), which was placed on an education and development board (DE2-70, Terasic), and it consists of:
                           
                              a.
                              Clock pulses generator F
                                 CLK=50MHz to synthesize clock and sampling pulses for all designing components.

ECG Simulator which consists of the following parts:
                                    
                                       –
                                       Direct digital frequency Synthesizer DDFS_ECG to synthesize ECG signal which is close to real one of Lead1, aVR buses and with signal band width within the range (from 0 to 150Hz).

DDFS_F
                                          sam to synthesize sampling pulses with frequency of F
                                          sam=1000Hz.

DDFS_FFM to synthesize frequency modulation signals with frequency of FFM=0.1Hz to change the heart beats every 10s within the range from 30 to 120BPM with step of 30BPM.

Digital pseudo-noise generator DPNG to synthesize white Gaussian noise within the ECG signal band (from 0 to 150Hz).

DDFS_SIN to synthesize sinusoidal interference signals with frequencies: F
                                          sin1=0.4Hz, F
                                          sin2=25Hz, F
                                          sin3=50Hz, F
                                          sin4=152Hz.

Two DAC of 10 bits to convert the signal from digital to analog form, before filtering (DAC1) and after filtering (DAC2).

Multiband digital filter of FIR type with time convolution algorithm and pass bands: (0.5,…22Hz), (28,…,47Hz), (53,…,150Hz) and with stop bands: (0,…0.5Hz), (22,…,28Hz), (47,…,53Hz), (150,…,500Hz), a filter order of 1500,and attenuation factor of 40dB for various interference signals.

PC computer to link DE2-70 board via USB and inject the design in the Cyclone II EP2C70F896C6 FPGA chip [5].

Digital oscilloscope GDS-1052U connected to PC via USB to show the input and output signals of the multiband digital filters in time and frequency domains due to various interference signals, where (ON CH_1: Before Filtering, ON CH2 After Filtering).

This design is carried out for the ECG signal and multiband digital filter with specifications identified later.

This simulator contains:

To generate the ECG (Lead1, aVR) signals, we use a DDFS_ECG according to the diagram shown in 
                              Fig. 2 which consists of the following parts:
                                 
                                    –
                                    Frequency Accumulator (FA) to synthesize the frequency of ECG signal within the range (from 0.5 to 2Hz) and with step of 0.5Hz which means (from 30 to 120BPM) with step of 30BPM every 10s where the ECG signal placed within the pass bands of the filter.

Phase accumulator (PA) to synthesize the step of accessing address to the stored signal samples memory (ROM) according to the frequency code (LECG).

ROM0 memory which contains the ECG signal samples for Lead1 bus, and ROM1 memory for aVR bus during one period.

Sample pulses generator (as a clock pulses) F
                                       sam for reading from ROM0 and ROM1 the stored signal samples at every sampling pulse.

The output frequency of the DDFS_ECG, frequency code, and frequency resolution are computed by the following mathematical relations [6]:


                     
                     
                        
                           –
                           
                              F
                              sam=1000Hz (is considered as a samples frequency).

Length of the phase accumulator, 32 bits.

Frequency resolution for F
                              sam=1000Hz:
                                 
                                    
                                       
                                          
                                             F
                                          
                                          
                                             min
                                          
                                       
                                       =
                                       
                                          
                                             
                                                
                                                   F
                                                
                                                
                                                   sam
                                                
                                             
                                          
                                          
                                             
                                                
                                                   2
                                                
                                                n
                                             
                                          
                                       
                                       =
                                       
                                          
                                             1000
                                             ⋅
                                             
                                                
                                                   10
                                                
                                                6
                                             
                                          
                                          
                                             
                                                
                                                   2
                                                
                                                
                                                   32
                                                
                                             
                                          
                                       
                                       =
                                       0.232
                                       
                                       μ
                                       Hz
                                    
                                 
                              
                           

Two memories (ROM0 and ROM1) each one contains 214=16,384 words, the word length is 10 bits to store the samples of the ECG signal.

The ECG signal samples for Lead1 bus are computed by programming environment MATLAB11 according to the following relation [9]:

The ECG signal samples for aVR bus are computed by programming environment MATLAB11 according to the following relation [9]:
                        
                           
                              x
                              =
                              512
                              −
                              floor
                              [
                              511
                              ⁎
                              ecg
                              (
                              16
                              ,
                              384
                              )
                              ]
                           
                        
                     and stored in ROM1 memory for frequency synthesizer, this signal is shown in Fig. 3b which results from applying the previous relation, while Fig. 3d shows the signal which results from designing on the FPGA chip (the table of values ECG signal for aVR given by the file data_aVR.txt).
                        
                           –
                           The frequency of the ECG signal equals to 0.5Hz so the frequency code is as follows
                                 
                                    
                                       for
                                       
                                       
                                          
                                             F
                                          
                                          
                                             sam
                                          
                                       
                                       =
                                       1000
                                       
                                       Hz
                                       ⇒
                                       
                                          
                                             L
                                          
                                          
                                             ECG
                                          
                                       
                                       =
                                       
                                          
                                             
                                                
                                                   2
                                                
                                                n
                                             
                                             ⋅
                                             
                                                
                                                   F
                                                
                                                
                                                   ECG
                                                
                                             
                                          
                                          
                                             
                                                
                                                   F
                                                
                                                
                                                   sam
                                                
                                             
                                          
                                       
                                       =
                                       
                                          
                                             
                                                
                                                   2
                                                
                                                
                                                   32
                                                
                                             
                                             ⁎
                                             0.5
                                          
                                          
                                             1000
                                          
                                       
                                       =
                                       2
                                       ,
                                       147
                                       ,
                                       484
                                    
                                 
                              
                           

This frequency changes every 10s by 0.5Hz (30BPM) within the range from 0.5 to 2Hz (from 30 to 120BPM) by DDFS_FFM which synthesizes a clock pulses with frequency of F
                              FM=0.1Hz which consists of sample pulses and considered as a clock pulses of FA and achieves the frequency modulation of the ECG signal according to the diagram shown in 
                              Fig. 4.

For a period of 40s a Lead1 signal synthesizing is done, then for a period of 40s aVR signal synthesizing is done through the counter shown in Fig. 2.

FFM frequency equals to 0.1Hz, so the frequency code is as follows:


                     
                        
                           –
                           The frequency range of the ECG signal is 
                                 (
                                 Δ
                                 
                                    
                                       F
                                    
                                    
                                       ECG
                                    
                                 
                                 =
                                 0
                                 
                                 to
                                 
                                 150
                                 
                                 Hz
                                 )
                              .

The processing frequency of ECG signal within the range FECG=0.5,…,2Hz which represents 30,…,120BPM (Beats Per Minute).

Sampling frequencies of all components: 
                                 
                                    
                                       F
                                    
                                    
                                       sam
                                    
                                 
                                 =
                                 1000
                                 
                                 Hz
                                 ,
                                 
                                 
                                    
                                       T
                                    
                                    
                                       sam
                                    
                                 
                                 =
                                 1
                                 
                                 ms
                              .

Number of samples: M=1501.

The processing word length of sampling ECG signal: signed 10 bits.

SNRINP=2/1 for sinusoidal interference signals and SNRINP=8/1 for Gaussian white noise interference signals.

The sinusoidal interference signals will be generated as follows:
                           
                              –
                              The first is sinusoidal interference signal with frequency of 152Hz and has amplitude equals to 50% from the ECG signal amplitude and exists within the stop band (150,…,500Hz) and considered as the first interference signal.

The second is sinusoidal interference signal with frequency of 50Hz and has amplitude equals to 50% from the ECG signal amplitude and exists within the stop band (47,…,53Hz) and considered as the second interference signal (PLI).

The third is sinusoidal interference signal with frequency of 25Hz and has amplitude equals to 50% from the ECG signal amplitude and exists within the stop band (22,…,28Hz) and considered as the third interference signal (EMG).

The fourth is sinusoidal interference signal with frequency of 0.4Hz and has amplitude equals to 50% from the ECG signal amplitude and exists within the stop band (0,…,0.5Hz) and considered as the fourth interference signal.

To generate these sinusoidal interference signals, we use a DDFS_SIN according to the diagram shown in 
                        Fig. 5 which consists of the following parts:
                           
                              –
                              Phase accumulator PA to form address step to access the memory of stored signal samples ROM2 according to frequency code (L
                                 sin).

ROM2 memory which contains the sinusoidal signal samples through one time period.

Sampling pulses generator with frequency F
                                 sam to read the stored signal samples from ROM2 memory with every sample pulse.


                           
                              
                                 –
                                 The output frequency of the DDFS_SIN is computed due to Eq. (1) as in the ECG frequency synthesizer.

The sampling pulses frequency is 1000Hz (clock pulses).

Length of the phase accumulator, 32 bits.

Frequency resolution [6]: 
                                       
                                          
                                             F
                                          
                                          
                                             min
                                          
                                       
                                       =
                                       
                                          
                                             
                                                
                                                   F
                                                
                                                
                                                   CLK
                                                
                                             
                                          
                                          
                                             
                                                
                                                   2
                                                
                                                n
                                             
                                          
                                       
                                       =
                                       
                                          
                                             1
                                             ⋅
                                             
                                                
                                                   10
                                                
                                                9
                                             
                                          
                                          
                                             
                                                
                                                   2
                                                
                                                
                                                   32
                                                
                                             
                                          
                                       
                                       =
                                       0.23
                                       
                                       μ
                                       Hz
                                    
                                 

ROM2 memory contains 214=16,384 words, the word length is 10 bits to store the sinusoidal interference signal samples.

The sinusoidal interference signal samples are computed in MATLAB11 programming environment according to the following relation [6]:

And stored in ROM2 memory for the frequency synthesizer, this signal is shown in 
                           Fig. 6 with frequencies of 50Hz and 152Hz in time and frequency domains (the table of values of sinusoidal interference signal given by the file data_sin.txt).
                              
                                 –
                                 The sinusoidal interference signal with frequency of 152Hz has a frequency code equals to:
                                       
                                          
                                             
                                                
                                                   L
                                                
                                                
                                                   sin
                                                   
                                                   1
                                                
                                             
                                             =
                                             
                                                
                                                   
                                                      
                                                         2
                                                      
                                                      n
                                                   
                                                   ⋅
                                                   
                                                      
                                                         F
                                                      
                                                      
                                                         sin
                                                         
                                                         1
                                                      
                                                   
                                                
                                                
                                                   
                                                      
                                                         F
                                                      
                                                      
                                                         CLK
                                                      
                                                   
                                                
                                             
                                             =
                                             
                                                
                                                   
                                                      
                                                         2
                                                      
                                                      
                                                         32
                                                      
                                                   
                                                   ⁎
                                                   152
                                                
                                                
                                                   1000
                                                
                                             
                                             =
                                             652
                                             ,
                                             835
                                             ,
                                             029
                                          
                                       
                                    
                                 

The sinusoidal interference signal with frequency of 50Hz has a frequency code equals to:
                                       
                                          
                                             
                                                
                                                   L
                                                
                                                
                                                   sin
                                                   
                                                   2
                                                
                                             
                                             =
                                             
                                                
                                                   
                                                      
                                                         2
                                                      
                                                      n
                                                   
                                                   ⋅
                                                   
                                                      
                                                         F
                                                      
                                                      
                                                         sin
                                                         
                                                         2
                                                      
                                                   
                                                
                                                
                                                   
                                                      
                                                         F
                                                      
                                                      
                                                         CLK
                                                      
                                                   
                                                
                                             
                                             =
                                             
                                                
                                                   
                                                      
                                                         2
                                                      
                                                      
                                                         32
                                                      
                                                   
                                                   ⁎
                                                   50
                                                
                                                
                                                   1000
                                                
                                             
                                             =
                                             214
                                             ,
                                             748
                                             ,
                                             365
                                          
                                       
                                    
                                 

The sinusoidal interference signal with frequency of 25Hz has a frequency code equals to:
                                       
                                          
                                             
                                                
                                                   L
                                                
                                                
                                                   sin
                                                   
                                                   3
                                                
                                             
                                             =
                                             
                                                
                                                   
                                                      
                                                         2
                                                      
                                                      n
                                                   
                                                   ⋅
                                                   
                                                      
                                                         F
                                                      
                                                      
                                                         sin
                                                         
                                                         3
                                                      
                                                   
                                                
                                                
                                                   
                                                      
                                                         F
                                                      
                                                      
                                                         CLK
                                                      
                                                   
                                                
                                             
                                             =
                                             
                                                
                                                   
                                                      
                                                         2
                                                      
                                                      
                                                         32
                                                      
                                                   
                                                   ⁎
                                                   25
                                                
                                                
                                                   1500
                                                
                                             
                                             =
                                             107
                                             ,
                                             374
                                             ,
                                             182
                                          
                                       
                                    
                                 

The sinusoidal interference signal with frequency of 0.4Hz has a frequency code equals to:
                                       
                                          
                                             
                                                
                                                   L
                                                
                                                
                                                   sin
                                                   
                                                   4
                                                
                                             
                                             =
                                             
                                                
                                                   
                                                      
                                                         2
                                                      
                                                      n
                                                   
                                                   ⋅
                                                   
                                                      
                                                         F
                                                      
                                                      
                                                         sin
                                                      
                                                   
                                                
                                                
                                                   
                                                      
                                                         F
                                                      
                                                      
                                                         CLK
                                                      
                                                   
                                                
                                             
                                             =
                                             
                                                
                                                   
                                                      
                                                         2
                                                      
                                                      
                                                         32
                                                      
                                                   
                                                   ⁎
                                                   0.4
                                                
                                                
                                                   2000
                                                
                                             
                                             =
                                             1
                                             ,
                                             717
                                             ,
                                             987
                                          
                                       
                                    
                                 

This signal is of white noise type and has amplitude equals to 12.5% from the ECG signal amplitude and exists within the filter pass bands and is considered as the fifth interference signal.

To generate the white noise signal, a digital pseudo-noise generator DPNG is used, which consists of a shift register of 40 bits and clock pulses of frequency equals to sampling frequency of 1000Hz with maximum periodic time for the generated series [10]:
                           
                              
                                 
                                    
                                       
                                          T
                                          =
                                          (
                                          
                                             
                                                2
                                             
                                             
                                                40
                                             
                                          
                                          −
                                          1
                                          )
                                          ⋅
                                          
                                             
                                                T
                                             
                                             
                                                sam
                                             
                                          
                                          ⇒
                                       
                                    
                                    
                                       
                                          T
                                          =
                                          (
                                          
                                             
                                                2
                                             
                                             
                                                40
                                             
                                          
                                          −
                                          1
                                          )
                                          ⁎
                                          1
                                          /
                                          (
                                          1000
                                          ⁎
                                          3600
                                          ⁎
                                          24
                                          ⁎
                                          365
                                          )
                                          =
                                          34.8
                                          Year
                                       
                                    
                                 
                              
                           
                        
                     

According to the diagram shown in 
                        Fig. 7, which consists of the following parts:
                           
                              –
                              Shift register of 40 bits and clock pulses with sampling frequency of 1000Hz.

Feedback circuit by using XOR gate and NOT gate.


                        
                        Fig. 8 shows the formed Gaussian white noise signal.

To generate sample pulses, we use direct digital frequency synthesizer DDFS_F
                        sam according to the diagram shown in 
                        Fig. 9 which consists of the following parts:
                           
                              –
                              Clock pulses generator.

Phase accumulator PA to form the sample pulses with frequency computed by the following relation [6]:


                        
                           
                              –
                              Clock pulses frequency F
                                 CLK =50MHz.

Length of the phase accumulator, 32 bits.

Frequency resolution:
                                    
                                       
                                          
                                             
                                                F
                                             
                                             
                                                min
                                             
                                          
                                          =
                                          
                                             
                                                
                                                   
                                                      F
                                                   
                                                   
                                                      CLK
                                                   
                                                
                                             
                                             
                                                
                                                   
                                                      2
                                                   
                                                   n
                                                
                                             
                                          
                                          =
                                          
                                             
                                                50
                                                ⋅
                                                
                                                   
                                                      10
                                                   
                                                   9
                                                
                                             
                                             
                                                
                                                   
                                                      2
                                                   
                                                   
                                                      32
                                                   
                                                
                                             
                                          
                                          =
                                          12
                                          
                                          mHz
                                       
                                    
                                 
                              

The sample pulses with frequency of 1000Hz have a frequency code equals to:
                                    
                                       
                                          
                                             
                                                L
                                             
                                             
                                                sam
                                             
                                          
                                          =
                                          
                                             
                                                
                                                   
                                                      2
                                                   
                                                   n
                                                
                                                ⋅
                                                
                                                   
                                                      F
                                                   
                                                   
                                                      sam
                                                   
                                                
                                             
                                             
                                                
                                                   
                                                      F
                                                   
                                                   
                                                      CLK
                                                   
                                                
                                             
                                          
                                          =
                                          
                                             
                                                
                                                   
                                                      2
                                                   
                                                   
                                                      32
                                                   
                                                
                                                ⁎
                                                1000
                                             
                                             
                                                50
                                                ⁎
                                                
                                                   
                                                      10
                                                   
                                                   6
                                                
                                             
                                          
                                          =
                                          85
                                          ,
                                          899
                                       
                                    
                                 
                              

The FIR filter output signal can be represented according to the following convolution relationship [8]:
                        
                           (2)
                           
                              y
                              (
                              n
                              )
                              =
                              h
                              (
                              n
                              )
                              ⁎
                              x
                              (
                              n
                              )
                              =
                              
                                 ∑
                                 
                                    m
                                    =
                                    0
                                 
                                 
                                    M
                                    −
                                    1
                                 
                              
                              
                                 h
                                 (
                                 m
                                 )
                                 ⋅
                                 x
                                 (
                                 n
                                 −
                                 m
                                 )
                              
                           
                        
                     where x(n) input signal samples in digital form, m: number of samples for impulse response of the filter, n: number of samples for input and output signals, h(n): impulse response samples for digital filter and it is given to LPF according to the following relationship [8]:
                        
                           (3)
                           
                              
                                 
                                    
                                       h
                                       (
                                       0
                                       )
                                       =
                                       2
                                       
                                          
                                             
                                                
                                                   F
                                                
                                                
                                                   CLPF
                                                
                                             
                                          
                                          
                                             
                                                
                                                   F
                                                
                                                
                                                   sam
                                                
                                             
                                          
                                       
                                    
                                 
                                 
                                    
                                       h
                                       (
                                       n
                                       )
                                       =
                                       
                                          1
                                          
                                             π
                                             n
                                          
                                       
                                       
                                       sin
                                       
                                          (
                                          
                                             2
                                             π
                                             n
                                             
                                                
                                                   
                                                      
                                                         F
                                                      
                                                      
                                                         CLPF
                                                      
                                                   
                                                
                                                
                                                   
                                                      
                                                         F
                                                      
                                                      
                                                         sam
                                                      
                                                   
                                                
                                             
                                          
                                          )
                                       
                                    
                                 
                              
                           
                        
                     It is given to HPF according to the following relationship [8]:
                        
                           (4)
                           
                              
                                 
                                    
                                       h
                                       (
                                       0
                                       )
                                       =
                                       1
                                       −
                                       2
                                       
                                          
                                             
                                                
                                                   F
                                                
                                                
                                                   CHPF
                                                
                                             
                                          
                                          
                                             
                                                
                                                   F
                                                
                                                
                                                   sam
                                                
                                             
                                          
                                       
                                    
                                 
                                 
                                    
                                       h
                                       (
                                       n
                                       )
                                       =
                                       −
                                       
                                          1
                                          
                                             π
                                             n
                                          
                                       
                                       
                                       sin
                                       
                                          (
                                          
                                             2
                                             π
                                             n
                                             
                                                
                                                   
                                                      
                                                         F
                                                      
                                                      
                                                         CHPF
                                                      
                                                   
                                                
                                                
                                                   
                                                      
                                                         F
                                                      
                                                      
                                                         sam
                                                      
                                                   
                                                
                                             
                                          
                                          )
                                       
                                    
                                 
                              
                           
                        
                     It is given to BSF according to the following relationship [8]:
                        
                           (5)
                           
                              
                                 
                                    
                                       h
                                       (
                                       0
                                       )
                                       =
                                       1
                                       −
                                       2
                                       
                                          
                                             
                                                
                                                   F
                                                
                                                
                                                   CBSF2
                                                
                                             
                                             −
                                             
                                                
                                                   F
                                                
                                                
                                                   CBSF1
                                                
                                             
                                          
                                          
                                             
                                                
                                                   F
                                                
                                                
                                                   sam
                                                
                                             
                                          
                                       
                                    
                                 
                                 
                                    
                                       h
                                       (
                                       n
                                       )
                                       =
                                       
                                          1
                                          
                                             π
                                             n
                                          
                                       
                                       
                                          [
                                          
                                             sin
                                             
                                                (
                                                
                                                   2
                                                   π
                                                   n
                                                   
                                                      
                                                         
                                                            
                                                               F
                                                            
                                                            
                                                               C
                                                               B
                                                               S
                                                               F
                                                               1
                                                            
                                                         
                                                      
                                                      
                                                         
                                                            
                                                               F
                                                            
                                                            
                                                               sam
                                                            
                                                         
                                                      
                                                   
                                                
                                                )
                                             
                                          
                                       
                                    
                                 
                                 
                                    
                                       
                                          
                                             −
                                             
                                             sin
                                             
                                                (
                                                
                                                   2
                                                   π
                                                   n
                                                   
                                                      
                                                         
                                                            
                                                               F
                                                            
                                                            
                                                               CBSF2
                                                            
                                                         
                                                      
                                                      
                                                         
                                                            
                                                               F
                                                            
                                                            
                                                               sam
                                                            
                                                         
                                                      
                                                   
                                                
                                                )
                                             
                                          
                                          ]
                                       
                                    
                                 
                              
                           
                        
                     where
                        
                           (6)
                           
                              −
                              
                                 (
                                 
                                    
                                       
                                          M
                                          −
                                          1
                                       
                                       2
                                    
                                 
                                 )
                              
                              ≤
                              n
                              ≤
                              
                                 (
                                 
                                    
                                       
                                          M
                                          −
                                          1
                                       
                                       2
                                    
                                 
                                 )
                              
                           
                        
                     
                     
                        
                           
                              F
                              CLPF: cut off frequency of the LPF, (F
                              CLPF=150Hz).


                              F
                              CHPF: cut off frequency of the HPF, (F
                              CHPF=0.5Hz).


                              F
                              CBSF1: cut off first frequency of the BSF, (F
                              CBSF1_EMG=22Hz, F
                              CBSF0_EMG=25Hz for EMG Interference, F
                              CBSF1_PLI=47Hz, F
                              CBSF0_PLI=50Hz for PLI).


                              F
                              CBSF2: cut off second frequency of the BSF, ( F
                              CBSF2_EMG=28Hz for EMG Interference, F
                              CBSF2_PLI=53Hz, for PLI).


                              F
                              sam: sampling frequency of the input signal (F
                              sam=1000Hz).

In this research, a Multiband Least Square Filter was designed of FIR type with 1500 in order to get −40dB attenuation out of the pass bands and 0.9Hz transition band width, the magnitude response for the proposed filter is shown in the 
                     Fig. 11 which consists of the following bands:
                        
                           –
                           Filter stop bands:
                                 
                                    (0,…, 0.5Hz) respiration signals stop band (1).

(22,…, 28Hz) muscles signals stop band (3).

(47,…, 53Hz) Power Line Interference (PLI) signal stop band (5).

(150,…, 500Hz) different interference signals stop band out of ECG signal band (7).

Filter pass bands:
                                 
                                    (0.5,…, 22Hz) the band (2).

(28,…, 47Hz) the band (4).

(53,…, 150Hz) the band (6).

This filter allows high reduction of filters number by required stop bands number (four bands) and increasing the attenuation factor of the interference signals and reducing the transition band widths keeping on the ECG signal specifications(amplitude and phase specifications of the ECG signal).

The ECG signal and the interference one are given to the digital filter and recorded the input and output signals for different values of interference signals frequency.

The proposed filter algorithm was tested by the previous ECG signal simulator.

The coefficients of the designed multiband digital filter h(n), are computed in MATLAB11 programming environment and converted to signed values with length 10 bits and used in the filter design program by VHDL language where the digital convolution algorithm of the multiband FIR digital filter is implemented for input signal and impulse response samples of length M=1501 according to the diagram shown in 
                     Fig. 12, where (Z−1 ) represents a digital delay line of length 10 bits and a delay time equal to sampling pluses period T
                     sam.

This multiband digital filter is designed by VHDL [7] with Quartus II 9.1 programming environment according to the diagram shown in 
                     Fig. 13, (the program text exists within The VHDL file). 
                     Fig. 14 shows the specifications of designed multiband digital filter (type, order, pass-bands, stop-bands, sampling frequency) and the magnitude and phase responses of this multiband digital filter in MATLAB11 programming environment.


                        
                           
                              –
                              Length of the filter Coefficients word, 10 bits.

Number of the used digital multipliers: 1501 multipliers of 10×10 bits.

Number of the parallel shift registers (10 bits length) is 1500SR (Z−1).

One adder of 20 bits length with 1501 inputs and one output of 30 bits length.

Cut off frequencies for the multiband digital filter are:
                                    
                                       
                                          
                                             
                                                F
                                             
                                             
                                                CHPF
                                             
                                          
                                          =
                                          0.5
                                          
                                          Hz
                                          ,
                                          
                                             
                                                F
                                             
                                             
                                                CBSF0
                                                _
                                                EMG
                                             
                                          
                                          =
                                          25
                                          
                                          Hz
                                          ,
                                       
                                    
                                 
                                 
                                    
                                       
                                          
                                             
                                                F
                                             
                                             
                                                CBSF0
                                                _
                                                PLI
                                             
                                          
                                          =
                                          50
                                          
                                          Hz
                                          ,
                                          
                                             
                                                F
                                             
                                             
                                                CLPF
                                             
                                          
                                          =
                                          150
                                          
                                          Hz
                                          .
                                       
                                    
                                 
                              

Filter order is: N=M−1=1500.

Stop-band attenuation factor is: −40dB.

Maximum transition band widths is: 0.9Hz.

Processing speed is 1501 operation of adding, shifting, multiplying, dividing and conversion operations can be done in 1ms (sampling period) for digital samples of 10 bits length, this equivalent to 1.5 million operation per second by using parallel processing, so the processing is done simultaneously in real time. Input data flow speed is 10-bits per 1ms(10×1×1000/(8×1024))=1.2207KB/s.

There is a possibility to develop this algorithm through serial connection for several filters in order to get high degree of attenuation and low transition band width.

The practical design results of the multiband digital filter were taken by digital oscilloscope of type GDS-1052U at different cases of interference signals effecting in time and frequency domains for the ECG signal after and before filtering.


                     
                     Fig. 15 shows on channel 1 of the oscilloscope the ECG signal which has the QRS components and synthesized by DDFS_ECG without the interference of signal effect before filtering and on channel 2 the ECG signal after filtering by multiband digital filter, and this ensures that the filter must not distort the signal after filtering because it has a linear phase response.


                     
                     Fig. 16 shows on channel 1 of the oscilloscope the ECG signal which is under the white noise effect placed within the pass band of the filter which results from different sources (sampling, internal noise of the amplifiers, and different electronic elements in ECG devices) and with SNRINP=8/1 before filtering and on channel 2 the ECG signal is shown after filtering by multiband digital filter, where the filter is considered as an average value filter.


                     
                     Fig. 17a shows the ECG signal before filtering and Fig. 17b shows the ECG signal after filtering in frequency domain where we note that the quantity of interference signal attenuation is 3dB.


                     
                     Fig. 18 shows on channel 1 of the oscilloscope the ECG signal which is under the sinusoidal interference signal effect placed within the pass band of the filter with frequency of 152Hz which results from different external sources and with SNRINP=2/1 before filtering and on channel 2 the ECG signal is shown after filtering by multiband digital filter, where the filter is considered as a LPF filter.


                     
                     Fig. 19a shows the ECG signal before filtering and Fig. 19b shows the ECG signal after filtering in frequency domain where we note that the quantity of the interference signal attenuation is 35dB.


                     
                     Fig. 20 shows on channel 1 of the oscilloscope the ECG signal which is under the interference signal effect placed within the pass band of the filter with frequency of 50Hz to test the stop band (from 47 to 53Hz) which results from power source and with SNRINP=2/1 before filtering and on channel 2, the ECG signal is shown after filtering by multiband digital filter, where the filter is considered as a BSF filter.


                     
                     Fig. 21a shows the ECG signal before filtering and Fig. 21b shows the ECG signal after filtering in frequency domain where we note that the quantity of the interference signal attenuation is 35dB.


                     
                     Fig. 22 shows on channel 1 of the oscilloscope the ECG signal which is under the interference signal effect placed on the pass band of the filter with frequency of 25Hz to test the stop band (from 22 to 28Hz) which results from muscles signal effect and with SNRINP=2/1 before filtering and on channel 2, the ECG signal is shown after filtering by multiband digital filter in time domain, where the filter is considered as a BSF filter.


                     
                     Fig. 23a shows the ECG signal before filtering and Fig. 23b shows the ECG signal after filtering in frequency domain where we note that the quantity of the interference signal attenuation is 35dB.


                     
                     Fig. 24 shows on channel 1 of the oscilloscope the ECG signal which is under the interference signal effect placed on the pass band of the filter with frequency of 0.4Hz to test the stop band (from 0 to 0.5Hz) which results from breathing device effect and with SNRINP=2/1 before filtering and on channel 2, the ECG signal is shown after filtering by multiband digital filter in time domain, where the filter is considered as a HPF filter.


                     
                     Fig. 25a shows the ECG signal before filtering and Fig. 25b shows the ECG signal after filtering in frequency domain where we note that the quantity of the interference signal attenuation is 13dB.

@&#CONCLUSIONS@&#


                     
                        
                           –
                           Depending on the previous practical results, the FIR multiband digital filter successfully designed removes the various interference signals with keeping on the amplitude and phase specifications of the ECG signal although they affect instantly together on different frequencies and with attenuation factor which reach to 40dB, this means that the various filters LPF, HPF, BSF can be replaced by one filter and is considered more better than all of them in all specifications, also the filter specifications can be improved through increasing, the filter order and this can be achieved by using a digital programmable device (Cyclone II EP2C70F896C6 FPGA, Altera), which was placed on an education and development board (DE2-70, Terasic) which have large material resources, accuracy and high quality in performance.

In this research, the ECG signal simulator, different types of frequency synthesizers of interference signals, and the multiband digital filter are successfully designed. Practical experiments described in the study suggest how these filters can be used in ECG devices.

To develop this research in the future, an ECG signal can be taken from any person for diagnosis and implement the filtering by using the proposed filter.

There is a possibility to develop this algorithm through serial connection for several filters in order to get high degree of attenuation and low transition bands width.

No conflict of interest, interfere with the submission of this paper

Supplementary data associated with this article can be found in the online version at doi:10.1016/j.compbiomed.2015.03.034.


                     
                        
                           
                              Supplementary Data
                           
                           
                        
                     
                  


                     
                        
                           
                              Supplementary Data
                           
                           
                        
                     
                  


                     
                        
                           
                              Supplementary Data
                           
                           
                        
                     
                  


                     
                        
                           
                              Supplementary Data
                           
                           
                        
                     
                  

@&#REFERENCES@&#

