@&#MAIN-TITLE@&#Lead time considerations for the multi-level capacitated lot-sizing problem

@&#HIGHLIGHTS@&#


               
               
                  
                     
                        
                           
                           Classical multi-level capacitated lot-sizing models deliver unrealistic results.


                        
                        
                           
                           New MIP formulations including the scheduling aspect.


                        
                        
                           
                           Two variants: batching and lot-streaming.


                        
                        
                           
                           New models enable generating feasible production plans.


                        
                        
                           
                           Comparison with classical models using well known problem instances.


                        
                     
                  
               
            

@&#KEYPHRASES@&#

Production

Lot-sizing

Scheduling

Mixed integer programming

Synchronization

@&#ABSTRACT@&#


               
               
                  The classical multi-level capacitated lot-sizing problem formulation is often not suitable to correctly capture resource requirements and precedence relations. Depending on lead time assumptions, either the model provides infeasible production plans or plans with costly needless inventory. We tackle this issue by explicitly modeling these two aspects and the synchronization of batches of products in the multi-level lot-sizing and scheduling formulation. Two models are presented; one considering batch production and the other one allowing lot-streaming. Comparisons with traditional models demonstrate the capability of the new approach in delivering more realistic results. The generated production plans are always feasible and cost savings of 30–40 percent compared to classical models are observed.
               
            

@&#INTRODUCTION@&#

The complexity of the product structure (bill-of-materials or BOM) of real-world cases has motivated researchers to decompose hierarchically the overall planning system into a set of more manageable subsystems. Production planning and scheduling (PPS) is one of the most prominent hierarchical systems and lies at the very heart of the performance of industrial enterprises. At the upper level of this two-level system, the tactical driver is to determine the amount of each product that must be produced in each time-period across several resources (sizing of lots). The production scheduling (sequencing of lots) is left to the lower operational level of planning. In many situations (especially if one of the production stages represent stationary bottlenecks—see Seeanner and Meyr, 2013) this approach might be sufficient. Nevertheless, as the top level has no detailed view about system capacity in terms of scheduling, there is no guarantee that scheduling constraints (e.g., precedence, capacity) are respected, and the production plans might be infeasible (Urrutia, Aggoune, and Dauzère-Pérès, 2012). In order to ensure that the plans generated at the upper-level can be scheduled afterward, the interdependencies between both levels should be incorporated in solution approaches, through top-down and bottom-up influences.

Significant research has been conducted on the multi-level capacitated lot-sizing problem (MLCLSP) that fits the highest level of PPS. MLCLSP is considered a big time bucket model as several products can be produced in each macro period, and it is an extension of the single-level capacitated lot-sizing problem (CLSP) by incorporating the bill-of-material information (i.e. the relationship in terms of material requirements between different items to be produced) in the inventory balance constraints. Researchers have tried to consider more realistic classes of MLCLSP, including setup times, setup carryover and/or backlogging (cf. Tempelmeier and Buschkühl, 2009; Toledo et al., 2013; Wu et al., 2011). However, even today the majority of the models and algorithms proposed for MLCLSP rely on one of the following two assumptions: either lead times are neglected, thus allowing predecessors and successors to be produced in the same period; or lead times account for at least one period for each component, forcing the throughput time (in number of periods) of the finished products to be at least equal to the number of levels of the BOM.


                     Buschkühl et al. (2010) report in their review that out of 16 papers dealing with metaheuristic solutions to MLCLSP, only one study (Berretta et al., 2005) considers lead time, while all others neglect it. The present work is motivated by the observation that the majority of the solutions published for well-known MLCLSP instances suffer from this assumption. Indeed, the zero lead time assumption leads to plans that are not implementable, as the lower-level scheduling problem is likely to be infeasible. This is more pronounced as the capacity tightens. On the other hand, positive lead time usually results in extensive amounts of work-in-process, which tends to increase with a larger number of levels in the BOM.

There have been a few attempts for small-bucket approaches (in which the micro-period time structure only allows for one setup per period—see Seeanner and Meyr, 2013), but only few works include scheduling decisions within big-bucket multi-level lot-sizing (cf. Gómez Urrutia et al., 2012; Karimi-Nasab and Seyedhoseini, 2013; Stadtler, 2005).

We study the impact of not considering scheduling decisions within MLCLSP and the limitations/flaws of well known previous MLCLSP formulations. We show, by means of studying the synchronization of the batches of products within MLCLSP, that most of the solutions reported in the literature obtained by standard MLCLSP with zero lead times are infeasible, and those that consider positive lead times entail significant work-in-process. To this end, two linear mixed-integer programming formulations are proposed, one restricted to batch production and the other one allowing lot-streaming. In each time period of both models, sizing and sequencing of production lots are simultaneously addressed in such a way that precedence relationships of products are respected. The batching formulation considers production taking place in batches such that units produced within each lot can only be processed as raw materials on the subsequent BOM level once the whole batch is completed. The lot-streaming or non-batching model relaxes this requirement, allowing components to be transformed further on as soon as they are released. In the latter case, modeling is tricky and it requires a rigorous argument to establish correctness. We present results establishing correctness of the two models and comparing them with respect to the produced cost.

Both formulations are applied to benchmark instances and the differences to the classical model approaches
                        1
                     
                     
                        1
                        By classical model approaches we mean the multi-level lot sizing and scheduling problem without scheduling aspects as proposed by Billington et al. (1983) and described in Buschkühl et al. (2010).
                      are analyzed. In contrast to MLCLSP with zero lead time the new model formulations are able to generate always feasible production plans. Comparing them with MLCLSP with positive lead time illustrates the potential cost savings of 30–40percent due to a reduced total throughput time and work-in-process, respectively.

Our contributions are:

                        
                           •
                           developing two integrated models of lot-sizing and scheduling for a multi-level production system based on MLCLSP,

proving the correctness of both formulations and establishing a relationship between them,

analyzing the drawbacks of the classical MLCLSP model with and without lead time using standard benchmark instances,

quantifying the potential gains by using more detailed models for such a multi-stage production planning problem.

In Section 2 we introduce MLCLSP and the major hurdles of its standard formulation proposed in the literature. In Section 3 two novel multi-level formulations are developed for the capacitated lot-sizing and scheduling problem, based on the assumptions for batching and lot-streaming production environments, respectively. We then address several possible extensions to these models. In Section 4 we then apply the new model formulation to standard benchmark instances and compare the results with those of the classical MLCLSP.

Lot-sizing problems have been studied by researchers in different variations during the last decades. One of the initial works describing the trade-off between the setup and holding costs for a dynamic demand scenario is provided by Wagner and Within (1958). Introducing capacity limitations and considering several products simultaneously led to the capacitated lot-sizing problem (CLSP), which Bitran and Yanasse (1982) have shown to be NP-hard. In the case of positive setup times, Maes et al. (1991) proved that already the feasibility problem is NP-complete. MLCLSP dealt in this paper was first introduced by Billington et al. (1983) and it extended the lot-sizing models toward material requirements planning. Before this work, lot-sizing problems have mainly been applied at the final product level.

A recent review about different model formulations and solution methods for MLCLSP can be found in Buschkühl et al. (2010). This review points out that it is necessary to consider manufacturing lead times, but many researchers neglect them. For example, 15 out 16 papers on metaheuristic solution methods for MLCLSP mentioned in that review neglect lead time (e.g. Berretta and Rodrigues, 2004; Pitakaso et al., 2006; Xie and Dong, 2002). The remaining work (Berretta et al., 2005) assumes that some items have no lead times and others have positive lead times of one period or more. More recently, also Wu et al. (2011) and Wu, Shi, Geunes and Akartunali (2012) present MIP models for solving capacitated multi-level lot-sizing problems with setup times and backlogging, considering null lead times. Clark et al. (2011) stress the need to incorporate more specificities of production environments in lot-sizing models, including the synchronization of resources.

The present paper deals with the manufacturing lead time consideration for MLCLSP. This involves also scheduling decisions. The classical MLCLSP problem is considered to be a big-bucket model, as the planning horizon is divided into a small number of long time periods allowing for multiple products/setups per time bucket. On the other hand, the class of small-bucket models try to capture both lot-sizing and scheduling decisions, as at most one setup might be performed in each period and, consequently, a complete production sequence is generated by default, Drexl and Kimms (1997). Here, the planning horizon is divided into many short periods. Nevertheless, Wolsey (2002) provides a comprehensive study and classification scheme for different small- and big-bucket models, and shows that the LP relaxation of small-bucket models usually delivers very weak lower bounds. Only with customized reformulations and valid inequalities added to the problem an improvement of the lower bound is possible. In contrast, most big-bucket models (MLCLSP is classified as such) provide much better lower bounds (see Almeder and Almada-Lobo, 2011).

A few researchers have tried to incorporate the multi-level structure and the exact timing issues into small-bucket models. Stadtler (2011) presents a proportional lot-sizing and scheduling problem formulation for a multi-level problem. In order to allow synchronization of the different levels within a period, the problem is restricted to a single capacitated resource, i.e., it is not possible to produce different items simultaneously on different machines. Meyr (2004) and Seeanner and Meyr (2013) use a general lot-sizing and scheduling problem formulation (GLSP) to model a multi-level system with possible simultaneous production of predecessor and successor items. The GLSP is based on time buckets of variable length (usually determined by the size of a lot). In order to allow synchronization, all machines must use the same period structure, which might lead to unproductive idle times. Furthermore, it is not possible to enforce the finishing of a production lot before the production of a successor starts.

For the class of big-bucket lot-sizing models, there are extensions to incorporate scheduling decisions. Haase (1996),Gupta and Magnusson (2005), and Almada-Lobo et al. (2008) developed extensions for the single-level capacitated lot-sizing problem to deal with sequence dependent setups. In what concerns big-bucket models for the multi-level setting, we are only aware of one paper (Fandel and Stammen-Hegene, 2006) that tackles this problem. The authors model a similar problem as our here, but in contrast to our approach, the authors develop a non-linear formulation. The complexity of that formulation prohibits to solve even small instances. To the best of our knowledge, efficient solution methodologies for their model are not known as of this date. The review by Zhu and Wilhelm (2006) analyzes the research on the intersection of lot-sizing and scheduling from the scheduling point of view.

Another subject related to this work is the problem of synchronizing the use of common resources. Tempelmeier and Buschkühl (2008) describe a problem where a common setup operator has to perform the setup operations on different machines. Hence, it is necessary to ensure that there are no two setup operations at the same time. In Almeder and Almada-Lobo (2011) a model describing the synchronization of a secondary resource used in a parallel machine environment is developed.

@&#MOTIVATION@&#

In this paper, we study extensions to the following classical MLCLSP model as formulated by Billington et al. (1983).

We assume a production planning problem with N items (including finished goods, subassemblies, and raw materials), T time periods and M machines and the underlying BOM. Each item has a manufacturing lead time and deterministic demand in each time period. The problem is to find production quantities in each time period that obey to BOM requirements, demand requirements, limited capacity resources, and simultaneously minimizing the production and holding costs. It reads

                           
                              (1)
                              
                                 
                                    min
                                    
                                       ∑
                                       
                                          i
                                          =
                                          1
                                       
                                       N
                                    
                                    
                                       ∑
                                       
                                          t
                                          =
                                          1
                                       
                                       T
                                    
                                    
                                       (
                                       
                                          c
                                          i
                                       
                                       ·
                                       
                                          Y
                                          
                                             i
                                             t
                                          
                                       
                                       +
                                       
                                          h
                                          i
                                       
                                       ·
                                       
                                          I
                                          
                                             i
                                             t
                                          
                                       
                                       )
                                    
                                 
                              
                           
                        subject to

                           
                              (2)
                              
                                 
                                    
                                       
                                       
                                       
                                          
                                             
                                                I
                                                
                                                   i
                                                   t
                                                
                                             
                                             =
                                             
                                                I
                                                
                                                   i
                                                   (
                                                   t
                                                   −
                                                   1
                                                   )
                                                
                                             
                                             +
                                             
                                                X
                                                
                                                   i
                                                   (
                                                   t
                                                   −
                                                   
                                                      l
                                                      i
                                                   
                                                   )
                                                
                                             
                                             −
                                             
                                                ∑
                                                
                                                   j
                                                   ∈
                                                   Γ
                                                   (
                                                   i
                                                   )
                                                
                                             
                                             
                                                a
                                                
                                                   i
                                                   j
                                                
                                             
                                             ·
                                             
                                                X
                                                
                                                   j
                                                   t
                                                
                                             
                                             −
                                             
                                                E
                                                
                                                   i
                                                   t
                                                
                                             
                                             
                                             i
                                             ,
                                             t
                                          
                                       
                                    
                                 
                              
                           
                        
                        
                           
                              (3)
                              
                                 
                                    
                                       
                                       
                                       
                                          
                                             
                                                ∑
                                                
                                                   i
                                                   =
                                                   1
                                                
                                                N
                                             
                                             
                                                (
                                                
                                                   p
                                                   
                                                      m
                                                      i
                                                   
                                                
                                                ·
                                                
                                                   X
                                                   
                                                      i
                                                      t
                                                   
                                                
                                                +
                                                
                                                   s
                                                   
                                                      m
                                                      i
                                                   
                                                
                                                ·
                                                
                                                   Y
                                                   
                                                      i
                                                      t
                                                   
                                                
                                                )
                                             
                                             ≤
                                             
                                                L
                                                
                                                   m
                                                   t
                                                
                                             
                                             
                                             m
                                             ,
                                             t
                                          
                                       
                                    
                                 
                              
                           
                        
                        
                           
                              (4)
                              
                                 
                                    
                                       
                                       
                                       
                                          
                                             
                                                X
                                                
                                                   i
                                                   t
                                                
                                             
                                             −
                                             G
                                             ·
                                             
                                                Y
                                                
                                                   i
                                                   t
                                                
                                             
                                             ≤
                                             0
                                             
                                             i
                                             ,
                                             t
                                          
                                       
                                    
                                 
                              
                           
                        
                        
                           
                              (5)
                              
                                 
                                    
                                       
                                       
                                       
                                          
                                             
                                                I
                                                
                                                   i
                                                   t
                                                
                                             
                                             ≥
                                             0
                                             ,
                                             
                                                X
                                                
                                                   i
                                                   t
                                                
                                             
                                             ≥
                                             0
                                             ,
                                             
                                                Y
                                                
                                                   i
                                                   t
                                                
                                             
                                             ∈
                                             
                                                {
                                                0
                                                ,
                                                1
                                                }
                                             
                                             
                                             i
                                             ,
                                             t
                                          
                                       
                                    
                                 
                              
                           
                        and with the decision variables:

                           
                              
                                 Iit
                                 
                              
                              inventory level of item i at the end of period t
                              

production amount of item i in period t
                              


                                 
                                    
                                       {
                                       
                                          
                                             
                                                1
                                             
                                             
                                                
                                                   if
                                                   
                                                   item
                                                   
                                                   i
                                                   
                                                   is
                                                   
                                                   produced
                                                   
                                                   in
                                                   
                                                   period
                                                   
                                                   t
                                                
                                             
                                          
                                          
                                             
                                                0
                                             
                                             
                                                otherwise.
                                             
                                          
                                       
                                    
                                 
                              

The parameters are as follows:

                           
                              
                                 aij
                                 
                              
                              quantity of item i required to produce one unit of item j (gozinto-factor)

time for producing one unit of item i on machine m
                              

setup cost of item i
                              

(external) demand of item i in period t
                              

arbitrary large number (e.g. total demand or maximum capacity)

initial inventory level of item i
                              

holding cost of item i
                              

available capacity (time) of machine m in period t
                              

lead time of item i (nonnegative integer corresponding to the number of periods)

time for setting up machine m for the production of item i
                              

set of immediate successors of item i based on BOM.

Many researchers dealing with this model assume that manufacturing lead times are negligible, i.e. predecessors and successors might be produced in the same period (li
                         = 0 for every i). Since MLCLSP is a big-bucket model and periods are assumed to cover long time slots with several different production batches, the exact scheduling process is usually postponed to the next planning level (the bottom level of the PPS hierarchical system). Assuming that the capacity utilization is not too high and/or that there is always the possibility of using overtime to compensate a potential lack of capacity, it might be reasonable to neglect the lead time. Nevertheless, in case of capacity tight scenarios and of a limited usage of overtime (which happens for example in a production system running 24 hours a day, seven days a week) this zero lead time assumption may lead to plans that are not implementable in practice.

On the other hand, positive lead times of at least one period (li
                         = 1 for every i) do deliver feasible solutions that can be implemented. But positive lead times contradict somehow the big-bucket assumption, because in practice they would lead to extensive amounts of work-in-process. For example, consider a time period of one day and an average production batch of 3 hours. For a BOM with 10 levels it would take 10 days to finish a final item according to MLCLSP, but less than two days in practice. Note, that in the case of positive lead times the objective function (1) does not capture the additional work-in-process. An extra constant cost term depending on the total demand of all periods has to be added.

Let us assume a simple example with four items (1, 2, 3, and 4), three machines (A, B, and C), and two periods. Item 1 is produced on machine A, item 2 on machine B and items 3 and 4 on machine C. Items 1 and 2 are final items, where one unit of item 3 is necessary to produce one unit of item 1, and one unit of item 4 is necessary to produce one unit of item 2 and one unit of item 3, respectively. Table 1
                        contains all parameters and Fig. 1
                        depicts the product structure. It is assumed that resource requirements are measured in time units, each machine has a capacity of one (meaning it is available throughout the whole period) and setup times are 0.05 for all products. Furthermore, we assume that machine A is initially setup for item 1, machine B for item 2, and machine C for item 4.

The optimal solution of the MLCLSP model without lead time can be easily obtained (see Table 2
                        ). The total cost is 22 consisting of the setup cost of 20 (four setups) and the holding cost of two (two units of item 4 are carried to period 2). It is obvious that this solution is not feasible in practice, because before item 1 can be produced in the first period, items 3 and 4 have to be scheduled. Fig. 2(a)
                        shows the production plan generated by scheduling the solution obtained by the MLCLSP formulation. Note, that MLCLSP does not consider the initial setup state of the machines. Therefore the solution depicted in Fig. 2(a) saves the cost and time of three setups (if machines A, B, and C are initially set up for items 1, 2, and 4) and has a total cost of only seven (one setup from item 4 to item 3 and two units of item 4 carried to period 2). But obviously this production plan violates the demand requirement, as the lot of item 1 is finished in period 2 and not in period 1. The second production plan (Fig. 2(b)) is generated from the first one, by splitting the lot of item 4 such that item 1 can be finished on time. But an additional setup for item 4 increase the cost to 13. Furthermore, this version would violate the implicit assumption of the traditional lot-sizing model that each item is produced at most once in a period. The third plan (Fig. 2(c)) represents the optimal feasible solution of a simultaneous lot-sizing and scheduling model. The second batch of item 4 is moved to the second period (still the setup operation has to be done at the end of period 1), ending up with a total cost of 10 (two setups on machine C and no holding cost). But this solution is in essence different from that of MLCLSP. Clearly, if we consider one period lead time for MLCLSP, the problem is infeasible.

In order to address the above mentioned pitfalls of MLCLSP in a systematic way and to come up with an alternative, we suggest to embed scheduling to MLCLSP, i.e., to consider the starting times of operations and the precedence relations in production between products in an integrated manner. We present two model formulations. The first one is based on the batching assumption, i.e., the production of a successor item can only start if the complete batch of the predecessor item is finished. For the second formulation, the lot-streaming case, we relax this constraint and allow simultaneous production of predecessor and successor items.

This section develops a multi-level capacitated lot-sizing formulation that schedules the production lots and synchronizes the batches of predecessors and successors, based on (1)–(5). As for the MLCLSP model formulated before, we assume that each item is assigned to a single machine, which is the case for most problems published and test instances available (see Tempelmeier and Derstroff, 1996). The following additional parameters are introduced:

                           
                              
                                 ϕ(m)
                              set of items that can be assigned to machine m
                              

time for producing one unit of item i (we can omit index m because each item is assigned to a specific machine)

setup time for a changeover from product i to product j, sii
                                  = 0 for each i
                              

setup cost for a changeover from product i to product j, cii
                                  = 0, i, j ∈ ϕ(m)

We need the following decision variables:

                           
                              
                                 
                                    
                                       μ
                                       
                                          i
                                          t
                                       
                                       s
                                    
                                 
                              
                              start time of the production of item i in period t
                              

production amount of item j ∈ Γ(i) starting before production of item i is finished in period t
                              


                                 
                                    
                                       {
                                       
                                          
                                             
                                                
                                                   1
                                                   
                                                   if
                                                   
                                                   machine
                                                   
                                                   m
                                                   
                                                   is
                                                   
                                                   set
                                                   
                                                   up
                                                   
                                                   for
                                                   
                                                   item
                                                   
                                                   i
                                                   
                                                   at
                                                   
                                                   the
                                                   
                                                   beginning
                                                   
                                                   of
                                                
                                             
                                          
                                          
                                             
                                                
                                                   
                                                   
                                                      period
                                                      
                                                      t
                                                   
                                                
                                             
                                          
                                          
                                             
                                                
                                                   0
                                                   
                                                   otherwise
                                                
                                             
                                          
                                       
                                    
                                 
                              


                                 
                                    
                                       {
                                       
                                          
                                             
                                                
                                                   1
                                                   
                                                   if
                                                   
                                                   there
                                                   
                                                   is
                                                   
                                                   a
                                                   
                                                   changeover
                                                   
                                                   from
                                                   
                                                   item
                                                   
                                                   i
                                                   
                                                   to
                                                   
                                                   j
                                                   
                                                   on
                                                   
                                                   machine
                                                   
                                                   m
                                                   
                                                   in
                                                
                                             
                                          
                                          
                                             
                                                
                                                   
                                                   
                                                      period
                                                      
                                                      t
                                                   
                                                
                                             
                                          
                                          
                                             
                                                
                                                   0
                                                   
                                                   otherwise
                                                
                                             
                                          
                                       
                                    
                                 
                              


                                 
                                    
                                       {
                                       
                                          
                                             
                                                
                                                   1
                                                   
                                                   if
                                                   
                                                   production
                                                   
                                                   of
                                                   
                                                   item
                                                   
                                                   j
                                                   
                                                   starts
                                                   
                                                   after
                                                   
                                                   the
                                                   
                                                   whole
                                                   
                                                   batch
                                                   
                                                   of
                                                   
                                                   item
                                                
                                             
                                          
                                          
                                             
                                                
                                                   
                                                   i
                                                   
                                                   is
                                                   
                                                   completed
                                                   
                                                   in
                                                   
                                                   period
                                                   
                                                   t
                                                   
                                                   and
                                                   
                                                   
                                                      j
                                                      ∈
                                                      Γ
                                                      (
                                                      i
                                                      )
                                                   
                                                
                                             
                                          
                                          
                                             
                                                
                                                   0
                                                   
                                                   otherwise.
                                                
                                             
                                          
                                       
                                    
                                 
                              

By scaling, we assume without loss of generality that the duration of a period is a single time unit (i.e., Lmt
                         = 1 for every m and t). Hence, all time-related parameters and decision variables are scaled to this time unit. We first consider the case where the production takes place in batches. In other words, at the start of the production of item i the whole amount of necessary predecessors (raw materials) must be available and the finished items are available for other production processes only after the whole batch is finished. Hence, the stock level of item i is a discontinuous step function (see Fig. 3
                        ) where a decrease in stock is due to the consumption of item i by a different item and an increase in inventory results from a finished batch.


Note, that Tijtm
                         = 0 for every i∉ϕ(m) or 
                           
                              j
                              ∉
                              ϕ
                              (
                              m
                              )
                              ,
                           
                         and for i = j. We also have αitm
                         = 0 for every i∉ϕ(m). Let ν( · ) denote the optimal value of the underlying optimization problem. The corresponding lot-sizing and scheduling problem for the batching production (FB
                        ) reads:

                           
                              (6)
                              
                                 
                                    ν
                                    
                                       (
                                       
                                          F
                                          B
                                       
                                       )
                                    
                                    =
                                    min
                                    
                                       ∑
                                       
                                          i
                                          =
                                          1
                                       
                                       N
                                    
                                    
                                       ∑
                                       
                                          t
                                          =
                                          1
                                       
                                       T
                                    
                                    
                                       h
                                       
                                          i
                                          t
                                       
                                    
                                    ·
                                    
                                       I
                                       
                                          i
                                          t
                                       
                                    
                                    +
                                    
                                       ∑
                                       
                                          i
                                          =
                                          1
                                       
                                       N
                                    
                                    
                                       ∑
                                       
                                          j
                                          =
                                          1
                                       
                                       N
                                    
                                    
                                       ∑
                                       
                                          t
                                          =
                                          1
                                       
                                       T
                                    
                                    
                                       ∑
                                       
                                          m
                                          =
                                          1
                                       
                                       M
                                    
                                    
                                       c
                                       
                                          i
                                          j
                                       
                                    
                                    ·
                                    
                                       T
                                       
                                          i
                                          j
                                          t
                                          m
                                       
                                    
                                 
                              
                           
                        subject to

                           
                              (7)
                              
                                 
                                    
                                       
                                       
                                       
                                          
                                             
                                                I
                                                
                                                   i
                                                   t
                                                
                                             
                                             −
                                             
                                                I
                                                
                                                   i
                                                   (
                                                   t
                                                   −
                                                   1
                                                   )
                                                
                                             
                                             −
                                             
                                                X
                                                
                                                   i
                                                   t
                                                
                                             
                                             +
                                             
                                                ∑
                                                
                                                   j
                                                   ∈
                                                   Γ
                                                   (
                                                   i
                                                   )
                                                
                                             
                                             
                                                a
                                                
                                                   i
                                                   j
                                                
                                             
                                             ·
                                             
                                                X
                                                
                                                   j
                                                   t
                                                
                                             
                                             +
                                             
                                                E
                                                
                                                   i
                                                   t
                                                
                                             
                                             =
                                             0
                                             
                                             i
                                             ,
                                             t
                                          
                                       
                                    
                                 
                              
                           
                        
                        
                           
                              (8)
                              
                                 
                                    
                                       
                                       
                                       
                                          
                                             
                                                p
                                                i
                                             
                                             ·
                                             
                                                X
                                                
                                                   i
                                                   t
                                                
                                             
                                             ≤
                                             
                                                ∑
                                                
                                                   j
                                                   ∈
                                                   ϕ
                                                   (
                                                   m
                                                   )
                                                
                                             
                                             
                                                T
                                                
                                                   j
                                                   i
                                                   t
                                                   m
                                                
                                             
                                             +
                                             
                                                α
                                                
                                                   i
                                                   t
                                                   m
                                                
                                             
                                             
                                             i
                                             ∈
                                             ϕ
                                             
                                                (
                                                m
                                                )
                                             
                                             ,
                                             t
                                             ,
                                             m
                                          
                                       
                                    
                                 
                              
                           
                        
                        
                           
                              (9)
                              
                                 
                                    
                                       
                                       
                                       
                                          
                                             
                                                ∑
                                                
                                                   i
                                                   ∈
                                                   ϕ
                                                   (
                                                   m
                                                   )
                                                
                                             
                                             
                                                α
                                                
                                                   i
                                                   t
                                                   m
                                                
                                             
                                             =
                                             1
                                             
                                             t
                                             ,
                                             m
                                          
                                       
                                    
                                 
                              
                           
                        
                        
                           
                              (10)
                              
                                 
                                    
                                       
                                       
                                       
                                          
                                             
                                                ∑
                                                
                                                   j
                                                   ∈
                                                   ϕ
                                                   (
                                                   m
                                                   )
                                                
                                             
                                             
                                                T
                                                
                                                   j
                                                   i
                                                   t
                                                   m
                                                
                                             
                                             +
                                             
                                                α
                                                
                                                   i
                                                   t
                                                   m
                                                
                                             
                                             =
                                             
                                                ∑
                                                
                                                   j
                                                   ∈
                                                   ϕ
                                                   (
                                                   m
                                                   )
                                                
                                             
                                             
                                                T
                                                
                                                   i
                                                   j
                                                   t
                                                   m
                                                
                                             
                                             +
                                             
                                                α
                                                
                                                   i
                                                   (
                                                   t
                                                   +
                                                   1
                                                   )
                                                   m
                                                
                                             
                                             
                                             i
                                             ∈
                                             ϕ
                                             
                                                (
                                                m
                                                )
                                             
                                             ,
                                             t
                                             ,
                                             m
                                          
                                       
                                    
                                 
                              
                           
                        
                        
                           
                              (11)
                              
                                 
                                    
                                       
                                       
                                       
                                          
                                             
                                                ∑
                                                
                                                   j
                                                   ∈
                                                   ϕ
                                                   (
                                                   m
                                                   )
                                                
                                             
                                             
                                                T
                                                
                                                   j
                                                   i
                                                   t
                                                   m
                                                
                                             
                                             ≤
                                             1
                                             
                                             i
                                             ∈
                                             ϕ
                                             
                                                (
                                                m
                                                )
                                             
                                             ,
                                             t
                                             ,
                                             m
                                          
                                       
                                    
                                 
                              
                           
                        
                        
                           
                              (12)
                              
                                 
                                    
                                       
                                       
                                       
                                          
                                             
                                                μ
                                                
                                                   i
                                                   t
                                                
                                                s
                                             
                                             +
                                             
                                                p
                                                i
                                             
                                             ·
                                             
                                                X
                                                
                                                   i
                                                   t
                                                
                                             
                                             +
                                             
                                                s
                                                
                                                   i
                                                   j
                                                
                                             
                                             ·
                                             
                                                T
                                                
                                                   i
                                                   j
                                                   t
                                                   m
                                                
                                             
                                             +
                                             
                                                T
                                                
                                                   i
                                                   j
                                                   t
                                                   m
                                                
                                             
                                             −
                                             1
                                             −
                                             
                                                α
                                                
                                                   j
                                                   (
                                                   t
                                                   +
                                                   1
                                                   )
                                                   m
                                                
                                             
                                             ≤
                                             
                                                μ
                                                
                                                   j
                                                   t
                                                
                                                s
                                             
                                          
                                       
                                    
                                    
                                       
                                       
                                       
                                          
                                             
                                             i
                                             ∈
                                             ϕ
                                             (
                                             m
                                             )
                                             ,
                                             j
                                             ∈
                                             ϕ
                                             (
                                             m
                                             )
                                             ,
                                             t
                                             ,
                                             m
                                          
                                       
                                    
                                 
                              
                           
                        
                        
                           
                              (13)
                              
                                 
                                    
                                       
                                       
                                       
                                          
                                             
                                                μ
                                                
                                                   i
                                                   t
                                                
                                                s
                                             
                                             +
                                             
                                                p
                                                i
                                             
                                             ·
                                             
                                                X
                                                
                                                   i
                                                   t
                                                
                                             
                                             +
                                             
                                                s
                                                i
                                             
                                             j
                                             ·
                                             
                                                T
                                                
                                                   i
                                                   j
                                                   t
                                                   m
                                                
                                             
                                             +
                                             
                                                α
                                                
                                                   j
                                                   (
                                                   t
                                                   +
                                                   1
                                                   )
                                                   m
                                                
                                             
                                             −
                                             1
                                             −
                                             
                                                α
                                                
                                                   j
                                                   t
                                                   m
                                                
                                             
                                             ≤
                                             
                                                μ
                                                
                                                   j
                                                   t
                                                
                                                s
                                             
                                          
                                       
                                    
                                    
                                       
                                       
                                       
                                          
                                             
                                             i
                                             ∈
                                             ϕ
                                             (
                                             m
                                             )
                                             ,
                                             j
                                             ∈
                                             ϕ
                                             (
                                             m
                                             )
                                             ,
                                             t
                                             ,
                                             m
                                          
                                       
                                    
                                 
                              
                           
                        
                        
                           
                              (14)
                              
                                 
                                    
                                       
                                       
                                       
                                          
                                             
                                                μ
                                                
                                                   i
                                                   t
                                                
                                                s
                                             
                                             +
                                             
                                                p
                                                i
                                             
                                             ·
                                             
                                                X
                                                
                                                   i
                                                   t
                                                
                                             
                                             +
                                             
                                                ∑
                                                
                                                   j
                                                   ∈
                                                   ϕ
                                                   (
                                                   m
                                                   )
                                                
                                             
                                             
                                                s
                                                
                                                   i
                                                   j
                                                
                                             
                                             ·
                                             
                                                T
                                                
                                                   i
                                                   j
                                                   t
                                                   m
                                                
                                             
                                             ≤
                                             1
                                             
                                             i
                                             ∈
                                             ϕ
                                             
                                                (
                                                m
                                                )
                                             
                                             ,
                                             t
                                          
                                       
                                    
                                 
                              
                           
                        
                        
                           
                              (15)
                              
                                 
                                    
                                       
                                       
                                       
                                          
                                             
                                                (
                                                
                                                   μ
                                                   
                                                      i
                                                      t
                                                   
                                                   s
                                                
                                                +
                                                
                                                   p
                                                   i
                                                
                                                ·
                                                
                                                   X
                                                   
                                                      i
                                                      t
                                                   
                                                
                                                )
                                             
                                             −
                                             
                                                μ
                                                
                                                   j
                                                   t
                                                
                                                s
                                             
                                             ≤
                                             1
                                             −
                                             
                                                W
                                                
                                                   i
                                                   j
                                                   t
                                                
                                             
                                             
                                             i
                                             ,
                                             j
                                             ∈
                                             Γ
                                             
                                                (
                                                i
                                                )
                                             
                                             ,
                                             t
                                          
                                       
                                    
                                 
                              
                           
                        
                        
                           
                              (16)
                              
                                 
                                    
                                       
                                       
                                       
                                          
                                             
                                                
                                                   X
                                                   ^
                                                
                                                
                                                   i
                                                   j
                                                   t
                                                
                                             
                                             ≥
                                             
                                                X
                                                
                                                   j
                                                   t
                                                
                                             
                                             −
                                             
                                                1
                                                
                                                   p
                                                   j
                                                
                                             
                                             
                                                W
                                                
                                                   i
                                                   j
                                                   t
                                                
                                             
                                             
                                             i
                                             ,
                                             j
                                             ∈
                                             Γ
                                             
                                                (
                                                i
                                                )
                                             
                                             ,
                                             t
                                          
                                       
                                    
                                 
                              
                           
                        
                        
                           
                              (17)
                              
                                 
                                    
                                       
                                       
                                       
                                          
                                             
                                                I
                                                
                                                   i
                                                   (
                                                   t
                                                   −
                                                   1
                                                   )
                                                
                                             
                                             ≥
                                             
                                                ∑
                                                
                                                   j
                                                   ∈
                                                   Γ
                                                   (
                                                   i
                                                   )
                                                
                                             
                                             
                                                a
                                                
                                                   i
                                                   j
                                                
                                             
                                             
                                                
                                                   X
                                                   ^
                                                
                                                
                                                   i
                                                   j
                                                   t
                                                
                                             
                                             
                                             i
                                             ,
                                             t
                                          
                                       
                                    
                                 
                              
                           
                        
                        
                           
                              (18)
                              
                                 
                                    
                                       
                                       
                                       
                                          
                                             
                                                I
                                                
                                                   i
                                                   t
                                                
                                             
                                             ,
                                             
                                                X
                                                
                                                   i
                                                   t
                                                
                                             
                                             ,
                                             
                                                
                                                   X
                                                   ^
                                                
                                                
                                                   i
                                                   j
                                                   t
                                                
                                             
                                             ,
                                             
                                                μ
                                                
                                                   i
                                                   t
                                                
                                                s
                                             
                                             ≥
                                             0
                                             ;
                                             
                                                α
                                                
                                                   i
                                                   t
                                                   m
                                                
                                             
                                             ,
                                             
                                                T
                                                
                                                   i
                                                   j
                                                   t
                                                   m
                                                
                                             
                                             ,
                                             
                                                W
                                                
                                                   i
                                                   j
                                                   t
                                                
                                             
                                             ∈
                                             
                                                {
                                                0
                                                ,
                                                1
                                                }
                                             
                                             
                                             i
                                             ,
                                             j
                                             ,
                                             t
                                             ,
                                             m
                                             .
                                          
                                       
                                    
                                 
                              
                           
                        
                     

Objective function (6) aims at minimizing the sum of sequence-dependent setup and holding costs. Constraints (7) represent the inventory balance for both components and end-items. Constraints (8) guarantee that a product is produced only if the machine is set up for it. Note that we assume that the length of one period is one time unit and capacities are measured in time units. Therefore, in contrast to constraints (4), we can omit parameter G in this case. Based on (9) each machine has to be set up for exactly one product at the beginning of each period. Constraints (10) carry the setup configuration state of the machines into the next period. They represent a flow conservation for the setup state. So if a machine is set up for a certain item i in period t, there must be either a changeover from item i to another item (∑
                           j ∈ ϕ(m)
                        Tijtm
                        ) or the setup state is carried over to the next period (α
                        
                           i(t + 1)m
                        ). Constraints (11) avoid more than one setup for each item. The production sequence on a certain machine within a period represents an open tour including some of the items. As in vehicle routing problems we have to avoid disconnected subtours, i.e., setup sequences which cycle between the same products within a period (e.g., i
                        1 → i
                        2 → … → i
                        1) but where the initial setup state of the machine is not part of this sequence. Constraints (12) cut off such disconnected subtours and subtours that appear in the middle of the sequence (see e.g., Almada-Lobo et al., 2007 or Almada-Lobo et al., 2008 for further details). Furthermore, these constraints link the starting and finishing times of two batches produced one immediately after the other. We do not impose the starting times of the first batch in any period to be zero, as there might be some idle time before production starts (as well as afterward). Requirements (12) do not define the starting time of the last product to be produced on each machine, as they are inactive for such cases. We assume that for a cycle with more than one item involving item j (αjtm
                         = α
                        
                           j(t + 1)m
                         = 1), there occurs only one batch of j in the first position of the production sequence. In case of a path, requirements (13) determine the starting time of the last product of the sequence. Clearly, (13) are redundant for a cycle. Inequalities (12)–(14) ensure that the machines are used no longer than their available capacity. Constraints (15) ensure the coherency between variables Wijt
                         and the start and finish times of the batches of predecessors and successors. Note that 
                           
                              
                                 μ
                                 
                                    i
                                    t
                                 
                                 s
                              
                              +
                              
                                 p
                                 i
                              
                              ·
                              
                                 X
                                 
                                    i
                                    t
                                 
                              
                           
                         computes the production completion time of product i in period t. In case item j starts the production before the batch of its predecessor i is completed in the same period (or in case there is not such batch), i.e. Wijt
                         = 0, constraints (16) and (17) force the quantity of item i required to produce j to be supplied solely from the initial stock in that period. If Wijt
                         = 1, then (16) and (17) are inactive, and (7) allow the gross requirements of item i to produce j to be matched from stock and from production in the same period.

Note that the way how depended batches are synchronized is motivated by a model formulation given in Almeder and Almada-Lobo (2011) where the usage of a secondary resource is synchronized across parallel machines.

                           Proof
                           
                              Example continued. For a better understanding of the model let us return to the example given in Section 2.2. Fig. 4
                              depicts the optimal solution obtained by the model above with total cost of 10. The positive values of the decision variables are indicated at the different positions. All decision variables not mentioned have a value of 0.


The variables αitm
                               and Tijtm
                               determine the changes of the setup state of the machines and the items which may be produced. The values of α
                              
                                 i1m
                               correspond to the given initial setup state of the machines. Since there is no setup on machines A and B, in period 1 variables Tijtm
                               equal to 0 for m = A, B. On machine C we have in the first period a changeover from item 4 to item 3 and back to item 4. Hence, for items 3 and 4 constraints (10) are as follows:

                                 
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      1
                                                      
                                                         T
                                                         
                                                            431
                                                            C
                                                         
                                                      
                                                   
                                                   +
                                                   
                                                      0
                                                      
                                                         α
                                                         
                                                            31
                                                            C
                                                         
                                                      
                                                   
                                                   =
                                                   
                                                      1
                                                      
                                                         T
                                                         
                                                            341
                                                            C
                                                         
                                                      
                                                   
                                                   +
                                                   
                                                      0
                                                      
                                                         α
                                                         
                                                            32
                                                            C
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                          
                                             
                                                
                                                   
                                                      1
                                                      
                                                         T
                                                         
                                                            341
                                                            C
                                                         
                                                      
                                                   
                                                   +
                                                   
                                                      1
                                                      
                                                         α
                                                         
                                                            41
                                                            C
                                                         
                                                      
                                                   
                                                   =
                                                   
                                                      1
                                                      
                                                         T
                                                         
                                                            431
                                                            C
                                                         
                                                      
                                                   
                                                   +
                                                   
                                                      1
                                                      
                                                         α
                                                         
                                                            42
                                                            C
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           

The constraints (12) and (13) ensure a correct production sequence within a period and enforce the decision variables 
                                 
                                    μ
                                    
                                       i
                                       t
                                    
                                    s
                                 
                               to take the correct starting times of the lots. Let us look in more detail to constraints (12) for items 3 and 4 in period 1:

                                 
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         0.35
                                                      
                                                      
                                                         μ
                                                         
                                                            31
                                                         
                                                         s
                                                      
                                                   
                                                   +
                                                   
                                                      
                                                         0.3
                                                      
                                                      
                                                         
                                                            p
                                                            3
                                                         
                                                         ·
                                                         
                                                            X
                                                            31
                                                         
                                                      
                                                   
                                                   +
                                                   
                                                      
                                                         0.05
                                                      
                                                      
                                                         
                                                            s
                                                            34
                                                         
                                                         ·
                                                         
                                                            T
                                                            
                                                               341
                                                               C
                                                            
                                                         
                                                      
                                                   
                                                   +
                                                   
                                                      1
                                                      
                                                         T
                                                         
                                                            341
                                                            C
                                                         
                                                      
                                                   
                                                   −
                                                   1
                                                   −
                                                   
                                                      1
                                                      
                                                         α
                                                         
                                                            42
                                                            C
                                                         
                                                      
                                                   
                                                   =
                                                   −
                                                   0.3
                                                   ≤
                                                   
                                                      0
                                                      
                                                         μ
                                                         
                                                            41
                                                         
                                                         s
                                                      
                                                   
                                                
                                             
                                          
                                          
                                             
                                                
                                                   
                                                      0
                                                      
                                                         μ
                                                         
                                                            41
                                                         
                                                         s
                                                      
                                                   
                                                   +
                                                   
                                                      
                                                         0.3
                                                      
                                                      
                                                         
                                                            p
                                                            4
                                                         
                                                         ·
                                                         
                                                            X
                                                            41
                                                         
                                                      
                                                   
                                                   +
                                                   
                                                      
                                                         0.05
                                                      
                                                      
                                                         
                                                            s
                                                            43
                                                         
                                                         ·
                                                         
                                                            T
                                                            
                                                               431
                                                               C
                                                            
                                                         
                                                      
                                                   
                                                   +
                                                   
                                                      1
                                                      
                                                         T
                                                         
                                                            431
                                                            C
                                                         
                                                      
                                                   
                                                   −
                                                   1
                                                   −
                                                   
                                                      0
                                                      
                                                         α
                                                         
                                                            32
                                                            C
                                                         
                                                      
                                                   
                                                   =
                                                   0.35
                                                   ≤
                                                   
                                                      
                                                         0.35
                                                      
                                                      
                                                         μ
                                                         
                                                            31
                                                         
                                                         s
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                              The last term of the left-hand-side (αjtm
                              ) is necessary to allow a changeover back to item 4 at the end of period 1. Otherwise, the two constraints above would conflict and no feasible values for 
                                 
                                    μ
                                    
                                       31
                                    
                                    s
                                 
                               and 
                                 
                                    μ
                                    
                                       41
                                    
                                    s
                                 
                               would be possible. In case there is no changeover back to the first item produced in that period, constraints (13) is turned active enforcing the correct starting value of the last lot in a period.

Since in period 1 the lot of item 3 is produced after item 4 and item 1 after item 3, constraints (15) do not enforce Wijt
                               to be 0 for those item combinations:

                                 
                                    
                                       
                                          
                                             
                                             
                                             
                                                
                                                   
                                                      
                                                         0.3
                                                      
                                                      
                                                         
                                                            μ
                                                            
                                                               41
                                                            
                                                            s
                                                         
                                                         +
                                                         
                                                            p
                                                            4
                                                         
                                                         ·
                                                         
                                                            X
                                                            41
                                                         
                                                      
                                                   
                                                   −
                                                   
                                                      
                                                         0.35
                                                      
                                                      
                                                         μ
                                                         31
                                                      
                                                   
                                                   =
                                                   −
                                                   0.05
                                                   ≤
                                                   1
                                                   −
                                                   
                                                      W
                                                      431
                                                   
                                                
                                             
                                          
                                          
                                             
                                             
                                             
                                                
                                                   
                                                      
                                                         0.65
                                                      
                                                      
                                                         
                                                            μ
                                                            
                                                               31
                                                            
                                                            s
                                                         
                                                         +
                                                         
                                                            p
                                                            3
                                                         
                                                         ·
                                                         
                                                            X
                                                            31
                                                         
                                                      
                                                   
                                                   −
                                                   
                                                      
                                                         0.65
                                                      
                                                      
                                                         μ
                                                         11
                                                      
                                                   
                                                   =
                                                   0
                                                   ≤
                                                   1
                                                   −
                                                   
                                                      W
                                                      311
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                              Hence, W
                              431 and W
                              311 can take the values 1, such that 
                                 
                                    
                                       
                                          X
                                          ^
                                       
                                       431
                                    
                                    =
                                    
                                       
                                          X
                                          ^
                                       
                                       311
                                    
                                    =
                                    0
                                 
                               according to (16) and consequently, due to constraints (17) there is no inventory of item 4 or 3 necessary before the start of the period.□

Next we show that formulation FB
                         really models the problem correctly. Let Q be the set of solutions satisfying constraints (7)–(15) and (18). Set Q admits solutions that have nonnegative inventory stock for every product at the end of every period (imposed by (7)), but potentially negative in-period stock. We show that constraints (16) and (17) avoid this case. To this end, consider subsets S(i) of items in a given time period t defined as

                           
                              
                                 
                                    S
                                    
                                       (
                                       i
                                       )
                                    
                                    =
                                    {
                                    j
                                    ∈
                                    Γ
                                    
                                       (
                                       i
                                       )
                                    
                                    :
                                    
                                       μ
                                       
                                          j
                                          t
                                       
                                       s
                                    
                                    <
                                    
                                       μ
                                       
                                          i
                                          t
                                       
                                       s
                                    
                                    +
                                    
                                       p
                                       i
                                    
                                    ·
                                    
                                       X
                                       
                                          i
                                          t
                                       
                                    
                                    }
                                    .
                                 
                              
                           
                        The following lemma states that there are no negative in-period stocks (note that due to the batching assumption the condition ∑
                           j ∈ S(i)
                        aij
                         · Xjt
                         > I
                        
                           i(t − 1) is equivalent to the statement of having negative in-period stock).

                           Lemma 1
                           
                              If x
                              ⋆ ∈ Q and x
                              ⋆ 
                              fulfills 
                              (16) 
                              and 
                              (17), then ∑
                                 j ∈ S(i)
                              aij
                               · Xjt
                               ≤ I
                              
                                 i(t − 1).

Let x
                              ⋆ ∈ Q. We first observe that if j ∈ S(i), then 
                                 
                                    
                                       μ
                                       
                                          j
                                          t
                                       
                                       s
                                    
                                    <
                                    
                                       μ
                                       
                                          i
                                          t
                                       
                                       s
                                    
                                    +
                                    
                                       p
                                       i
                                    
                                    ·
                                    
                                       X
                                       
                                          i
                                          t
                                       
                                    
                                    ,
                                 
                               which in turn from (15) implies Wijt
                               = 0. Thus if j ∈ S(i), from (16) we obtain 
                                 
                                    
                                       
                                          X
                                          ^
                                       
                                       
                                          i
                                          j
                                          t
                                       
                                    
                                    ≥
                                    
                                       X
                                       
                                          j
                                          t
                                       
                                    
                                 
                              .

On the other hand, if j ∈ Γ(i)\S(i), then clearly 
                                 
                                    
                                       
                                          X
                                          ^
                                       
                                       
                                          i
                                          j
                                          t
                                       
                                    
                                    ≥
                                    0
                                 
                              . Combining these two facts we derive

                                 
                                    
                                       
                                          
                                             
                                                
                                                   i
                                                   (
                                                   t
                                                   −
                                                   1
                                                   )
                                                
                                             
                                             
                                                ≥
                                             
                                             
                                                
                                                   
                                                      ∑
                                                      
                                                         j
                                                         ∈
                                                         Γ
                                                         (
                                                         i
                                                         )
                                                      
                                                   
                                                   
                                                      a
                                                      
                                                         i
                                                         j
                                                      
                                                   
                                                   ·
                                                   
                                                      
                                                         X
                                                         ^
                                                      
                                                      
                                                         i
                                                         j
                                                         t
                                                      
                                                   
                                                   ≥
                                                   
                                                      ∑
                                                      
                                                         j
                                                         ∈
                                                         S
                                                         (
                                                         i
                                                         )
                                                      
                                                   
                                                   
                                                      a
                                                      
                                                         i
                                                         j
                                                      
                                                   
                                                   ·
                                                   
                                                      
                                                         X
                                                         ^
                                                      
                                                      
                                                         i
                                                         j
                                                         t
                                                      
                                                   
                                                   +
                                                   
                                                      ∑
                                                      
                                                         j
                                                         ∈
                                                         Γ
                                                         (
                                                         i
                                                         )
                                                         ∖
                                                         S
                                                         (
                                                         i
                                                         )
                                                      
                                                   
                                                   
                                                      a
                                                      
                                                         i
                                                         j
                                                      
                                                   
                                                   ·
                                                   
                                                      
                                                         X
                                                         ^
                                                      
                                                      
                                                         i
                                                         j
                                                         t
                                                      
                                                   
                                                
                                             
                                          
                                          
                                             
                                             
                                                ≥
                                             
                                             
                                                
                                                   
                                                      ∑
                                                      
                                                         j
                                                         ∈
                                                         S
                                                         (
                                                         i
                                                         )
                                                      
                                                   
                                                   
                                                      a
                                                      
                                                         i
                                                         j
                                                      
                                                   
                                                   ·
                                                   
                                                      
                                                         X
                                                         ^
                                                      
                                                      
                                                         i
                                                         j
                                                         t
                                                      
                                                   
                                                   ≥
                                                   
                                                      ∑
                                                      
                                                         j
                                                         ∈
                                                         S
                                                         (
                                                         i
                                                         )
                                                      
                                                   
                                                   
                                                      a
                                                      
                                                         i
                                                         j
                                                      
                                                   
                                                   ·
                                                   
                                                      X
                                                      
                                                         j
                                                         t
                                                      
                                                   
                                                   .
                                                
                                             
                                          
                                       
                                    
                                 
                              This establishes the lemma.□

In addition to showing that solutions have no negative in-period stock, we need to assert that no solutions to the problem are left out.

                           Lemma 2
                           
                              Any x
                              ⋆ ∈ Q satisfying ∑
                                 j ∈ S(i)
                              aij
                               · Xjt
                               ≤ I
                              
                                 i(t − 1) 
                              for every i and t (x* has nonnegative in-period inventory) fulfills constraints 
                              (16) 
                              and 
                              (17).

We show this by contradiction. We first note that in (16) and (17) we have the freedom of selecting 
                                 
                                    
                                       X
                                       ^
                                    
                                    
                                       i
                                       j
                                       t
                                    
                                 
                              . As a result we can assume that we have an underlying 
                                 
                                    
                                       X
                                       ^
                                    
                                    
                                       i
                                       j
                                       t
                                    
                                 
                               satisfying (16) but not (17) for at least one item i′ in a period t′ since otherwise we could always increase 
                                 
                                    
                                       X
                                       ^
                                    
                                    
                                       i
                                       j
                                       t
                                    
                                 
                               to satisfy (16), but possibly violate (17) even more. Thus we have

                                 
                                    
                                       
                                          
                                             
                                             
                                             
                                                
                                                   
                                                      
                                                         X
                                                         ^
                                                      
                                                      
                                                         
                                                            i
                                                            ′
                                                         
                                                         j
                                                         
                                                            t
                                                            ′
                                                         
                                                      
                                                   
                                                   ≥
                                                   
                                                      X
                                                      
                                                         j
                                                         
                                                            t
                                                            ′
                                                         
                                                      
                                                   
                                                   −
                                                   
                                                      1
                                                      
                                                         p
                                                         j
                                                      
                                                   
                                                   
                                                      W
                                                      
                                                         
                                                            i
                                                            ′
                                                         
                                                         j
                                                         
                                                            t
                                                            ′
                                                         
                                                      
                                                   
                                                   
                                                   j
                                                   ∈
                                                   Γ
                                                   
                                                      (
                                                      
                                                         i
                                                         ′
                                                      
                                                      )
                                                   
                                                
                                             
                                          
                                          
                                             
                                             
                                             
                                                
                                                   
                                                      I
                                                      
                                                         
                                                            i
                                                            ′
                                                         
                                                         
                                                            (
                                                            
                                                               t
                                                               ′
                                                            
                                                            −
                                                            1
                                                            )
                                                         
                                                      
                                                   
                                                   <
                                                   
                                                      ∑
                                                      
                                                         j
                                                         ∈
                                                         Γ
                                                         (
                                                         
                                                            i
                                                            ′
                                                         
                                                         )
                                                      
                                                   
                                                   
                                                      a
                                                      
                                                         
                                                            i
                                                            ′
                                                         
                                                         j
                                                      
                                                   
                                                   
                                                      
                                                         X
                                                         ^
                                                      
                                                      
                                                         
                                                            i
                                                            ′
                                                         
                                                         j
                                                         
                                                            t
                                                            ′
                                                         
                                                      
                                                   
                                                   .
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           

Among all such 
                                 
                                    
                                       
                                          X
                                          ^
                                       
                                       
                                          
                                             i
                                             ′
                                          
                                          j
                                          
                                             t
                                             ′
                                          
                                       
                                    
                                    ,
                                 
                               we pick the smallest one, which we denote by 
                                 
                                    
                                       X
                                       ^
                                    
                                    
                                       
                                          i
                                          ′
                                       
                                       j
                                       
                                          t
                                          ′
                                       
                                    
                                    min
                                 
                              . By choice we clearly have

                                 
                                    (19)
                                    
                                       
                                          
                                             I
                                             
                                                
                                                   i
                                                   ′
                                                
                                                
                                                   (
                                                   
                                                      t
                                                      ′
                                                   
                                                   −
                                                   1
                                                   )
                                                
                                             
                                          
                                          <
                                          
                                             ∑
                                             
                                                j
                                                ∈
                                                Γ
                                                (
                                                
                                                   i
                                                   ′
                                                
                                                )
                                             
                                          
                                          
                                             a
                                             
                                                
                                                   i
                                                   ′
                                                
                                                j
                                             
                                          
                                          
                                             
                                                X
                                                ^
                                             
                                             
                                                
                                                   i
                                                   ′
                                                
                                                j
                                                
                                                   t
                                                   ′
                                                
                                             
                                             min
                                          
                                          .
                                       
                                    
                                 
                              According to the definition of S(i), the minimal values satisfying (16) are defined by

                                 
                                    
                                       
                                          
                                             
                                                X
                                                ^
                                             
                                             
                                                
                                                   i
                                                   ′
                                                
                                                j
                                                
                                                   t
                                                   ′
                                                
                                             
                                             min
                                          
                                          =
                                          
                                             {
                                             
                                                
                                                   
                                                      
                                                         
                                                            X
                                                            
                                                               j
                                                               
                                                                  t
                                                                  ′
                                                               
                                                            
                                                         
                                                         j
                                                         ∈
                                                         S
                                                         
                                                            (
                                                            
                                                               i
                                                               ′
                                                            
                                                            )
                                                         
                                                      
                                                   
                                                
                                                
                                                   
                                                      
                                                         0
                                                         j
                                                         ∈
                                                         Γ
                                                         
                                                            (
                                                            
                                                               i
                                                               ′
                                                            
                                                            )
                                                         
                                                         
                                                            ∖
                                                            S
                                                         
                                                         
                                                            (
                                                            
                                                               i
                                                               ′
                                                            
                                                            )
                                                         
                                                         .
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           

Inequality (19) yields

                                 
                                    
                                       
                                          
                                             
                                                
                                                   I
                                                   
                                                      
                                                         i
                                                         ′
                                                      
                                                      
                                                         (
                                                         
                                                            t
                                                            ′
                                                         
                                                         −
                                                         1
                                                         )
                                                      
                                                   
                                                
                                             
                                             
                                                <
                                             
                                             
                                                
                                                   
                                                      ∑
                                                      
                                                         j
                                                         ∈
                                                         Γ
                                                         (
                                                         
                                                            i
                                                            ′
                                                         
                                                         )
                                                      
                                                   
                                                   
                                                      a
                                                      
                                                         
                                                            i
                                                            ′
                                                         
                                                         j
                                                      
                                                   
                                                   
                                                      
                                                         X
                                                         ^
                                                      
                                                      
                                                         
                                                            i
                                                            ′
                                                         
                                                         j
                                                         
                                                            t
                                                            ′
                                                         
                                                      
                                                      min
                                                   
                                                   =
                                                   
                                                      ∑
                                                      
                                                         j
                                                         ∈
                                                         S
                                                         (
                                                         
                                                            i
                                                            ′
                                                         
                                                         )
                                                      
                                                   
                                                   
                                                      a
                                                      
                                                         
                                                            i
                                                            ′
                                                         
                                                         j
                                                      
                                                   
                                                   
                                                      
                                                         X
                                                         ^
                                                      
                                                      
                                                         
                                                            i
                                                            ′
                                                         
                                                         j
                                                         
                                                            t
                                                            ′
                                                         
                                                      
                                                      min
                                                   
                                                   +
                                                   
                                                      ∑
                                                      
                                                         j
                                                         ∈
                                                         Γ
                                                         
                                                            (
                                                            
                                                               i
                                                               ′
                                                            
                                                            )
                                                         
                                                         
                                                            ∖
                                                            S
                                                         
                                                         
                                                            (
                                                            
                                                               i
                                                               ′
                                                            
                                                            )
                                                         
                                                      
                                                   
                                                   
                                                      a
                                                      
                                                         
                                                            i
                                                            ′
                                                         
                                                         j
                                                      
                                                   
                                                   
                                                      
                                                         X
                                                         ^
                                                      
                                                      
                                                         
                                                            i
                                                            ′
                                                         
                                                         j
                                                         
                                                            t
                                                            ′
                                                         
                                                      
                                                      min
                                                   
                                                
                                             
                                          
                                          
                                             
                                             
                                                =
                                             
                                             
                                                
                                                   
                                                      ∑
                                                      
                                                         j
                                                         ∈
                                                         S
                                                         (
                                                         
                                                            i
                                                            ′
                                                         
                                                         )
                                                      
                                                   
                                                   
                                                      a
                                                      
                                                         
                                                            i
                                                            ′
                                                         
                                                         j
                                                      
                                                   
                                                   
                                                      X
                                                      
                                                         j
                                                         
                                                            t
                                                            ′
                                                         
                                                      
                                                   
                                                   .
                                                
                                             
                                          
                                       
                                    
                                 
                              This constraint indicates that there is negative in-period inventory and it contradicts our assumption that 
                                 
                                    ∑
                                    
                                       a
                                       
                                          
                                             i
                                             ′
                                          
                                          j
                                       
                                    
                                    ·
                                    
                                       X
                                       
                                          j
                                          t
                                       
                                    
                                    ≤
                                    
                                       I
                                       
                                          
                                             i
                                             ′
                                          
                                          
                                             (
                                             
                                                t
                                                ′
                                             
                                             −
                                             1
                                             )
                                          
                                       
                                    
                                 
                              .□

The previous model assumed that components can only be used for the production of successors if the production batch is completely finished. If this assumption is relaxed, we allow to use some already finished parts of the current production batch for the production of successors. No transportation times are considered between different production stages and inventory levels increase and decrease continuously due to production and consumption of an item. It has to be ensured that during the whole period the inventory level is nonnegative. Instead of constraints (16) and (17) it is necessary to replace them with

                           
                              (20)
                              
                                 
                                    
                                       
                                       
                                       
                                          
                                             
                                                I
                                                
                                                   i
                                                   (
                                                   t
                                                   −
                                                   1
                                                   )
                                                
                                             
                                             +
                                             min
                                             
                                                (
                                                
                                                   X
                                                   
                                                      i
                                                      t
                                                   
                                                
                                                ,
                                                
                                                   1
                                                   
                                                      p
                                                      i
                                                   
                                                
                                                
                                                   
                                                      (
                                                      τ
                                                      −
                                                      
                                                         μ
                                                         
                                                            i
                                                            t
                                                         
                                                         s
                                                      
                                                      )
                                                   
                                                   +
                                                
                                                )
                                             
                                          
                                       
                                    
                                    
                                       
                                       
                                       
                                          
                                             
                                             ≥
                                             
                                                ∑
                                                
                                                   j
                                                   ∈
                                                   Γ
                                                   (
                                                   i
                                                   )
                                                
                                             
                                             
                                                a
                                                
                                                   i
                                                   j
                                                
                                             
                                             min
                                             
                                                (
                                                
                                                   X
                                                   
                                                      j
                                                      t
                                                   
                                                
                                                ,
                                                
                                                   1
                                                   
                                                      p
                                                      j
                                                   
                                                
                                                
                                                   
                                                      (
                                                      τ
                                                      −
                                                      
                                                         μ
                                                         
                                                            j
                                                            t
                                                         
                                                         s
                                                      
                                                      )
                                                   
                                                   +
                                                
                                                )
                                             
                                             
                                             i
                                             ,
                                             t
                                             ,
                                             τ
                                             ∈
                                             
                                                [
                                                0
                                                ,
                                                1
                                                ]
                                             
                                             ,
                                          
                                       
                                    
                                 
                              
                           
                        where x
                        + ≔ max (x, 0).

This set of constraints ensures that, for every time point τ in period t, the initial inventory plus the production of item i until τ is not less than the consumption of item i due to the production of successors. Note that the external demand Eit
                         only occurs at the end of the period. Unfortunately there is an infinite number of such constraints. The next result asserts that only a finite number of τ values suffices.

                           Theorem 1
                           
                              It is sufficient and necessary to fulfill constraints 
                              (7) 
                              and 
                              (20) 
                              at the start of the production batch of item i (
                                 
                                    τ
                                    =
                                    
                                       μ
                                       
                                          i
                                          t
                                       
                                       s
                                    
                                    
                                       )
                                    
                                 
                               
                              and at the end of the production batch of each successor k ∈ Γ(i) (
                                 
                                    τ
                                    =
                                    
                                       μ
                                       
                                          k
                                          t
                                       
                                       s
                                    
                                    +
                                    
                                       p
                                       k
                                    
                                    
                                       X
                                       
                                          k
                                          t
                                       
                                    
                                 
                              ) in order to maintain a nonnegative inventory level throughout the whole period t.

We fix item i. Let us first consider the case when there is no production of item i in period t (Xit
                               = 0). If there is no production, the in-period inventory level of item i is non-increasing throughout the period. Hence it reaches the minimum at the end of the period. Since constraints (7) ensure that there is a nonnegative stock level at the end of each period, the in-period inventory level can never be negative. To show the other way around, because of (7), the following derivation shows that (20) is fulfilled for all τ:

                                 
                                    
                                       
                                          
                                             
                                             
                                             
                                                
                                                   
                                                      I
                                                      
                                                         i
                                                         (
                                                         t
                                                         −
                                                         1
                                                         )
                                                      
                                                   
                                                   +
                                                   min
                                                   
                                                      (
                                                      
                                                         X
                                                         
                                                            i
                                                            t
                                                         
                                                      
                                                      ,
                                                      
                                                         1
                                                         
                                                            p
                                                            i
                                                         
                                                      
                                                      
                                                         
                                                            (
                                                            τ
                                                            −
                                                            
                                                               μ
                                                               
                                                                  i
                                                                  t
                                                               
                                                               s
                                                            
                                                            )
                                                         
                                                         +
                                                      
                                                      )
                                                   
                                                   =
                                                   
                                                      I
                                                      
                                                         i
                                                         (
                                                         t
                                                         −
                                                         1
                                                         )
                                                      
                                                   
                                                   =
                                                   
                                                      I
                                                      
                                                         i
                                                         t
                                                      
                                                   
                                                   −
                                                   
                                                      X
                                                      
                                                         i
                                                         t
                                                      
                                                   
                                                   +
                                                   
                                                      E
                                                      
                                                         i
                                                         t
                                                      
                                                   
                                                
                                             
                                          
                                          
                                             
                                             
                                             
                                                
                                                   
                                                   +
                                                   
                                                   
                                                      ∑
                                                      
                                                         j
                                                         ∈
                                                         Γ
                                                         (
                                                         i
                                                         )
                                                      
                                                   
                                                   
                                                      a
                                                      
                                                         i
                                                         j
                                                      
                                                   
                                                   
                                                      X
                                                      
                                                         j
                                                         t
                                                      
                                                   
                                                   ≥
                                                   
                                                      ∑
                                                      
                                                         j
                                                         ∈
                                                         Γ
                                                         (
                                                         i
                                                         )
                                                      
                                                   
                                                   
                                                      a
                                                      
                                                         i
                                                         j
                                                      
                                                   
                                                   
                                                      X
                                                      
                                                         j
                                                         t
                                                      
                                                   
                                                   ≥
                                                   
                                                      ∑
                                                      
                                                         j
                                                         ∈
                                                         Γ
                                                         (
                                                         i
                                                         )
                                                      
                                                   
                                                   
                                                      a
                                                      
                                                         i
                                                         j
                                                      
                                                   
                                                   min
                                                   
                                                      (
                                                      
                                                         X
                                                         
                                                            j
                                                            t
                                                         
                                                      
                                                      ,
                                                      
                                                         1
                                                         
                                                            p
                                                            j
                                                         
                                                      
                                                      
                                                         
                                                            (
                                                            τ
                                                            −
                                                            
                                                               μ
                                                               
                                                                  j
                                                                  t
                                                               
                                                               s
                                                            
                                                            )
                                                         
                                                         +
                                                      
                                                      )
                                                   
                                                   .
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           

Now let us consider the case of a production of item i in period t (Xit
                               > 0). We divide the period into three parts. Let t
                              1 define the start of the production of item i (
                                 
                                    
                                       t
                                       1
                                    
                                    =
                                    
                                       μ
                                       
                                          i
                                          t
                                       
                                       s
                                    
                                 
                              ), and t
                              2 the end of the production of item i (
                                 
                                    
                                       t
                                       2
                                    
                                    =
                                    
                                       μ
                                       
                                          i
                                          t
                                       
                                       s
                                    
                                    +
                                    
                                       p
                                       i
                                    
                                    
                                       X
                                       
                                          i
                                          t
                                       
                                    
                                 
                              ). Furthermore, note that 
                                 
                                    1
                                    
                                       p
                                       i
                                    
                                 
                               is the production rate of item i, 
                                 
                                    
                                       a
                                       
                                          i
                                          j
                                       
                                    
                                    
                                       p
                                       j
                                    
                                 
                               is the consumption rate of item i due to the production of successor j, and the in-period inventory level Iit
                              (τ) is a piecewise linear function of τ.

Let first τ ∈ [0, t
                              1]. During this period only consumption of item i might occur (Iit
                              (τ) is non-increasing), so it is sufficient and necessary that at time t
                              1 the inventory level is nonnegative, which is equivalent to constraints (20) at 
                                 
                                    τ
                                    =
                                    
                                       t
                                       1
                                    
                                    =
                                    
                                       μ
                                       
                                          i
                                          t
                                       
                                       s
                                    
                                 
                              .

Consider now τ ∈ [t
                              2, 1]. After t
                              2 again only consumption might occur and the in-period inventory level is non-increasing (Iit
                              (τ) is again non-increasing). For the time span from t
                              2 to the end of the period it is sufficient and necessary to have nonnegative inventory at the end of the period. This is assured by constraints (7).

Finally, let τ ∈ [t
                              1, t
                              2]. During the production period of item i between t
                              1 and t
                              2 the in-period inventory level may increase or decrease depending on the difference between the constant production rate 
                                 
                                    1
                                    
                                       p
                                       i
                                    
                                 
                               and the consumption rate of all currently processed successors (see Fig. 5
                              ). This consumption rate might vary depending on the number of successors produced at a specific time point. If we consider a specific successor k of item i, during the production of item k, the consumption rate of item i is increased by 
                                 
                                    
                                       a
                                       
                                          i
                                          k
                                       
                                    
                                    
                                       p
                                       k
                                    
                                 
                              . Since the consumption rate due to item k stays constant over the whole production period [t
                              1, t
                              2], it is sufficient and necessary that at the end of this production period the in-period inventory level is nonnegative, i.e. Iit
                              (τ) ≥ 0 for 
                                 
                                    τ
                                    =
                                    
                                       μ
                                       
                                          k
                                          t
                                       
                                       s
                                    
                                    +
                                    
                                       p
                                       k
                                    
                                    
                                       X
                                       
                                          k
                                          t
                                       
                                    
                                 
                              . We need to guarantee this for all k and thus Iit
                              (τ) ≥ 0 for 
                                 
                                    τ
                                    ∈
                                    {
                                    
                                       μ
                                       
                                          k
                                          t
                                       
                                       s
                                    
                                    +
                                    
                                       p
                                       k
                                    
                                    
                                       X
                                       
                                          k
                                          t
                                       
                                    
                                    |
                                    k
                                    ∈
                                    Γ
                                    
                                       (
                                       i
                                       )
                                    
                                    
                                    and
                                    
                                    
                                       t
                                       1
                                    
                                    ≤
                                    
                                       μ
                                       
                                          k
                                          t
                                       
                                       s
                                    
                                    +
                                    
                                       p
                                       k
                                    
                                    
                                       X
                                       
                                          k
                                          t
                                       
                                    
                                    ≤
                                    
                                       t
                                       2
                                    
                                    }
                                 
                              . Using the same argument as in the case of no production it can be shown that (20) for τ < t
                              1 and τ > t
                              2 are valid and not cutting off solutions with nonnegative inventory. Hence, (20) must hold for 
                                 
                                    τ
                                    ∈
                                    {
                                    
                                       μ
                                       
                                          k
                                          t
                                       
                                       s
                                    
                                    +
                                    
                                       p
                                       k
                                    
                                    
                                       X
                                       
                                          k
                                          t
                                       
                                    
                                    |
                                    k
                                    ∈
                                    Γ
                                    
                                       (
                                       i
                                       )
                                    
                                    }
                                 
                              .□

From Theorem 1 we conclude that replacing (16) and (17) with a set of constraints avoiding negative stock levels at the beginning and end of the production of each item i for each successor k by

                           
                              (21)
                              
                                 
                                    
                                       
                                       
                                       
                                          
                                             
                                                I
                                                
                                                   i
                                                   (
                                                   t
                                                   −
                                                   1
                                                   )
                                                
                                             
                                             ≥
                                             
                                                ∑
                                                
                                                   j
                                                   ∈
                                                   Γ
                                                   (
                                                   i
                                                   )
                                                
                                             
                                             
                                                a
                                                
                                                   i
                                                   j
                                                
                                             
                                             min
                                             
                                                (
                                                
                                                   X
                                                   
                                                      j
                                                      t
                                                   
                                                
                                                ,
                                                
                                                   1
                                                   
                                                      p
                                                      j
                                                   
                                                
                                                
                                                   
                                                      (
                                                      
                                                         μ
                                                         
                                                            i
                                                            t
                                                         
                                                         s
                                                      
                                                      −
                                                      
                                                         μ
                                                         
                                                            j
                                                            t
                                                         
                                                         s
                                                      
                                                      )
                                                   
                                                   +
                                                
                                                )
                                             
                                             
                                             i
                                             ,
                                             t
                                          
                                       
                                    
                                 
                              
                           
                        
                        
                           
                              (22)
                              
                                 
                                    
                                       
                                       
                                       
                                          
                                             
                                                I
                                                
                                                   i
                                                   (
                                                   t
                                                   −
                                                   1
                                                   )
                                                
                                             
                                             +
                                             min
                                             
                                                (
                                                
                                                   X
                                                   
                                                      i
                                                      t
                                                   
                                                
                                                ,
                                                
                                                   1
                                                   
                                                      p
                                                      i
                                                   
                                                
                                                
                                                   
                                                      (
                                                      
                                                         μ
                                                         
                                                            k
                                                            t
                                                         
                                                         s
                                                      
                                                      +
                                                      
                                                         p
                                                         k
                                                      
                                                      
                                                         X
                                                         
                                                            k
                                                            t
                                                         
                                                      
                                                      −
                                                      
                                                         μ
                                                         
                                                            i
                                                            t
                                                         
                                                         s
                                                      
                                                      )
                                                   
                                                   +
                                                
                                                )
                                             
                                          
                                       
                                    
                                    
                                       
                                       
                                       
                                          
                                             
                                             ≥
                                             
                                             
                                                ∑
                                                
                                                   j
                                                   ∈
                                                   Γ
                                                   (
                                                   i
                                                   )
                                                
                                             
                                             
                                                a
                                                
                                                   i
                                                   j
                                                
                                             
                                             min
                                             
                                                (
                                                
                                                   X
                                                   
                                                      j
                                                      t
                                                   
                                                
                                                ,
                                                
                                                   1
                                                   
                                                      p
                                                      j
                                                   
                                                
                                                
                                                   
                                                      (
                                                      
                                                         μ
                                                         
                                                            k
                                                            t
                                                         
                                                         s
                                                      
                                                      +
                                                      
                                                         p
                                                         k
                                                      
                                                      
                                                         X
                                                         
                                                            k
                                                            t
                                                         
                                                      
                                                      −
                                                      
                                                         μ
                                                         
                                                            j
                                                            t
                                                         
                                                         s
                                                      
                                                      )
                                                   
                                                   +
                                                
                                                )
                                             
                                             
                                             i
                                             ,
                                             k
                                             ∈
                                             Γ
                                             
                                                (
                                                i
                                                )
                                             
                                             ,
                                             t
                                          
                                       
                                    
                                 
                              
                           
                        leads to a model that allows immediate use of produced items but maintains a nonnegative in-period inventory.

Hence, the model for the lot-streaming case FL
                         reads:

                           
                              
                                 
                                    ν
                                    
                                       (
                                       
                                          F
                                          L
                                       
                                       )
                                    
                                    =
                                    min
                                    
                                       ∑
                                       
                                          i
                                          =
                                          1
                                       
                                       N
                                    
                                    
                                       ∑
                                       
                                          t
                                          =
                                          1
                                       
                                       T
                                    
                                    
                                       h
                                       
                                          i
                                          t
                                       
                                    
                                    ·
                                    
                                       I
                                       
                                          i
                                          t
                                       
                                    
                                    +
                                    
                                       ∑
                                       
                                          i
                                          =
                                          1
                                       
                                       N
                                    
                                    
                                       ∑
                                       
                                          j
                                          =
                                          1
                                       
                                       N
                                    
                                    
                                       ∑
                                       
                                          t
                                          =
                                          1
                                       
                                       T
                                    
                                    
                                       ∑
                                       
                                          m
                                          =
                                          1
                                       
                                       M
                                    
                                    
                                       c
                                       
                                          i
                                          j
                                       
                                    
                                    ·
                                    
                                       T
                                       
                                          i
                                          j
                                          t
                                          m
                                       
                                    
                                 
                              
                           
                        
                        
                           
                              
                                 
                                    
                                       
                                          
                                             subject
                                             
                                             to
                                             
                                             (
                                             7
                                             )
                                             --
                                             (
                                             14
                                             )
                                             ,
                                             (
                                             21
                                             )
                                             ,
                                             (
                                             22
                                             )
                                          
                                       
                                    
                                 
                              
                           
                        
                        
                           
                              
                                 
                                    
                                       
                                          
                                             
                                                I
                                                
                                                   i
                                                   t
                                                
                                             
                                             ,
                                             
                                                X
                                                
                                                   i
                                                   t
                                                
                                             
                                             ,
                                             
                                                μ
                                                
                                                   i
                                                   t
                                                
                                                s
                                             
                                             ≥
                                             0
                                             ;
                                             
                                                α
                                                
                                                   i
                                                   t
                                                   m
                                                
                                             
                                             ,
                                             
                                                T
                                                
                                                   i
                                                   j
                                                   t
                                                   m
                                                
                                             
                                             ∈
                                             
                                                {
                                                0
                                                ,
                                                1
                                                }
                                             
                                             
                                             i
                                             ,
                                             j
                                             ,
                                             t
                                             ,
                                             m
                                          
                                       
                                    
                                 
                              
                           
                        
                     

This is a nonlinear model that can be easily linearized. We show the underlying linearization of (21) and (22) in Appendix A.

                           Proof
                           
                              Example continued. Considering again the example given in Section 2.2, Fig. 6
                              depicts the optimal solution obtained by the lot-streaming version of the model with total cost of seven. The values of the decision variables that are not 0 are indicated.


Considering the inventory level of item 4 at the end of period 1, the new constraints (21) and (22) read in period 2 as follows.

                                 
                                    
                                       
                                          
                                             
                                             
                                             
                                                
                                                   
                                                      2
                                                      
                                                         I
                                                         41
                                                      
                                                   
                                                   ≥
                                                   
                                                      1
                                                      
                                                         a
                                                         43
                                                      
                                                   
                                                   ·
                                                   min
                                                   
                                                      (
                                                      
                                                         0
                                                         
                                                            X
                                                            32
                                                         
                                                      
                                                      ,
                                                      
                                                         10
                                                         
                                                            1
                                                            
                                                               p
                                                               3
                                                            
                                                         
                                                      
                                                      ·
                                                      
                                                         (
                                                         
                                                            0
                                                            
                                                               μ
                                                               
                                                                  42
                                                               
                                                               s
                                                            
                                                         
                                                         −
                                                         
                                                            0
                                                            
                                                               μ
                                                               
                                                                  32
                                                               
                                                               s
                                                            
                                                         
                                                         )
                                                      
                                                      )
                                                   
                                                
                                             
                                          
                                          
                                             
                                             
                                             
                                                
                                                   
                                                   +
                                                   
                                                   
                                                      1
                                                      
                                                         a
                                                         42
                                                      
                                                   
                                                   ·
                                                   min
                                                   
                                                      (
                                                      
                                                         2
                                                         
                                                            X
                                                            22
                                                         
                                                      
                                                      ,
                                                      
                                                         
                                                            2.5
                                                         
                                                         
                                                            1
                                                            
                                                               p
                                                               2
                                                            
                                                         
                                                      
                                                      ·
                                                      
                                                         (
                                                         
                                                            0
                                                            
                                                               μ
                                                               
                                                                  42
                                                               
                                                               s
                                                            
                                                         
                                                         −
                                                         
                                                            0
                                                            
                                                               μ
                                                               
                                                                  22
                                                               
                                                               s
                                                            
                                                         
                                                         )
                                                      
                                                      )
                                                   
                                                   =
                                                   0
                                                
                                             
                                          
                                          
                                             
                                             
                                             
                                                
                                                   
                                                      2
                                                      
                                                         I
                                                         41
                                                      
                                                   
                                                   +
                                                   min
                                                   
                                                      (
                                                      
                                                         0
                                                         
                                                            X
                                                            42
                                                         
                                                      
                                                      ,
                                                      
                                                         10
                                                         
                                                            1
                                                            
                                                               p
                                                               4
                                                            
                                                         
                                                      
                                                      ·
                                                      
                                                         (
                                                         
                                                            0
                                                            
                                                               μ
                                                               
                                                                  22
                                                               
                                                               s
                                                            
                                                         
                                                         +
                                                         
                                                            
                                                               0.8
                                                            
                                                            
                                                               
                                                                  p
                                                                  2
                                                               
                                                               ·
                                                               
                                                                  X
                                                                  22
                                                               
                                                            
                                                         
                                                         −
                                                         
                                                            0
                                                            
                                                               μ
                                                               
                                                                  42
                                                               
                                                               s
                                                            
                                                         
                                                         )
                                                      
                                                      )
                                                   
                                                   =
                                                   2
                                                
                                             
                                          
                                          
                                             
                                             
                                             
                                                
                                                   
                                                   ≥
                                                   
                                                   
                                                      1
                                                      
                                                         a
                                                         43
                                                      
                                                   
                                                   ·
                                                   min
                                                   
                                                      (
                                                      
                                                         0
                                                         
                                                            X
                                                            32
                                                         
                                                      
                                                      ,
                                                      
                                                         10
                                                         
                                                            1
                                                            
                                                               p
                                                               3
                                                            
                                                         
                                                      
                                                      ·
                                                      
                                                         (
                                                         
                                                            0
                                                            
                                                               μ
                                                               
                                                                  22
                                                               
                                                               s
                                                            
                                                         
                                                         +
                                                         
                                                            
                                                               0.8
                                                            
                                                            
                                                               
                                                                  p
                                                                  2
                                                               
                                                               ·
                                                               
                                                                  X
                                                                  22
                                                               
                                                            
                                                         
                                                         −
                                                         
                                                            0
                                                            
                                                               μ
                                                               
                                                                  32
                                                               
                                                               s
                                                            
                                                         
                                                         )
                                                      
                                                      )
                                                   
                                                
                                             
                                          
                                          
                                             
                                             
                                             
                                                
                                                   
                                                   +
                                                   
                                                   
                                                      1
                                                      
                                                         a
                                                         42
                                                      
                                                   
                                                   ·
                                                   min
                                                   
                                                      (
                                                      
                                                         2
                                                         
                                                            X
                                                            22
                                                         
                                                      
                                                      ,
                                                      
                                                         
                                                            2.5
                                                         
                                                         
                                                            1
                                                            
                                                               p
                                                               2
                                                            
                                                         
                                                      
                                                      ·
                                                      
                                                         (
                                                         
                                                            0
                                                            
                                                               μ
                                                               
                                                                  22
                                                               
                                                               s
                                                            
                                                         
                                                         +
                                                         
                                                            
                                                               0.8
                                                            
                                                            
                                                               
                                                                  p
                                                                  2
                                                               
                                                               ·
                                                               
                                                                  X
                                                                  22
                                                               
                                                            
                                                         
                                                         −
                                                         
                                                            0
                                                            
                                                               μ
                                                               
                                                                  22
                                                               
                                                               s
                                                            
                                                         
                                                         )
                                                      
                                                      )
                                                   
                                                   =
                                                   2
                                                
                                             
                                          
                                       
                                    
                                 
                              Hence, (22) ensures that there is enough inventory for item 4 at the beginning of period 2.□

We prove in the following theorem that FB
                         is a special case of FL
                         and, as such, the optimal value of FL
                         is at least as good as FB
                        ’s.

                           Theorem 2
                           
                              We have v(FB
                              ) ≥ v(FL
                              ).

We demonstrate the statement by showing that adding constraints (16) and (17) to FL
                               constraints (21) and (22) become redundant and can be dropped.

Consider 
                                 
                                    S
                                    
                                       (
                                       i
                                       )
                                    
                                    =
                                    {
                                    j
                                    ∈
                                    Γ
                                    
                                       (
                                       i
                                       )
                                    
                                    :
                                    
                                       μ
                                       
                                          i
                                          t
                                       
                                       s
                                    
                                    ≥
                                    
                                       μ
                                       
                                          j
                                          t
                                       
                                       s
                                    
                                    }
                                    .
                                 
                               Constraints (21) are then equivalent to 
                                 
                                    
                                       I
                                       
                                          i
                                          (
                                          t
                                          −
                                          1
                                          )
                                       
                                    
                                    ≥
                                    
                                       ∑
                                       
                                          j
                                          ∈
                                          S
                                          (
                                          i
                                          )
                                       
                                    
                                    
                                       a
                                       
                                          i
                                          j
                                       
                                    
                                    min
                                    
                                       (
                                       
                                          X
                                          
                                             j
                                             t
                                          
                                       
                                       ,
                                       
                                          1
                                          
                                             p
                                             j
                                          
                                       
                                       
                                          (
                                          
                                             μ
                                             
                                                i
                                                t
                                             
                                             s
                                          
                                          −
                                          
                                             μ
                                             
                                                j
                                                t
                                             
                                             s
                                          
                                          )
                                       
                                       )
                                    
                                 
                              . If j ∈ S(i), then (15) imposes Wijt
                               = 0 and 
                                 
                                    
                                       
                                          X
                                          ^
                                       
                                       
                                          i
                                          j
                                          t
                                       
                                    
                                    ≥
                                    
                                       X
                                       
                                          j
                                          t
                                       
                                    
                                 
                              . Using (16) and (17), we obtain

                                 
                                    
                                       
                                          
                                             
                                                
                                                   I
                                                   
                                                      i
                                                      (
                                                      t
                                                      −
                                                      1
                                                      )
                                                   
                                                
                                             
                                             
                                                ≥
                                             
                                             
                                                
                                                   
                                                      ∑
                                                      
                                                         j
                                                         ∈
                                                         Γ
                                                         (
                                                         i
                                                         )
                                                      
                                                   
                                                   
                                                      a
                                                      
                                                         i
                                                         j
                                                      
                                                   
                                                   
                                                      
                                                         X
                                                         ^
                                                      
                                                      
                                                         i
                                                         j
                                                         t
                                                      
                                                   
                                                   ≥
                                                   
                                                      ∑
                                                      
                                                         j
                                                         ∈
                                                         S
                                                         (
                                                         i
                                                         )
                                                      
                                                   
                                                   
                                                      a
                                                      
                                                         i
                                                         j
                                                      
                                                   
                                                   ·
                                                   
                                                      X
                                                      
                                                         j
                                                         t
                                                      
                                                   
                                                
                                             
                                          
                                          
                                             
                                             
                                                ≥
                                             
                                             
                                                
                                                   
                                                      ∑
                                                      
                                                         j
                                                         ∈
                                                         S
                                                         (
                                                         i
                                                         )
                                                      
                                                   
                                                   
                                                      a
                                                      
                                                         i
                                                         j
                                                      
                                                   
                                                   min
                                                   
                                                      (
                                                      
                                                         X
                                                         
                                                            j
                                                            t
                                                         
                                                      
                                                      ,
                                                      
                                                         1
                                                         
                                                            p
                                                            j
                                                         
                                                      
                                                      
                                                         (
                                                         
                                                            μ
                                                            
                                                               i
                                                               t
                                                            
                                                            s
                                                         
                                                         −
                                                         
                                                            μ
                                                            
                                                               j
                                                               t
                                                            
                                                            s
                                                         
                                                         )
                                                      
                                                      )
                                                   
                                                   
                                                   i
                                                   ,
                                                   t
                                                   ,
                                                
                                             
                                          
                                       
                                    
                                 
                              making constraints (21) redundant.

Let Q(i, k), k ∈ Γ(i) denote 
                                 
                                    Q
                                    
                                       (
                                       i
                                       ,
                                       k
                                       )
                                    
                                    =
                                    {
                                    j
                                    :
                                    j
                                    ∈
                                    Γ
                                    
                                       (
                                       i
                                       )
                                    
                                    
                                    and
                                    
                                    
                                       μ
                                       
                                          k
                                          t
                                       
                                       s
                                    
                                    +
                                    
                                       p
                                       k
                                    
                                    
                                       X
                                       
                                          k
                                          t
                                       
                                    
                                    ≥
                                    
                                       μ
                                       
                                          j
                                          t
                                       
                                       s
                                    
                                    }
                                    .
                                 
                               The right hand-side of (22) can then be simplified to

                                 
                                    
                                       
                                          
                                             ∑
                                             
                                                j
                                                ∈
                                                Q
                                                
                                                   (
                                                   i
                                                   ,
                                                   k
                                                   )
                                                
                                             
                                          
                                          
                                             a
                                             
                                                i
                                                j
                                             
                                          
                                          min
                                          
                                             (
                                             
                                                X
                                                
                                                   j
                                                   t
                                                
                                             
                                             ,
                                             
                                                1
                                                
                                                   p
                                                   j
                                                
                                             
                                             
                                                (
                                                
                                                   μ
                                                   
                                                      k
                                                      t
                                                   
                                                   s
                                                
                                                +
                                                
                                                   p
                                                   k
                                                
                                                
                                                   X
                                                   
                                                      k
                                                      t
                                                   
                                                
                                                −
                                                
                                                   μ
                                                   
                                                      j
                                                      t
                                                   
                                                   s
                                                
                                                )
                                             
                                             )
                                          
                                          .
                                       
                                    
                                 
                              Let us now distinguish two cases: 
                                 
                                    
                                       μ
                                       
                                          k
                                          t
                                       
                                       s
                                    
                                    +
                                    
                                       p
                                       k
                                    
                                    
                                       X
                                       
                                          k
                                          t
                                       
                                    
                                    ≤
                                    
                                       μ
                                       
                                          i
                                          t
                                       
                                       s
                                    
                                 
                               or 
                                 
                                    
                                       μ
                                       
                                          k
                                          t
                                       
                                       s
                                    
                                    +
                                    
                                       p
                                       k
                                    
                                    
                                       X
                                       
                                          k
                                          t
                                       
                                    
                                    >
                                    
                                       μ
                                       
                                          i
                                          t
                                       
                                       s
                                    
                                 
                              .

We start by 
                                 
                                    
                                       μ
                                       
                                          k
                                          t
                                       
                                       s
                                    
                                    +
                                    
                                       p
                                       k
                                    
                                    
                                       X
                                       
                                          k
                                          t
                                       
                                    
                                    ≤
                                    
                                       μ
                                       
                                          i
                                          t
                                       
                                       s
                                    
                                 
                              . Since 
                                 
                                    
                                       μ
                                       
                                          k
                                          t
                                       
                                       s
                                    
                                    ≤
                                    
                                       μ
                                       
                                          i
                                          t
                                       
                                       s
                                    
                                    +
                                    
                                       p
                                       i
                                    
                                    ·
                                    
                                       X
                                       
                                          i
                                          t
                                       
                                    
                                    ,
                                 
                               from (15) clearly Wikt
                               = 0. Moreover, Wijt
                               = 0 for every j in Q(i, k), which implies 
                                 
                                    
                                       
                                          X
                                          ^
                                       
                                       
                                          i
                                          j
                                          t
                                       
                                    
                                    ≥
                                    
                                       X
                                       
                                          j
                                          t
                                       
                                    
                                 
                              . Thus,

                                 
                                    
                                       
                                          
                                             
                                             
                                             
                                                
                                                   
                                                      I
                                                      
                                                         i
                                                         (
                                                         t
                                                         −
                                                         1
                                                         )
                                                      
                                                   
                                                   ≥
                                                   
                                                      ∑
                                                      
                                                         j
                                                         ∈
                                                         Q
                                                         
                                                            (
                                                            i
                                                            ,
                                                            k
                                                            )
                                                         
                                                      
                                                   
                                                   
                                                      a
                                                      
                                                         i
                                                         j
                                                      
                                                   
                                                   ·
                                                   
                                                      X
                                                      
                                                         j
                                                         t
                                                      
                                                   
                                                   ≥
                                                   
                                                      ∑
                                                      
                                                         j
                                                         ∈
                                                         Q
                                                         
                                                            (
                                                            i
                                                            ,
                                                            k
                                                            )
                                                         
                                                      
                                                   
                                                   
                                                      a
                                                      
                                                         i
                                                         j
                                                      
                                                   
                                                   min
                                                   
                                                      (
                                                      
                                                         X
                                                         
                                                            j
                                                            t
                                                         
                                                      
                                                      ,
                                                      
                                                         1
                                                         
                                                            p
                                                            j
                                                         
                                                      
                                                      
                                                         (
                                                         
                                                            μ
                                                            
                                                               k
                                                               t
                                                            
                                                            s
                                                         
                                                         +
                                                         
                                                            p
                                                            k
                                                         
                                                         
                                                            X
                                                            
                                                               k
                                                               t
                                                            
                                                         
                                                         −
                                                         
                                                            μ
                                                            
                                                               j
                                                               t
                                                            
                                                            s
                                                         
                                                         )
                                                      
                                                      )
                                                   
                                                
                                             
                                          
                                          
                                             
                                             
                                             
                                                
                                                   
                                                   i
                                                   ,
                                                   k
                                                   ∈
                                                   Γ
                                                   (
                                                   i
                                                   )
                                                   ,
                                                   t
                                                   .
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           

Let now 
                                 
                                    
                                       μ
                                       
                                          k
                                          t
                                       
                                       s
                                    
                                    +
                                    
                                       p
                                       k
                                    
                                    
                                       X
                                       
                                          k
                                          t
                                       
                                    
                                    >
                                    
                                       μ
                                       
                                          i
                                          t
                                       
                                       s
                                    
                                 
                              . We have to further consider two different scenarios.

If 
                                 
                                    
                                       μ
                                       
                                          k
                                          t
                                       
                                       s
                                    
                                    +
                                    
                                       p
                                       k
                                    
                                    
                                       X
                                       
                                          k
                                          t
                                       
                                    
                                    <
                                    
                                       μ
                                       
                                          i
                                          t
                                       
                                       s
                                    
                                    +
                                    
                                       p
                                       i
                                    
                                    
                                       X
                                       
                                          i
                                          t
                                       
                                    
                                    ,
                                 
                               then similarly to the above case, it follows that Wikt
                               = 0 and Wijk
                               = 0 for every j in Q(i, k). In terms it yields

                                 
                                    
                                       
                                          
                                             
                                             
                                             
                                                
                                                   
                                                      I
                                                      
                                                         i
                                                         (
                                                         t
                                                         −
                                                         1
                                                         )
                                                      
                                                   
                                                   +
                                                   min
                                                   
                                                      (
                                                      
                                                         X
                                                         
                                                            i
                                                            t
                                                         
                                                      
                                                      ,
                                                      
                                                         1
                                                         
                                                            p
                                                            i
                                                         
                                                      
                                                      
                                                         (
                                                         
                                                            μ
                                                            
                                                               k
                                                               t
                                                            
                                                            s
                                                         
                                                         +
                                                         
                                                            p
                                                            k
                                                         
                                                         
                                                            X
                                                            
                                                               k
                                                               t
                                                            
                                                         
                                                         −
                                                         
                                                            μ
                                                            
                                                               i
                                                               t
                                                            
                                                            s
                                                         
                                                         )
                                                      
                                                      )
                                                   
                                                   ≥
                                                   
                                                      I
                                                      
                                                         i
                                                         (
                                                         t
                                                         −
                                                         1
                                                         )
                                                      
                                                   
                                                
                                             
                                          
                                          
                                             
                                             
                                             
                                                
                                                   
                                                   ≥
                                                   
                                                   
                                                      ∑
                                                      
                                                         j
                                                         ∈
                                                         Q
                                                         
                                                            (
                                                            i
                                                            ,
                                                            k
                                                            )
                                                         
                                                      
                                                   
                                                   
                                                      a
                                                      
                                                         i
                                                         j
                                                      
                                                   
                                                   ·
                                                   
                                                      X
                                                      
                                                         j
                                                         t
                                                      
                                                   
                                                   ≥
                                                   
                                                      ∑
                                                      
                                                         j
                                                         ∈
                                                         Q
                                                         
                                                            (
                                                            i
                                                            ,
                                                            k
                                                            )
                                                         
                                                      
                                                   
                                                   
                                                      a
                                                      
                                                         i
                                                         j
                                                      
                                                   
                                                   min
                                                   
                                                      (
                                                      
                                                         X
                                                         
                                                            j
                                                            t
                                                         
                                                      
                                                      ,
                                                      
                                                         1
                                                         
                                                            p
                                                            j
                                                         
                                                      
                                                      
                                                         (
                                                         
                                                            μ
                                                            
                                                               k
                                                               t
                                                            
                                                            s
                                                         
                                                         +
                                                         
                                                            p
                                                            k
                                                         
                                                         
                                                            X
                                                            
                                                               k
                                                               t
                                                            
                                                         
                                                         −
                                                         
                                                            μ
                                                            
                                                               j
                                                               t
                                                            
                                                            s
                                                         
                                                         )
                                                      
                                                      )
                                                   
                                                   ,
                                                
                                             
                                          
                                       
                                    
                                 
                              making (22) redundant.

Finally let 
                                 
                                    
                                       μ
                                       
                                          k
                                          t
                                       
                                       s
                                    
                                    +
                                    
                                       p
                                       k
                                    
                                    
                                       X
                                       
                                          k
                                          t
                                       
                                    
                                    ≥
                                    
                                       μ
                                       
                                          i
                                          t
                                       
                                       s
                                    
                                    +
                                    
                                       p
                                       i
                                    
                                    
                                       X
                                       
                                          i
                                          t
                                       
                                    
                                 
                              . In this case (22) reads

                                 
                                    
                                       
                                          
                                             
                                             
                                             
                                                
                                                   
                                                      I
                                                      
                                                         i
                                                         (
                                                         t
                                                         −
                                                         1
                                                         )
                                                      
                                                   
                                                   +
                                                   min
                                                   
                                                      (
                                                      
                                                         X
                                                         
                                                            i
                                                            t
                                                         
                                                      
                                                      ,
                                                      
                                                         1
                                                         
                                                            p
                                                            i
                                                         
                                                      
                                                      
                                                         (
                                                         
                                                            μ
                                                            
                                                               k
                                                               t
                                                            
                                                            s
                                                         
                                                         +
                                                         
                                                            p
                                                            k
                                                         
                                                         
                                                            X
                                                            
                                                               k
                                                               t
                                                            
                                                         
                                                         −
                                                         
                                                            μ
                                                            
                                                               i
                                                               t
                                                            
                                                            s
                                                         
                                                         )
                                                      
                                                      )
                                                   
                                                   =
                                                   
                                                      I
                                                      
                                                         i
                                                         (
                                                         t
                                                         −
                                                         1
                                                         )
                                                      
                                                   
                                                   +
                                                   
                                                      X
                                                      
                                                         i
                                                         t
                                                      
                                                   
                                                
                                             
                                          
                                          
                                             
                                             
                                             
                                                
                                                   
                                                   ≥
                                                   
                                                   
                                                      ∑
                                                      
                                                         j
                                                         ∈
                                                         Q
                                                         
                                                            (
                                                            i
                                                            ,
                                                            k
                                                            )
                                                         
                                                      
                                                   
                                                   
                                                      a
                                                      
                                                         i
                                                         j
                                                      
                                                   
                                                   min
                                                   
                                                      (
                                                      
                                                         X
                                                         
                                                            j
                                                            t
                                                         
                                                      
                                                      ,
                                                      
                                                         1
                                                         
                                                            p
                                                            j
                                                         
                                                      
                                                      
                                                         (
                                                         
                                                            μ
                                                            
                                                               k
                                                               t
                                                            
                                                            s
                                                         
                                                         +
                                                         
                                                            p
                                                            k
                                                         
                                                         
                                                            X
                                                            
                                                               k
                                                               t
                                                            
                                                         
                                                         −
                                                         
                                                            μ
                                                            
                                                               j
                                                               t
                                                            
                                                            s
                                                         
                                                         )
                                                      
                                                      )
                                                   
                                                   .
                                                
                                             
                                          
                                       
                                    
                                 
                              It is easy to see that this condition is dominated by I
                              
                                 i(t − 1) + Xit
                               ≥ ∑
                                 j ∈ Γ(i)
                              aij
                               · Xjt
                              , which is derived from (7) given that Iit
                               and Eit
                               are non-negative.□

An interesting extension is a combination of the batching and lot-streaming cases, i.e. the raw materials might be delivered continuously to the production process of item i, but the newly produced items are only available if the whole batch is finished. In such a case we have to ensure that the whole production of successors can be supplied from stock of item i until the production is finished. To that end, we replace (22) by

                           
                              (23)
                              
                                 
                                    
                                       I
                                       
                                          i
                                          (
                                          t
                                          −
                                          1
                                          )
                                       
                                    
                                    ≥
                                    
                                       ∑
                                       
                                          j
                                          ∈
                                          Γ
                                          (
                                          i
                                          )
                                       
                                    
                                    
                                       a
                                       
                                          i
                                          j
                                       
                                    
                                    min
                                    
                                       (
                                       
                                          X
                                          
                                             j
                                             t
                                          
                                       
                                       ,
                                       
                                          p
                                          j
                                       
                                       
                                          
                                             (
                                             
                                                μ
                                                
                                                   i
                                                   t
                                                
                                                s
                                             
                                             +
                                             
                                                p
                                                i
                                             
                                             
                                                X
                                                
                                                   i
                                                   t
                                                
                                             
                                             −
                                             
                                                μ
                                                
                                                   j
                                                   t
                                                
                                                s
                                             
                                             )
                                          
                                          +
                                       
                                       )
                                    
                                    
                                    i
                                    ,
                                    t
                                    .
                                 
                              
                           
                        
                     

In (23) the start time 
                           
                              μ
                              
                                 i
                                 t
                              
                              s
                           
                         of the production of item i was replaced by the finish time 
                           
                              
                                 μ
                                 
                                    i
                                    t
                                 
                                 s
                              
                              +
                              
                                 p
                                 i
                              
                              
                                 X
                                 
                                    i
                                    t
                                 
                              
                           
                        .

Both versions, the batching and lot-streaming cases, represent extreme situations, especially the continuous production case where it is possible to produce subsequent items in the BOM at the same time. Nevertheless, the batching scenario is more often found in practice. If we want to model a situation where it is not necessary to wait for the whole batch to be finished before items can be retrieved and used for further production steps, we might introduce a minimum production lead time τi
                         and substitute in constraints (21) and (22) the starting time of item i with the term 
                           
                              
                                 μ
                                 
                                    i
                                    t
                                 
                                 s
                              
                              +
                              
                                 τ
                                 i
                              
                           
                        .

@&#LIMITATIONS@&#

One assumption of big-bucket models is that at most one batch of each product is allowed per time period. This assumption still holds for the presented models. Let us now consider the example from Section 2.2 with modified demand for item 2, d
                        21 = 2 and d
                        22 = 0. The only feasible solution to this instance is shown in Fig. 7
                        . Such a solution enforces two batches of item 4 in period 1 on machine C, which is not a feasible solution to our model. Belvaux and Wolsey (2001) develop a lot-sizing model, which accounts for multiple setups of the same item. In their approach the production sequence is not unique anymore. Adapting it to our case would require to compute starting times for each batch and thus blowing up the model size. Fandel and Stammen-Hegene (2006) develop a general lot-sizing and scheduling approach for that problem but they end up with a highly complex non-linear model. Experiences with such model formulations in similar settings show that the computational tractability of these kind of models is worse (see e.g. Almeder and Almada-Lobo, 2011).


In this section we analyze the solution quality obtained by the traditional MLCLSP model and compare it with the new extended model formulation. All models were implemented in C++ using CPLEX 12.4 with Concert technology on an Intel Xenon E5540 CPU (using a single thread) and 4 GB of random access memory. Furthermore, we used the well-known (l, S) valid inequalities adapted by Clark and Armentano (1995) to the multi-level case. We add them dynamically within the branch-and-cut framework of CPLEX.

Considering that the proposed model incorporates more details than MLCLSP, we first evaluate if solutions derived from the traditional MLCLSP model would also be optimal or feasible for our approach. That means we are testing if the lot sizes obtained by MLCLSP (without scheduling) can be scheduled within the given capacity. For this purpose we considered four classes of instances proposed by Tempelmeier and Derstroff (1996). Classes A and B are small instances with 10 items produced on three machines and a planning horizon of four periods. Class A instances consider setup cost but no setup times, whereas class B instances include also setup times. These classes are small enough that MLCLSP with zero lead time and no setup carryover can be solved easily with CPLEX within a second. Classes C and D are larger instances (40 items, 6 machines, 16 periods). For most of these instances optimal solutions of MLCLSP are unknown. We take the best known solutions for these classes obtained by a heuristic method proposed in Almeder (2010). All classes contain instances with a general and assembly product structure, with different demand profiles and different levels of capacity utilization.

Classical MLCLSP does not consider setup carryover. To avoid setup carryover in our formulation we introduce additional items (one for each machine) with no demand and force that setup carryovers are only possible for these additional items. The setup times and costs into these items are set to zero. The production quantities obtained by solving MLCLSP are fixed in our formulation (6)–(18) such that we only determine the production sequences, and start and finish times. We let CPLEX run for at most 600 seconds and classify the outcomes in three different categories:

                           
                              1.
                              
                                 Infeasible: CPLEX reports that the problem is infeasible, i.e. it is not possible to find a capacity feasible solution with the given production amount respecting synchronization conditions,


                                 Feasible: CPLEX is able to find a capacity feasible solution with the given production quantities, which considers synchronization,


                                 Unknown: CPLEX is neither able to generate a feasible solution, nor to prove infeasibility.


                        Table 3
                        shows the results of these tests. The values in brackets correspond to the number of tested solutions for each of the classes of test instances. We clearly observe that the vast majority of the solutions are infeasible. This further solidifies the need of our work. Since the batching constraint is more restrictive, fewer solutions are feasible under this assumption. But even without considering batching, which implies that predecessor and successor can be produced simultaneously, more than 85 percent of the instances are infeasible. It seems that the zero lead-time assumption leads to solutions that cannot be implemented in practice. On the other hand, having only a few periods, a one-period lead time is also not meaningful.

In Table 4
                        we aggregate the results of the different classes according to various criteria. The value in brackets corresponds to the number of tested solutions in each group. Differentiating by the product structure (general and assembly structure) and by the way items are assigned to machines (cyclic—the same machine is used for items on different levels; non-cyclic—only items at the same level or adjacent levels in the BOM are assigned to the same machines), we observe that most of the feasible solutions are obtained for problems with a general product structure and a non-cyclic machine-item relation (for the lot-streaming assumption). Furthermore, it is obvious that capacity-tight problems are more likely to be infeasible, because free capacity usually means more flexibility for the scheduling problem. The capacity utilization is defined by the total capacity requirement for production and setup for each machine divided by the total available capacity of that machine. Also, the setup cost level has an impact on the feasibility of the solution. High setup costs tend to generate solutions with large batches, which are more difficult to schedule than smaller batches.

A work-around which is often proposed to avoid infeasible plans to reserve some extra capacity for the scheduling step. So MLCLSP is first applied to a problem with reduced capacity hoping that afterward lots can be scheduled such that capacity restrictions are not violated.

In order to investigate this approach we take again the solutions obtained by the classical MLCLSP model and try to solve the scheduling problem while increasing the capacity per period by 10 percent, 30 percent, and 50 percent. Table 5
                        reports the percentage of infeasible plans in the different groups. Percentages are given in ranges because a run time limit of 600 seconds was applied. For some of the problems no feasible solution was found within this time limit, as well as no proof of infeasibility could be obtained. But already the lower bounds on the number of infeasible instances are sufficient to spot the problem. It shows clearly that for the case of batching even if the capacity is increased by 50 percent most of the MLCLSP solutions are infeasible even if the original problem had only a theoretical capacity utilization of 50 percent. For the lot-streaming case the results are better but still more than 20 percent of the production plans are infeasible when the capacity is increased by 50 percent. Similar to the previous results a cyclic machine assignment and low capacity utilization lead to less infeasible plans. Fig. 8
                        shows the share of classical MLCLSP solutions which cannot be scheduled for different levels of capacity increase.


In addition to classical MLCLSP the proposed model considers setup carryover. We have applied the full model with synchronization to the test classes A and B in order to gain some insights about the computational behavior of the model. The results are compared to the solution of classical MLCLSP with setup carryover. The solution of that model is a lower bound for the solution of model (6)—(18).


                        Table 6
                        shows the results obtained by CPLEX after 600 seconds run time. The columns report the number of solutions solved to optimality, the number of feasible solutions, the number of infeasible solutions, and the number of solutions with an unknown status, i.e. we were neither able to find a feasible solution, nor could we prove infeasibility. We also report the average gap reported by CPLEX for all feasible solutions. The last column shows the average increase of the total costs of an optimal solution compared with the solution of classical MLCLSP with setup carryover but no synchronization.

The most important result of these tests is shown in the last column. It represents the additional cost of synchronization compared with classical MLCLSP, or, in other words, the underestimation of costs by MLCLSP compared to a more realistic and detailed model formulation.

A second outcome of these experiments is that there are quite a few instances with unknown status. Also the average gap for feasible solutions is still considerable which is due to the complexity of the new model formulation. Hence, future research should concentrate on better formulations and fast solution algorithms for this problem. Nevertheless, one main focus of this paper is to show the potential of integrated scheduling decisions within MLCLSP.

One way to overcome the feasibility problem of MLCLSP is to consider a minimum lead time of one period. As aforementioned this lead time may cause a substantial increase of inventory. Tempelmeier and Buschkühl (2009) used an extension of the class B test instances for MLCLSP with lead time and setup carryover. In order to guarantee feasibility they added two additional periods at the beginning with no external demand (in total now six periods). Since the problems have a three level product structure it is possible to satisfy an end-item demand in the third period. We will denote the new class of instances as B6.

We solve the test instances using classical MLCLSP without synchronization, but with one period lead time (as, for example, described by Tempelmeier and Buschkühl, 2009), as well as using our new model formulation with synchronization. We apply a 600 second run time limit to CPLEX. Table 7
                        compares the new solutions obtained by using the synchronization feature. The columns show the number of solutions solved to optimality, the number of feasible solutions, the number of instances where no solution has been obtained, the number of improved solutions and the average cost improvement (improvement of the upper bound) of the synchronization model compared to MLCLSP with lead time.

For the batching case we can solve 151 instances to optimality, for 448 instances we find a feasible solution and only for one instance we are not able to compute a feasible solution within the specified run time. For the lot-streaming case less instances are solved to optimality. But for all other instances we obtain feasible solutions.

The column labeled UB impr. denotes the average improvement of the objective function of the best solution found (optimal or feasible) compared to the optimal solution of MLCLSP with lead time. Considering lead time in a big-bucket model leads to a clear overestimate of the optimal costs of at least 30.6 percent for batching and 39.4 percent for lot-streaming due to the increased inventory levels carried from one-period to the next just to maintain the feasibility of the solution. We note that for the instances with low capacity utilization and high setup cost, the cost overestimation by the MLCLSP solution with one period lead time is higher than for the other cases.

@&#CONCLUSIONS@&#

Our extensive computational study clearly indicates that the solutions obtained by MLCLSP are either infeasible or lead to excessive work-in-process (from 15 percent to 60 percent increase in overall cost). The need for synchronization is thus clearly established. This work is the first step in such a direction to develop a synchronization mechanism in a big-bucket lot-sizing framework. We present here two extensions of MLCLSP representing the two extreme cases of batching (i.e. a successor item can only be produced if the full batches of the predecessor items are finished) and lot-streaming (i.e. the successor item can be produced simultaneously with its predecessor items as long as it uses a different resource). It is straightforward to introduce any possible lead time in between these two extremes if technical restrictions are demanding it.

While commercial solvers are capable of solving small to mid size instances and many larger instances, large-scale cases need further investigations. Future work should be devoted to develop tighter model formulations and MIP-based heuristic solution approaches.

Supplementary material associated with this article can be found, in the online version, at 10.1016/j.ejor.2014.09.030.


                     
                        
                           
                        
                     
                  

@&#REFERENCES@&#

