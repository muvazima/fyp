@&#MAIN-TITLE@&#Learning gaze biases with head motion for head pose-free gaze estimation

@&#HIGHLIGHTS@&#


               
               
                  
                     
                        
                           
                           Appearance-based gaze estimation with head motion is decomposed into subproblems.


                        
                        
                           
                           Subproblems are solved by compensating for two types of estimation biases.


                        
                        
                           
                           The compensation method only requires a 5-second video for training.


                        
                        
                           
                           Eye images for different head poses are aligned via rectification and optimization.


                        
                        
                           
                           We achieve a gaze estimation accuracy of 3° with free head motion.


                        
                     
                  
               
            

@&#KEYPHRASES@&#

Gaze estimation

Free head motion

Head pose compensation

Appearance-based approach

@&#ABSTRACT@&#


               Graphical abstract
               
                  
                     
                        
                           
                        
                     
                  
               
            

@&#INTRODUCTION@&#

Human gaze plays an essential role in conveying human visual attention, desire, feeling, intention, and so on [1]. Therefore, research on human gaze estimation has been an important topic since decades ago [2] and has attracted much attention in recent years. There are already systems in the market that have been used in many applications, such as human–computer interfaces, cognitive study, market research, and driver training. However, these existing systems usually require expensive devices, which stop them from being widely used by ordinary users in their everyday lives.

With the fast development of computer vision technology, it seems possible that human gaze direction can be estimated by only using captured eye images without requiring too much additional hardware. This will greatly enhance the applicability of gaze estimation technology. According to recent surveys [3,4], existing computer vision-based methods can be roughly divided into two categories: model-based methods and appearance-based methods. Methods in the first category assume 3D or 2D eyeball models to estimate gaze directions, while they still need some additional devices such as infrared lights and cameras. Therefore, they are more suitable for use in a controlled environment such as in the laboratory. Appearance-based methods have the advantage of using only a single common camera, and thus, they attract increasing attention.

In this paper, we focus on the appearance-based methods and solve the major difficulty in allowing free head motion. This problem is difficult because head motion changes eye appearance greatly, and therefore, gaze estimation with changed eye appearances will be inaccurate. A straightforward way to solve this problem is to store all the eye appearances for every individual head pose in the system. However, because head motion has 6 degrees of freedom, it becomes impractical to directly deal with all possible eye appearances due to head motion.

The key idea of this paper is to decompose the originally difficult problem into simple subproblems and solve them efficiently. In particular, instead of considering gaze estimation for arbitrary head poses, we first apply gaze estimation by assuming a fixed head pose, and then compensate for the estimation biases caused by the head pose difference. The compensation comprises two stages, namely, eye appearance distortion compensation and geometric compensation. We propose methods to complete these compensations and show that the gaze estimation can be done accurately for arbitrary head poses.

The primary contributions of this work are:
                        
                           (1)
                           A gaze estimation approach that decomposes the difficult free head motion problem into much easier subproblems is proposed.

Subproblems are solved with our proposed compensation methods, which correct gaze estimation biases due to both eye appearance distortion and geometric factors.

The training cost for compensating for head motion is low. It only requires capturing a short video clip of user free head motion for a duration of 5s.

Eye images captured under different head poses are robustly aligned via image rectification and iterative optimization.

Overall, compared with existing appearance-based methods, our method does not use any other devices, while it allows for head motion by only requiring an additional calibration step to capture a short video clip. If compared with existing model-based methods that also allow for head motion, our method only uses a common camera with known location and intrinsic parameters, while most of the others use multiple cameras/lights and therefore require more complicated camera/geometric calibrations.

@&#RELATED WORKS@&#

Computer vision-based human gaze estimation has been undergoing rapid development. According to recent surveys [3,4], existing computer vision-based methods can be roughly divided into two categories: model-based methods and appearance-based methods. Methods belonging to the former category extract and use very small eye features in the captured eye images, such as the reflection points in the corneal surface [5–9], pupil center [10,11], and iris contour [12]. These features are used to fit a 2D or 3D eyeball model to geometrically calculate the gaze direction regardless of the head pose. For instance, Beymer and Flickner [13] proposed generating and detecting corneal reflections via zoom-in cameras and infrared LEDs equipped on stereo pan-tilt units. Additionally, two additional wide range stereo cameras are used for eye position tracking. Brolly and Mulligan [14] proposed a similar method for accurately extracting and using corneal reflection points, as well as did Nagamatsu et al. [15] and Zhu and Ji [7]. To reduce number of cameras, Villanueva and Cabeza [8] suggested using more infrared LEDs to achieve accurate geometric calculation. Yoo and Chung [5] proposed a novel method based on the cross-ratio that computes the 3-D relationship of the eyeball, cameras, and screen. Kang et al. [16] further improved the cross-ratio method by taking into account the individual eyeball parameter differences.

Although model-based methods show advantages in handling head motion and so on, they also have limitations. First, it is not easy to extract small eye features in the eye. Therefore, high resolution and even infrared imaging is always needed. Second, many of the previous works further require special cameras and mechanical units [13,14,17] to allow for head motion, which are not applicable for ordinary users in their everyday lives.

On the contrary, appearance-based methods have the advantage of requiring only a single camera that works under natural illumination. They only use images with common or even low resolutions. They typically regard a whole eye image as a high-dimensional input vector and learn the mapping between these vectors and the gaze positions. Early methods such as the neural networks proposed by Baluja and Pomerleau [18] and Xu et al. [19] need thousands of labeled training samples to train the mapping.

Tan et al. [20] proposed constructing an eye appearance manifold by using 252 collected training samples and using the local structure of the manifold gaze for interpolation. To reduce the number of labeled training samples, Williams et al. [21] introduced a semi-supervised Gaussian process regression to use both labeled and unlabeled training samples. Sugano et al. [22] investigated image saliency and proposed a user-unaware calibration that is performed while a user is watching a video clip. This idea was also used for a model-based method [17]. Lu et al. [23] introduced a novel regression technique to use sparse training samples and achieve high accuracy gaze estimation.

However, allowing for head motion is more difficult for appearance-based methods. Simply performing gaze estimation under head motion results in significantly large errors [24,25]. Nguyen et al. [26] proposed collecting training images for different head poses, which results in a lengthy calibration. Sugano et al. [27] proposed re-collecting training sample incrementally while the user was naturally using a computer. Lu et al. [28] introduced a synthesis framework to produce training eye images under unseen head poses. This method estimates optical flows and synthesizes a fair amount of training images, and therefore, its computational cost may be too high for mobile devices. In summary, because of the limitations in calibration and computational cost, the problem of head motion remains challenging for existing appearance-based methods.

Some important notations are first given in Table 1
                        . Using these notations, the gaze estimation problem can be represented as:
                           
                              (1)
                              
                                 
                                    
                                       g
                                       ^
                                    
                                    =
                                    E
                                    
                                       
                                          
                                             
                                                e
                                                ^
                                             
                                             
                                                r
                                                ^
                                             
                                             
                                                t
                                                ^
                                             
                                          
                                          T
                                       
                                    
                                    ,
                                 
                              
                           
                        where E(·) is a function for estimating the gaze direction 
                           
                              g
                              ^
                           
                        
                        
                           1
                        
                        
                           1
                           In practice, gaze estimation methods usually estimate the 2D gaze position on the screen instead of the 3D gaze direction vector for convenience. Such gaze positions and gaze directions can be converted into each other after geometric calibration.
                         from the eye appearance 
                           
                              e
                              ^
                           
                         by using the training dataset T
                        ={Te
                        , Tr
                        , Tt
                        , Tg
                        }. Throughout this paper, the letters e, r, t, and g are always used to indicate eye image vector, head rotation, head translation, and gaze direction, respectively. Note that the problem defined in Eq. (1) does not assume a fixed head pose; therefore, the head pose parameters 
                           
                              r
                              ^
                           
                         and 
                           
                              t
                              ^
                           
                        , which are input head rotation and head translation vectors in a 3D coordinate system, are also required as inputs of the problem. Also note that strictly speaking, 3D gaze is defined by its 3D direction and 3D origin. In this paper, we focus on its 3D direction because the 3D origin is just the eye position that can be directly tracked via a head/eye tracker.

In this paper, we solve the problem defined by Eq. (1). As shown in Fig. 1
                        , our goal is to estimate the gaze direction 
                           
                              g
                              ^
                           
                         under the world coordinate system (WCS), while the head coordinate system (HCS) determined by head pose 
                           
                              
                                 r
                                 ^
                              
                              
                                 t
                                 ^
                              
                           
                         can be arbitrary due to head motion.

The free head motion problem defined in Eq. (1) is difficult because it requires the training dataset T, which corresponds to 6-degree-of-freedom head motion to sufficiently train the mapping function E(·). Therefore, as reviewed in Section 2, most existing appearance-based methods assume a fixed head pose. In this paper, we propose decomposing this difficult problem into much easier subproblems that can be solved by using less training data.

We first consider the problem by assuming eye images captured under a fixed head pose (r
                        0, t
                        0). Then the problem can be simplified as
                           
                              (2)
                              
                                 
                                    
                                       g
                                       ^
                                    
                                    =
                                    
                                       E
                                       
                                          
                                             r
                                             0
                                          
                                          ,
                                          
                                             t
                                             0
                                          
                                       
                                    
                                    
                                       
                                          
                                             
                                                e
                                                ^
                                             
                                          
                                          
                                             T
                                             0
                                          
                                       
                                    
                                    ,
                                 
                              
                           
                        where T
                        0
                        ={T
                        0
                        
                           e
                        ,T
                        0
                        
                           g
                        } is the training dataset collected for the fixed head pose (r
                        0, t
                        0), and function 
                           
                              E
                              
                                 
                                    r
                                    0
                                 
                                 ,
                                 
                                    t
                                    0
                                 
                              
                           
                        (·) performs gaze estimation only for such a fixed head pose. This subproblem can be easily solved by using previous methods to give an initial solution.

However, the above gaze estimation may contain significant error if the head moves. Fig. 2
                         gives an example with temporary notations α, β, etc. As shown in Fig. 2(a), the estimated gaze direction under a fixed head pose, r
                        0, t
                        0, is α. Then, if the head pose moves to 
                           
                              
                                 r
                                 ^
                              
                              
                                 t
                                 ^
                              
                           
                         as in Fig. 2(b), the estimated gaze direction α′ will differ from the true gaze direction by a bias, β. Therefore, we need to compensate for α′ by using β to obtain the correct gaze direction. This leads to the idea of gaze compensation.

Furthermore, compensation for gaze bias can be further decomposed into two stages, as shown in Fig. 2(c). First, α′ differs from α because head motion changes the camera's viewing direction and thus distorts the eye image (see the small eye image in Fig. 2). This causes an estimation bias, βD
                        . Second, the gaze direction rotates with head rotation geometrically, and this causes another bias, βG
                        . Note that βG
                         has a precise closed-form solution that can be geometrically computed, while βD
                         does not. For this reason, in this paper, we treat the two compensations separately, and therefore, uncertainty mainly goes to βD
                        ; thus, the total error is limited. Another reason to do so is that computing βG
                         only requires head rotation angles as inputs, while βD
                         depends on the camera's viewing direction that is related to all head pose parameters. Therefore, it is better to treat these two compensation problems separately.

By considering the above compensations, the problem in Eq. (1) can be decomposed into
                           
                              (3)
                              
                                 
                                    
                                       g
                                       ^
                                    
                                    ≃
                                    
                                       E
                                       
                                          
                                             r
                                             0
                                          
                                          ,
                                          
                                             t
                                             0
                                          
                                       
                                    
                                    
                                       
                                          
                                             
                                                e
                                                ^
                                             
                                          
                                          
                                             T
                                             0
                                          
                                       
                                    
                                    ⊗
                                    
                                       C
                                       
                                          
                                             r
                                             0
                                          
                                          ,
                                          
                                             t
                                             0
                                          
                                       
                                       D
                                    
                                    
                                       
                                          
                                             
                                                r
                                                ^
                                             
                                             
                                                t
                                                ^
                                             
                                          
                                          T
                                       
                                    
                                    ⊗
                                    
                                       C
                                       
                                          r
                                          0
                                       
                                       G
                                    
                                    
                                       
                                          r
                                          ^
                                       
                                    
                                    ,
                                 
                              
                           
                        where 
                           
                              
                                 E
                                 
                                    
                                       r
                                       0
                                    
                                    ,
                                    
                                       t
                                       0
                                    
                                 
                              
                              
                                 
                                    
                                       
                                          e
                                          ^
                                       
                                    
                                    
                                       T
                                       0
                                    
                                 
                              
                           
                         indicates an initial gaze direction by assuming a fixed head pose, (r
                        0, t
                        0). Operator “⊗” applies manipulations on the gaze direction via a series of rotations, and 
                           
                              
                                 C
                                 
                                    
                                       r
                                       0
                                    
                                    ,
                                    
                                       t
                                       0
                                    
                                 
                                 D
                              
                              
                                 
                                    
                                       
                                          r
                                          ^
                                       
                                       
                                          t
                                          ^
                                       
                                    
                                    T
                                 
                              
                           
                         and 
                           
                              
                                 C
                                 
                                    r
                                    0
                                 
                                 G
                              
                              
                                 
                                    r
                                    ^
                                 
                              
                           
                         denote the specific compensations for eye appearance distortion and geometric bias.

Finally, Fig. 3
                         summarizes our decomposition scheme for handling the problem and briefly shows the keys of our compensation techniques. Method to obtain the initial solution is described in Section 4 and then details of our compensation techniques are described in Section 5. In particular, eye appearance distortion compensation in Section 5.1 uses a special set of training samples obtained via a novel calibration method. The calibration obtains sufficient training samples in a clever way by only capturing a very short video clip of the user. This video is the only additional training cost of our method, compared with conventional appearance-based methods that do not allow for head motion.

A head-pose free gaze estimation system can be implemented on the basis of the proposed compensation approach. Only a single camera is used to capture the user's eye appearances without requiring any additional devices. To obtain head poses, a commercial head pose tracker [29] is used by our system. It uses the same single camera with known intrinsic/extrinsic parameters, and technical details on it can be found in [29]. Our system works in the following steps.

Training dataset T
                           ={Te
                           , Tr
                           , Tt
                           , Tg
                           } is obtained via calibration. In particular, there are two stages of calibration to obtain sufficient training samples including: a fixed head pose calibration and another one done by capturing a short video clip. In general, the user is asked to sit in front of the screen and gaze at specific screen positions, i.e., calibration points. A single camera is placed below the screen. The i-th training sample obtained by the system comprises Ii
                           , g
                           
                              i
                           , r
                           
                              i
                           , and t
                           
                              i
                           , where Ii
                            is the captured face image from which we extract the eye feature e
                              i
                           .

In the first calibration stage, the user is asked to choose and keep a fixed head pose, (r
                           0, t
                           0), and gaze at different calibration points shown on the screen. When he/she clicks the mouse button, his/her face image will be captured. The second calibration stage is novel. The user is asked to gaze at a fixed calibration point on the screen and make head motion to let the camera record a short video clip. Because the gaze position is fixed and the head motion is relatively free, this stage only lasts for several seconds to obtain enough training samples. Details and usages of the training samples from the video are explained later in Section 5.1. Both the two calibration stages should be done for each individual user.

During testing, the user can make free head motion and use the mouse to choose any gaze positions on the screen. When he/she clicks a mouse button, the current gaze point position is stored, and a user face image is captured. At the same time, the head pose tracker returns the head pose parameters. In this manner, 
                              
                                 e
                                 ^
                              
                           , 
                              
                                 g
                                 ^
                              
                           , 
                              
                                 r
                                 ^
                              
                           , and 
                              
                                 t
                                 ^
                              
                            are obtained for a test sample.

For any test sample, gaze estimation performed by using 
                              
                                 
                                    e
                                    ^
                                 
                                 
                                    r
                                    ^
                                 
                                 
                                    t
                                    ^
                                 
                              
                            and the training dataset T is formulated by Eq. (1) and solved with our proposed techniques. In particular, this problem is first converted into its decomposed form (Eq. (3)) and then solved by techniques introduced in the following sections. Additionally, the gaze direction 
                              
                                 g
                                 ^
                              
                            in the test sample serves as the ground truth for assessing the estimation accuracy.

Our gaze estimation approach includes two steps: initial gaze estimation and gaze bias compensation, as formulated in Eq. (3). In this section, we describe how to obtain an initial gaze estimation result by assuming a fixed head pose. This is done by first rectifying the captured images in accordance with the head pose and then performing eye region alignment and fixed-head pose gaze estimation simultaneously.

Image rectification is unnecessary for existing fixed-head pose gaze estimation methods because they can capture almost identical images with only differences in eyeball orientation. However, when dealing with head motion, the captured user appearances will change drastically, as shown in Fig. 6
                        
                        
                         (left). This causes great difficulties in appearance-based gaze estimation because the cropped eye regions (shown in the small rectangles) show arbitrary poses. To solve this problem, we rectify the captured images in accordance with the head pose.

The key to rectifying an image is to “hypothetically” rotate the camera so that the camera coordinate system becomes parallel to the head coordinate system. In this manner, the camera can be regarded as moving in accordance with head motion, and therefore, the captured images look consistent. Examples of the rectified images are shown in Fig. 6 (right), where the cropped eye regions (shown in the small rectangles) have similar poses and can be easily used in gaze estimation.

For the above rectification, our method needs the intrinsic parameters of the camera. These parameters can be estimated via calibration by using a calibration board. This procedure is quick, and it only needs to be done once. The extrinsic parameters of the above hypothetic moving camera do not need to be known for rectification, as shown later.

Rectification is done as follows. After denoting the current head rotation as r
                        =[rx
                        , ry
                        , rz
                        ]T, we then need to rotate the camera around the X, Y, and Z axes in turn with the angles ωx
                        
                        =−
                        rx
                        , ωy
                        
                        =tan−1(tan ry
                        
                        ·cos rx
                        ), and ωz
                        
                        =−
                        rz
                        . As a result, the entire rotation matrix can be written as:
                           
                              (4)
                              
                                 
                                    
                                       Ω
                                       r
                                    
                                    =
                                    
                                       
                                          
                                             
                                                cos
                                                
                                                   ω
                                                   z
                                                
                                             
                                             
                                                −
                                                sin
                                                
                                                   ω
                                                   z
                                                
                                             
                                             
                                                0
                                             
                                          
                                          
                                             
                                                sin
                                                
                                                   ω
                                                   z
                                                
                                             
                                             
                                                cos
                                                
                                                   ω
                                                   z
                                                
                                             
                                             
                                                0
                                             
                                          
                                          
                                             
                                                0
                                             
                                             
                                                0
                                             
                                             
                                                1
                                             
                                          
                                       
                                    
                                    
                                       
                                          
                                             
                                                cos
                                                
                                                   ω
                                                   y
                                                
                                             
                                             
                                                0
                                             
                                             
                                                sin
                                                
                                                   ω
                                                   y
                                                
                                             
                                          
                                          
                                             
                                                0
                                             
                                             
                                                1
                                             
                                             
                                                0
                                             
                                          
                                          
                                             
                                                −
                                                sin
                                                
                                                   ω
                                                   y
                                                
                                             
                                             
                                                0
                                             
                                             
                                                cos
                                                
                                                   ω
                                                   y
                                                
                                             
                                          
                                       
                                    
                                    
                                       
                                          
                                             
                                                1
                                             
                                             
                                                0
                                             
                                             
                                                0
                                             
                                          
                                          
                                             
                                                0
                                             
                                             
                                                cos
                                                
                                                   ω
                                                   x
                                                
                                             
                                             
                                                −
                                                sin
                                                
                                                   ω
                                                   x
                                                
                                             
                                          
                                          
                                             
                                                0
                                             
                                             
                                                sin
                                                
                                                   ω
                                                   x
                                                
                                             
                                             
                                                cos
                                                
                                                   ω
                                                   x
                                                
                                             
                                          
                                       
                                    
                                    .
                                 
                              
                           
                        
                     

Then, we rectify the image by rotating the camera using the rotation matrix Ωr
                        . If assuming a pin-hole camera model and homogeneous coordinates, any 3D point P is filmed at a 2D image point, p, following
                           
                              (5)
                              
                                 
                                    
                                       z
                                    
                                    
                                       
                                          
                                             
                                                p
                                             
                                          
                                          
                                             
                                                1
                                             
                                          
                                       
                                    
                                    =
                                    K
                                    
                                       RT
                                    
                                    
                                       
                                          
                                             
                                                P
                                             
                                          
                                          
                                             
                                                1
                                             
                                          
                                       
                                    
                                    ,
                                 
                              
                           
                        where 
                           K
                         ∈ ℝ3×3 is the intrinsic matrix of the camera, and [
                           R|T
                        ] ∈ ℝ3×4 is the extrinsic matrix. Now, we add the above rotation Ωr
                         to the camera, and then, the new 2D pixel position p
                        † in the rectified image becomes
                           
                              (6)
                              
                                 
                                    
                                       
                                          
                                             
                                                z
                                                †
                                             
                                          
                                          
                                             
                                                
                                                   
                                                      
                                                         p
                                                         †
                                                      
                                                   
                                                
                                                
                                                   
                                                      1
                                                   
                                                
                                             
                                          
                                          =
                                          K
                                          
                                             
                                                
                                                   Ω
                                                   r
                                                
                                                
                                                   RT
                                                
                                             
                                          
                                          
                                             
                                                
                                                   
                                                      P
                                                   
                                                
                                                
                                                   
                                                      1
                                                   
                                                
                                             
                                          
                                       
                                    
                                    
                                       
                                          =
                                          K
                                          
                                             Ω
                                             r
                                          
                                          
                                             K
                                             
                                                −
                                                1
                                             
                                          
                                          
                                             
                                                K
                                                
                                                   RT
                                                
                                                
                                                   
                                                      
                                                         
                                                            P
                                                         
                                                      
                                                      
                                                         
                                                            1
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                          =
                                          
                                             z
                                          
                                          K
                                          
                                             Ω
                                             r
                                          
                                          
                                             K
                                             
                                                −
                                                1
                                             
                                          
                                          
                                             
                                                
                                                   
                                                      p
                                                   
                                                
                                                
                                                   
                                                      1
                                                   
                                                
                                             
                                          
                                          ,
                                       
                                    
                                 
                              
                           
                        where z and z
                        † are all scalers, and the camera extrinsic parameters [
                           RT
                        ] are eliminated.

Note that in Eq. (6), everything is known to transform the original pixel position p into the rectified pixel position p
                        †, except for z and z
                        †, which are very close to each other and may only scale the image size slightly. By transforming every pixel in the image, we obtain the rectified images shown in Fig. 6 (right). The above rectification is applied to all captured images during both the calibration and estimation procedures. In the next section, we describe how to align eye regions in the rectified images and also handle the small scaling differences, and then we use these eye images to do the initial gaze estimation.

In this section, we describe how to apply the initial gaze estimation by assuming a fixed head pose, as defined by the problem in Eq. (2).

The training data T
                        0
                        ={T
                        0
                        
                           e
                        ,T
                        0
                        
                           g
                        } obtained under a fixed head pose, (r
                        0, t
                        0), are used. This T
                        0 comprises n
                        0 training samples, each of which contains a vector, e
                        
                           i
                        
                        ∈
                        T
                        0
                        
                           e
                        , obtained from the training eye image, Ii
                         and a gaze direction vector, g
                        
                           i
                        
                        ∈
                        T
                        0
                        
                           g
                        , where i
                        =1⋯n
                        0. For a test sample, we similarly have an eye image vector, 
                           
                              e
                              ^
                           
                        , and seek its corresponding unknown gaze direction, 
                           
                              g
                              ^
                           
                        . Note that the head pose parameters 
                           
                              r
                              ^
                           
                         and 
                           
                              t
                              ^
                           
                         are not considered here since we assume a fixed head pose.

The problem now is about seeking a mapping, e
                        
                           i
                        
                        ↦
                        g
                        
                           i
                        , from the high dimensional space to the 3D gaze direction space. Following the previous fixed-head pose methods [20,23], we solve this problem by using local linear mapping:
                           
                              (7)
                              
                                 
                                    
                                       
                                          
                                             E
                                             
                                                
                                                   r
                                                   0
                                                
                                                ,
                                                
                                                   t
                                                   0
                                                
                                             
                                          
                                          
                                             
                                                
                                                   e
                                                   ^
                                                
                                                
                                                   
                                                      T
                                                      0
                                                      e
                                                   
                                                   
                                                      T
                                                      0
                                                      g
                                                   
                                                
                                             
                                          
                                          :
                                          
                                             g
                                             ^
                                          
                                          =
                                          
                                             
                                                ∑
                                                
                                                   i
                                                   =
                                                   1
                                                
                                                
                                                   n
                                                   0
                                                
                                             
                                             
                                                
                                                   w
                                                   i
                                                
                                                ⋅
                                                
                                                   g
                                                   i
                                                
                                             
                                          
                                       
                                    
                                    
                                       
                                          
                                          subject
                                          
                                          to
                                          
                                             
                                                w
                                                i
                                             
                                          
                                          =
                                          arg
                                          
                                          min
                                          
                                             
                                                
                                                   
                                                      e
                                                      ^
                                                   
                                                   −
                                                   
                                                      
                                                         ∑
                                                         
                                                            i
                                                            =
                                                            1
                                                         
                                                         
                                                            n
                                                            0
                                                         
                                                      
                                                      
                                                         
                                                            w
                                                            i
                                                         
                                                         ⋅
                                                         
                                                            e
                                                            i
                                                         
                                                      
                                                   
                                                
                                             
                                             F
                                             2
                                          
                                          ,
                                       
                                    
                                 
                              
                           
                        where the weight wi
                        
                        ≠0 only when e
                        
                           i
                         is one of the four closest vectors to 
                           
                              e
                              ^
                           
                         in terms of Euclidean distance. Eq. (7) solves the first part, namely, the initial estimation in Eq. (3).

Note that the above method faces a problem in our scenario. Previous fixed-head pose methods capture images under a fixed head pose, and therefore, every eye image can be cropped from the same position to produce an eye image vector, 
                           
                              e
                              ^
                           
                        . However, in our case, head motion moves eye regions arbitrarily in the captured image, as shown in Fig. 6 (right). We need to align the eye region before extracting the eye image vector 
                           
                              e
                              ^
                           
                        . Here, we introduce a simultaneous alignment and estimation technique.

One good thing is that the image rectification in Section 4.1 simplifies the alignment problem so that only translation and slight scaling are needed for alignment. In addition, the head pose tracker [29] returns rough eye positions that can be used to initialize the eye image alignment. Therefore, we only need to refine the alignment with high precision. Let 
                           
                              I
                              ^
                           
                         denote the captured image, and let 
                           
                              J
                              ^
                           
                         be the aligned eye region from 
                           
                              I
                              ^
                           
                        . Also let 
                           τ
                         and s be the translation and scaling parameters. We use the method in Algorithm 1 to find the test eye region 
                           
                              J
                              ^
                           
                         by aligning the reconstructed training image I′ to the optimal region in 
                           
                              I
                              ^
                           
                        . The reconstructed training image I′ is obtained from gaze estimation. In particular, as shown in Eq. (7), we compute a linear combination with weights {wi
                        }, and therefore, I′ is reconstructed from training images by using the same weights {wi
                        }.

Note that our alignment method in Algorithm 1 is based on the Lucas–Kanade method [30]. Although their method may fail for extreme movements, it works robustly in our case. The reason is that our head pose tracker already initializes the eye region, and thus, we only need to refine the alignment with a limited number of pixels. Therefore, our alignment can be done robustly, as shown in Fig. 7
                        . Also note that, strictly speaking, alignment for eye images from different head poses cannot be perfect because these images are distorted by 3D head motion. However, our proposed image rectification in Section 4.1 partially handles such distortion, and our proposed appearance distortion compensation in Section 5.1 handles the remaining effect.

Overall, the proposed iterative method refines both gaze estimation and eye image alignment simultaneously and eventually obtains the best solution to Eq. (7) as the initial fixed-head pose gaze estimation result. An example of this procedure is shown in Fig. 7.
                           Algorithm 1
                           Simultaneous alignment and estimation
                                 
                                    Initialize 
                                          τ
                                        and s
                                    


                                       while 
                                       
                                          τ
                                        and s have not converged do
                                       
                                          
                                             •
                                             Crop eye region 
                                                   
                                                      J
                                                      ^
                                                   
                                                 from 
                                                   
                                                      I
                                                      ^
                                                   
                                                 by using 
                                                   τ
                                                 and s
                                             

Extract 
                                                   
                                                      e
                                                      ^
                                                   
                                                 from 
                                                   
                                                      J
                                                      ^
                                                   
                                                 via raster scanning

Solve weights {wi
                                                } via gaze estimation in Eq. (7)
                                             

Compute reconstructed image 
                                                   
                                                      
                                                         I
                                                         ′
                                                      
                                                      =
                                                      
                                                         
                                                            ∑
                                                            
                                                               i
                                                               =
                                                               1
                                                            
                                                            
                                                               n
                                                               0
                                                            
                                                         
                                                         
                                                      
                                                      
                                                      
                                                         w
                                                         i
                                                      
                                                      ⋅
                                                      
                                                         I
                                                         i
                                                      
                                                   
                                                
                                             

Adopt the Lucas–Kanade method [30] to update 
                                                   τ
                                                 and s by aligning I′ to the optimal region in 
                                                   
                                                      I
                                                      ^
                                                   
                                                
                                             


                                       end while
                                    

In this section we describe how to compensate for gaze estimation biases existing in the initial gaze estimation (Section 4) due to head motion.

In this section we discuss how eye image distortion affects gaze estimation results. Before all, it is necessary to understand how eye images are distorted due to head motion. Fig. 4 shows examples of eye images captured under different head poses. Note that the first two eye images have very similar appearances, although one of them is rotated inside the image plane (this rotation can be rectified as shown in Section 4.1). However, the third eye image's shape is obviously distorted due to the different viewing directions of its camera, and this distortion cannot be rectified by 2D image transformation. This observation leads to the fact that the camera's viewing direction determines the eye appearance distortion.

To describe the camera's viewing directions, we represent them under the head coordinate system (HCS). As shown in Fig. 4, these directions are shown as vectors under HCS that point to the camera. The vectors in the first two cases are identical under HCS, indicating that the corresponding eye images have similar 2D appearances, while in the third case, the vector is different, and the eye image is obviously distorted.

We further use the notation v
                        
                           c
                         ∈ ℝ3 to indicate the camera's viewing direction vector under HCS for any head pose. In particular, let v
                        0
                        
                           c
                         be a constant camera's viewing direction vector for the fixed head pose r
                        0, t
                        0. Then for any head pose, we can compute the difference Δ
                        v
                        
                           c
                        
                        =
                        v
                        
                           c
                        
                        −
                        v
                        0
                        
                           c
                        . We state that Δv
                        
                           c
                         is closely related to the gaze estimation bias due to eye image distortion. To represent such a “gaze estimation bias”, let Δ
                           ϕ
                        
                        =[Δϕx
                        , Δϕy
                        ] be rotations around the X and Y axes under WCS as shown in Fig. 1. The physical meaning of Δ
                           ϕ
                        
                        =[Δϕx
                        , Δϕy
                        ] is that a biased gaze direction can be rotated by Δϕx
                         and Δϕy
                         around the X and Y axes to become the correct gaze direction. Therefore, Δ
                           ϕ
                         represents the gaze bias. Then, the problem is about finding the relationship between the difference Δv
                        
                           c
                         of the camera's viewing direction vectors and the gaze estimation bias Δ
                           ϕ
                        . If the mapping Δ
                        v
                        
                           c
                        
                        ↦
                        Δ
                        
                           ϕ
                         can be found, one can obtain Δ
                           ϕ
                         from Δv
                        
                           c
                         for gaze bias compensation.

To learn the mapping, we first collect training samples with different Δv
                        
                           c
                         via calibration. Here, we introduce a simple unconventional calibration method that captures a short video clip while the user is gazing at a fixed screen position and rotating his/her head freely. This process is very easy for a user to do and sufficient training samples (≈102) can be obtained in only a few seconds. Therefore, the training cost is quite low. For every obtained training sample {e
                        
                           i
                        , r
                        
                           i
                        , t
                        
                           i
                        , g
                        
                           i
                        }, we calculate the corresponding Δ
                           ϕ
                           i
                         and Δ
                        v
                        
                           i
                        
                        
                           c
                        , as mentioned above.

The camera's viewing direction vector v
                           
                              c
                            under HCS is determined by both head translation t
                           =[tx
                           , ty
                           , tz
                           ]T and head rotation r
                           =[rx
                           , ry
                           , rz
                           ]T. Both t and r can be obtained by the head pose tracker in real time during calibration and estimation. Therefore, v
                           
                              c
                            can be calculated for both the calibration and estimation stages. The way to compute v
                           
                              c
                            from t and r is:
                              
                                 (8)
                                 
                                    
                                       
                                          v
                                          c
                                       
                                       =
                                       R
                                       
                                          
                                             −
                                             t
                                             /
                                             
                                                t
                                             
                                             ,
                                             r
                                             ,
                                             
                                                
                                                   0
                                                   0
                                                   0
                                                
                                                T
                                             
                                          
                                       
                                       ,
                                    
                                 
                              
                           where function R(·) is defined by Eq. (16).

The bias Δ
                              ϕ
                           
                           =[Δϕx
                           , Δϕy
                           ] rotates any initial gaze direction, namely, g
                           0, to the distortion compensated gaze direction denoted as g
                           
                              d
                           . Thus, Δ
                              ϕ
                           
                           =[Δϕx
                           , Δϕy
                           ] must fulfill the following relation.
                              
                                 (9)
                                 
                                    
                                       
                                          g
                                          d
                                       
                                       =
                                       
                                          
                                             
                                                
                                                   cos
                                                   Δ
                                                   
                                                      ϕ
                                                      y
                                                   
                                                
                                                
                                                   0
                                                
                                                
                                                   sin
                                                   Δ
                                                   
                                                      ϕ
                                                      y
                                                   
                                                
                                             
                                             
                                                
                                                   0
                                                
                                                
                                                   1
                                                
                                                
                                                   0
                                                
                                             
                                             
                                                
                                                   −
                                                   sin
                                                   Δ
                                                   
                                                      ϕ
                                                      y
                                                   
                                                
                                                
                                                   0
                                                
                                                
                                                   cos
                                                   Δ
                                                   
                                                      ϕ
                                                      y
                                                   
                                                
                                             
                                          
                                       
                                       
                                          
                                             
                                                
                                                   1
                                                
                                                
                                                   0
                                                
                                                
                                                   0
                                                
                                             
                                             
                                                
                                                   0
                                                
                                                
                                                   cos
                                                   Δ
                                                   
                                                      ϕ
                                                      x
                                                   
                                                
                                                
                                                   −
                                                   sin
                                                   Δ
                                                   
                                                      ϕ
                                                      x
                                                   
                                                
                                             
                                             
                                                
                                                   0
                                                
                                                
                                                   sin
                                                   Δ
                                                   
                                                      ϕ
                                                      x
                                                   
                                                
                                                
                                                   cos
                                                   Δ
                                                   
                                                      ϕ
                                                      x
                                                   
                                                
                                             
                                          
                                       
                                       
                                          g
                                          0
                                       
                                       .
                                    
                                 
                              
                           
                        

This problem can be solved to determine Δ
                              ϕ
                            as:
                              
                                 (10)
                                 
                                    
                                       
                                          
                                             Δ
                                             
                                                ϕ
                                                x
                                             
                                             =
                                             arctan
                                             
                                                
                                                   −
                                                   
                                                      
                                                         g
                                                         
                                                            d
                                                            ,
                                                            y
                                                         
                                                      
                                                      
                                                         g
                                                         
                                                            d
                                                            ,
                                                            z
                                                         
                                                      
                                                   
                                                
                                             
                                             −
                                             arctan
                                             
                                                
                                                   −
                                                   
                                                      
                                                         g
                                                         
                                                            0
                                                            ,
                                                            y
                                                         
                                                      
                                                      
                                                         g
                                                         
                                                            0
                                                            ,
                                                            z
                                                         
                                                      
                                                   
                                                
                                             
                                             ,
                                          
                                       
                                       
                                          
                                             Δ
                                             
                                                ϕ
                                                y
                                             
                                             =
                                             arctan
                                             
                                                
                                                   
                                                      g
                                                      i
                                                      
                                                         d
                                                         ,
                                                         x
                                                      
                                                   
                                                   
                                                      g
                                                      
                                                         d
                                                         ,
                                                         z
                                                      
                                                   
                                                
                                             
                                             +
                                             arctan
                                             
                                                
                                                   
                                                      g
                                                      
                                                         0
                                                         ,
                                                         x
                                                      
                                                   
                                                   
                                                      
                                                         
                                                            1
                                                            −
                                                            
                                                               
                                                                  
                                                                     g
                                                                     
                                                                        0
                                                                        ,
                                                                        x
                                                                     
                                                                  
                                                               
                                                               2
                                                            
                                                            −
                                                            
                                                               
                                                                  
                                                                     g
                                                                     
                                                                        d
                                                                        ,
                                                                        y
                                                                     
                                                                  
                                                               
                                                               2
                                                            
                                                         
                                                      
                                                      
                                                         1
                                                         2
                                                      
                                                   
                                                
                                             
                                             ,
                                          
                                       
                                    
                                 
                              
                           where g
                           
                              d,x
                            etc. are the elements of g
                           
                              d
                           , and g
                           0,x
                            etc. are the elements of g
                           0.

Note that g
                           
                              d
                            is supposed to be the distortion compensated gaze direction. In other words, it is our expected result after distortion compensation. Therefore, g
                           
                              d
                            is unknown during testing; we can only obtain it as training data during calibration stage. In particular, for the i-th training sample, we compute g
                           
                              i
                           
                           
                              d
                            by rotating g
                           
                              i
                            in accordance with head rotations r
                           
                              i
                            and r
                           0:
                              
                                 (11)
                                 
                                    
                                       
                                          g
                                          i
                                          d
                                       
                                       =
                                       R
                                       
                                          
                                             g
                                             i
                                          
                                          
                                             r
                                             i
                                          
                                          
                                             r
                                             0
                                          
                                       
                                       ,
                                    
                                 
                              
                           which applies an inverse geometric compensation as described later in Section 5.2. The resulting g
                           
                              i
                           
                           
                              d
                            is then used to calculate Δ
                           
                              ϕ
                           
                           
                              i
                           
                           =[Δϕ
                           
                              i
                           
                           
                              x
                           ,
                           Δϕ
                           
                              i
                           
                           
                              y
                           ] via Eq. (10) for the i-th training sample.

In Eq. (11), g
                           
                              i
                            is the ground truth gaze vector pointing from the user's eye to the known screen calibration position. Therefore, g
                           
                              i
                            depends on camera extrinsic parameters, i.e., relative position between the screen and camera, to convert head-camera coordinates into head-screen coordinates. If errors exist in these parameters, they will, however, have less effect on estimation accuracy. The reason is that as these parameters are fixed, they will cause similar gaze direction biases in both calibration and testing stages, and these biases partly counteract each other in testing.

After obtaining Δ
                              ϕ
                              i
                            and Δ
                           v
                           
                              i
                           
                           
                              c
                            for all training head poses, we learn the compensation for eye image distortion. The effect of geometric bias is removed first by a method introduced later in Section 5.2. Then, the mapping Δ
                           v
                           
                              i
                           
                           
                              c
                           
                           ↦
                           Δ
                           
                              ϕ
                           
                           
                              i
                            is learnt by the Gaussian process regression (GPR) model. Note that {Δ
                              ϕ
                              i
                           } ∈ ℝ2 has two elements, so we learn two 1D regressions. If we take the first element {Δϕ
                           
                              i
                           
                           
                              x
                           } as an example, the regression function is
                              
                                 (12)
                                 
                                    
                                       Δ
                                       
                                          ϕ
                                          i
                                          x
                                       
                                       =
                                       
                                          f
                                          x
                                       
                                       
                                          
                                             Δ
                                             
                                                v
                                                i
                                                c
                                             
                                          
                                       
                                       ∼
                                       GP
                                       
                                          
                                             m
                                             
                                                
                                                   Δ
                                                   
                                                      v
                                                      i
                                                      c
                                                   
                                                
                                             
                                             ,
                                             
                                                k
                                                w
                                             
                                             
                                                
                                                   Δ
                                                   
                                                      v
                                                      i
                                                      c
                                                   
                                                   ,
                                                   Δ
                                                   
                                                      v
                                                      j
                                                      c
                                                   
                                                
                                             
                                          
                                       
                                       .
                                    
                                 
                              
                           
                        

On the basis of the standard GPR model [31], we can define the terms in Eq. (12) and solve this problem as follows. First, the mean and covariance functions are defined by
                              
                                 (13)
                                 
                                    
                                       
                                          
                                             m
                                             
                                                
                                                   Δ
                                                   
                                                      v
                                                      i
                                                      c
                                                   
                                                
                                             
                                             =
                                             0
                                             ,
                                          
                                       
                                       
                                          
                                             
                                                k
                                                w
                                             
                                             
                                                
                                                   Δ
                                                   
                                                      v
                                                      i
                                                      c
                                                   
                                                   ,
                                                   Δ
                                                   
                                                      v
                                                      j
                                                      c
                                                   
                                                
                                             
                                             =
                                             k
                                             
                                             exp
                                             
                                                
                                                   −
                                                   
                                                      
                                                         
                                                            
                                                               Δ
                                                               
                                                                  v
                                                                  i
                                                                  c
                                                               
                                                               −
                                                               Δ
                                                               
                                                                  v
                                                                  j
                                                                  c
                                                               
                                                            
                                                         
                                                         2
                                                      
                                                      
                                                         2
                                                         
                                                            l
                                                            2
                                                         
                                                      
                                                   
                                                
                                             
                                             +
                                             
                                                σ
                                                2
                                             
                                             
                                                δ
                                                ij
                                             
                                             ,
                                          
                                       
                                    
                                 
                              
                           where σ
                           2 models the observation noise. For training, we write all the training data as y=[Δϕ
                           1
                           
                              x
                           ,⋯,Δϕ
                           
                              i
                           
                           
                              x
                           ,⋯,Δϕ
                           
                              n
                           
                           
                              x
                           ]T and 
                              V
                           
                           =[Δ
                           v
                           1
                           
                              c
                           ,⋯,
                           Δ
                           v
                           
                              i
                           
                           
                              c
                           ,⋯,
                           Δ
                           v
                           
                              n
                           
                           
                              c
                           ]T and then optimize the hyperparameters ω
                           ={k,l,σ
                           2} by minimizing the log marginal likelihood function:
                              
                                 (14)
                                 
                                    
                                       
                                          
                                             logp
                                             
                                                
                                                   y
                                                   
                                                      V
                                                      ω
                                                   
                                                
                                             
                                             =
                                             −
                                             
                                                1
                                                2
                                             
                                             
                                                y
                                                T
                                             
                                             
                                                
                                                   
                                                      
                                                         K
                                                         ω
                                                      
                                                      
                                                         V
                                                         V
                                                      
                                                      +
                                                      
                                                         σ
                                                         2
                                                      
                                                      I
                                                   
                                                
                                                
                                                   −
                                                   1
                                                
                                             
                                             y
                                          
                                       
                                       
                                          
                                             
                                             −
                                             
                                                1
                                                2
                                             
                                             log
                                             
                                                
                                                   
                                                      K
                                                      ω
                                                   
                                                   
                                                      V
                                                      V
                                                   
                                                   +
                                                   
                                                      σ
                                                      2
                                                   
                                                   I
                                                
                                             
                                             −
                                             
                                                n
                                                2
                                             
                                             log
                                             2
                                             π
                                             ,
                                          
                                       
                                    
                                 
                              
                           where 
                              K
                           
                           
                              ω
                           (
                              V
                           ,
                              V
                           ) is the covariance matrix whose element at (i,j) is Δv
                           
                              i
                           
                           
                              c
                           ,Δv
                           
                              j
                           
                           
                              c
                           , shown in Eq. (13).

During estimation, for a test sample 
                              
                                 
                                    e
                                    ^
                                 
                                 
                                    r
                                    ^
                                 
                                 
                                    t
                                    ^
                                 
                              
                           , 
                              
                                 Δ
                                 
                                    
                                       v
                                       ^
                                    
                                    c
                                 
                              
                            is computed from 
                              
                                 r
                                 ^
                              
                            and 
                              
                                 t
                                 ^
                              
                            first. Then, with the optimized hyperparameters, we predict 
                              
                                 Δ
                                 
                                    
                                       
                                          ϕ
                                          ^
                                       
                                       x
                                    
                                 
                              
                            from 
                              
                                 Δ
                                 
                                    
                                       v
                                       ^
                                    
                                    c
                                 
                              
                            with
                              
                                 (15)
                                 
                                    
                                       
                                          
                                             Δ
                                             
                                                
                                                   ϕ
                                                   ^
                                                
                                                x
                                             
                                             =
                                             
                                                K
                                                ω
                                             
                                             
                                                
                                                   Δ
                                                   
                                                      
                                                         v
                                                         ^
                                                      
                                                      c
                                                   
                                                   ,
                                                   V
                                                
                                             
                                             
                                                
                                                   
                                                      
                                                         K
                                                         ω
                                                      
                                                      
                                                         V
                                                         V
                                                      
                                                      +
                                                      
                                                         σ
                                                         2
                                                      
                                                      I
                                                   
                                                
                                                
                                                   −
                                                   1
                                                
                                             
                                             y
                                             ,
                                          
                                       
                                       
                                          
                                             cov
                                             
                                                
                                                   Δ
                                                   
                                                      
                                                         ϕ
                                                         ^
                                                      
                                                      x
                                                   
                                                
                                             
                                             =
                                             1
                                             −
                                             
                                                K
                                                ω
                                             
                                             
                                                
                                                   Δ
                                                   
                                                      
                                                         v
                                                         ^
                                                      
                                                      c
                                                   
                                                   ,
                                                   V
                                                
                                             
                                          
                                       
                                       
                                          
                                             
                                             
                                                
                                                   
                                                      
                                                         K
                                                         ω
                                                      
                                                      
                                                         V
                                                         V
                                                      
                                                      +
                                                      
                                                         σ
                                                         2
                                                      
                                                      I
                                                   
                                                
                                                
                                                   −
                                                   1
                                                
                                             
                                             
                                                K
                                                ω
                                             
                                             
                                                
                                                   V
                                                   ,
                                                   Δ
                                                   
                                                      
                                                         v
                                                         ^
                                                      
                                                      c
                                                   
                                                
                                             
                                             .
                                          
                                       
                                    
                                 
                              
                           
                        

After obtaining both 
                              
                                 Δ
                                 
                                    
                                       
                                          ϕ
                                          ^
                                       
                                       x
                                    
                                 
                              
                            and 
                              
                                 Δ
                                 
                                    
                                       
                                          ϕ
                                          ^
                                       
                                       y
                                    
                                 
                              
                           , we use them to compensate for gaze estimation bias due to eye appearance distortion. This is done by rotating the initially estimated gaze vector 
                              
                                 
                                    E
                                    
                                       
                                          r
                                          0
                                       
                                       ,
                                       
                                          t
                                          0
                                       
                                    
                                 
                                 
                                    
                                       
                                          e
                                          ^
                                       
                                       
                                          
                                             T
                                             0
                                          
                                       
                                    
                                 
                              
                            in Section 4.2 around the X and Y axes with 
                              
                                 Δ
                                 
                                    
                                       
                                          ϕ
                                          ^
                                       
                                       x
                                    
                                 
                              
                            and 
                              
                                 Δ
                                 
                                    
                                       
                                          ϕ
                                          ^
                                       
                                       y
                                    
                                 
                              
                           . The whole procedure is written as 
                              
                                 
                                    E
                                    
                                       
                                          r
                                          0
                                       
                                       ,
                                       
                                          t
                                          0
                                       
                                    
                                 
                                 
                                    
                                       
                                          e
                                          ^
                                       
                                       
                                          
                                             T
                                             0
                                          
                                       
                                    
                                 
                                 ⊗
                                 
                                    C
                                    
                                       
                                          r
                                          0
                                       
                                       ,
                                       
                                          t
                                          0
                                       
                                    
                                    D
                                 
                                 
                                    
                                       
                                          
                                             r
                                             ^
                                          
                                          
                                             t
                                             ^
                                          
                                       
                                       T
                                    
                                 
                              
                           , following Eq. (3), where 
                              
                                 
                                    C
                                    
                                       
                                          r
                                          0
                                       
                                       ,
                                       
                                          t
                                          0
                                       
                                    
                                    D
                                 
                                 
                                    
                                       
                                          
                                             r
                                             ^
                                          
                                          
                                             t
                                             ^
                                          
                                       
                                       T
                                    
                                 
                              
                            represents the method described in this section.

After compensating for eye appearance distortion, in this section, we handle the remaining gaze estimation bias due to geometric factors. In particular, because, until now, the gaze direction has been estimated by assuming a fixed head pose, (r
                        0, t
                        0), we need to further rotate it in accordance with the difference between r
                        0 and the real head orientation 
                           
                              r
                              ^
                           
                        .

This problem can be defined as shown in Fig. 5. The original gaze vector computed for head orientation r
                        0 is known under WCS. Now, we want to rotate the HCS from r
                        0
                        =[r
                        0
                        
                           x
                        ,r
                        0
                        
                           y
                        ,r
                        0
                        
                           z
                        ]T to 
                           
                              
                                 r
                                 ^
                              
                              =
                              
                                 
                                    
                                       
                                          
                                             r
                                             ^
                                          
                                          x
                                       
                                    
                                    
                                       
                                          
                                             r
                                             ^
                                          
                                          y
                                       
                                    
                                    
                                       
                                          
                                             r
                                             ^
                                          
                                          z
                                       
                                    
                                 
                                 T
                              
                           
                        , while the gaze vector will undergo the same orientation. The question is, “How do we obtain the rotated gaze vector under WCS?”

We analyze the HCS rotation from r
                        0 to 
                           
                              r
                              ^
                           
                         step by step and apply these rotations to any vector, a
                        0, to obtain a. Note that here we use an arbitrary vector, a
                        0, rather than the gaze vector to discuss a general case because such rotations can be applied to any vector such as in Eq. (8). The idea is to first rotate HCS from r
                        0 to [0, 0, 0]T and then further rotate it to 
                           
                              r
                              ^
                           
                        . During each step, we apply rotations around the X, Y, and Z axes under the WCS in turn. In this manner, we can rotate any a
                        0
                        ⇒
                        a by using the same rotations:
                           
                              (16)
                              
                                 
                                    
                                       
                                          a
                                          =
                                          R
                                          
                                             
                                                a
                                                0
                                             
                                             
                                                r
                                                0
                                             
                                             
                                                r
                                                ^
                                             
                                          
                                       
                                    
                                    
                                       
                                          =
                                          
                                             
                                                
                                                   
                                                      1
                                                   
                                                   
                                                      0
                                                   
                                                   
                                                      0
                                                   
                                                
                                                
                                                   
                                                      0
                                                   
                                                   
                                                      cos
                                                      
                                                         θ
                                                         2
                                                         x
                                                      
                                                   
                                                   
                                                      −
                                                      sin
                                                      
                                                         θ
                                                         2
                                                         x
                                                      
                                                   
                                                
                                                
                                                   
                                                      0
                                                   
                                                   
                                                      sin
                                                      
                                                         θ
                                                         2
                                                         x
                                                      
                                                   
                                                   
                                                      cos
                                                      
                                                         θ
                                                         2
                                                         x
                                                      
                                                   
                                                
                                             
                                          
                                          
                                             
                                                
                                                   
                                                      cos
                                                      
                                                         θ
                                                         2
                                                         y
                                                      
                                                   
                                                   
                                                      0
                                                   
                                                   
                                                      sin
                                                      
                                                         θ
                                                         2
                                                         y
                                                      
                                                   
                                                
                                                
                                                   
                                                      0
                                                   
                                                   
                                                      1
                                                   
                                                   
                                                      0
                                                   
                                                
                                                
                                                   
                                                      −
                                                      sin
                                                      
                                                         θ
                                                         2
                                                         y
                                                      
                                                   
                                                   
                                                      0
                                                   
                                                   
                                                      cos
                                                      
                                                         θ
                                                         2
                                                         y
                                                      
                                                   
                                                
                                             
                                          
                                          
                                             
                                                
                                                   
                                                      cos
                                                      
                                                         θ
                                                         12
                                                         z
                                                      
                                                   
                                                   
                                                      −
                                                      sin
                                                      
                                                         θ
                                                         12
                                                         z
                                                      
                                                   
                                                   
                                                      0
                                                   
                                                
                                                
                                                   
                                                      sin
                                                      
                                                         θ
                                                         12
                                                         z
                                                      
                                                   
                                                   
                                                      cos
                                                      
                                                         θ
                                                         12
                                                         z
                                                      
                                                   
                                                   
                                                      0
                                                   
                                                
                                                
                                                   
                                                      0
                                                   
                                                   
                                                      0
                                                   
                                                   
                                                      1
                                                   
                                                
                                             
                                          
                                       
                                    
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      cos
                                                      
                                                         θ
                                                         1
                                                         y
                                                      
                                                   
                                                   
                                                      0
                                                   
                                                   
                                                      sin
                                                      
                                                         θ
                                                         1
                                                         y
                                                      
                                                   
                                                
                                                
                                                   
                                                      0
                                                   
                                                   
                                                      1
                                                   
                                                   
                                                      0
                                                   
                                                
                                                
                                                   
                                                      −
                                                      sin
                                                      
                                                         θ
                                                         1
                                                         y
                                                      
                                                   
                                                   
                                                      0
                                                   
                                                   
                                                      cos
                                                      
                                                         θ
                                                         1
                                                         y
                                                      
                                                   
                                                
                                             
                                          
                                          
                                             
                                                
                                                   
                                                      1
                                                   
                                                   
                                                      0
                                                   
                                                   
                                                      0
                                                   
                                                
                                                
                                                   
                                                      0
                                                   
                                                   
                                                      cos
                                                      
                                                         θ
                                                         1
                                                         x
                                                      
                                                   
                                                   
                                                      −
                                                      sin
                                                      
                                                         θ
                                                         1
                                                         x
                                                      
                                                   
                                                
                                                
                                                   
                                                      0
                                                   
                                                   
                                                      sin
                                                      
                                                         θ
                                                         1
                                                         x
                                                      
                                                   
                                                   
                                                      cos
                                                      
                                                         θ
                                                         1
                                                         x
                                                      
                                                   
                                                
                                             
                                          
                                          
                                             a
                                             0
                                          
                                          ,
                                       
                                    
                                 
                              
                           
                        where θ
                        1
                        
                           x
                        
                        =−
                        r
                        0
                        
                           x
                        , θ
                        1
                        
                           y
                        
                        =−
                        arc
                        tan(tan
                        r
                        0
                        
                           y
                        
                        ⋅cos
                        r
                        0
                        
                           x
                        ), 
                           
                              
                                 θ
                                 12
                                 z
                              
                              =
                              
                                 
                                    
                                       r
                                       ^
                                    
                                    z
                                 
                              
                              −
                              
                                 r
                                 0
                                 z
                              
                           
                        , 
                           
                              
                                 θ
                                 2
                                 y
                              
                              =
                              arctan
                              
                                 
                                    tan
                                    
                                       
                                          
                                             r
                                             ^
                                          
                                          y
                                       
                                    
                                    ⋅
                                    cos
                                    
                                       
                                          
                                             r
                                             ^
                                          
                                          x
                                       
                                    
                                 
                              
                           
                        , and 
                           
                              
                                 θ
                                 2
                                 x
                              
                              =
                              
                                 
                                    
                                       r
                                       ^
                                    
                                    x
                                 
                              
                           
                        . By using Eq. (16), we can complete the gaze estimation compensation described in Eq. (3) with
                           
                              (17)
                              
                                 
                                    
                                       
                                          
                                             E
                                             
                                                
                                                   r
                                                   0
                                                
                                                ,
                                                
                                                   t
                                                   0
                                                
                                             
                                          
                                          
                                             
                                                
                                                   
                                                      e
                                                      ^
                                                   
                                                
                                                
                                                   T
                                                   0
                                                
                                             
                                          
                                          ⊗
                                          
                                             C
                                             
                                                
                                                   r
                                                   0
                                                
                                                ,
                                                
                                                   t
                                                   0
                                                
                                             
                                             D
                                          
                                          
                                             
                                                
                                                   
                                                      r
                                                      ^
                                                   
                                                   
                                                      t
                                                      ^
                                                   
                                                
                                                T
                                             
                                          
                                          ⊗
                                          
                                             C
                                             
                                                r
                                                0
                                             
                                             G
                                          
                                          
                                             
                                                r
                                                ^
                                             
                                          
                                       
                                    
                                    
                                       
                                          =
                                          R
                                          
                                             
                                                
                                                
                                                   
                                                      
                                                         
                                                            E
                                                            
                                                               
                                                                  r
                                                                  0
                                                               
                                                               ,
                                                               
                                                                  t
                                                                  0
                                                               
                                                            
                                                         
                                                         
                                                            
                                                               
                                                                  
                                                                     e
                                                                     ^
                                                                  
                                                               
                                                               
                                                                  T
                                                                  0
                                                               
                                                            
                                                         
                                                         ⊗
                                                         
                                                            C
                                                            
                                                               
                                                                  r
                                                                  0
                                                               
                                                               ,
                                                               
                                                                  t
                                                                  0
                                                               
                                                            
                                                            D
                                                         
                                                         
                                                            
                                                               
                                                                  
                                                                     r
                                                                     ^
                                                                  
                                                                  
                                                                     t
                                                                     ^
                                                                  
                                                               
                                                               T
                                                            
                                                         
                                                      
                                                      ⏟︸
                                                   
                                                   
                                                      Initial
                                                      
                                                      gaze
                                                      +
                                                      appearance
                                                      
                                                      distortion
                                                      
                                                      compensation
                                                   
                                                
                                                
                                                ,
                                                
                                                   r
                                                   0
                                                
                                                ,
                                                
                                                   r
                                                   ^
                                                
                                             
                                          
                                          .
                                       
                                    
                                 
                              
                           
                        
                     

This gives us the final gaze estimation result for any head pose, 
                           
                              
                                 r
                                 ^
                              
                              ,
                              
                                 t
                                 ^
                              
                           
                        .

Note that head translation 
                           
                              t
                              ^
                           
                         is not used in this section because in the current stage, we only focus on gaze direction; head translations 
                           
                              t
                              ^
                           
                         only shift eye/gaze positions but do not cause gaze directions to vary. If one wants to convert the finally obtained gaze direction into a gaze position on the screen, then 
                           
                              t
                              ^
                           
                         should be used to determine the gaze line's origin.

The performance of the proposed method is evaluated by conducting several experiments. A gaze estimation system is built upon a desktop PC with a VGA resolution camera and a 22-inch LCD monitor. Users are required to sit in front of the monitor about 60cm away. Then, gaze estimation experiments are performed in three stages: 1) collecting training samples with a fixed head pose, 2) collecting training samples with free head rotation by capturing a short video clip, and 3) performing gaze estimation tests with free head motion. Details of these procedures are explained in Section 3.3. Note that all gaze positions on screen are converted into gaze directions before they are used. This is done by first tracking 3D user eye positions via a head pose tracker and then computing the 3D directions from the eye positions to corresponding gaze positions on the screen.

Our experimental data is processed with non-optimized Matlab codes. The appearance distortion compensation (Gaussian process regression in estimation mode) and geometric calculation can run at 500fps and >1000fps, while the Lucas–Kanade tracking, whose computational complexity is O(n
                     2
                     N
                     +
                     n
                     3) for N pixels and n alignment parameters [30], becomes a bottleneck (<1fps). However, using C/C++ for real-time Lucas–Kanade implementations for larger problems has already been reported for many existing methods. Therefore, real-time implementation for our method is also possible.

We first examine the fixed-head pose gaze estimation method described in Section 4.2 while the gaze compensation procedures are not involved. Training samples are collected by asking a user to gaze at each of the calibration points on screen, as shown in Fig. 8
                        , with a fixed head pose. Then, test samples are also collected when a user freely chooses gaze positions while still keeping a fixed head pose. Six users are involved in the experiments, and their average estimation error is determined to be around 0.8°. A comparison between our result and those reported by previous fixed-head pose methods is shown in Table 2
                        . Note that these methods all require personal calibration with a fixed head pose.

As shown in the table, our method achieves good accuracy among all methods. Although some other methods show a little better accuracy, they either need more training samples or implement much more complicated algorithms, while our method balances the tradeoff between accuracy and simplicity. Note that the aim of this paper is to handle free head motion; therefore, a simple and fairly good fixed-head pose estimator is preferred as a basis.

We examine the eye appearance distortion compensation technique proposed in Section 5.1 quantitatively. For calibration, we show a static point in the center of the screen as the known gaze position. Then, every user is asked to fixate on that static point and rotate his/her head. At the same time, the camera captures the user's appearance in a 5-s video clip to obtain training samples for the experiment. Some captured eye images of these training samples are shown in Fig. 9
                        , where the head rotation trajectory is roughly presented. Table 3
                         further gives the ranges of the camera's viewing direction variation due to head motion in X and Y rotations.

By using these training samples, we learn the Gaussian process regression model as described in Section 5.1. Fig. 10
                         shows the regression outputs for Δϕ
                        
                           i
                        
                        
                           x
                         and Δϕ
                        
                           i
                        
                        
                           y
                        , which clearly present the relationships between eye appearance distortion compensation and head motion. In particular, Δϕ
                        
                           i
                        
                        
                           x
                        , which is the compensation angle around the X axis, increases with head rotation upward then downward, while the compensation angle Δϕ
                        
                           i
                        
                        
                           y
                         around the Y axis alternately increases and decreases, reflecting the fact that head orientation varies between left and right.

To evaluate the model accuracy, we implement leave-one-out experiments by selecting each sample as a test sample and using the rest to train the regression model. Then appearance distortion compensation is applied to the test sample by using the trained model. Experimental results for all subjects are shown in Table 4
                        , where the average gaze estimation error due to head motion reaches 13.7°, while it reduces to 2.1° after eye appearance distortion compensation via the learnt model. To intuitively show the error variation with head motion, per-image results for a representative subject are given in Fig. 11
                        . Note that without compensation, the estimation errors become larger with significantly changed head poses, and they reduce when the head poses are close to the original one. However, with our compensation, the estimation errors are always stable and small. The significant difference in estimation errors with/without applying compensation demonstrates the effectiveness of the proposed method in compensating for eye appearance distortion.

In this section we evaluate the gaze estimation accuracy of the proposed method under free user head motion. Experiments are done for ten subjects, and training samples are collected under a fixed-head pose and also from a short video clip, as described in the previous sections. During the test stage, each user chooses gaze positions on the screen randomly and uses a mouse click to inform the system about the gaze positions. Their head poses keep changing so that we can assess the ability of our method to handle head motion. The head motion ranges in the test stage of our experiments are provided in Table 5
                        . The head translations in our experiments cover large ranges in which a user can freely translate his/her head without moving his/her body, while the head rotation ranges cover the full screen area. Therefore, the head motion ranges we tested are sufficient enough for common user–computer scenarios.

We perform gaze estimation by using different compensation strategies for the collected test samples. For instance, Fig. 12
                         shows gaze estimation errors for subject S1, where results are obtained by applying full compensations, only geometric compensation, only distortion compensation, and no compensation. By comparing the errors, the effectiveness of the proposed compensation approach is clearly proven in terms of estimation accuracy, while using only one type of compensation or no compensation results in large estimation errors under user free head motion.

Furthermore, Fig. 13
                         plots the average gaze estimation errors for all ten subjects in the experiments. Note that the error values for different subjects may vary due to individuality and difference in head motion. However, the proposed method achieves the smallest estimation errors for all subjects only when both compensations are used. In particular, estimation accuracies of 2–3° are achieved by using our method under free head motion, while this number will be larger than 7.5° if head motion is not dealt with. This indicates the effectiveness of our method. Note that using only one type of compensation may cause larger errors than, when using one of them, as shown in Fig. 13. This is because eye appearance distortion and geometric factors produce gaze estimation errors in different ways. Their effects may counteract each other. Therefore, when only compensating for one of them, the remaining may be larger than before. In summary, the two compensations are both necessary in practice.

Finally, we quantitatively investigate how head tracking error affects our gaze estimation accuracy. The difficulty is that we do not have ground truth head poses, and thus, we do not know the head tracking errors. However, when only applying geometric compensation, increasing head pose error causes nearly the same gaze error increment. Therefore, we add Gaussian noise to the original head poses and only run geometric compensation. The increment of gaze error is 1.8° on average, which indicates a similar increment of head pose error. Then, we complete our test by using the same noisy head poses, and we get a gaze error increment of 0.7° for distortion compensation and 0.8° for full compensation. Such results show that head tracking error does not affect gaze estimation accuracy much. The two compensations appear to compensate for each other when head tracking error increases. In addition, the head pose tracker [29] used in our work reports an accuracy of 0.5–3°, which is already included in our final results.

A general comparison between our method and the previous ones that also allow for free head motion is given in Table 6
                        . Besides using essentially different datasets, different methods also have specific requirements. For instance, the appearance-based methods need personal calibrations while the model-based methods need IR lights and cameras. Therefore we not only compare their reported accuracies but also listed their experimental conditions for a comprehensive comparison. From Table 6, we make the following observations.
                           
                              1.
                              Most existing gaze estimation methods that allow for head motion are model-based, and our method can be the state-of-the-art of the appearance-based methods. Its accuracy is comparable to the model-based methods.

The model-based methods usually require multiple IR lights and special cameras. Therefore, their usage is restricted.

Among the appearance-based methods, ours achieves both high accuracy and easy calibration. Compared with [28], which synthesizes eye images, our method is theoretically simpler and has less computational cost.

Regarding the public dataset, HPEG [32] is the most closely related dataset that contains both head pose and gaze information, and Heyman et al. [25] tested their method on HPEG. However, HPEG only categorizes gaze directions as “frontial”, “left”, “right”, etc., and it does not provide necessary training data. Therefore, it cannot be adopted by methods like ours for accurate gaze estimation and evaluation. Developing and using a comprehensive dataset for direct comparison are an important future work.

In this paper, we present a novel approach that performs appearance-based gaze estimation with free head motion. We solve this difficult problem by first decomposing it into subproblems and then solving them via initialization and compensations. Only a short video clip is required as an additional training input to allow for head motion. Experimental results show that our method achieves an average accuracy of around 3° by using only a single camera.

However, our method still has limitations. First, gaze estimation accuracy relies on head pose tracking accuracy, while our current head pose tracker performs badly with large head rotation (>45°) and faces problems under varying illumination. Second, individual calibration needs to be done for every user before estimation. This is a common problem for appearance-based methods that is expected to be handled in the future.

Finally, the experimental validation in this paper uses our own dataset because existing dataset cannot fulfill the requirements for different methods. Therefore, a good goal for future work is to design and collect more general gaze estimation datasets for direct comparison between different methods.

@&#REFERENCES@&#

