@&#MAIN-TITLE@&#A high-dimension two-sample test for the mean using cluster subspaces

@&#HIGHLIGHTS@&#


               
               
                  
                     
                        
                           
                           A two-sample test using hierarchical clustering was proposed.


                        
                        
                           
                           Hotelling’s statistics are computed in cluster-subspaces and summed as the statistic.


                        
                        
                           
                           Highly correlated variables take priority for being processed.


                        
                        
                           
                           A cutoff distance is used to restrain the effect of statistical fluctuations.


                        
                        
                           
                           High performance was demonstrated in simulations and real data analysis.


                        
                     
                  
               
            

@&#KEYPHRASES@&#

High-dimension data

Two-sample problem

Hierarchical clustering

Hotelling’s test

@&#ABSTRACT@&#


               
               
                  A common problem in modern genetic research is that of comparing the mean vectors of two populations–typically in settings in which the data dimension is larger than the sample size–where Hotelling’s test cannot be applied.
                  Recently, a test using random subspaces was proposed, in which the data are randomly projected into several lower-dimensional subspaces, and Hotelling’s test is well defined. Superior performance with competing tests was demonstrated when the variables were correlated.
                  Following the research of random subspaces, a modified test was proposed that might make more efficient use of covariance structure at high dimension. Hierarchical clustering is performed first such that highly correlated variables are clustered together. Next, Hotelling’s statistics are computed for every cluster-subspace and summed as the new test statistic. High performance was demonstrated via simulations and real data analysis.
               
            

@&#INTRODUCTION@&#

A common problem in genetics is that of testing whether a set of dependent gene expressions differs between two populations, typically in a setting where the data dimension is larger than the sample size.

For correlated variables, a classic test is Hotelling’s test. For instance, two samples 
                        X
                        =
                        
                           (
                           
                              
                                 X
                              
                              
                                 1
                              
                           
                           ,
                           …
                           ,
                           
                              
                                 X
                              
                              
                                 
                                    
                                       n
                                    
                                    
                                       1
                                    
                                 
                              
                           
                           )
                        
                      and 
                        Y
                        =
                        
                           (
                           
                              
                                 Y
                              
                              
                                 1
                              
                           
                           ,
                           …
                           ,
                           
                              
                                 Y
                              
                              
                                 
                                    
                                       n
                                    
                                    
                                       2
                                    
                                 
                              
                           
                           )
                        
                      of size 
                        
                           
                              n
                           
                           
                              1
                           
                        
                      and 
                        
                           
                              n
                           
                           
                              2
                           
                        
                      are generated in an independent and identically distributed (i.i.d.) manner from 
                        p
                     -dimensional multivariate normal distributions 
                        N
                        
                           (
                           
                              
                                 μ
                              
                              
                                 1
                              
                           
                           ,
                           Σ
                           )
                        
                      and 
                        N
                        
                           (
                           
                              
                                 μ
                              
                              
                                 2
                              
                           
                           ,
                           Σ
                           )
                        
                     , respectively, where the mean vectors 
                        
                           
                              μ
                           
                           
                              1
                           
                        
                      and 
                        
                           
                              μ
                           
                           
                              2
                           
                        
                      and positive-definite covariance matrix 
                        Σ
                      are all fixed and unknown; the hypothesis testing problem of interest is 
                        
                           
                              
                                 
                                    H
                                 
                                 
                                    0
                                 
                              
                              :
                              
                                 
                                    μ
                                 
                                 
                                    1
                                 
                              
                              =
                              
                                 
                                    μ
                                 
                                 
                                    2
                                 
                              
                              
                              
                                 versus
                              
                              
                              
                                 
                                    H
                                 
                                 
                                    1
                                 
                              
                              :
                              
                                 
                                    μ
                                 
                                 
                                    1
                                 
                              
                              ≠
                              
                                 
                                    μ
                                 
                                 
                                    2
                                 
                              
                              ,
                           
                        
                      the Hotelling’s test statistic is defined by 
                        
                           
                              
                                 
                                    T
                                 
                                 
                                    2
                                 
                              
                              =
                              
                                 
                                    
                                       
                                          n
                                       
                                       
                                          1
                                       
                                    
                                    
                                       
                                          n
                                       
                                       
                                          2
                                       
                                    
                                 
                                 
                                    
                                       
                                          n
                                       
                                       
                                          1
                                       
                                    
                                    +
                                    
                                       
                                          n
                                       
                                       
                                          2
                                       
                                    
                                 
                              
                              
                                 
                                    
                                       (
                                       
                                          
                                             X
                                          
                                          ¯
                                       
                                       −
                                       
                                          
                                             Y
                                          
                                          ¯
                                       
                                       )
                                    
                                 
                                 
                                    T
                                 
                              
                              
                                 
                                    
                                       
                                          Σ
                                       
                                       
                                          ̂
                                       
                                    
                                 
                                 
                                    −
                                    1
                                 
                              
                              
                                 (
                                 
                                    
                                       X
                                    
                                    ¯
                                 
                                 −
                                 
                                    
                                       Y
                                    
                                    ¯
                                 
                                 )
                              
                              ,
                           
                        
                      where 
                        
                           
                              X
                           
                           ¯
                        
                        =
                        
                           
                              1
                           
                           
                              
                                 
                                    n
                                 
                                 
                                    1
                                 
                              
                           
                        
                        
                           
                              ∑
                           
                           
                              j
                              =
                              1
                           
                           
                              
                                 
                                    n
                                 
                                 
                                    1
                                 
                              
                           
                        
                        
                           
                              X
                           
                           
                              j
                           
                        
                      and 
                        
                           
                              Y
                           
                           ¯
                        
                        =
                        
                           
                              1
                           
                           
                              
                                 
                                    n
                                 
                                 
                                    2
                                 
                              
                           
                        
                        
                           
                              ∑
                           
                           
                              j
                              =
                              1
                           
                           
                              
                                 
                                    n
                                 
                                 
                                    2
                                 
                              
                           
                        
                        
                           
                              Y
                           
                           
                              j
                           
                        
                      are the sample means, 
                        
                           
                              Σ
                           
                           
                              ̂
                           
                        
                      is the pooled sample covariance matrix, given by 
                        
                           
                              Σ
                           
                           
                              ̂
                           
                        
                        =
                        
                           
                              1
                           
                           
                              n
                           
                        
                        
                           
                              ∑
                           
                           
                              j
                              =
                              1
                           
                           
                              
                                 
                                    n
                                 
                                 
                                    1
                                 
                              
                           
                        
                        
                           (
                           
                              
                                 X
                              
                              
                                 j
                              
                           
                           −
                           
                              
                                 X
                              
                              ¯
                           
                           )
                        
                        
                           
                              
                                 (
                                 
                                    
                                       X
                                    
                                    
                                       j
                                    
                                 
                                 −
                                 
                                    
                                       X
                                    
                                    ¯
                                 
                                 )
                              
                           
                           
                              T
                           
                        
                        +
                        
                           
                              1
                           
                           
                              n
                           
                        
                        
                           
                              ∑
                           
                           
                              j
                              =
                              1
                           
                           
                              
                                 
                                    n
                                 
                                 
                                    2
                                 
                              
                           
                        
                        
                           (
                           
                              
                                 Y
                              
                              
                                 j
                              
                           
                           −
                           
                              
                                 Y
                              
                              ¯
                           
                           )
                        
                        
                           
                              
                                 (
                                 
                                    
                                       Y
                                    
                                    
                                       j
                                    
                                 
                                 −
                                 
                                    
                                       Y
                                    
                                    ¯
                                 
                                 )
                              
                           
                           
                              T
                           
                        
                     , and 
                        n
                        =
                        
                           
                              n
                           
                           
                              1
                           
                        
                        +
                        
                           
                              n
                           
                           
                              2
                           
                        
                        −
                        2
                      (Anderson, 1984). Under the null hypothesis 
                        
                           
                              H
                           
                           
                              0
                           
                        
                     , 
                        
                           
                              n
                              −
                              p
                              +
                              1
                           
                           
                              n
                              p
                           
                        
                        
                           
                              T
                           
                           
                              2
                           
                        
                      has an F-distribution with degrees of freedom 
                        p
                      and 
                        n
                        −
                        p
                        +
                        1
                      (Muirhead, 2005). Let the significance be chosen as 
                        α
                      and the threshold be denoted as 
                        
                           
                              F
                           
                           
                              α
                           
                        
                        
                           (
                           p
                           ,
                           n
                           −
                           p
                           +
                           1
                           )
                        
                        =
                        
                           
                              n
                              −
                              p
                              +
                              1
                           
                           
                              n
                              p
                           
                        
                        
                           
                              T
                           
                           
                              α
                           
                           
                              2
                           
                        
                     . Under the null hypothesis 
                        
                           
                              H
                           
                           
                              0
                           
                        
                     , the probability of 
                        
                           
                              T
                           
                           
                              2
                           
                        
                        ≥
                        
                           
                              T
                           
                           
                              α
                           
                           
                              2
                           
                        
                      is called the false positive (type I error) rate. Under the alternative hypothesis 
                        
                           
                              H
                           
                           
                              1
                           
                        
                     , the probability of 
                        
                           
                              T
                           
                           
                              2
                           
                        
                        ≥
                        
                           
                              T
                           
                           
                              α
                           
                           
                              2
                           
                        
                      is called the true positive rate (power).

By using a test suitable for correlated variables, it is possible not only to take the multivariate dependence structure into account but to gain more power from these dependences (Thulin, 2014). However, when 
                        p
                        >
                        n
                     , the matrix 
                        
                           
                              Σ
                           
                           
                              ̂
                           
                        
                      is singular, and Hotelling’s test cannot be applied.

Many studies have addressed the “large 
                        p
                     , small 
                        n
                     ” problem. Chung and Fraser (1958) proposed a nonparametric test that treats each variable independently. Dempster (1958, 1960) proposed a so-called “non-exact” significance test based on the quantity 
                        
                           
                              
                                 (
                                 
                                    
                                       X
                                    
                                    ¯
                                 
                                 −
                                 
                                    
                                       Y
                                    
                                    ¯
                                 
                                 )
                              
                           
                           
                              T
                           
                        
                        
                           (
                           
                              
                                 X
                              
                              ¯
                           
                           −
                           
                              
                                 Y
                              
                              ¯
                           
                           )
                        
                     , which can be viewed as replacing 
                        
                           
                              Σ
                           
                           
                              ̂
                           
                        
                      with 
                        
                           
                              I
                           
                           
                              p
                              ×
                              p
                           
                        
                     . It was later refined by Bai and Saranadasa (1996) and Chen and Qin (2010). However, the statistics based on 
                        
                           
                              
                                 (
                                 
                                    
                                       X
                                    
                                    ¯
                                 
                                 −
                                 
                                    
                                       Y
                                    
                                    ¯
                                 
                                 )
                              
                           
                           
                              T
                           
                        
                        
                           (
                           
                              
                                 X
                              
                              ¯
                           
                           −
                           
                              
                                 Y
                              
                              ¯
                           
                           )
                        
                      lack desirable invariance properties under rescaling transformation. Srivastava and Du (2008) proposed a test based on 
                        
                           
                              
                                 (
                                 
                                    
                                       X
                                    
                                    ¯
                                 
                                 −
                                 
                                    
                                       Y
                                    
                                    ¯
                                 
                                 )
                              
                           
                           
                              T
                           
                        
                        
                           
                              D
                           
                           
                              
                                 
                                    Σ
                                 
                                 
                                    ̂
                                 
                              
                           
                           
                              −
                              1
                           
                        
                        
                           (
                           
                              
                                 X
                              
                              ¯
                           
                           −
                           
                              
                                 Y
                              
                              ¯
                           
                           )
                        
                     , where 
                        
                           
                              D
                           
                           
                              
                                 
                                    Σ
                                 
                                 
                                    ̂
                                 
                              
                           
                        
                      is the diagonal matrix associated with 
                        
                           
                              Σ
                           
                           
                              ̂
                           
                        
                     , i.e., 
                        
                           
                              
                                 (
                                 
                                    
                                       Σ
                                    
                                    
                                       ̂
                                    
                                 
                                 )
                              
                           
                           
                              i
                              i
                           
                        
                        =
                        
                           
                              
                                 (
                                 
                                    
                                       D
                                    
                                    
                                       
                                          
                                             Σ
                                          
                                          
                                             ̂
                                          
                                       
                                    
                                 
                                 )
                              
                           
                           
                              i
                              i
                           
                        
                     . To make use of the multivariate dependence structure, Srivastava (2007) proposed using the Moore–Penrose pseudo-inverse of 
                        
                           
                              Σ
                           
                           
                              ̂
                           
                        
                      when computing Hotelling’s test statistic. Cai et al. (2014) applied a regularization technique to obtain a sparse estimator of the matrix and proposed a test statistic. Shen and Lin (2015) proposed a test that selects important variables against the null hypothesis.

To make more use of the multivariate dependence structure, Lopes et al. (2011, 2012) proposed a test in which the data are randomly pseudo-projected into several lower-dimensional spaces, where Hotelling’s test is well defined. Hotelling’s 
                        
                           
                              T
                           
                           
                              2
                           
                        
                      statistic is computed for each pseudo-projection, and the result is then averaged over all pseudo-projections. Superior performance with competing tests was demonstrated when the variables were correlated. Thulin (2014) proposed a modified test using random subspaces to improve the invariance properties. Random permutation resampling was utilized to improve the null distribution of the statistic.

This study followed the research of Thulin (2014) and proposed a test that can make more efficient use of the covariance structure at high dimension. Hierarchical clustering is performed first so that highly correlated variables are clustered together. Then, Hotelling’s 
                        
                           
                              T
                           
                           
                              2
                           
                        
                      statistics are computed for every cluster-subspace and summed as the new test statistic.

The rest of the paper is organized as follows. In Section  2, we propose the new test based on cluster subspaces. In Section  3, we compare the test with other two-sample tests with Monte Carlo simulations. The new test and the other tests are applied to a breast cancer dataset in Section  4. In Section  5, we discuss how the clustering method can group the variables successfully. Conclusions are presented in Section  6.

In Thulin’s random subspaces test, variables are randomly selected to construct subspaces in which Hotelling’s statistics are computed; therefore, the correlations between the variables are utilized and higher power is obtained. In the test in this study, hierarchical clustering is performed so that highly correlated variables are grouped together; therefore, the covariance structure might be more efficiently utilized. By clustering, the high dimension data are also projected to cluster subspaces of lower dimension in which Hotelling’s statistics can be computed and summed as the new test statistic.

Hierarchical clustering was widely used in modern genetic research to find related genes or individuals. By clustering, variables with high similarity metrics (or low distances) are grouped together (Eisen et al., 1998). In this study, 1—Pearson correlation coefficient was used as the distance. Highly correlated and thus small distance variables would be clustered together. The correlation coefficients are also related to the covariance matrix 
                           
                              
                                 Σ
                              
                              
                                 ̂
                              
                           
                         (if the distributions of all the variables are normalized so that the variances are equal to 1, the covariances are equal to the correlation coefficients).

There may be statistical fluctuations for the correlation coefficients. For large 
                           p
                        , some of the coefficients may be large by chance. To restrain the effect of statistical fluctuations, clusters were first calculated based on a cutoff distance 
                           
                              
                                 d
                              
                              
                                 c
                              
                           
                        . The Fisher 
                           
                              
                                 z
                              
                              
                                 ′
                              
                           
                        -transformation of correlation coefficient 
                           r
                         is 
                           
                              
                                 z
                              
                              
                                 ′
                              
                           
                           =
                           
                              
                                 1
                              
                              
                                 2
                              
                           
                           ln
                           
                              
                                 1
                                 +
                                 r
                              
                              
                                 1
                                 −
                                 r
                              
                           
                        . The standard error of 
                           
                              
                                 z
                              
                              
                                 ′
                              
                           
                         is 
                           
                              
                                 σ
                              
                              
                                 
                                    
                                       z
                                    
                                    
                                       ′
                                    
                                 
                              
                           
                           =
                           1
                           /
                           
                              
                                 n
                                 −
                                 1
                              
                           
                         (Norman and Streiner, 2008). Denote 
                           
                              
                                 t
                              
                              
                                 c
                              
                           
                         as the 
                           1
                           −
                           
                              
                                 2
                              
                              
                                 p
                                 
                                    (
                                    p
                                    −
                                    1
                                    )
                                 
                              
                           
                         quantile of standard normal distribution; then, 
                           
                              
                                 z
                              
                              
                                 c
                              
                              
                                 ′
                              
                           
                           =
                           
                              
                                 t
                              
                              
                                 c
                              
                           
                           /
                           
                              
                                 n
                                 −
                                 1
                              
                           
                        , 
                           
                              
                                 r
                              
                              
                                 c
                              
                           
                           =
                           
                              (
                              
                                 
                                    e
                                 
                                 
                                    2
                                    
                                       
                                          z
                                       
                                       
                                          c
                                       
                                       
                                          ′
                                       
                                    
                                 
                              
                              −
                              1
                              )
                           
                           /
                           
                              (
                              
                                 
                                    e
                                 
                                 
                                    2
                                    
                                       
                                          z
                                       
                                       
                                          c
                                       
                                       
                                          ′
                                       
                                    
                                 
                              
                              +
                              1
                              )
                           
                        , 
                           
                              
                                 d
                              
                              
                                 c
                              
                           
                           =
                           1
                           −
                           
                              
                                 r
                              
                              
                                 c
                              
                           
                         were used in the calculation. Therefore, in the case where there was no correlation between the 
                           p
                         variables, only about one of the 
                           
                              
                                 p
                                 
                                    (
                                    p
                                    −
                                    1
                                    )
                                 
                              
                              
                                 2
                              
                           
                         correlation coefficients was greater than 
                           
                              
                                 r
                              
                              
                                 c
                              
                           
                        , the distance was less than 
                           
                              
                                 d
                              
                              
                                 c
                              
                           
                        , and the corresponding two variables were grouped together due to statistical fluctuations.

All the variables were clustered into several clusters. Some of the clusters had many variables. If a cluster (or sub-cluster) had more than 
                           
                              
                                 k
                              
                              
                                 c
                              
                           
                         variables, it was further clustered into two sub-clusters, and so on, until each cluster (or sub-cluster) had no more than 
                           
                              
                                 k
                              
                              
                                 c
                              
                           
                         variables. Lopes et al. (2012) and Thulin (2014) have shown that 
                           
                              ⌊
                              n
                              /
                              2
                              ⌋
                           
                         is the optimal dimension of subspace and gives the highest power. In this study, 
                           
                              
                                 k
                              
                              
                                 c
                              
                           
                           =
                           
                              ⌊
                              2
                              n
                              /
                              3
                              ⌋
                           
                         was used so that the cluster dimension might be distributed around 
                           
                              ⌊
                              n
                              /
                              2
                              ⌋
                           
                        . For example, if the dimension of a cluster was less than or equal to 
                           
                              
                                 k
                              
                              
                                 c
                              
                           
                        , the cluster would no longer be subdivided, and its dimension would be less than or equal to 
                           
                              ⌊
                              2
                              n
                              /
                              3
                              ⌋
                           
                        ; if the dimension of a cluster was greater than 
                           
                              
                                 k
                              
                              
                                 c
                              
                           
                        , the cluster would be further divided into two subclusters with an average dimension greater than 
                           
                              ⌊
                              n
                              /
                              3
                              ⌋
                           
                        .

The algorithm is as follows. 
                           Algorithm 1
                           Clustering 
                                 
                                    Step 1.
                                    Set parameters 
                                          
                                             
                                                d
                                             
                                             
                                                c
                                             
                                          
                                       , 
                                          
                                             
                                                k
                                             
                                             
                                                c
                                             
                                          
                                       .

Hierarchical clustering is performed (1—Pearson correlation coefficient distance and average linkage are used). Clusters are calculated based on cutoff distance 
                                          
                                             
                                                d
                                             
                                             
                                                c
                                             
                                          
                                       ; all the variables are clustered into several clusters.

For each cluster (or sub-cluster), if it has no more than 
                                          
                                             
                                                k
                                             
                                             
                                                c
                                             
                                          
                                        variables, it will no longer be sub-divided; otherwise, it will be further clustered into two sub-clusters.

Repeat Step 3 until each cluster (or sub-cluster) has no more than 
                                          
                                             
                                                k
                                             
                                             
                                                c
                                             
                                          
                                        variables.

For cluster (or sub-cluster) 
                           i
                         that includes 
                           
                              
                                 p
                              
                              
                                 i
                              
                           
                         variables (
                           
                              
                                 p
                              
                              
                                 i
                              
                           
                           ≤
                           
                              
                                 k
                              
                              
                                 c
                              
                           
                        ), the projections of the two samples on the 
                           i
                        th cluster subspace are 
                           
                              
                                 x
                              
                              
                                 i
                              
                           
                           =
                           
                              (
                              
                                 
                                    x
                                 
                                 
                                    i
                                    ,
                                    1
                                 
                              
                              ,
                              …
                              ,
                              
                                 
                                    x
                                 
                                 
                                    i
                                    ,
                                    
                                       
                                          n
                                       
                                       
                                          1
                                       
                                    
                                 
                              
                              )
                           
                         and 
                           
                              
                                 y
                              
                              
                                 i
                              
                           
                           =
                           
                              (
                              
                                 
                                    y
                                 
                                 
                                    i
                                    ,
                                    1
                                 
                              
                              ,
                              …
                              ,
                              
                                 
                                    y
                                 
                                 
                                    i
                                    ,
                                    
                                       
                                          n
                                       
                                       
                                          2
                                       
                                    
                                 
                              
                              )
                           
                        , and the Hotelling’s statistic for the 
                           i
                        th cluster subspace can be defined by 
                           
                              (1)
                              
                                 
                                    
                                       T
                                    
                                    
                                       i
                                    
                                    
                                       2
                                    
                                 
                                 =
                                 
                                    
                                       
                                          
                                             n
                                          
                                          
                                             1
                                          
                                       
                                       
                                          
                                             n
                                          
                                          
                                             2
                                          
                                       
                                    
                                    
                                       
                                          
                                             n
                                          
                                          
                                             1
                                          
                                       
                                       +
                                       
                                          
                                             n
                                          
                                          
                                             2
                                          
                                       
                                    
                                 
                                 
                                    
                                       
                                          (
                                          
                                             
                                                
                                                   
                                                      x
                                                   
                                                   ¯
                                                
                                             
                                             
                                                i
                                             
                                          
                                          −
                                          
                                             
                                                
                                                   
                                                      y
                                                   
                                                   ¯
                                                
                                             
                                             
                                                i
                                             
                                          
                                          )
                                       
                                    
                                    
                                       T
                                    
                                 
                                 
                                    
                                       
                                          
                                             Σ
                                          
                                          
                                             ̂
                                          
                                       
                                    
                                    
                                       i
                                    
                                    
                                       −
                                       1
                                    
                                 
                                 
                                    (
                                    
                                       
                                          
                                             
                                                x
                                             
                                             ¯
                                          
                                       
                                       
                                          i
                                       
                                    
                                    −
                                    
                                       
                                          
                                             
                                                y
                                             
                                             ¯
                                          
                                       
                                       
                                          i
                                       
                                    
                                    )
                                 
                                 ,
                              
                           
                         where 
                           
                              
                                 
                                    
                                       x
                                    
                                    ¯
                                 
                              
                              
                                 i
                              
                           
                           =
                           
                              
                                 1
                              
                              
                                 
                                    
                                       n
                                    
                                    
                                       1
                                    
                                 
                              
                           
                           
                              
                                 ∑
                              
                              
                                 j
                                 =
                                 1
                              
                              
                                 
                                    
                                       n
                                    
                                    
                                       1
                                    
                                 
                              
                           
                           
                              
                                 x
                              
                              
                                 i
                                 ,
                                 j
                              
                           
                         and 
                           
                              
                                 
                                    
                                       y
                                    
                                    ¯
                                 
                              
                              
                                 i
                              
                           
                           =
                           
                              
                                 1
                              
                              
                                 
                                    
                                       n
                                    
                                    
                                       2
                                    
                                 
                              
                           
                           
                              
                                 ∑
                              
                              
                                 j
                                 =
                                 1
                              
                              
                                 
                                    
                                       n
                                    
                                    
                                       2
                                    
                                 
                              
                           
                           
                              
                                 y
                              
                              
                                 i
                                 ,
                                 j
                              
                           
                         are the sample means and 
                           
                              
                                 
                                    
                                       Σ
                                    
                                    
                                       ̂
                                    
                                 
                              
                              
                                 i
                              
                           
                         is the pooled sample covariance matrix, given by 
                           
                              
                                 
                                    
                                       Σ
                                    
                                    
                                       ̂
                                    
                                 
                              
                              
                                 i
                              
                           
                           =
                           
                              
                                 1
                              
                              
                                 n
                              
                           
                           
                              
                                 ∑
                              
                              
                                 j
                                 =
                                 1
                              
                              
                                 
                                    
                                       n
                                    
                                    
                                       1
                                    
                                 
                              
                           
                           
                              (
                              
                                 
                                    x
                                 
                                 
                                    i
                                    ,
                                    j
                                 
                              
                              −
                              
                                 
                                    
                                       
                                          x
                                       
                                       ¯
                                    
                                 
                                 
                                    i
                                 
                              
                              )
                           
                           
                              
                                 
                                    (
                                    
                                       
                                          x
                                       
                                       
                                          i
                                          ,
                                          j
                                       
                                    
                                    −
                                    
                                       
                                          
                                             
                                                x
                                             
                                             ¯
                                          
                                       
                                       
                                          i
                                       
                                    
                                    )
                                 
                              
                              
                                 T
                              
                           
                           +
                           
                              
                                 1
                              
                              
                                 n
                              
                           
                           
                              
                                 ∑
                              
                              
                                 j
                                 =
                                 1
                              
                              
                                 
                                    
                                       n
                                    
                                    
                                       2
                                    
                                 
                              
                           
                           
                              (
                              
                                 
                                    y
                                 
                                 
                                    i
                                    ,
                                    j
                                 
                              
                              −
                              
                                 
                                    
                                       
                                          y
                                       
                                       ¯
                                    
                                 
                                 
                                    i
                                 
                              
                              )
                           
                           
                              
                                 
                                    (
                                    
                                       
                                          y
                                       
                                       
                                          i
                                          ,
                                          j
                                       
                                    
                                    −
                                    
                                       
                                          
                                             
                                                y
                                             
                                             ¯
                                          
                                       
                                       
                                          i
                                       
                                    
                                    )
                                 
                              
                              
                                 T
                              
                           
                        .

According to Algorithm 1, the whole space is composed of several (denoted as 
                           
                              
                                 N
                              
                              
                                 c
                              
                           
                        ) cluster subspaces. Having computed the Hotelling’s statistics for all the cluster subspaces, one can make a sum of them and obtain an overall test statistic 
                           
                              (2)
                              
                                 
                                    
                                       T
                                    
                                    
                                       c
                                       s
                                    
                                 
                                 =
                                 
                                    
                                       ∑
                                    
                                    
                                       i
                                       =
                                       1
                                    
                                    
                                       
                                          
                                             N
                                          
                                          
                                             c
                                          
                                       
                                    
                                 
                                 
                                    
                                       T
                                    
                                    
                                       i
                                    
                                    
                                       2
                                    
                                 
                                 .
                              
                           
                        
                     

The clustering algorithm is based on Pearson correlations that are invariant under rescaling transformations by diagonal nonsingular matrices; therefore, the algorithm is rescaling invariant. As the Hotelling’s statistics are also rescaling invariant, the new test is rescaling invariant, as is Thulin’s random subspaces test.

The null distribution could be obtained by permutation. As the number of permutations is normally too large, we approached the distribution by random permutation. Random permutation was performed 
                           B
                         times; each time, all the individuals of the two samples were mixed together and randomly permuted and then re-assigned to the two samples, assuming that there was no difference between them.

Random permutation distributions were used as the null distributions of 
                           
                              
                                 T
                              
                              
                                 c
                                 s
                              
                           
                         as well as other statistics for hypothesis testing and 
                           p
                        -value computing in this study. The 
                           p
                        -value was obtained as the probability that the statistic of the permutation sample-pair was greater than or equal to the statistic of the original sample-pair. The algorithm of random permutation may refer to Thulin (2014).

Permutation does not affect the correlations between variables and does not affect the result of Algorithm 1. Therefore, hierarchical clustering can be performed only once, for the original sample-pair.

To evaluate the performance of the cluster subspaces test, we first compared it to other two-sample tests with Monte Carlo simulations.

All the computations were conducted in Matlab. Hierarchical clustering was carried out by Matlab functions pdist, linkage, and cluster. Moore–Penrose pseudo-inverse was carried out by Matlab function pinv.

The same Monte Carlo setup as Thulin (2014) was used to generate sample-pairs for studying the behavior of each test.

For each sample-pair, 
                           
                              
                                 n
                              
                              
                                 1
                              
                           
                         individuals 
                           X
                           =
                           
                              (
                              
                                 
                                    X
                                 
                                 
                                    1
                                 
                              
                              ,
                              …
                              ,
                              
                                 
                                    X
                                 
                                 
                                    
                                       
                                          n
                                       
                                       
                                          1
                                       
                                    
                                 
                              
                              )
                           
                         (sample 1) and 
                           
                              
                                 n
                              
                              
                                 2
                              
                           
                         individuals 
                           Y
                           =
                           
                              (
                              
                                 
                                    Y
                                 
                                 
                                    1
                                 
                              
                              ,
                              …
                              ,
                              
                                 
                                    Y
                                 
                                 
                                    
                                       
                                          n
                                       
                                       
                                          2
                                       
                                    
                                 
                              
                              )
                           
                         (sample 2) were generated according to 
                           p
                        -dimension normal distribution 
                           N
                           
                              (
                              
                                 
                                    μ
                                 
                                 
                                    1
                                 
                              
                              ,
                              Σ
                              )
                           
                         and 
                           N
                           
                              (
                              
                                 
                                    μ
                                 
                                 
                                    2
                                 
                              
                              ,
                              Σ
                              )
                           
                        , respectively. In this study, 
                           p
                           =
                           200
                         or 1000; 
                           
                              
                                 n
                              
                              
                                 1
                              
                           
                           =
                           
                              
                                 n
                              
                              
                                 2
                              
                           
                           =
                           50
                        ; 
                           Σ
                           =
                           
                              
                                 Σ
                              
                              
                                 a
                                 ,
                                 b
                              
                           
                           =
                           
                              (
                              
                                 
                                    σ
                                 
                                 
                                    i
                                    j
                                 
                              
                              )
                           
                        , where 
                           i
                           =
                           1
                           ,
                           …
                           ,
                           p
                        , 
                           j
                           =
                           1
                           ,
                           …
                           ,
                           p
                        , 
                           
                              
                                 
                                    
                                       
                                          
                                             
                                                σ
                                             
                                             
                                                i
                                                j
                                             
                                          
                                          =
                                       
                                       
                                          1
                                          ,
                                            for
                                          
                                          i
                                          =
                                          j
                                          ,
                                       
                                    
                                    
                                       
                                       
                                          a
                                          ,
                                            for  
                                          i
                                          ≠
                                          j
                                          ,
                                          
                                             ⌈
                                             i
                                             /
                                             25
                                             ⌉
                                          
                                          =
                                          
                                             ⌈
                                             j
                                             /
                                             25
                                             ⌉
                                          
                                          ,
                                       
                                    
                                    
                                       
                                       
                                          b
                                          ,
                                            for  
                                          
                                             ⌈
                                             i
                                             /
                                             25
                                             ⌉
                                          
                                          ≠
                                          
                                             ⌈
                                             j
                                             /
                                             25
                                             ⌉
                                          
                                          ,
                                       
                                    
                                 
                              
                           
                        
                        
                           
                              
                                 Σ
                              
                              
                                 a
                                 ,
                                 b
                              
                           
                         denotes a covariance matrix with unit variances and 
                           p
                           /
                           25
                         equal-sized blocks (with size 25), and covariance 
                           
                              
                                 σ
                              
                              
                                 i
                                 j
                              
                           
                         is 
                           a
                         if 
                           i
                         and 
                           j
                         belong to the same block and 
                           b
                         otherwise; 
                           
                              
                                 μ
                              
                              
                                 1
                              
                           
                           =
                           0
                        , 
                           
                              
                                 μ
                              
                              
                                 2
                              
                           
                           =
                           
                              (
                              
                                 
                                    μ
                                 
                                 
                                    2
                                    j
                                 
                              
                              )
                           
                        , where 
                           j
                           =
                           1
                           ,
                           …
                           ,
                           p
                        , 
                           
                              
                                 
                                    
                                       
                                          
                                             
                                                μ
                                             
                                             
                                                2
                                                j
                                             
                                          
                                          =
                                       
                                       
                                          d
                                          ,
                                            for  
                                          
                                             ⌈
                                             j
                                             /
                                             25
                                             ⌉
                                          
                                          ≤
                                          m
                                          ,
                                          
                                          
                                             mod
                                          
                                          
                                             (
                                             j
                                             −
                                             1
                                             ,
                                             25
                                             )
                                          
                                          <
                                          20
                                          ,
                                       
                                    
                                    
                                       
                                       
                                          0
                                          ,
                                            otherwise ,
                                       
                                    
                                 
                              
                           
                         for sample 2, we shifted the means of 20 out of 25 variables evenly in each of 
                           m
                         out of the 
                           p
                           /
                           25
                         blocks; 
                           m
                           ∈
                           
                              {
                              1
                              ,
                              8
                              }
                           
                         for 
                           p
                           =
                           200
                        , 
                           m
                           ∈
                           
                              {
                              8
                              ,
                              40
                              }
                           
                         for 
                           p
                           =
                           1000
                        ; 
                           d
                           =
                           D
                           /
                           
                              
                                 20
                                 
                                 m
                              
                           
                        , and therefore, 
                           D
                         equals Euclidean distance 
                           
                              ‖
                              
                                 
                                    μ
                                 
                                 
                                    1
                                 
                              
                              −
                              
                                 
                                    μ
                                 
                                 
                                    2
                                 
                              
                              ‖
                           
                        .

Multivariate normal distributions of three covariance structures, 
                           
                              
                                 Σ
                              
                              
                                 0
                                 ,
                                 0
                              
                           
                        , 
                           
                              
                                 Σ
                              
                              
                                 0.5
                                 ,
                                 0.1
                              
                           
                         and 
                           
                              
                                 Σ
                              
                              
                                 0.9
                                 ,
                                 0.2
                              
                           
                        , were studied.


                        Chung and Fraser (1958) proposed a non-parametric test in which the scaled difference in sample means is computed for each variable; then, a sum of the absolute values or a sum of the squares is computed for all the variables. The Chung–Fraser test was chosen for comparison, and the sum of the squares was adopted as the test statistic.


                        Dempster (1958, 1960) proposed a test based on the quantity 
                           
                              
                                 
                                    (
                                    
                                       
                                          X
                                       
                                       ¯
                                    
                                    −
                                    
                                       
                                          Y
                                       
                                       ¯
                                    
                                    )
                                 
                              
                              
                                 T
                              
                           
                           
                              (
                              
                                 
                                    X
                                 
                                 ¯
                              
                              −
                              
                                 
                                    Y
                                 
                                 ¯
                              
                              )
                           
                        , which was later refined by Bai and Saranadasa (1996) and Chen and Qin (2010). The Chen–Qin test was chosen as a representation of them.


                        Srivastava and Du (2008) proposed a test based on 
                           
                              
                                 
                                    (
                                    
                                       
                                          X
                                       
                                       ¯
                                    
                                    −
                                    
                                       
                                          Y
                                       
                                       ¯
                                    
                                    )
                                 
                              
                              
                                 T
                              
                           
                           
                              
                                 D
                              
                              
                                 
                                    
                                       Σ
                                    
                                    
                                       ̂
                                    
                                 
                              
                              
                                 −
                                 1
                              
                           
                           
                              (
                              
                                 
                                    X
                                 
                                 ¯
                              
                              −
                              
                                 
                                    Y
                                 
                                 ¯
                              
                              )
                           
                        , which has invariance properties under rescaling transformation. The Srivastava–Du test was chosen for comparison.


                        Srivastava (2007) proposed using the Moore–Penrose pseudo-inverse of the sample covariance matrix when computing Hotelling’s test statistic. It was chosen for comparison.


                        Cai et al. (2014) applied a regularization technique to obtain a sparse estimator of the matrix and proposed a test statistic. Shen and Lin (2015) proposed a test that selects important variables against the null hypothesis. The Shen–Lin test was chosen as a representation of them. However, in a small pilot study, we found the Shen–Lin test to be computationally expensive and to have lower power than the competing tests for the Monte Carlo samples of this study. It was therefore not included in the larger study.


                        Lopes et al. (2011, 2012) proposed a test in which the data are randomly pseudo-projected into several lower-dimensional spaces. Thulin (2014) proposed a modified test using random subspaces to improve the invariance properties. The Thulin test was chosen as a representation of them.

For a given sample-pair 
                           X
                         and 
                           Y
                        , each test statistic could be calculated.

To calculate 
                           
                              
                                 T
                              
                              
                                 c
                                 s
                              
                           
                        , hierarchical clustering should be performed beforehand, and thus the 
                           p
                         variables are clustered into several clusters. Fig. 1
                         shows a sample-pair generated under 
                           
                              
                                 H
                              
                              
                                 0
                              
                           
                         with 
                           p
                           =
                           200
                        , 
                           
                              
                                 μ
                              
                              
                                 1
                              
                           
                           =
                           
                              
                                 μ
                              
                              
                                 2
                              
                           
                           =
                           0
                        , 
                           Σ
                           =
                           
                              
                                 Σ
                              
                              
                                 0.9
                                 ,
                                 0.2
                              
                           
                        . Its variables were clustered into 7 clusters according to Algorithm 1. Supplementary Fig. 1 shows a sample-pair generated under 
                           
                              
                                 H
                              
                              
                                 1
                              
                           
                         with 
                           p
                           =
                           200
                        , 
                           
                              
                                 μ
                              
                              
                                 1
                              
                           
                           =
                           0
                        , 
                           
                              ‖
                              
                                 
                                    μ
                                 
                                 
                                    1
                                 
                              
                              −
                              
                                 
                                    μ
                                 
                                 
                                    2
                                 
                              
                              ‖
                           
                           =
                           2
                         (
                           m
                           =
                           8
                        ), 
                           Σ
                           =
                           
                              
                                 Σ
                              
                              
                                 0.9
                                 ,
                                 0.2
                              
                           
                         (see Appendix A). Its variables were also clustered into 7 clusters.

To evaluate the type I error rates for the tests, a Monte Carlo study was performed under the null hypothesis 
                           
                              
                                 H
                              
                              
                                 0
                              
                           
                           :
                           
                              
                                 μ
                              
                              
                                 1
                              
                           
                           =
                           
                              
                                 μ
                              
                              
                                 2
                              
                           
                           =
                           0
                         for 
                           p
                           =
                           200
                         or 1000 and 
                           
                              
                                 n
                              
                              
                                 1
                              
                           
                           =
                           
                              
                                 n
                              
                              
                                 2
                              
                           
                           =
                           50
                        . Sample-pairs were generated in cases 
                           
                              
                                 Σ
                              
                              
                                 0
                                 ,
                                 0
                              
                           
                        , 
                           
                              
                                 Σ
                              
                              
                                 0.5
                                 ,
                                 0.1
                              
                           
                         and 
                           
                              
                                 Σ
                              
                              
                                 0.9
                                 ,
                                 0.2
                              
                           
                         (see Table 1
                        ).

For a sample-pair generated under 
                           
                              
                                 H
                              
                              
                                 0
                              
                           
                        , each test statistic could be computed. The null distribution could be obtained by random permutation resampling (
                           B
                           =
                           500
                         times). Fig. 2
                        (a) shows the null distribution of 
                           
                              
                                 T
                              
                              
                                 c
                                 s
                              
                           
                         for the sample-pair of Fig. 1 (generated under 
                           
                              
                                 H
                              
                              
                                 0
                              
                           
                        ). The original statistic 
                           
                              
                                 T
                              
                              
                                 c
                                 s
                              
                           
                         is marked with a solid line. The statistic of random permutation resampling at level 
                           1
                           −
                           α
                        , denoted as 
                           
                              
                                 T
                              
                              
                                 c
                                 s
                                 ,
                                 α
                              
                           
                        , is marked with a dashed line. If 
                           
                              
                                 T
                              
                              
                                 c
                                 s
                              
                           
                           ≥
                           
                              
                                 T
                              
                              
                                 c
                                 s
                                 ,
                                 α
                              
                           
                        , a false positive sample-pair is accounted. The proportion of the histogram on the right side of the original statistic 
                           
                              
                                 T
                              
                              
                                 c
                                 s
                              
                           
                         is the 
                           p
                        -value of the statistic. 
                           
                              
                                 T
                              
                              
                                 c
                                 s
                              
                           
                           ≥
                           
                              
                                 T
                              
                              
                                 c
                                 s
                                 ,
                                 α
                              
                           
                         is equivalent to 
                           p
                        -value 
                           ≤
                           α
                        . 
                           α
                           =
                           0.05
                         was used in this study.

Having generated many sample-pairs, one can calculate the false positive (type I error, 
                           p
                        -value 
                           ≤
                           α
                        ) rates for the tests (shown in Table 1). For each case of 
                           p
                           =
                           200
                        , 1000 sample-pairs were generated under the null hypothesis. For each case of 
                           p
                           =
                           1000
                        , 200 sample-pairs were generated.

All tests have acceptable type I error rates.

The power of a test is the true positive rate under the alternative hypothesis 
                           
                              
                                 H
                              
                              
                                 1
                              
                           
                           :
                           
                              
                                 μ
                              
                              
                                 1
                              
                           
                           ≠
                           
                              
                                 μ
                              
                              
                                 2
                              
                           
                        .

For a sample-pair generated under 
                           
                              
                                 H
                              
                              
                                 1
                              
                           
                        , each test statistic could be computed. The null distribution could be obtained by random permutation resampling. Fig. 2(b) shows the null distribution of 
                           
                              
                                 T
                              
                              
                                 c
                                 s
                              
                           
                         for the sample-pair of Supplementary Fig. 1 (generated under 
                           
                              
                                 H
                              
                              
                                 1
                              
                           
                        ) (see Appendix A). If 
                           
                              
                                 T
                              
                              
                                 c
                                 s
                              
                           
                           ≥
                           
                              
                                 T
                              
                              
                                 c
                                 s
                                 ,
                                 α
                              
                           
                         (
                           p
                        -value 
                           ≤
                           α
                        ), a true positive sample-pair is observed.

Having generated many sample-pairs, one can count the sample-pairs of true positive and calculate the true positive rates (powers) for the tests. The powers of the tests as functions of the resulting Euclidean distance 
                           
                              ‖
                              
                                 
                                    μ
                                 
                                 
                                    1
                                 
                              
                              −
                              
                                 
                                    μ
                                 
                                 
                                    2
                                 
                              
                              ‖
                           
                         are shown in Figs. 3 and 4
                        
                        . We generated 1000 sample-pairs for each case of 
                           p
                           =
                           200
                         and 200 sample-pairs for each case of 
                           p
                           =
                           1000
                        .

The Chung–Fraser, Chen–Qin, and Srivastava–Du tests are not based on correlation structure. They worked well for 
                           
                              
                                 Σ
                              
                              
                                 0
                                 ,
                                 0
                              
                           
                        . However, for 
                           
                              
                                 Σ
                              
                              
                                 0.5
                                 ,
                                 0.1
                              
                           
                         and 
                           
                              
                                 Σ
                              
                              
                                 0.9
                                 ,
                                 0.2
                              
                           
                        , the powers became poorer and poorer.

The Srivastava test gained a little power from the correlation structure. When 
                           p
                           =
                           200
                        , its powers were lower than or equal to the three non-correlation tests for 
                           
                              
                                 Σ
                              
                              
                                 0
                                 ,
                                 0
                              
                           
                         and 
                           
                              
                                 Σ
                              
                              
                                 0.5
                                 ,
                                 0.1
                              
                           
                         and were higher than the three non-correlation tests for 
                           
                              
                                 Σ
                              
                              
                                 0.9
                                 ,
                                 0.2
                              
                           
                        . When 
                           p
                           =
                           1000
                        , its powers were lower than the three non-correlation tests except in the case of 
                           m
                           =
                           8
                         for 
                           
                              
                                 Σ
                              
                              
                                 0.5
                                 ,
                                 0.1
                              
                           
                         and 
                           
                              
                                 Σ
                              
                              
                                 0.9
                                 ,
                                 0.2
                              
                           
                        .

The powers of Thulin’s random subspaces test were universally higher than the test of Srivastava. The powers of Thulin’s test were a little bit lower than the three non-correlation tests for 
                           
                              
                                 Σ
                              
                              
                                 0
                                 ,
                                 0
                              
                           
                         and became more and more superior to those of the three non-correlation tests as the correlation increased, except in the case of 
                           p
                           =
                           1000
                        , 
                           m
                           =
                           40
                        , 
                           
                              
                                 Σ
                              
                              
                                 0.5
                                 ,
                                 0.1
                              
                           
                         (Fig. 4(d)), where the powers were approximately equal to the three non-correlation tests.

The cluster subspaces test worked well for 
                           
                              
                                 Σ
                              
                              
                                 0
                                 ,
                                 0
                              
                           
                         as well as for 
                           
                              
                                 Σ
                              
                              
                                 0.5
                                 ,
                                 0.1
                              
                           
                         and 
                           
                              
                                 Σ
                              
                              
                                 0.9
                                 ,
                                 0.2
                              
                           
                        . Its powers were obviously higher than the three non-correlation tests for 
                           
                              
                                 Σ
                              
                              
                                 0.5
                                 ,
                                 0.1
                              
                           
                         and 
                           
                              
                                 Σ
                              
                              
                                 0.9
                                 ,
                                 0.2
                              
                           
                        . When 
                           p
                           =
                           200
                        , the cluster subspaces test had performance similar to Thulin’s test. When 
                           p
                           =
                           1000
                        , the cluster subspaces test offered higher power than Thulin’s test in the case of high correlation (
                           
                              
                                 Σ
                              
                              
                                 0.9
                                 ,
                                 0.2
                              
                           
                        ) or a high number of shifted variables (
                           m
                           =
                           40
                        ).

The above tests were also used to analyze a public dataset of breast cancer.


                     Gravier et al. (2010) studied patients with small node-negative breast carcinoma without axillary lymph node involvement (T1T2N0 tumors, dataset GSE19159). They examined 2905 gene expression levels from 168 patients using comparative genomic hybridization arrays. Their sample consisted of 
                        
                           
                              n
                           
                           
                              1
                           
                        
                        =
                        111
                      patients with no event at 5 years after diagnosis (good-outcome) and 
                        
                           
                              n
                           
                           
                              2
                           
                        
                        =
                        57
                      patients with early metastasis (poor-outcome); therefore, 
                        
                           
                              k
                           
                           
                              c
                           
                        
                        =
                        110
                     .

We applied the tests to three gene-sets from the data. The first was a set of 
                        p
                        =
                        374
                      genes located on chromosome 1; the second, a set of 
                        p
                        =
                        233
                      genes located on chromosome 2; the third, a set of 
                        p
                        =
                        191
                      genes located on chromosome 12.

The hierarchical clustering of the genes is shown in Fig. 5
                     , Supplementary Figs. 2 and 3 (see Appendix A). According to Algorithm 1, the 374 genes of chromosome 1 were clustered into 12 clusters based on the cutoff distance, in which the 2nd cluster contained 128 genes (greater than 
                        
                           
                              k
                           
                           
                              c
                           
                        
                     ) and was further clustered into two sub-clusters 2a, 2b. Similarly, the 233 genes of chromosome 2 were clustered into 15 clusters based on the cutoff distance; the 191 genes of chromosome 12 were clustered into 12 clusters, and each of the clusters contained genes less than 
                        
                           
                              k
                           
                           
                              c
                           
                        
                     .

We used 
                        k
                        =
                        83
                     , 
                        
                           
                              B
                           
                           
                              1
                           
                        
                        =
                        100
                      (dimension, number of random subspaces for Thulin’s test, Thulin, 2014) and a maximum 
                        B
                        =
                        1,000,000
                      (number of random permutation resamplings) for computing the 
                        p
                     -values.

By comparing the real test statistics with those of random permutation resampling, 
                        p
                     -values could be obtained (shown in Table 2
                     ). Highly significant differences in the gene expression levels of the two patient groups were found for all three gene-sets. The Srivastava test gained some benefit from gene dependence. The random subspaces test and cluster subspaces test were more significant.

Test statistic 
                        
                           
                              T
                           
                           
                              c
                              s
                           
                        
                      was also applied to each gene-set of the obtained clusters from chromosomes 1, 2, and 12. The results are shown in Tables 3–5
                     
                     
                      and Fig. 6
                     . For chromosome 1, the overall statistic was mainly contributed from its 6th cluster; for chromosome 2, mainly from its 3rd cluster; for chromosome 12, mainly from its 6th cluster.

@&#DISCUSSION@&#

In the case of 
                        
                           
                              Σ
                           
                           
                              0
                              ,
                              0
                           
                        
                     , the three non-correlation tests (using diagonal estimators of 
                        Σ
                     ) worked well; their powers were slightly higher than those of the random subspaces test (see Figs. 3 and 4). Although Hotelling’s statistics could be computed in the subspaces, their performances were poorer at higher dimension (Bai and Saranadasa, 1996). As for the non-correlation tests, equivalent subspaces of one dimension were used, and better performances were obtained due to the low dimension in the case where there was no correlation between variables. For the cluster subspaces test, a cutoff (
                        
                           
                              r
                           
                           
                              c
                           
                        
                        =
                        0.376
                      for 
                        p
                        =
                        200
                     , 
                        
                           
                              r
                           
                           
                              c
                           
                        
                        =
                        0.437
                      for 
                        p
                        =
                        1000
                     ) was used. Therefore, in the case of 
                        
                           
                              Σ
                           
                           
                              0
                              ,
                              0
                           
                        
                      (no correlation), only about one pair of variables might be grouped together due to statistical fluctuations. For example, Supplementary Fig. 4 is a sample-pair generated under 
                        
                           
                              H
                           
                           
                              0
                           
                        
                      with 
                        p
                        =
                        200
                     , 
                        
                           
                              μ
                           
                           
                              1
                           
                        
                        =
                        
                           
                              μ
                           
                           
                              2
                           
                        
                        =
                        0
                     , 
                        Σ
                        =
                        
                           
                              Σ
                           
                           
                              0
                              ,
                              0
                           
                        
                      (see Appendix A). Only two pairs of variables were grouped together, and the remaining 196 variables each formed a subspace of one dimension. As a result, the power of the cluster subspaces test was similar to the three non-correlation tests and was somewhat higher than the random subspaces test.

In the cases of 
                        
                           
                              Σ
                           
                           
                              0.5
                              ,
                              0.1
                           
                        
                      and 
                        
                           
                              Σ
                           
                           
                              0.9
                              ,
                              0.2
                           
                        
                     , having utilized the correlations between the variables, Thulin’s random subspaces test became more and more superior to the three non-correlation tests as the correlation increased (see Figs. 3 and 4). For the cluster subspace test, the variables of each block would at first be clustered together due to the high correlations. The next step concerned the correlations between the blocks. According to the algorithm of clustering, the correlation coefficient of two blocks equals the average correlation coefficient between all pairs of variables in the two blocks. So, the statistical fluctuations of the correlation coefficients between blocks decrease due to the average effect. For example, Supplementary Fig. 5 is a sample-pair generated under 
                        
                           
                              H
                           
                           
                              0
                           
                        
                      with 
                        p
                        =
                        200
                     , 
                        
                           
                              μ
                           
                           
                              1
                           
                        
                        =
                        
                           
                              μ
                           
                           
                              2
                           
                        
                        =
                        0
                     , 
                        Σ
                        =
                        
                           
                              Σ
                           
                           
                              0.5
                              ,
                              0.1
                           
                        
                      (see Appendix A). As the correlations between the blocks were small (the expected values were 
                        b
                        =
                        0.1
                     ) and the fluctuations decreased, none of the 8 blocks was grouped together. Fig. 1 shows a sample-pair generated under 
                        
                           
                              H
                           
                           
                              0
                           
                        
                      with 
                        Σ
                        =
                        
                           
                              Σ
                           
                           
                              0.9
                              ,
                              0.2
                           
                        
                     . As the correlations between the blocks were larger (the expected values were 
                        b
                        =
                        0.2
                     ), a pair of blocks were clustered together by fluctuation, with size 50, which was less than 
                        n
                      (
                        =
                        98
                     ) and 
                        
                           
                              k
                           
                           
                              c
                           
                        
                      (
                        =
                        65
                     ). So, the clustering method can group the variables successfully. High power would be obtained due to highly correlated variables being clustered together.

We have also reduced 
                        
                           
                              k
                           
                           
                              c
                           
                        
                      by half, while the power of the test is almost unaffected.

The proposed test typically uses fewer subspaces than Thulin’s test, and the hierarchical clustering is performed only once (for the original sample-pair) in each test. Therefore, it speeds up the computational time considerably (see Table 6
                     ).

@&#CONCLUSIONS@&#

This study proposed a test that can make more efficient use of covariance structure at high dimension.

Hierarchical clustering is performed such that highly correlated variables are grouped together; the high dimension data are also projected to cluster subspaces of lower dimension in which Hotelling’s statistics can be computed.

A cutoff distance was used in calculating clusters, and the effect of statistical fluctuations was restrained.

High performance was demonstrated in simulations and real data analysis.

Supplementary Figures, the Matlab code for performing the new test and an example of computing the test power with Monte Carlo samples are included in the supplementary material and can be found online.

Supplementary material related to this article can be found online at http://dx.doi.org/10.1016/j.csda.2015.12.004.

The following is the Supplementary material related to this article. 
                        
                           MMC S1
                           
                              An example of computing the test power with Monte Carlo samples.
                           
                           
                        
                     
                     
                        
                           MMC S2
                           
                              MATLAB figure of Fig. 1 presented in the main manuscript.
                           
                           
                        
                     
                     
                        
                           MMC S3
                           
                              MATLAB figure of Fig. 2 presented in the main manuscript.
                           
                           
                        
                     
                     
                        
                           MMC S4
                           
                              MATLAB figure of Fig. 3 presented in the main manuscript.
                           
                           
                        
                     
                     
                        
                           MMC S5
                           
                              MATLAB figure of Fig. 4 presented in the main manuscript.
                           
                           
                        
                     
                     
                        
                           MMC S6
                           
                              MATLAB figure of Fig. 5 presented in the main manuscript.
                           
                           
                        
                     
                     
                        
                           MMC S7
                           
                              MATLAB figure of Fig. 6 presented in the main manuscript.
                           
                           
                        
                     
                     
                        
                           MMC S8
                           
                              MATLAB figure of Supplementary Fig. 1 presented in the online supplementary material.
                           
                           
                        
                     
                     
                        
                           MMC S9
                           
                              MATLAB figure of Supplementary Fig. 2 presented in the online supplementary material.
                           
                           
                        
                     
                     
                        
                           MMC S10
                           
                              MATLAB figure of Supplementary Fig. 3 presented in the online supplementary material.
                           
                           
                        
                     
                     
                        
                           MMC S11
                           
                              MATLAB figure of Supplementary Fig. 4 presented in the online supplementary material.
                           
                           
                        
                     
                     
                        
                           MMC S12
                           
                              MATLAB figure of Supplementary Fig. 5 presented in the online supplementary material.
                           
                           
                        
                     
                     
                        
                           MMC S13
                           
                              MATLAB code performing the test using cluster subspaces.
                           
                           
                        
                     
                     
                        
                           MMC S14
                           
                              MATLAB code performing the test using subspaces of two clusters.
                           
                           
                        
                     
                     
                        
                           MMC S15
                           
                              Supplementary Figs. 1–5.
                           
                           
                        
                     
                  

@&#REFERENCES@&#

