@&#MAIN-TITLE@&#Enriching queries with user preferences in healthcare

@&#HIGHLIGHTS@&#


               
               
                  
                     
                        
                           
                           Enriching queries using user preferences increases Information Retrieval in healthcare domain.


                        
                        
                           
                           Prioritizing user preferences improves service discovery.


                        
                        
                           
                           Conditional preference network is employed to rank user preferences.


                        
                     
                  
               
            

@&#KEYPHRASES@&#

Query enrichment

User preference

Conditional preference

@&#ABSTRACT@&#


               
               
                  Query enrichment is a process of dynamically enhancing a user query based on her preferences and context in order to provide a personalized answer. The central idea is that different users may find different services relevant due to different preferences and contexts. In this paper, we present a preference model that combines user preferences, user context, domain knowledge to enrich the initial user query. We use CP-nets to rank the preferences using implicit and explicit user preferences and domain knowledge. We present some algorithms for preferential matching. We have implemented the proposed model as a prototype. The initial results look promising.
               
            

@&#INTRODUCTION@&#

Technological advances have brought tremendous progress in healthcare. Examples are: electronic medical records, mobile health and eHealth, videoconferencing, medical decision making, remote monitoring and many more. Besides these, healthcare now can provide personalized health decisions for patients and empower patients to participate in the decision making. Recently, patient empowerment and engagement has gotten a big boost. Patient-centeredness helps patients and families and/or doctors to make informed healthcare decisions during diagnosis and treatment (Arnold, 2013).

However, these benefits of technology in healthcare are not equitably available for developing countries with their restricted infrastructure and limited resources. Illiteracy, little medical knowledge and poor or ambiguous healthcare queries are factors that hinder the realization of patient empowerment. Low infrastructure, unavailability of technologies, costs and shortage and high turnover of clinicians are some of the obstacles to realize patient-centeredness in particular and eHealth in general. These challenges and opportunities have triggered the work in this paper. Especially we have focused on the Ethiopian situation (see (Berhan, 2008; Serra, Serneels, Lindelow, & Montalvo, 2010 in general and Tegegne & Weide, 2011; Tegegne, Kanagwa, & Weide, 2010) for a more detailed description).

In this paper we focus on a basic architecture to support health workers. This architecture supports the health worker to make a diagnosis, and then tries to find the best treatment for the patient at hand adapted to the environment of this patient. The dialogue support principles have been discussed in Tegegne and Weide (2013) and are outside the scope of this paper. In this paper we focus on the enrichment of the initial (medical) query, before matching it against a body of medical knowledge and making a prioritization of the possible treatments.

Rather than setting up an advanced expert system to cover for any medical case, we use a basic Information Retrieval approach to match a diagnosis with patterns defined for typical diseases. Then we use personal and environmental information to rank the associated treatments. The diagnosis can be seen as the initial query, that is enriched by personal and environmental information.

Illiteracy and low level medical knowledge brings about poor query formulation. To this end, we incorporate personal profile and context to enrich the user initial query (which consists of signs and symptoms of the patient). This work also allows clinicians, specially community health workers (Health Extension Workers in Ethiopia context) with very limited training, to query diseases and treatments based on patients profile, symptoms and contexts.

The motive behind query enrichment is to enable low/semiliterate patients and clinicians (health workers) to create a medical query to search personalized healthcare information as well as to provide rich diagnosis and treatment options for both patients and clinicians. In general, enriching user queries using domain knowledge, personal profile and context can help to maximize cure and to minimize adverse effects, cost, and waiting time.

Queries may contain implicit preferences. This is for example the case in the query fragment Martha is 6th months pregnant. She is on HIV/AIDS regimen; currently she shows some signs of malaria. At this moment, the system should identify complications: antiretroviral may cause antimalarial resistance as well as antimalarial may affect pregnancy. Thus, while enriching the query, it is advisable to be cognizant of the impact of indirect preferences stated in the query. In the above query the woman might not have any knowledge about all the constraints resulting from her condition.

Other preferences may come from (if known) a user profile and a user context. The user profile contains interests and preferences, while the user context is considered as the actual state of the user current task. For the purpose of our paper, we see both user profile and user context as preferences for that user. In this paper we focus on handling user preferences in the context of healthcare application. Typically, the query (request) then is a consequence of a diagnosis obtained by the doctor or an automated diagnosis system. Consequently, we may assume that both user profile and user context are available upon entering the query (request).

The main purpose of this paper is to answer the following question: How to develop a general preference model for enriching queries in the context of healthcare application. This leads to the following sub-questions:
                        
                           R-1
                           What is a general preference model that can handle medical preferences (medical preferences in this context is patients treatment or medication preference)?

How is preferential matching defined in this model?

The layout of this paper is as follows. Related work is presented in Section 2. In Section 3 we show the overall architecture of the proposed system. We shortly discuss the system components and discuss the overall quality of the system. The preference model is presented in Section 4. In Section 5 we discuss the preferential similarity model. Section 6 presents the application of preference prioritization in healthcare domain; and a medical case study is discussed to test our model in Section 7. Section 8 gives a brief description of the prototype. Finally, we conclude with some future research directions in Section 9.

@&#RELATED WORK@&#

The expansion of the Internet is providing a fertile ground to access a wealth of information. As the volume of heterogeneous web resources increases and the data become more varied, a massive response is issued to user queries. That makes it hard to distinguish relevant information from irrelevant or secondary information. Nowadays, various mechanisms are employed to enhance user queries, such as reformulation user queries, expanding query terms, adding a user profile and considering the user context.

Query enrichment is the process of transforming the initial query into a form that more adequately reflects the information need of the user. Query enrichment in this paper focuses on enhancing the initial user query by incorporating user profile, user context and medical knowledge. It is different from query reformulation and query expansion, which deals with rewriting the initial user query by adding or removing words, phrases or clauses. In some systems, expansion terms are added to the query by the user (interactive query expansion (Efthimiadis, 2000), like the Google search engine), while other systems the expansion terms are added by the search engine or system itself (automatic query expansion).

The query enrichment we propose here varies between query reformulation and query expansion. The enrichment is performed automatically by fetching the user profile, the user context and domain knowledge from the database and does not involve the user intervention.


                     Asfari, Doan, Bourda, and Sansonnet (2010) use user profiles and user tasks to improve user queries. They consider the state of user’s task at a specified time. The drawback of this approach is that it does not take into account user’s preference relations, preference ranking, etc. Query enrichment by integrating the user profile is addressed by Koutrika and Ioannidis (2010) and Kießling (2002).

Several authors propose a scheme for query enrichment by relevance feedback, beginning the search with an initial query and then modifying it by relevance judgments of the user (Bhogal, Macfarlane, & Smith, 2007). Then term expansion is used to reformulate the user query (Bai & Nie, 2008).

Different approaches are used for the process of query enrichment; for example Conesa, Storey, and Sugumaran (2008) try to formulate the user query by using semantic knowledge, while others use term relations to expand the user’s initial query (Bai & Nie, 2008). Bhogal et al. (2007) and Sieg, Mobasher, and Burke (2007) propose ontology based query expansion. Semantic based query term relations in order to enhance queries is addressed by Benz, Krause, Kumar, Hotho, and Stumme (2009).


                     Zaynai, Pèninou, Canut, and Sédes (2009) introduce a system that offers interactive query enrichment by using user profiles. This study uses an incremental query enrichment process based on user preferences. The study also involves negative preferences to enrich the query. Contextual information, however is not used.

The medical query generator (MQG) that can generate a keyword based query from a natural language description of a medical information need is presented by the work of Liu, He, Jiang, and Rong (2007). MGQ generates a query by selecting terms from the user request that have strong term-category correlation to medical categories.

Enriching user queries requires personal information about the user such as user profile and user context. We start by explaining the concept of personalization and acquisition of user profile, user context and elicitation. Then we go into more detail with the matchmaking process.

Personalization is the adoption and arrangement of information and services in coherence to a single user or a group of users. It requires permanently optimizing the presented information to the user’s needs. It involves using technology to accommodate the differences between individuals.


                        James (2013) defines personalization as “Personalization technology enables the dynamic insertion, customization or suggestion of content in any format that is relevant to the individual user, based on the users implicit behavior and preferences, and explicitly given details”. Personalization is a means of meeting user’s needs more effectively and efficiently, making interactions faster and easier and, consequently, increasing user satisfaction. Personalization depends on the gathering and use of personal information, consequently, privacy issues are a major concern. An important aspect of personalization is the creation of a high quality user profile that provides an accurate representation of user interests (Ramanathan & Kapoor, 2009).

A user profile is a representation of information about an individual user that is essential for the application at hand. A user profile addresses aspects, such as interests, knowledge, background, skills, goals, behavior, interaction preferences and characteristics of an individual user.

User profiles are divided into two main types: static and dynamic profiles. A static profile deals with static aspects such as demographic data and hobbies, whereas the dynamic user profile covers the aspects that are changing through time. Koutrika and Ioannidis (2010) stated that query personalization is dynamically enhancing a query with related user preferences. We further divide the dynamic user profile in a short term and long term profile. The short term profile records changes based on the status and situation of the user, while the long term profile focuses on changes over a longer period (weeks, months, years). A user profile can be positive (recording preferences) or negative (focusing on dislikes).

User profiles can also be categorized into individual and group profiles. An individual profile consists of individual demographic data, preferences, interests and needs whereas group profiles encompass profiles and preferences of groups. For example in the healthcare domain, there are two main groups: patients and healthcare workers. Patients for example can be further grouped according to disease type (diabetes, HIV/AIDS, Tuberculosis, etc.) while healthcare workers may be grouped by their profession (physicians, nurses, etc.). Group profiles are vital in those domains where it is necessary to make recommendations to groups of users rather than to individual users.

To acquire a user profile, the information provided by the user may be explicitly processed by direct questioning, or implicitly through the observation of user actions/behavior, or through other recommender system approaches by employing relations with other users or objects. The simplest way of obtaining information about users is through the data they input via the user interfaces provided. Besides, user profiles are also obtained from implicitly collected information gathered from user behavior or user feedback. Accordingly, Gauch, Speretta, Chandramouli, and Micarelli (2007) give an overview of the most popular techniques used to collect implicit feedback, and the type of information about the user that can be inferred from the user’s behavior (user’s browsing history, browsing activity, search logs, etc.).

A user context is the description of (relevant) aspects of the current situation of the user.


                           Göker and Myrhaug (2002) define five dimensions of a medical user context: (1) Environment context, (2) personal context: is physiological (such as blood pressure, glucose level, and pulse) and mental (mood, stress, angriness, emotion, etc.), (3) task context, (4) social context and (5) spatial–temporal context.

A user context can be captured implicitly and explicitly. Users can provide contextual information such as location, temperature, and personal context. On the other hand the user context can be captured automatically from sensors, cameras or satellites. The user mental context can be particularly extracted from the user’s conversation.

In Section 3.1 we will discuss the dialogue system that forms the main man–machine interface for our system. We assume there is some prescribe request format for incoming requests. The dialogue system will help the calling user to complete the request according to this format. After being activated by the user, the dialogue system will ask typical questions that enable the system to find the elements of the prescribed request format. Some elements will have a discrete range of possible values. A typical example is a yes/no question. Answers on such questions are easily obtained by multiple-choice questions.

Other elements require a description by the user, and require an open question. Such questions will be answered in natural language. Natural language has the potential to be a precise specification language provided it is used well. But there are not many people who can use natural language in a consistent, non-verbose, expressed on a same level of abstraction, complete, and unambiguous way (Frederiks & Weide, 2009).

Therefore we assume the use of natural language to be restricted by vocabulary and sentence constructions, such as to avoid problems. Such a restricted natural language format is referred to as controlled language. According to Wyner et al. (2010): roughly speaking, controlled natural languages (sometimes simply called “controlled languages”) are artificially defined languages that coincide with (or are at least close to) a subset of a particular natural language.

We assume the dialogue system guides the user during answering an open question in formulating the answer according to a controlled language format. It will be the task of the dialogue system to help and guide the user to convert the answer on an open questions into this controlled language format.

Note that the controlled language format will help to avoid disambiguates, and will enforce the searcher in using the restricted set of terms from the controlled language. The advantage of using a controlled language is that it will also help to reduce the complexity of building an adequate user interface agent (Mészáros & Dobrowiecki, 2009).

Matchmaking is the process of finding knowledge or services that satisfy a given request. Matchmaking is divided into exact and partial matching. Matchmaking is based on the comparison of the description of knowledge and services with a request (Grimm, 2007). Matchmaking can be syntax- or semantic-based or be hybrid (Tsetsos, Anagnostopoulos, & Hadjiefthymiades, 2007, chap. XI).

Semantic matchmaking is not only based on the syntax of both the query and the description language, but also involves the semantics (meaning) of the constructs. Thus a semantic matchmaking algorithm should consider the meaning of concepts while comparing demand and supply (Bellur & Kulkarni, 2007; Paolucci, Kawamura, Payne, & Sycara, 2002). It should consider the various relations between the concepts that are stored in the repository In our case we will have both a knowledge and a services repository.

The quality of matching very much depends on the quality of the request and the quality of the description of the knowledge objects offered in the knowledge repository or service repository. This quality also depends on the expressive power of the description languages to describe single or compound objects (Grimm, 2007). In many cases the matching process has a Boolean result, i.e. the information or service object is either relevant or not (Grimm, 2007).

The next points relate more to services being offered in the service repository. Sycara, Paolucci, Soudry, and Srinivasan (2004) proposed LARKS, a methodology for service matchmaking using input and output of service request and service advertisement. The matching process uses TF-IDF to measure the service request and service descriptions and other ontology based measurement.


                        Paolucci et al. (2002) proposed four matching methods of functional properties of services request and services offerings. They use logic based reasoning for checking similarities. Bellur and Kulkarni (2007) use the same analogy of Paolucci et al. notion but it reverse the plug-in and subsumption presentation.

A comprehensive early approach has also presented by Cardoso and Sheth (2003). Cardoso and Sheth regard several aspects of service-based workflow composition, including semantic-based matchmaking of functionalities, non-functional requirements, and service interoperability. Guo, Chen, and Le (2005) present a bipartite graph based matchmaking algorithm.

HealthFinland (Suominen, Hyvonen, Viljanen, & Hukka, 2009) is an intelligent semantic portal that provides relevant health information retrieved from the web. It helps to find relevant health information using basic terms without the need of technical medical terminologies. The limitation of the HealthFinland is that personalized search is not addressed.


                        Redd, Rindflesch, Nebeker, and Zeng-Treitler (2013) proposed three different expansion methods using knowledge derived from medical thesaurus, medical literature, and clinical notes. They developed MeSH (The Medical Subject Heading a semantic medical knowledge resource developed by the National Library of Medicine of the United States) based query expansion by creating the MeSH indexer. However, this method fails to take into account the context of the user and information about user’s situation and preferences.

Personalized Health Information Retrieval System (PHIRS) (Wang, Yang, & Xu, 2005; Wang & Liu, 2005) is a health information recommendation system that addresses user modeling and implements a user-profile matching that customizes the retrieved health information to match the individuals needs. A limitation of PHIRS is that it does not provide detailed information about the medical concepts and that it does not touch personalization and does not involve the environmental context.

In the architecture that we will propose in the next section, we incorporate user preference, user context and domain knowledge in the process of query enrichment.

The overall architecture of our system is displayed in Fig. 1
                     .

The architecture is set up to streamline this communication. To allow effective separation of concerns, our system has been split into the following three main sub-systems:
                        
                           1.
                           The dialogue system 
                                 
                                    D
                                 
                              : This sub-system is like a receptionist, it handles the interrogation of the users in order to obtain a well-structured request. The dialogue system communicates with the user on the basis of text.

The query interpreter 
                                 
                                    Q
                                    I
                                 
                              : This sub-system enriches the incoming request into a well-defined query. The query interpreter typically personalizes the request of the user and extends it with context information.

The match maker 
                                 
                                    M
                                 
                              : This sub-system answers the enriched query by matching against the available resources. The match maker tries to come up with a well-chosen composition of atomic resources that are known to the match maker. Would the match maker fail to find a proper match, then it may request advice from an external (human) expert.

The obvious consequences of splitting our system include a possibility for module-wise testing; for example, the dialogue system can be tested as a separate module. The combination of query interpreter and match maker can be tested by feeding well-structured queries directly by hand into the query interpreter. In addition, the different components can be designed to interact in a service-oriented manner.

The dialogue system (in Fig. 2
                        ) is interviewing the user in order to fill out as complete as possible a request that will be sent to the next system component, the query interpreter. As discussed in our previous work (Tegegne et al., 2010) the query interpreter uses elicitation techniques during this interview. The resulting request 
                           
                              
                                 
                                    s
                                 
                                 
                                    q
                                 
                              
                           
                         is the output of 
                           
                              D
                           
                        , and will in the architecture of Fig. 3
                         be fed into the query interpreter 
                           
                              Q
                              I
                           
                         and will also be stored in the user profile.

The dialogue system typically is a process of elicitation of user requirements. The quality of the resulting request is most essential for the quality of the response that will be given by the system.

The query interpreter (
                           
                              Q
                              I
                           
                        , see Fig. 3) interprets the user query 
                           
                              
                                 
                                    s
                                 
                                 
                                    q
                                 
                              
                           
                         that is received from the dialogue system. 
                           
                              Q
                              I
                           
                         enriches this query by extracting and fetching profile information from the User Profile Repository and context information from the Context Repository. After completion, the 
                           
                              Q
                              I
                           
                         forwards the enriched query 
                           
                              
                                 
                                    q
                                 
                                 
                                    r
                                 
                              
                           
                         to the matchmaker.

The match maker 
                           
                              M
                           
                         will match the enriched query 
                           
                              
                                 
                                    q
                                 
                                 
                                    r
                                 
                              
                           
                         with the services being offered, using the Services Repository and the Knowledge Repository (see Fig. 4
                        ). From the Knowledge Repository the candidate diseases and their treatments are selected based on the enriched query. The Services Repository then is used to find services such as take care of the delivery of the required medicines.

The match maker will try to find a compound service that is of sufficient quality. If in doubt, the match maker may address a request for extra information to the query interpreter. If the query interpreter cannot answer the question by itself, then it will address an additional request to the dialogue system, or it will forward a request to the supporting expert center (a center consists of a group of specialized doctors and nurses in order to give health assistances on phone or face-to-face).

Personalized service discovery is designed to provide services that match a user’s personal interest and thus provide more effective and efficient services discovery. A key feature in developing successful service discovery is to build a profile that accurately represents the preferences and interests of the user. User preferences are typically incomplete and, our knowledge of them is imperfect and partial (Koutrika & Ioannidis, 2010). We first will describe a preference modeling method, and then discuss how this is involved in the matching process.

According to Kießling (2002), see also Kießling, Endres, and Wenzel (2011), (i) Preferences are personalized wishes; (ii) There may consist incomparable items; (iii) “Better than” may be defined qualitatively and quantitatively; (iv) Preferences may be complex, covering multiple attributes; (v) Preferences may come from different, even conflicting sources.

According to Boutilier, Brafman, Domshlak, Hoos, and Poole (2004), based on Keeney and Haiffa (1976), a preference ranking is a total order 
                        
                           ⪯
                        
                      on a set of outcomes 
                        
                           O
                        
                     , where 
                        
                           
                              
                                 o
                              
                              
                                 1
                              
                           
                           ⪯
                           
                              
                                 o
                              
                              
                                 2
                              
                           
                        
                      is interpreted as: the decision maker prefers the outcome 
                        
                           
                              
                                 o
                              
                              
                                 2
                              
                           
                        
                      above 
                        
                           
                              
                                 o
                              
                              
                                 1
                              
                           
                        
                     . The outcome 
                        
                           
                              
                                 o
                              
                              
                                 2
                              
                           
                        
                      is strictly more preferred than 
                        
                           
                              
                                 o
                              
                              
                                 1
                              
                           
                           ,
                           
                           
                              
                                 o
                              
                              
                                 2
                              
                           
                        
                      is strictly more preferred than 
                        
                           
                              
                                 o
                              
                              
                                 1
                              
                           
                        
                     
                     
                        
                           )
                        
                      if and only if 
                        
                           
                              
                                 o
                              
                              
                                 2
                              
                           
                           ⪯
                           
                              
                                 o
                              
                              
                                 1
                              
                           
                        
                      but 
                        
                           
                              
                                 o
                              
                              
                                 1
                              
                           
                           ⪯
                           
                              
                                 o
                              
                              
                                 2
                              
                           
                        
                      or 
                        
                           
                              
                                 o
                              
                              
                                 1
                              
                           
                           
                           ≺
                           
                           
                              
                                 o
                              
                              
                                 2
                              
                           
                        
                     , when 
                        
                           
                              
                                 o
                              
                              
                                 1
                              
                           
                           ⪯
                           
                              
                                 o
                              
                              
                                 2
                              
                           
                           
                           ∧
                           
                           
                              
                                 o
                              
                              
                                 2
                              
                           
                           ⪯
                           
                              
                                 o
                              
                              
                                 1
                              
                           
                        
                     . The decision maker is indifferent to 
                        
                           
                              
                                 o
                              
                              
                                 1
                              
                           
                        
                      and 
                        
                           
                              
                                 o
                              
                              
                                 2
                              
                           
                        
                     , denoted as 
                        
                           
                              
                                 o
                              
                              
                                 1
                              
                           
                           ∼
                           
                              
                                 o
                              
                              
                                 2
                              
                           
                        
                     , when 
                        
                           
                              
                                 o
                              
                              
                                 1
                              
                           
                           ⪯
                           
                              
                                 o
                              
                              
                                 2
                              
                           
                           
                           ∧
                           
                           
                              
                                 o
                              
                              
                                 2
                              
                           
                           ⪯
                           
                              
                                 o
                              
                              
                                 1
                              
                           
                        
                      or 
                        
                           
                              
                                 o
                              
                              
                                 1
                              
                           
                           ⪯
                           
                              
                                 o
                              
                              
                                 2
                              
                           
                           
                           ∧
                           
                           
                              
                                 o
                              
                              
                                 2
                              
                           
                           ⪯
                           
                              
                                 o
                              
                              
                                 1
                              
                           
                        
                     . In this paper we will choose 
                        
                           ≺
                        
                      as the base order relation.

In this section, we first introduce the relational model as a mechanism to describe for some application domain the relevant concepts, their relations and their properties. In the line of relational algebra, we then use this conceptual description to describe preferences. Finally we show how CP-nets can be used as a graphical support to describe preferences.

In the relational approach, an application domain is described by recognizing the relevant categories of things (Wyner et al., 2010), how they are described by attributes (measurable properties recognized in the application domain) and how they relate to each other. Let 
                           
                              A
                           
                         be the set of attributes. Each attribute A has associated a domain 
                           
                              Dom
                              (
                              A
                              )
                           
                         of possible values. Following conventions from relational algebra (Maier, 1988), we will adopt the term relational scheme to refer to a set of attributes. Let R be a relational scheme, then 
                           
                              R
                              ⊆
                              A
                           
                        . The domain 
                           
                              Dom
                              (
                              R
                              )
                           
                         of a relational scheme R is defined as the set of all possible mappings from attributes onto adequate values:
                           
                              
                                 Dom
                                 (
                                 R
                                 )
                                 =
                                 
                                    
                                       
                                          f
                                          :
                                          R
                                          →
                                          Values
                                          |
                                          
                                             
                                                ∀
                                             
                                             
                                                A
                                                ∈
                                                R
                                             
                                          
                                          [
                                          f
                                          (
                                          A
                                          )
                                          ∈
                                          Dom
                                          (
                                          A
                                          )
                                          ]
                                       
                                    
                                 
                              
                           
                        A relational model 
                           
                              R
                              =
                              〈
                              A
                              ,
                              Dom
                              ,
                              T
                              ,
                              R
                              〉
                           
                         of an application domain consists of:
                           
                              •
                              A set 
                                    
                                       A
                                    
                                  of attributes, and a function 
                                    
                                       Dom
                                    
                                  assigning elementary domains to these attributes.

A set 
                                    
                                       T
                                    
                                  of base tables. Each base table describes a specific category of things recognized in the application domain. Each base table consists of a unique name and a relational schema.

A set 
                                    
                                       R
                                    
                                  of population rules, also referred to as constraints. In the relational model, functional dependencies, multi-valued dependencies, keys and foreign keys are the most common constraints. Other constraints are expressed in terms of relational algebra.

Each state of the application domain is represented by a (unique) population of the base tables such that the population rules are satisfied. Let 
                           
                              Pop
                           
                         be a population of relational model R, then we have for the induced population 
                           
                              Pop
                              (
                              T
                              )
                           
                         of each base table 
                           
                              T
                              :
                              Pop
                              (
                              T
                              )
                              ⊆
                              Dom
                              (
                              R
                              )
                           
                        .

In this paper we will roughly follow the approach by Kießling (2002), but introduce the model slightly different, and in a more formal way. Preferences will be defined in the context of a relational model 
                           
                              R
                              =
                              〈
                              A
                              ,
                              Dom
                              ,
                              T
                              ,
                              R
                              〉
                           
                        . A preference P involves a set 
                           
                              Attrs
                              (
                              P
                              )
                           
                         of attributes and induces a strict partial order 
                           
                              ≺
                              [
                              P
                              ,
                              T
                              ]
                           
                         on each population 
                           
                              Pop
                              (
                              T
                              )
                           
                         for each base table 
                           
                              T
                              =
                              〈
                              N
                              ,
                              R
                              〉
                           
                         such that 
                           
                              Attrs
                              (
                              P
                              )
                              ⊆
                              R
                           
                        . This allows us, in contrast to Kießling (2002), to make preferences population-dependent. Later we will see how preference expressions are constructed and how the induced partial order is derived from these expressions. Therefore we will use 
                           
                              ≺
                              [
                              P
                              ]
                           
                         rather than the table-dependent notation 
                           
                              ≺
                              [
                              P
                              ,
                              T
                              ]
                           
                        .

A preference may be restricted to some set of states. Following the Evening Dress example taken from Boutilier et al. (2004), the preference of the suit color is different for the various combinations of the color of the jacket and the pants. In general, let D be a relational algebra condition describing the domain condition, and P be a preference. Then 
                           
                              D
                              
                              ↣
                              
                              P
                           
                         is a conditional preference over attributes 
                           
                              Attrs
                              (
                              P
                              )
                           
                        , that induces a strict partial order 
                           
                              ≺
                              [
                              P
                              ,
                              T
                              ]
                           
                         on each population 
                           
                              Pop
                              (
                              T
                              )
                           
                         satisfying condition D (or: 
                           
                              Pop
                              (
                              T
                              )
                              ⊨
                              D
                           
                        ) according to the preference expressed in P.
                           
                              
                                 x
                                 
                                 ≺
                                 
                                 [
                                 D
                                 
                                 ↣
                                 
                                 P
                                 ]
                                 y
                                 
                                 ≜
                                 
                                 D
                                 (
                                 x
                                 )
                                 
                                 ∧
                                 
                                 D
                                 (
                                 y
                                 )
                                 
                                 ∧
                                 
                                 x
                                 
                                 ≺
                                 
                                 [
                                 P
                                 ]
                                 y
                              
                           
                        
                     

A strict partial order is a binary relation that is irreflexive and transitive:
                           
                              1.
                              Irreflexive: 
                                    
                                       ¬
                                       x
                                       
                                       ≺
                                       
                                       [
                                       P
                                       ]
                                       x
                                    
                                 
                              

Transitive: 
                                    
                                       x
                                       
                                       ≺
                                       
                                       [
                                       P
                                       ]
                                       y
                                       
                                       ∧
                                       
                                       y
                                       
                                       ≺
                                       
                                       [
                                       P
                                       ]
                                       z
                                       ⇒
                                       x
                                       
                                       ≺
                                       
                                       [
                                       P
                                       ]
                                       z
                                    
                                 
                              

Note that strict partial orders do not have cycles, since 
                           
                              x
                              
                              ≺
                              
                              [
                              P
                              ]
                              y
                              
                              ∧
                              
                              y
                              
                              ≺
                              
                              [
                              P
                              ]
                              x
                           
                         by applying the transitivity rule would lead to a violation of the irreflexivity rule. An order relation is called total if each two elements are comparable:
                           
                              (1)
                              
                                 x
                                 
                                 ≺
                                 
                                 [
                                 P
                                 ]
                                 y
                                 
                                 ∨
                                 
                                 y
                                 
                                 ≺
                                 
                                 [
                                 P
                                 ]
                                 x
                                 
                                 ∨
                                 
                                 x
                                 =
                                 y
                              
                           
                        The order relation 
                           
                              ≺
                              [
                              P
                              ]
                           
                         in general will not be total. We will call x and y incomparable by order relation 
                           
                              ≺
                              [
                              P
                              ]
                           
                        , denoted as 
                           
                              x
                              ∼
                              [
                              P
                              ]
                              y
                           
                         when neither preference holds:
                           
                              
                                 x
                                 ∼
                                 [
                                 P
                                 ]
                                 y
                                 
                                 ≜
                                 
                                 ¬
                                 (
                                 x
                                 
                                 ≺
                                 
                                 [
                                 P
                                 ]
                                 y
                                 
                                 ∨
                                 
                                 y
                                 
                                 ≺
                                 
                                 [
                                 P
                                 ]
                                 x
                                 )
                              
                           
                        We also introduce the following non-strict partial order:
                           
                              
                                 x
                                 
                                 ⪯
                                 
                                 [
                                 P
                                 ]
                                 y
                                 
                                 ≜
                                 
                                 x
                                 
                                 ≺
                                 
                                 [
                                 P
                                 ]
                                 y
                                 
                                 ∨
                                 
                                 x
                                 [
                                 Attrs
                                 (
                                 P
                                 )
                                 ]
                                 =
                                 y
                                 [
                                 Attrs
                                 (
                                 P
                                 )
                                 ]
                              
                           
                        where 
                           
                              f
                              [
                              A
                              ]
                           
                         is the restriction of function f to domain A. This defines a partial order.

Preferences also provide an strict partial order on larger domains. Let P be a preference, and let x and y be functions defined on domain 
                           
                              B
                              
                              ⊇
                              
                              Attrs
                              (
                              P
                              )
                           
                        , then
                           
                              
                                 x
                                 
                                 ≺
                                 
                                 [
                                 P
                                 ]
                                 y
                                 
                                 ≜
                                 
                                 x
                                 [
                                 Attrs
                                 (
                                 P
                                 )
                                 ]
                                 
                                 ≺
                                 
                                 [
                                 P
                                 ]
                                 y
                                 [
                                 Attrs
                                 (
                                 P
                                 )
                                 ]
                              
                           
                        If 
                           
                              x
                              ∈
                              Dom
                              (
                              B
                              )
                           
                         and 
                           
                              B
                              
                              ⊇
                              
                              A
                           
                        , then the functions 
                           
                              x
                              [
                              A
                              ]
                           
                         and 
                           
                              x
                              [
                              B
                              -
                              A
                              ]
                           
                         can be combined: 
                           
                              x
                              [
                              A
                              ]
                              
                              ∪
                              
                              x
                              [
                              B
                              -
                              A
                              ]
                              =
                              x
                           
                        . We will prefer to use the join operator to denote this combination: 
                           
                              x
                              [
                              A
                              ]
                              
                              ⋈
                              
                              x
                              [
                              B
                              -
                              A
                              ]
                              =
                              x
                           
                        .

Each relational scheme R has associated 
                           
                              
                                 
                                    ∅
                                 
                                 
                                    R
                                 
                              
                           
                         as empty preference. This preference induces on relational scheme R (i.e., 
                           
                              Attrs
                              (
                              
                                 
                                    ∅
                                 
                                 
                                    R
                                 
                              
                              )
                              =
                              R
                           
                        ) the following strict partial order on 
                           
                              Dom
                              (
                              R
                              )
                           
                        :
                           
                              
                                 x
                                 
                                 ≺
                                 
                                 [
                                 
                                    
                                       ∅
                                    
                                    
                                       R
                                    
                                 
                                 ]
                                 y
                                 
                                 ≜
                                 
                                 false
                              
                           
                        It is easily verified that the binary relation 
                           
                              ≺
                              [
                              
                                 
                                    ∅
                                 
                                 
                                    R
                                 
                              
                              ]
                              
                              ⊆
                              
                              Dom
                              (
                              R
                              )
                              ×
                              Dom
                              (
                              R
                              )
                           
                         is a strict partial order on 
                           
                              Dom
                              (
                              R
                              )
                           
                        . We will write 
                           
                              ∅
                           
                         rather than 
                           
                              
                                 
                                    ∅
                                 
                                 
                                    R
                                 
                              
                           
                         when R is obvious from the context.

Let A be an attribute, then the following expressions are (atomic) preferences with attribute set 
                           
                              
                                 
                                    
                                       
                                          
                                             
                                                A
                                             
                                          
                                       
                                    
                                 
                              
                           
                        :
                           
                              •
                              Explicit enumeration: 
                                    
                                       EXPL
                                       (
                                       A
                                       ,
                                       〈
                                       E
                                       〉
                                       )
                                    
                                 , where E is an expression generated by the following syntax diagram (also referred to as rail diagram, see Wirth (1973)):
                                    
                                 
                              

An explicit enumeration scheme is a special way to denote any concrete (final) preferential structure. The associated preference relation is defined by:
                                    
                                       
                                          x
                                          
                                          ≺
                                          
                                          [
                                          EXPL
                                          (
                                          A
                                          ,
                                          〈
                                          E
                                          +
                                          +
                                          F
                                          〉
                                          )
                                          ]
                                          y
                                          
                                          ≜
                                          
                                          (
                                          x
                                          =
                                          E
                                          
                                          ∧
                                          
                                          y
                                          ∈
                                          F
                                          )
                                          
                                          ∨
                                          
                                          (
                                          x
                                          ∈
                                          E
                                          
                                          ∧
                                          
                                          y
                                          ∈
                                          F
                                          )
                                          
                                          ∨
                                          
                                          x
                                          
                                          ≺
                                          
                                          [
                                          EXPL
                                          (
                                          A
                                          ,
                                          〈
                                          E
                                          〉
                                          )
                                          ]
                                          y
                                          
                                          ∨
                                          
                                          x
                                          
                                          ≺
                                          
                                          [
                                          EXPL
                                          (
                                          A
                                          ,
                                          〈
                                          F
                                          〉
                                          )
                                          ]
                                          y
                                       
                                    
                                 
                              

Minimal value: 
                                    
                                       LOWEST
                                       (
                                       A
                                       ,
                                       <
                                       )
                                    
                                 .

Assuming 
                                    
                                       Dom
                                       (
                                       A
                                       )
                                    
                                  is (partially) ordered by relation 
                                    
                                       <
                                    
                                 . This preference indicates that a smaller value is preferred above a larger value:
                                    
                                       
                                          x
                                          
                                          ≺
                                          
                                          [
                                          LOWEST
                                          (
                                          A
                                          ,
                                          <
                                          )
                                          ]
                                          y
                                          
                                          ≜
                                          
                                          y
                                          <
                                          x
                                       
                                    
                                 We will omit the ordering relation when it is obvious from the context, and write 
                                    
                                       LOWEST
                                       (
                                       A
                                       )
                                    
                                 .

Utility based: 
                                    
                                       Util
                                       (
                                       A
                                       ,
                                       u
                                       )
                                    
                                 .

Let u be a real-valued (utility) function based on the set A of attributes, then 
                                    
                                       Util
                                       (
                                       A
                                       ,
                                       u
                                       )
                                    
                                  is a preference with attribute set A expressing that tuples are preferred according to their utility value.
                                    
                                       
                                          x
                                          
                                          ≺
                                          
                                          [
                                          Util
                                          (
                                          A
                                          ,
                                          u
                                          )
                                          ]
                                          y
                                          
                                          ≜
                                          
                                          u
                                          (
                                          x
                                          [
                                          A
                                          ]
                                          )
                                          <
                                          u
                                          (
                                          y
                                          [
                                          A
                                          ]
                                          )
                                       
                                    
                                 
                              

Let P be a preference, then 
                           
                              REV
                              (
                              P
                              )
                           
                         also is a preference, reversing the preferential order 
                           
                              ≺
                              [
                              P
                              ]
                           
                         induced by P, with the same attribute set: 
                           
                              Attrs
                              (
                              REV
                              (
                              P
                              )
                              )
                              =
                              Attrs
                              (
                              P
                              )
                           
                        .

Preferences 
                           
                              
                                 
                                    P
                                 
                                 
                                    1
                                 
                              
                           
                         and 
                           
                              
                                 
                                    P
                                 
                                 
                                    2
                                 
                              
                           
                         may be combined by intersection aggregation or its weaker variant as follows.
                           
                              1.
                              Intersection aggregation: 
                                    
                                       
                                          
                                             P
                                          
                                          
                                             1
                                          
                                       
                                       
                                       ⋈
                                       
                                       
                                          
                                             P
                                          
                                          
                                             2
                                          
                                       
                                    
                                 , defined as:
                                    
                                       
                                          x
                                          
                                          ≺
                                          
                                          [
                                          
                                             
                                                P
                                             
                                             
                                                1
                                             
                                          
                                          
                                          ⋈
                                          
                                          
                                             
                                                P
                                             
                                             
                                                2
                                             
                                          
                                          ]
                                          y
                                          
                                          ≜
                                          
                                          x
                                          
                                          ≺
                                          
                                          [
                                          
                                             
                                                P
                                             
                                             
                                                1
                                             
                                          
                                          ]
                                          y
                                          
                                          ⊼
                                          
                                          x
                                          
                                          ≺
                                          
                                          [
                                          
                                             
                                                P
                                             
                                             
                                                2
                                             
                                          
                                          ]
                                          y
                                       
                                    
                                 where 
                                    
                                       a
                                       
                                       ⊼
                                       
                                       b
                                    
                                  has outcome true if both a and b are true, and is undefined otherwise. So this operator yields those cases where 
                                    
                                       
                                          
                                             P
                                          
                                          
                                             1
                                          
                                       
                                    
                                  and 
                                    
                                       
                                          
                                             P
                                          
                                          
                                             2
                                          
                                       
                                    
                                  agree on their preference.
                                    Algorithm 1
                                    Intersection aggregation
                                          
                                             
                                                
                                                
                                                   
                                                      1: if 
                                                         
                                                            
                                                               x
                                                               
                                                               ≺
                                                               
                                                               [
                                                               
                                                                  
                                                                     P
                                                                  
                                                                  
                                                                     1
                                                                  
                                                               
                                                               ]
                                                               y
                                                            
                                                          
                                                         then
                                                      
                                                   
                                                   
                                                      2: 
                                                         return 
                                                         
                                                            
                                                               x
                                                               
                                                               ≺
                                                               
                                                               [
                                                               
                                                                  
                                                                     P
                                                                  
                                                                  
                                                                     2
                                                                  
                                                               
                                                               ]
                                                               y
                                                            
                                                         ;
                                                   
                                                   
                                                      3: end if
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    

Weak intersection aggregation: 
                                    
                                       
                                          
                                             P
                                          
                                          
                                             1
                                          
                                       
                                       
                                       ▷
                                       
                                       
                                          
                                             P
                                          
                                          
                                             2
                                          
                                       
                                    
                                 , defined as:
                                    
                                       
                                          x
                                          
                                          ≺
                                          
                                          [
                                          
                                             
                                                P
                                             
                                             
                                                1
                                             
                                          
                                          ▷
                                          
                                             
                                                P
                                             
                                             
                                                2
                                             
                                          
                                          ]
                                          y
                                          
                                          ≜
                                          
                                          x
                                          
                                          ≺
                                          
                                          [
                                          
                                             
                                                P
                                             
                                             
                                                1
                                             
                                          
                                          ]
                                          y
                                          
                                          ⊼
                                          
                                          x
                                          ⪯
                                          [
                                          
                                             
                                                P
                                             
                                             
                                                2
                                             
                                          
                                          ]
                                          y
                                       
                                    
                                 The difference with the previous case is that the second preference is allowed not to agree when the tuples are the same on 
                                    
                                       Attrs
                                       (
                                       
                                          
                                             P
                                          
                                          
                                             2
                                          
                                       
                                       )
                                    
                                 .
                                    Algorithm 2
                                    Weak intersection
                                          
                                             
                                                
                                                
                                                   
                                                      1: if 
                                                         
                                                            
                                                               x
                                                               
                                                               ≺
                                                               
                                                               [
                                                               
                                                                  
                                                                     P
                                                                  
                                                                  
                                                                     1
                                                                  
                                                               
                                                               ]
                                                               y
                                                            
                                                          
                                                         then
                                                      
                                                   
                                                   
                                                      2: 
                                                         return 
                                                         
                                                            
                                                               x
                                                               
                                                               ⪯
                                                               
                                                               
                                                                  
                                                                     P
                                                                  
                                                                  
                                                                     1
                                                                  
                                                               
                                                               2
                                                               y
                                                            
                                                         ;
                                                   
                                                   
                                                      3: end if
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    

It is also possible to make a prioritization between preferences 
                                    
                                       
                                          
                                             P
                                          
                                          
                                             1
                                          
                                       
                                    
                                  and 
                                    
                                       
                                          
                                             P
                                          
                                          
                                             2
                                          
                                       
                                    
                                 :

Predilection: 
                                    
                                       
                                          
                                             P
                                          
                                          
                                             1
                                          
                                       
                                       
                                       &
                                       
                                       
                                          
                                             P
                                          
                                          
                                             2
                                          
                                       
                                    
                                 , defined as:
                                    
                                       
                                          x
                                          
                                          ≺
                                          
                                          [
                                          
                                             
                                                P
                                             
                                             
                                                1
                                             
                                          
                                          
                                          &
                                          
                                          
                                             
                                                P
                                             
                                             
                                                2
                                             
                                          
                                          ]
                                          y
                                          
                                          ≜
                                          
                                          x
                                          [
                                          
                                             
                                                P
                                             
                                             
                                                1
                                             
                                          
                                          ]
                                          y
                                          
                                          ⊻
                                          
                                          x
                                          
                                          [
                                          
                                             
                                                P
                                             
                                             
                                                1
                                             
                                          
                                          
                                          ⋈
                                          
                                          
                                             
                                                P
                                             
                                             
                                                2
                                             
                                          
                                          ]
                                          y
                                       
                                    
                                 where 
                                    
                                       a
                                       
                                       ⊻
                                       
                                       b
                                    
                                  has outcome true if either a is true or a is undefined and b. In this case preference 
                                    
                                       
                                          
                                             P
                                          
                                          
                                             1
                                          
                                       
                                    
                                  has priority above preference 
                                    
                                       
                                          
                                             P
                                          
                                          
                                             2
                                          
                                       
                                    
                                 . Only when 
                                    
                                       
                                          
                                             P
                                          
                                          
                                             1
                                          
                                       
                                    
                                  does not express a preference for values x and y, preference 
                                    
                                       
                                          
                                             P
                                          
                                          
                                             2
                                          
                                       
                                    
                                  is used.
                                    Algorithm 3
                                    Predilection
                                          
                                             
                                                
                                                
                                                   
                                                      1: if 
                                                         
                                                            
                                                               x
                                                               
                                                               ≺
                                                               
                                                               [
                                                               
                                                                  
                                                                     P
                                                                  
                                                                  
                                                                     1
                                                                  
                                                               
                                                               ]
                                                               y
                                                            
                                                          
                                                         then
                                                      
                                                   
                                                   
                                                      2: 
                                                         return true;
                                                   
                                                   
                                                      3: else if 
                                                         
                                                            
                                                               ¬
                                                               y
                                                               
                                                               ⪯
                                                               
                                                               [
                                                               
                                                                  
                                                                     P
                                                                  
                                                                  
                                                                     1
                                                                  
                                                               
                                                               ]
                                                               x
                                                            
                                                          
                                                         then
                                                      
                                                   
                                                   
                                                      4: 
                                                         return 
                                                         
                                                            
                                                               x
                                                               
                                                               ≺
                                                               
                                                               [
                                                               
                                                                  
                                                                     P
                                                                  
                                                                  
                                                                     2
                                                                  
                                                               
                                                               ]
                                                               y
                                                            
                                                         ;
                                                   
                                                   
                                                      5: end if
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    

For convenience we will introduce a case distinction mechanism:

Case distinction: 
                                    
                                       D
                                       
                                       ↣
                                       
                                       
                                          
                                             P
                                          
                                          
                                             1
                                          
                                       
                                       |
                                       
                                          
                                             P
                                          
                                          
                                             2
                                          
                                       
                                    
                                 , defined as:
                                    
                                       
                                          D
                                          
                                          ↣
                                          
                                          
                                             
                                                P
                                             
                                             
                                                1
                                             
                                          
                                          |
                                          
                                             
                                                P
                                             
                                             
                                                2
                                             
                                          
                                          
                                          ≜
                                          
                                          (
                                          D
                                          
                                          ↣
                                          
                                          
                                             
                                                P
                                             
                                             
                                                1
                                             
                                          
                                          )
                                          
                                          ⋈
                                          
                                          (
                                          ¬
                                          D
                                          
                                          ↣
                                          
                                          
                                             
                                                P
                                             
                                             
                                                2
                                             
                                          
                                          )
                                       
                                    
                                 
                              

The preferences 
                           
                              
                                 
                                    P
                                 
                                 
                                    1
                                 
                              
                              
                              ⋈
                              
                              
                                 
                                    P
                                 
                                 
                                    2
                                 
                              
                              ,
                              
                              
                                 
                                    P
                                 
                                 
                                    1
                                 
                              
                              
                              ▷
                              
                              
                                 
                                    P
                                 
                                 
                                    2
                                 
                              
                              ,
                              
                              
                                 
                                    P
                                 
                                 
                                    1
                                 
                              
                              
                              &
                              
                              
                                 
                                    P
                                 
                                 
                                    2
                                 
                              
                           
                         and 
                           
                              D
                              
                              ↣
                              
                              
                                 
                                    P
                                 
                                 
                                    1
                                 
                              
                              |
                              
                                 
                                    P
                                 
                                 
                                    2
                                 
                              
                           
                         all have attribute set 
                           
                              Attrs
                              (
                              
                                 
                                    P
                                 
                                 
                                    1
                                 
                              
                              )
                              
                              ∪
                              
                              Attrs
                              (
                              
                                 
                                    P
                                 
                                 
                                    2
                                 
                              
                              )
                           
                        . It is easily verified that in all cases the resulting relation is a strict partial order on 
                           
                              Attrs
                              (
                              
                                 
                                    P
                                 
                                 
                                    1
                                 
                              
                              )
                              
                              ∪
                              
                              Attrs
                              (
                              
                                 
                                    P
                                 
                                 
                                    2
                                 
                              
                              )
                           
                        .

Preferences 
                           
                              
                                 
                                    P
                                 
                                 
                                    1
                                 
                              
                           
                         and 
                           
                              
                                 
                                    P
                                 
                                 
                                    2
                                 
                              
                           
                         are equivalent when they induce the same ordering over their attribute domain:
                           
                              
                                 
                                    
                                       P
                                    
                                    
                                       1
                                    
                                 
                                 ≡
                                 
                                    
                                       P
                                    
                                    
                                       2
                                    
                                 
                                 
                                 ≜
                                 
                                 ≺
                                 [
                                 
                                    
                                       P
                                    
                                    
                                       1
                                    
                                 
                                 ]
                                 =
                                 ≺
                                 [
                                 
                                    
                                       P
                                    
                                    
                                       2
                                    
                                 
                                 ]
                              
                           
                        Some obvious properties are:
                           
                              1.
                              
                                 
                                    
                                       ⋈
                                    
                                  is idempotent, symmetric and associative.


                                 
                                    
                                       ▷
                                    
                                  is idempotent and associative.


                                 
                                    
                                       ⋈
                                    
                                  and 
                                    
                                       &
                                    
                                  are distributive.

Some other operators defined by Kießling (2002) can be derived from the other operators:
                           
                              1.
                              Maximal value: 
                                    
                                       HIGHEST
                                       (
                                       A
                                       ,
                                       >
                                       )
                                    
                                 .


                                 
                                    
                                       HIGHEST
                                       (
                                       A
                                       ,
                                       >
                                       )
                                       
                                       ≜
                                       
                                       REV
                                       (
                                       LOWEST
                                       (
                                       A
                                       ,
                                       <
                                       )
                                       )
                                    
                                 
                              

Positive affirmation: 
                                    
                                       POS
                                       (
                                       A
                                       ,
                                       S
                                       )
                                    
                                 .


                                 
                                    
                                       POS
                                       (
                                       A
                                       ,
                                       S
                                       )
                                       =
                                       EXPL
                                       (
                                       Dom
                                       (
                                       A
                                       )
                                       -
                                       S
                                       ,
                                       S
                                       )
                                    
                                 .

Negative affirmation: 
                                    
                                       NEG
                                       (
                                       A
                                       ,
                                       S
                                       )
                                    
                                 .


                                 
                                    
                                       NEG
                                       (
                                       A
                                       ,
                                       S
                                       )
                                       
                                       ≜
                                       
                                       EXPL
                                       (
                                       S
                                       ,
                                       Dom
                                       (
                                       A
                                       )
                                       -
                                       S
                                       )
                                    
                                 .

Best value: 
                                    
                                       AROUND
                                       (
                                       A
                                       ,
                                       d
                                       ,
                                       a
                                       )
                                    
                                 .

Assuming a binary function d over A, this preference indicates that a value closer to a is preferred above a value further away. Let 
                                    
                                       x
                                       
                                          
                                             <
                                          
                                          
                                             a
                                          
                                       
                                       y
                                       
                                       ≜
                                       
                                       d
                                       (
                                       a
                                       ,
                                       x
                                       )
                                       <
                                       d
                                       (
                                       a
                                       ,
                                       y
                                       )
                                    
                                 , then 
                                    
                                       AROUND
                                       (
                                       A
                                       ,
                                       d
                                       ,
                                       a
                                       )
                                       
                                       ≜
                                       
                                       LOWEST
                                       (
                                       A
                                       ,
                                       
                                          
                                             <
                                          
                                          
                                             a
                                          
                                       
                                       )
                                    
                                 .

Equally important: 
                                    
                                       
                                          
                                             P
                                          
                                          
                                             1
                                          
                                       
                                       
                                       ⊗
                                       
                                       
                                          
                                             P
                                          
                                          
                                             2
                                          
                                       
                                    
                                 .


                                 
                                    
                                       
                                          
                                             P
                                          
                                          
                                             1
                                          
                                       
                                       
                                       ⊗
                                       
                                       
                                          
                                             P
                                          
                                          
                                             2
                                          
                                       
                                       
                                       ≜
                                       
                                       (
                                       
                                          
                                             P
                                          
                                          
                                             1
                                          
                                       
                                       
                                       ▷
                                       
                                       
                                          
                                             P
                                          
                                          
                                             2
                                          
                                       
                                       )
                                       
                                       ⋈
                                       
                                       (
                                       
                                          
                                             P
                                          
                                          
                                             2
                                          
                                       
                                       
                                       ▷
                                       
                                       
                                          
                                             P
                                          
                                          
                                             1
                                          
                                       
                                       )
                                    
                                 .

Suppose a patient is allergic for the medicine aspirin, and favorably responds on a dose around 0.5 for blood pressure medicine X. The patient responds best on therapy 
                                 
                                    
                                       
                                          T
                                       
                                       
                                          1
                                       
                                    
                                 
                              , and otherwise 
                                 
                                    
                                       
                                          T
                                       
                                       
                                          2
                                       
                                    
                                 
                               also worked well. Then we have the following elementary preferences:
                                 
                                    
                                       
                                          
                                             
                                                
                                                   P
                                                
                                                
                                                   1
                                                
                                             
                                          
                                       
                                    
                                    
                                       
                                          
                                             NEG
                                             (
                                             medicine
                                             ,
                                             {
                                             aspirin
                                             }
                                             )
                                          
                                       
                                    


                                       
                                          
                                             AROUND
                                             (
                                             X
                                             ,
                                             0.5
                                             )
                                          
                                       
                                    


                                       
                                          
                                             POS
                                             (
                                             therapy
                                             ,
                                             〈
                                             
                                                
                                                   T
                                                
                                                
                                                   1
                                                
                                             
                                             〉
                                             )
                                          
                                       
                                    


                                       
                                          
                                             POS
                                             (
                                             therapy
                                             ,
                                             〈
                                             
                                                
                                                   T
                                                
                                                
                                                   2
                                                
                                             
                                             〉
                                             )
                                          
                                       
                                    

The preference 
                           
                              
                                 
                                    P
                                 
                                 
                                    1
                                 
                              
                           
                         is essential, and dominates the others. The preference of this patient corresponds to the preference expression:
                           
                              
                                 
                                    
                                       P
                                    
                                    
                                       1
                                    
                                 
                                 
                                 &
                                 
                                 (
                                 (
                                 
                                    
                                       P
                                    
                                    
                                       3
                                    
                                 
                                 
                                 &
                                 
                                 
                                    
                                       P
                                    
                                    
                                       4
                                    
                                 
                                 )
                                 
                                 ⋈
                                 
                                 
                                    
                                       P
                                    
                                    
                                       2
                                    
                                 
                                 )
                              
                           
                        
                     

CP-nets form an elegant representation mechanism for special sets of conditional preferences. We follow (Boutilier et al., 2004), but adapt their definitions to our context. A CP-net is a directed graph 
                           
                              G
                              =
                              (
                              N
                              ,
                              E
                              ,
                              CPT
                              )
                           
                         with a set N of nodes and a set E of (directed) edges. A node will be a set of attributes. Let 
                           
                              Parents
                              (
                              V
                              )
                           
                         be the set 
                           
                              {
                              W
                              ∈
                              N
                              |
                              (
                              W
                              ,
                              V
                              )
                              ∈
                              E
                              }
                           
                         of parents of node V. Each node V is annotated with a set 
                           
                              CPT
                              (
                              V
                              )
                           
                         of conditional preferences of the form 
                           
                              ϕ
                              
                              ↣
                              
                              P
                           
                         where.
                           
                              1.
                              
                                 
                                    
                                       ϕ
                                    
                                  is a condition over the attributes 
                                    
                                       ∪
                                       Parents
                                       (
                                       V
                                       )
                                    
                                  from the parents of node V.


                                 P is a preference with attribute set V.

We follow the evening dress example given in Boutilier et al. (2004). Depending on the color of the shirt (S), the user has different preferences for the color of the pants (P) and the color of the jacket (J).
                           
                              I unconditionally prefer black to white as a color for both the jacket and the pants, while my preference between the red and white shirts is conditioned on the combination of jacket and pants: if they have the same color, then a white shirt will make my outfit too colorless, thus I prefer a red shirt. Otherwise, if the jacket and the pants are of different colors, then a red shirt will probably make my outfit too flashy, thus I prefer a white shirt.
                        
                     

So in this example we have the following attributes: 
                           
                              A
                              =
                              {
                              S
                              ,
                              P
                              ,
                              J
                              }
                           
                        , and a single table D with relational scheme 
                           
                              A
                           
                        . The user preference B can be expressed using conditional preferences as follows:
                           
                              
                                 B
                                 =
                                 EXPL
                                 (
                                 J
                                 ,
                                 〈
                                 white
                                 ,
                                 black
                                 〉
                                 )
                                 
                                 ⋈
                                 
                                 EXPL
                                 (
                                 P
                                 ,
                                 〈
                                 white
                                 ,
                                 black
                                 〉
                                 )
                                 
                                 ⋈
                                 
                                 J
                                 =
                                 P
                                 
                                 ↣
                                 
                                 EXPL
                                 (
                                 S
                                 ,
                                 〈
                                 white
                                 ,
                                 red
                                 〉
                                 )
                                 
                                 ⋈
                                 
                                 J
                                 
                                 ≠
                                 
                                 P
                                 
                                 ↣
                                 
                                 EXPL
                                 (
                                 S
                                 ,
                                 〈
                                 red
                                 ,
                                 white
                                 〉
                                 )
                              
                           
                        This preference relation induces an ordering 
                           
                              ≺
                              [
                              B
                              ]
                           
                         of the tuples for any population of table D. The example can be describe as a CP-net with nodes 
                           
                              {
                              J
                              }
                              ,
                              
                              {
                              P
                              }
                           
                         and 
                           
                              {
                              S
                              }
                           
                        , and both an arrow from 
                           
                              {
                              J
                              }
                           
                         to 
                           
                              {
                              S
                              }
                           
                         and an arrow from 
                           
                              {
                              P
                              }
                           
                         to 
                           
                              {
                              S
                              }
                           
                        . Node 
                           
                              {
                              S
                              }
                           
                         has associated the following conditional preference set:
                           
                              
                                 CPT
                                 (
                                 {
                                 S
                                 }
                                 )
                                 =
                                 {
                                 J
                                 =
                                 P
                                 
                                 ↣
                                 
                                 EXPL
                                 (
                                 S
                                 ,
                                 〈
                                 white
                                 ,
                                 red
                                 〉
                                 )
                                 ,
                                 J
                                 
                                 ≠
                                 
                                 P
                                 
                                 ↣
                                 
                                 EXPL
                                 (
                                 S
                                 ,
                                 〈
                                 red
                                 ,
                                 white
                                 〉
                                 )
                                 }
                              
                           
                        Note that both nodes 
                           
                              {
                              J
                              }
                           
                         and 
                           
                              {
                              P
                              }
                           
                         are root elements, so they both have an empty parent set. A condition over an empty set is assumed to be true. For a root the conditional preference set has a single preference, providing an overall order over its attribute set.
                           
                              
                                 CPT
                                 (
                                 {
                                 J
                                 }
                                 )
                                 =
                                 {
                                 True
                                 
                                 ↣
                                 
                                 EXPL
                                 (
                                 J
                                 ,
                                 〈
                                 white
                                 ,
                                 red
                                 〉
                                 )
                                 }
                                 =
                                 {
                                 EXPL
                                 (
                                 J
                                 ,
                                 〈
                                 white
                                 ,
                                 red
                                 〉
                                 )
                                 }
                              
                           
                        
                        
                           
                              
                                 CPT
                                 (
                                 {
                                 P
                                 }
                                 )
                                 =
                                 {
                                 EXPL
                                 (
                                 J
                                 ,
                                 〈
                                 white
                                 ,
                                 red
                                 〉
                                 )
                                 }
                              
                           
                        This is represented graphically in Fig. 5
                        , where we use the notation 
                           
                              
                                 
                                    A
                                 
                                 
                                    v
                                 
                              
                           
                         as a shorthand for 
                           
                              A
                              =
                              v
                           
                         where A is an attribute and v an attribute value.

For the case of SQL the relevancy operator has a binary result: a tuple either satisfies the restriction (WHERE-clause), or otherwise (false or undefined result) the tuple is not selected. This is the initial result of the query. Then, according to Kießling et al. (2011), the effect of the preference operator is that only those tuples are chosen that are not preferred by another tuple from the initial result. Formally:
                           
                              
                                 
                                    
                                       Tops
                                    
                                    
                                       P
                                    
                                 
                                 (
                                 A
                                 )
                                 
                                 ≜
                                 
                                 {
                                 x
                                 ∈
                                 A
                                 |
                                 ¬
                                 x
                                 
                                 ≺
                                 
                                 [
                                 P
                                 ]
                                 A
                                 }
                              
                           
                        where 
                           
                              x
                              
                              ≺
                              
                              [
                              P
                              ]
                              A
                           
                         abbreviates 
                           
                              
                                 
                                    ∃
                                 
                                 
                                    y
                                    ∈
                                    A
                                 
                              
                              [
                              x
                              
                              ≺
                              
                              [
                              A
                              ]
                              y
                              ]
                           
                        . Later we will also use 
                           
                              A
                              [
                              P
                              ]
                              B
                           
                         to denote 
                           
                              
                                 
                                    ∀
                                 
                                 
                                    x
                                    ∈
                                    A
                                 
                              
                              [
                              x
                              
                              ≺
                              
                              [
                              P
                              ]
                              B
                              ]
                           
                        .

In the case of Fig. 6
                         only tuples 
                           
                              
                                 
                                    x
                                 
                                 
                                    3
                                 
                              
                           
                         and 
                           
                              
                                 
                                    x
                                 
                                 
                                    5
                                 
                              
                           
                         are retrieved, so 
                           
                              
                                 
                                    Tops
                                 
                                 
                                    P
                                 
                              
                              A
                              =
                              {
                              
                                 
                                    x
                                 
                                 
                                    3
                                 
                              
                              ,
                              
                                 
                                    x
                                 
                                 
                                    5
                                 
                              
                              }
                           
                        .

Rather than the exact match of SQL, we have a fuzzy match operator in the case of Information Retrieval. In Fig. 7
                         all nodes have associated their relevancy score.

Given a set A we select the set 
                           
                              
                                 
                                    Cand
                                 
                                 
                                    P
                                 
                              
                              A
                           
                         of best candidates as follows. We introduce the preference layers 
                           
                              
                                 
                                    L
                                 
                                 
                                    i
                                 
                              
                           
                         for a set of node A with preference relation P as follows:
                           
                              
                                 
                                    
                                       
                                       
                                          
                                             
                                                
                                                   G
                                                
                                                
                                                   -
                                                   1
                                                
                                             
                                             =
                                             A
                                          
                                       
                                    
                                    
                                       
                                       
                                          
                                             
                                                
                                                   L
                                                
                                                
                                                   i
                                                
                                             
                                             =
                                             
                                                
                                                   Tops
                                                
                                                
                                                   P
                                                
                                             
                                             
                                                
                                                   G
                                                
                                                
                                                   i
                                                   -
                                                   1
                                                
                                             
                                          
                                       
                                    
                                    
                                       
                                       
                                          
                                             
                                                
                                                   G
                                                
                                                
                                                   i
                                                
                                             
                                             =
                                             
                                                
                                                   G
                                                
                                                
                                                   i
                                                   -
                                                   1
                                                
                                             
                                             -
                                             
                                                
                                                   L
                                                
                                                
                                                   i
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           
                        The set 
                           
                              
                                 
                                    C
                                 
                                 
                                    i
                                 
                              
                           
                         of best candidates in each layer is obtained as:
                           
                              
                                 
                                    
                                       C
                                    
                                    
                                       i
                                    
                                 
                                 =
                                 
                                    
                                       Tops
                                    
                                    
                                       P
                                    
                                 
                                 
                                    
                                       L
                                    
                                    
                                       i
                                    
                                 
                              
                           
                        So for the example of Fig. 7 we have:
                           
                              (2)
                              
                                 
                                    
                                       
                                          
                                             
                                                L
                                             
                                             
                                                0
                                             
                                          
                                          =
                                          {
                                          
                                             
                                                x
                                             
                                             
                                                3
                                             
                                          
                                          ,
                                          
                                             
                                                x
                                             
                                             
                                                5
                                             
                                          
                                          }
                                       
                                       
                                          
                                             
                                                G
                                             
                                             
                                                0
                                             
                                          
                                          =
                                          {
                                          
                                             
                                                x
                                             
                                             
                                                1
                                             
                                          
                                          ,
                                          
                                             
                                                x
                                             
                                             
                                                2
                                             
                                          
                                          ,
                                          
                                             
                                                x
                                             
                                             
                                                4
                                             
                                          
                                          }
                                       
                                    
                                    
                                       
                                          
                                             
                                                L
                                             
                                             
                                                1
                                             
                                          
                                          =
                                          {
                                          
                                             
                                                x
                                             
                                             
                                                2
                                             
                                          
                                          ,
                                          
                                             
                                                x
                                             
                                             
                                                4
                                             
                                          
                                          }
                                       
                                       
                                          
                                             
                                                G
                                             
                                             
                                                1
                                             
                                          
                                          =
                                          {
                                          
                                             
                                                x
                                             
                                             
                                                1
                                             
                                          
                                          }
                                       
                                    
                                    
                                       
                                          
                                             
                                                L
                                             
                                             
                                                2
                                             
                                          
                                          =
                                          {
                                          
                                             
                                                x
                                             
                                             
                                                1
                                             
                                          
                                          }
                                       
                                       
                                          
                                             
                                                G
                                             
                                             
                                                2
                                             
                                          
                                          =
                                          ∅
                                       
                                    
                                 
                              
                           
                        Note that
                           Lemma 1
                           
                              
                                 
                                    
                                       
                                          L
                                       
                                       
                                          i
                                       
                                    
                                    
                                    ≺
                                    
                                    [
                                    P
                                    ]
                                    
                                    
                                       
                                          L
                                       
                                       
                                          i
                                          -
                                          1
                                       
                                    
                                 
                               for 
                                 
                                    i
                                    >
                                    0
                                 
                              .

The series 
                           
                              
                                 
                                    L
                                 
                                 
                                    i
                                 
                              
                           
                         and 
                           
                              
                                 
                                    G
                                 
                                 
                                    i
                                 
                              
                           
                         are converging. This is expressed by the following property:
                           Lemma 2
                           
                              
                                 
                                    
                                       
                                          G
                                       
                                       
                                          i
                                       
                                    
                                    
                                    ≠
                                    
                                    ∅
                                    ⇒
                                    
                                       
                                          G
                                       
                                       
                                          i
                                          +
                                          1
                                       
                                    
                                    
                                    ⫅
                                    
                                    
                                       
                                          G
                                       
                                       
                                          i
                                       
                                    
                                 
                              
                           

Let 
                           
                              k
                              =
                              
                                 
                                    argmax
                                 
                                 
                                    i
                                 
                              
                              
                                 
                                    G
                                 
                                 
                                    i
                                 
                              
                              
                              ≠
                              
                              ∅
                           
                        , then we have the layers 
                           
                              
                                 
                                    L
                                 
                                 
                                    0
                                 
                              
                              ,
                              …
                              ,
                              
                                 
                                    L
                                 
                                 
                                    k
                                 
                              
                           
                        . The most attractive candidate form the first layer 
                           
                              (
                              
                                 
                                    L
                                 
                                 
                                    0
                                 
                              
                              )
                           
                         obviously is the highest relevant element of this set. In the other layers there may be internal preference relations. For example in 
                           
                              
                                 
                                    L
                                 
                                 
                                    1
                                 
                              
                           
                         we see that 
                           
                              
                                 
                                    x
                                 
                                 
                                    2
                                 
                              
                           
                         is preferred above 
                           
                              
                                 
                                    x
                                 
                                 
                                    4
                                 
                              
                           
                        . The selection algorithm we propose is a recursive algorithm. So the best candidates in this layer are 
                           
                              
                                 
                                    Cand
                                 
                                 
                                    P
                                 
                              
                              
                                 
                                    L
                                 
                                 
                                    1
                                 
                              
                           
                        . The result of 
                           
                              
                                 
                                    Cand
                                 
                                 
                                    P
                                 
                              
                              A
                           
                         is the set 
                           
                              
                                 
                                    C
                                 
                                 
                                    0
                                 
                              
                              ∪
                              …
                              ∪
                              
                                 
                                    C
                                 
                                 
                                    k
                                 
                              
                           
                         of best candidates at each preference level.
                           Algorithm 4
                           Finding top elements
                                 
                                    
                                       
                                       
                                          
                                             
                                                fun Tops (Pref P, Set X): Set
                                          
                                          
                                             
                                                Set R =EmptySet;
                                          
                                          
                                             
                                                
                                                foreach x in X do
                                             
                                          
                                          
                                             
                                                Boolean found =True;
                                          
                                          
                                             
                                                
                                                foreach y in X do
                                             
                                          
                                          
                                             
                                                
                                                
                                                if P (x,y) then found =False;
                                          
                                          
                                             
                                                
                                                break; fi
                                             
                                          
                                          
                                             
                                                
                                                od
                                             
                                          
                                          
                                             
                                                
                                                if found then R += x; fi
                                             
                                          
                                          
                                             
                                                
                                                od
                                             
                                          
                                          
                                             
                                                
                                                return R
                                          
                                          
                                             
                                                endfun
                                             
                                          
                                       
                                    
                                 
                              
                           

Finding next layer
                                 
                                    
                                       
                                       
                                          
                                             
                                                fun NextLevel (Pref P, Set G): Set
                                          
                                          
                                             
                                                Set L =Tops (P, G);
                                          
                                          
                                             
                                                
                                                return (L, G-L)
                                          
                                          
                                             
                                                endfun
                                             
                                          
                                       
                                    
                                 
                              
                           

Finding best candidates
                                 
                                    
                                       
                                       
                                          
                                             
                                                fun Cand (Pref P, Set A): Set
                                          
                                          
                                             
                                                Set L =Tops (P, A);
                                          
                                          
                                             
                                                Set G =L;
                                          
                                          
                                             
                                                Set R =L;
                                          
                                          
                                             
                                                
                                                while NotEmpty (G) do
                                             
                                          
                                          
                                             
                                                (L, G) = NextLevel (P, G);
                                          
                                          
                                             
                                                R += Tops (P, Cand (P, L));
                                          
                                          
                                             
                                                
                                                end while
                                             
                                          
                                          
                                             
                                                
                                                return R
                                          
                                          
                                             
                                                endfun
                                             
                                          
                                       
                                    
                                 
                              
                           

In our case of automatic service discovery, our starting position is a need formulation (query) q and a preference formulation P. For each service 
                           
                              Sim
                              (
                              q
                              ,
                              S
                              )
                           
                         will express how relevant service S is for query q. Let 
                           
                              
                                 
                                    Sim
                                 
                                 
                                    θ
                                 
                              
                              (
                              q
                              ,
                              S
                              )
                              =
                              {
                              S
                              |
                              Sim
                              (
                              q
                              ,
                              S
                              )
                              >
                              θ
                              }
                           
                         be the set of (sufficiently) relevant services for some threshold 
                           
                              θ
                           
                        . Using the selection method of the previous subsection, we obtain the set of candidate services 
                           
                              
                                 
                                    Cand
                                 
                                 
                                    P
                                 
                              
                              
                                 
                                    Sim
                                 
                                 
                                    θ
                                 
                              
                              (
                              q
                              ,
                              S
                              )
                           
                        .

To make a selection between these candidates, a balance between relevance and preference has to be made. The following table shows the dilemma of the situation:
                           
                              
                                 
                                 
                                 
                                 
                                 
                                    
                                       
                                       
                                       
                                          Relevant
                                       
                                    
                                    
                                       
                                       
                                       Yes
                                       No
                                    
                                 
                                 
                                    
                                       
                                          Preferred
                                       
                                       Yes
                                       
                                          High quality!
                                       
                                       
                                          Nice but useless
                                       
                                    
                                    
                                       
                                       No
                                       
                                          Relevant but..
                                       
                                       
                                          Not interesting
                                       
                                    
                                 
                              
                           
                        
                     

In some applications it may be possible to reduce the dimensionality of this problem by defining a utility function that combines relevancy and preference score of a service into a single utility score for that service. In that case the services can simply be ordered according to their utility score.

In our health application such a utility function does not seem to exist. Another option is to reduce the dimensionality by expressing relevance in terms of preference. That may be done by equipping each service A with a special attribute 
                           
                              REL
                           
                         indicating its relevance score 
                           
                              Sim
                              (
                              q
                              ,
                              S
                              )
                           
                        . This basically brings us back to the situation of Fig. 6. From the system point of view, each of the optimal services is a best solution. For example, suppose each service has an attribute 
                           
                              COST
                           
                         describing its cost, and our preference is the service with the highest relevancy but the lowest cost. Then this is expressed as:
                           
                              
                                 HIGHEST
                                 (
                                 REL
                                 )
                                 
                                 &
                                 
                                 LOWEST
                                 (
                                 COST
                                 )
                              
                           
                        
                        
                           Example 2
                           Suppose our patient from the example in Section 4 wants the treatment to be as good as possible. This is expressed as:
                                 
                                    
                                       
                                          
                                             P
                                          
                                          
                                             1
                                          
                                       
                                       
                                       &
                                       
                                       (
                                       HIGHEST
                                       (
                                       REL
                                       )
                                       
                                       ⋈
                                       
                                       (
                                       
                                          
                                             P
                                          
                                          
                                             3
                                          
                                       
                                       
                                       &
                                       
                                       
                                          
                                             P
                                          
                                          
                                             4
                                          
                                       
                                       )
                                       
                                       ⋈
                                       
                                       
                                          
                                             P
                                          
                                          
                                             2
                                          
                                       
                                       )
                                    
                                 
                              
                           

In more complex applications, there is no such rule to reduce the dimensionality of our decision problem in either of the above ways. This seems the case in our health application. Then we roughly have the following two opportunities:
                                 
                                    1.
                                    The health worker (and patient) is involved in the selection procedure, by letting the health worker (patient) decide between the proposed candidates 
                                          
                                             
                                                
                                                   Cand
                                                
                                                
                                                   P
                                                
                                             
                                             
                                                
                                                   Sim
                                                
                                                
                                                   θ
                                                
                                             
                                             (
                                             q
                                             ,
                                             S
                                             )
                                          
                                       .

Use a data mining system for learning the best preference expression.

In our situation the most obvious choice is the first (at least for the time being).

In a medical diagnosis situation as encountered by the Matcher in Fig. 1, we have a diagnosis (a set of symptoms), a set of treatments and a set of risks. An enriched query is an pair 
                           
                              〈
                              id
                              ,
                              q
                              ,
                              P
                              〉
                           
                         where id is the patient id, q is the set of symptoms that have been reported for this patient and P the preferential expression that combines the user profile and the contextual information. Each disease d is characterized by one or more sets of symptoms. For convenience we identify the set of symptoms with the disease.

As a first step, the symptoms from q are matched with the characteristics describing the diseases.
                           
                              1.
                              A most simple comparison is counting the commonality between symptoms q and 
                                    
                                       d
                                       :
                                       
                                          
                                             Sim
                                          
                                          
                                             0
                                          
                                       
                                       (
                                       q
                                       ,
                                       d
                                       )
                                       =
                                       |
                                       q
                                       ∩
                                       d
                                       |
                                    
                                 .

The commonality may be normalized against the generality of request and disease, for example as defined by Jaccard’s Measure:
                                    
                                       
                                          
                                             
                                                Sim
                                             
                                             
                                                J
                                             
                                          
                                          (
                                          q
                                          ,
                                          d
                                          )
                                          =
                                          
                                             
                                                |
                                                q
                                                ∩
                                                d
                                                |
                                             
                                             
                                                |
                                                q
                                                ∪
                                                d
                                                |
                                             
                                          
                                          .
                                       
                                    
                                 
                              

A more advanced similarity measure assumes both q and d to be fuzzy sets. The cosine measure computes the similarity as follows:
                                    
                                       
                                          
                                             
                                                Sim
                                             
                                             
                                                cos
                                             
                                          
                                          =
                                          
                                             
                                                q
                                                •
                                                d
                                             
                                             
                                                ‖
                                                q
                                                ‖
                                                ·
                                                ‖
                                                d
                                                ‖
                                             
                                          
                                       
                                    
                                 where 
                                    
                                       x
                                       •
                                       y
                                       =
                                       
                                          
                                             ∑
                                          
                                          
                                             s
                                             ∈
                                             S
                                          
                                       
                                       x
                                       (
                                       s
                                       )
                                       ·
                                       y
                                       (
                                       s
                                       )
                                    
                                  is the inner vector product and 
                                    
                                       ‖
                                       x
                                       ‖
                                       =
                                       
                                          
                                             
                                                
                                                   ∑
                                                
                                                
                                                   s
                                                   ∈
                                                   S
                                                
                                             
                                             x
                                             (
                                             s
                                             )
                                          
                                       
                                    
                                  the length of x (seen as a vector).

We will use 
                           
                              Sim
                              (
                              q
                              ,
                              d
                              )
                           
                         as a generic denotation for the similarity function.

Given an (enriched) query 
                           
                              〈
                              id
                              ,
                              q
                              ,
                              P
                              〉
                           
                        , the similarity with each disease d is evaluated using similarity function 
                           
                              Sim
                              (
                              q
                              ,
                              d
                              )
                           
                        . As a result, we have a relevancy score for each treatment together with a preference order. Each treatment comes with risks. The CP-net in Fig. 8
                         describes the conditional preferences of risks for each treatment.

As an example, we assume each variable has 2 values, 
                           
                              {
                              
                                 
                                    S
                                 
                                 
                                    1
                                 
                              
                              ,
                              
                                 
                                    S
                                 
                                 
                                    2
                                 
                              
                              }
                           
                        , 
                           
                              {
                              
                                 
                                    T
                                 
                                 
                                    1
                                 
                              
                              ,
                              
                                 
                                    T
                                 
                                 
                                    2
                                 
                              
                              }
                           
                         and 
                           
                              {
                              
                                 
                                    R
                                 
                                 
                                    1
                                 
                              
                              ,
                              
                                 
                                    R
                                 
                                 
                                    2
                                 
                              
                              }
                           
                         respectively. Fig. 9
                         shows the preferences of patients condition using conditional preference networks (CP-net) (Boutilier et al., 2004). The preference for symptoms is derived from matching with the enriched query q against the symptoms. This is done using the matching function 
                           
                              Util
                              (
                              S
                              )
                              =
                              Match
                              (
                              q
                              ,
                              S
                              )
                           
                        . We assume that in this example, the resulting preference relation is 
                           
                              
                                 
                                    S
                                 
                                 
                                    2
                                 
                              
                              [
                              Util
                              (
                              S
                              )
                              ]
                              
                                 
                                    S
                                 
                                 
                                    1
                                 
                              
                           
                        .

So, in this preference network, 
                           
                              
                                 
                                    S
                                 
                                 
                                    1
                                 
                              
                           
                         is preferred above 
                           
                              
                                 
                                    S
                                 
                                 
                                    2
                                 
                              
                           
                         since 
                           
                              
                                 
                                    S
                                 
                                 
                                    1
                                 
                              
                           
                         requires urgent intervention, and the corresponding treatment 
                           
                              
                                 
                                    T
                                 
                                 
                                    1
                                 
                              
                           
                         is preferred above 
                           
                              
                                 
                                    T
                                 
                                 
                                    2
                                 
                              
                           
                        . Similarly in case of treatment 
                           
                              
                                 
                                    T
                                 
                                 
                                    1
                                 
                              
                           
                         risk 
                           
                              
                                 
                                    R
                                 
                                 
                                    1
                                 
                              
                           
                         is preferred above 
                           
                              
                                 
                                    R
                                 
                                 
                                    2
                                 
                              
                           
                         which has low/less side effects for that treatment.

The patient diagnosis is matched against symptoms, of rather combinations of symptoms (see Fig. 10
                        ) that define a typical disease pattern. Each such combination has associated a preferential ordering on treatments. The conditional preference relates this combination of symptoms to the preference relation on treatments. Each treatment has associated risks, which are ranked using a preferential ordering relation.

In this section we discuss the case of patient Martha as described in the introduction. The structure of this section is as follows (see Fig. 11
                     ):
                        
                           1.
                           First we discuss in Section 7.1 a session with the Dialogue System (see Fig. 1).

Then in Section 7.2 we describe the relevant Knowledge and Service Repository (see Fig. 1) as input from medical theory. (step A in Fig. 11). As described in Section 6 we will describe this repository as a CP-net.

In Section 7.3 we show how Martha’s request is translated by the Query Interpreter into an enriched query. (step B in Fig. 11). According to our approach, the original query is enriched by a personal and environmental preference relation related to the case of the query.

In Section 7.4 we discuss the match maker using this extended query and the associated medical knowledge. Furthermore, in this section, we apply the method described in Section 5.2 to explain the advice given by the system as described in Section 7.1.

We consider the following situation: Martha is 6th months pregnant. She is on HIV/AIDS regimen; currently she shows some signs of malaria. So she contacts the health post via the mobile architecture (see Fig. 1), and enters her question, being:
                           
                              I am HIV positive for the last 2 years. I am taking the first line regimen which includes ZDV, 3TC and NVP since five months. Two days ago I am diagnosed P.falciparum malaria. I am 2 months pregnant. Which antimalarial drug is appropriate for me and for the fetus? Does this antimalarial drug have any complication with the antiretroviral drug that I am taking?
                           
                        
                     

Having the aforementioned information from the patient, the query interpreter gathers additional information from the user profile and user context. After it compiles and enriches the user query with additional information such as previous illness, previous medication, any adverse effects (if any) especially allergic, then the query interpreter forwards the enriched query to the matchmaking. The matchmaking looks for services in the repository which can match the request of the user considering the user preferences and contexts mentioned in the query.

Based on Martha’s request, the system recommends the following combination of medicines:
                           
                              The advised treatment is the combination of 
                              ZDV
                              , 
                              3TC
                              , 
                              NVP
                              
                              and 
                              Qui
                              , provided Martha is not anemic and there is no suspect of hepatitis B.
                        
                     

We first introduce in this subsection the preferential model that explains the sample session of the above subsection. In the next subsection we will explain the sample session in terms of this model. The preferential model in this case covers the combination of antiretroviral drugs with antimalarial drugs against pregnancy. This model is based on: 1. (Medical) conditions or symptoms: these are the base elements of our queries. 2. Treatments: these correspond to the services. 3. Risks, see Table 1
                         for an overview.

Symptoms, treatments and risks are categorized as follows:
                           
                              •
                              Symptoms (S)

We restrict ourselves to 
                                    
                                       HIV
                                       
                                       ∧
                                       
                                       PfR
                                    
                                  combinations. For such combinations, we again restrict ourselves to the presence of the combination of symptoms 
                                    
                                       Anm
                                       
                                       ∧
                                       
                                       Hep
                                    
                                 , and then distinguish between the state of pregnancy: 
                                    
                                       
                                          
                                             Preg
                                          
                                          
                                             1
                                          
                                       
                                    
                                  or 
                                    
                                       
                                          
                                             Preg
                                          
                                          
                                             2
                                          
                                       
                                    
                                 . This leads to (see Fig. 12
                                  for a decision tree representation):
                                    
                                       –
                                       
                                          
                                             
                                                
                                                   
                                                      S
                                                   
                                                   
                                                      1
                                                   
                                                
                                                =
                                                HIV
                                                
                                                ∧
                                                
                                                PfR
                                                
                                                ∧
                                                
                                                ¬
                                                (
                                                Anm
                                                
                                                ∧
                                                
                                                Hep
                                                )
                                                
                                                ∧
                                                
                                                
                                                   
                                                      Preg
                                                   
                                                   
                                                      1
                                                   
                                                
                                             
                                          
                                       


                                          
                                             
                                                
                                                   
                                                      S
                                                   
                                                   
                                                      2
                                                   
                                                
                                                =
                                                HIV
                                                
                                                ∧
                                                
                                                PfR
                                                
                                                ∧
                                                
                                                ¬
                                                (
                                                Anm
                                                
                                                ∧
                                                
                                                Hep
                                                )
                                                
                                                ∧
                                                
                                                
                                                   
                                                      Preg
                                                   
                                                   
                                                      2
                                                   
                                                
                                             
                                          
                                       


                                          
                                             
                                                
                                                   
                                                      S
                                                   
                                                   
                                                      3
                                                   
                                                
                                                =
                                                HIV
                                                
                                                ∧
                                                
                                                PfR
                                                
                                                ∧
                                                
                                                Anm
                                                
                                                ∧
                                                
                                                Hep
                                                
                                                ∧
                                                
                                                
                                                   
                                                      Preg
                                                   
                                                   
                                                      1
                                                   
                                                
                                             
                                          
                                       


                                          
                                             
                                                
                                                   
                                                      S
                                                   
                                                   
                                                      4
                                                   
                                                
                                                =
                                                HIV
                                                
                                                ∧
                                                
                                                PfR
                                                
                                                ∧
                                                
                                                Anm
                                                
                                                ∧
                                                
                                                Hep
                                                
                                                ∧
                                                
                                                
                                                   
                                                      Preg
                                                   
                                                   
                                                      2
                                                   
                                                
                                             
                                          
                                       

Treatments (T)

Treatments are offered in cocktails. For our example we restrict to HIV-related cocktails of medicines. Each cocktail has 
                                    
                                       Qui
                                    
                                  as a base component. Then it may contain 
                                    
                                       3
                                       TC
                                    
                                  or 
                                    
                                       FTC
                                    
                                 . Furthermore, there is a choice between 
                                    
                                       NVP
                                    
                                  and 
                                    
                                       EFV
                                    
                                 . This leads to (see Fig. 13
                                  for a decision tree representation):
                                    
                                       –
                                       
                                          
                                             
                                                
                                                   
                                                      T
                                                   
                                                   
                                                      1
                                                   
                                                
                                                =
                                                Qui
                                                
                                                ∧
                                                
                                                3
                                                TC
                                                
                                                ∧
                                                
                                                ZDV
                                                
                                                ∧
                                                
                                                NVP
                                             
                                          
                                       


                                          
                                             
                                                
                                                   
                                                      T
                                                   
                                                   
                                                      2
                                                   
                                                
                                                =
                                                Qui
                                                
                                                ∧
                                                
                                                3
                                                TC
                                                
                                                ∧
                                                
                                                ZDV
                                                
                                                ∧
                                                
                                                EFV
                                             
                                          
                                       


                                          
                                             
                                                
                                                   
                                                      T
                                                   
                                                   
                                                      3
                                                   
                                                
                                                =
                                                Qui
                                                
                                                ∧
                                                
                                                3
                                                TC
                                                /
                                                FTC
                                                
                                                ∧
                                                
                                                TDF
                                                
                                                ∧
                                                
                                                NVP
                                             
                                          
                                       


                                          
                                             
                                                
                                                   
                                                      T
                                                   
                                                   
                                                      4
                                                   
                                                
                                                =
                                                Qui
                                                
                                                ∧
                                                
                                                3
                                                TC
                                                /
                                                FTC
                                                
                                                ∧
                                                
                                                TDF
                                                
                                                ∧
                                                
                                                EFV
                                             
                                          
                                       

Risks (R)

Risks come in groups. For our example the following groups are relevant:
                                    
                                       –
                                       
                                          
                                             
                                                
                                                   
                                                      R
                                                   
                                                   
                                                      1
                                                   
                                                
                                                =
                                                StB
                                                
                                                ∧
                                                
                                                Cmal
                                             
                                          
                                       


                                          
                                             
                                                
                                                   
                                                      R
                                                   
                                                   
                                                      2
                                                   
                                                
                                                =
                                                HypS
                                                
                                                ∧
                                                
                                                Vfail
                                                
                                                ∧
                                                
                                                Renal
                                             
                                          
                                       


                                          
                                             
                                                
                                                   
                                                      R
                                                   
                                                   
                                                      3
                                                   
                                                
                                                =
                                                CNS
                                                
                                                ∧
                                                
                                                Tera
                                             
                                          
                                       


                                          
                                             
                                                
                                                   
                                                      R
                                                   
                                                   
                                                      4
                                                   
                                                
                                                =
                                                Anm
                                                
                                                ∧
                                                
                                                Hep
                                             
                                          
                                       

For each symptom group, there is a preferential order of the cocktails. For each cocktails there is an ordering of the groups of risk. For example, in case of symptoms 
                           
                              
                                 
                                    S
                                 
                                 
                                    1
                                 
                              
                           
                        , treatment 
                           
                              
                                 
                                    T
                                 
                                 
                                    1
                                 
                              
                           
                         is to be preferred above the other treatments, while there is no preference for 
                           
                              
                                 
                                    T
                                 
                                 
                                    2
                                 
                              
                              ,
                              
                              
                                 
                                    T
                                 
                                 
                                    3
                                 
                              
                           
                         or 
                           
                              
                                 
                                    T
                                 
                                 
                                    4
                                 
                              
                           
                        . Similar rules hold for the other symptom groups. This leads to:
                           
                              
                                 
                                    
                                       
                                       
                                          
                                             S
                                             =
                                             
                                                
                                                   S
                                                
                                                
                                                   1
                                                
                                             
                                             
                                             ↣
                                             
                                             POS
                                             (
                                             T
                                             ,
                                             {
                                             
                                                
                                                   T
                                                
                                                
                                                   1
                                                
                                             
                                             }
                                             )
                                          
                                       
                                    
                                    
                                       
                                       
                                          
                                             ⋈
                                             S
                                             =
                                             
                                                
                                                   S
                                                
                                                
                                                   2
                                                
                                             
                                             
                                             ↣
                                             
                                             POS
                                             (
                                             T
                                             ,
                                             {
                                             
                                                
                                                   T
                                                
                                                
                                                   2
                                                
                                             
                                             }
                                             )
                                          
                                       
                                    
                                    
                                       
                                       
                                          
                                             ⋈
                                             S
                                             =
                                             
                                                
                                                   S
                                                
                                                
                                                   3
                                                
                                             
                                             
                                             ↣
                                             
                                             POS
                                             (
                                             T
                                             ,
                                             {
                                             
                                                
                                                   T
                                                
                                                
                                                   3
                                                
                                             
                                             }
                                             )
                                          
                                       
                                    
                                    
                                       
                                       
                                          
                                             ⋈
                                             S
                                             =
                                             
                                                
                                                   S
                                                
                                                
                                                   4
                                                
                                             
                                             
                                             ↣
                                             
                                             POS
                                             (
                                             T
                                             ,
                                             {
                                             
                                                
                                                   T
                                                
                                                
                                                   4
                                                
                                             
                                             }
                                             )
                                          
                                       
                                    
                                 
                              
                           
                        The likelihood of risks associated with a treatment also is described as a preferential expression:
                           
                              
                                 T
                                 =
                                 
                                    
                                       T
                                    
                                    
                                       1
                                    
                                 
                                 
                                 ↣
                                 
                                 EXPL
                                 (
                                 R
                                 ,
                                 〈
                                 (
                                 
                                    
                                       R
                                    
                                    
                                       4
                                    
                                 
                                 ,
                                 
                                    
                                       R
                                    
                                    
                                       3
                                    
                                 
                                 ,
                                 
                                    
                                       R
                                    
                                    
                                       2
                                    
                                 
                                 )
                                 ,
                                 
                                    
                                       R
                                    
                                    
                                       1
                                    
                                 
                                 〉
                                 )
                                 
                                 ⋈
                                 
                                 T
                                 =
                                 
                                    
                                       T
                                    
                                    
                                       2
                                    
                                 
                                 
                                 ↣
                                 
                                 EXPL
                                 (
                                 R
                                 ,
                                 〈
                                 (
                                 
                                    
                                       R
                                    
                                    
                                       4
                                    
                                 
                                 ,
                                 
                                    
                                       R
                                    
                                    
                                       3
                                    
                                 
                                 ,
                                 
                                    
                                       R
                                    
                                    
                                       1
                                    
                                 
                                 )
                                 ,
                                 
                                    
                                       R
                                    
                                    
                                       2
                                    
                                 
                                 〉
                                 )
                                 
                                 ⋈
                                 
                                 T
                                 =
                                 
                                    
                                       T
                                    
                                    
                                       3
                                    
                                 
                                 
                                 ↣
                                 
                                 EXPL
                                 (
                                 R
                                 ,
                                 〈
                                 (
                                 
                                    
                                       R
                                    
                                    
                                       4
                                    
                                 
                                 ,
                                 
                                    
                                       R
                                    
                                    
                                       1
                                    
                                 
                                 ,
                                 
                                    
                                       R
                                    
                                    
                                       2
                                    
                                 
                                 )
                                 ,
                                 
                                    
                                       R
                                    
                                    
                                       3
                                    
                                 
                                 〉
                                 )
                                 
                                 ⋈
                                 
                                 T
                                 =
                                 
                                    
                                       T
                                    
                                    
                                       4
                                    
                                 
                                 
                                 ↣
                                 
                                 EXPL
                                 (
                                 R
                                 ,
                                 〈
                                 (
                                 
                                    
                                       R
                                    
                                    
                                       1
                                    
                                 
                                 ,
                                 
                                    
                                       R
                                    
                                    
                                       2
                                    
                                 
                                 ,
                                 
                                    
                                       R
                                    
                                    
                                       3
                                    
                                 
                                 )
                                 ,
                                 
                                    
                                       R
                                    
                                    
                                       4
                                    
                                 
                                 〉
                                 )
                              
                           
                        
                        Fig. 14
                         depicts the preference ordering for 
                           
                              
                                 
                                    S
                                 
                                 
                                    1
                                 
                              
                           
                         with treatments and potential risks using CP-nets. The figure below Fig. 14 shows the preference ordering of 
                           
                              
                                 
                                    S
                                 
                                 
                                    1
                                 
                              
                           
                         from the least preferred combination 
                           
                              
                                 
                                    S
                                 
                                 
                                    1
                                 
                              
                              
                              ∧
                              
                              
                                 
                                    T
                                 
                                 
                                    1
                                 
                              
                              
                              ∧
                              
                              
                                 
                                    R
                                 
                                 
                                    4
                                 
                              
                           
                         to the most preferred 
                           
                              
                                 
                                    S
                                 
                                 
                                    1
                                 
                              
                              
                              ∧
                              
                              
                                 
                                    T
                                 
                                 
                                    1
                                 
                              
                              
                              ∧
                              
                              
                                 
                                    R
                                 
                                 
                                    1
                                 
                              
                           
                        .

We use preference relations to describe the combination symptoms, treatments and risks. An overview is shown in Table 1. The rules for using these medicines in combination are formulated as the following preferential expressions. These expressions are based on WHO (2013).
                           
                              1.
                              
                                 
                                    
                                       Preg
                                       
                                       ↣
                                       
                                       NRTI
                                       
                                       ⋈
                                       
                                       (
                                       ZDV
                                       
                                       ⊕
                                       
                                       3
                                       TC
                                       )
                                       &
                                       NNRTI
                                       
                                       ⋈
                                       
                                       NVP
                                    
                                 
                              


                                 
                                    
                                       PfR
                                       
                                       ↣
                                       
                                       Chl
                                       
                                       ↣
                                       
                                       (
                                       AP
                                       
                                       ▷
                                       
                                       NNRTI
                                       
                                       ▷
                                       
                                       NRTI
                                       )
                                    
                                 
                              


                                 
                                    
                                       True
                                       
                                       ↣
                                       
                                       Qui
                                       
                                       ⋈
                                       
                                       (
                                       Lop
                                       
                                       ▷
                                       
                                       EFV
                                       
                                       ▷
                                       
                                       NVP
                                       )
                                    
                                 
                              

In the next subsections we will show how this preferential expression led to the advice given to Martha.

We return to the sample session of Section 7.1. From the description the match maker can derive the following:
                           
                              1.
                              Martha is HIV-infected and she is on antiretroviral regimen; so both 
                                    
                                       HIV
                                    
                                  and 
                                    
                                       ART
                                    
                                  are set to true.

Martha is pregnant, so 
                                    
                                       Preg
                                    
                                  is set to true.

Martha is diagnosed malaria positive, so 
                                    
                                       Mal
                                    
                                  is true.

Summarizing, we have the following request q for Martha: 
                           
                              q
                              =
                              HIV
                              
                              ∧
                              
                              Preg
                              
                              ∧
                              
                              ART
                              
                              ∧
                              
                              Mal
                           
                        .

In the process of enriching the user query, the prototype collects individual and domain knowledge information. The individual knowledge as depicted in Fig. 15
                         consists of behavior (e.g. history of illness, current symptoms,), demography (age group), preference (medication types, medication time, allergic information) and context (location, season, level of illness, etc.) (includes environmental context) and the domain knowledge which consists of disease, treatment and risks. Gathering all this information helps to widen the scope of enriching user query and assists in providing valuable search results.

This query is matched to the symptom groups. The similarity is computed as the fraction of the commonality and the generality of the query and symptom group. For example, the commonality between q and 
                           
                              
                                 
                                    S
                                 
                                 
                                    1
                                 
                              
                           
                         equals 3.5 since they have (1) 
                           
                              HIV
                           
                         in common, (2) pregnancy partwise in common and (3) the absence of 
                           
                              Anm
                           
                         and 
                           
                              Hep
                           
                         in common. The generality equals 7 since there are 7 symptoms involved (considering 
                           
                              Preg
                           
                         and 
                           
                              
                                 
                                    Preg
                                 
                                 
                                    1
                                 
                              
                           
                         as the same symptom). So the similarity is evaluated as 
                           
                              3.5
                              /
                              7
                              =
                              0.5
                           
                         Consequently Martha will be matched to the symptoms classes as follows:
                           
                              
                                 
                                 
                                 
                                 
                                    
                                       Class
                                       Description
                                       Score
                                    
                                 
                                 
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      S
                                                   
                                                   
                                                      1
                                                   
                                                
                                             
                                          
                                       
                                       
                                          
                                             
                                                HIV
                                                
                                                ∧
                                                
                                                PfR
                                                
                                                ∧
                                                
                                                ¬
                                                (
                                                Anm
                                                
                                                ∧
                                                
                                                Hep
                                                )
                                                
                                                ∧
                                                
                                                
                                                   
                                                      Preg
                                                   
                                                   
                                                      1
                                                   
                                                
                                             
                                          
                                       
                                       0.50
                                    
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      S
                                                   
                                                   
                                                      2
                                                   
                                                
                                             
                                          
                                       
                                       
                                          
                                             
                                                HIV
                                                
                                                ∧
                                                
                                                PfR
                                                
                                                ∧
                                                
                                                ¬
                                                (
                                                Anm
                                                
                                                ∧
                                                
                                                Hep
                                                )
                                                
                                                ∧
                                                
                                                
                                                   
                                                      Preg
                                                   
                                                   
                                                      2
                                                   
                                                
                                             
                                          
                                       
                                       0.50
                                    
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      S
                                                   
                                                   
                                                      3
                                                   
                                                
                                             
                                          
                                       
                                       
                                          
                                             
                                                HIV
                                                
                                                ∧
                                                
                                                PfR
                                                
                                                ∧
                                                
                                                Anm
                                                
                                                ∧
                                                
                                                Hep
                                                
                                                ∧
                                                
                                                
                                                   
                                                      Preg
                                                   
                                                   
                                                      1
                                                   
                                                
                                             
                                          
                                       
                                       0.21
                                    
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      S
                                                   
                                                   
                                                      4
                                                   
                                                
                                             
                                          
                                       
                                       
                                          
                                             
                                                HIV
                                                
                                                ∧
                                                
                                                PfR
                                                
                                                ∧
                                                
                                                Anm
                                                
                                                ∧
                                                
                                                Hep
                                                
                                                ∧
                                                
                                                
                                                   
                                                      Preg
                                                   
                                                   
                                                      2
                                                   
                                                
                                             
                                          
                                       
                                       0.21
                                    
                                 
                              
                           
                        
                     

Each symptom group has its preferential list for treatments. For example, group 
                           
                              
                                 
                                    S
                                 
                                 
                                    1
                                 
                              
                           
                         has the following preferences for treatments: 
                           
                              EXPL
                              (
                              T
                              ,
                              〈
                              (
                              
                                 
                                    T
                                 
                                 
                                    2
                                 
                              
                              ,
                              
                                 
                                    T
                                 
                                 
                                    3
                                 
                              
                              ,
                              
                                 
                                    T
                                 
                                 
                                    4
                                 
                              
                              )
                              ,
                              
                                 
                                    T
                                 
                                 
                                    1
                                 
                              
                              〉
                              )
                           
                        .

By applying Algorithm 6 we find 
                           
                              
                                 
                                    T
                                 
                                 
                                    1
                                 
                              
                           
                         and 
                           
                              
                                 
                                    T
                                 
                                 
                                    2
                                 
                              
                           
                         as the best candidates. This leads to the advice from Section 7.1:
                           
                              The advised treatment is the combination of 
                              ZDV
                              , 
                              3TC
                              , 
                              NVP
                              
                              and 
                              Qui
                              , provided Martha is not anemic and there is no suspect of hepatitis B.
                           
                        
                     

The purpose of this validation section is to show how our theory is being applied. Based on the expression in Section 7.2, the above combination (ZDV
                        +
                        3TC
                        +
                        NVP
                        +
                        Qui) is advised for Martha, but the administration of these drugs should be under the close monitoring of healthcare workers (nurses or physicians).The advise given is: 
                           
                              ZDV
                              
                              ∧
                              
                              3
                              TC
                              
                              ∧
                              
                              NVP
                              
                              ∧
                              
                              Qui
                           
                        , provided Martha is not anemic and there is no suspect of hepatitis B.

Using the classification of previous Section 7.2 and the preference relation, we come to the following:
                           
                              1.
                              Chloroquine is an antimalarial drug but it is found resistance for P.falcipuram, therefore chloroquine for Martha is not provided. So 
                                    
                                       Chl
                                    
                                  is false for treating P.falcipuram.

Martha is living in a P.falcipuram resistent area. So 
                                    
                                       PfR
                                    
                                  is set to true.

Coartem is not given in first trimester, so 
                                    
                                       Coa
                                    
                                  is false in the first trimester of pregnancy.

The resulting query thus is:
                           
                              
                                 Preg
                                 
                                 ∧
                                 
                                 HIV
                                 
                                 ∧
                                 
                                 Mal
                              
                           
                        extended with the preferences:
                           
                              
                                 
                                    
                                       
                                       
                                          
                                             PfR
                                             
                                             ∧
                                             
                                             Qui
                                          
                                       
                                    
                                    
                                       
                                       
                                          
                                             ART
                                             
                                             ∧
                                             
                                             (
                                             ZDV
                                             
                                             ⊕
                                             
                                             3
                                             TC
                                             )
                                             
                                             ∧
                                             
                                             NVP
                                          
                                       
                                    
                                    
                                       
                                       
                                          
                                             AGE
                                          
                                       
                                    
                                 
                              
                           
                        Considering the current symptoms, previous history, current and previous medication as well as pregnancy the following medicines are found to be relevant:
                           
                              1.
                              
                                 
                                    
                                       {
                                       ZDV
                                       
                                       ∧
                                       
                                       3
                                       TC
                                       
                                       ∧
                                       
                                       NVP
                                       
                                       ∧
                                       
                                       Qui
                                       }
                                    
                                 
                              

if the woman is non-anemic. Otherwise, since patients with anemia or hepatitis B are more likely receiving regimens containing TDF, the following medications are relevant:


                                 
                                    
                                       {
                                       TDF
                                       
                                       ∧
                                       
                                       FTC
                                       
                                       ∧
                                       
                                       NVP
                                       
                                       ∧
                                       
                                       Qui
                                       }
                                    
                                 
                              


                                 
                                    
                                       {
                                       d
                                       4
                                       T
                                       
                                       ∧
                                       
                                       3
                                       TC
                                       
                                       ∧
                                       
                                       NVP
                                       
                                       ∧
                                       
                                       Qui
                                       }
                                    
                                 
                              

In the next subsection, we see how the system finds the most preferred medication among these three options.

We identify symptoms, treatments and risks from Martha’s query. According to Martha’s request 
                           
                              
                                 
                                    S
                                 
                                 
                                    1
                                 
                              
                              ,
                              
                              
                                 
                                    T
                                 
                                 
                                    1
                                 
                              
                              ,
                              
                              
                                 
                                    R
                                 
                                 
                                    1
                                 
                              
                           
                         is the preferred treatment and has low risk for the symptoms 
                           
                              
                                 
                                    S
                                 
                                 
                                    1
                                 
                              
                           
                        .

Next we apply the techniques described in Section 5.2. The combinations of antiretroviral and antimalarial drugs with the potential risks or adverse effects is presented in Table 1.

Based on WHO first line regimen recommendation, we try to map these regimens with antimalarial drugs to be used in pregnancy. The result recommended by the system in Section 7.1 is derived by considering users request from the repository. 
                           
                              ZDV
                              
                              ∧
                              
                              3
                              TC
                              
                              ∧
                              
                              NVP
                              
                              ∧
                              
                              Qui
                           
                         is recommended for Martha’s case is:
                           
                              •
                              
                                 
                                    
                                       ZDV
                                       
                                       ∧
                                       
                                       3
                                       TC
                                    
                                  is recommended for pregnancy (
                                    
                                       ZDV
                                    
                                  prevents HIV virus transmission to the child).


                                 
                                    
                                       NVP
                                       
                                       ≺
                                       
                                       [
                                       P
                                       ]
                                       EFV
                                    
                                  since EFV cannot be used in first trimester of pregnancy as well as causes severe central nervous system toxicity and Potential teratogenicity.


                                 
                                    
                                       Qui
                                       
                                       ≺
                                       
                                       [
                                       P
                                       ]
                                       Chl
                                       
                                       &
                                       Coa
                                    
                                 , because P.falciparum is a severe malaria and chloroquine is resistant for P.falciparum in the area where Martha lives. Coartem is recommended for uncomplicated malaria (WHO, 2013) and coartem should be avoided in the first trimester.


                                 
                                    
                                       ZDV
                                       
                                       ≺
                                       
                                       [
                                       P
                                       ]
                                       d
                                       4
                                       T
                                    
                                  since d4T has high toxicity and has long term side-effects; 
                                    
                                       ZDV
                                       
                                       ≺
                                       
                                       [
                                       P
                                       ]
                                       ABC
                                    
                                 , ABC has a risk of hypersensitivity


                                 
                                    
                                       ZDV
                                       
                                       ≺
                                       
                                       [
                                       P
                                       ]
                                       TDF
                                    
                                 , since TDF can cause renal damage as well as Risk of nephrotoxicity


                                 3TC or FTC is preferred for low toxicity and high efficacy.


                                 
                                    
                                       TDF
                                       
                                       ∨
                                       
                                       d
                                       4
                                       T
                                       
                                       ∨
                                       
                                       ABC
                                       
                                       ≺
                                       
                                       [
                                       P
                                       ]
                                       ZDV
                                    
                                 , if the pregnant woman is anemic or has hepatitis B.

To validate the preference model presented in the previous sections, we have developed a prototype that enriches user queries by adding personal information from the user profile, user context and domain knowledge. The interface asks the user their ID and the symptoms (as presented in Fig. 16
                     ) that describes their situation.

The prototype enriches a user query as follows: (1) the dialogue system (the user interface) sends a request to the query interpreter. The request contains user identification and list of symptoms. (2) After receiving the request, the query interpreter performs the following tasks: (a) personalize the request by adding patient’s profile, consisting of user demography (age and gender), patients’s history (illnesses, medication, and diagnosis), patient’s preferences (injection, tablet, etc.) and user context (location, season); (b) add medical information from the medical knowledge repository onto the query. The repository contains information about diseases, symptoms, drugs, side effects, conflicting drugs and drug costs. Finally, the enriched query (that contains symptoms, user profile, user context and domain knowledge) will be send to the matchmaker.

After the completion of the query enrichment process, the next step is matchmaking. Firstly, the prototype provides a symptom score for each candidate disease; then the prototype checks for associated diseases. In addition, the prototype checks whether the candidate disease is common in the given location and if it is seasonal.

After obtaining the possible diseases, the prototype lists the possible treatments. Then the prototype performs the following tasks:
                        
                           •
                           List candidate drugs and phases of the drugs.

Select non-allergic drugs.

Identify conflicting drugs.

When the patient is currently on medication, it removes the corresponding drugs from the lists of the candidate drugs.

Scrutinize the user preferences from the database especially on drug adherence (injection, capsule or tablet, syrup, etc.), and calculate the risks and cost of the drugs.

Determine dosage based on patient’s age and weight.

Finally, the prototype lists the potential treatments.

For example: A 40years old man has the following symptoms for the last four days: headache, high fever (39.5degrC and above), loss of appetite, diarrhea and a feeling of being weak (lethargy). As it is shown in Fig. 17
                      the prototype displays three possible diseases, symptoms score (P.vivax 2 symptoms, P.falciparum 1 symptom, and typhoid fever 5 symptoms). The prototype checks out if the disease is local, seasonal as well as if it has associated disease or not. For each selected possible disease, possible treatment (drug) are listed; in the meantime different scores are computed (e.g. symptom score: the number of symptoms given by the user and the number of symptoms of the disease); in addition the dosage of the drug, cost, preference and risk scores are listed (see Fig. 17).

@&#EVALUATION@&#

To evaluate our prototype and preference model we administered questionnaires for healthcare workers in Ethiopia and in the Netherlands. The questionnaires consist of a number of cases, each describing a patient’s health condition and list of symptoms. Some of the cases also provide detailed information about patient’s personal information, previous history, context and list of symptoms. This information is designed to evaluate and test the accuracy of the system to predict the possible illness, possible treatment and expected risks and side effects of the drug prescribed. We did not yet process the resulting data, thus the result of the study will be published in the future.

In this paper, we introduced the preference model to model user preferences. We discussed how these problems can be obtained from the user by interviewing or from the user history. Then we showed in Section 5 how the initial user query (user id and set of symptoms) can be enriched to involve the user preferences, the user context and domain knowledge. In Section 5, we showed also how preferential matching can be performed. We also presented a prototype to demonstrate our approach.

The medial decision making process is an example of advanced multi-criteria decision making. Future research many exploit the developed theory for such decision problems. Furthermore, the prototype should be further evaluated to show that the decision results from the system are compatible with health expert decisions.

@&#REFERENCES@&#

