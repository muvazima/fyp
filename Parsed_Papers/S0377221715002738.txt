@&#MAIN-TITLE@&#On time stochastic dominance induced by mixed integer-linear recourse in multistage stochastic programs

@&#HIGHLIGHTS@&#


               
               
                  
                     
                        
                           
                           Extension to the multistage case of two risk measures defined for two-stage problems.


                        
                        
                           
                           Time stochastic dominance (TSD) policy. A new risk averse strategy.


                        
                        
                           
                           Extension of our Branch-and-Fix Coordination (BFC) algorithm to deal with TSD policy.


                        
                        
                           
                           Computational comparison between risk neutral approach and some risk averse strategies.


                        
                        
                           
                           Broad analysis of the performance of BFC-TSD algorithm versus plain use of CPLEX.


                        
                     
                  
               
            

@&#KEYPHRASES@&#

Multistage stochastic mixed 0-1 Optimization

Scenario clustering

Mixed 0-1 deterministic equivalent model

Risk averse measures

Stochastic dominance constraints

@&#ABSTRACT@&#


               
               
                  We propose in this work a new multistage risk averse strategy based on Time Stochastic Dominance (TSD) along a given horizon. It can be considered as a mixture of the two risk averse measures based on first- and second-order stochastic dominance constraints induced by mixed integer-linear recourse, respectively. Given the dimensions of medium-sized problems augmented by the new variables and constraints required by this new risk measure, it is unrealistic to solve the problem up to optimality by plain use of MIP solvers in a reasonable computing time, at least. Instead of it, decomposition algorithms of some type should be used. We present an extension of our Branch-and-Fix Coordination algorithm, so named BFC-TSD, where a special treatment is given to cross scenario group constraints that link variables from different scenario groups. A broad computational experience is presented by comparing the risk neutral approach and the tested risk averse strategies. The performance of the new version of the BFC algorithm versus the plain use of a state-of-the-art MIP solver is also reported.
               
            

@&#INTRODUCTION@&#

A multistage stochastic optimization model has a more complex scenario information structuring than its related sometimes approximating two-stage model. For the general formulation of a multistage model, where decisions on each stage have to be made stage-wise, let Ω denote the set of scenarios that are considered to be representative of the uncertainty in the problem and 
                        T
                      is the set of stages in the given time horizon. At every state, i.e., node (also so-named scenario group), say g in set 
                        
                           
                              G
                              t
                           
                           ,
                        
                      where it is the set of nodes in stage 
                        
                           t
                           ∈
                           T
                        
                      in the related scenario tree, there is information about the past that is known with certainty. That information consists of the realization of the uncertain parameters in the node and in its ancestor ones, say set 
                        
                           A
                           g
                        
                     . On the other hand, it is also known at that node g what scenarios will not happen in the future, i.e., the scenarios in set Ω/Ωg
                      where Ωg
                      denotes the set of scenarios that belong to group g, since the realizations of their uncertain parameters are identical up to stage t, for 
                        
                           t
                           ∈
                           T
                           :
                           g
                           ∈
                           
                              G
                              t
                           
                        
                     . So, the decision variables at each node g should be based on the known information without anticipating future information although using as much information as possible (being represented in set Ωg
                     ). That is, nonanticipativity (for short, NA) principle introduced in Wets (1974) for two-stage problems should be satisfied. Additionally, at a first glance it seems appropriate to consider that the optimal policy (i.e., the decision variables) at node g in stage t should not depend on scenarios which do not below to set Ωg
                     , i.e., ‘cannot happen in the future’ as stated in Shapiro (2009). It is so-named time consistency principle, that can be formalized as follows: Let z
                     1 denote the solution vector related to a scenario ω ∈ Ω in the optimal one of the stochastic models where scenario ω belongs to. On the other hand, let z
                     2 denote the optimal solution of the submodel in the stochastic one independently solved for scenario ω, where the subvector of variables up to a node, say g such that ω ∈ Ωg
                     , 
                        
                           g
                           ∈
                           G
                        
                      is fixed to the related values from vector z
                     1, for 
                        
                           g
                           ∈
                           G
                           ,
                        
                      where 
                        G
                      is the set of nodes (i.e., the scenario groups) in the scenario tree. So, the time consistency principle is satisfied by the optimal solution z
                     1 if it coincides with the solution vector z
                     2; see Ruszczynski (2010) and Shapiro (2009), and for slightly different contexts, see Kovacevic and Pflug (2008) and Rudloff, Street, and Valladäo (2014).

Notice that the NA principle paved the way for a dual block-angular representation of the problem, introduced in Wets (1975) and known as Deterministic Equivalent Model (DEM, for short). Traditionally, special attention has been given to the DEM by optimizing (in our case, maximizing) the objective function expected value over the set of scenarios, along the time horizon, subject to the satisfaction of all the problem constraints in the defined scenarios. It is the so named risk neutral (RN) strategy. Currently, we are able to solve RN-based medium-sized mixed 0-1 DEMs by using different types of decomposition approaches, e.g., see in Escudero, Garín, Merino, and Pérez (2010; 2012) a description of our Branch-and-Fix Coordination (BFC) algorithm. However, the optimization of the RN-based objective function expected value has the inconvenience of providing a solution that ignores the variability of the objective function value over the scenarios. So, it does not hedge against the occurrence of low-probability high-consequence events (i.e., the so named black swan events). For multistage optimization the RN measure, obviously, satisfies the time consistency principle, since it is only based on averages (expectations) in the objective function value for feasible (implementable) decision variables (i.e., the ones satisfying the NA principle).

Alternatively, there are some multistage approaches that also deal with the type of risk management that provides hedging solutions against the occurrence of some non-desired scenarios. Those approaches consider semi-deviations, scenario optimization, value-at-risk (VaR), conditional value-at-risk (CVaR), mean-expected shortfall and mean-risk, among other risk averse measures, see some surveys in Alonso-Ayuso et al. (2014) and Pflug and Römisch (2007). Our BFC approach can be easily adapted to those strategies. Additionally, there are some other risk averse strategies as the VaR measure, among others, that require the extension of our BFC procedure due to the requirement of considering cross scenario group constraints; a difficult issue (see below) for multistage problems, being the subject of this work. Note: A cross scenario constraint is a constraint where there are variables with nonzero elements that belong to different scenario groups of the same stage.

Some risk averse measures satisfy the time consistency principle and some others not, see Shapiro (2009), although all of them are implementable. Risk averse CVaR-based approaches with time consistency have been proposed in the literature, see Bäuerle and Mundt (2009), Boda and Filar (2006), Cuoco, He, and Issaenko (2008), Dupacová and Knozmik (2014), Fábián and Veszprémi (2008), Philpott and de Matos (2012), Rudloff et al. (2014), among others.

Recently, new risk averse strategies have appeared in the literature, in particular, the first- and second-order Stochastic Dominance Constraints (SDC) strategies (so-named FSD and SSD, respectively) for a set of profiles. Each profile is included by a threshold value on a given function and some types of shortfall related bounds on reaching it. See Dentcheva and Ruszczynski (2003; 2010) for the case of continuous variables where the problem is considered as a semi-infinite one, Dentcheva and Martinez (2012) for the general continuous case, and Gollmer, Neise, and Schultz (2008) for FSD and Gollmer, Gotzes, and Schultz (2011) for SSD induced by mixed integer-linear recourse on a finite set of scenarios for two-stage. More recently, an application in mining is presented in Alonso-Ayuso et al. (2014) (by plain use of a MIP solver for a multistage problem), some applications in energy are described in Carrión, Gotzes, and Schultz (2009), Drapkin, Gollmer, Gotzes, Neise, and Schultz (2011), and Gollmer et al. (2011) (by using Lagrangian heuristics and cutting plane approaches for two-stage problems) and some applications in finance are introduced in Aranburu, Escudero, Garín, and Pérez (2012); Lizyayev (2012), Fábián, Mitra, Roman, and Zverovich (2011), and Roman, Mitra, and Zverovich (2013) (the first one for a multistage problem, the second for a two stage environment, the third and fourth for a single stage problem, particularly for SSD), among others. See in Dupacová and Kopa (2014) a robust approach for FSD applied to financial portfolio optimization. New numerical methods for a general SSD model are studied in Meskarian, Xu, and Fliege (2012), such that the risk constraints are penalized in the objective function under Slater’s constraint qualification and then the well known Stochastic Approximation and the Level Function methods are applied to solve the penalized problem. The portfolio optimization problem is used as a pilot case. On the other hand, the problem of comparing random vectors arises in many applications. New concepts of stochastically weighted dominance for comparing random vectors are studied in Hu, Homem-de Mello, and Mehrotra (2014). Some advantages of the new concepts are illustrated with the help of a capital budgeting example. Additionally, general Nth order Stochastic Dominance criteria for discrete probability distributions are studied in Post and Kopa (2013). The approach is based on a piece-wise polynomial representation of utility and its derivatives to be implemented by solving a relatively small system of linear inequalities. Based on a portfolio optimization case, the results illustrate that the mean-variance rule and SSD functional may not detect market portfolio inefficiency.

By construction, SDC-based strategies as well as any other measure that requires cross scenario (or scenario group) constraints (as VaR Gaivoronski and Pflug, 1999, mean-expected shortfall Eppen, Martin, and Schrage, 1989; Guigues, 2014 and mean-risk Schultz and Tiedemann, 2003, among others) do not satisfy the time consistency principle as it has been enunciated above. The reason is that the optimal values of the decision variables at any node also require to use information from scenarios that at that time is known that will not happen but, for hedging purposes, that ‘outside’ information is required. So, they do not satisfy the time consistency principle.

Given the broad applicability of those risk averse strategies we consider the time stochastic dominance (for short, TSD) strategy (that does not satisfy the time consistency principle) to cover those situations where risk reduction should be performed for hedging values of given functions (the objective one, in our case) along the time horizon. Notice that the risk neutral strategy satisfies the time consistency principle. However, in cases where its ‘optimal’ solution results in high variability in the objective function value over the scenarios, the TSD strategy has the advantage of better risk reduction of non-wanted scenarios. The decision on how far the objective function expected value is from a scenario solution depends on the problem’s structure and the modeler-driven risk management safeguards.

In this work we consider a threshold value on the objective function at the end of the time horizon, as well as at a modeler-driven subset of stages. So, our approach extends a mixture of the two recent two-stage SDC strategies introduced in Gollmer et al. (2011, 2008) to the multistage risk averse environment with TSD. The new strategy requires additional variables and constraints. The new variables are binary ones for the FSD strategy, and they are continuous ones for the SSD. The difference between FSD and SSD strategies is that the former considers bounds on the probability of failure that the objective function value reaches the thresholds, and the latter considers bounds on the expected shortfall on reaching them. Given the dimensions of medium-sized instances augmented by the new variables and constraints required by the risk measures to consider, it is unrealistic to solve the problem up to optimality by plain use of MIP solvers in a reasonable computing time. Instead of it, one should use decomposition algorithms of some type. However, since both strategies (FSD and SSD) require cross scenario group constraints, the nice decomposable scenario group-based structure of the problem is partially destroyed. So, traditional Benders-based (Benders, 1962) decomposition and splitting variable schemes such as scenario group-based decomposition (Escudero, Garín, Merino, & Pérez, 2012), cluster Lagrangean decomposition (Escudero, Garín, & Unzueta, submitted for publication) and stage-based decomposition (Mahlke, 2011) cannot be used, among other types of decomposition algorithms. The key idea of those algorithms is that the original scenario tree-based model can be easily decomposed in independent scenario-related or stage-related submodels and, then, models with cross scenario group constraints along the stages cannot be solved by those schemes without an appropriate modification.

We propose in this work the new multistage risk averse strategy so named TSD as a mixture of the soft FSD and SSD ones, presenting its advantages as well as the computational price to be paid for using plain MIP solvers, instead of appropriate decomposition approaches. Additionally, an extension of the BFC algorithm is also proposed for dealing with the cross scenario group constraints that are required particularly by the risk measures to consider in this work (besides some important refinements for branch cutting purposes). The rationale behind considering soft versions of the strategies is that it could be possible that both FSD and SSD may not be simultaneously satisfied. Then, since they are modeler-driven risk management policies (i.e., they are not physical requirements) and their potential violation is to be heavily penalized, the resulting solution may still be useful for decision making, see below. So, let BFC-TSD be the name for the new proposed algorithm. A broad computational experience is presented by comparing the risk neutral strategy and the tested risk averse ones. The performance of the new version of the BFC algorithm versus the plain use of a state-of-the-art MIP solver is also reported.

The remainder of the paper is organized as follows. In Section 2 the multistage mixed 0-1 optimization models for the RN and TSD strategies are presented. Section 3 presents the corresponding original RN model as a mixture of the splitting variable and compact representations, and the related scenario cluster submodels on which the original model can be decomposed. Section 4 presents the BFC-TSD algorithm for problem solving. Section 5 reports computational results of using the new algorithm for solving a test bed of medium-sized instances. A comparison between the RN and TSD models is performed as mentioned above. Finally, some conclusions are withdrawn in Section 6. The appendices present some illustrative graphics and the meaning of abbreviations used in the work.

Without loss of generality, let us consider the compact representation of the multistage mixed 0-1 RN model for maximizing the objective function expected value over the set of scenarios Ω in the scenario tree that is used for representing the random parameters and decision variables.

                        
                           (1)
                           
                              
                                 
                                    
                                    
                                       
                                          
                                             
                                                z
                                                RN
                                             
                                             =
                                             max
                                             
                                                ∑
                                                
                                                   g
                                                   ∈
                                                   G
                                                
                                             
                                             
                                                w
                                                g
                                             
                                             
                                                (
                                                
                                                   a
                                                   g
                                                
                                                
                                                   x
                                                   g
                                                
                                                +
                                                
                                                   b
                                                   g
                                                
                                                
                                                   y
                                                   g
                                                
                                                )
                                             
                                          
                                       
                                    
                                 
                                 
                                    
                                    
                                       
                                          
                                             s.t.
                                             
                                                ∑
                                                
                                                   q
                                                   ∈
                                                   
                                                      A
                                                      g
                                                   
                                                
                                             
                                             
                                                (
                                                
                                                   A
                                                   g
                                                   q
                                                
                                                
                                                   x
                                                   q
                                                
                                                +
                                                
                                                   B
                                                   g
                                                   q
                                                
                                                
                                                   y
                                                   q
                                                
                                                )
                                             
                                             =
                                             
                                                h
                                                g
                                             
                                             
                                             
                                             
                                             
                                             ∀
                                             g
                                             ∈
                                             G
                                          
                                       
                                    
                                 
                                 
                                    
                                    
                                       
                                          
                                             s
                                             .
                                             t
                                             .
                                          
                                          
                                             x
                                             g
                                          
                                          ∈
                                          
                                             
                                                {
                                                0
                                                ,
                                                1
                                                }
                                             
                                             
                                                n
                                                x
                                                (
                                                g
                                                )
                                             
                                          
                                          ,
                                          
                                             y
                                             g
                                          
                                          ∈
                                          I
                                          
                                          
                                          
                                             R
                                             
                                                n
                                                y
                                                (
                                                g
                                                )
                                             
                                          
                                          
                                          ∀
                                          g
                                          ∈
                                          G
                                          ,
                                       
                                    
                                 
                              
                           
                        
                     where wg
                      is the likelihood or probability of scenario group g to be computed as 
                        
                           
                              ∑
                              
                                 ω
                                 ∈
                                 
                                    Ω
                                    g
                                 
                              
                           
                           
                              w
                              ω
                           
                        
                     ; ω is a scenario in set Ωg
                     ⊆Ω of group 
                        
                           g
                           ∈
                           G
                        
                     ; wω
                      is the modeler-driven weight assigned to scenario ω ∈ Ω; 
                        
                           A
                           g
                        
                      is the set of indexes for the ancestor scenario groups to group g (including itself) whose decisions have direct influence (i.e., have non zero elements) on the constraints for scenario group g, where 
                        
                           
                              A
                              1
                           
                           =
                           
                              {
                              1
                              }
                           
                        
                     ; xg
                      and yg
                      are the vectors of the 0-1 and continuous variables for scenario group g, respectively; ag
                      and bg
                      are the vectors of the objective function coefficients for the 0-1 and continuous variables, respectively; 
                        
                           A
                           g
                           q
                        
                      and 
                        
                           B
                           g
                           q
                        
                      are the constraint matrices of ancestor scenario group 
                        
                           q
                           ∈
                           
                              A
                              g
                           
                        
                      of group g for the vectors xq
                      and yq
                     , respectively; hg
                      is the right-hand-side vector (rhs) for scenario group g; and nx(g) and ny(g) are the numbers of 0-1 and continuous variables, for 
                        
                           g
                           ∈
                           G
                           ,
                        
                      respectively.

Notice that the constraint system in model (1) is a generalization of the traditional one, where if 
                        
                           
                              A
                              g
                           
                           /
                           
                              {
                              g
                              }
                           
                        
                      is singleton then q for 
                        
                           q
                           ∈
                           
                              A
                              g
                           
                           /
                           
                              {
                              g
                              }
                           
                        
                      is usually the index of the immediate ancestor scenario group of group g. Examples of a non-singleton set 
                        
                           A
                           g
                        
                      are frequent in transportation models where the trip starting period is different from its arrival one, supply chain management (where the decision on suppliers’ selection and raw material supplying commitment at the beginning of the time horizon impacts on the volume to be supplied in later periods), site location in a dynamic setting, power unit commitment lasting for more than one period, investment planning where the period at which the investment is made in factories, power plants, energy transmission lines, warehouses, distribution centers, etc. is different from the period at which the investment is made available for being used. In those situations the constraints of a given scenario group have nonzero elements for the variables of ancestor scenario groups.

Additionally, let t(g) denote the stage from set 
                        T
                      to which group g belongs to; 
                        
                           T
                           =
                           |
                           T
                           |
                        
                     ; and observe that Ωg
                      is a singleton for 
                        
                           g
                           ∈
                           
                              G
                              T
                           
                        
                     . See e.g., Birge and Louveaux (2011) for the main concepts on stochastic optimization via scenario tree analysis.

RN model (1) aims to maximize the objective function expected value alone. The main criticism that can be made to this very popular strategy, as stated above, is that it ignores the variability of the objective function value over the scenarios and, in particular in our case, the “left” tail of the non-wanted scenarios. However, there are some risk averse approaches that additionally deal with risk management; among them, TSD model (2) reduces the risk of wrong solutions in a better way than the other ones under some hypotheses, see e.g., Alonso-Ayuso et al. (2014). It also aims to maximize the objective function expected value as RN model (1). Additionally, a set of given thresholds on a function value for each scenario should be satisfied with a bound target on the probability of failure due to a shortfall on reaching each threshold as well as a bound target on the expected shortfall on reaching it. Particularly, the model requires a set of modeler-driven profiles, say 
                        
                           
                              P
                              t
                           
                           ,
                        
                      given by the n-tupla 
                        
                           
                              (
                              
                                 ϕ
                                 p
                              
                              ,
                              
                              
                                 e
                                 p
                              
                              ,
                              
                              
                                 β
                                 p
                              
                              ,
                              
                              
                                 S
                                 p
                              
                              )
                           
                           
                           ∀
                           p
                           ∈
                           
                              P
                              t
                           
                           ,
                           
                           t
                           ∈
                           
                              T
                              ˜
                           
                           ,
                        
                      where ϕp
                      is the threshold on the objective function value (for short, the profit) to be satisfied up to node (i.e., scenario group) g in the scenario tree, ep
                      is the upper bound target on the expected shortfall on reaching threshold ϕp
                      with a target on the shortfall probability bound βp
                     , and Sp
                      is the maximum shortfall that is allowed on reaching the threshold for scenario group g, for 
                        
                           g
                           ∈
                           
                              G
                              t
                           
                           ,
                           t
                           ∈
                           
                              T
                              ˜
                           
                           ,
                        
                      where 
                        
                           T
                           ˜
                        
                      denotes the set of stages in 
                        T
                      for which the TSD policy is considered.

                        
                           (2)
                           
                              
                                 
                                    
                                       
                                          
                                             
                                                z
                                                TSD
                                             
                                             =
                                             max
                                             
                                                ∑
                                                
                                                   g
                                                   ∈
                                                   G
                                                
                                             
                                             
                                                w
                                                g
                                             
                                             
                                                (
                                                
                                                   a
                                                   g
                                                
                                                
                                                   x
                                                   g
                                                
                                                +
                                                
                                                   b
                                                   g
                                                
                                                
                                                   y
                                                   g
                                                
                                                )
                                             
                                             −
                                             
                                                ∑
                                                
                                                   t
                                                   ∈
                                                   
                                                      T
                                                      ˜
                                                   
                                                
                                             
                                             
                                                ∑
                                                
                                                   p
                                                   ∈
                                                   
                                                      P
                                                      t
                                                   
                                                
                                             
                                             
                                                (
                                                
                                                   M
                                                   e
                                                   p
                                                
                                                
                                                   ϵ
                                                   e
                                                   p
                                                
                                                +
                                                
                                                   M
                                                   β
                                                   p
                                                
                                                
                                                   ϵ
                                                   β
                                                   p
                                                
                                                )
                                             
                                          
                                       
                                    
                                 
                                 
                                    
                                       
                                          
                                             
                                                s.t.
                                             
                                             
                                                
                                                   
                                                      
                                                         ∑
                                                         
                                                            q
                                                            ∈
                                                            
                                                               A
                                                               g
                                                            
                                                         
                                                      
                                                      
                                                         A
                                                         g
                                                         q
                                                      
                                                      
                                                         x
                                                         q
                                                      
                                                      +
                                                      
                                                         B
                                                         g
                                                         q
                                                      
                                                      
                                                         y
                                                         q
                                                      
                                                      =
                                                      
                                                         h
                                                         g
                                                      
                                                   
                                                
                                             
                                             
                                                
                                                   ∀
                                                   g
                                                   ∈
                                                   G
                                                
                                             
                                          
                                          
                                             
                                             
                                                
                                                   
                                                      
                                                         ∑
                                                         
                                                            q
                                                            ∈
                                                            
                                                               
                                                                  A
                                                                  ˜
                                                               
                                                               g
                                                            
                                                         
                                                      
                                                      
                                                         (
                                                         
                                                            a
                                                            q
                                                         
                                                         
                                                            x
                                                            q
                                                         
                                                         +
                                                         
                                                            b
                                                            q
                                                         
                                                         
                                                            y
                                                            q
                                                         
                                                         )
                                                      
                                                      +
                                                      
                                                         s
                                                         
                                                            g
                                                            
                                                            p
                                                         
                                                      
                                                      ≥
                                                      
                                                         ϕ
                                                         p
                                                      
                                                   
                                                
                                             
                                             
                                                
                                                   ∀
                                                   g
                                                   ∈
                                                   
                                                      G
                                                      t
                                                   
                                                   ,
                                                   p
                                                   ∈
                                                   
                                                      P
                                                      t
                                                   
                                                   ,
                                                   t
                                                   ∈
                                                   
                                                      T
                                                      ˜
                                                   
                                                
                                             
                                          
                                          
                                             
                                             
                                                
                                                   0
                                                   ≤
                                                   
                                                      s
                                                      
                                                         g
                                                         
                                                         p
                                                      
                                                   
                                                   ≤
                                                   
                                                      S
                                                      p
                                                   
                                                   
                                                      ν
                                                      
                                                         g
                                                         
                                                         p
                                                      
                                                   
                                                
                                             
                                             
                                                
                                                   ∀
                                                   g
                                                   ∈
                                                   
                                                      G
                                                      t
                                                   
                                                   ,
                                                   p
                                                   ∈
                                                   
                                                      P
                                                      t
                                                   
                                                   ,
                                                   t
                                                   ∈
                                                   
                                                      T
                                                      ˜
                                                   
                                                
                                             
                                          
                                          
                                             
                                             
                                                
                                                   
                                                      
                                                         ∑
                                                         
                                                            g
                                                            ∈
                                                            
                                                               G
                                                               t
                                                            
                                                         
                                                      
                                                      
                                                         w
                                                         g
                                                      
                                                      
                                                         s
                                                         
                                                            g
                                                            
                                                            p
                                                         
                                                      
                                                      ≤
                                                      
                                                         e
                                                         p
                                                      
                                                      +
                                                      
                                                         ϵ
                                                         e
                                                         p
                                                      
                                                   
                                                
                                             
                                             
                                                
                                                   ∀
                                                   p
                                                   ∈
                                                   
                                                      P
                                                      t
                                                   
                                                   ,
                                                   t
                                                   ∈
                                                   
                                                      T
                                                      ˜
                                                   
                                                
                                             
                                          
                                          
                                             
                                             
                                                
                                                   
                                                      
                                                         ∑
                                                         
                                                            g
                                                            ∈
                                                            
                                                               G
                                                               t
                                                            
                                                         
                                                      
                                                      
                                                         w
                                                         g
                                                      
                                                      
                                                         ν
                                                         
                                                            g
                                                            
                                                            p
                                                         
                                                      
                                                      ≤
                                                      
                                                         β
                                                         p
                                                      
                                                      +
                                                      
                                                         ϵ
                                                         β
                                                         p
                                                      
                                                   
                                                
                                             
                                             
                                                
                                                   ∀
                                                   p
                                                   ∈
                                                   
                                                      P
                                                      t
                                                   
                                                   ,
                                                   t
                                                   ∈
                                                   
                                                      T
                                                      ˜
                                                   
                                                
                                             
                                          
                                          
                                             
                                             
                                                
                                                   
                                                      x
                                                      g
                                                   
                                                   ∈
                                                   
                                                      
                                                         {
                                                         0
                                                         ,
                                                         1
                                                         }
                                                      
                                                      
                                                         n
                                                         x
                                                         (
                                                         g
                                                         )
                                                      
                                                   
                                                   ,
                                                   
                                                      y
                                                      g
                                                   
                                                   ∈
                                                   I
                                                   
                                                   
                                                   
                                                      R
                                                      
                                                         n
                                                         y
                                                         (
                                                         g
                                                         )
                                                      
                                                   
                                                
                                             
                                             
                                                
                                                   ∀
                                                   g
                                                   ∈
                                                   G
                                                
                                             
                                          
                                          
                                             
                                             
                                                
                                                   
                                                      ν
                                                      
                                                         g
                                                         
                                                         p
                                                      
                                                   
                                                   ∈
                                                   
                                                      {
                                                      0
                                                      ,
                                                      1
                                                      }
                                                   
                                                
                                             
                                             
                                                
                                                   ∀
                                                   g
                                                   ∈
                                                   
                                                      G
                                                      t
                                                   
                                                   ,
                                                   p
                                                   ∈
                                                   
                                                      P
                                                      t
                                                   
                                                   ,
                                                   t
                                                   ∈
                                                   
                                                      T
                                                      ˜
                                                   
                                                
                                             
                                          
                                          
                                             
                                             
                                                
                                                   0
                                                   ≤
                                                   
                                                      ϵ
                                                      e
                                                      p
                                                   
                                                   ≤
                                                   
                                                      S
                                                      p
                                                   
                                                   −
                                                   
                                                      e
                                                      p
                                                   
                                                   ,
                                                
                                             
                                          
                                          
                                             
                                             
                                                
                                                   0
                                                   ≤
                                                   
                                                      ϵ
                                                      β
                                                      p
                                                   
                                                   ≤
                                                   1
                                                   −
                                                   
                                                      β
                                                      p
                                                   
                                                
                                             
                                             
                                                
                                                   ∀
                                                   p
                                                   ∈
                                                   
                                                      P
                                                      t
                                                   
                                                   ,
                                                   t
                                                   ∈
                                                   
                                                      T
                                                      ˜
                                                   
                                                   ,
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           
                        
                     where 
                        
                           
                              A
                              ˜
                           
                           g
                        
                      is the set of indices for the ancestor scenario groups of group g and, so, 
                        
                           
                              A
                              g
                           
                           ⊆
                           
                              
                                 A
                                 ˜
                              
                              g
                           
                        
                      ; sgp
                      is the shortfall (continuous) variable that, obviously, is equal to the difference (if it is positive) between threshold ϕp
                      and the profit for scenario group g, νgp
                      is a 0-1 variable such that its value is 1 if the profit for scenario group g has a shortfall, and otherwise, 0; and 
                        
                           ϵ
                           e
                           p
                        
                      and 
                        
                           ϵ
                           β
                           p
                        
                      are the slack variables that take the violation of the e- and β-bounds, respectively, being 
                        
                           M
                           e
                           p
                        
                      and 
                        
                           M
                           β
                           p
                        
                      the related big enough M-parameters for penalizing those variables in the objective function. Observe that the constraints with the rhs ep
                      and βp
                      are precisely the cross scenario group constraints for the last stage T assuming that 
                        
                           T
                           ∈
                           
                              T
                              ˜
                           
                        
                      and, any case, they are the cross scenario group constraints for any stage in set 
                        
                           
                              T
                              ˜
                           
                           ,
                        
                      since the weighted variables sgp
                      and νgp
                      are summed up for all scenario groups in set 
                        
                           G
                           t
                        
                      for 
                        
                           p
                           ∈
                           
                              P
                              t
                           
                           ,
                           t
                           ∈
                           
                              T
                              ˜
                           
                        
                     . Notice that the TSD strategy consists of controlling the objective function value at modeler-driven stages, instead of only performing it at the end of the time horizon. It is very useful for applications with long horizons. The concept of the expected shortfall on reaching a given profit threshold has its roots in the Integrated Chance Constraints concept introduced in Haneveld (1986), see also Haneveld and van der Vlerk (2006); in different contexts, see Luedtke (2014) and Shen, Smith, and Ahmed (2010).

In Escudero et al. (2012) we propose a decomposition of the nonsymmetric scenario tree into a set of scenario cluster subtrees. Based on this cluster decomposition concept a splitting-compact representation of the original multistage stochastic mixed 0-1 RN model is presented. The reason for such decomposition is based on the way in which our BFC decomposition algorithm works. It explicitly considers the nonanticipativity constraints (NAC) of the variables of scenario groups in different cluster subtrees. By construction, those scenario groups belong to stages up to a given so-named break stage, t
                     * (see below). On the other hand, the NAC of the variables of scenario groups that belong from the next stage to the break one until the last stage are implicitly considered while solving the scenario cluster submodels. Let us consider the following definitions taken from Escudero et al. (2012).

                        Definition 1
                        A 
                              break stage t
                           * is a stage such that the number of scenario clusters is 
                              
                                 
                                    C
                                    =
                                    |
                                 
                                 
                                    G
                                    
                                       
                                          t
                                          *
                                       
                                       +
                                       1
                                    
                                 
                                 
                                    |
                                    ,
                                 
                              
                            where 
                              
                                 
                                    t
                                    *
                                 
                                 +
                                 1
                                 ∈
                                 T
                              
                           . In this case, any cluster 
                              
                                 c
                                 ∈
                                 C
                              
                            is induced by a group 
                              
                                 g
                                 ∈
                                 
                                    G
                                    
                                       
                                          t
                                          *
                                       
                                       +
                                       1
                                    
                                 
                              
                            and contains all the scenarios belonging to that group.

The 
                              scenario cluster
                           submodels are those that result from the relaxation of the NAC until break stage t
                           *.

For clarification purposes, see Fig. 1, where the NAC of the variables for node 1 (res. nodes 1, 2 and 3) in the scenario tree shown in the left part of the figure have been relaxed for break stage t
                     * = 1 (res. t
                     * = 2) in the center (res. right) part of the figure.

Once decided the break stage t
                     *, the corresponding t
                     *-cluster partition is given and then, the number of scenario clusters C is fixed to 
                        
                           
                              |
                           
                           
                              G
                              
                                 
                                    t
                                    *
                                 
                                 +
                                 1
                              
                           
                           
                              |
                              ,
                           
                        
                      i.e., where each group in 
                        
                           G
                           
                              
                                 t
                                 *
                              
                              +
                              1
                           
                        
                      belongs to just one scenario cluster in set 
                        
                           C
                           =
                           {
                           1
                           ,
                           …
                           ,
                           C
                           }
                           ,
                        
                      with 
                        
                           C
                           =
                           |
                           C
                           |
                        
                     . Let Ωc
                      = Ωg
                      for 
                        
                           g
                           ∈
                           
                              G
                              
                                 
                                    t
                                    *
                                 
                                 +
                                 1
                              
                           
                        
                      denote the set of scenarios and 
                        
                           
                              G
                              c
                           
                           ⊆
                           G
                        
                      the set of scenario groups in cluster 
                        
                           c
                           ∈
                           C
                           ,
                        
                      respectively, where 
                        
                           g
                           ∈
                           
                              G
                              c
                           
                        
                      provided that 
                        
                           
                              Ω
                              g
                           
                           ∩
                           
                              Ω
                              c
                           
                           ≠
                           ∅
                        
                     ; 
                        
                           x
                           c
                           g
                        
                      and 
                        
                           y
                           c
                           g
                        
                      denote the replicas of the variables vectors xg
                      and yg
                      for scenario group 
                        
                           g
                           ∈
                           
                              G
                              c
                           
                        
                      in scenario cluster 
                        
                           c
                           ∈
                           C
                           ,
                        
                      respectively; and xc
                      and yc
                      are the vectors that include the set of variables in the vectors 
                        
                           x
                           c
                           g
                        
                      and 
                        
                           y
                           c
                           g
                        
                      for all scenario groups 
                        
                           g
                           ∈
                           
                              G
                              c
                           
                        
                      in cluster 
                        
                           c
                           ∈
                           C
                           ,
                        
                      respectively. Note: 
                        
                           
                              G
                              t
                           
                           ∩
                           
                              G
                              c
                           
                        
                      is singleton for 
                        
                           t
                           ∈
                           T
                           :
                           t
                           ≤
                           
                              t
                              *
                           
                           +
                           1
                        
                     .

Now, we can formulate the cluster submodels in compact representation, such that the original RN model (1) can be formulated via a mixture of the splitting variable and compact representations, so that the cluster submodels are linked by the explicit NAC up to break stage t
                     *. So, the RN compact representation of cluster submodel c for 
                        
                           c
                           ∈
                           C
                        
                      can be formulated as follows:

                        
                           (3)
                           
                              
                                 
                                    
                                       
                                          
                                             
                                                z
                                                c
                                             
                                             =
                                             max
                                             
                                                ∑
                                                
                                                   g
                                                   ∈
                                                   
                                                      G
                                                      c
                                                   
                                                
                                             
                                             
                                                w
                                                c
                                                g
                                             
                                             
                                                (
                                                
                                                   a
                                                   g
                                                
                                                
                                                   x
                                                   c
                                                   g
                                                
                                                +
                                                
                                                   b
                                                   g
                                                
                                                
                                                   y
                                                   c
                                                   g
                                                
                                                )
                                             
                                          
                                       
                                    
                                 
                                 
                                    
                                       
                                          
                                             
                                                s.t.
                                             
                                             
                                                
                                                   
                                                      
                                                         ∑
                                                         
                                                            q
                                                            ∈
                                                            
                                                               A
                                                               g
                                                            
                                                         
                                                      
                                                      
                                                         A
                                                         g
                                                         q
                                                      
                                                      
                                                         x
                                                         c
                                                         q
                                                      
                                                      +
                                                      
                                                         B
                                                         g
                                                         q
                                                      
                                                      
                                                         y
                                                         c
                                                         q
                                                      
                                                      =
                                                      
                                                         h
                                                         g
                                                      
                                                   
                                                
                                             
                                             
                                                
                                                   ∀
                                                   g
                                                   ∈
                                                   
                                                      G
                                                      c
                                                   
                                                
                                             
                                          
                                          
                                             
                                             
                                                
                                                   
                                                      x
                                                      c
                                                      g
                                                   
                                                   ∈
                                                   
                                                      
                                                         {
                                                         0
                                                         ,
                                                         1
                                                         }
                                                      
                                                      
                                                         n
                                                         x
                                                         (
                                                         g
                                                         )
                                                      
                                                   
                                                   ,
                                                   
                                                      y
                                                      c
                                                      g
                                                   
                                                   ∈
                                                   I
                                                   
                                                   
                                                   
                                                      R
                                                      
                                                         n
                                                         y
                                                         (
                                                         g
                                                         )
                                                      
                                                   
                                                
                                             
                                             
                                                
                                                   ∀
                                                   g
                                                   ∈
                                                   
                                                      G
                                                      c
                                                   
                                                   ,
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           
                        
                     where 
                        
                           
                              w
                              c
                              g
                           
                           =
                           
                              ∑
                              
                                 ω
                                 ∈
                                 
                                    Ω
                                    g
                                 
                                 ∩
                                 
                                    Ω
                                    c
                                 
                              
                           
                           
                              w
                              ω
                           
                           ,
                        
                     
                     
                        
                           
                              w
                              c
                              g
                           
                           =
                           
                              w
                              q
                           
                        
                      being 
                        
                           q
                           ∈
                           
                              G
                              
                                 t
                                 *
                                 +
                                 1
                              
                           
                           ∩
                           
                              G
                              c
                           
                        
                      for 
                        
                           g
                           :
                           t
                           
                              (
                              g
                              )
                           
                           ∈
                           
                              T
                              1
                           
                           ,
                        
                      and 
                        
                           
                              w
                              c
                              g
                           
                           =
                           
                              w
                              g
                           
                        
                      for 
                        
                           g
                           :
                           t
                           
                              (
                              g
                              )
                           
                           ∈
                           
                              T
                              2
                           
                        
                     .

Let us first split the set of stages 
                        T
                      in two subsets, such that 
                        
                           T
                           =
                           
                              T
                              1
                           
                           ⋃
                           
                              T
                              2
                           
                           ,
                        
                      where 
                        
                           
                              T
                              1
                           
                           =
                           
                              {
                              1
                              ,
                              …
                              ,
                              
                                 t
                                 *
                              
                              }
                           
                           ,
                        
                      and 
                        
                           
                              T
                              2
                           
                           =
                           
                              {
                              
                                 t
                                 *
                              
                              +
                              1
                              ,
                              …
                              ,
                              T
                              }
                           
                        
                     . Now, in the splitting-compact representation of RN model (1), the nonanticipativity principle is implicitly taken into account for the stages 
                        
                           t
                           ∈
                           
                              T
                              2
                           
                           ,
                        
                      since the submodel for each cluster is formulated via a compact representation. On the other hand, the (explicit) NAC of the scenario clusters for the stages in set 
                        
                           T
                           1
                        
                      can be formulated by observing that the clusters c and c′ have the scenario group g in common if 
                        
                           g
                           ∈
                           
                              G
                              c
                           
                           ∩
                           
                              G
                              
                                 c
                                 ′
                              
                           
                           ,
                        
                      and it could only happen for 
                        
                           g
                           ∈
                           
                              G
                              t
                           
                           :
                           t
                           ∈
                           
                              T
                              1
                           
                        
                     . So, the cluster submodels (3) are linked by the NAC to be formulated as follows:

                        
                           (4)
                           
                              
                                 
                                    x
                                    c
                                    g
                                 
                                 −
                                 
                                    x
                                    
                                       
                                          c
                                          ′
                                       
                                    
                                    g
                                 
                                 =
                                 0
                                 
                                 ∀
                                 c
                                 ,
                                 
                                 
                                    c
                                    ′
                                 
                                 ∈
                                 C
                                 :
                                 c
                                 ≠
                                 
                                    c
                                    ′
                                 
                                 ,
                                 g
                                 ∈
                                 
                                    G
                                    c
                                 
                                 ∩
                                 
                                    G
                                    
                                       c
                                       ′
                                    
                                 
                              
                           
                        
                     
                     
                        
                           (5)
                           
                              
                                 
                                    y
                                    c
                                    g
                                 
                                 −
                                 
                                    y
                                    
                                       
                                          c
                                          ′
                                       
                                    
                                    g
                                 
                                 =
                                 0
                                 
                                 ∀
                                 c
                                 ,
                                 
                                 
                                    c
                                    ′
                                 
                                 ∈
                                 C
                                 :
                                 c
                                 ≠
                                 
                                    c
                                    ′
                                 
                                 ,
                                 g
                                 ∈
                                 
                                    G
                                    c
                                 
                                 ∩
                                 
                                    G
                                    
                                       c
                                       ′
                                    
                                 
                                 .
                              
                           
                        
                     
                  

RN model (1) can be represented by a mixture of the splitting variable representation (for explicitly satisfying the NAC between the cluster submodels) and the compact representation (for implicitly satisfying the NAC of each cluster submodel, besides the other constraints in the submodel). So, the cluster splitting-compact representation can be expressed

                        
                           (6)
                           
                              
                                 
                                    
                                       
                                          
                                             
                                                z
                                                RN
                                             
                                             =
                                             max
                                             
                                                ∑
                                                
                                                   c
                                                   ∈
                                                   C
                                                
                                             
                                             
                                                ∑
                                                
                                                   g
                                                   ∈
                                                   
                                                      G
                                                      c
                                                   
                                                
                                             
                                             
                                                w
                                                c
                                                g
                                             
                                             
                                                (
                                                
                                                   a
                                                   g
                                                
                                                
                                                   x
                                                   c
                                                   g
                                                
                                                +
                                                
                                                   b
                                                   g
                                                
                                                
                                                   y
                                                   c
                                                   g
                                                
                                                )
                                             
                                          
                                       
                                    
                                 
                                 
                                    
                                       
                                          
                                             
                                                s.t.
                                             
                                             
                                                
                                                   
                                                      
                                                         ∑
                                                         
                                                            q
                                                            ∈
                                                            
                                                               A
                                                               g
                                                            
                                                         
                                                      
                                                      
                                                         A
                                                         g
                                                         q
                                                      
                                                      
                                                         x
                                                         c
                                                         q
                                                      
                                                      +
                                                      
                                                         B
                                                         g
                                                         q
                                                      
                                                      
                                                         y
                                                         c
                                                         q
                                                      
                                                      =
                                                      
                                                         h
                                                         g
                                                      
                                                   
                                                
                                             
                                             
                                                
                                                   ∀
                                                   g
                                                   ∈
                                                   
                                                      G
                                                      c
                                                   
                                                   ,
                                                   
                                                   c
                                                   ∈
                                                   C
                                                
                                             
                                          
                                          
                                             
                                             
                                                
                                                   NAC
                                                   
                                                   
                                                      (
                                                      4
                                                      )
                                                   
                                                   --
                                                   
                                                      (
                                                      5
                                                      )
                                                   
                                                
                                             
                                          
                                          
                                             
                                             
                                                
                                                   
                                                      x
                                                      c
                                                      g
                                                   
                                                   ∈
                                                   
                                                      
                                                         {
                                                         0
                                                         ,
                                                         1
                                                         }
                                                      
                                                      
                                                         n
                                                         x
                                                         (
                                                         g
                                                         )
                                                      
                                                   
                                                   ,
                                                   
                                                   
                                                      y
                                                      c
                                                      g
                                                   
                                                   ∈
                                                   I
                                                   
                                                   
                                                   
                                                      R
                                                      
                                                         n
                                                         y
                                                         (
                                                         g
                                                         )
                                                      
                                                   
                                                
                                             
                                             
                                                
                                                   ∀
                                                   g
                                                   ∈
                                                   
                                                      G
                                                      c
                                                   
                                                   ,
                                                   
                                                   c
                                                   ∈
                                                   C
                                                   .
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           
                        
                     
                  

Plain use of state-of-the-art MIP optimization engines for solving the stochastic version of medium-sized instances of a multistage mixed 0-1 problem may require unaffordable computing effort (in memory and elapsed time). So, a decomposition algorithm for optimizing this type of problems is required. This requirement is strongly influenced by the risk averse TSD strategy whose modeling needs additional continuous and 0-1 variables and scenario group- and stage-based constraints as well as cross scenario group constraints.

The general methodology consists of a branching approach through the scenario tree to be presented below. It requires the following additional notation: 
                           
                              
                                 t
                                 ¯
                              
                              ∈
                              
                                 T
                                 1
                              
                              ,
                           
                         current branching stage; 
                           
                              
                                 g
                                 ¯
                              
                              ∈
                              
                                 G
                                 
                                    t
                                    ¯
                                 
                              
                              ,
                           
                         branching scenario group; 
                           
                              
                                 I
                                 g
                              
                              ,
                           
                         set of indices of vector xg
                        ; and 
                           
                              
                                 i
                                 ¯
                              
                              ∈
                              
                                 I
                                 
                                    g
                                    ¯
                                 
                              
                              ,
                           
                         index of the current branching variable in vector 
                           
                              x
                              
                                 g
                                 ¯
                              
                           
                        .

The main concepts of the BFC methodology for solving RN model (1) have been introduced in Alonso-Ayuso, Escudero, Garín, Ortuño, and Pérez (2003); Alonso-Ayuso, Escudero, and Ortuño (2003) and lately refined mainly in Escudero et al. (2010). They are particularized here in the following elements:

                           
                              1.
                              Scenario cluster based Branch-and-Fix (BF) tree, i.e., Branch-and-Bound tree for any cluster, such that the optimization of submodel (3) for any scenario cluster 
                                    
                                       c
                                       ∈
                                       C
                                    
                                  is performed in a coordinated way with the submodels for the other clusters, in order to solve up to optimality the original RN model (6).

Common variables, i.e., variables, say, 
                                    
                                       
                                          (
                                          
                                             x
                                             c
                                             g
                                          
                                          )
                                       
                                       i
                                    
                                  and 
                                    
                                       
                                          (
                                          
                                             x
                                             
                                                
                                                   c
                                                   ′
                                                
                                             
                                             g
                                          
                                          )
                                       
                                       i
                                    
                                  for scenario clusters c and c′ where 
                                    
                                       c
                                       ,
                                       
                                          c
                                          ′
                                       
                                       ∈
                                       C
                                       :
                                       c
                                       ≠
                                       
                                          c
                                          ′
                                       
                                       ,
                                       
                                       i
                                       ∈
                                       
                                          I
                                          g
                                       
                                       ,
                                       
                                       g
                                       ∈
                                       
                                          G
                                          c
                                       
                                       ∩
                                       
                                          G
                                          
                                             c
                                             ′
                                          
                                       
                                    
                                 . Remember that 
                                    
                                       g
                                       ∈
                                       
                                          G
                                          t
                                       
                                       ,
                                       
                                       t
                                       ∈
                                       
                                          T
                                          1
                                       
                                    
                                 .

Twin nodes, i.e., nodes from different BF trees whose paths from their root nodes are such that their x-common variables 
                                    
                                       
                                          (
                                          
                                             x
                                             c
                                             g
                                          
                                          )
                                       
                                       i
                                    
                                  and 
                                    
                                       
                                          
                                             (
                                             
                                                x
                                                
                                                   
                                                      c
                                                      ′
                                                   
                                                
                                                g
                                             
                                             )
                                          
                                          i
                                       
                                       ,
                                    
                                  if any, have been branched on or fixed to the same 0-1 value, for 
                                    
                                       c
                                       ,
                                       
                                          c
                                          ′
                                       
                                       ∈
                                       C
                                       :
                                       c
                                       ≠
                                       
                                          c
                                          ′
                                       
                                       ,
                                       
                                       i
                                       ∈
                                       
                                          I
                                          g
                                       
                                       ,
                                       
                                       g
                                       ∈
                                       
                                          G
                                          c
                                       
                                       ∩
                                       
                                          G
                                          
                                             c
                                             ′
                                          
                                       
                                    
                                 . The branched or fixed common variable 
                                    
                                       
                                          (
                                          
                                             x
                                             c
                                             g
                                          
                                          )
                                       
                                       i
                                    
                                  may imply fixing other common variables, say, 
                                    
                                       
                                          (
                                          
                                             x
                                             c
                                             
                                                g
                                                ′
                                             
                                          
                                          )
                                       
                                       j
                                    
                                  for 
                                    
                                       j
                                       ∈
                                       
                                          I
                                          
                                             g
                                             ′
                                          
                                       
                                       ,
                                       
                                       
                                          g
                                          ′
                                       
                                       ∈
                                       
                                          G
                                          c
                                       
                                       ,
                                    
                                  such that themselves, by construction, force the replicas of those variables, say, 
                                    
                                       
                                          (
                                          
                                             x
                                             
                                                
                                                   c
                                                   ′
                                                
                                             
                                             
                                                g
                                                ′
                                             
                                          
                                          )
                                       
                                       j
                                    
                                  in any other scenario cluster 
                                    
                                       
                                          c
                                          ′
                                       
                                       ∈
                                       C
                                       :
                                       
                                          g
                                          ′
                                       
                                       ∈
                                       
                                          G
                                          c
                                       
                                       ∩
                                       
                                          G
                                          
                                             c
                                             ′
                                          
                                       
                                    
                                  to be fixed to the same 0-1 values, and the implications could go further.

Twin Node Family (TNF), i.e., set of nodes such that any node is a twin node to all the other node members in the family (from different BF trees).

Candidate TNF, i.e., a TNF such that there is one x-common variable in the node members, at least, that has not been yet branched on, nor fixed to 0-1 values.

Integer TNF, i.e., a TNF such that all x-common variables have already been branched on or fixed to 0-1 values and their related NAC (4) are satisfied, see below.

The branching procedure BFC-TSD, Step 5, see Section 4.2, reaches a given candidate TNF for the branching triplet (
                           
                              
                                 t
                                 ¯
                              
                              ,
                              
                                 g
                                 ¯
                              
                              ,
                              
                                 i
                                 ¯
                              
                           
                        ). Let 
                           
                              
                                 I
                                 ¯
                              
                              1
                           
                         denote the set of indices of the already branched on or fixed (common) variables at the candidate TNF, i.e., 
                           
                              
                                 
                                    
                                       I
                                       ¯
                                    
                                    1
                                 
                                 =
                                 
                                    ∪
                                    
                                       g
                                       ∈
                                       
                                          A
                                          
                                             g
                                             ¯
                                          
                                       
                                       ∖
                                       
                                          {
                                          
                                             g
                                             ¯
                                          
                                          }
                                       
                                    
                                 
                                 
                                    I
                                    g
                                 
                                 ∪
                                 
                                    {
                                    i
                                    ∈
                                    
                                       I
                                       
                                          g
                                          ¯
                                       
                                    
                                    :
                                    i
                                    ≤
                                    
                                       i
                                       ¯
                                    
                                    }
                                 
                              
                           
                        . Let 
                           
                              
                                 x
                                 ^
                              
                              g
                           
                         denote the 0-1 value vector for vector xg
                        , where 
                           
                              
                                 
                                    x
                                    ^
                                 
                                 g
                              
                              =
                              
                                 
                                    x
                                    ^
                                 
                                 c
                                 g
                              
                           
                         for any scenario cluster 
                           
                              c
                              ∈
                              C
                              :
                              g
                              ∈
                              
                                 G
                                 c
                              
                           
                        .

The pruning scheme at a candidate TNF is done by comparing the incumbent value, say, z
                        TSD for model (2) and 
                           
                              z
                              =
                              
                                 ∑
                                 
                                    c
                                    ∈
                                    C
                                 
                              
                              
                                 z
                                 c
                              
                              ,
                           
                         where zc
                         is the solution value of submodel (3) for scenario cluster c, such that

                           
                              •
                              it has been obtained for that scenario cluster c while branching on a x-variable of scenario group 
                                    
                                       g
                                       ∈
                                       
                                          G
                                          c
                                       
                                       ∩
                                       
                                          G
                                          
                                             t
                                             ¯
                                          
                                       
                                       :
                                       g
                                       <
                                       
                                          g
                                          ¯
                                       
                                    
                                  at the previous stage 
                                    
                                       
                                          t
                                          ¯
                                       
                                       −
                                       1
                                       ,
                                    
                                 
                              

it has already been obtained when branching on a x-variable of group 
                                    
                                       g
                                       ∈
                                       
                                          G
                                          c
                                       
                                       ∩
                                       
                                          G
                                          
                                             t
                                             ¯
                                          
                                       
                                       :
                                       g
                                       <
                                       
                                          g
                                          ¯
                                       
                                       ,
                                    
                                  or

it has just been obtained for group 
                                    
                                       
                                          g
                                          ¯
                                       
                                       ∈
                                       
                                          G
                                          c
                                       
                                    
                                 .

The x-solution for an integer TNF can be obtained in procedure BFC-TSD, Step 6 as the solution of the scenario cluster submodels (3) for all 
                           
                              c
                              ∈
                              C
                           
                         in the related candidate TNF defined by the branching triplet (
                           
                              
                                 t
                                 ¯
                              
                              ,
                              
                                 g
                                 ¯
                              
                              ,
                              
                                 i
                                 ¯
                              
                           
                        ). Notice that each NAC (4) of the x-variables in model (2):

                           
                              •
                              either it has been algorithmically satisfied (case of already branched on or fixed variables 
                                    
                                       
                                          
                                             (
                                             x
                                             )
                                          
                                          i
                                       
                                       
                                       ∀
                                       i
                                       ∈
                                       
                                          
                                             I
                                             ¯
                                          
                                          1
                                       
                                    
                                 ) or

it has been implicitly satisfied while solving submodels (3) for (xg
                                 )
                                    i
                                  where 
                                    
                                       i
                                       ∈
                                       {
                                       
                                          I
                                          g
                                       
                                       ,
                                       
                                       g
                                       ∈
                                       
                                          G
                                          t
                                       
                                       ,
                                       t
                                       ∈
                                       
                                          T
                                          2
                                       
                                       }
                                    
                                 .

Additionally, if its testing for the 0-1 
                                    
                                       
                                          (
                                          
                                             
                                                x
                                                ^
                                             
                                             g
                                          
                                          )
                                       
                                       i
                                    
                                 -values of (xg
                                 )
                                    i
                                  for 
                                    
                                       i
                                       ∈
                                       
                                          {
                                          
                                             I
                                             g
                                          
                                          ,
                                          
                                          g
                                          ∈
                                          
                                             G
                                             t
                                          
                                          ,
                                          t
                                          ∈
                                          
                                             T
                                             1
                                          
                                          }
                                       
                                       ∖
                                       
                                          I
                                          1
                                       
                                       ,
                                    
                                  where those values come from the solution of the cluster submodels, is positive (i.e., the NAC are satisfied) then an integer TNF has been obtained.

At each integer TNF a feasible solution for the original model (2) could be obtained by fixing the x-variables to their current 0-1 values, such that the model can be expressed

                           
                              (7)
                              
                                 
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         z
                                                         T
                                                         
                                                            T
                                                            N
                                                            F
                                                         
                                                      
                                                      =
                                                   
                                                
                                                
                                                   
                                                      
                                                         max
                                                         
                                                            ∑
                                                            
                                                               g
                                                               ∈
                                                               G
                                                            
                                                         
                                                         
                                                            w
                                                            g
                                                         
                                                         
                                                            (
                                                            
                                                               a
                                                               g
                                                            
                                                            
                                                               x
                                                               g
                                                            
                                                            +
                                                            
                                                               b
                                                               g
                                                            
                                                            
                                                               y
                                                               g
                                                            
                                                            )
                                                         
                                                         −
                                                         
                                                            ∑
                                                            
                                                               t
                                                               ∈
                                                               
                                                                  T
                                                                  ˜
                                                               
                                                            
                                                         
                                                         
                                                            ∑
                                                            
                                                               p
                                                               ∈
                                                               
                                                                  P
                                                                  t
                                                               
                                                            
                                                         
                                                         
                                                            (
                                                            
                                                               M
                                                               e
                                                               p
                                                            
                                                            
                                                               ϵ
                                                               e
                                                               p
                                                            
                                                            +
                                                            
                                                               M
                                                               β
                                                               p
                                                            
                                                            
                                                               ϵ
                                                               β
                                                               p
                                                            
                                                            )
                                                         
                                                      
                                                   
                                                
                                             
                                             
                                                
                                                   s.t.
                                                
                                                
                                                   
                                                      
                                                         c
                                                         
                                                            onstraint
                                                            
                                                            system
                                                            
                                                            in
                                                            
                                                            TSD
                                                            
                                                            model
                                                         
                                                      
                                                      
                                                      (
                                                      2
                                                      )
                                                   
                                                
                                             
                                             
                                                
                                                
                                                   
                                                      
                                                         x
                                                         g
                                                      
                                                      =
                                                      
                                                         
                                                            x
                                                            ^
                                                         
                                                         g
                                                      
                                                      
                                                      ∀
                                                      g
                                                      ∈
                                                      G
                                                      .
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           
                        Notice that the TSD 0-1 ν-variables are the only ones that are integer in the model. If it is feasible then the new incumbent solution value is 
                           
                              
                                 z
                                 TSD
                              
                              :
                              =
                              max
                              
                                 {
                                 
                                    z
                                    T
                                    TNF
                                 
                                 ,
                                 
                                    z
                                    TSD
                                 
                                 }
                              
                           
                        .

In order to guarantee the optimality of the solution provided by the procedure, model (8) should be solved for any integer TNF where the variables up to break stage t
                        * have been fully branched on or fixed.

                           
                              (8)
                              
                                 
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         
                                                            z
                                                            
                                                               OPT
                                                            
                                                            TNF
                                                         
                                                         =
                                                         max
                                                         
                                                            ∑
                                                            
                                                               g
                                                               ∈
                                                               G
                                                            
                                                         
                                                         
                                                            w
                                                            g
                                                         
                                                         
                                                            (
                                                            
                                                               a
                                                               g
                                                            
                                                            
                                                               x
                                                               g
                                                            
                                                            +
                                                            
                                                               b
                                                               g
                                                            
                                                            
                                                               y
                                                               g
                                                            
                                                            )
                                                         
                                                         −
                                                         
                                                            ∑
                                                            
                                                               t
                                                               ∈
                                                               
                                                                  T
                                                                  ˜
                                                               
                                                            
                                                         
                                                         
                                                            ∑
                                                            
                                                               p
                                                               ∈
                                                               
                                                                  P
                                                                  t
                                                               
                                                            
                                                         
                                                         
                                                            (
                                                            
                                                               M
                                                               e
                                                               p
                                                            
                                                            
                                                               ϵ
                                                               e
                                                               p
                                                            
                                                            +
                                                            
                                                               M
                                                               β
                                                               p
                                                            
                                                            
                                                               ϵ
                                                               β
                                                               p
                                                            
                                                            )
                                                         
                                                      
                                                   
                                                
                                             
                                             
                                                
                                                   
                                                      s.t.
                                                      
                                                      
                                                      c
                                                      
                                                         onstraint
                                                         
                                                         system
                                                         
                                                         in
                                                         
                                                         TSD
                                                         
                                                         model
                                                      
                                                      
                                                      (
                                                      2
                                                      )
                                                   
                                                
                                             
                                             
                                                
                                                   
                                                      
                                                         
                                                         
                                                            
                                                               
                                                                  x
                                                                  g
                                                               
                                                               =
                                                               
                                                                  
                                                                     x
                                                                     ^
                                                                  
                                                                  g
                                                               
                                                            
                                                         
                                                         
                                                            
                                                               ∀
                                                               g
                                                               ∈
                                                               
                                                                  G
                                                                  t
                                                               
                                                               ,
                                                               
                                                               t
                                                               ∈
                                                               
                                                                  T
                                                                  1
                                                               
                                                            
                                                         
                                                      
                                                      
                                                         
                                                         
                                                            
                                                               
                                                                  x
                                                                  g
                                                               
                                                               ∈
                                                               
                                                                  
                                                                     {
                                                                     0
                                                                     ,
                                                                     1
                                                                     }
                                                                  
                                                                  
                                                                     n
                                                                     x
                                                                     (
                                                                     g
                                                                     )
                                                                  
                                                               
                                                            
                                                         
                                                         
                                                            
                                                               ∀
                                                               g
                                                               ∈
                                                               
                                                                  G
                                                                  t
                                                               
                                                               ,
                                                               
                                                               t
                                                               ∈
                                                               
                                                                  T
                                                                  2
                                                               
                                                               .
                                                            
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           
                        
                     

Model (8) guarantees that there is not any area in the feasible region that explicitly or implicitly has not been explored. The rationale behind it has similarities with our works (Aldasoro, Escudero, Merino, & Pérez, 2013; Escudero et al., 2010; 2012), but with some main differences: (a) the model forces the satisfaction of cross scenario group constraints; and (b) the TSD strategy requirements force the replacement of the paradigm given by the pair stage – scenario cluster with the paradigm given by the pair scenario group – scenario cluster.

The main steps of the procedure are as follows:

                           
                              
                                 Step 1:
                              
                              
                                 (Root node)
                              

Solve the independent scenario cluster MIP submodels (3) to obtain 
                                    
                                       
                                          z
                                          c
                                       
                                       
                                       ∀
                                       c
                                       ∈
                                       C
                                    
                                 .

Compute 
                                    
                                       
                                          z
                                          =
                                          
                                             ∑
                                             
                                                c
                                                ∈
                                                C
                                             
                                          
                                          
                                             z
                                             c
                                          
                                       
                                    
                                 .

If all variables in xc
                                  and yc
                                  satisfy the NAC (4) and (5), respectively, and the linking cross scenario group constraints in TSD model (2) are satisfied for the ε-variables equal to zero then its optimal solution is found, so, set z
                                 TSD ≔ z and STOP.

Set 
                                    
                                       
                                          t
                                          ¯
                                       
                                       :
                                       =
                                       0
                                       ,
                                       
                                          z
                                          TSD
                                       
                                       :
                                       =
                                       −
                                       ∞
                                    
                                 .


                                 (Next stage)
                              

Reset 
                                    
                                       
                                          t
                                          ¯
                                       
                                       :
                                       =
                                       
                                          t
                                          ¯
                                       
                                       +
                                       1
                                    
                                  and 
                                    
                                       
                                          i
                                          ¯
                                       
                                       :
                                       =
                                       0
                                    
                                 . If 
                                    
                                       
                                          t
                                          ¯
                                       
                                       >
                                       
                                          t
                                          *
                                       
                                    
                                  then go to Step 9.


                                 (Next scenario group)
                              

Select 
                                    
                                       
                                          g
                                          ¯
                                       
                                       ∈
                                       
                                          G
                                          
                                             t
                                             ¯
                                          
                                       
                                       ,
                                    
                                  unless all the variables in its groups have already been branched, in this case go to Step 2.

Reset 
                                    
                                       
                                          i
                                          ¯
                                       
                                       :
                                       =
                                       0
                                       .
                                    
                                 
                              


                                 (Next node)
                              

Reset 
                                    
                                       
                                          i
                                          ¯
                                       
                                       :
                                       =
                                       
                                          i
                                          ¯
                                       
                                       +
                                       1
                                    
                                 . If 
                                    
                                       
                                          i
                                          ¯
                                       
                                       >
                                       n
                                       x
                                       
                                          (
                                          
                                             g
                                             ¯
                                          
                                          )
                                       
                                    
                                  then go to Step 3.


                                 (Branching. Candidate TNF building)
                              

Set 
                                    
                                       
                                          
                                             (
                                             
                                                x
                                                c
                                                
                                                   g
                                                   ¯
                                                
                                             
                                             )
                                          
                                          
                                             i
                                             ¯
                                          
                                       
                                       :
                                       =
                                       1
                                       
                                       ∀
                                       c
                                       ∈
                                       C
                                       :
                                       
                                          g
                                          ¯
                                       
                                       ∈
                                       
                                          G
                                          c
                                       
                                    
                                 .


                                 (Integer TNF building)
                                 
                                    
                                       (a)
                                       If the current branching value 
                                             
                                                
                                                   (
                                                   
                                                      
                                                         x
                                                         ^
                                                      
                                                      
                                                         g
                                                         ¯
                                                      
                                                   
                                                   )
                                                
                                                
                                                   i
                                                   ¯
                                                
                                             
                                           has already been obtained for variable 
                                             
                                                
                                                   (
                                                   
                                                      x
                                                      
                                                         g
                                                         ¯
                                                      
                                                   
                                                   )
                                                
                                                
                                                   i
                                                   ¯
                                                
                                             
                                           while solving the appropriate submodel (3) at the immediate ancestor branching variable (xg
                                          )
                                             i
                                          , where either 
                                             
                                                g
                                                =
                                                
                                                   g
                                                   ¯
                                                
                                                ,
                                             
                                           
                                          i = nx(g) such that g is the immediate ancestor scenario group in 
                                             
                                                G
                                                
                                                   t
                                                   ¯
                                                
                                             
                                           or 
                                             
                                                g
                                                ∈
                                                
                                                   G
                                                   
                                                      
                                                         t
                                                         ¯
                                                      
                                                      −
                                                      1
                                                   
                                                
                                             
                                           then go to Step 4. (Notice that, in this case, the solution vector 
                                             
                                                
                                                   
                                                      x
                                                      ^
                                                   
                                                   g
                                                
                                                
                                                ∀
                                                g
                                                ∈
                                                G
                                             
                                           and its value z (see below) have already been obtained and then Steps 6 and 7 do not need to be executed).

Solve the independent scenario cluster MIP submodels (3) for obtaining solution value 
                                             
                                                
                                                   z
                                                   c
                                                
                                                
                                                ∀
                                                c
                                                ∈
                                                C
                                                :
                                                
                                                   g
                                                   ¯
                                                
                                                ∈
                                                
                                                   G
                                                   c
                                                
                                                ,
                                             
                                           where the already branched variables in the TNF (i.e., 
                                             
                                                
                                                   I
                                                   ¯
                                                
                                                1
                                             
                                          ) are fixed to the related 0-1 values and all the other x-variables (then, until the groups in 
                                             
                                                
                                                   G
                                                   T
                                                
                                                ,
                                             
                                           including themselves) keep their integrality.

Compute 
                                             
                                                z
                                                =
                                                
                                                   ∑
                                                   
                                                      c
                                                      ∈
                                                      C
                                                   
                                                
                                                
                                                   z
                                                   c
                                                
                                                ,
                                             
                                           where zc
                                           has already been obtained for that scenario cluster c while branching on scenario group 
                                             
                                                g
                                                ∈
                                                
                                                   G
                                                   c
                                                
                                                ∩
                                                
                                                   G
                                                   
                                                      t
                                                      ¯
                                                   
                                                
                                                :
                                                g
                                                <
                                                
                                                   g
                                                   ¯
                                                
                                             
                                           at the previous stage 
                                             
                                                
                                                   t
                                                   ¯
                                                
                                                −
                                                1
                                                ,
                                             
                                           when branching on 
                                             
                                                g
                                                ∈
                                                
                                                   G
                                                   c
                                                
                                                ∩
                                                
                                                   G
                                                   
                                                      t
                                                      ¯
                                                   
                                                
                                                :
                                                g
                                                <
                                                
                                                   g
                                                   ¯
                                                
                                             
                                           or it has just been obtained for 
                                             
                                                
                                                   g
                                                   ¯
                                                
                                                ∈
                                                
                                                   G
                                                   c
                                                
                                             
                                          .

If z ≤ zTSD
                                           then go to Step 8.

If any variable in 
                                             
                                                
                                                   x
                                                   c
                                                
                                                
                                                ∀
                                                c
                                                ∈
                                                C
                                             
                                           does not satisfy NAC (4) then go to Step 4.

If all variables in 
                                             
                                                
                                                   y
                                                   c
                                                
                                                
                                                ∀
                                                c
                                                ∈
                                                C
                                             
                                           do satisfy NAC (5) and the linking cross scenario group constraints in TSD model (2) are also satisfied for the ε-variables equal to zero then update z
                                          TSD ≔ z and go to Step 8.


                                 (Satisfying the cross scenario group constraints for integer TNF)
                              

Solve MIP model (7) for obtaining a feasible solution to the original model (2).

If it is feasible then update 
                                    
                                       
                                          z
                                          TSD
                                       
                                       :
                                       =
                                       max
                                       
                                          {
                                          
                                             z
                                             T
                                             TNF
                                          
                                          ,
                                          
                                             z
                                             TSD
                                          
                                          }
                                       
                                    
                                 .

If 
                                    
                                       OPT
                                       
                                          =
                                          ′
                                       
                                       
                                          N
                                          ′
                                       
                                    
                                  or 
                                    
                                       
                                          t
                                          ¯
                                       
                                       <
                                       
                                          t
                                          *
                                       
                                    
                                  or 
                                    
                                       g
                                       ¯
                                    
                                  is not the last group in set 
                                    
                                       G
                                       
                                          g
                                          ¯
                                       
                                    
                                  or 
                                    
                                       
                                          i
                                          ¯
                                       
                                       <
                                       n
                                       x
                                       
                                          (
                                          
                                             g
                                             ¯
                                          
                                          )
                                       
                                    
                                  then go to Step 4.

Solve MIP model (8) for obtaining another feasible solution to model (2) and guaranteeing optimality.

If it is feasible then update 
                                    
                                       
                                          z
                                          TSD
                                       
                                       :
                                       =
                                       max
                                       
                                          {
                                          
                                             z
                                             
                                                OPT
                                             
                                             TNF
                                          
                                          ,
                                          
                                             z
                                             TSD
                                          
                                          }
                                       
                                    
                                 .


                                 (Branch pruning)
                              

If variable 
                                    
                                       
                                          (
                                          
                                             x
                                             c
                                             
                                                g
                                                ¯
                                             
                                          
                                          )
                                       
                                       
                                          i
                                          ¯
                                       
                                    
                                  has been branched on or fixed to 1 for any cluster 
                                    
                                       c
                                       ∈
                                       C
                                       :
                                       
                                          g
                                          ¯
                                       
                                       ∈
                                       
                                          G
                                          c
                                       
                                    
                                  then go to Step 11.

(Note: The branched on or fixed to 0-1 value for variable 
                                    
                                       
                                          (
                                          
                                             x
                                             c
                                             
                                                g
                                                ¯
                                             
                                          
                                          )
                                       
                                       
                                          i
                                          ¯
                                       
                                    
                                  is the same one for all clusters 
                                    
                                       c
                                       ∈
                                       C
                                       :
                                       
                                          g
                                          ¯
                                       
                                       ∈
                                       
                                          G
                                          c
                                       
                                    
                                 ).


                                 (Backward to previous node)
                              

Reset 
                                    
                                       
                                          i
                                          ¯
                                       
                                       :
                                       =
                                       
                                          i
                                          ¯
                                       
                                       −
                                       1
                                       .
                                    
                                 
                              

If 
                                    
                                       
                                          i
                                          ¯
                                       
                                       =
                                       0
                                    
                                  and 
                                    
                                       
                                          t
                                          ¯
                                       
                                       ≤
                                       1
                                    
                                  then, the incumbent solution, if any, and its value z
                                 TSD has been found, STOP.

If 
                                    
                                       
                                          i
                                          ¯
                                       
                                       =
                                       0
                                    
                                  and the x-common variables of all the groups in 
                                    
                                       G
                                       
                                          t
                                          ¯
                                       
                                    
                                  have already been branched on or fixed then 
                                    
                                       
                                          t
                                          ¯
                                       
                                       :
                                       =
                                       
                                          t
                                          ¯
                                       
                                       −
                                       1
                                    
                                  and select the last group 
                                    
                                       
                                          g
                                          ¯
                                       
                                       ∈
                                       
                                          G
                                          
                                             t
                                             ¯
                                          
                                       
                                    
                                 .

If 
                                    
                                       
                                          i
                                          ¯
                                       
                                       =
                                       0
                                    
                                  and not all the x-common variables of all the groups in 
                                    
                                       G
                                       
                                          t
                                          ¯
                                       
                                    
                                  have already been branched on or fixed then select the previous group 
                                    
                                       
                                          g
                                          ¯
                                       
                                       ∈
                                       
                                          G
                                          
                                             t
                                             ¯
                                          
                                       
                                    
                                 .


                                 (Prune checking)
                              

If 
                                    
                                       
                                          
                                             (
                                             
                                                x
                                                c
                                                
                                                   g
                                                   ¯
                                                
                                             
                                             )
                                          
                                          
                                             i
                                             ¯
                                          
                                       
                                       =
                                       0
                                    
                                  for any 
                                    
                                       c
                                       ∈
                                       C
                                       :
                                       
                                          g
                                          ¯
                                       
                                       ∈
                                       
                                          G
                                          c
                                       
                                    
                                  then go to Step 9.


                                 (Opposite branching)
                              

Reset 
                                    
                                       
                                          
                                             (
                                             
                                                x
                                                c
                                                
                                                   g
                                                   ¯
                                                
                                             
                                             )
                                          
                                          
                                             i
                                             ¯
                                          
                                       
                                       :
                                       =
                                       0
                                       
                                       ∀
                                       c
                                       ∈
                                       C
                                       :
                                       
                                          g
                                          ¯
                                       
                                       ∈
                                       
                                          G
                                          c
                                       
                                    
                                  and go to Step 6.

The BFC-TSD algorithm has been implemented in a C++ code. It uses one of the state-of-the-art commercial optimization engines, in particular CPLEX V12.5, see IBM ILOG. CPLEX (2011), within the open source engine COIN-OR v1.6.0 COIN-OR Foundation (2010). This optimizer is used by the algorithm for solving the LP relaxation and the mixed 0-1 submodels; all the tolerances have been set up to the default values.

The computational experiments were conducted in the SW/HW platform given by a workstation Dell Precision T7600 under Linux operating system (version Debian2.6.32-48) with 64 bits, processor Intel(R) Xeon(R) CPU E5-2630 @ 2.3 gigahertz, 12 gigabits of RAM and 8 cores.

The algorithm has also been tested on a variety of randomly generated instances by playing with different sets of profiles for the risk averse TSD strategy. The dimensions of RN model (1) compact representation are given in Table 1
                     . Its headings are as follows: Instance, member in the test bed we have experimented with; m, number of constraints; nx, number of 0-1 variables; ny, number of continuous variables; nel, number of nonzero coefficients in the constraint matrix; dens, constraint matrix density (in percent); |Ω|, number of scenarios; 
                        
                           |
                           G
                           |
                           ,
                        
                      number of scenario groups; and T, number of stages.


                     Table 2
                      shows the dimensions of TSD model (2) for the related risk averse options that are treated in the work, namely the model with 
                        
                           
                              |
                           
                           
                              P
                              T
                           
                           
                              |
                              =
                              4
                           
                        
                      profiles where 
                        
                           
                              T
                              ˜
                           
                           =
                           
                              {
                              T
                              }
                           
                        
                      (TSD1) and the model with 
                        
                           
                              |
                           
                           
                              P
                              T
                           
                           
                              |
                              =
                              4
                           
                        
                      and 
                        
                           
                              |
                           
                           
                              P
                              
                                 T
                                 −
                                 1
                              
                           
                           
                              |
                              =
                              2
                           
                        
                      profiles where 
                        
                           
                              T
                              ˜
                           
                           =
                           
                              {
                              T
                              −
                              1
                              ,
                              T
                              }
                           
                        
                      (TSD2). The new headings are as follows: nν and ns, additional number of 0-1 and continuous variables, respectively; and 
                        
                           n
                           
                              ϵ
                              β
                           
                        
                      and 
                        
                           
                              n
                              
                                 ϵ
                                 e
                              
                           
                           ,
                        
                      number of slack ε
                        β
                     - and ε
                        e
                     -variables, respectively.


                     Section 5.1 reports the main results for the RN strategy and Section 5.2 presents the main results for different options of the TSD strategy, respectively.

The main computational results are presented in Table 3
                        , which shows the LP relaxation and integer optimal solution values as well as the elapsed time for the BFC-TSD algorithm versus the plain use of CPLEX. Its headings are as follows: T, number of stages; C, number of scenario clusters in which the scenario tree has been divided into; 
                           
                              
                                 z
                                 
                                    LP
                                 
                                 RN
                              
                              ,
                           
                         solution value of the LP relaxation of RN model (1); z
                        0, expected solution value obtained at the BF root node while solving independently the scenario cluster MIP submodels (3); nn
                        , number of explored twin nodes up to optimality while solving the original model (1); n
                        TNF, number of explored integer TNF sets; 
                           
                              z
                              
                                 BFC
                              
                              RN
                           
                         and 
                           
                              
                                 z
                                 
                                    CPX
                                 
                                 RN
                              
                              ,
                           
                         solution values of RN model (1) obtained by using BFC-TSD algorithm and plain CPLEX, respectively; OG percent, CPLEX optimality gap, defined as 
                           
                              100
                              
                                 
                                    
                                       z
                                       
                                          b
                                          n
                                       
                                    
                                    −
                                    
                                       z
                                       
                                          CPX
                                       
                                       RN
                                    
                                 
                                 
                                    z
                                    
                                       CPX
                                    
                                    RN
                                 
                              
                              ,
                           
                         where zbn
                         is the solution value of the active branch-and-bound node with the greatest solution value at the time instant at which CPLEX execution was interrupted; GG percent, goodness gap of BFC-TSD algorithm versus CPLEX, defined as 
                           
                              100
                              
                                 
                                    
                                       z
                                       
                                          CPX
                                       
                                       RN
                                    
                                    −
                                    
                                       z
                                       
                                          BFC
                                       
                                       RN
                                    
                                 
                                 
                                    z
                                    
                                       B
                                       F
                                       C
                                    
                                    
                                       R
                                       N
                                    
                                 
                              
                           
                        ; and 
                           
                              t
                              
                                 BFC
                              
                              RN
                           
                         and 
                           
                              
                                 t
                                 
                                    CPX
                                 
                                 RN
                              
                              ,
                           
                         elapsed times (in seconds) to obtain the related solutions of RN model by using BFC-TSD algorithm and plain CPLEX, respectively.

The break-stage that has been chosen is t
                        * = 1 and, so, according to the scenario tree structure, 
                           
                              
                                 C
                                 =
                                 |
                              
                              
                                 G
                                 2
                              
                              
                                 |
                              
                           
                         scenario clusters 
                           
                              
                                 Ω
                                 c
                              
                              ,
                              ∀
                              c
                              ∈
                              C
                           
                         are considered in the experiment. They are constructed by favoring the approach that shows higher scenario clustering for greater number of scenario groups in common. Notice the very strong upper bound z
                        0 and the very small elapsed time to obtain the optimal RN solution by using the decomposition BFC-TSD algorithm. Observe that the plain use of CPLEX cannot solve the instances P3, P4, P8 and P9 given the computer platform and the allowed elapsed time.

A modeler familiar with the TSD model (2) may not have high difficulty for providing the set of profiles for TSD risk averse strategies. However, it is useful to firstly obtaining the RN solution value by solving model (1) and its negative semi-deviation (in case of a maximization) for confirming and, in case, reassessing the chosen set of profiles to realizing the potentiality of the feasible region of model (2). Moreover, based on our computational experience on dealing with this type of risk averse strategies for the multistage case, it is very advisable that the non-familiar modeler with the TSD strategies to work first with the solution values of the scenarios in RN model (1) and WS separable models (i.e., model (1) where NAC (4) and (5) are fully relaxed). In this way a justified set of profiles could be chosen for the TSD strategy. Notice that a RN solution satisfies the NAC but the TSD constraints have been relaxed, and a WS solution value is the average of the solution values obtained independently for each scenario and therefore that solution does not necessarily satisfy the NAC, nor the TSD constraints.

Let 
                              
                                 
                                    
                                       x
                                       ^
                                    
                                    g
                                 
                                 ,
                                 
                                    
                                       y
                                       ^
                                    
                                    g
                                 
                              
                            denote the x, y vectors related to scenario group 
                              
                                 g
                                 ∈
                                 G
                              
                            in the solution of RN model (1). Given a profile 
                              
                                 p
                                 ∈
                                 
                                    P
                                    T
                                 
                              
                            and a threshold on the objective function to be satisfied, ϕp
                           , the set of scenarios, say, 
                              
                                 Ω
                                 
                                    R
                                    N
                                 
                                 p
                              
                            whose objective function value in that solution has a shortfall on reaching threshold ϕp
                            can be expressed

                              
                                 
                                    
                                       
                                          
                                             
                                                
                                                   Ω
                                                   
                                                      RN
                                                   
                                                   p
                                                
                                                =
                                                
                                                   {
                                                   
                                                      ω
                                                      ∈
                                                      
                                                         Ω
                                                         g
                                                      
                                                      ,
                                                      
                                                      g
                                                      ∈
                                                      
                                                         G
                                                         T
                                                      
                                                      :
                                                      
                                                         ∑
                                                         
                                                            q
                                                            ∈
                                                            
                                                               A
                                                               g
                                                            
                                                         
                                                      
                                                      
                                                         a
                                                         q
                                                      
                                                      
                                                         
                                                            x
                                                            ^
                                                         
                                                         q
                                                      
                                                      +
                                                      
                                                         b
                                                         q
                                                      
                                                      
                                                         
                                                            y
                                                            ^
                                                         
                                                         q
                                                      
                                                      <
                                                      
                                                         ϕ
                                                         p
                                                      
                                                   
                                                   }
                                                
                                                .
                                             
                                          
                                       
                                    
                                 
                              
                           So, let 
                              
                                 β
                                 
                                    RN
                                 
                                 p
                              
                            denote the probability of the set 
                              
                                 
                                    Ω
                                    
                                       RN
                                    
                                    p
                                 
                                 ,
                              
                            i.e., 
                              
                                 
                                    β
                                    
                                       RN
                                    
                                    p
                                 
                                 =
                                 
                                    ∑
                                    
                                       ω
                                       ∈
                                       
                                          Ω
                                          
                                             RN
                                          
                                          p
                                       
                                    
                                 
                                 
                                    w
                                    ω
                                 
                                 ,
                              
                            for 
                              
                                 p
                                 ∈
                                 
                                    P
                                    T
                                 
                              
                           .

Similarly, let 
                              
                                 
                                    
                                       x
                                       ˜
                                    
                                    g
                                 
                                 ,
                                 
                                    
                                       y
                                       ˜
                                    
                                    g
                                 
                              
                            denote the x, y vectors related to scenario group 
                              
                                 g
                                 ∈
                                 G
                              
                            in the solution for the WS approach. So, for profile 
                              
                                 p
                                 ∈
                                 
                                    P
                                    T
                                 
                              
                            the set of scenarios, say, 
                              
                                 Ω
                                 
                                    W
                                    S
                                 
                                 p
                              
                            whose objective function value in that solution has a shortfall on reaching threshold ϕp
                            can be expressed

                              
                                 
                                    
                                       
                                          
                                             
                                                
                                                   Ω
                                                   
                                                      WS
                                                   
                                                   p
                                                
                                                =
                                                
                                                   {
                                                   
                                                      ω
                                                      ∈
                                                      
                                                         Ω
                                                         g
                                                      
                                                      ,
                                                      
                                                      g
                                                      ∈
                                                      
                                                         G
                                                         T
                                                      
                                                      :
                                                      
                                                         ∑
                                                         
                                                            q
                                                            ∈
                                                            
                                                               A
                                                               g
                                                            
                                                         
                                                      
                                                      
                                                         a
                                                         q
                                                      
                                                      
                                                         
                                                            x
                                                            ˜
                                                         
                                                         q
                                                      
                                                      +
                                                      
                                                         b
                                                         q
                                                      
                                                      
                                                         
                                                            y
                                                            ˜
                                                         
                                                         q
                                                      
                                                      <
                                                      
                                                         ϕ
                                                         p
                                                      
                                                   
                                                   }
                                                
                                                .
                                             
                                          
                                       
                                    
                                 
                              
                           And, let 
                              
                                 β
                                 
                                    WS
                                 
                                 p
                              
                            denote the probability of set 
                              
                                 
                                    Ω
                                    
                                       WS
                                    
                                    p
                                 
                                 ,
                              
                            i.e., 
                              
                                 
                                    β
                                    
                                       WS
                                    
                                    p
                                 
                                 =
                                 
                                    ∑
                                    
                                       ω
                                       ∈
                                       
                                          Ω
                                          
                                             WS
                                          
                                          p
                                       
                                    
                                 
                                 
                                    w
                                    ω
                                 
                                 ,
                              
                            for 
                              
                                 p
                                 ∈
                                 
                                    P
                                    T
                                 
                              
                           .

On the other hand, let 
                              
                                 e
                                 
                                    WS
                                 
                                 p
                              
                            and 
                              
                                 e
                                 
                                    RN
                                 
                                 p
                              
                            denote the expected shortfall on reaching threshold ϕp
                            in the WS and RN solutions, for profile 
                              
                                 p
                                 ∈
                                 
                                    P
                                    T
                                 
                                 ,
                              
                            respectively.

For lack of space the risk values 
                              
                                 
                                    β
                                    
                                       RN
                                    
                                    p
                                 
                                 ,
                              
                           
                           
                              
                                 
                                    β
                                    
                                       WS
                                    
                                    p
                                 
                                 ,
                              
                            and 
                              
                                 
                                    e
                                    
                                       RN
                                    
                                    p
                                 
                                 ,
                              
                           
                           
                              
                                 e
                                 
                                    WS
                                 
                                 p
                              
                            computed from the solution of RN model (1) (where, by construction, the NAC (4) and (5) are satisfied) as well as from the WS separable models cannot be reported in the paper. However, see in Escudero, Garín, Merino, and Pérez (2015) those values as well as the details of our computational experience.


                        Tables 4 and 5
                         report our computational experience for TSD model (2) for 
                           
                              
                                 T
                                 ˜
                              
                              =
                              
                                 {
                                 T
                                 }
                              
                           
                         and 
                           
                              
                                 T
                                 ˜
                              
                              =
                              
                                 {
                                 T
                                 −
                                 1
                                 ,
                                 T
                                 }
                              
                              ,
                           
                         respectively, in a non-singleton profile environment set for the test bed considered in the previous sections. The new headings of the tables are as follows: 
                           
                              z
                              
                                 BFC
                              
                              TSD
                           
                         and 
                           
                              
                                 t
                                 
                                    CPX
                                 
                                 TSD
                              
                              ,
                           
                         solution value and elapsed time (seconds) by using BFC-TSD algorithm; 
                           
                              z
                              
                                 CPX
                              
                              TSD
                           
                         and 
                           
                              
                                 t
                                 
                                    CPX
                                 
                                 TSD
                              
                              ,
                           
                         solution value and elapsed time (seconds) by plain use of CPLEX, respectively; OG percent, CPLEX optimality gap, defined as 
                           
                              100
                              
                                 
                                    
                                       z
                                       
                                          b
                                          n
                                       
                                    
                                    −
                                    
                                       z
                                       
                                          CPX
                                       
                                       TSD
                                    
                                 
                                 
                                    z
                                    
                                       CPX
                                    
                                    TSD
                                 
                              
                              ,
                           
                         where zbn
                         is as above; and GG percent, goodness gap of BFC-TSD algorithm versus CPLEX, defined as 
                           
                              100
                              
                                 
                                    
                                       z
                                       
                                          CPX
                                       
                                       TSD
                                    
                                    −
                                    
                                       z
                                       
                                          BFC
                                       
                                       TSD
                                    
                                 
                                 
                                    z
                                    
                                       BFC
                                    
                                    TSD
                                 
                              
                           
                        .

We can observe in the tables that BFC-TSD algorithm provides the solution in very small elapsed time for all instances even for the very difficult ones P3, P4, P8 and P9. On the contrary, CPLEX is running out of memory (12 gigabits) or time limit (6 hours) exceeded in all instances but P1, P5 and P7 in Table 4 and P1, P2 and P5 in Table 5.

The profile set used for the results reported in Table 4 only considers the last stage, so, 
                           
                              
                                 T
                                 ˜
                              
                              =
                              
                                 {
                                 T
                                 }
                              
                           
                        . However, the table also shows, as an illustrative example, a modeler-driven non-wanted profit threshold ϕp
                         at stage T − 1 for p = 1, 2 in case that the TSD solution is accepted. The table also shows (in boldface symbols) the columns 
                           
                              
                                 β
                                 
                                    TSD
                                 
                                 p
                              
                              
                                 (
                                 |
                              
                              
                                 Ω
                                 
                                    TSD
                                 
                                 p
                              
                              
                                 |
                                 )
                              
                           
                         and 
                           
                              e
                              
                                 TSD
                              
                              p
                           
                         for the fraction of scenarios (number of scenarios) in set Ω with shortfall on reaching profit threshold 
                           
                              
                                 ϕ
                                 p
                              
                              
                              ∀
                              p
                              ∈
                              
                                 P
                                 
                                    T
                                    −
                                    1
                                 
                              
                              =
                              
                                 {
                                 1
                                 ,
                                 2
                                 }
                              
                           
                         and the expected shortfall, respectively. Those values have been computed from the TSD solution with 
                           
                              
                                 T
                                 ˜
                              
                              =
                              
                                 {
                                 T
                                 }
                              
                           
                         for the profit obtained up to stage T − 1, say 
                           
                              
                                 z
                                 
                                    T
                                    −
                                    1
                                 
                              
                              =
                              
                                 ∑
                                 
                                    g
                                    ∈
                                    
                                       G
                                       
                                          T
                                          −
                                          1
                                       
                                    
                                 
                              
                              
                                 w
                                 g
                              
                              
                                 ∑
                                 
                                    q
                                    ∈
                                    
                                       
                                          A
                                          ˜
                                       
                                       g
                                    
                                 
                              
                              
                                 (
                                 
                                    a
                                    q
                                 
                                 
                                    x
                                    q
                                 
                                 +
                                 
                                    b
                                    q
                                 
                                 
                                    y
                                    q
                                 
                                 )
                              
                           
                        .


                        Table 5 reports the main results for TSD model (2) with 
                           
                              
                                 T
                                 ˜
                              
                              =
                              
                                 {
                                 T
                                 −
                                 1
                                 ,
                                 T
                                 }
                              
                              ,
                           
                         where 
                           
                              
                                 |
                              
                              
                                 P
                                 T
                              
                              
                                 |
                                 =
                                 4
                              
                           
                         and 
                           
                              
                                 |
                              
                              
                                 P
                                 
                                    T
                                    −
                                    1
                                 
                              
                              
                                 |
                                 =
                                 2
                              
                           
                        . The βp
                        - and ep
                        -upper bounds are shown in the first two columns for set 
                           
                              P
                              T
                           
                         and the third and fourth columns for set 
                           
                              P
                              
                                 T
                                 −
                                 1
                              
                           
                        .

Observe that the profile set 
                           
                              P
                              T
                           
                         in Table 5 is as in Table 4. However, profile set 
                           
                              P
                              
                                 T
                                 −
                                 1
                              
                           
                         reduces the risk of non-wanted scenarios, so that TSD is considered, since 
                           
                              
                                 β
                                 p
                              
                              <
                              
                                 
                                    β
                                 
                                 p
                              
                           
                         and ep
                         < ep
                         for the profit threshold ϕp
                         shown in Table 4 for all 
                           
                              p
                              ∈
                              
                                 P
                                 
                                    T
                                    −
                                    1
                                 
                              
                           
                        .

The values of the slack variables 
                           
                              ϵ
                              e
                              p
                           
                         and 
                           
                              ϵ
                              β
                              p
                           
                         for all 
                           
                              p
                              ∈
                              
                                 P
                                 t
                              
                              ,
                              
                              t
                              ∈
                              
                                 T
                                 ˜
                              
                              ,
                           
                         where 
                           
                              
                                 T
                                 ˜
                              
                              =
                              
                                 {
                                 T
                                 }
                              
                           
                         in Table 4 and 
                           
                              
                                 T
                                 ˜
                              
                              =
                              
                                 {
                                 T
                                 −
                                 1
                                 ,
                                 T
                                 }
                              
                           
                         in Table 5, have been zero in the reported solutions. Additionally, the solution value (i.e., expected profit) 
                           
                              z
                              
                                 BFC
                              
                              TSD
                           
                         for TSD when 
                           
                              
                                 T
                                 ˜
                              
                              =
                              
                                 {
                                 T
                                 ,
                                 T
                                 −
                                 1
                                 }
                              
                           
                         (Table 5) is slightly worse than the profit for TSD for 
                           
                              
                                 T
                                 ˜
                              
                              =
                              
                                 {
                                 T
                                 }
                              
                           
                         (Table 4). Notice that the goodness gap GG percent of BFC-TSD algorithm versus CPLEX is very small, CPLEX has difficulties on solving the instances in the test bed and, on the contrary, BFC-TSD algorithm requires a very small elapsed time.

Finally, Appendix A presents the risk reduction trajectory from WS, through RN, and TSD, with singleton and non-singleton 
                           
                              
                                 T
                                 ˜
                              
                              ,
                           
                         by using instance P7 as an illustrative example. In what follows the same instance P7 is used for clarifying the results shown in Tables 4 and 5. Observe in Table 3 that the optimal solution of RN model (1) gives the expected profit z
                        RN = 269 441. In Escudero et al. (2015) it is shown that the number of scenarios with shortfall on reaching the modeler-driven thresholds 
                           
                              
                                 ϕ
                                 p
                              
                              =
                              
                                 δ
                                 p
                              
                              ×
                              
                                 z
                                 RN
                              
                              ,
                           
                         for 
                           
                              p
                              ∈
                              
                                 P
                                 T
                              
                              ,
                           
                         where ϕ
                        1 = 255 969, ϕ
                        2 = 242 497, ϕ
                        3 = 229 025 and ϕ
                        4 = 215 553 (in decreasing order) are
                           
                              
                                 |
                              
                              
                                 Ω
                                 
                                    RN
                                 
                                 1
                              
                              
                                 |
                              
                           
                         = 50, 
                           
                              
                                 |
                              
                              
                                 Ω
                                 
                                    RN
                                 
                                 2
                              
                              
                                 |
                              
                           
                         = 22, 
                           
                              
                                 |
                              
                              
                                 Ω
                                 
                                    RN
                                 
                                 3
                              
                              
                                 |
                              
                           
                         = 6 and 
                           
                              
                                 |
                              
                              
                                 Ω
                                 
                                    RN
                                 
                                 4
                              
                              
                                 |
                              
                           
                         = 0 (in decreasing order as well) out of 128 scenarios, respectively, and the related expected shortfall is 
                           
                              e
                              
                                 RN
                              
                              1
                           
                         = 3498.9, 
                           
                              e
                              
                                 RN
                              
                              2
                           
                         = 886.9, 
                           
                              e
                              
                                 RN
                              
                              3
                           
                         = 56.6 and 
                           
                              e
                              
                                 RN
                              
                              4
                           
                         = 0.0, respectively.

For illustrative purposes, let us assume that the risk neutral picture is carrying out an excessive profit risk, and consider that it has been decided that the upper bound on the number of scenarios with shortfall (i.e., at the last stage T = 5) has been reduced from 50 to |Ω
                        1| = 45, from 22 to |Ω
                        2| = 17, from 6 to |Ω
                        3| = 3 and the zero scenario policy is kept for profile 4 (i.e., |Ω
                        4| = 0). Additionally, assume that the upper bound on the expected shortfall has been reduced from 3498.9 to e
                        1 = 3240.0, from 886.9 to e
                        2 = 650.0, from 56.6 to e
                        3 = 35.0 and the zero shortfall policy is obviously kept for profile 4 (i.e., e
                        4 = 0.0). The optimal solution of TSD model (2) is shown in Table 4. Let us consider the expected profit 
                           
                              z
                              
                                 CPX
                              
                              TSD
                           
                         = 269 273 obtained by plain use of CPLEX (observe that the BFC-TSD algorithm gives a close value, 
                           
                              z
                              
                                 BFC
                              
                              TSD
                           
                         = 269 247 whose goodness gap is smaller than 0.01 percent). Observe that the expected profit of RN model (1), z
                        RN = 269 441, has only been slightly reduced in solution value of model TSD (2) and, on the other hand, the profit risk of non-wanted scenarios has been reduced to the modeler-driven bounds.

However, let us assume that the above risk averse TSD picture is also carrying out an excessive profit risk on the number of scenarios with shortfall and expected shortfall on reaching modeler-driven thresholds on an intermediate stage, say T − 1 = 4, being the thresholds ϕ
                        1 = 67 360.2 for its profile p = 1 and ϕ
                        2 = 53 888.2 for its p = 2, the number of scenarios with shortfall are 
                           
                              |
                              
                                 Ω
                                 1
                              
                              
                                 |
                                 =
                                 90
                              
                           
                         and 
                           
                              |
                              
                                 Ω
                                 2
                              
                              
                                 |
                                 =
                                 33
                              
                              ,
                           
                         and the expected shortfall is e1
                         = 5839 and e2 =1063 (see Table 4). In order to reduce the non-admissible profit risk up to stage T − 1 = 4 within the feasible region restricted by the risk bounds already imposed for stage T = 5, let us also assume that it has been decided that the upper bound on the number of scenarios with shortfall for stage T − 1 = 4 has been reduced from 90 to |Ω
                        1| = 80 and from 33 to |Ω
                        2| = 26, and the upper bound on the expected shortfall has been reduced from 5839 to e
                        1 = 5400 and from 1063 to e
                        2 = 800. The optimal solution of TSD model (2) is obtained where the profiles above are set up in the sets 
                           
                              P
                              t
                           
                         for 
                           
                              t
                              ∈
                              
                                 T
                                 ˜
                              
                              =
                              
                                 {
                                 4
                                 ,
                                 5
                                 }
                              
                              ,
                           
                         see the results in Table 5. Let us consider the solution value 
                           
                              z
                              
                                 CPX
                              
                              TSD
                           
                         = 269 222 obtained by plain use of CPLEX (observe that the BFC-TSD algorithm gives a close value, 
                           
                              z
                              
                                 BFC
                              
                              TSD
                           
                         = 269 204 whose goodness gap is also smaller than 0.01 percent). Observe also that the expected profit of TSD model (2) with 
                           
                              
                                 T
                                 ˜
                              
                              =
                              
                                 {
                                 5
                                 }
                              
                              ,
                           
                         269 273, has only been slightly reduced by TSD model (2) with 
                           
                              
                                 T
                                 ˜
                              
                              =
                              
                                 {
                                 4
                                 ,
                                 5
                                 }
                              
                           
                         and, on the other hand, the profit risk of non-wanted scenarios up to stage T − 1 = 4 has been reduced to the modeler-driven bounds without modifying the also modeler-driven profit risk bounds for last stage T = 5.

@&#CONCLUSIONS@&#

In this work we have presented an extension of the Branch-and-Fix Coordination BFC algorithm that we have proposed elsewhere Escudero et al. (2012) for solving multistage mixed 0-1 models where the uncertainty appears anywhere and is represented via nonsymmetric scenario trees. The extension allows to consider some risk averse strategies, namely the first- and second-order stochastic dominance constraint (SDC) ones induced by mixed integer-linear recourse. Those strategies have been recently proposed in Gollmer et al. (2011, 2008) for dealing with the two-stage problem and their implementation requires cross scenario constraints. Additionally, our multistage risk averse model (2) considers the Time Stochastic Dominance requirements for those ones, so that a new SDC strategy has been introduced, so named TSD. It simultaneously considers for each modeler-driven profile bound targets on the probability of failure and the expected shortfall over the scenario groups on reaching the thresholds at the selected stages. Notice that, the satisfaction of one of the two bounds does not imply the satisfaction of the other one.

The treatment of the related TSD constraints has been performed in a similar way as it is done for the nonanticipativity constraints (NAC) (4) and (5) for the stages up to the so-named break stage t
                     * introduced in Escudero et al. (2012), where they are algorithmically satisfied. That is, those cross scenario group constraints in the original model (2) have been relaxed for solving the scenario cluster submodels (3) in a coordinated way for the so-named candidate Twin Node Families (TNF) along the execution of the algorithm. Some of the NAC (4) are algorithmically satisfied and some others are not. Once all of them are satisfied, a so-named integer TNF is obtained such that the 0-1 variables are fixed to their 0-1 values. At that point, model (7) is solved for satisfying the NAC (5) for the continuous variables. Finally, for guaranteeing optimality a modeler-driven label allows to solve model (8). As a result, the extension of the BFC algorithm, so named BFC-TSD, paves the way for considering other risk averse strategies, see Alonso-Ayuso et al. (2014).

TSD model (2) for multistage stochastic mixed integer recourse problems consists of the maximization of the objective function expected value over the scenarios along a time horizon, such that a risk reduction profile set is modeled for given functions, in our case, the objective function up to selected stages along the time horizon. It has been tested against the risk neutral model (1). Additionally, since the risk reduction constraints belong to a strategic managerial type of policy (as opposed to physical constraints, balance equations, etc.), model (2) considers those constraints as soft ones. So, the bounds on the fraction of scenarios with shortfall and the expected shortfall are not considered as hard ones, but as targets to reach, so that appropriate slack variables (highly penalized in the objective function) avoid potential model’s infeasibility and, in case, help to identify feasible bounds.

A definitive conclusion that can be drawn from the analysis of our computational experience is that solving the original TSD model (2) by plain use of a MIP solver may require so much computing effort for medium-sized instances that a type of decomposition scheme should be used. The algorithm that is proposed in this work allows to decompose the model by a scheme based on scenario cluster submodels, whose main ingredients are the TNF and break stage (Escudero et al., 2012) concepts. For that purpose we represent the original model as a mixture of the splitting variable and compact representations. A BFC scheme (Alonso-Ayuso, Escudero, Garín et al., 2003; Alonso-Ayuso, Escudero, Ortuño, 2003) has been used for handling the splitting variable representation to obtain the solution value of the original stochastic MIP problem. The compact representation of the independent MIP submodels related to the scenario clusters for the stages from the break one until the last stage has been optimized by plain use of CPLEX (where 8 threads have been used).

From our computational experiment we can conclude that the risk averse TSD strategy with 
                        
                           
                              |
                           
                           
                              T
                              ˜
                           
                           
                              |
                              >
                              1
                           
                        
                      has higher risk reduction than the risk neutral (RN) strategy in case of high variability in the objective function value over the scenarios for the RN solution.

@&#ACKNOWLEDGMENTS@&#

This research has been partially supported by the projects Grupo de Investigación EOPT (IT-567-13) from the Basque Country Government, BETS UPV/EHU Research and Training Unit (UFI), Project P711RT0278 in the Programa Iberoamericano de Ciencia y Tecnología para el Desarrollo (CYTED), and MTM2012-31514 from the Spanish Ministry of Economy and Competitiveness. The authors would like to thank to the two anonymous reviewers for their help on clarifying some concepts presented in the manuscript and strongly improving its presentation.

Let us consider instance P7 (|Ω| = 128 scenarios), and zM
                      be the objective function expected value and 
                        
                           z
                           M
                           ω
                        
                      be the related value for scenario ω from the solution of model M, where it could be the reference for the models WS, RN, FSD, SSD, TSD with 
                        
                           
                              T
                              ˜
                           
                           =
                           
                              {
                              T
                              }
                           
                        
                      (TSD1) or TSD with 
                        
                           
                              T
                              ˜
                           
                           =
                           
                              {
                              T
                              −
                              1
                              ,
                              T
                              }
                           
                        
                      (TSD2). Fig. 2
                      depicts the left tail of the probability density and cumulative distribution curves of the objective function of models M. Fig. 3
                      shows the comparison between the objective function values of the WS and RN strategies and each risk averse strategy in particular.

See in Escudero et al. (2015) the main results of our computational experience for the models FSD and SSD. They are particular cases of TSD model (2) where the former results from removing the e-constraints and the
                        
                           
                              ϵ
                              e
                           
                           -
                        
                     slack variables, and the latter results from removing the β-constraints, the ν-variables and the 
                        
                           
                              ϵ
                              β
                           
                           -
                        
                     slack variables.

We can observe in Fig. 2 that the objective functions of the risk averse strategies have more scenarios with value close to the expected one than the RN strategy has and, on the other hand, they have fewer scenarios with a value in the “left tail” of the probability density function. It means a smaller probability of having a non-wanted scenario (for a maximization of the objective function, as it is our case) and, then, higher risk reduction. It can also be observed that the TSD1 solution has higher risk reduction than the FSD and SSD solutions, and the TSD2 solution has higher risk reduction than the TSD1 one. The kurtosis vector is as follows: (WS, RN, FSD, SSD, TSD1, TSD2) = (− 0.2638, − 0.2552, − 0.2447, − 0.2485, − 0.2362, − 0.2176). On the other hand, observe that the cumulative distribution curves for the risk averse strategies are below the other curves.

Given the threshold ϕp
                      as the multiplicative factor δp
                      times the solution value z
                     RN for p = 1, 2, 3, 4, i.e., 
                        
                           
                              (
                              
                                 ϕ
                                 1
                              
                              ,
                              
                                 ϕ
                                 2
                              
                              ,
                              
                                 ϕ
                                 3
                              
                              ,
                              
                                 ϕ
                                 4
                              
                              )
                           
                           =
                           
                              (
                              0.95
                              ,
                              0.90
                              ,
                              0.85
                              ,
                              0.80
                              )
                           
                           ·
                           
                              z
                              RN
                           
                           ,
                        
                      the abscissa of Fig. 3 gives the objective function value for the scenarios up to 1.0 · z
                     RN, the thresholds are depicted in vertical and the ordinate gives the cumulative fraction of the scenarios, say β, whose objective function values are smaller than the value in abscissa, in particular βp
                      = P(zM
                      < ϕp
                     ) for M ∈ {FSD, SSD, TSD1, TSD2}, i.e., fraction of scenarios with shortfall on reaching threshold ϕp
                     . Notice that

                        
                           
                              
                                 
                                    
                                    
                                    
                                       
                                          P
                                          
                                             (
                                             
                                                z
                                                WS
                                             
                                             <
                                             
                                                ϕ
                                                p
                                             
                                             )
                                          
                                          ≤
                                          P
                                          
                                             (
                                             
                                                z
                                                M
                                             
                                             <
                                             
                                                ϕ
                                                p
                                             
                                             )
                                          
                                          ≤
                                          P
                                          
                                             (
                                             
                                                z
                                                RN
                                             
                                             <
                                             
                                                ϕ
                                                p
                                             
                                             )
                                          
                                          
                                          ∀
                                          M
                                          ∈
                                       
                                    
                                 
                                 
                                    
                                    
                                    
                                       
                                          
                                          {
                                          FSD
                                          ,
                                          SSD
                                          ,
                                          TSD
                                          1
                                          ,
                                          TSD
                                          2
                                          }
                                          ,
                                          
                                          p
                                          =
                                          1
                                          ,
                                          2
                                          ,
                                          3
                                          ,
                                          4
                                          ,
                                       
                                    
                                 
                              
                           
                        
                     that is, the fraction of scenarios with shortfall on reaching the thresholds has significatively been reduced in the risk averse solutions versus the RN one.


                     
                        
                           BF, Branch-and-Fix.

BFC, Branch-and-Fix Coordination.

BFC-TSD, Branch-and-Fix Coordination procedure with Time Stochastic Dominance strategy.

CVaR, Conditional Value-at-Risk.

DEM, Deterministic Equivalent Model.

FSD, First-order Stochastic Dominance.

MIP, Mixed Integer Programming.

NAC, Nonanticipativity Constraints.

RN, Risk Neutral.

SDC, Stochastic Dominance Constraints.

SSD, Second-order Stochastic Dominance.

TNF, Twin Node Family.

TSD, Time Stochastic Dominance.

TSD1, Time Stochastic Dominance for 
                                 
                                    
                                       |
                                    
                                    
                                       T
                                       ˜
                                    
                                    
                                       |
                                       =
                                       1
                                    
                                 
                              .

TSD2, Time Stochastic Dominance for 
                                 
                                    
                                       |
                                    
                                    
                                       T
                                       ˜
                                    
                                    
                                       |
                                       =
                                       2
                                    
                                 
                              .

WS, Wait-and-See.

@&#REFERENCES@&#

