@&#MAIN-TITLE@&#An efficient intelligent analysis system for confocal corneal endothelium images

@&#HIGHLIGHTS@&#


               
               
                  
                     
                        
                           
                           A new intelligent system to tackle the challenges of confocal corneal endothelium images is developed.


                        
                        
                           
                           This system underpins the expertise of ophthalmologists.


                        
                        
                           
                           It provides clinically useful factors, saves a useful amount of clinician time in the process.


                        
                        
                           
                           It is able to model endothelial cells for better evaluation and fast analysis.


                        
                        
                           
                           Useful system for busy clinic and patient care.


                        
                     
                  
               
            

@&#KEYPHRASES@&#

Confocal microscope

Cornea

Endothelium layer, Snake, Particle swarm optimisation

@&#ABSTRACT@&#


               
               
                  A confocal microscope provides a sequence of images of the corneal layers and structures at different depths from which medical clinicians can extract clinical information on the state of health of the patient's cornea. A hybrid model based on snake and particle swarm optimisation (S-PSO) is proposed in this paper to analyse the confocal endothelium images. The proposed system is able to pre-process images (including quality enhancement and noise reduction), detect cells, measure cell densities and identify abnormalities in the analysed data sets. Three normal corneal data sets acquired using a confocal microscope, and three abnormal confocal endothelium images associated with diseases have been investigated in the proposed system. Promising results are presented and the performance of this system is compared with manual and two morphological based approaches. The average differences between the manual and the automatic cell densities calculated using S-PSO and two other morphological based approaches is 5%, 7% and 13% respectively. The developed system will be deployable as a clinical tool to underpin the expertise of ophthalmologists in analysing confocal corneal images.
               
            

@&#INTRODUCTION@&#

The cornea is the transparent surface component of the eye covering important internal structures including the iris, lens, and anterior chamber as illustrated in Fig. 1
                     . Damage to the cornea caused by disease or injury can critically affect the quality of vision. The cornea comprises proteins, fibrils and various cells in a highly organised structure [1]. The fixed focusing power provided by the air to cornea surface is one of the cornea's major functions, which together with the contribution provided by the adjustable internal lens causes the light rays passing through to produce a sharp image on the retina. Another function of the cornea is to protect the retina by filtering dangerous ultraviolet light. The cornea also works as a shield to protect the internal structures from attack by microorganisms.

The cornea joins smoothly with the non-transparent sclera and has lateral dimensions of around 12.6mm in the horizontal direction and 11.7mm in the vertical direction. The thickness of cornea varies and ranges from about 520μm at the centre to about 650μm at the periphery [2,3]. The cornea has a tear film on its front surface and three main internal layers separated by two thin membranes. The corneal structure is shown in Fig. 2
                     . The corneal layers are the outermost epithelium layer, separated by Bowman's membrane from the central stroma layer, which is separated in turn by Descemet's membrane from the innermost endothelium layer.

Confocal microscopy of the cornea offers several advantages over conventional microscopy. It provides images showing the cell structures in different corneal layers, which can be obtained with typical minimum depth separation of about 5μm, and they can be immediately viewed and used for diagnostic purposes. The employed images in the current work are from a Confoscan 4 microscope, produced by Nidek, Inc., Freemont, CA. During a typical scan, the microscope locates the rear of the cornea (no signal back from aqueous humour) and steps forward by the specified increment until it reaches the anterior surface of the cornea (no signal back from the tear layer). This cycle is repeated 3 times during a 20s scan providing around 350 images. The acquired two-dimensional images are useful to provide important clinical information on the corneal state of health and to analyse corneal structures in the whole volume of the cornea, not just at a specific depth. Because of the spherical shape of corneal layers, which causes non-uniform reflection of illumination light in the different corneal areas, and the different attenuation of light along the various illumination paths; acquired images do not usually have a uniform luminosity and contrast, exhibiting darker areas in the peripheral regions of the images [4].

Confocal microscopy offers clinicians one of the most detailed views of corneal structures and pathologies. It helps clinician to establish the presence of ophthalmic pathology caused by bacterial, viral, parasitic and fungal infections [5,6]. It provides detailed images of each layer of the cornea. The endothelial cells are located immediately posterior to Descemet's membrane, and are characterised by a regular hexagonal hyper-reflective pattern or regular honeycomb mosaic, surrounded by hypo-reflective borders without obvious nuclei reflections. No vessels or nerves are present in this layer. Sometimes, the nuclei of the cells may be visualised [7–10]. Examples of corneal original images of stroma and endothelium layers are shown in Fig. 3(a) and (b) respectively.

Injuries, infections, dystrophies and ocular diseases (such as lattice dystrophy), dry eye, genetic conditions and changes due to ageing can all reduce the ability to see clearly, sometimes causing pain and discomfort as well. It is possible to see some of these corneal conditions developing, while others are difficult to monitor. Treatments can involve eye drops, other medications, contact lenses, surgery (such as corneal graft operations), etc. Small changes in the cornea can significantly affect its visual performance [11]. Therefore, it is important to analyse the endothelium cells count and density, as they may affect the cornea transparency and the visual quality.

The confocal microscope's generation of a large number of images per patient per scan, makes their analysis a challenging task for an ophthalmologist with a large number of patients in a busy clinical setting. Ophthalmologists could use an efficient system to reduce the analysis time and speed up the treatment process, by giving them the opportunity to look at individual layers on demand, leading to faster and more accurate diagnosis. Our research aim is to develop an as yet unavailable complete analysis system for the main corneal layers (epithelium, stroma and endothelium). Due to the nature of these layers and the information (clinical parameters) required from each of them, the developed system has four main parts. First, pre-process (quality enhancement, noise removal) the data sets provided to the clinicians by the confocal microscope (this step is shared between the three main parts) and classify the corneal layers. Second, analyse stroma data and visualise stroma corneal images as well as each individual keratocyte cell as a volume for further clinical analysis. Third, analyse the epithelium layer and detect nerves. Fourth, analyse the endothelium layer which is presented in this paper.

Two existing systems providing a capability to analyse the endothelium are the HRT Rostock Cornea Module and the Confoscan 4. The former offers a semi-automated endothelial cell counting feature, and calculates the cell number and the cell density. The Confoscan 4 allows automated or semi-automated and manual endothelial image analysis. However, many researchers and clinicians use the semi-automated or manual mode to be able to apply the correction tools to correct the mistakes made by the automated analysis. Hence there is a need to improve the automation of endothelium analysis. This work introduces a novel approach for analysing the corneal endothelium images produced by a confocal microscope and proposes a system which is fully automated and has the capability to calculate cell number, cell density as well as minimum, maximum and average cell areas.

The paper shows how an advanced hybrid algorithm of image processing and evolutionary techniques provides extendibility to the approach and offers analytical advantages in this problem domain. Here we address the problem of the automatic estimation of endothelial cell densities from healthy images and abnormal images displaying Fuchs’ dystrophy, advanced Fuchs’ disease and posterior polymorphous corneal dystrophy (PPCD). In this paper we study approaches based on the snake-particle swarm optimisation (S-PSO) algorithm and morphological image processing operations to extract individual corneal endothelial cell contours. Most researchers in this field calculate the statistical measures of endothelium cells collectively, that is one set of statistical measurements for each image. The main advantage of the S-PSO algorithm is that it takes the endothelium cell analysis to the individual cell level. In this method, for each endothelium cell in the image a cell profile is created with an individual contour. Of course this leads to better understanding and analysis of the endothelium cell structures as well as better calculations of statistical indexes. The developed system will improve the efficiency of the clinical practice as it will provide the clinicians with a system which is automated, has the ability to analyse large number of images, detect any abnormality in the processed images, and provide an instant statistical analysis for each image. Colour coding of cell density gives a quick qualitative analysis of the images acquired. This type of analysis is commonly used in many ophthalmic diagnostic devices such as corneal topographers and retinal optical coherence tomographers. In addition, there are further benefits to patients as it allows easier explanation of their corneal abnormality/disease in a simple graphical way. The time taken to analyse multiple images/scans using existing systems is about 10–15min per eye but using this new software the time taken is significantly less at around 2min. Overall, the benefits for the clinician are significant as it will allow him/her to be presented with data in an easy to understand way which will allow the diagnosis and differentiation of endothelial diseases such as Fuch's dystrophy and posterior polymorphous dystrophy. Also, in assessing the corneal endothelium following corneal lamellar transplantation surgery which is difficult using specular microscope due to interface between the donor and host cornea.

In summary, the main objective of the research presented here is to develop a robust system to analyse corneal endothelial cells and extract clinically useful information to help an ophthalmologist diagnose the endothelium layer rapidly and accurately. This paper is organised as follows. Section 2 presents the current state of the art of the technical and clinical related corneal research work focusing on the endothelium layer. Section 3 presents the proposed methodology including the data sets employed, the preprocessing system and the experiment description. The results and analysis are presented in Section 4, while the conclusions are presented in Section 5.

The following two subsections summarise the current state of the art research related to the corneal endothelium layer. This is covered from both the technical and clinical points of view.

The work in [13] provides a method to derive endothelium cell density without identifying the cell contours as most other techniques do; based on the assumption that endothelial cells appear approximately as a regular tessellation of hexagonal shapes. The problem with this method is that does not take into account that this is not always the case. The technique estimates the inverse transpose of a matrix that generates this cellular lattice, from which the density is easily obtained. The basis matrix may vary noticeably from one region to another because cells have different sizes and spatial orientations throughout the corneal image. Therefore, in order to minimise the effects of this variability, a local estimation is performed. This also provides an estimation of the variability of the corneal density closely related to the variation of cell sizes. An inverse phase-contrast microscope was used to acquire the endothelium images from corneas kept in the Berlin cornea bank. In our study a confocal microscope was used to acquire the endothelium images directly from patients.

The work in [14] presents a software tool for automated morphometric analysis of corneal endothelium images. This tool uses an analogue cellular neural network (CNN) algorithm that allows both the recognition of cell shape and the measurement of endothelial cell area. The algorithm consists of a combination of classical image processing procedures linked together with some CNN operations. In particular, two main parts can be distinguished. One processes the original image in order to obtain the skeletonised structure of the cells’ borders. The second processes this skeletonised image to detect the cells’ corners, and then rebuilds the cells and so determines their shapes. The images were acquired by specular microscopy which is ideal for imaging the central corneal endothelium and provides high contrast between the different endothelial tissues.

The work of [15] addresses the problem of automatic estimation of endothelial cell density from microscopy images of donor corneas using Fourier analysis. By means of a two dimensional discrete Fourier transform (DFT), a spatial frequency analysis is applied to the acquired images. This mathematical technique extracts information regarding the various spatial frequencies within the image, relating to the repetitive patterns present in the image. These images were acquired from the Cornea Bank Berlin as follows. The corneas were kept in hypotonic balanced salt solution (BSS) for a better microscopy visualisation of the endothelial cells by osmotic stimulation. Endothelial cell images were acquired before organ culture or after de-swelling in organ culture medium (minimum essential medium (MEM) with 2% fatal calf serum (FCS)) containing 6% dextran 5000, in order to have a low number of folds in the Descemet's membrane and a large area of endothelial cells in focus. Only corneas with clearly visible endothelial cells after osmotic stimulation were used. Finally these corneas were imaged using an inverse phase contrast microscope.

The authors of [16] developed a system for extracting an estimate for the cell density from the spatial frequency information in the image. They applied a spatial frequency analysis using the 2D DFT, and the transformed images showed a specific type of frequency content that appears as a circular band around the origin with radius changes depending on the analysed image. Making comparisons of different images, they found that the radius of this band is modulated by the frequency of the repetitive pattern of cells. A Zeiss Axiovert optical microscope was used to acquire these endothelium images.

The algorithm developed in [17] comprises a neural network based segmentation module, and a second “expert correction” module, to cope with wrong results still present in the segmented image; this module includes recovery of missing contours and tentative merging or splitting of cell bodies. To correct for non-uniform illumination and reduce the amount of noise in images, the authors applied a parabolic correction and a band-pass filter respectively. This system is heavily dependent on the expert correction, and used images gathered from different ophthalmic instruments, for each of which a specific neural network has been realised; however nothing is said about these instruments in this reference.

The authors of [18] proposed a robust method for segmenting grey-scale images of corneal endothelial tissue. They started with the extraction of markers of the corneal cells using a dome extractor based on morphological grey-scale reconstruction. Then, binary images of the corneal cell network are produced. From these images, they derived histograms of the cell sizes and numbers of neighbours. They also constructed a neighbourhood graph of the corneal cells that gives information on the distribution of cells with large number of neighbours in the tissue. A top-hat transformation segmentation tool was used for detecting the thin dark cell outlines that separate any two neighbouring cells. An alternated sequential filter (ASF) of small size was employed in order to remove impulse noise while preserving the valleys (separating lines between cells). Then morphological reconstruction is used to detect the cells. They assigned a grey-level value equal to each cell's area (number of pixels) and computed a histogram of cell sizes for each image. To determine the number of edges of a corneal cell, they used contour tracking algorithms that determine the adjacency graph of the corneal tissue. Furthermore, they proposed a model for corneal cell death and rearrangement of corneal tissue, and verified the accuracy of this model by matching its output with the numerical results they obtained from the previous analysis. The employed images were acquired using a specular microscope, where the specular reflection of light from the boundary between the endothelial cells and the aqueous humour forms the images.

The authors of [19] developed analyser software providing tools for automatic error detection and correction, and for measuring endothelial cell density (ECD) and performing morphometry on multiple zones of three images of the endothelial mosaic obtained using a specular microscope.

The authors of [20] proposed a tree-structural image-processing method that can be applied to images that have different statistics in different regions. This method prepares two types of nodes; one type represents known image-processing filters, and the other represents conditional branches which, using the statistics of the cell images, can determine the divergent direction. Moreover, the proposed method used genetic programming (GP) to optimise their combination. The images used in the experiment are two cultured Macaca fascicularis corneal endothelial cell images acquired using a phase-contrast microscope.

The work in [21] proposed a detection method of cell field contours in corneal endothelium images. The algorithm presents a set of single-cell contour models (a cell field), that statistically describe individual cells in terms of shape a priori information and a-posteriori image representation. Each cell is individually identified on an image given a starting point and an appropriate optimisation algorithm. Interaction between cell models can be used to introduce further information and improve the overall model identification for a cell field. Results show an improvement in the cell contours recognition when single cell models extend to field models.

None of the previously mentioned studies have employed confocal microscope in the image acquisition. Most of these studies have used a specular microscope, which is ideal for imaging the central corneal endothelium. It achieves high contrast between the different endothelial tissues, produces good highly focused images with negligible light scatter. However, the specular microscope is less effective for imaging structures elsewhere in the cornea. For example, the mid-stroma and epithelium are associated with significant scattered light, which obscures the image. A summary of these studies is presented in Appendix I at the end of this paper.

The authors of [22] state that limited data are available for comparisons of performances between the different types of confocal microscopes. The ability to serially produce images of thin layers from the cornea is the primary advantage of laser scanning confocal microscopy. The depth of focus for different confocal microscopes varies and is 5–7μm for the laser confocal microscope, whilst it is 7–9μm for the Tandem scanning confocal microscope and 26μm for slit scanning systems [23]. Endothelial cell density measurement has been compared between Confoscan 3 and HRT RCM. All the cell density results (for abnormal and normal subjects) obtained with the RCM were higher than those obtained with the Confoscan 3 [24]. The studies [22,25] compared measurements of cell density and image contrast with contemporary Confoscan 4 and HRT RCM. They observed agreement between the two devices for cell density measurement. HRT RCM offers a semi-automated endothelial cell counting feature, it calculates only the cell number and the cell density. The authors of [26,27] stated that the software of the Confoscan 4 microscope allows automated or semi-automated and manual endothelial image analysis. However, due to the errors in the fully automated mode results, many researchers use the semi-automated or manual mode so as to apply the correction tools to correct the mistakes made by the automated analysis. The study in [28] reported that the Confoscan 4 automated cell detection software differed significantly from manual cell detection in both normal and DSEK eyes. Furthermore they conclude that the automated programmes significantly overstated endothelial cell density. The results reported in [29] show that endothelial cell count was significantly lower in the automated than in the semi-automated and manual analysis for both ConfoScan 4 and specular EM 1100 microscopy. Our paper proposes a new automated quantitative analytical approach for evaluating confocal microscope images of the corneal endothelium. Moreover, it enables the user to measure not only the cell number and cell density but also some additional parameters such as the minimum, maximum and average areas of cells.

This section describes clinical research work which focuses on endothelial corneal diseases. These diseases include Fuchs’ endothelial dystrophy, which appears as roundish hypo-reflective images with an occasional central highlight at the level of the endothelium as shown in Fig. 4a. Fig. 4b shows advanced Fuchs’ endothelial dystrophy, where many roundish low intensity areas of different sizes with diffuse central light spot between the hyper-reflective endothelial cells clearly appear. Iridocorneal endothelial syndrome has areas of highly abnormal cells characterised by marked epithelial-like appearance; a loss of regularity in size and shape are found as shown in Fig. 4c [8].

In posterior polymorphous corneal dystrophy (PPCD) vesicles are observed at the level of the endothelium. They appear as round lesions containing endothelial cells with surrounding haze, as shown in Fig. 4d, and appear as a prominent hyper-reflective band lesion at the level of Descemet's membrane [8,30]. It has a well-delineated roundish shape (the biggest forms 5.8% and the smallest forms 3.5% of the field of view) with low intensity that is nears black on a low intensity background. These rounded shapes have diagonal patterns surrounded by a hazy halo that has high grey-scale values. A case report in [31] observes the appearance of endothelial vesicular lesions in curvilinear patterns with associated endothelial pleomorphism and polymegathism. In patients with more advanced posterior polymorphous dystrophy, very prominent corneal nerves at the level of Bowman's membrane are delineated.

The data set acquired using a confocal microscope usually includes some black images with no usable data, mostly at the beginning and the end of the image sequence. A statistical approach, using the mean, has been employed to detect these images; any image with mean value in the range 0–10 (grayscale values) is removed from the data sets to be processed. This range was chosen after performing several tests and cross validation runs on all the processed data sets. The remaining images are then pre-processed, to enhance quality and reduce noise, by Fourier filtering using a DFT combined with band-pass Butterworth filter of order 4 and range of frequencies 30–120. Different filter orders and frequencies ranges were tested on the processed data sets, and the best results achieved using these values. Fig. 5a and b shows original endothelium image, and corresponding pre-processed image respectively.

A watershed approach is then applied to the preprocessed image by calculating a Euclidian distance map and dilating each of the points, which represent the peaks or local maxima, as far as possible, using the stopping criteria which will be either until the edge of the image is reached, or the edge touches a region of another growing point [32]. The watershed approach works best for smooth convex objects that don’t overlap too much. To benefit from this property of the watershed algorithm, a Gaussian smoothing filter is employed as a prior step to the watershed transform. Experiments have been performed to find a suitable filter window size for the proposed application. Each image processed by the watershed transform is then eroded using a Euclidian distance map to generate an ultimate point representing the final point that would be removed if the available objects were eroded to completion [33]. In this application the watershed transformation produces some over segmentation of endothelium cell but these points are useable as cell centres from which the contour evolution of the approach described in following section starts.

S-PSO is a hybrid active contour model of snake model (S), and particle swarm optimisation (PSO). The active contour model has been widely used in image processing applications such as boundary delineation, image segmentation, stereo matching, shape recognition and object tracking. Traditional active contour models converge slowly and are prone to local minima due to their complex nature. The S-PSO scheme has been introduced to evolve contours over time and improve the quality of results. This model inherits particle navigation scheme from PSO and modifies it to reflect the requirements of active contour modelling. The combination of PSO dynamics with snake model kinematics enables S-PSO to successfully overcome active contour difficulties [34].

The snake model is a controlled continuous spline governed by internal and external forces [35]. The internal forces act as a smoothness constraint and the external forces (also called image forces) push the snake towards prominent image features such as lines, edges and contours. In the parametric implementations, a snake is formed by a number of discrete points called snaxels (snake pixels or control points). The formal representation of a parametric snake p as a time varying curve is as follows [34]:
                           
                              (1)
                              
                                 
                                    p
                                    (
                                    s
                                    ,
                                    t
                                    )
                                    =
                                    (
                                    x
                                    (
                                    s
                                    ,
                                    t
                                    )
                                    ,
                                    y
                                    (
                                    s
                                    ,
                                    t
                                    )
                                    )
                                    ,
                                     
                                    s
                                    ∈
                                    [
                                    0,1
                                    ]
                                 
                              
                           
                        where t is the time, s is the arc length and the goal is to evolve the snake to minimise the total snake energy, which is sum of integral of internal energy and the integral of external energy of snake; it is given by:
                           
                              (2)
                              
                                 
                                    
                                       E
                                       
                                          snake
                                       
                                    
                                    =
                                    
                                       ∫
                                       0
                                       1
                                    
                                    
                                       
                                          E
                                          
                                             int
                                          
                                       
                                       (
                                       p
                                       (
                                       s
                                       )
                                       )
                                       d
                                       s
                                    
                                    +
                                    
                                       ∫
                                       0
                                       1
                                    
                                    
                                       
                                          E
                                          
                                             ext
                                          
                                       
                                       (
                                       p
                                       (
                                       s
                                       )
                                       )
                                       d
                                       s
                                    
                                 
                              
                           
                        
                     

The integral internal snake energy, (Eq. (3)), consists of two terms which are the first and second derivatives of the snake with respect to s. These terms, respectively, control contour behaviours as a membrane and as a thin plate and are regulated by tension coefficient α(s) and rigidity coefficient β(s).
                           
                              (3)
                              
                                 
                                    
                                       E
                                       
                                          int
                                       
                                    
                                    =
                                    
                                       
                                          (
                                          α
                                          (
                                          s
                                          )
                                          
                                             
                                                
                                                   
                                                      
                                                         p
                                                         s
                                                      
                                                      (
                                                      s
                                                      )
                                                   
                                                
                                             
                                             2
                                          
                                          +
                                          β
                                          (
                                          s
                                          )
                                          
                                             
                                                
                                                   
                                                      
                                                         p
                                                         
                                                            s
                                                            s
                                                         
                                                      
                                                      (
                                                      s
                                                      )
                                                   
                                                
                                             
                                             2
                                          
                                          )
                                       
                                       2
                                    
                                 
                              
                           
                        
                     

The external snake energy determines the direction that the snake should evolve in the image. Features of interest in the image correspond to lower energy and hence the snake is encouraged to move towards them. Various external energy features can be employed such as image intensity, image gradient, object size or shape. One common definition used for grey-level images is the gradient of the Gaussian function:
                           
                              (4)
                              
                                 
                                    
                                       E
                                       
                                          ext
                                       
                                    
                                    (
                                    p
                                    (
                                    s
                                    )
                                    )
                                    =
                                    −
                                    γ
                                    (
                                    s
                                    )
                                    
                                       
                                          
                                             
                                                ∇
                                                
                                                   G
                                                   σ
                                                
                                                *
                                                I
                                                (
                                                x
                                                ,
                                                y
                                                )
                                             
                                          
                                       
                                       2
                                    
                                 
                              
                           
                        where γ(s) is the coefficient for external energy, σ is the standard deviation for Gaussian function and I(x,y) is the image intensity. The snake model is usually formulated as a minimisation problem and the best contour is obtained by solving the following Euler–Lagrange equation. P
                        
                           ss
                         and P
                        
                           ssss
                         are second and fourth order derivatives of respectively:
                           
                              (5)
                              
                                 
                                    α
                                    
                                       p
                                       
                                          s
                                          s
                                       
                                    
                                    (
                                    s
                                    )
                                    −
                                    β
                                    
                                       p
                                       
                                          s
                                          s
                                          s
                                          s
                                       
                                    
                                    (
                                    s
                                    )
                                    −
                                    ∇
                                    
                                       E
                                       
                                          ext
                                       
                                    
                                    =
                                    0
                                 
                              
                           
                        
                     

The second part of the snake-PSO hybrid algorithm, is the PSO component. PSO is a population based evolutionary optimisation algorithm which consists of a number of particles that are potential solutions to the optimisation problem [36]. Each particle has a position and a velocity which are initialised with random values. Using an iterative process, each particle's position on the search space is updated by revising its velocity according to its best experience and also its neighbors’ experiences.

The hybrid model helps to overcome the major drawbacks of traditional snakes; initialisation and poor convergence to the boundary concavities, while benefitting from PSO robustness and simplicity. The hybrid S-PSO model consists of a population of particles where each particle is a control point for the snake (active contour). All particles together form the contour and hence the population is the final solution. As the algorithm runs, each particle updates its position and its velocity according to its personal best experience, local best experience, and also according to the internal force of the snake and external force of the image. This gives the S-PSO dynamics a wider range of informative guidance to update the particle positions so that it converges to the desired region of interest (ROI). The Snake-PSO hybrid explores the search space according to PSO trajectory disciplines. The velocity update equation in S-PSO [34] is given in Eq. (6). After the velocities are updated, the new particle position is calculated by combining the velocity vector with the current particle position.
                           
                              (6)
                              
                                 
                                    
                                       v
                                       i
                                    
                                    (
                                    t
                                    +
                                    1
                                    )
                                    =
                                    ω
                                    
                                       v
                                       i
                                    
                                    (
                                    t
                                    )
                                    +
                                    
                                       c
                                       1
                                    
                                    
                                       r
                                       1
                                    
                                    (
                                    p
                                    b
                                    e
                                    s
                                    
                                       t
                                       i
                                    
                                    (
                                    t
                                    )
                                    −
                                    
                                       x
                                       i
                                    
                                    (
                                    t
                                    )
                                    )
                                    +
                                    
                                       c
                                       2
                                    
                                    
                                       r
                                       2
                                    
                                    (
                                    l
                                    b
                                    e
                                    s
                                    
                                       t
                                       i
                                    
                                    (
                                    t
                                    )
                                    −
                                    
                                       x
                                       i
                                    
                                    (
                                    t
                                    )
                                    )
                                    +
                                    
                                       c
                                       3
                                    
                                    
                                       r
                                       3
                                    
                                    (
                                    
                                       x
                                       ¯
                                    
                                    (
                                    t
                                    )
                                    −
                                    
                                       x
                                       i
                                    
                                    (
                                    t
                                    )
                                    )
                                    +
                                    
                                       c
                                       4
                                    
                                    (
                                    f
                                    .
                                    Im
                                    a
                                    g
                                    
                                       e
                                       i
                                    
                                    )
                                 
                              
                           
                        where v
                        
                           i
                        (t) is the velocity of particle i at time t, with coefficient ω which is called the inertia weight and controls the impact of the previous velocity and prevents radical changes. pbest
                        
                           i
                        (t) and lbest
                        
                           i
                        (t) are the personal best velocity and the local best velocity terms respectively. 
                           
                              
                                 x
                                 ¯
                              
                              (
                              t
                              )
                           
                         is the average of positions at time step t, approximating the centre of mass of particles. This term pushes the snake to contract or expand with respect to the sign of its weighting factor, r
                        3. This term speeds up the algorithm and is particularly useful when the snake is static and there is no other compelling force. f.Image
                        
                           i
                         is the normalised image force corresponding to external energy from snake model principles. For particle i, f.Image
                        
                           i
                         gives the image force at the position specified by that particle. Coefficients r
                        1, r
                        2 and r
                        3 are random numbers introducing stochastic behaviour into the algorithm. Weights for controlling each component of the algorithm are represented by acceleration factors c
                        1 to c
                        4 and are calculated dynamically in a way that if there is a higher image force c
                        4 always gets a higher value than other coefficients. It ensures that if snake is next to the object boundary, it will latch to the object of interest. Image force can be any arbitrary function depending on the application, but generally external energies such as image gradient and gradient of Gaussian functional are enough for satisfactory performance. It must also be noted that image force does not vary by time and it is calculated only once for an image [34,37]. S-PSO can be used for both detection and delineation of ROI as well as tracking the detected object. In the proposed endothelium application it has been deployed for detecting and extracting precise contour of the endothelium cells. This detection has been found to lead to accurate cell density measures and clinically important statistical information about the cells.

The developed approach uses two input images generated in the preprocessing step; the first one is the set of ultimate points and the second one from the watershed transform. The process is fully automated and does not rely on any user interaction or user defined parameters. Otsu's global threshold method based on grey-level histograms [38] is applied on the first image to discard noise and artefacts associated with the ultimate points. The result is an estimation of the centre of cells. Then, we run the S-PSO algorithm for every cell centre, i.e. an initial point-like structure is started in every position obtained from first image. These structures (snakes) are evolved in an iterative optimisation process governed by S-PSO mechanism and the image force. The second watershed generated image is used to calculate the image force (f.Image) for the S-PSO algorithm. The optimisation process stops when all snakes converge to cell boundaries and all cell contours are detected.

Cell contours are curves that represent the shape of each individual endothelial cell. For every cell the centre of mass, perimeter and area of the cell are calculated. It might happen that the first input image produces more than one cell centre for a single cell. Having individual cell profiles, the proposed algorithm finds duplicate cells and keeps only the unique cell structures. Since for the cells at the image edges only part of the cell is visible in the acquired image, to achieve higher precision, the algorithm detects these cells and does not include them in calculating the statistical measures, which will be discussed in Section 4. The main steps of the S-PSO algorithm for extracting endothelial cell information can be summarised as follows:
                           
                              -
                              Processing input files, cleaning centre image and defining estimated cell centres.

Calculating image force based on the image obtained from watershed algorithm.

Creating one snake for every estimated cell centre.

Initialising the internal weight parameters for the S-PSO algorithm.

Calculating the social and cognitive parts. In this step, we update the pbest value (the best velocity the snaxel ever experienced) and the lbest value as average of velocities of neighbouring particles.


                                 Moving snaxels. For each snaxel its velocity is evaluated and then each snaxel velocity and position is updated.


                                 Detecting snake. This step checks the convergence of snake contour to the cell outline, i.e. choosing the snake with the lowest total energy calculated. If the results are not satisfactory, the algorithm goes back to the step calculating the social and cognitive parts. The outcome of this step is the cell contour.


                                 Cell analysis. Statistical measures such as number of cells, cell density, and average, minimum and maximum cell area are calculated for each processed image.

A block diagram of the S-PSO based endothelium analysis system is presented in Fig. 6
                        . The acquired endothelium images go through the preprocessing stage to enhance the image quality and reduce the noise and to generate the ultimate points, and calculate the image force, which are used as inputs for the S-PSO algorithm.

The approach uses the following sets of parameters chosen to suit the proposed corneal endothelium analysis. First, the number of particles is 100. That is the number of snaxels used to define a parametric model of cell contour. The higher the number, the smoother the contour will be. Values which are too high will slow the S-PSO evolution process and might impede the convergence process. Second, the number of iterations is set to 100; that is the maximum number of iterative steps for evolving a snake. Third, the gradient sigma coefficient for calculating the image force is set to the value 3. Fourth, w, which is the inertia coefficient for the snaxel velocity in S-PSO, is set to 0.02. Fifth, the thresholds thx and thy are set to 6 pixels. These are thresholds for maximum tolerance for the distance between centre of mass of two contours used in finding duplicate cell contours. Sixth, the threshold tha is set to 25 pixels. This is the threshold for maximum tolerance for the area of two contours used in finding duplicate cell contours.

After fixing all the experimental internal parameters of the S-PSO, we have curve evolution using the S-PSO. Then unique cell shapes are obtained and the partial cells at the image edges are discarded. Afterward, individual cell contour profiles and statistical measures are extracted. Further statistical analysis is carried out on the processed images, which includes calculating the following features from the data probability distribution: skewness; a measure of the asymmetry of the data around the mean, kurtosis; a measure of the peakedness of the distribution, and standard deviation (dispersion). The images are divided into tiles of 30×30 pixels overlapping by 15 pixels [39,40] and the three statistical features are calculated for each tile. Finally, the processed images are mapped and displayed.

The performance of the proposed S-PSO approach has been compared with those of two alternative approaches based on morphological operations. These morphological algorithms also require some parameters and assumptions. The minimum and maximum endothelial cell areas are initialised at the beginning to speed up the process, they are set to be 10μm2 and 10.8mm2 respectively. These limiting values used by the algorithms are in compliance with the physiological characteristics of the cells. The input image resolution is 768×576 pixel, and the size of each pixel is 0.6μm.

The first algorithm is implemented in MATLAB. It starts by taking as input the preliminary image obtained from the watershed algorithm. Then Otsu's global threshold method [38] based on grey-level histograms is applied on the input image to get a binary map of all the closed areas. The next step employs a region boundary tracing function. We adopted the Moore-Neighbour tracing implementation modified by Jacob's stopping criteria presented in [41]. The boundary function traces all the boundaries in the preliminary cell segmentation image. By using an 8-connected neighbourhood definition, exterior cell contours are constructed and verified according to the physical endothelial cell characteristics. The extracted cells will have an area within the predefined range (10μm2 and 10.8mm2), and should not be at the edges of the image. These edge cells are normally only partial cells and hence excluding them from the statistical calculations increases the accuracy of the results. The parameter margin is set to 10 pixels, and any detected cell partially covering this area will be ignored.

The second morphological algorithm, also implemented in MATLAB, is similar to the first one but takes the centres of each cell as additional information. Again, the extracted cells should have an area within the predefined range (10μm2 and 10.8mm2) and the parameter margin is set to 10 pixels.

The image acquisition instrument was a ConfoScan 4 confocal microscope (Nidek Technologies, Padova, Italy). Generally, the corneal layers, epithelium (thickness of 50μm), stroma (thickness of 400μm), and endothelium (thickness 30μm), are clearly visible using this microscope. These data sets consist of 3 sequences of respectively 85, 127, and 144 images from epithelium layer to endothelium taken from 3 patients by the confocal microscope. All these images were acquired with a Z ring installed, so they are in the correct order despite movement of the patient during scanning. The inspected field is of size 460×345μm at 40× magnification. The acquired grayscale images are in JPEG compressed format and of size 768×576 pixel [42,43]. The three systems have also been tested on three abnormal images subject to Fuchs’ dystrophy, advanced Fuchs’ disease and PPCD. These grayscale images are also in JPEG compressed format, and of size 760×560 pixel.

@&#RESULTS AND ANALYSIS@&#

The developed approach has been tested on three data sets containing endothelium images, these data sets are categorised as normal and should have endothelial cell densities in the established range, for adults, between 2400 and 3200cells/mm2 
                     [44,45]. The first data set has five endothelium images, the other data sets have three endothelium images each. Fig. 7
                      shows, on the right, the superimposition of preliminary segmentation results on the original image. A magnified view of a ROI, is shown on the left, illustrating the start of the process of extracting cell contours, with the green dot depicting the initial snake within one sample cell.

The S-PSO starts from the initial seed until it converges to the complete cell shape, Fig. 8
                         shows the evolution of an initial contour. The approach has been tested on the available 11 healthy and three diseased endothelium images. Clinically useful information has been extracted from these images, which could help the ophthalmologist in the clinical diagnosis. Table 1
                         shows the number of the identified cells (IC), the number of detected unique cells (UC), the cell density (CD) in cell/mm2 calculated using Eq. (7), the cell density obtained manually (MCD), the percentage error (E), which is calculated using Eq. (9), and the difference of the calculated cell density (DNR) from the cell density range of a normal adult. This is shown as zero if CD is within the range 2400cells/mm2 to 3200cells/mm2 and 2400-CD otherwise.
                           
                              (7)
                              
                                 
                                    CD
                                    =
                                    
                                       
                                          UC
                                       
                                       A
                                    
                                 
                              
                           
                        
                        
                           
                              (8)
                              
                                 
                                    A
                                    =
                                    x
                                    *
                                    y
                                 
                              
                           
                        
                        
                           
                              (9)
                              
                                 
                                    E
                                    =
                                    
                                       
                                          MCD
                                          −
                                          CD
                                       
                                       
                                          MCD
                                       
                                    
                                    *
                                    100
                                 
                              
                           
                        
                     

Here A is the image area and x and y are the image dimensions. The processed endothelium images have a CD within the normal expected range except one image from the first subject. The processed images are from normal three subjects which their CD is expected to be within the normal range. The average difference (error) between manual and automatic S-PSO densities is 5.3%, ranging from a minimum of about 1% to a maximum of about 12%. All the processed endothelium images have a CD within the expected normal range except for one image from the first subject. The manual and automatic results for this exceptional case agree within about 3%, which is similar to other cases.

The minimum, maximum and average cell areas have also been calculated after detecting the cells using the S-PSO. The results of these values are shown in Table 2
                        .There might be some cells which due to poor illumination in the image are counted more than once. To overcome this problem and correct most of the false cell detections, we cross-reference the detected cell contours with the estimated cell centres. Fig. 9a shows portions of cells shown with arrow which are incorrectly counted as cells. Fig. 9b shows the cell centre estimations obtained after cell cross-references with cell centre data shown with yellow dots. Incorrectly detected cells without cell centres are not counted. This eliminates multiple-counting of the cells and improves the accuracy of the statistical measures.

The morphological approaches were also tested on all the endothelium images, and their performances compared with the S-PSO approach. The IC, UC, CD, MCD, E and DNR values obtained using the first morphological approach (MO1) are reported in Table 3
                        . The cell densities of five images out of eleven were outside the normal range compared with one with the manual measurements and one with the S-PSO analysis. The average difference (E) between the first morphological and the manual approaches is 7.0%. Results from the second morphological approach (MO2) tested on all the endothelium images are reported in Table 4
                        . The cell densities of six images out of eleven are outside of the normal range compared with one with manual measurement and one with S-PSO analysis. The average difference (error) between manual and automatic densities calculated using MO1 and MO2 are 7% and 13% respectively compared with 5.3% using S-PSO.

The minimum, maximum and average cell areas were calculated after detecting the cells using the MO1 and MO2 approaches, and compared with the ones obtained from the S-PSO approach. Fig. 10
                         shows a comparison of the average cell areas from the three approaches. The normal range of the average endothelial cell area is 285–545μm2 
                        [46]. The results obtained from the S-PSO approach are all within the normal range, but the MO1 and MO2 approaches gave four images and two images, respectively outside the normal range. The minimum and maximum cell areas calculated through the three approaches are presented in Figs. 11
                         and 12
                         respectively, for all the processed endothelium (EN) images.

The three approaches have been tested on three abnormal endothelium images displaying symptoms of Fuchs’ disease (FD), advanced Fuchs’ disease (AFD) and PPCD. The IC, UC, CD, and DNR values obtained for these images using the three approaches are shown in Table 5
                         and as expected the cell densities are far from the normal range, and lower cell densities are obtained with the AFD compared with the FD disease. As Fuchs’ disease is a degenerative disease causing the corneal endothelial cells to gradually die, leading to corneal oedema and loss of clarity of the cornea, it also leads to changes in the endothelial cell shapes and structures. For the PPCD high error value of 25% is obtained from the four large spots present in the field of view, because in the case of the S-PSO these outer spots boundaries are correctly identified but one spot is split into two because it contains a lighter band and this is the major cause of the error. The larger values of E yielded by the morphological approaches are due to more varied sources of error, compared with S-PSO, in the detection of these spots.

The S-PSO approach performed consistently better than the two morphological based approaches in terms of agreeing with the corresponding manual results for the eleven healthy endothelium images. For the two of the abnormal images, Table 5 shows the first morphological approach gives the smallest difference from the manual results while the S-PSO and second morphological approach have poorer agreement, but for the third abnormal image the S-PSO result is clearly the best. To further highlight differences between the healthy and abnormal endothelium images further analysis was carried out on the processed images by calculating skewness, kurtosis, and dispersion. The normal images generated 1850 data points and the abnormal images generated 1764 points, after dividing the image into tiles of 30×30 pixels. The three statistical features were calculated for all the tiles and each individual tile represented as a point in the multi-dimensional space of distribution moments. The average value of the kurtosis for the data without disease was 2.8, which is close to the value 3 which corresponds to a normal distribution, while, the average value of the kurtosis for the abnormal data was 3.9. Figs. 13 and 14
                        
                         display the values of kurtosis, skewness and dispersion for each point of the healthy and AFD diseased data respectively and these features give an additional indication of the status of the processed images as well as the normal distribution of the cells in these images. The skewness for the healthy data set is distributed on the positive side of the drawing skewness axis, while part of the diseased data is on the negative side of this axis as in Figs. 13 and 14 respectively. The points in Fig. 14 have a larger dispersion than those in Fig. 13, with a lot of negative skewness values. The biggest kurtosis values for the healthy and diseased data are 7.0 and 44.7, respectively and the difference in these values reflects the big change in the nature of the data from the normal to the abnormal caused by the disease.

The proposed S-PSO approach has outperformed the other two approaches in terms of detecting the healthy endothelium cells, CD, cell average area, minimum cell area, and maximum cell area. The CD for one image out of all the processed endothelium images was below the normal range with an error of 11.5% for this image, the same for manual measurement. This percentage error is calculated as follows:
                           
                              (10)
                              
                                 
                                    error
                                     
                                    %
                                    =
                                    
                                       
                                          
                                             
                                                CD
                                                −
                                                normal value
                                             
                                             
                                                normal value
                                             
                                          
                                       
                                    
                                    *
                                    100
                                 
                              
                           
                        
                     

The equivalent errors calculating using the MO1 and MO2 were higher at 21% and 23% respectively.

Following discussions with a clinical expert, the cell density status of endothelium images is highlighted by the system using colour as illustrated in Fig. 15
                        .
                           
                              -
                              Blue for cell densities lower than the normal range, below 2400cells/mm2.

Yellow for cell densities near the beginning of the normal range, between 2400 and 2600cells/mm2.

Green for cell densities near the middle of the normal range, between 2600 and 3000cells/mm2.

Orange for cell densities near the end of the normal range, between 3000 and 3200cells/mm2.

Red for cell densities higher than the normal range, above 3200cells/mm2.

@&#CONCLUSIONS@&#

This research work concerns use of confocal microscopy, which acquires a large number of corneal images from a single patient and provides detailed images of the different layers inside the cornea. This work described here will be part of a larger system to process and analysis images of all the main layers of the cornea. It excludes redundant images from the processed corneal sequence, enhances the quality of the remaining images, and reduces the noise significantly before subsequent analysis. The main objective of the research presented here is developing a robust system to accurately analyse images of endothelial cells and extract the clinically useful information to help an ophthalmologist diagnose the cornea more rapidly. Having individual cell profiles makes it possible to calculate various features and obtain precise data about cells and improve accuracy of statistical measures.

This research proposed an S-PSO approach and evaluates its performance against manual measurements and two morphological based approaches. The S-PSO approach uses a novel hybrid algorithm based on a snake model and particle swarm optimisation to extract cell contours. Reliable results have been obtained through this approach. Detailed results from the proposed approaches have been presented and discussed earlier. The system is also able to calculate the number of endothelial cells, average, minimum and maximum cell area. For the eleven healthy endothelium images from three subjects, the average differences in cell densities between the S-PSO and Morphological 1 and 2 approaches compared with manual measurements were 5.3%, 7.0% and 13% respectively.

The system was also tested and on three abnormal endothelium images displaying symptoms of Fuch's disease, advanced Fuch's disease and posterior polymorphous corneal dystrophy. Differences between the healthy and abnormal images were clearly visible in statistical plots of skewness and kurtosis against standard deviation for all the extracted tiles from the processed images. In the case of PPSD, the number of spots detected is found to be completely different from the healthy range. The system developed can be used as a helpful platform to accurately recognise endothelium cells and extract the clinically useful information for normal and disease associated images. The processed outputs of the developed system are highlighted in colour to draw the ophthalmologist attention if any abnormal cell density is detected.

The next stage in this research is to build a complete system capable of analysing the three main layers (epithelium, stroma and endothelium), extracting and analysing the disease features associated with each of these layers which would be clinically useful, supporting the work of ophthalmologists and saving the clinician time, hence improving patient care in a busy clinical setting.

@&#ACKNOWLEDGEMENTS@&#

This project is funded by the NHS National Innovation Centre and the University of Bradford. The authors would like to thank Manchester Biomedical Research Centre and the Greater Manchester Comprehensive Local Research Network, Manchester.


                     
                        
                           
                              
                              
                              
                              
                              
                              
                                 
                                    Ref
                                    Approach
                                    Special features
                                    Limitations
                                    Microscope
                                 
                              
                              
                                 
                                    
                                       [14]
                                    
                                    Provides a method to derive endothelium cell density
                                    The method works without identifying the cell contours as most other techniques do
                                    The method does not take into account that cell shape is not always regular
                                    Inverse phase contrast microscope
                                 
                                 
                                    
                                       [15]
                                    
                                    Presents a software tool that uses an analogue cellular neural network (CNN) algorithm for real-time automated image morphometry of the human corneal endothelium
                                    It allows both cell density determination and endothelial cell area measurement
                                    It uses a fixed-size mask. Moreover, the final images need more processing and analysis
                                    Specular microscope
                                 
                                 
                                    
                                       [16]
                                    
                                    Proposes endothelial cell density analysis based on Fourier transformation of the images
                                    The system is claimed to be robust
                                    It has sensitive performance to out of focus images. Only good quality images were used. Endothelial cells size was not determined
                                    Inverse phase contrast microscope
                                 
                                 
                                    
                                       [17]
                                    
                                    Develops a system for extracting an estimate for the endothelial cells density from the spatial frequency information in the image
                                    The developed system shows good performance for cell density calculations
                                    It does not take in account the cell morphology
                                    Optical microscopy
                                 
                                 
                                    
                                       [18]
                                    
                                    Develops an algorithm that includes a first segmentation module based on a neural network structure, and a second “expert correction” module based on a multi-step approach, which includes missing contour recovery
                                    The developed algorithm is able to count cells and determine cell density
                                    This system is completely dependent on the expert correction
                                    Optical microscopy
                                 
                                 
                                    
                                       [19]
                                    
                                    Proposes a method for segmenting corneal endothelial tissue in grey-scale images
                                    It uses a morphological dome extractor
                                    The established cell network is homogenously constituted as a uniform cellular tissue that has sufficient edge contrast
                                    Specular microscope
                                 
                                 
                                    
                                       [20]
                                    
                                    Develops a tool for measuring endothelial cell density, performing morphometry on multiple zones of three images of the endothelial mosaic
                                    The proposed method tries to mimic the human vision perception by detecting the borders of the cells
                                    The system produces significant overestimation and high standard deviation, and does not work correctly in cases of poor acquisition such as bad conditions of lighting
                                    Optical microscopy
                                 
                                 
                                    
                                       [21]
                                    
                                    Proposes a method for endothelial cell segmentation, which can be applied to images that have different statistics in different regions. The method prepares two types of nodes that were optimised using genetic programming (GP)
                                    The proposed method can assign different processing tailored to the statistics of the input images
                                    It is frequently difficult for the proposed method to construct high accuracy tree-structural filter
                                    Phase-contrast microscope
                                 
                                 
                                    
                                       [22]
                                    
                                    Proposes a new method for detection and analysis of cell fields in images of corneal endothelium
                                    The proposed system is able to integrate a statistical description of shape features of corneal endothelial cell field
                                    There is often a need to require operator interaction to correct errors, and the proposed systems has not been able to obtain a reliable estimation of quantitative indexes without tedious and time-consuming manual editing
                                    Specular microscope
                                 
                              
                           
                        
                     
                  

@&#REFERENCES@&#

