@&#MAIN-TITLE@&#Free-form image registration regularized by a statistical shape model: application to organ segmentation in cervical MR

@&#HIGHLIGHTS@&#


               
               
                  
                     
                        
                           
                           We propose a registration scheme that is enhanced by a statistical model.


                        
                        
                           
                           Registration is performed on MR images of 17 patients with cervical cancer.


                        
                        
                           
                           Compared to conventional registration segmentation of the evaluated structure is improved.


                        
                     
                  
               
            

@&#KEYPHRASES@&#

Inter-subject

Regularization

Abdomen

Shape model

Registration

@&#ABSTRACT@&#


               
               
                  Deformable registration is prone to errors when it involves large and complex deformations, since the procedure can easily end up in a local minimum. To reduce the number of local minima, and thus the risk of misalignment, regularization terms based on prior knowledge can be incorporated in registration. We propose a regularization term that is based on statistical knowledge of the deformations that are to be expected. A statistical model, trained on the shapes of a set of segmentations, is integrated as a penalty term in a free-form registration framework. For the evaluation of our approach, we perform inter-patient registration of MR images, which were acquired for planning of radiation therapy of cervical cancer. The manual delineations of structures such as the bladder and the clinical target volume are available. For both structures, leave-one-patient-out registration experiments were performed. The propagated atlas segmentations were compared to the manual target segmentations by Dice similarity and Hausdorff distance. Compared with registration without the use of statistical knowledge, the segmentations were significantly improved, by 0.1 in Dice similarity and by 8mm Hausdorff distance on average for both structures.
               
            

@&#INTRODUCTION@&#

Many medical imaging applications rely on deformable registration [1]. Deformable registration is a complicated task when it involves large and complex deformation. Registration schemes that have to deal with such deformations generally require a transformation model with a very large number of parameters. The downside of this high number of degrees of freedom is that the registration procedure can easily end up in a local minimum. For instance, the registration process may advance to a local minimum when an edge aligns to an edge of a neighboring structure. In case of complex deformations, even coarse-to-fine approaches may not suffice.

Incorporation of prior knowledge of deformation into registration is a way of regularizing the optimization procedure and reducing local minima. This is a well-known approach and it is applied in many situations; a number of these will be discussed. The prior knowledge that is used by Brock et al. [2] comprises physical properties of the tissue, whereas Pennec et al. [3] regularize with statistics on the physical strain tensors within one registration. These approaches are used for intra-subject registrations, but may not be valid for inter-subject registrations, since the transformation of one person to another is not a physical one.

Rueckert et al. [4] use statistical deformation models (SDMs) that model all the control points of the underlying B-spline deformation grid in a statistical way. A similar approach was taken by Loeckx et al. [5], who limit deformations to the space spanned by a trained deformation model. However, this means that a target deformation that deviates from the spanned space cannot be reached by registration, even if the image data provide enough evidence. To avoid this effect, Xue et al. [6] perform registration where statistical regularization is applied in a separate step. An integrated formulation is presented by Albrecht et al. [7], with the model used as a soft constraint in registration. To not restrict the target deformation space spanned by the training data, the span of the model is increased to all the degrees of freedom of the transformation, by the regularization method called shrinkage estimation. However, only registration examples of 2D images are shown.

Rueckert et al. [4], Loeckx et al. [5], Xue et al. [6] model all displacement vectors in the image. These displacement vectors can only be obtained if a (registration) method is available that establishes correct displacement vectors for the example images. Alternatively, as is done by Albrecht et al. [7], the displacement vectors can be obtained by registering example segmentations. In the latter approach the resulting displacement vectors only carry meaningful information at the boundaries of the segmentation. All other displacement vectors in the image are based on the deformation regularization used, but will still be used for training purposes.

We chose to stay close to the idea of statistical shape models (SSMs) that model only the boundary surface displacements. Heimann and Meinzer [8] give a thorough overview of the variety of SSMs that have been proposed. The key approach of SSMs (which has inspired the development of SDMs) is a reduction of the number of degrees of freedom of the transformation model in order to span only those modes of variation that are common in a training set. This resulting transformation model is used to generate shape instances in an optimization procedure to find the optimal mapping. Again, the restriction of the degrees of freedom can be a disadvantage in finding an accurate mapping [9].

The registration framework we propose consists of a B-spline deformation model that has many degrees of freedom, but with prior shape knowledge, in the form of an SSM, acting as a soft constraint during optimization. Compared with Albrecht et al. [7] the trained model is more compact and computationally attractive.

To assess registration quality, we will evaluate segmentations obtained from atlas-based segmentation of cervical MR images. The images are acquired for external-beam radiation therapy for cervical cancer. In this treatment the target volume should receive a high dose, while the neighboring organs should receive a dose as low as possible. For the treatment planning of cervical cancer, manual segmentations are made for the clinical target volume, bladder, rectum, sigmoid and bowel in our medical center. In our study, the manual segmentations of the clinical target volume and bladder are used for atlas-based segmentation. In atlas-based segmentation, registration is used to find the topological relation between the target image and an atlas image. This topological relation is used to propagate the segmentations of the atlas to the target.

Intra-patient registration of cervical images, using contrast-enhanced CT images [10] and MR images [11] has been reported, however inter-patient registration is not described in literature. The large and complex deformations due to differences in rectum and bladder fillings, the cervical position as well as sliding organ interfaces make these registrations a challenging task. Additionally, in our institute, the MR images for cervical cancer treatment are highly anisotropic with thick transversal slices.

Our goal is to improve inter-patient registration with application to cervical images. Registration quality is measured in terms of segmentation overlap and surface distance.

@&#METHOD@&#

The method is set up in the general context of organ segmentation in medical images. However, some choices depended on the imaging data available. Therefore the data is described first. Then, the registration framework chosen for this application and how prior shape knowledge can be incorporated is explained. Subsequently the statistical model that captures the shape knowledge is described. Finally, the expression for the actual penalty term is derived.

The data used in this paper consists of 84 T2-weighted MR images of 17 patients that underwent radiation therapy for cervical cancer. Five images are available for each patient, acquired in five consecutive weeks, except for one patient who was scanned four times. In the first week a CT scan was also made for each patient.

The MR images were acquired with a 1.5T scanner (Gyroscan NT Intera; Philips Medical Systems, Best, The Netherlands), in the transversal direction. The image dimensions are 512×512×30voxels, with a voxel size of 0.625mm×0.625mm×4.5mm. The CT images (Aura; Philips Medical Systems, Best, The Netherlands) have a dimension of 512×512×118voxels. The voxel size is 0.885mm×0.885mm×3mm.

The manual delineations of the bladder and the clinical target volume for each MR image are used in this study. The clinical target volume is defined as the primary tumor, the uterus, the parametria, the cervix, and a part of the vagina, depending on tumor position. The delineations were made for clinical purposes by a radiation oncologist and reviewed by a radiologist. The rigid transform parameters that map MR coordinates to CT, which were used in the clinic, were provided. Fig. 1
                         shows examples of the MR images.

In order to propagate the segmentations of a reference image I
                        ref to another subject image I
                        target a spatial transformation 
                           T
                         that relates both images is obtained by registration. This transformation is defined as 
                           T
                        (x): Ω
                        
                           ref
                        
                        ↦
                        Ω
                        
                           target
                        , which maps one image domain to the other, where an image is defined as 
                           
                              I
                              (
                              x
                              )
                              :
                              Ω
                              ⊂
                              
                                 
                                    R
                                 
                                 
                                    3
                                 
                              
                              
                              ↦
                              
                              R
                           
                        .

For our application we initialize the transformation by alignment of bony structures in the field of view, since these provide a natural reference frame for the abdominal region in which the relevant organs are located. The global transform 
                           T
                        
                        global captures the alignment in location, orientation and scale, as well as the coarse deformation of bony structures between the two patients. The transform 
                           T
                        
                        local accounts for the complex organ deformations within the abdominal region. Accordingly, the transformation 
                           T
                         is written as a (functional) composition of two parts: 
                           T
                        
                        =
                        
                           T
                        
                        global
                        ∘
                        
                           T
                        
                        local. The organ model we present in this paper will affect the local transform by acting as a regularizing penalty term in the registration process. The penalty term is based on a point distribution model [12] that acts on the vertices of the reference delineation and statistically describes the variations of deformations of the organ boundary in the sample population. The statistical model and the penalty term are described in more detail in the next Sections 2.3 and 2.4. Since we use a B-spline transformation, which has no explicit inverse, we define the transformation of coordinates in the reference image as the transform 
                           T
                        
                        local. This implies that a target image is warped to the reference image during registration.

Since both CT and MR images are available for each patient, we choose to base the global transformation on bony structures visible in the CT images. For this transform inter-patient CT to CT registrations are performed, consisting of an affine and a coarse B-spline transform with a grid spacing of 80mm. Because of the absolute nature of CT intensity values, a sum of squared differences is used as image similarity measure. The preprocessing of extracting bony structures is done by thresholding the image to select dense (i.e. intense) bone tissue and applying morphological operations to select the surrounding bone tissue that is less dense. The voxels in the CT image that are outside this selection are set to zero in Hounsfield units. This is approximately the value of the tissue that directly surrounds the bones.

Given this CT based inter-patient transformation, the global transformation between MR images of two patients is the composition of respectively a rigid intra-patient (MR to CT), an affine+deformable inter-patient (CT to CT) and an intra-patient rigid (CT to MR) transform:
                           
                              (1)
                              
                                 
                                    
                                       T
                                    
                                    
                                       global
                                    
                                 
                                 =
                                 
                                    
                                       T
                                    
                                    
                                       target
                                    
                                    
                                       -
                                       1
                                       
                                       rigid
                                    
                                 
                                 ∘
                                 
                                    
                                       T
                                    
                                    
                                       inter-patient
                                    
                                    
                                       affine
                                       +
                                       deformable
                                    
                                 
                                 ∘
                                 
                                    
                                       T
                                    
                                    
                                       ref
                                    
                                    
                                       rigid
                                    
                                 
                              
                           
                        
                     

Because the statistical model is defined in the coordinate system of the reference image, the target I
                        target is transformed to the reference space using 
                           T
                        
                        global, resulting in 
                           
                              
                                 
                                    I
                                 
                                 
                                    target
                                 
                                 
                                    ′
                                 
                              
                           
                        . The residual transform between 
                           
                              
                                 
                                    I
                                 
                                 
                                    target
                                 
                                 
                                    ′
                                 
                              
                           
                         and I
                        ref is called 
                           T
                        
                        local. For the remainder of this paper 
                           T
                        
                        local is denoted by 
                           T
                        
                        
                           
                              μ
                           
                        , with 
                           μ
                         the vector of B-spline parameters that defines the local transformation.

The registration procedure that is used to find this transformation can be expressed as a minimization of a cost function 
                           
                              C
                           
                        :
                           
                              (2)
                              
                                 
                                    
                                       μ
                                    
                                    
                                       ˆ
                                    
                                 
                                 =
                                 arg
                                 
                                    
                                       
                                          min
                                       
                                       
                                          μ
                                       
                                    
                                 
                                 
                                 C
                                 
                                    
                                       
                                          
                                             
                                                T
                                             
                                             
                                                μ
                                             
                                          
                                          ;
                                          
                                             
                                                I
                                             
                                             
                                                ref
                                             
                                          
                                          ,
                                          
                                             
                                                I
                                             
                                             
                                                target
                                             
                                             
                                                ′
                                             
                                          
                                       
                                    
                                 
                                 ,
                              
                           
                        with the cost function in this registration scheme consisting of an image similarity measure 
                           
                              S
                           
                         and penalty function 
                           
                              P
                           
                        :
                           
                              (3)
                              
                                 C
                                 =
                                 -
                                 S
                                 +
                                 α
                                 P
                                 .
                              
                           
                        
                     

For the similarity measure we use normalized cross correlation, but other measures could be employed as well. The penalty term is defined by the statistical model, which is explained in the next subsections. A weighting factor α is used to balance the two terms.

The model is based on a point distribution model [12] that is made from a population of surface meshes. The model captures the variations in shape and position of the meshes in this population. Point correspondence of the meshes is obtained in a way similar to [13]. For this purpose, the delineation in the reference image is converted into a surface mesh. The population of meshes is obtained from the set of atlas delineations. By registering all binary images of the atlas delineations to the binary image of the reference, transformations are established that are used to generate a population of atlas meshes from the reference mesh. For this registration a kappa statistics metric is used, which maximizes overlap of binary images. The transformation model is a 3-level pyramid of B-splines with a grid spacing schedule of 40–20–10mm.

A mesh consisting of N 3-D vertices m
                        ={x
                        
                           i
                        
                        =[x
                        1i
                        ,
                        x
                        2i
                        ,
                        x
                        3i
                        ]:i
                        =1,…,
                        N} is represented as a concatenation of vertex coordinates:
                           
                              (4)
                              
                                 p
                                 =
                                 
                                    
                                       [
                                       
                                          
                                             x
                                          
                                          
                                             11
                                          
                                       
                                       ,
                                       
                                          
                                             x
                                          
                                          
                                             21
                                          
                                       
                                       ,
                                       
                                          
                                             x
                                          
                                          
                                             31
                                          
                                       
                                       ,
                                       …
                                       ,
                                       
                                          
                                             x
                                          
                                          
                                             1
                                             N
                                          
                                       
                                       ,
                                       
                                          
                                             x
                                          
                                          
                                             2
                                             N
                                          
                                       
                                       ,
                                       
                                          
                                             x
                                          
                                          
                                             3
                                             N
                                          
                                       
                                       ]
                                    
                                    
                                       T
                                    
                                 
                                 .
                              
                           
                        
                     

The space of all atlas shape vectors is characterized by a multivariate normal distribution defined by its mean 
                           
                              
                                 
                                    
                                       
                                          p
                                       
                                       
                                          ¯
                                       
                                    
                                 
                                 
                                    atlas
                                 
                              
                           
                         and covariance Σ. The mean and the covariance of the distribution are estimated by the arithmetic mean and the sample covariance.

When the number of vectors is smaller than the dimensionality of these vectors, this distribution is supported only in a subspace of possible shapes. To compute the penalty for an arbitrarily deformed reference shape, the inverse of the covariance matrix is needed, which does not exist in these cases. We circumvent this inversion problem by a covariance regularization technique called shrinkage estimation, as in [7]. The regularized covariance matrix Σ′ is a linear combination of the estimated covariance matrix and a diagonal matrix:
                           
                              (5)
                              
                                 
                                    
                                       Σ
                                    
                                    
                                       ′
                                    
                                 
                                 =
                                 (
                                 1
                                 -
                                 β
                                 )
                                 Σ
                                 +
                                 β
                                 
                                    
                                       σ
                                    
                                    
                                       0
                                    
                                    
                                       2
                                    
                                 
                                 I,
                              
                           
                        with 0<
                        β
                        ⩽1 the shrinkage intensity and 
                           
                              
                                 
                                    σ
                                 
                                 
                                    0
                                 
                                 
                                    2
                                 
                              
                           
                         an assumed variance. By this manipulation, the multivariate normal distribution will have a variance of at least 
                           
                              β
                              
                                 
                                    σ
                                 
                                 
                                    0
                                 
                                 
                                    2
                                 
                              
                           
                         in all directions. The matrix 
                           
                              
                                 
                                    σ
                                 
                                 
                                    0
                                 
                                 
                                    2
                                 
                              
                              I
                           
                         is the assumed covariance matrix that defines the normal distribution if there was no knowledge available, except for the mean 
                           
                              
                                 
                                    
                                       
                                          p
                                       
                                       
                                          ¯
                                       
                                    
                                 
                                 
                                    atlas
                                 
                              
                           
                        . If the number of samples is large enough to have a reliable estimate, the shrinkage intensity should approach zero.

With the estimated distribution, deformations of the reference mesh p
                        ref can be evaluated by means of the Mahalanobis distance, which is used as the penalty term during the registration. The penalty value can be interpreted as a measure of distance of the deformed reference mesh to the mean mesh, but with modes of deformation that are common in the population regarded as less distant.

Many free-form registration methods that rely on B-spline based deformations use gradient-based optimizers for speed and efficiency [4,14–16]. Consequently, the derivatives of the penalty term with respect to the transform parameters are required. For the analytical derivative of the penalty function, the Mahalanobis distance to the mean of the distribution is expressed as a function of the transform parameters. First, the mean mesh vector is subtracted from the transformed mesh vector
                           
                              (6)
                              
                                 p
                                 (
                                 μ
                                 )
                                 =
                                 
                                    
                                       T
                                    
                                    
                                       μ
                                    
                                 
                                 (
                                 
                                    
                                       p
                                    
                                    
                                       ref
                                    
                                 
                                 )
                                 -
                                 
                                    
                                       
                                          
                                             p
                                          
                                          
                                             ¯
                                          
                                       
                                    
                                    
                                       atlas
                                    
                                 
                                 ,
                              
                           
                        with 
                           T
                        
                        
                           
                              μ
                           
                        (p
                        ref) the concatenated vector representation of the coordinates of each transformed element of the set m
                        ref that constitutes p
                        ref. The difference mesh vector p(
                           μ
                        ) is now a function of the transform parameters. By including the difference vector, the Mahalanobis distance can be expressed as:
                           
                              (7)
                              
                                 M
                                 (
                                 μ
                                 )
                                 =
                                 
                                    
                                       
                                          
                                             p
                                          
                                          
                                             T
                                          
                                       
                                       (
                                       μ
                                       )
                                       
                                          
                                             Σ
                                          
                                          
                                             ′
                                             -
                                             1
                                          
                                       
                                       p
                                       (
                                       μ
                                       )
                                    
                                 
                                 .
                              
                           
                        
                     

The partial derivatives with respect to the transform parameters are:
                           
                              (8)
                              
                                 
                                    
                                       ∂
                                       M
                                    
                                    
                                       ∂
                                       μ
                                    
                                 
                                 =
                                 
                                    
                                       1
                                    
                                    
                                       M
                                    
                                 
                                 
                                    
                                       p
                                    
                                    
                                       T
                                    
                                 
                                 (
                                 μ
                                 )
                                 
                                    
                                       Σ
                                    
                                    
                                       ′
                                       -
                                       1
                                    
                                 
                                 
                                    
                                       ∂
                                       p
                                       (
                                       μ
                                       )
                                    
                                    
                                       ∂
                                       μ
                                    
                                 
                              
                           
                        
                     

From Eq. (6), it follows that 
                           
                              
                                 
                                    ∂
                                    p
                                    (
                                    μ
                                    )
                                 
                                 
                                    ∂
                                    μ
                                 
                              
                              =
                              
                                 
                                    ∂
                                    T
                                 
                                 
                                    ∂
                                    μ
                                 
                              
                              (
                              
                                 
                                    p
                                 
                                 
                                    ref
                                 
                              
                              )
                           
                        , which are the derivatives of the displacements of the vertex coordinates with respect to the B-spline transform parameters. These derivatives are described in [14].

@&#EXPERIMENTS@&#

The model as described in this paper was implemented as a module in elastix version 4.6 [17]. The method is evaluated on segmentation of two structures, i.e. the bladder and the clinical target volume, which were treated as independent registration experiments. Registration is restricted to a masked area of the reference image, with the mask created from the manual delineation of the structure with an extra margin of 4.5mm (i.e. the height of one voxel) in all directions.

The quality of registration is measured both by the Dice similarity coefficient (DSC) and the Hausdorff distance of the propagated reference delineation and the manual segmentation in the target image. The Hausdorff distance from surface A to surface B is the maximum distance of the set of points on A to the nearest point on B. We use the Hausdorff distance between two surfaces, i.e. the maximum of the distances of A to B and B to A. A propagated delineation of the target image is obtained by applying the local and global transform to the vertices of the reference mesh. The reference mesh, used for this purpose, is a densely triangulated version of the original reference delineation and typically consists of over 3000 vertices. This triangulated mesh can sufficiently represent non-linear deformations of the delineation.

The baseline of each experiment is a so-called conventional registration, which does not use the model. In order to keep the experiments comparable to the baseline, the parameters settings that were tuned to the conventional registrations are also used for model-enhanced registration (except for the model parameters). Both types of registration share the same global transformation based on bony anatomy.

Wilcoxon signed-rank tests for paired samples were performed on both the Dice scores and the Hausdorff distance of conventional and model-enhanced registrations. These tests show whether there is a significant difference in quality scores of both registration methods, with p
                     <0.05 regarded as significant and p
                     <0.01 as highly significant.

For all experiments, normalized cross-correlation was used as image similarity measure in local registration. The transformation was parameterized with a 3-level pyramid of cubic B-splines with a grid spacing schedule of 40–20–10mm. The adaptive stochastic gradient descent optimizer [18] was used with 5000 randomly selected samples for 300 iterations each level.

A number of model parameters were determined empirically, solely based on experiments on the bladder. We found the resulting parameters suitable to perform an evaluation on the CTV as well.

To avoid biases in the experiments on the bladder, two sets of experiments were set up: one for parameter selection and one for evaluation. For these experiments two groups of data were made, one containing the first-week MR image of each patient and one that contained the final-week MR image of each patient. However, the atlas meshes used for training purposes were generated from all available images of all patients. In order to exclude intra-patient influence in the leave-one-out experiments, all five meshes of the target patient were excluded.

The parameters introduced are the weight factor α, which is the influence of the model in the cost function with respect to the image similarity and model regularization parameters 
                           
                              
                                 
                                    σ
                                 
                                 
                                    0
                                 
                                 
                                    2
                                 
                              
                           
                         and β.

If no knowledge would be available about the shape variations of the bladder, we assume a normal distribution with uniform variance of 
                           
                              
                                 
                                    σ
                                 
                                 
                                    0
                                 
                                 
                                    2
                                 
                              
                              =
                              1000
                           
                         around the mean shape for the position of vertices in the population. This means that each vertex has a spread with a standard deviation of about 3cm. The shrinkage intensity is set to β
                        =0.2, which means that we rely on the training data for 80% and for 20% on the uniform variance assumption. In our experience with bladder registration, the method is not very sensitive to this parameter. By generating all references meshes with 81 vertices the shape characteristics of the bladders could be captured well enough, while the computational cost of using this number of vertices during registration is kept reasonably low.

As registration progresses, generally the model becomes less relevant. Therefore we decreased the model’s influence on registration, in a step-wise fashion, by decreasing the weight α in the cost function. The registration process was divided into a pyramid of resolutions and a constant weight for each resolution was chosen.

The choice for the separate weighting values was experimentally determined as follows. Based on compactness [19] of the bladder shapes we ranked the data and chose one image of the upper and one of the lower half. The compactness measure separates sphere-like shapes from shapes that are for instance ellipsoidal or more complexly curved, by a ratio of surface area and volume. By selecting on compactness we have a good representation for the shape population. These two atlas images were registered to all other targets, where three-level weight sequences were evaluated with values ranging from 0.11 to 0.01 in steps of 0.02. There was no setting for the weights that showed an optimum for both atlases, but the weight sequence 0.09–0.07–0.05 was chosen as a compromise.

Additionally, it was investigated whether the model restricted registration too much. Possibly the optimal deformation is not captured by the model and the registration result might improve by allowing an iteration without the penalty term. Therefore model-enhanced registrations were performed that were followed by a conventional registration at each resolution level. This registration, with weight sequence 0.09–0–0.07–0–0.05–0, was compared to a model-enhanced registration with 0.09–0.07–0.05 as weight sequence. When each registration level was extended in this way by another 300 iterations, a small improvement of 0.0048 mean DSC was obtained. Since this small improvement could also be addressed to a larger total number of iterations, experiments where both registration parts were set to 150 iterations per level were also performed. Because no significant improvement was found anymore, it was concluded that the chosen weight sequence 0.09–0.07–0.05 was not restricting the registration process and that is was a suitable choice for the evaluation experiments.

For evaluation of the method, experiments were performed using the bladder and the CTV. The experiments with the bladder were done with MR images of the final week and experiments with the CTV were conducted using the first-week images. For each structure, the images of all 17 patients were registered to each other. For each patient selected as a target, 16 other patients served as reference images, which comprised 16×17 registrations per structure. However, as mentioned before, the shape models are trained by delineations of all weeks.

Although the aim of our method is to improve registrations between target and reference image, the behavior in a multi-atlas segmentation setting was investigated as well. A majority vote (K
                        ⩾8) was calculated on the registered atlases for each target, which was evaluated by Dice similarity to the manual segmentation.

The conventional registration as was used in this paper does not have any explicit regularization. One could argue that adding any form of regularization would improve registration already. Since a bending energy penalty term is often used in the field of registration, a comparison to such a method was performed using the implementation available in [17]. The weighing parameter for the penalty term was set to 0.1, 1.0, 10 and 100 and the experiments were performed for the bladder on all image combinations.

As explained, the shrinkage intensity was set to 0.2 based on preliminary experiments on first-week images. The sensitivity to this parameter was also investigated for the last-week images. Model-enhanced registrations of the bladder were performed with the shrinkage intensity set to 0.1, 0.2, 0.5 and 1.0, respectively.

@&#RESULTS@&#

The Dice overlap scores and Hausdorff surface distances for the bladder and the CTV are shown in Figs. 2–5
                     
                     
                     
                     , respectively. The overall mean and median scores of the experiments are summarized in Table 1
                     . The registration results of the presented shape model were compared to conventional registration by Wilcoxon signed-rank tests for paired samples. The improvement of the average DSC for bladder and CTV are found to be significant, i.e. p
                     <0.001. The same level of significance is found for the improvement of the average Hausdorff distance for bladder and CTV.

When the results are regarded for the individual target patients as done in Fig. 2, the average improvement of DSC of is found to be significant for 15 out of 17 cases. For the average Hausdorff distances, as can be seen in Fig. 3, the improvement is also found to be significant for 15 cases. The same tests were performed on the CTV results of Figs. 4 and 5, where the improvements are found to be significant for 14 and 15 out of 17 cases.

Additionally, the results are split over the individual reference patients rather than the target patients, to see whether this improvement was due to the improvement of registration with only some of the references. For each of the four combinations of structure and score, there was a significant improvement for the majority of the 17 reference cases.

The results of the experiments with the bending penalty term and shrinkage intensity are shown in Tables 2 and 3
                     
                     . The scores of the bending penalty experiments with weights 0.1, 1.0 and 10 are very similar to those of conventional registration, whereas with a weight of 100 the scores are a bit lower.

Registrations were done on a quad core desktop computer running at 2.83GHz. Computation times for conventional registration of one image pair is about 1 and a half minute, while with model it increases to about 3min.

@&#DISCUSSION@&#

The results of the experiments show that the inclusion of the statistical model significantly improves registration in terms of Dice similarity and Hausdorff distance of the segmentations. The Dice score for the bladder improves with 0.11 on average and for the CTV with 0.13 on average. Although Hausdorff distance can be regarded complementary to Dice similarity, the scores have a similar pattern of improvement. The bladder segmentation Hausdorff distances are improved by 8mm and for the CTV segmentations by 9mm on average.

The overall improvements are not caused by a just few large improvements, since Figs. 2–5 show that improvements are made for the majority of target patients. Additionally, for most of the targets, the box and whisker plots are shorter for model-enhanced registration than for conventional registration. The smaller spread in outcomes indicates that the impact of selecting a reference image for registration has decreased. Similarly, the evaluation per individual reference patient shows improvement for the majority of patients. However, it remains clear that some targets are more difficult to register than others and some references are more suitable as atlas than others.

Generally, the improved registrations also constitute a better segmentation that is based on majority voting. The assumption for the majority voting method is that the individual propagated segmentations have uncorrelated errors with respect to the target segmentation. By applying the voting rule on a sufficiently large number of propagated segmentations, these errors have a reduced influence on the final segmentation. The majority vote of the segmentations obtained by independent conventional registrations generally improves the Dice score over the average segmentation scores for that target. For model-enhanced registrations however, one could expect that majority voting does not give an improvement, since the individual errors with respect to the target segmentation might have become strongly correlated due to the influence of the model. Although in each model-enhanced registration the structure shapes of all other references are incorporated, the specific image characteristics of the image chosen as reference still has its influence on registration. Also the reference image defines the initial shape during registration.

The sensitivity of the registration outcome to the shrinkage intensity is low, which was also observed in preliminary experiments on first-week images. A small decrease in median Dice scores is observed for a shrinkage intensity of 1.0. As can been seen from Eq. (5), setting the shrinkage intensity 
                        
                           
                              
                                 σ
                              
                              
                                 0
                              
                              
                                 2
                              
                           
                        
                      to 1 results in a model that still uses the mean shape, but where shape (co-) variations around this mean are penalized equally. Using this “reduced” model still gives good scores on average, but at a cost of an overall distribution that has more mass in the mid range of scores, resulting in a lower median. Modeling the shape covariance clearly has influence on the distribution of Dice scores.

Although the scores are substantially increased by inclusion of shape knowledge, the obtained median of 0.73 DSC for bladder segmentation indicates a quality of segmentation too low for clinical use. The quality is not yet at the level of intra-patient registration, of which a median Dice similarity coefficient of 0.81 for bladder alignment was reported [11]. However, shape and tissue variations for intra-patient are smaller than for inter-patient generally.

In registration there is a balance between the amount of flexibility that is allowed in a registration procedure and the risk of ending up with a completely failed registration. However, regularizing registration by a bending penalty term does not give a useful reduction of local minima. Bending penalty experiments, as summarized in Table 2, generally show very similar distributions of Dice overlap compared with conventional registration.

By incorporation of the shape model the flexibility can be kept high, while resulting shapes remain consistent with the training population. Since the model incorporates a mean shape the method is not only a restricting term, but also a driving force in registration.


                     Fig. 6
                      shows an example of conventional registration failure due to a local minimum. With conventional registration a part of the bladder edge of the reference is erroneously aligned with the edge in the target. Here normalized cross-correlation image similarity showed a local optimum for a mapping the bladder to the surrounding fat tissue of similar intensity, while aligning the edges.

A similar effect can be seen in Fig. 7
                     , where the reference image is of patient 5, which is depicted in Fig. 1 left. This reference, which shows a bladder bulge at the right of the transversal image, defines the initialization shape for the registration process. Due to this initialization, conventional registration aligns the edges of the bulge to edges in neighboring tissue, creating an extreme bladder shape. For registration with the shape model on the other hand, deformations toward this unlikely shape are penalized.

The coronal view of Fig. 6 shows some spikes in the obtained delineation of both the conventional and the model-enhanced registration. As mentioned before, the manual delineations are made for clinical purposes. 2D polygons were drawn on transversal slices, which were connected automatically to form a 3D mesh. Because of this slice-based procedure, uncertainties in drawing delineations can produce zig-zag patterns when viewing different cross sections. Since the proposed delineations are the propagated versions of the 3D mesh, these patterns remain.

Although model-enhanced registration performs better that conventional registration for the CTV, the quality of segmentation of the CTV is considerably lower than that of the bladder, in both types of registration.

Poorer intensity-based registration of the CTV can be ascribed to multiple causes. First of all, there is a wide variation in size, shape and orientation of the uterus, which is the main part of the CTV. The uterus can have different tilted positions and has a high mobility due to bladder and rectum filling. Its sliding interface with multiple neighboring structures, i.e. the bladder, the rectum and the bowel, makes registration on surrounding tissue inconsistent. The uterus does not have strong image features that are present in all subjects. Furthermore, the tumor size and appearance and its location within the CTV vary over patients.

Besides all the difficulties in registration, modeling the shape of the CTV is challenging too. Two causes could be identified. The point correspondence obtained by registration of binary images is prone to errors, because it does not take into account the different substructures that constitute the CTV. Secondly, due to tilting of the uterus, there are rotational parts in the transforms. But since our model treats the deformations as a linear combination of all the displacement vectors, it is less suitable to describe rotations.

@&#CONCLUSIONS@&#

Large and complex deformations form a great difficulty in free-form registration. In this paper we extend free-form registration by integrating prior knowledge obtained from boundary deformations of segmentations in set of atlas images. We demonstrate our approach by inter-patient registration of cervical images.

Inter-patient registration of cervical images has to deal with a number of difficulties. The topology and appearance of structures differ substantially between two persons. There is a wide variation in bladder sizes and shapes, as well in size and orientation of the uterus. Also the differences in the amount of (visceral) fat and rectum and bowel fillings between patients, make these registrations a difficult task.

To evaluate the proposed approach, we compare manual segmentations with the propagated segmentations by Dice similarity and Hausdorff distance. Registration experiments were performed on the bladder and the CTV (i.e. a combination of the uterus, the cervix, the parametria and the upper part of the vagina). We show that our proposed method significantly improves segmentations of both these structures in comparison with a conventional registration.

@&#ACKNOWLEDGMENTS@&#

This work was financially supported by the projects Care4Me (Cooperative advanced research for medical efficiency) and Mediate (Patient friendly medical intervention) in the framework of the EU research program ITEA (Information Technology for European Advancement).

@&#REFERENCES@&#

